# –§–ò–ù–ê–õ–¨–ù–´–ô –ü–õ–ê–ù –†–ï–®–ï–ù–ò–ô –° –¢–û–ß–ö–ò –ó–†–ï–ù–ò–Ø –¢–†–ï–ô–î–ò–ù–ì–ê

**–î–∞—Ç–∞:** 2025-12-20  
**–°—Ç–∞—Ç—É—Å:** üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´ - –ì–û–¢–û–í –ö –ò–°–ü–†–ê–í–õ–ï–ù–ò–Æ

---

## üéØ –ü–û–ù–Ø–õ –í–ê–®–ò –¢–†–ï–ë–û–í–ê–ù–ò–Ø

### –ü–æ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ –æ—Ä–¥–µ—Ä–æ–≤:
- ‚úÖ **–£–±—Ä–∞—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫—É** - —Ä–∞–∑—Ä–µ—à–∏—Ç—å –æ—Ä–¥–µ—Ä–∞–º —Å—É–º–º–∏—Ä–æ–≤–∞—Ç—å—Å—è –≤ –æ–¥–Ω—É –ø–æ–∑–∏—Ü–∏—é
- ‚úÖ **–î–æ 5 –æ—Ä–¥–µ—Ä–æ–≤** –≤ –æ–¥–Ω–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ ‚Üí –ø–æ—Ç–æ–º –ø–æ–ª–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–∏
- ‚úÖ **–†–∞–∑—Ä–µ—à–∏—Ç—å LONG –∏ SHORT –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ** - –Ω–µ –∑–∞–∫—Ä—ã–≤–∞—Ç—å –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- ‚úÖ **–î–∞—Ç—å –±–æ—Ç—É —Å–≤–æ–±–æ–¥—É** - –ø—É—Å—Ç—å —Å–∞–º —Ä–µ—à–∞–µ—Ç –∫–æ–≥–¥–∞ –∑–∞–∫—Ä—ã–≤–∞—Ç—å

---

## üî¥ –†–ï–®–ï–ù–ò–ï #1: –ò–°–ü–†–ê–í–ò–¢–¨ –õ–û–ì–ò–ö–£ –ó–ê–ö–†–´–¢–ò–Ø –ü–û–ó–ò–¶–ò–ô

### –ü—Ä–æ–±–ª–µ–º–∞:
**–ë–æ—Ç –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –±–æ–ª—å—à–∏–µ —É–±—ã—Ç–∫–∏ ($1-4), –º–∞–ª–µ–Ω—å–∫–∏–µ –ø—Ä–∏–±—ã–ª–∏ ($0.02, $0.3)**

### –ê–Ω–∞–ª–∏–∑ —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è —Ç—Ä–µ–π–¥–∏–Ω–≥–∞:

#### ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û–ï –ü–û–í–ï–î–ï–ù–ò–ï:
1. **–ù–µ –∑–∞–∫—Ä—ã–≤–∞—Ç—å –º–∞–ª–µ–Ω—å–∫—É—é –ø—Ä–∏–±—ã–ª—å –µ—Å–ª–∏ –±—ã–ª –±–æ–ª—å—à–æ–π peak_profit**
   - –ï—Å–ª–∏ –ø–æ–∑–∏—Ü–∏—è –±—ã–ª–∞ –≤ –ø—Ä–∏–±—ã–ª–∏ +$2, –∞ —Å–µ–π—á–∞—Å +$0.3 ‚Üí –ù–ï –∑–∞–∫—Ä—ã–≤–∞—Ç—å
   - –ü—Ä–∞–≤–∏–ª–æ: `current_profit < peak_profit * 0.7` ‚Üí –¥–µ—Ä–∂–∞—Ç—å –ø–æ–∑–∏—Ü–∏—é
   - –≠—Ç–æ –∑–∞—â–∏—Ç–∞ –æ—Ç –ø—Ä–µ–∂–¥–µ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è

2. **–ó–∞–∫—Ä—ã–≤–∞—Ç—å –ø–æ SL —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Ä–µ–∞–ª—å–Ω–æ–º —Ä–∞–∑–≤–æ—Ä–æ—Ç–µ**
   - –ù–µ –∑–∞–∫—Ä—ã–≤–∞—Ç—å –ø–æ SL –µ—Å–ª–∏ Order Flow –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–∞–∑–≤–æ—Ä–æ—Ç
   - –ù–µ –∑–∞–∫—Ä—ã–≤–∞—Ç—å –ø–æ SL –µ—Å–ª–∏ MTF –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–∞–∑–≤–æ—Ä–æ—Ç
   - –ó–∞–∫—Ä—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ç—Ä–µ–Ω–¥ —Ä–∞–∑–≤–µ—Ä–Ω—É–ª—Å—è

3. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å trailing stop –¥–ª—è –∑–∞—â–∏—Ç—ã –ø—Ä–∏–±—ã–ª–∏**
   - –ï—Å–ª–∏ –ø—Ä–∏–±—ã–ª—å –±—ã–ª–∞ +$2, –∞ —Å–µ–π—á–∞—Å +$1.5 ‚Üí trailing stop –¥–æ–ª–∂–µ–Ω –∑–∞—â–∏—â–∞—Ç—å
   - –ù–µ –¥–∞–≤–∞—Ç—å –ø—Ä–∏–±—ã–ª–∏ —É–ø–∞—Å—Ç—å –Ω–∏–∂–µ 70% –æ—Ç peak

### –ù–∞–π–¥–µ–Ω–æ –≤ –∫–æ–¥–µ:

**–¢–µ–∫—É—â–∞—è –ª–æ–≥–∏–∫–∞:**
- `_update_peak_profit()` –æ–±–Ω–æ–≤–ª—è–µ—Ç `peak_profit_usd` –≤ metadata
- `big_profit_exit` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `profit_drawdown >= 30%` –æ—Ç –º–∞–∫—Å–∏–º—É–º–∞
- **–ù–û:** –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ `peak_profit` –≤ ExitAnalyzer –ø–µ—Ä–µ–¥ –æ–±—ã—á–Ω—ã–º –∑–∞–∫—Ä—ã—Ç–∏–µ–º!
- **–ù–û:** –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ `peak_profit` –≤ TP/SL –ø—Ä–æ–≤–µ—Ä–∫–∞—Ö!

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞:**
- `min_profit_to_close`: 0.001 (0.1%) - –±–∞–∑–æ–≤—ã–π
- `min_profit_to_close`: 0.01-0.025 (1-2.5%) - –ø–æ —Ä–µ–∂–∏–º–∞–º
- `tp_percent`: 1.2-5.0% (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–µ–∂–∏–º–∞ –∏ —Å–∏–º–≤–æ–ª–∞)
- `sl_percent`: 0.8-2.0% (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–µ–∂–∏–º–∞ –∏ —Å–∏–º–≤–æ–ª–∞)

### –ü–ª–∞–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:

#### –®–∞–≥ 1.1: –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É peak_profit –≤ ExitAnalyzer
**–§–∞–π–ª:** `src/strategies/scalping/futures/positions/exit_analyzer.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –í `_generate_exit_for_trending()` (—Å—Ç—Ä–æ–∫–∞ ~1500)
- –í `_generate_exit_for_ranging()` (—Å—Ç—Ä–æ–∫–∞ ~1600)
- –í `_generate_exit_for_choppy()` (—Å—Ç—Ä–æ–∫–∞ ~2200)

**–ö–æ–¥:**
```python
# –ü–æ—Å–ª–µ —Ä–∞—Å—á–µ—Ç–∞ pnl_percent, –ü–ï–†–ï–î –ø—Ä–æ–≤–µ—Ä–∫–æ–π TP/SL:
peak_profit_usd = 0.0
if metadata and hasattr(metadata, "peak_profit_usd"):
    peak_profit_usd = metadata.peak_profit_usd

# –ï—Å–ª–∏ –±—ã–ª –±–æ–ª—å—à–æ–π peak_profit, –Ω–µ –∑–∞–∫—Ä—ã–≤–∞—Ç—å —Å –º–∞–ª–µ–Ω—å–∫–æ–π –ø—Ä–∏–±—ã–ª—å—é
if peak_profit_usd > 0 and pnl_percent > 0:
    # –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º peak_profit_usd –≤ –ø—Ä–æ—Ü–µ–Ω—Ç—ã –æ—Ç –º–∞—Ä–∂–∏
    # (–Ω—É–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å margin_used –∏–∑ –ø–æ–∑–∏—Ü–∏–∏)
    margin_used = position.get("margin_used", 0)
    if margin_used > 0:
        peak_profit_pct = (peak_profit_usd / margin_used) * 100
        # –ù–µ –∑–∞–∫—Ä—ã–≤–∞—Ç—å –µ—Å–ª–∏ —Ç–µ–∫—É—â–∞—è –ø—Ä–∏–±—ã–ª—å < 70% –æ—Ç peak
        if pnl_percent < peak_profit_pct * 0.7:
            logger.info(
                f"üõ°Ô∏è ExitAnalyzer {regime}: –ù–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º {symbol} - "
                f"—Ç–µ–∫—É—â–∞—è –ø—Ä–∏–±—ã–ª—å {pnl_percent:.2f}% < 70% –æ—Ç peak {peak_profit_pct:.2f}%"
            )
            return {"action": "hold", "reason": "profit_too_low_vs_peak"}
```

#### –®–∞–≥ 1.2: –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É peak_profit –≤ TP/SL
**–§–∞–π–ª:** `src/strategies/scalping/futures/position_manager.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –í `_check_tp_only()` (—Å—Ç—Ä–æ–∫–∞ ~2100)
- –í `_check_sl()` (—Å—Ç—Ä–æ–∫–∞ ~1800) - —Ç–æ–ª—å–∫–æ –¥–ª—è –ø—Ä–∏–±—ã–ª—å–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π

**–ö–æ–¥:**
```python
# –í _check_tp_only(), –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º:
if pnl_percent > 0:  # –¢–æ–ª—å–∫–æ –¥–ª—è –ø—Ä–∏–±—ã–ª—å–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π
    metadata = await self.position_registry.get_metadata(symbol)
    if metadata and hasattr(metadata, "peak_profit_usd"):
        peak_profit_usd = metadata.peak_profit_usd
        if peak_profit_usd > 0:
            margin_used = position.get("margin_used", 0)
            if margin_used > 0:
                peak_profit_pct = (peak_profit_usd / margin_used) * 100
                if pnl_percent < peak_profit_pct * 0.7:
                    logger.info(
                        f"üõ°Ô∏è TP: –ù–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º {symbol} - "
                        f"—Ç–µ–∫—É—â–∞—è –ø—Ä–∏–±—ã–ª—å {pnl_percent:.2f}% < 70% –æ—Ç peak {peak_profit_pct:.2f}%"
                    )
                    return  # –ù–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º
```

#### –®–∞–≥ 1.3: –£–ª—É—á—à–∏—Ç—å SL –ª–æ–≥–∏–∫—É
**–§–∞–π–ª:** `src/strategies/scalping/futures/position_manager.py:_check_sl()`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å —Ä–∞–∑–≤–æ—Ä–æ—Ç –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º –ø–æ SL
- –ù–µ –∑–∞–∫—Ä—ã–≤–∞—Ç—å –µ—Å–ª–∏ Order Flow –∏–ª–∏ MTF –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Ä–∞–∑–≤–æ—Ä–æ—Ç

**–ö–æ–¥:**
```python
# –í _check_sl(), –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º:
# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–≤–æ—Ä–æ—Ç
if self.exit_analyzer:
    reversal_check = await self.exit_analyzer._check_reversal_candles(...)
    if reversal_check and reversal_check.get("reversal_detected"):
        logger.info(f"üîÑ SL: –ù–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º {symbol} - –æ–±–Ω–∞—Ä—É–∂–µ–Ω —Ä–∞–∑–≤–æ—Ä–æ—Ç")
        return  # –ù–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º –ø–æ SL - –µ—Å—Ç—å –ø—Ä–∏–∑–Ω–∞–∫–∏ —Ä–∞–∑–≤–æ—Ä–æ—Ç–∞
```

---

## üî¥ –†–ï–®–ï–ù–ò–ï #2: –£–ë–†–ê–¢–¨ –ë–õ–û–ö–ò–†–û–í–ö–£ –û–†–î–ï–†–û–í

### –ü—Ä–æ–±–ª–µ–º–∞:
**`allow_concurrent=false` –±–ª–æ–∫–∏—Ä—É–µ—Ç –Ω–æ–≤—ã–µ —Å–∏–≥–Ω–∞–ª—ã –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏—è—Ö**

### –ê–Ω–∞–ª–∏–∑ —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è —Ç—Ä–µ–π–¥–∏–Ω–≥–∞:

#### ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û–ï –ü–û–í–ï–î–ï–ù–ò–ï:
1. **–†–∞–∑—Ä–µ—à–∏—Ç—å —Å—É–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ä–¥–µ—Ä–æ–≤ –≤ –æ–¥–Ω–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ (–¥–æ 5 —Ä–∞–∑)**
   - –ù–∞ OKX Futures –æ—Ä–¥–µ—Ä–∞ –≤ –æ–¥–Ω–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –æ–±—ä–µ–¥–∏–Ω—è—é—Ç—Å—è –≤ –æ–¥–Ω—É –ø–æ–∑–∏—Ü–∏—é
   - –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ - –º–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏–≤–∞—Ç—å –ø–æ–∑–∏—Ü–∏—é –ø–æ –º–µ—Ä–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Å–∏–≥–Ω–∞–ª–∞
   - –ü–æ—Å–ª–µ 5 –æ—Ä–¥–µ—Ä–æ–≤ ‚Üí –ø–æ–ª–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–∏

2. **–†–∞–∑—Ä–µ—à–∏—Ç—å LONG –∏ SHORT –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ**
   - –≠—Ç–æ —Ö–µ–¥–∂–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏
   - –ü–æ–∑–≤–æ–ª—è–µ—Ç –±–æ—Ç—É —Ä–∞–±–æ—Ç–∞—Ç—å –≤ –æ–±–µ —Å—Ç–æ—Ä–æ–Ω—ã
   - –ë–æ—Ç —Å–∞–º –∑–∞–∫—Ä–æ–µ—Ç –ø–æ–∑–∏—Ü–∏—é –∫–æ–≥–¥–∞ —É–≤–∏–¥–∏—Ç —Ä–∞–∑–≤–æ—Ä–æ—Ç

3. **–ù–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ —Å–∏–≥–Ω–∞–ª—ã**
   - –ï—Å–ª–∏ —Å–∏–≥–Ω–∞–ª —Å–∏–ª—å–Ω—ã–π ‚Üí –æ—Ç–∫—Ä—ã–≤–∞—Ç—å –Ω–æ–≤—É—é –ø–æ–∑–∏—Ü–∏—é
   - –ï—Å–ª–∏ —Å–∏–≥–Ω–∞–ª –≤ —Ç–æ–º –∂–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ ‚Üí —É–≤–µ–ª–∏—á–∏–≤–∞—Ç—å –ø–æ–∑–∏—Ü–∏—é
   - –ï—Å–ª–∏ —Å–∏–≥–Ω–∞–ª –≤ –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω–æ–º ‚Üí –æ—Ç–∫—Ä—ã–≤–∞—Ç—å –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω—É—é –ø–æ–∑–∏—Ü–∏—é

### –ü–ª–∞–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:

#### –®–∞–≥ 2.1: –£–±—Ä–∞—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –≤ signal_coordinator.py
**–§–∞–π–ª:** `src/strategies/scalping/futures/coordinators/signal_coordinator.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –£–±—Ä–∞—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –≤ —Å—Ç—Ä–æ–∫–∞—Ö 1034-1046
- –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –ø–æ–¥—Å—á–µ—Ç–∞ –æ—Ä–¥–µ—Ä–æ–≤ –≤ –æ–¥–Ω–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏
- –ü–æ—Å–ª–µ 5 –æ—Ä–¥–µ—Ä–æ–≤ ‚Üí –ø–æ–ª–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–∏

**–ö–æ–¥:**
```python
# –í check_for_signals(), —Å—Ç—Ä–æ–∫–∞ ~1000
# –£–ë–†–ê–¢–¨ —ç—Ç–æ—Ç –±–ª–æ–∫:
# if not allow_concurrent:
#     return  # –ë–õ–û–ö–ò–†–£–ï–ú

# –í–ú–ï–°–¢–û –≠–¢–û–ì–û:
# –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º –æ—Ä–¥–µ—Ä–∞ –≤ —Ç–æ–º –∂–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏
same_direction_orders = 0
for pos in symbol_positions:
    pos_side = pos.get("posSide", "").lower()
    if pos_side == signal_position_side.lower():
        same_direction_orders += 1

# –ï—Å–ª–∏ —É–∂–µ 5 –æ—Ä–¥–µ—Ä–æ–≤ –≤ —Ç–æ–º –∂–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ ‚Üí –ø–æ–ª–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ
if same_direction_orders >= 5:
    logger.info(
        f"üîÑ {symbol}: –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç 5 –æ—Ä–¥–µ—Ä–æ–≤ –≤ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ {signal_position_side.upper()}, "
        f"–∑–∞–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –ø–æ–∑–∏—Ü–∏–∏ –ø–µ—Ä–µ–¥ –Ω–æ–≤—ã–º —Å–∏–≥–Ω–∞–ª–æ–º"
    )
    await self.orchestrator.close_all_positions(symbol, reason="max_orders_reached")
    # –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –æ—Ç–∫—Ä—ã—Ç–∏–µ –Ω–æ–≤–æ–π –ø–æ–∑–∏—Ü–∏–∏
elif same_direction_orders > 0:
    logger.debug(
        f"üìä {symbol}: –£–∂–µ –µ—Å—Ç—å {same_direction_orders} –æ—Ä–¥–µ—Ä(–æ–≤) –≤ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ {signal_position_side.upper()}, "
        f"—Ä–∞–∑—Ä–µ—à–∞–µ–º —Å—É–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ (–¥–æ 5)"
    )
    # –†–∞–∑—Ä–µ—à–∞–µ–º –æ—Ç–∫—Ä—ã—Ç–∏–µ - –æ—Ä–¥–µ—Ä–∞ —Å—É–º–º–∏—Ä—É—é—Ç—Å—è
```

#### –®–∞–≥ 2.2: –†–∞–∑—Ä–µ—à–∏—Ç—å LONG –∏ SHORT –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
**–§–∞–π–ª:** `src/strategies/scalping/futures/coordinators/signal_coordinator.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –£–±—Ä–∞—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π –≤ —Å—Ç—Ä–æ–∫–∞—Ö 313-327
- –†–∞–∑—Ä–µ—à–∏—Ç—å –æ—Ç–∫—Ä—ã—Ç–∏–µ LONG –∏ SHORT –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ

**–ö–æ–¥:**
```python
# –í process_signals(), —Å—Ç—Ä–æ–∫–∞ ~310
# –£–ë–†–ê–¢–¨ —ç—Ç–æ—Ç –±–ª–æ–∫:
# if has_long and has_short and not allow_concurrent:
#     continue  # –ë–õ–û–ö–ò–†–£–ï–ú

# –í–ú–ï–°–¢–û –≠–¢–û–ì–û:
if has_long and has_short:
    logger.debug(
        f"üìä {symbol}: –ï—Å—Ç—å LONG –∏ SHORT –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ - —Ä–∞–∑—Ä–µ—à–∞–µ–º (—Ö–µ–¥–∂–∏—Ä–æ–≤–∞–Ω–∏–µ)"
    )
    # –†–∞–∑—Ä–µ—à–∞–µ–º - –±–æ—Ç —Å–∞–º –∑–∞–∫—Ä–æ–µ—Ç –∫–æ–≥–¥–∞ —É–≤–∏–¥–∏—Ç —Ä–∞–∑–≤–æ—Ä–æ—Ç
```

#### –®–∞–≥ 2.3: –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
**–§–∞–π–ª:** `config/config_futures.yaml`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
```yaml
allow_concurrent_positions: true  # –†–∞–∑—Ä–µ—à–∏—Ç—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏
max_positions_per_symbol: 5  # –î–æ 5 –æ—Ä–¥–µ—Ä–æ–≤ –≤ –æ–¥–Ω–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏
```

---

## üî¥ –†–ï–®–ï–ù–ò–ï #3: –£–õ–£–ß–®–ò–¢–¨ –≠–§–§–ï–ö–¢–ò–í–ù–û–°–¢–¨ –û–†–î–ï–†–û–í

### –ü—Ä–æ–±–ª–µ–º–∞:
**–¢–æ–ª—å–∫–æ 11.6% –æ—Ä–¥–µ—Ä–æ–≤ –∏—Å–ø–æ–ª–Ω—è—é—Ç—Å—è (204 –∏–∑ 1764)**

### –ê–Ω–∞–ª–∏–∑ —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è —Ç—Ä–µ–π–¥–∏–Ω–≥–∞:

#### ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û–ï –ü–û–í–ï–î–ï–ù–ò–ï:
1. **–õ–∏–º–∏—Ç–Ω—ã–µ –æ—Ä–¥–µ—Ä–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –±–ª–∏–∑–∫–æ –∫ —Ä—ã–Ω–∫—É**
   - –î–ª—è —Å–∫–∞–ª—å–ø–∏–Ω–≥–∞: offset 0.05-0.1% –æ—Ç —Ç–µ–∫—É—â–µ–π —Ü–µ–Ω—ã
   - –°–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π offset ‚Üí –æ—Ä–¥–µ—Ä –Ω–µ –∏—Å–ø–æ–ª–Ω—è–µ—Ç—Å—è
   - –°–ª–∏—à–∫–æ–º –º–∞–ª–µ–Ω—å–∫–∏–π offset ‚Üí —Ä–∏—Å–∫ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –ø–æ –Ω–µ–≤—ã–≥–æ–¥–Ω–æ–π —Ü–µ–Ω–µ

2. **–¢–∞–π–º–∞—É—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ä–∞–∑—É–º–Ω—ã–º**
   - –î–ª—è —Å–∫–∞–ª—å–ø–∏–Ω–≥–∞: 15-30 —Å–µ–∫—É–Ω–¥ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ
   - –ï—Å–ª–∏ —Ü–µ–Ω–∞ –±–ª–∏–∑–∫–∞ –∫ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—é ‚Üí –Ω–µ –æ—Ç–º–µ–Ω—è—Ç—å
   - –ï—Å–ª–∏ —Ü–µ–Ω–∞ –¥–∞–ª–µ–∫–æ ‚Üí –æ—Ç–º–µ–Ω–∏—Ç—å –∏ –æ—Ç–∫—Ä—ã—Ç—å –ø–æ —Ä—ã–Ω–∫—É

### –ü–ª–∞–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:

#### –®–∞–≥ 3.1: –ù–∞–π—Ç–∏ –∏ —É–º–µ–Ω—å—à–∏—Ç—å limit_offset_percent
**–§–∞–π–ª:** `config/config_futures.yaml` –∏–ª–∏ `order_executor.py`

**–ù—É–∂–Ω–æ –Ω–∞–π—Ç–∏:** –ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `limit_offset_percent`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
```yaml
# –í –∫–æ–Ω—Ñ–∏–≥–µ –∏–ª–∏ –∫–æ–¥–µ:
limit_offset_percent: 0.05  # –ë—ã–ª–æ 0.2%, —Å—Ç–∞–ª–æ 0.05% (–±–ª–∏–∂–µ –∫ —Ä—ã–Ω–∫—É)
```

#### –®–∞–≥ 3.2: –ù–∞–π—Ç–∏ –∏ —É–≤–µ–ª–∏—á–∏—Ç—å max_wait_seconds
**–§–∞–π–ª:** `config/config_futures.yaml` –∏–ª–∏ `order_executor.py`

**–ù—É–∂–Ω–æ –Ω–∞–π—Ç–∏:** –ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `max_wait_seconds`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
```yaml
# –í –∫–æ–Ω—Ñ–∏–≥–µ:
max_wait_seconds: 30  # –ë—ã–ª–æ 15, —Å—Ç–∞–ª–æ 30 —Å–µ–∫—É–Ω–¥
```

#### –®–∞–≥ 3.3: –ù–µ –æ—Ç–º–µ–Ω—è—Ç—å –µ—Å–ª–∏ —Ü–µ–Ω–∞ –±–ª–∏–∑–∫–∞
**–§–∞–π–ª:** `src/strategies/scalping/futures/coordinators/order_coordinator.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
```python
# –ü–µ—Ä–µ–¥ –æ—Ç–º–µ–Ω–æ–π –æ—Ä–¥–µ—Ä–∞:
current_price = await get_current_price()
if abs(current_price - limit_price) / limit_price < 0.001:  # < 0.1%
    logger.debug(f"‚è∏Ô∏è –ù–µ –æ—Ç–º–µ–Ω—è–µ–º –æ—Ä–¥–µ—Ä {symbol} - —Ü–µ–Ω–∞ –±–ª–∏–∑–∫–∞ –∫ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—é")
    return  # –ù–µ –æ—Ç–º–µ–Ω—è–µ–º
```

---

## üî¥ –†–ï–®–ï–ù–ò–ï #4: –ò–°–ü–†–ê–í–ò–¢–¨ –û–®–ò–ë–ö–ò 51006

### –ü—Ä–æ–±–ª–µ–º–∞:
**54 –æ—à–∏–±–∫–∏ "Order price is not within the price limit"**

### –ü–ª–∞–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:

#### –®–∞–≥ 4.1: –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ª–∏–º–∏—Ç–æ–≤
**–§–∞–π–ª:** `src/strategies/scalping/futures/order_executor.py:_place_limit_order()`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
```python
# –ü–µ—Ä–µ–¥ —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ–º –æ—Ä–¥–µ—Ä–∞:
price_limits = await self.client.get_price_limits(symbol)
if price_limits:
    max_buy = price_limits.get("max_buy_price", 0)
    min_sell = price_limits.get("min_sell_price", 0)
    
    if side == "buy" and limit_price > max_buy:
        logger.warning(
            f"‚ö†Ô∏è –¶–µ–Ω–∞ {limit_price} > max_buy {max_buy} –¥–ª—è {symbol}, –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º"
        )
        limit_price = max_buy * 0.999
    elif side == "sell" and limit_price < min_sell:
        logger.warning(
            f"‚ö†Ô∏è –¶–µ–Ω–∞ {limit_price} < min_sell {min_sell} –¥–ª—è {symbol}, –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º"
        )
        limit_price = min_sell * 1.001
```

---

## üìã –ü–û–†–Ø–î–û–ö –í–´–ü–û–õ–ù–ï–ù–ò–Ø

### –§–∞–∑–∞ 1: –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø (—Å–µ–≥–æ–¥–Ω—è)
1. ‚úÖ **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç #1:** –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–π (peak_profit)
2. ‚úÖ **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç #2:** –£–±—Ä–∞—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –æ—Ä–¥–µ—Ä–æ–≤
3. ‚úÖ **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç #3:** –£–ª—É—á—à–∏—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –æ—Ä–¥–µ—Ä–æ–≤
4. ‚úÖ **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç #4:** –ò—Å–ø—Ä–∞–≤–∏—Ç—å –æ—à–∏–±–∫–∏ 51006

### –§–∞–∑–∞ 2: –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø (–∑–∞–≤—Ç—Ä–∞)
5. ‚úÖ **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç #5:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–∞—Ç–µ–º–∞—Ç–∏–∫—É –∏ –∞–Ω–∞–ª–∏–∑
6. ‚úÖ **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç #6:** –ê—É–¥–∏—Ç API –≤—ã–∑–æ–≤–æ–≤

### –§–∞–∑–∞ 3: –†–ï–§–ê–ö–¢–û–†–ò–ù–ì (–ø–æ–∑–∂–µ)
7. ‚úÖ **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç #7:** –†–∞–∑–±–∏—Ç—å –º–æ–Ω—Å—Ç—Ä-—Ñ–∞–π–ª—ã

---

## ‚úÖ –ì–û–¢–û–í –ù–ê–ß–ê–¢–¨ –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

**–ù–∞—á–∏–Ω–∞—é —Å –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ #1 (–∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–π) - —ç—Ç–æ —Å–∞–º–∞—è –∫—Ä–∏—Ç–∏—á–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞!**

**–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ:**
1. ‚úÖ –†–∞–∑—Ä–µ—à–∏—Ç—å –¥–æ 5 –æ—Ä–¥–µ—Ä–æ–≤ –≤ –æ–¥–Ω–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ (—Å—É–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ)?
2. ‚úÖ –†–∞–∑—Ä–µ—à–∏—Ç—å LONG –∏ SHORT –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ?
3. ‚úÖ –ü–æ—Å–ª–µ 5 –æ—Ä–¥–µ—Ä–æ–≤ ‚Üí –ø–æ–ª–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–∏?

**–ù–∞—á–∏–Ω–∞—é –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è!** ‚úÖ



