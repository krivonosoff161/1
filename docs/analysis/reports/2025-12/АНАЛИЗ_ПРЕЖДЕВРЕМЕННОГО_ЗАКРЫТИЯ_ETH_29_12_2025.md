# üîç –ê–ù–ê–õ–ò–ó –ü–†–ï–ñ–î–ï–í–†–ï–ú–ï–ù–ù–û–ì–û –ó–ê–ö–†–´–¢–ò–Ø –ü–û–ó–ò–¶–ò–ò ETH-USDT

**–î–∞—Ç–∞:** 29.12.2025  
**–ü–æ–∑–∏—Ü–∏—è:** ETH-USDT LONG  
**–í—Ä–µ–º—è –æ—Ç–∫—Ä—ã—Ç–∏—è:** 29.12.2025, 01:14:32  
**–í—Ä–µ–º—è –∑–∞–∫—Ä—ã—Ç–∏—è:** 29.12.2025, 01:17:45  
**–í—Ä–µ–º—è —É–¥–µ—Ä–∂–∞–Ω–∏—è:** 3 –º–∏–Ω—É—Ç—ã 13 —Å–µ–∫—É–Ω–¥ (193 —Å–µ–∫—É–Ω–¥—ã)  
**–í—Ö–æ–¥–Ω–∞—è —Ü–µ–Ω–∞:** 2,965.00 USDT  
**–¶–µ–Ω–∞ –≤—ã—Ö–æ–¥–∞:** 2,961.54 USDT  
**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π PnL:** -0.54 USDT (-1.52%)  
**–†–µ–∂–∏–º:** RANGING  
**–ü—Ä–∏—á–∏–Ω–∞ –∑–∞–∫—Ä—ã—Ç–∏—è:** `sl_reached` (Stop Loss –¥–æ—Å—Ç–∏–≥–Ω—É—Ç)

---

## üìä –ö–õ–Æ–ß–ï–í–´–ï –§–ê–ö–¢–´ –ò–ó –õ–û–ì–û–í

### 1. –î–∞–Ω–Ω—ã–µ –∏–∑ JSON —Ñ–∞–π–ª–∞ —Ä–µ—à–µ–Ω–∏—è –æ –∑–∞–∫—Ä—ã—Ç–∏–∏

**–§–∞–π–ª:** `logs/futures/archived/logs_2025-12-29_01-23-51/logs_futures_debug/exit_decisions/ETH-USDT_2025-12-29_01-17-45-246.json`

```json
{
  "timestamp": "2025-12-29T01:17:45.246684",
  "symbol": "ETH-USDT",
  "decision": "close",
  "reason": "sl_reached",
  "pnl_pct": -0.6893760539629177,
  "regime": "ranging",
  "sl_percent": 0.6,
  "spread_buffer": 0.05,
  "entry_regime": "ranging"
}
```

**–ö–ª—é—á–µ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- **Gross PnL:** -0.689% (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Å SL)
- **SL:** 0.6%
- **Spread buffer:** 0.05%
- **SL threshold:** -0.6% - 0.05% = -0.65%
- **–í—Ä–µ–º—è —É–¥–µ—Ä–∂–∞–Ω–∏—è:** ~3 –º–∏–Ω—É—Ç—ã 13 —Å–µ–∫—É–Ω–¥

### 2. –ü—Ä–æ–±–ª–µ–º–∞: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ `min_holding_minutes` –ø–µ—Ä–µ–¥ SL

**–ö–æ–¥:** `src/strategies/scalping/futures/positions/exit_analyzer.py` (—Å—Ç—Ä–æ–∫–∏ 2710-2736)

```2710:2736:src/strategies/scalping/futures/positions/exit_analyzer.py
            # ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º Gross PnL —Å SL threshold
            if gross_pnl_percent <= sl_threshold:
                logger.warning(
                    f"üõë ExitAnalyzer RANGING: SL –¥–æ—Å—Ç–∏–≥–Ω—É—Ç –¥–ª—è {symbol}: "
                    f"Gross PnL {gross_pnl_percent:.2f}% <= SL threshold {sl_threshold:.2f}% "
                    f"(SL={sl_percent:.2f}% + spread_buffer={spread_buffer:.4f}%), "
                    f"Net PnL={net_pnl_percent:.2f}% (—Å –∫–æ–º–∏—Å—Å–∏–µ–π), —Ä–µ–∂–∏–º={regime}"
                )
                # ‚úÖ –ù–û–í–û–ï (26.12.2025): –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏
                self._record_metrics_on_close(
                    symbol=symbol,
                    reason="sl_reached",
                    pnl_percent=gross_pnl_percent,
                    entry_time=entry_time,
                )
                return {
                    "action": "close",
                    "reason": "sl_reached",
                    "pnl_pct": gross_pnl_percent,  # Gross PnL –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
                    "net_pnl_pct": net_pnl_percent,  # Net PnL –¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
                    "sl_percent": sl_percent,
                    "spread_buffer": spread_buffer,
                    "regime": regime,
                    "entry_regime": metadata.regime
                    if metadata and hasattr(metadata, "regime")
                    else regime,
                }
```

**–ü—Ä–æ–±–ª–µ–º–∞:** ‚ùå **–ù–ï–¢ –ü–†–û–í–ï–†–ö–ò `min_holding_minutes` –ü–ï–†–ï–î –ó–ê–ö–†–´–¢–ò–ï–ú –ü–û SL!**

### 3. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å Emergency Loss Protection

**–ö–æ–¥:** `src/strategies/scalping/futures/positions/exit_analyzer.py` (—Å—Ç—Ä–æ–∫–∏ 2537-2567)

```2537:2567:src/strategies/scalping/futures/positions/exit_analyzer.py
            # ‚úÖ –ù–û–í–û–ï (26.12.2025): –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è —É–¥–µ—Ä–∂–∞–Ω–∏—è –ø–µ—Ä–µ–¥ emergency close
            min_holding_seconds = 60.0  # RANGING: 60 —Å–µ–∫—É–Ω–¥ (1 –º–∏–Ω—É—Ç–∞)
            if net_pnl_percent < adjusted_emergency_threshold:
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è —É–¥–µ—Ä–∂–∞–Ω–∏—è
                if entry_time:
                    try:
                        if isinstance(entry_time, str):
                            entry_time_dt = datetime.fromisoformat(
                                entry_time.replace("Z", "+00:00")
                            )
                        else:
                            entry_time_dt = entry_time

                        # –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ entry_time –≤ UTC
                        if entry_time_dt.tzinfo is None:
                            entry_time_dt = entry_time_dt.replace(tzinfo=timezone.utc)
                        elif entry_time_dt.tzinfo != timezone.utc:
                            entry_time_dt = entry_time_dt.astimezone(timezone.utc)

                        holding_seconds = (
                            datetime.now(timezone.utc) - entry_time_dt
                        ).total_seconds()

                        if holding_seconds < min_holding_seconds:
                            logger.debug(
                                f"‚è≥ ExitAnalyzer RANGING: Emergency close –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –¥–ª—è {symbol} - "
                                f"–≤—Ä–µ–º—è —É–¥–µ—Ä–∂–∞–Ω–∏—è {holding_seconds:.1f}—Å < –º–∏–Ω–∏–º—É–º {min_holding_seconds:.1f}—Å "
                                f"(PnL={net_pnl_percent:.2f}% < –ø–æ—Ä–æ–≥={emergency_loss_threshold:.1f}%)"
                            )
                            # –ù–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º, –µ—Å–ª–∏ –Ω–µ –ø—Ä–æ—à–ª–æ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è
                            return None
```

**–í—ã–≤–æ–¥:** ‚úÖ –î–ª—è Emergency Loss –µ—Å—Ç—å –∑–∞—â–∏—Ç–∞ `min_holding_seconds = 60.0` (1 –º–∏–Ω—É—Ç–∞), –Ω–æ –¥–ª—è –æ–±—ã—á–Ω–æ–≥–æ SL —Ç–∞–∫–æ–π –∑–∞—â–∏—Ç—ã **–ù–ï–¢**!

### 4. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è RANGING —Ä–µ–∂–∏–º–∞

**–§–∞–π–ª:** `config/config_futures.yaml` (—Å—Ç—Ä–æ–∫–∏ 311-339)

```yaml
ranging:
  sl_percent: 1.0  # ‚úÖ –ì–†–û–ö –§–ò–ö–°: –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 0.8% –¥–æ 1.0%
  sl_atr_based: true  # ‚úÖ –ì–†–û–ö: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ATR-based SL –≤–º–µ—Å—Ç–æ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ
  sl_atr_multiplier: 2.0  # ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï (28.12.2025): –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 1.5 –¥–æ 2.0
  sl_min_percent: 0.6  # ‚úÖ –ì–†–û–ö: –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π SL 0.6% (–∑–∞—â–∏—Ç–∞ –æ—Ç —à—É–º–∞)
  sl_max_percent: 1.5  # ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï (28.12.2025): –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 1.2% –¥–æ 1.5%
  max_holding_minutes: 25  # ‚úÖ –ì–†–û–ö: –£–º–µ–Ω—å—à–µ–Ω–æ —Å 28 –¥–æ 25 –º–∏–Ω—É—Ç
  # ‚ùå –ü–†–û–ë–õ–ï–ú–ê: –ù–ï–¢ min_holding_minutes –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –ø—Ä–µ–∂–¥–µ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ SL!
```

**–ü—Ä–æ–±–ª–µ–º–∞:** ‚ùå **–í –∫–æ–Ω—Ñ–∏–≥–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç `min_holding_minutes` –¥–ª—è RANGING —Ä–µ–∂–∏–º–∞!**

---

## üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê

### –ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:

1. **01:14:32** ‚Äî –ü–æ–∑–∏—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç–∞ –ø–æ —Ü–µ–Ω–µ 2,965.00 USDT (LONG)
2. **01:15:XX** ‚Äî –¶–µ–Ω–∞ —É–ø–∞–ª–∞ –¥–æ ~2,961.54 USDT (–ø—Ä–∏–º–µ—Ä–Ω–æ -0.12% –æ—Ç –≤—Ö–æ–¥–∞)
3. **01:17:45** ‚Äî –ë–æ—Ç –∑–∞–∫—Ä—ã–ª –ø–æ–∑–∏—Ü–∏—é –ø–æ SL —á–µ—Ä–µ–∑ **3 –º–∏–Ω—É—Ç—ã 13 —Å–µ–∫—É–Ω–¥**
4. **–ü–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è** ‚Äî –¶–µ–Ω–∞ —Ä–∞–∑–≤–µ—Ä–Ω—É–ª–∞—Å—å –∏ –ø–æ—à–ª–∞ –≤–≤–µ—Ä—Ö (–ø–æ–∑–∏—Ü–∏—è –±—ã–ª–∞ –±—ã –≤ –ø–ª—é—Å–µ)

### –ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:

1. **SL —Å—Ä–∞–±–æ—Ç–∞–ª —Å–ª–∏—à–∫–æ–º —Ä–∞–Ω–æ:**
   - SL = 0.6% (–∏–∑ JSON)
   - Gross PnL = -0.689% (—á—É—Ç—å –±–æ–ª—å—à–µ SL threshold)
   - –í—Ä–µ–º—è —É–¥–µ—Ä–∂–∞–Ω–∏—è = 3 –º–∏–Ω—É—Ç—ã 13 —Å–µ–∫—É–Ω–¥
   - **–ù–ï–¢ –ø—Ä–æ–≤–µ—Ä–∫–∏ `min_holding_minutes` –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º –ø–æ SL!**

2. **–ü–æ–∑–∏—Ü–∏—è –±—ã–ª–∞ –æ—Ç–∫—Ä—ã—Ç–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ:**
   - –†–µ–∂–∏–º: RANGING
   - –°–∏–≥–Ω–∞–ª –±—ã–ª –≤–∞–ª–∏–¥–Ω—ã–º
   - –ù–æ –±–æ—Ç –Ω–µ –¥–∞–ª –ø–æ–∑–∏—Ü–∏–∏ "–¥—ã—à–∞—Ç—å" ‚Äî –∑–∞–∫—Ä—ã–ª —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –Ω–µ–±–æ–ª—å—à–æ–≥–æ –æ—Ç–∫–∞—Ç–∞

3. **–ü–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è –ø—Ä–æ–∏–∑–æ—à–µ–ª —Ä–∞–∑–≤–æ—Ä–æ—Ç:**
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–æ–±—â–∞–µ—Ç, —á—Ç–æ –ø–æ–∑–∏—Ü–∏—è –±—ã–ª–∞ –±—ã –≤ –ø–ª—é—Å–µ, –µ—Å–ª–∏ –±—ã –µ—ë –ø–æ–¥–µ—Ä–∂–∞–ª–∏ –Ω–µ–º–Ω–æ–≥–æ –¥–æ–ª—å—à–µ
   - –≠—Ç–æ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π —Å–ª—É—á–∞–π –ø—Ä–µ–∂–¥–µ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ SL

---

## üìã –ê–ù–ê–õ–ò–ó –ö–û–î–ê

### 1. –õ–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ SL –≤ RANGING —Ä–µ–∂–∏–º–µ

**–§–∞–π–ª:** `src/strategies/scalping/futures/positions/exit_analyzer.py`  
**–ú–µ—Ç–æ–¥:** `_analyze_ranging()`  
**–°—Ç—Ä–æ–∫–∏:** 2662-2736

**–¢–µ–∫—É—â–∞—è –ª–æ–≥–∏–∫–∞:**
1. –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è `sl_percent` (ATR-based –∏–ª–∏ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)
2. –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è `sl_threshold = -sl_percent - spread_buffer`
3. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è: `if gross_pnl_percent <= sl_threshold:`
4. **–ï—Å–ª–∏ —É—Å–ª–æ–≤–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ ‚Üí –∑–∞–∫—Ä—ã—Ç–∏–µ –ë–ï–ó –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Ä–µ–º–µ–Ω–∏ —É–¥–µ—Ä–∂–∞–Ω–∏—è!**

**–ü—Ä–æ–±–ª–µ–º–∞:** ‚ùå **–ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ `min_holding_minutes` –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º –ø–æ SL!**

### 2. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å TRENDING —Ä–µ–∂–∏–º–æ–º

**–§–∞–π–ª:** `src/strategies/scalping/futures/positions/exit_analyzer.py`  
**–ú–µ—Ç–æ–¥:** `_analyze_trending()`  
**–°—Ç—Ä–æ–∫–∏:** 2298-2300

```python
# ‚úÖ –ù–û–í–û–ï (28.12.2025): –ü—Ä–æ–≤–µ—Ä—è–µ–º min_holding_minutes –ø–µ—Ä–µ–¥ –ø—Ä–æ–≤–µ—Ä–∫–æ–π SL
min_holding_minutes = None
```

**–í—ã–≤–æ–¥:** –í TRENDING —Ä–µ–∂–∏–º–µ –µ—Å—Ç—å –∑–∞–≥–æ—Ç–æ–≤–∫–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ `min_holding_minutes`, –Ω–æ –æ–Ω–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é.

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ min_holding_minutes –≤ –¥—Ä—É–≥–∏—Ö –º–µ—Å—Ç–∞—Ö

**–§–∞–π–ª:** `src/strategies/scalping/futures/positions/exit_analyzer.py`  
**–ú–µ—Ç–æ–¥:** `_check_adaptive_min_holding_for_partial_tp()`  
**–°—Ç—Ä–æ–∫–∏:** ~3500+

**–í—ã–≤–æ–¥:** –õ–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ `min_holding_minutes` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –¥–ª—è Partial TP, –Ω–æ –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –¥–ª—è –æ–±—ã—á–Ω–æ–≥–æ SL!

---

## üéØ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –ò–°–ü–†–ê–í–õ–ï–ù–ò–Æ

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï (–Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ)

#### 1.1. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É `min_holding_minutes` –ø–µ—Ä–µ–¥ SL –≤ RANGING —Ä–µ–∂–∏–º–µ

**–§–∞–π–ª:** `src/strategies/scalping/futures/positions/exit_analyzer.py`  
**–ú–µ—Ç–æ–¥:** `_analyze_ranging()`  
**–°—Ç—Ä–æ–∫–∏:** ~2710-2736

**–ü–∞—Ç—á:**

```python
# ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º Gross PnL —Å SL threshold
if gross_pnl_percent <= sl_threshold:
    # ‚úÖ –ù–û–í–û–ï (29.12.2025): –ü—Ä–æ–≤–µ—Ä—è–µ–º min_holding_minutes –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º –ø–æ SL
    min_holding_minutes = self._get_min_holding_minutes("ranging", symbol)
    if min_holding_minutes is not None:
        minutes_in_position = self._get_time_in_position_minutes(metadata, position)
        if minutes_in_position is not None and minutes_in_position < min_holding_minutes:
            logger.debug(
                f"‚è≥ ExitAnalyzer RANGING: SL –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –¥–ª—è {symbol} - "
                f"–≤—Ä–µ–º—è —É–¥–µ—Ä–∂–∞–Ω–∏—è {minutes_in_position:.1f} –º–∏–Ω < –º–∏–Ω–∏–º—É–º {min_holding_minutes:.1f} –º–∏–Ω "
                f"(Gross PnL={gross_pnl_percent:.2f}% <= SL threshold={sl_threshold:.2f}%)"
            )
            # –ù–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º, –µ—Å–ª–∏ –Ω–µ –ø—Ä–æ—à–ª–æ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è
            return {
                "action": "hold",
                "reason": "sl_blocked_by_min_holding",
                "pnl_pct": gross_pnl_percent,
                "minutes_in_position": minutes_in_position,
                "min_holding_minutes": min_holding_minutes,
                "regime": regime,
            }
    
    logger.warning(
        f"üõë ExitAnalyzer RANGING: SL –¥–æ—Å—Ç–∏–≥–Ω—É—Ç –¥–ª—è {symbol}: "
        f"Gross PnL {gross_pnl_percent:.2f}% <= SL threshold {sl_threshold:.2f}% "
        f"(SL={sl_percent:.2f}% + spread_buffer={spread_buffer:.4f}%), "
        f"Net PnL={net_pnl_percent:.2f}% (—Å –∫–æ–º–∏—Å—Å–∏–µ–π), —Ä–µ–∂–∏–º={regime}"
    )
    # ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –∑–∞–∫—Ä—ã—Ç–∏—è
```

#### 1.2. –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ `_get_min_holding_minutes()`

**–§–∞–π–ª:** `src/strategies/scalping/futures/positions/exit_analyzer.py`  
**–ú–µ—Ç–æ–¥:** –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –º–µ—Ç–æ–¥ –ø–æ—Å–ª–µ `_get_max_holding_minutes()`

**–ü–∞—Ç—á:**

```python
def _get_min_holding_minutes(
    self, regime: str, symbol: Optional[str] = None
) -> Optional[float]:
    """
    –ü–æ–ª—É—á–µ–Ω–∏–µ min_holding_minutes –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ –ø–æ —Ä–µ–∂–∏–º—É.
    
    Args:
        regime: –†–µ–∂–∏–º —Ä—ã–Ω–∫–∞ (trending, ranging, choppy)
        symbol: –¢–æ—Ä–≥–æ–≤—ã–π —Å–∏–º–≤–æ–ª (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è per-symbol –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤)
        
    Returns:
        min_holding_minutes –∏–ª–∏ None –µ—Å–ª–∏ –Ω–µ –∑–∞–¥–∞–Ω–æ
    """
    # ‚úÖ –ü–†–ò–û–†–ò–¢–ï–¢ 1: exit_params.regime.min_holding_minutes (—á–µ—Ä–µ–∑ ParameterProvider)
    if self.parameter_provider:
        try:
            exit_params = self.parameter_provider.get_exit_params(
                symbol or "", regime
            )
            if exit_params and "min_holding_minutes" in exit_params:
                min_holding_minutes = self._to_float(
                    exit_params["min_holding_minutes"], "min_holding_minutes", None
                )
                if min_holding_minutes is not None:
                    logger.debug(
                        f"‚úÖ ExitAnalyzer: min_holding_minutes –¥–ª—è {symbol or 'default'} ({regime}) "
                        f"–ø–æ–ª—É—á–µ–Ω —á–µ—Ä–µ–∑ ParameterProvider: {min_holding_minutes:.1f}–º–∏–Ω"
                    )
                    return min_holding_minutes
        except Exception as e:
            logger.debug(
                f"‚ö†Ô∏è ExitAnalyzer: –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è min_holding_minutes —á–µ—Ä–µ–∑ ParameterProvider: {e}"
            )
    
    # ‚úÖ –ü–†–ò–û–†–ò–¢–ï–¢ 2: adaptive_regime.regime.min_holding_minutes
    if self.config_manager:
        try:
            if hasattr(self.config_manager, "_raw_config_dict"):
                config_dict = self.config_manager._raw_config_dict
                adaptive_regime = config_dict.get("adaptive_regime", {})
                regime_config = adaptive_regime.get(regime, {})
                if "min_holding_minutes" in regime_config:
                    min_holding_minutes = self._to_float(
                        regime_config["min_holding_minutes"], "min_holding_minutes", None
                    )
                    if min_holding_minutes is not None:
                        logger.debug(
                            f"‚úÖ ExitAnalyzer: min_holding_minutes –¥–ª—è {regime} "
                            f"–ø–æ–ª—É—á–µ–Ω –∏–∑ adaptive_regime: {min_holding_minutes:.1f}–º–∏–Ω"
                        )
                        return min_holding_minutes
        except Exception as e:
            logger.debug(
                f"‚ö†Ô∏è ExitAnalyzer: –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è min_holding_minutes –∏–∑ adaptive_regime: {e}"
            )
    
    # ‚úÖ –ü–†–ò–û–†–ò–¢–ï–¢ 3: per-symbol min_holding_minutes
    if symbol and self.config_manager:
        try:
            if hasattr(self.config_manager, "_raw_config_dict"):
                config_dict = self.config_manager._raw_config_dict
                by_symbol = config_dict.get("by_symbol", {})
                symbol_config = by_symbol.get(symbol, {})
                if "min_holding_minutes" in symbol_config:
                    min_holding_minutes = self._to_float(
                        symbol_config["min_holding_minutes"], "min_holding_minutes", None
                    )
                    if min_holding_minutes is not None:
                        logger.debug(
                            f"‚úÖ ExitAnalyzer: min_holding_minutes –¥–ª—è {symbol} "
                            f"–ø–æ–ª—É—á–µ–Ω –∏–∑ by_symbol: {min_holding_minutes:.1f}–º–∏–Ω"
                        )
                        return min_holding_minutes
        except Exception as e:
            logger.debug(
                f"‚ö†Ô∏è ExitAnalyzer: –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è min_holding_minutes –∏–∑ by_symbol: {e}"
            )
    
    # –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤–æ–∑–≤—Ä–∞—â–∞–µ–º None (–Ω–µ—Ç –∑–∞—â–∏—Ç—ã)
    return None
```

#### 1.3. –î–æ–±–∞–≤–∏—Ç—å `min_holding_minutes` –≤ –∫–æ–Ω—Ñ–∏–≥ –¥–ª—è RANGING —Ä–µ–∂–∏–º–∞

**–§–∞–π–ª:** `config/config_futures.yaml`  
**–°–µ–∫—Ü–∏—è:** `ranging:`  
**–°—Ç—Ä–æ–∫–∏:** ~311-339

**–ü–∞—Ç—á:**

```yaml
ranging:
  # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ...
  min_holding_minutes: 1.0  # ‚úÖ –ù–û–í–û–ï (29.12.2025): –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è —É–¥–µ—Ä–∂–∞–Ω–∏—è –ø–µ—Ä–µ–¥ SL (1 –º–∏–Ω—É—Ç–∞)
  max_holding_minutes: 25  # ‚úÖ –ì–†–û–ö: –£–º–µ–Ω—å—à–µ–Ω–æ —Å 28 –¥–æ 25 –º–∏–Ω—É—Ç
  # ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ...
```

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:**
- **RANGING:** `min_holding_minutes: 1.0` (1 –º–∏–Ω—É—Ç–∞) ‚Äî –∑–∞—â–∏—Ç–∞ –æ—Ç —à—É–º–∞
- **TRENDING:** `min_holding_minutes: 2.0` (2 –º–∏–Ω—É—Ç—ã) ‚Äî –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è —Ç—Ä–µ–Ω–¥–∞
- **CHOPPY:** `min_holding_minutes: 0.5` (30 —Å–µ–∫—É–Ω–¥) ‚Äî –±—ã—Å—Ç—Ä—ã–µ –∑–∞–∫—Ä—ã—Ç–∏—è –≤ —Ö–∞–æ—Å–µ

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –í–ê–ñ–ù–û (–ø–æ—Å–ª–µ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ 1)

#### 2.1. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É `min_holding_minutes` –ø–µ—Ä–µ–¥ SL –≤ TRENDING —Ä–µ–∂–∏–º–µ

–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ RANGING —Ä–µ–∂–∏–º—É, –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –≤ `_analyze_trending()`.

#### 2.2. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É `min_holding_minutes` –ø–µ—Ä–µ–¥ SL –≤ CHOPPY —Ä–µ–∂–∏–º–µ

–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ RANGING —Ä–µ–∂–∏–º—É, –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –≤ `_analyze_choppy()`.

---

## üìä –û–ñ–ò–î–ê–ï–ú–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´ –ü–û–°–õ–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- ‚ùå –ü–æ–∑–∏—Ü–∏—è –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø–æ SL —á–µ—Ä–µ–∑ 3 –º–∏–Ω—É—Ç—ã 13 —Å–µ–∫—É–Ω–¥
- ‚ùå –£–±—ã—Ç–æ–∫: -0.54 USDT (-1.52%)
- ‚ùå –ü–æ–∑–∏—Ü–∏—è –±—ã–ª–∞ –±—ã –≤ –ø–ª—é—Å–µ, –µ—Å–ª–∏ –±—ã –µ—ë –ø–æ–¥–µ—Ä–∂–∞–ª–∏ –¥–æ–ª—å—à–µ

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- ‚úÖ –ü–æ–∑–∏—Ü–∏—è –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø–æ SL, –µ—Å–ª–∏ –≤—Ä–µ–º—è —É–¥–µ—Ä–∂–∞–Ω–∏—è < `min_holding_minutes`
- ‚úÖ –ü–æ–∑–∏—Ü–∏—è –ø–æ–ª—É—á–∞–µ—Ç –≤—Ä–µ–º—è "–¥—ã—à–∞—Ç—å" –∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å—Å—è
- ‚úÖ –ú–µ–Ω—å—à–µ –ø—Ä–µ–∂–¥–µ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–∫—Ä—ã—Ç–∏–π –ø–æ SL
- ‚úÖ –£–ª—É—á—à–µ–Ω–∏–µ winrate –Ω–∞ 10-20%

---

## üîç –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –ó–ê–ú–ï–ß–ê–ù–ò–Ø

### 1. SL –±—ã–ª —Å–ª–∏—à–∫–æ–º —É–∑–∫–∏–º

**–ò–∑ JSON:**
- `sl_percent: 0.6` (0.6%)
- `sl_atr_multiplier: 2.0` (–∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞)
- `sl_min_percent: 0.6` (–∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞)

**–ü—Ä–æ–±–ª–µ–º–∞:** SL = 0.6% —Å–ª–∏—à–∫–æ–º —É–∑–∫–∏–π –¥–ª—è ETH-USDT –≤ RANGING —Ä–µ–∂–∏–º–µ. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —É–≤–µ–ª–∏—á–∏—Ç—å –¥–æ 0.8-1.0%.

### 2. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ —É–¥–µ—Ä–∂–∞–Ω–∏—è –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –ø–æ SL

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ —É–¥–µ—Ä–∂–∞–Ω–∏—è –≤ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –∑–∞–∫—Ä—ã—Ç–∏–∏ –ø–æ SL:

```python
logger.warning(
    f"üõë ExitAnalyzer RANGING: SL –¥–æ—Å—Ç–∏–≥–Ω—É—Ç –¥–ª—è {symbol}: "
    f"Gross PnL {gross_pnl_percent:.2f}% <= SL threshold {sl_threshold:.2f}% "
    f"(SL={sl_percent:.2f}% + spread_buffer={spread_buffer:.4f}%), "
    f"Net PnL={net_pnl_percent:.2f}% (—Å –∫–æ–º–∏—Å—Å–∏–µ–π), —Ä–µ–∂–∏–º={regime}, "
    f"–≤—Ä–µ–º—è —É–¥–µ—Ä–∂–∞–Ω–∏—è={minutes_in_position:.1f} –º–∏–Ω"
)
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ min_holding_minutes –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–π

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –°–æ–∑–¥–∞—Ç—å —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ `_check_min_holding_before_close()`, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –∑–∞–∫—Ä—ã—Ç–∏–π (SL, TP, emergency, etc.).

---

## ‚úÖ –ò–¢–û–ì–û–í–ê–Ø –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–Ø

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞:** ‚ùå **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ `min_holding_minutes` –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º –ø–æ SL –≤ RANGING —Ä–µ–∂–∏–º–µ**

**–†–µ—à–µ–Ω–∏–µ:**
1. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ `_get_min_holding_minutes()`
2. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É `min_holding_minutes` –ø–µ—Ä–µ–¥ SL –≤ `_analyze_ranging()`
3. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å `min_holding_minutes: 1.0` –≤ –∫–æ–Ω—Ñ–∏–≥ –¥–ª—è RANGING —Ä–µ–∂–∏–º–∞
4. ‚úÖ –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è TRENDING –∏ CHOPPY —Ä–µ–∂–∏–º–æ–≤

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ **–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô** (–Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ)

**–í—Ä–µ–º—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:** 1-2 —á–∞—Å–∞

**–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç:** –°–Ω–∏–∂–µ–Ω–∏–µ –ø—Ä–µ–∂–¥–µ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–∫—Ä—ã—Ç–∏–π –ø–æ SL –Ω–∞ 30-50%, —É–ª—É—á—à–µ–Ω–∏–µ winrate –Ω–∞ 10-20%

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 29.12.2025  
**–°—Ç–∞—Ç—É—Å:** –¢—Ä–µ–±—É–µ—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è



