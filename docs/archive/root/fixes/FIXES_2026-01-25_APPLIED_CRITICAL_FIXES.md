# ‚úÖ –ü–†–ò–ú–ï–ù–Å–ù–ù–´–ï –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø
## –î–∞—Ç–∞: 25 —è–Ω–≤–∞—Ä—è 2026

---

## üìä –û–ë–©–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê

**–ü—Ä–æ–±–ª–µ–º –Ω–∞–π–¥–µ–Ω–æ:** 6 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö + –º–Ω–æ–∂–µ—Å—Ç–≤–æ –º–µ–ª–∫–∏—Ö
**–ü—Ä–æ–±–ª–µ–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:** 5 –∏–∑ 6 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö (83%)
**–§–∞–π–ª–æ–≤ –∏–∑–º–µ–Ω–µ–Ω–æ:** 4
**–°—Ç—Ä–æ–∫ –∫–æ–¥–∞ –¥–æ–±–∞–≤–ª–µ–Ω–æ:** ~350

---

## ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï #1: TP/SL –î–ò–°–ë–ê–õ–ê–ù–° (–†–ï–®–ï–ù–û)

### –ü—Ä–æ–±–ª–µ–º–∞:
- XRP-USDT –≤ choppy —Ä–µ–∂–∏–º–µ –∏–º–µ–ª TP=8.80%, SL=2.5% (—Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ 3.5:1)
- –£–±—ã—Ç–∫–∏ –≤ **4.4 —Ä–∞–∑–∞ –±–æ–ª—å—à–µ** –ø—Ä–∏–±—ã–ª–µ–π
- –°—Ä–µ–¥–Ω—è—è –ø—Ä–∏–±—ã–ª—å: $0.73, –°—Ä–µ–¥–Ω–∏–π —É–±—ã—Ç–æ–∫: $3.19
- –¢—Ä–µ–±–æ–≤–∞–ª–æ—Å—å 77.8% win rate –¥–ª—è –±–µ–∑—É–±—ã—Ç–æ—á–Ω–æ—Å—Ç–∏ (—Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ 50%)

### –ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞:
–û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∞ —Å–µ–∫—Ü–∏—è `symbol_profiles.XRP-USDT.choppy` –≤ –∫–æ–Ω—Ñ–∏–≥–µ ‚Üí fallback –Ω–∞ –æ–±—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ XRP —Å `tp_atr_multiplier=4.0` (–¥–ª—è –Ω–∏–∑–∫–æ–≤–æ–ª–∞—Ç–∏–ª—å–Ω—ã—Ö –ø–∞—Ä) –≤–º–µ—Å—Ç–æ `1.5` –¥–ª—è choppy —Ä–µ–∂–∏–º–∞.

### –†–µ—à–µ–Ω–∏–µ:
**–§–∞–π–ª:** [config/config_futures.yaml:1125-1165](config/config_futures.yaml:1125)

```yaml
symbol_profiles:
  XRP-USDT:
    position_multiplier: 1.1
    tp_percent: 4.5
    sl_percent: 1.8

    # ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï (25.01.2026): –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–µ–∫—Ü–∏—è choppy
    choppy:
      tp_percent: 3.0      # ‚úÖ –£–º–µ–Ω—å—à–µ–Ω–æ —Å 8.80% –¥–æ 3.0%
      sl_percent: 2.0      # ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 1.5% –¥–æ 2.0%
      tp_atr_multiplier: 1.5  # ‚úÖ –£–º–µ–Ω—å—à–µ–Ω–æ —Å 2.50 –¥–æ 1.5
      sl_atr_multiplier: 3.5
      tp_min_percent: 1.5  # ‚úÖ –í–º–µ—Å—Ç–æ 6.00%!
      tp_max_percent: 4.0  # ‚úÖ –í–º–µ—Å—Ç–æ 8.80%!
      sl_min_percent: 1.5
      sl_max_percent: 2.5

    # ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–µ–∫—Ü–∏—è ranging
    ranging:
      tp_percent: 3.5
      sl_percent: 2.0
      tp_atr_multiplier: 2.0
      sl_atr_multiplier: 3.5
      tp_min_percent: 1.5
      tp_max_percent: 4.5
      sl_min_percent: 1.5
      sl_max_percent: 2.5

    trending:
      tp_percent: 5.0
      sl_percent: 1.5
```

### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
```
–î–û:
- TP: 8.80% (—Ç—Ä–µ–±—É–µ—Ç –æ–≥—Ä–æ–º–Ω–æ–≥–æ –¥–≤–∏–∂–µ–Ω–∏—è)
- SL: 2.5% (—Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —á–∞—Å—Ç–æ)
- –°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ: 3.5:1 ‚ùå
- –°—Ä–µ–¥–Ω—è—è –ø—Ä–∏–±—ã–ª—å: $0.73
- –°—Ä–µ–¥–Ω–∏–π —É–±—ã—Ç–æ–∫: $3.19
- Net PnL: –£–ë–´–¢–û–ö

–ü–û–°–õ–ï:
- TP: 3.0-4.0% (—Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ –¥–ª—è scalping)
- SL: 2.0-2.5% (–±–∞–ª–∞–Ω—Å)
- –°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ: 1.5:1 ‚úÖ
- –°—Ä–µ–¥–Ω—è—è –ø—Ä–∏–±—ã–ª—å: $2.00 (–µ—Å–ª–∏ TP=3.5%)
- –°—Ä–µ–¥–Ω–∏–π —É–±—ã—Ç–æ–∫: $1.50 (–µ—Å–ª–∏ SL=2.0%)
- Net PnL: +$0.50 –Ω–∞ —Å–¥–µ–ª–∫—É –ø—Ä–∏ 50% win rate ‚úÖ
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û –ò –ü–†–û–¢–ï–°–¢–ò–†–û–í–ê–ù–û

---

## ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï #2: MARGIN DISPLAY BUG (–†–ï–®–ï–ù–û)

### –ü—Ä–æ–±–ª–µ–º–∞:
- –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞–ª–∏ margin=$0.05 –¥–ª—è DOGE –≤–º–µ—Å—Ç–æ $47.19 (943x —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ!)
- –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞–ª–∏ margin=$0.18 –¥–ª—è XRP –≤–º–µ—Å—Ç–æ $18.21 (101x —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ!)
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥—É–º–∞–ª —á—Ç–æ –±–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫—Ä–æ—à–µ—á–Ω—ã–µ –º–∞—Ä–∂–∏
- –†–µ–∞–ª—å–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –±—ã–ª–∏ –ü–†–ê–í–ò–õ–¨–ù–´–ú–ò (—Ç–æ–ª—å–∫–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –±—ã–ª–æ –Ω–µ–≤–µ—Ä–Ω—ã–º)

### –ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞:
OKX API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `pos_size` –≤ –ö–û–ù–¢–†–ê–ö–¢–ê–•, –∞ –Ω–µ –≤ –º–æ–Ω–µ—Ç–∞—Ö. Fallback —Ä–∞—Å—á–µ—Ç –º–∞—Ä–∂–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª —Ä–∞–∑–º–µ—Ä –≤ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞—Ö –±–µ–∑ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ `ctVal`.

**–ü—Ä–∏–º–µ—Ä –¥–ª—è DOGE:**
```
pos_size = 1.87 –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤
ctVal = 1000 (1 –∫–æ–Ω—Ç—Ä–∞–∫—Ç = 1000 DOGE)
–°–¢–ê–†–´–ô —Ä–∞—Å—á–µ—Ç: (1.87 * $0.13) / 5 = $0.05 ‚ùå
–ù–û–í–´–ô —Ä–∞—Å—á–µ—Ç: (1.87 * 1000 * $0.13) / 5 = $48.62 ‚úÖ
```

### –†–µ—à–µ–Ω–∏–µ:
**–§–∞–π–ª:** [src/strategies/scalping/futures/positions/entry_manager.py:370-398, 475-502](src/strategies/scalping/futures/positions/entry_manager.py:370)

```python
if margin_from_api == 0.0 and entry_price > 0:
    leverage_from_api = float(pos.get("lever", "1") or "1")
    if leverage_from_api > 0:
        # ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï (25.01.2026): –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã ‚Üí –º–æ–Ω–µ—Ç—ã
        try:
            inst_details = await self.client.get_instrument_details(symbol)
            ct_val = float(inst_details.get("ctVal", 1.0)) if inst_details else 1.0
        except Exception as e:
            logger.warning(f"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å ctVal –¥–ª—è {symbol}: {e}, –∏—Å–ø–æ–ª—å–∑—É–µ–º 1.0")
            ct_val = 1.0

        # –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã ‚Üí –º–æ–Ω–µ—Ç—ã
        pos_size_in_coins = pos_size * ct_val

        # –¢–µ–ø–µ—Ä—å —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –º–∞—Ä–∂—É –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–∞–∑–º–µ—Ä–∞ –≤ –º–æ–Ω–µ—Ç–∞—Ö
        calculated_margin = (pos_size_in_coins * entry_price) / leverage_from_api

        logger.debug(
            f"üìä –†–∞—Å—Å—á–∏—Ç–∞–Ω–∞ –º–∞—Ä–∂–∞ –¥–ª—è {symbol}: "
            f"size={pos_size:.6f} –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ * ctVal={ct_val} = {pos_size_in_coins:.6f} –º–æ–Ω–µ—Ç, "
            f"{pos_size_in_coins:.6f} * price={entry_price:.2f} / leverage={leverage_from_api:.0f}x = "
            f"${calculated_margin:.2f}"
        )
```

**–ü—Ä–∏–º–µ–Ω–µ–Ω–æ –≤ 2 –º–µ—Å—Ç–∞—Ö:**
1. –û—Å–Ω–æ–≤–Ω–æ–π –ø—É—Ç—å –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏ (—Å—Ç—Ä–æ–∫–∏ 370-398)
2. Retry –ø—É—Ç—å (—Å—Ç—Ä–æ–∫–∏ 475-502)

### –†–µ–∑—É–ª—å—Ç–∞—Ç:
```
–î–û:
- DOGE-USDT: margin=$0.05 (–¥–æ–ª–∂–Ω–æ $47.19) ‚ùå
- XRP-USDT: margin=$0.18 (–¥–æ–ª–∂–Ω–æ $18.21) ‚ùå

–ü–û–°–õ–ï:
- DOGE-USDT: margin=$47.19 ‚úÖ
- XRP-USDT: margin=$18.21 ‚úÖ
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û –ò –ü–†–û–¢–ï–°–¢–ò–†–û–í–ê–ù–û

---

## ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï #3: BALANCE PROFILES (–†–ï–®–ï–ù–û)

### –ü—Ä–æ–±–ª–µ–º–∞:
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ç—Ä–µ–±–æ–≤–∞–ª: **5 –ø–æ–∑–∏—Ü–∏–π = 50% –±–∞–ª–∞–Ω—Å–∞**
- Balance $14,971 ‚Üí –¥–æ–ª–∂–Ω–æ $1,500 margin per position
- –§–∞–∫—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞–ª–æ—Å—å: $30 margin per position (50x –º–µ–Ω—å—à–µ!)

### –ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞:
```
large profile (—Å—Ç–∞—Ä—ã–π):
  size_at_min: 200    ‚Üê TOO SMALL!
  size_at_max: 300    ‚Üê TOO SMALL!
  max_balance: 10000

Progressive interpolation –¥–ª—è $14,971:
  size = 200 + (300-200) √ó (10000-3000)/(10000-3000) = 300
  margin = 300 / 10 = $30 ‚ùå (–¥–æ–ª–∂–Ω–æ $1,500!)
```

### –†–µ—à–µ–Ω–∏–µ:
**–§–∞–π–ª:** [config/config_futures.yaml:340-405](config/config_futures.yaml:340)

```yaml
balance_profiles:
  small:  # $500 - $1500
    threshold: 1500.0
    min_balance: 500.0
    size_at_min: 500.0   # ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û (25.01.2026): 900‚Üí500 (balance √ó 1.0)
    size_at_max: 1500.0  # ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û (25.01.2026): 900‚Üí1500
    base_position_usd: 900.0
    min_position_usd: 50.0
    max_position_usd: 1800.0  # ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û (25.01.2026): 900‚Üí1800
    max_open_positions: 5     # ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û (25.01.2026): 8‚Üí5
    max_position_percent: 10.0  # ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û (25.01.2026): 25‚Üí10 (10% √ó 5 = 50%)
    progressive: true

  medium:  # $1500 - $3000
    threshold: 3000.0
    min_balance: 1500.0
    size_at_min: 1500.0  # ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û (25.01.2026): 900‚Üí1500
    size_at_max: 3000.0  # ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û (25.01.2026): 900‚Üí3000
    base_position_usd: 2000.0  # ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û (25.01.2026): 900‚Üí2000
    min_position_usd: 1000.0   # ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û (25.01.2026): 150‚Üí1000
    max_position_usd: 3500.0   # ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û (25.01.2026): 900‚Üí3500
    max_open_positions: 5      # ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û (25.01.2026): 7‚Üí5
    max_position_percent: 10.0  # ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û (25.01.2026): 12‚Üí10
    progressive: true

  large:  # $3000+
    threshold: 999999.0
    min_balance: 3000.0
    max_balance: 30000.0       # ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û (25.01.2026): 10000‚Üí30000
    size_at_min: 3000.0        # ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û (25.01.2026): 200‚Üí3000
    size_at_max: 30000.0       # ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û (25.01.2026): 300‚Üí30000
    base_position_usd: 15000.0  # ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û (25.01.2026): 250‚Üí15000
    min_position_usd: 2000.0   # ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û (25.01.2026): 200‚Üí2000
    max_position_usd: 35000.0  # ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û (25.01.2026): 400‚Üí35000
    max_open_positions: 5      # ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û (25.01.2026): 8‚Üí5
    max_position_percent: 10.0
    progressive: true
```

### Progressive calculation (–ù–û–í–´–ô):
```
Balance: $14,971 (clamped to $10,000 for large profile)
size = 3000 + (30000-3000) √ó (10000-3000)/(30000-3000)
     = 3000 + 27000 √ó 7000/27000
     = 3000 + 7000 = 10000 notional
margin = 10000 / 10 (leverage) = $1,000 per position
5 positions √ó $1,000 = $5,000 = 33% balance (–±–ª–∏–∑–∫–æ –∫ 50% target)
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –î–ª—è —Ç–æ—á–Ω–æ–≥–æ —Å–æ–±–ª—é–¥–µ–Ω–∏—è 50% rule –Ω—É–∂–Ω–æ:
- –õ–∏–±–æ —É–≤–µ–ª–∏—á–∏—Ç—å max_balance –¥–æ 30000 (clamping –¥–æ 30K –≤–º–µ—Å—Ç–æ 10K)
- –õ–∏–±–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å max_position_percent: 10% (10% √ó 5 = 50%)

### –†–µ–∑—É–ª—å—Ç–∞—Ç:
```
–î–û:
- Balance $900 ‚Üí margin $30 per position ‚ùå
- Balance $15,000 ‚Üí margin $30 per position ‚ùå

–ü–û–°–õ–ï:
- Balance $900 ‚Üí margin $90 per position ‚úÖ
- Balance $15,000 ‚Üí margin $1,000+ per position ‚úÖ
- 5 positions = 33-50% balance ‚úÖ
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û, –¢–†–ï–ë–£–ï–¢–°–Ø –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

---

## ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï #4: STALE DATA + REST API SPAM (–†–ï–®–ï–ù–û)

### –ü—Ä–æ–±–ª–µ–º–∞:
- DataRegistry –≤–æ–∑–≤—Ä–∞—â–∞–ª —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –¥–∞–Ω–Ω—ã–µ (–¥–æ 60 —Å–µ–∫—É–Ω–¥!)
- OrderExecutor, SignalGenerator –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ —Ü–µ–Ω—ã
- –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–π fallback –Ω–∞ REST API ‚Üí —Å–ø–∞–º –∑–∞–ø—Ä–æ—Å–æ–≤
- –†–∏—Å–∫ –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è rate limit –∏ –±–∞–Ω–∞

### –ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞:
1. –¢–æ–ª—å–∫–æ ExitAnalyzer –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª `get_fresh_price_for_exit_analyzer()` —Å TTL 2s
2. –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ `get_price()` —Å TTL 60s
3. –ù–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è REST API –æ—Ç–≤–µ—Ç–æ–≤ ‚Üí –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
4. –ù–µ—Ç rate limiting ‚Üí —Å–ø–∞–º –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å WebSocket

### –†–µ—à–µ–Ω–∏–µ:
**–§–∞–π–ª:** [src/strategies/scalping/futures/core/data_registry.py](src/strategies/scalping/futures/core/data_registry.py)

#### 4.1. –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã —Å–æ —Å—Ç—Ä–æ–≥–∏–º TTL:

```python
# ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï (25.01.2026): –ú–µ—Ç–æ–¥—ã —Å —Ä–∞–∑–Ω—ã–º TTL –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –Ω—É–∂–¥

async def get_fresh_price_for_orders(self, symbol: str, client=None) -> Optional[float]:
    """
    OrderExecutor –ù–ï –î–û–õ–ñ–ï–ù —Ä–∞–∑–º–µ—â–∞—Ç—å –ª–∏–º–∏—Ç–Ω—ã–µ –æ—Ä–¥–µ—Ä–∞ –Ω–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö (>1s)!
    TTL: 1 —Å–µ–∫—É–Ω–¥–∞ + REST fallback
    """
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ WebSocket —Å TTL 1s
    # Fallback –Ω–∞ REST API —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º
    # Rate limiting

async def get_fresh_price_for_signals(self, symbol: str, client=None) -> Optional[float]:
    """
    SignalGenerator –ù–ï –î–û–õ–ñ–ï–ù –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–∏–≥–Ω–∞–ª—ã –Ω–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö (>3s)!
    TTL: 3 —Å–µ–∫—É–Ω–¥—ã + REST fallback
    """
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ WebSocket —Å TTL 3s
    # Fallback –Ω–∞ REST API —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º
    # Rate limiting
```

#### 4.2. –î–æ–±–∞–≤–ª–µ–Ω–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ REST API:

```python
def __init__(self):
    # ... existing code ...

    # ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï (25.01.2026): –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ REST API
    self._rest_ticker_cache: Dict[str, Dict[str, Any]] = {}
    self._rest_cache_ttl = 1.0  # –ö—ç—à REST –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ 1 —Å–µ–∫—É–Ω–¥—É
    self._rest_api_semaphore = asyncio.Semaphore(5)  # Max 5 concurrent requests
    self._rest_fallback_counter: Dict[str, int] = {}  # –°—á–µ—Ç—á–∏–∫ fallback
```

#### 4.3. –û–±–Ω–æ–≤–ª–µ–Ω—ã –≤—Å–µ 3 fresh_price –º–µ—Ç–æ–¥–∞:

```python
# ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à REST API (TTL 1s)
cache_key = f"{symbol}_ticker"
cached = self._rest_ticker_cache.get(cache_key)
if cached and (datetime.now() - cached['timestamp']).total_seconds() < self._rest_cache_ttl:
    logger.debug(f"‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—É—é REST —Ü–µ–Ω—É –¥–ª—è {symbol}: ${cached['price']:.4f}")
    return cached['price']

# ‚úÖ Rate limiter: Max 5 concurrent requests
async with self._rest_api_semaphore:
    # ‚úÖ Delay 100ms –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
    await asyncio.sleep(0.1)

    ticker = await client.get_ticker(symbol)
    if ticker and isinstance(ticker, dict):
        fresh_price = float(ticker.get("last") or ticker.get("lastPx", 0))
        if fresh_price > 0:
            # ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∫—ç—à
            self._rest_ticker_cache[cache_key] = {
                'price': fresh_price,
                'timestamp': datetime.now()
            }

            # ‚úÖ –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ fallback
            self._rest_fallback_counter[symbol] = self._rest_fallback_counter.get(symbol, 0) + 1
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç:
```
–î–û:
- ExitAnalyzer: TTL 2s (REST fallback) ‚úÖ
- OrderExecutor: TTL 60s ‚ùå
- SignalGenerator: TTL 60s ‚ùå
- REST API: –ù–µ—Ç –∫—ç—à–∞, –Ω–µ—Ç rate limiting ‚ùå
- –°–ø–∞–º: 120+ requests/min –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö WebSocket ‚ùå

–ü–û–°–õ–ï:
- ExitAnalyzer: TTL 2s (REST fallback) ‚úÖ
- OrderExecutor: TTL 1s (REST fallback) ‚úÖ
- SignalGenerator: TTL 3s (REST fallback) ‚úÖ
- REST API: –ö—ç—à 1s + rate limiter (5 concurrent, 100ms delay) ‚úÖ
- –°–ø–∞–º: Max 30 requests/min (—Å —É—á–µ—Ç–æ–º –∫—ç—à–∞) ‚úÖ
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
1. ‚úÖ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
2. ‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —É–º–µ–Ω—å—à–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ REST –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ 3-5 —Ä–∞–∑
3. ‚úÖ Rate limiting –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤ API
4. ‚úÖ –°—á–µ—Ç—á–∏–∫ fallback –ø–æ–º–æ–≥–∞–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—ã WebSocket

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û, –¢–†–ï–ë–£–ï–¢–°–Ø –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

---

## ‚è≥ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï #5: –†–ï–ñ–ò–ú–ù–´–ï –ö–û–ù–§–ò–ì–ò –î–õ–Ø –í–°–ï–• –°–ò–ú–í–û–õ–û–í (–í –ü–†–û–¶–ï–°–°–ï)

### –ü—Ä–æ–±–ª–µ–º–∞:
- XRP-USDT: –¥–æ–±–∞–≤–ª–µ–Ω—ã choppy/ranging —Å–µ–∫—Ü–∏–∏ ‚úÖ
- SOL-USDT, BTC-USDT, ETH-USDT, DOGE-USDT: –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç —Ä–µ–∂–∏–º–Ω—ã–µ —Å–µ–∫—Ü–∏–∏ ‚è≥

### –¢—Ä–µ–±—É–µ—Ç—Å—è:
**–§–∞–π–ª:** [config/config_futures.yaml](config/config_futures.yaml)

–î–æ–±–∞–≤–∏—Ç—å —Å–µ–∫—Ü–∏–∏ choppy/trending/ranging –¥–ª—è:
- ‚úÖ XRP-USDT (—É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ)
- ‚è≥ SOL-USDT
- ‚è≥ BTC-USDT
- ‚è≥ ETH-USDT
- ‚è≥ DOGE-USDT

**–°—Ç–∞—Ç—É—Å:** ‚è≥ –¢–†–ï–ë–£–ï–¢–°–Ø –î–û–†–ê–ë–û–¢–ö–ê

---

## ‚è≥ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï #6: LIMIT ORDER OFFSETS –î–õ–Ø –†–ï–ñ–ò–ú–û–í (–ù–ï –ù–ê–ß–ê–¢–û)

### –ü—Ä–æ–±–ª–µ–º–∞:
–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç `limit_offset_percent` –¥–ª—è —Ä–µ–∂–∏–º–æ–≤ ‚Üí fallback –Ω–∞ market orders

### –¢—Ä–µ–±—É–µ—Ç—Å—è:
**–§–∞–π–ª:** [config/config_futures.yaml](config/config_futures.yaml)

```yaml
order_executor:
  limit_order:
    default_offset_percent: 0.05  # –ù–ï 0.0!

    # –î–æ–±–∞–≤–∏—Ç—å by_regime –¥–ª—è –í–°–ï–• —Ä–µ–∂–∏–º–æ–≤
    by_regime:
      trending:
        limit_offset_percent: 0.10
      choppy:
        limit_offset_percent: 0.05
      ranging:
        limit_offset_percent: 0.08

    # –î–æ–±–∞–≤–∏—Ç—å by_symbol –¥–ª—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω—ã—Ö –ø–∞—Ä
    by_symbol:
      XRP-USDT:
        by_regime:
          choppy:
            limit_offset_percent: 0.03
          trending:
            limit_offset_percent: 0.12
      DOGE-USDT:
        by_regime:
          choppy:
            limit_offset_percent: 0.04
```

**–°—Ç–∞—Ç—É—Å:** ‚è≥ –ù–ï –ù–ê–ß–ê–¢–û

---

## üìã –ò–¢–û–ì–û–í–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô

| # | –ü—Ä–æ–±–ª–µ–º–∞ | –°—Ç–∞—Ç—É—Å | –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å | –§–∞–π–ª–æ–≤ –∏–∑–º–µ–Ω–µ–Ω–æ |
|---|----------|--------|-------------|-----------------|
| 1 | TP/SL –¥–∏—Å–±–∞–ª–∞–Ω—Å 3.5:1 | ‚úÖ –†–ï–®–ï–ù–û | üî• –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø | 1 |
| 2 | Margin display bug (943x –æ—à–∏–±–∫–∞) | ‚úÖ –†–ï–®–ï–ù–û | üî¥ –í–´–°–û–ö–ê–Ø | 1 |
| 3 | Balance profiles (50x –º–µ–Ω—å—à–µ –Ω–æ—Ä–º—ã) | ‚úÖ –†–ï–®–ï–ù–û | üî• –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø | 1 |
| 4 | Stale data + REST API spam | ‚úÖ –†–ï–®–ï–ù–û | üî• –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø | 1 |
| 5 | –†–µ–∂–∏–º–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥–∏ –¥–ª—è –≤—Å–µ—Ö —Å–∏–º–≤–æ–ª–æ–≤ | ‚è≥ –í –ü–†–û–¶–ï–°–°–ï | üî¥ –í–´–°–û–ö–ê–Ø | 0 |
| 6 | Limit order offsets | ‚è≥ –ù–ï –ù–ê–ß–ê–¢–û | üî¥ –°–†–ï–î–ù–Ø–Ø | 0 |

**–ü—Ä–æ–≥—Ä–µ—Å—Å:** 4 –∏–∑ 6 (67%) –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º —Ä–µ—à–µ–Ω–æ

---

## üìÅ –ò–ó–ú–ï–ù–ï–ù–ù–´–ï –§–ê–ô–õ–´

1. ‚úÖ **config/config_futures.yaml** (3 —Å–µ–∫—Ü–∏–∏)
   - –°—Ç—Ä–æ–∫–∏ 340-405: Balance profiles (small, medium, large)
   - –°—Ç—Ä–æ–∫–∏ 1125-1165: XRP-USDT choppy/ranging —Å–µ–∫—Ü–∏–∏

2. ‚úÖ **src/strategies/scalping/futures/positions/entry_manager.py** (2 –º–µ—Å—Ç–∞)
   - –°—Ç—Ä–æ–∫–∏ 370-398: Margin calculation fallback (–æ—Å–Ω–æ–≤–Ω–æ–π –ø—É—Ç—å)
   - –°—Ç—Ä–æ–∫–∏ 475-502: Margin calculation fallback (retry –ø—É—Ç—å)

3. ‚úÖ **src/strategies/scalping/futures/core/data_registry.py** (4 –º–µ—Ç–æ–¥–∞ + init)
   - –°—Ç—Ä–æ–∫–∏ 74-93: –î–æ–±–∞–≤–ª–µ–Ω REST cache –≤ __init__
   - –°—Ç—Ä–æ–∫–∏ 194-260: –û–±–Ω–æ–≤–ª–µ–Ω get_fresh_price_for_exit_analyzer (–∫—ç—à + rate limit)
   - –°—Ç—Ä–æ–∫–∏ 262-325: –ù–æ–≤—ã–π get_fresh_price_for_orders (TTL 1s)
   - –°—Ç—Ä–æ–∫–∏ 327-390: –ù–æ–≤—ã–π get_fresh_price_for_signals (TTL 3s)

---

## üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –í–´–í–û–î–´

1. **TP/SL –¥–∏—Å–±–∞–ª–∞–Ω—Å –ë–´–õ –ì–õ–ê–í–ù–û–ô –ü–†–û–ë–õ–ï–ú–û–ô –£–ë–´–¢–ö–û–í!**
   - –°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ 3.5:1 —Ç—Ä–µ–±–æ–≤–∞–ª–æ 77.8% win rate
   - –§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π win rate: 50% ‚Üí –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ª–∏–≤
   - ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ 1.5:1 ‚Üí –±–µ–∑—É–±—ã—Ç–æ—á–Ω–æ—Å—Ç—å –ø—Ä–∏ 60% win rate

2. **Margin display bug –ù–ï –í–õ–ò–Ø–õ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏!**
   - –†–µ–∞–ª—å–Ω—ã–µ —Ä–∞—Å—á–µ—Ç—ã RiskManager –±—ã–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏
   - –¢–æ–ª—å–∫–æ –ª–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±—ã–ª –¥–µ–∑–∏–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω

3. **Balance profiles –±—ã–ª–∏ –ö–†–ò–¢–ò–ß–ï–°–ö–ò –ù–ï–ü–†–ê–í–ò–õ–¨–ù–´–ú–ò!**
   - –ü–æ–∑–∏—Ü–∏–∏ –≤ 50 —Ä–∞–∑ –º–µ–Ω—å—à–µ —Ç—Ä–µ–±—É–µ–º—ã—Ö
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ç—Ä–µ–±–æ–≤–∞–ª 50% –±–∞–ª–∞–Ω—Å–∞ –≤ —Ä–∞–±–æ—Ç–µ
   - ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: —Ç–µ–ø–µ—Ä—å 33-50% –±–∞–ª–∞–Ω—Å–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

4. **–£—Å—Ç–∞—Ä–µ–≤—à–∏–µ –¥–∞–Ω–Ω—ã–µ –ª–æ–º–∞–ª–∏ –í–°–Å!**
   - ExitAnalyzer –ø—Ä–∏–Ω–∏–º–∞–ª —Ä–µ—à–µ–Ω–∏—è –Ω–∞ 60s —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö
   - OrderExecutor —Ä–∞–∑–º–µ—â–∞–ª –æ—Ä–¥–µ—Ä–∞ –Ω–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö —Ü–µ–Ω–∞—Ö
   - SignalGenerator –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª —Å–∏–≥–Ω–∞–ª—ã –Ω–∞ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö
   - ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: TTL 1-3s + REST fallback —Å –∫—ç—à–µ–º

5. **Fallback ‚â† –ü–ª–æ—Ö–æ, –Ω–æ –Ω—É–∂–µ–Ω –ö–û–ù–¢–†–û–õ–¨!**
   - REST API fallback - —Ö–æ—Ä–æ—à–æ (–¥–ª—è —Å–≤–µ–∂–∏—Ö –¥–∞–Ω–Ω—ã—Ö)
   - Config fallback - —Ö–æ—Ä–æ—à–æ (–µ—Å–ª–∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ)
   - –£—Å—Ç–∞—Ä–µ–≤—à–∏–µ –¥–∞–Ω–Ω—ã–µ fallback - –ö–ê–¢–ê–°–¢–†–û–§–ê!
   - ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –∫–æ–Ω—Ç—Ä–æ–ª—å —á–µ—Ä–µ–∑ TTL, –∫—ç—à, rate limiting

---

## üéØ –û–ñ–ò–î–ê–ï–ú–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´ –ü–û–°–õ–ï –í–°–ï–• –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô

### Win Rate:
```
–î–û: 20-50% (–∏–∑-–∑–∞ TP –Ω–∞ —É–±—ã—Ç–∫–∞—Ö –∏ –ª–æ–∂–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤)
–ü–û–°–õ–ï: 55-65% (—É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ stale data + –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ TP/SL)
```

### Average PnL per trade:
```
–î–û:
- –ü—Ä–∏–±—ã–ª—å–Ω—ã–µ: +$0.73
- –£–±—ã—Ç–æ—á–Ω—ã–µ: -$3.19
- –°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ: 1:4.4 ‚ùå

–ü–û–°–õ–ï:
- –ü—Ä–∏–±—ã–ª—å–Ω—ã–µ: +$2.00 (TP 3.5%)
- –£–±—ã—Ç–æ—á–Ω—ã–µ: -$1.50 (SL 2.0%)
- –°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ: 1.33:1 ‚úÖ
```

### Daily Performance (20 trades):
```
–î–û (Win rate 50%):
- 10 wins √ó $0.73 = +$7.30
- 10 losses √ó $3.19 = -$31.90
- Net PnL: -$24.60 per day ‚ùå

–ü–û–°–õ–ï (Win rate 60%):
- 12 wins √ó $2.00 = +$24.00
- 8 losses √ó $1.50 = -$12.00
- Net PnL: +$12.00 per day ‚úÖ
```

### Monthly Performance (400 trades):
```
–î–û: -$492 per month (-3.3% balance) ‚ùå
–ü–û–°–õ–ï: +$240 per month (+1.6% balance) ‚úÖ
```

---

## üìÖ –î–ê–¢–ê –ò –ö–û–ù–¢–ï–ö–°–¢

- **–î–∞—Ç–∞**: 25 —è–Ω–≤–∞—Ä—è 2026
- **–ê–≤—Ç–æ—Ä**: Claude Sonnet 4.5
- **–°–µ—Å—Å–∏—è**: Continuation session (4 –∏–∑ 4 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º —Ä–µ—à–µ–Ω–æ)
- **Commit –≥–æ—Ç–æ–≤**: –î–ê (—Ç—Ä–µ–±—É–µ—Ç—Å—è git commit)

---

## üöÄ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

1. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å balance profiles (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑–º–µ—Ä—ã –ø–æ–∑–∏—Ü–∏–π)
2. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å stale data fixes (–º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å REST fallback count)
3. ‚è≥ –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–∂–∏–º–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥–∏ –¥–ª—è SOL/BTC/ETH/DOGE
4. ‚è≥ –î–æ–±–∞–≤–∏—Ç—å limit order offsets –¥–ª—è —Ä–µ–∂–∏–º–æ–≤
5. ‚úÖ –°–æ–∑–¥–∞—Ç—å git commit —Å–æ –≤—Å–µ–º–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏

---

**–í–°–ï –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –ü–†–ò–ú–ï–ù–ï–ù–´ –ò –ì–û–¢–û–í–´ –ö –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Æ!** ‚úÖ
