# üîç –ê–ù–ê–õ–ò–ó –ë–õ–û–ö–ò–†–û–í–ö–ò –ò–°–ü–û–õ–ù–ï–ù–ò–Ø –°–ò–ì–ù–ê–õ–û–í

**–î–∞—Ç–∞:** 2025-12-07  
**–ü—Ä–æ–±–ª–µ–º–∞:** –í—Å–µ —Å–∏–≥–Ω–∞–ª—ã –∏–º–µ—é—Ç `executed=0` –≤ `signals.csv`, —Ö–æ—Ç—è —Ñ–∏–ª—å—Ç—Ä—ã –ø—Ä–æ–π–¥–µ–Ω—ã

---

## ‚úÖ –ù–ê–ô–î–ï–ù–ê –ü–†–ò–ß–ò–ù–ê

### –ü—Ä–æ–±–ª–µ–º–∞ #1: `process_signals` –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è

**–§–∞–π–ª:** `src/strategies/scalping/futures/coordinators/signal_coordinator.py`  
**–°—Ç—Ä–æ–∫–∏:** 127-136

```python
async def process_signals(self, signals: List[Dict[str, Any]]):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ—Ä–≥–æ–≤—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤"""
    try:
        # üîÑ –ù–û–í–û–ï: –æ—Ç–∫–ª—é—á–∞–µ–º legacy-–æ–±—Ä–∞–±–æ—Ç–∫—É, —á—Ç–æ–±—ã –Ω–µ –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã,
        # –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏—Ö–æ–¥—è—Ç –∏–∑ WebSocket (_check_for_signals)
        if not getattr(self.scalping_config, "use_legacy_signal_processing", False):
            logger.debug(
                "‚è≠Ô∏è Legacy process_signals –ø—Ä–æ–ø—É—â–µ–Ω (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è realtime –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤ —á–µ—Ä–µ–∑ WebSocket)."
            )
            return  # ‚ùå –í–°–ï –°–ò–ì–ù–ê–õ–´ –ü–†–û–ü–£–°–ö–ê–Æ–¢–°–Ø –ó–î–ï–°–¨!
```

**–í—ã–≤–æ–¥:** –ï—Å–ª–∏ `use_legacy_signal_processing=False` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é), —Ç–æ `process_signals` —Å—Ä–∞–∑—É –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∏ —Å–∏–≥–Ω–∞–ª—ã –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è.

---

### –ü—Ä–æ–±–ª–µ–º–∞ #2: –°–∏–≥–Ω–∞–ª—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `check_for_signals` (WebSocket)

**–§–∞–π–ª:** `src/strategies/scalping/futures/coordinators/signal_coordinator.py`  
**–°—Ç—Ä–æ–∫–∏:** 782-1260

–°–∏–≥–Ω–∞–ª—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –≤ –º–µ—Ç–æ–¥–µ `check_for_signals`, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑ WebSocket. –ù–æ –µ—Å—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–æ –ø—Ä–æ–≤–µ—Ä–æ–∫, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ:

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö –æ—Ä–¥–µ—Ä–æ–≤ (—Å—Ç—Ä–æ–∫–∏ 816-901):**
   - –ï—Å–ª–∏ –µ—Å—Ç—å pending –æ—Ä–¥–µ—Ä - –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è
   - –ï—Å–ª–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π –æ—Ä–¥–µ—Ä –±—ã–ª < 30 —Å–µ–∫—É–Ω–¥ –Ω–∞–∑–∞–¥ - –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è

2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–∑–∏—Ü–∏–π (—Å—Ç—Ä–æ–∫–∏ 903-1112):**
   - –ï—Å–ª–∏ –ø–æ–∑–∏—Ü–∏—è —É–∂–µ –æ—Ç–∫—Ä—ã—Ç–∞ –∏ `allow_concurrent=false` - –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è
   - –ï—Å–ª–∏ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –ø–æ–∑–∏—Ü–∏–π - –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è
   - –ï—Å–ª–∏ –±–∞–ª–∞–Ω—Å < min_balance_usd - –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è

3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ EV (Expected Value) (—Å—Ç—Ä–æ–∫–∏ 1157-1207):**
   - –ï—Å–ª–∏ `expected_move < total_cost` - —Å–∏–≥–Ω–∞–ª –æ—Ç–º–µ–Ω—è–µ—Ç—Å—è

4. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ—Ä–¥–µ—Ä–∞ (—Å—Ç—Ä–æ–∫–∏ 1222-1232):**
   - –ï—Å–ª–∏ –æ—Ä–¥–µ—Ä –±—ã–ª —Ä–∞–∑–º–µ—â–µ–Ω < 2 —Å–µ–∫—É–Ω–¥ –Ω–∞–∑–∞–¥ - –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è

---

### –ü—Ä–æ–±–ª–µ–º–∞ #3: `executed` –ù–ï –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è

**–§–∞–π–ª:** `src/strategies/scalping/futures/signal_generator.py`  
**–°—Ç—Ä–æ–∫–∏:** 1327-1344

```python
self.performance_tracker.record_signal(
    symbol=signal.get("symbol", ""),
    side=signal.get("side", ""),
    price=signal.get("price", 0.0),
    strength=signal.get("strength", 0.0),
    regime=signal.get("regime"),
    filters_passed=filters_passed,
    executed=False,  # ‚ùå –í–°–ï–ì–î–ê False –ø—Ä–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–∏
    order_id=None,  # ‚ùå –í–°–ï–ì–î–ê None –ø—Ä–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–∏
)
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è —Å–∏–≥–Ω–∞–ª–∞ –ù–ò–ì–î–ï –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ `executed=True` –∏ `order_id`.

---

## üîß –†–ï–®–ï–ù–ò–ï

### 1. –î–æ–±–∞–≤–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ `executed=True` –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è

**–ú–µ—Å—Ç–æ:** –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –æ—Ä–¥–µ—Ä–∞ –≤ `execute_signal_from_price` –∏–ª–∏ `open_position_with_size`

**–ö–æ–¥:**
```python
# –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –æ—Ä–¥–µ—Ä–∞
if result.get("success") and result.get("order_id"):
    # –û–±–Ω–æ–≤–ª—è–µ–º —Å–∏–≥–Ω–∞–ª –≤ CSV
    if self.performance_tracker:
        # –ù—É–∂–Ω–æ –Ω–∞–π—Ç–∏ —Å–∏–≥–Ω–∞–ª –ø–æ timestamp, symbol, side, price
        # –ò –æ–±–Ω–æ–≤–∏—Ç—å executed=True, order_id=result["order_id"]
        await self.performance_tracker.update_signal_execution(
            symbol=symbol,
            side=side,
            price=price,
            order_id=result["order_id"],
            executed=True
        )
```

### 2. –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ `update_signal_execution` –≤ `PerformanceTracker`

**–§–∞–π–ª:** `src/strategies/scalping/spot/performance_tracker.py`

```python
async def update_signal_execution(
    self,
    symbol: str,
    side: str,
    price: float,
    order_id: str,
    executed: bool = True,
    timestamp: Optional[datetime] = None
):
    """–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è —Å–∏–≥–Ω–∞–ª–∞ –≤ CSV"""
    # –ß–∏—Ç–∞–µ–º CSV, –Ω–∞—Ö–æ–¥–∏–º —Å—Ç—Ä–æ–∫—É –ø–æ symbol, side, price, timestamp
    # –û–±–Ω–æ–≤–ª—è–µ–º executed –∏ order_id
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±—Ä–∞—Ç–Ω–æ
```

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞:**
- `"‚è≠Ô∏è Legacy process_signals –ø—Ä–æ–ø—É—â–µ–Ω"` - –µ—Å–ª–∏ —ç—Ç–æ –µ—Å—Ç—å, –∑–Ω–∞—á–∏—Ç `process_signals` –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- `"‚ö†Ô∏è –£–∂–µ –µ—Å—Ç—å X –∞–∫—Ç–∏–≤–Ω—ã—Ö –æ—Ä–¥–µ—Ä–æ–≤"` - –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ –∞–∫—Ç–∏–≤–Ω—ã–º –æ—Ä–¥–µ—Ä–∞–º
- `"‚ö†Ô∏è –ü–æ–∑–∏—Ü–∏—è X —É–∂–µ –æ—Ç–∫—Ä—ã—Ç–∞"` - –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –ø–æ–∑–∏—Ü–∏—è–º
- `"SIGNAL_SKIP X EV_NEGATIVE"` - –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–º—É EV
- `"‚ö†Ô∏è –û—Ä–¥–µ—Ä –¥–ª—è X –±—ã–ª —Ä–∞–∑–º–µ—â–µ–Ω Y —Å–µ–∫—É–Ω–¥ –Ω–∞–∑–∞–¥"` - –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ cooldown

---

## üìä –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

1. **–î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫** - —á—Ç–æ–±—ã –≤–∏–¥–µ—Ç—å, –ø–æ—á–µ–º—É —Å–∏–≥–Ω–∞–ª—ã –Ω–µ –∏—Å–ø–æ–ª–Ω—è—é—Ç—Å—è
2. **–î–æ–±–∞–≤–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ `executed=True`** - —á—Ç–æ–±—ã –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —É—Å–ø–µ—à–Ω—ã–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è
3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥** - –≤–æ–∑–º–æ–∂–Ω–æ, `use_legacy_signal_processing` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `True`
4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–∏–º–∏—Ç—ã** - –≤–æ–∑–º–æ–∂–Ω–æ, `max_positions_per_symbol` –∏–ª–∏ `max_open_positions` —Å–ª–∏—à–∫–æ–º —Å—Ç—Ä–æ–≥–∏–µ

---

**–ì–æ—Ç–æ–≤–æ –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**

