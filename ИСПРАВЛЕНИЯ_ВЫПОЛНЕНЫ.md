# ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –í–´–ü–û–õ–ù–ï–ù–´

**–î–∞—Ç–∞:** 2025-11-19  
**–°—Ç–∞—Ç—É—Å:** –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω—ã

---

## ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï #1: –ó–∞–∫—Ä—ã—Ç–∏–µ —É–±—ã—Ç–æ—á–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π –ø–æ –≤—Ä–µ–º–µ–Ω–∏

**–§–∞–π–ª:** `src/strategies/scalping/futures/orchestrator.py`  
**–°—Ç—Ä–æ–∫–∏:** 6281-6288

**–ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ `if profit_pct <= 0: return` –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º –ø–æ –≤—Ä–µ–º–µ–Ω–∏
- ‚úÖ –£–±—ã—Ç–æ—á–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –±–æ–ª—å—à–µ –ù–ï –±—É–¥—É—Ç –∑–∞–∫—Ä—ã–≤–∞—Ç—å—Å—è –ø–æ –≤—Ä–µ–º–µ–Ω–∏
- ‚úÖ –£–±—ã—Ç–æ—á–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –±—É–¥—É—Ç –∑–∞–∫—Ä—ã–≤–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –ø–æ trailing stop –∏–ª–∏ loss cut

**–ö–æ–¥:**
```python
# ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ù–ï –∑–∞–∫—Ä—ã–≤–∞–µ–º —É–±—ã—Ç–æ—á–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –ø–æ –≤—Ä–µ–º–µ–Ω–∏
if profit_pct <= 0:
    logger.info(
        f"‚è∞ –ü–æ–∑–∏—Ü–∏—è {symbol} —É–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è {time_held:.1f} –º–∏–Ω—É—Ç "
        f"(–ª–∏–º–∏—Ç: {actual_max_holding:.1f} –º–∏–Ω—É—Ç), "
        f"–Ω–æ –ø—Ä–∏–±—ã–ª—å {profit_pct:.2%} <= 0%, "
        f"–ù–ï –∑–∞–∫—Ä—ã–≤–∞–µ–º –ø–æ –≤—Ä–µ–º–µ–Ω–∏ (–∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ trailing stop –∏ loss cut)"
    )
    return  # –ù–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º —É–±—ã—Ç–æ—á–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –ø–æ –≤—Ä–µ–º–µ–Ω–∏
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –£–±—ã—Ç–æ—á–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –Ω–µ –±—É–¥—É—Ç –ø—Ä–µ–∂–¥–µ–≤—Ä–µ–º–µ–Ω–Ω–æ –∑–∞–∫—Ä—ã–≤–∞—Ç—å—Å—è –ø–æ –≤—Ä–µ–º–µ–Ω–∏

---

## ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï #2: –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–∞–π–º–∞—É—Ç–æ–≤ API

**–§–∞–π–ª:** `src/clients/futures_client.py`  
**–ú–µ—Ç–æ–¥:** `_make_request()` (—Å—Ç—Ä–æ–∫–∏ 127-280)

**–ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ retry –ª–æ–≥–∏–∫–∞ —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π (–¥–æ 3 –ø–æ–ø—ã—Ç–æ–∫)
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ `asyncio.TimeoutError`
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ `OSError` —Å –∫–æ–¥–æ–º 121 (WinError 121 - –ø—Ä–µ–≤—ã—à–µ–Ω —Ç–∞–π–º–∞—É—Ç —Å–µ–º–∞—Ñ–æ—Ä–∞)
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ `aiohttp.ClientError` (Cannot connect to host –∏ —Ç.–¥.)
- ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω —Ç–∞–π–º–∞—É—Ç –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ (30 —Å–µ–∫—É–Ω–¥ total, 10 —Å–µ–∫—É–Ω–¥ connect)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ timestamp –∏ –ø–æ–¥–ø–∏—Å–∏ –ø—Ä–∏ retry

**–ö–æ–¥:**
```python
# ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: Retry –ª–æ–≥–∏–∫–∞ –¥–ª—è —Ç–∞–π–º–∞—É—Ç–æ–≤ –∏ –æ—à–∏–±–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
max_retries = 3
retry_delay = 1.0  # –ù–∞—á–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö

for attempt in range(max_retries):
    try:
        timeout = aiohttp.ClientTimeout(total=30, connect=10)
        async with self.session.request(
            method, url, headers=headers, params=params, data=body, timeout=timeout
        ) as resp:
            # ... –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞ ...
    except asyncio.TimeoutError:
        # Retry —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π
    except OSError as e:
        # –û–±—Ä–∞–±–æ—Ç–∫–∞ WinError 121 –∏ –¥—Ä—É–≥–∏—Ö –æ—à–∏–±–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
    except aiohttp.ClientError as e:
        # –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è aiohttp
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ë–æ—Ç –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–≤—Ç–æ—Ä—è—Ç—å –∑–∞–ø—Ä–æ—Å—ã –ø—Ä–∏ —Ç–∞–π–º–∞—É—Ç–∞—Ö –∏ –æ—à–∏–±–∫–∞—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

---

## ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï #3: –£–ª—É—á—à–µ–Ω —Ä–∞—Å—á–µ—Ç –º–∞—Ä–∂–∏ –¥–ª—è –º–∞–ª—ã—Ö –ø–æ–∑–∏—Ü–∏–π (XRP-USDT)

**–§–∞–π–ª:** `src/strategies/modules/margin_calculator.py`  
**–°—Ç—Ä–æ–∫–∏:** 357-450

**–ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è –º–∞–ª—ã—Ö –ø–æ–∑–∏—Ü–∏–π (margin_used < 5 USDT)
- ‚úÖ –£–ª—É—á—à–µ–Ω–∞ –∑–∞—â–∏—Ç–∞ –æ—Ç –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö margin_ratio –¥–ª—è –º–∞–ª—ã—Ö –ø–æ–∑–∏—Ü–∏–π
- ‚úÖ –ë–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–∏–µ –ø–æ—Ä–æ–≥–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–ª—è –º–∞–ª—ã—Ö –ø–æ–∑–∏—Ü–∏–π (20% –≤–º–µ—Å—Ç–æ 15%)
- ‚úÖ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞: –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ margin_ratio = 1.0
- ‚úÖ –£–ª—É—á—à–µ–Ω —Ä–∞—Å—á–µ—Ç available_margin –¥–ª—è –º–∞–ª—ã—Ö –ø–æ–∑–∏—Ü–∏–π —Å —É—á–µ—Ç–æ–º –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è

**–ö–æ–¥:**
```python
# ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ó–∞—â–∏—Ç–∞ –¥–ª—è –º–∞–ª—ã—Ö –ø–æ–∑–∏—Ü–∏–π (XRP-USDT –∏ —Ç.–¥.)
if available_margin < 0 and margin_used < 5.0 and equity > margin_used * 0.5:
    # –î–ª—è –º–∞–ª—ã—Ö –ø–æ–∑–∏—Ü–∏–π –∏—Å–ø–æ–ª—å–∑—É–µ–º –±–æ–ª–µ–µ –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π —Ä–∞—Å—á–µ—Ç
    available_margin = max(0, equity - margin_used * 0.9)

# ‚úÖ –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê: –î–ª—è –º–∞–ª—ã—Ö –ø–æ–∑–∏—Ü–∏–π –±–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
is_small_position = margin_used < 5.0
pnl_threshold = 0.20 if is_small_position else 0.15
deficit_threshold = 1.5 if is_small_position else 2.0

# ‚úÖ –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–ê–Ø –ó–ê–©–ò–¢–ê: –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
if margin_ratio < 0.5:
    margin_ratio = 1.0  # –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –£–º–µ–Ω—å—à–µ–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–æ–∂–Ω—ã—Ö –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π –æ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö margin_ratio –¥–ª—è –º–∞–ª—ã—Ö –ø–æ–∑–∏—Ü–∏–π

---

## üìä –ò–¢–û–ì–û–í–ê–Ø –°–í–û–î–ö–ê

| # | –ü—Ä–æ–±–ª–µ–º–∞ | –°—Ç–∞—Ç—É—Å | –§–∞–π–ª |
|---|----------|--------|------|
| 1 | –ó–∞–∫—Ä—ã—Ç–∏–µ —É–±—ã—Ç–æ—á–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π –ø–æ –≤—Ä–µ–º–µ–Ω–∏ | ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û** | `orchestrator.py` |
| 2 | –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–∞–π–º–∞—É—Ç–æ–≤ API | ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û** | `futures_client.py` |
| 3 | –†–∞—Å—á–µ—Ç –º–∞—Ä–∂–∏ –¥–ª—è XRP-USDT | ‚úÖ **–£–õ–£–ß–®–ï–ù–û** | `margin_calculator.py` |

---

## üéØ –û–ñ–ò–î–ê–ï–ú–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:

1. **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã:**
   - ‚úÖ –ú–µ–Ω—å—à–µ —Å–±–æ–µ–≤ –ø—Ä–∏ —Ç–∞–π–º–∞—É—Ç–∞—Ö API
   - ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–≤—Ç–æ—Ä—ã –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
   - ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

2. **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏—è–º–∏:**
   - ‚úÖ –£–±—ã—Ç–æ—á–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –Ω–µ –±—É–¥—É—Ç –ø—Ä–µ–∂–¥–µ–≤—Ä–µ–º–µ–Ω–Ω–æ –∑–∞–∫—Ä—ã–≤–∞—Ç—å—Å—è –ø–æ –≤—Ä–µ–º–µ–Ω–∏
   - ‚úÖ –£–±—ã—Ç–æ—á–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –±—É–¥—É—Ç –∑–∞–∫—Ä—ã–≤–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –ø–æ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —É—Å–ª–æ–≤–∏—è–º (trailing stop, loss cut)
   - ‚úÖ –ú–µ–Ω—å—à–µ –ª–æ–∂–Ω—ã—Ö –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π –æ –º–∞—Ä–∂–µ –¥–ª—è –º–∞–ª—ã—Ö –ø–æ–∑–∏—Ü–∏–π

3. **–ü—Ä–∏–±—ã–ª—å–Ω–æ—Å—Ç—å:**
   - ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ (–Ω–∞ 10-20%) –∑–∞ —Å—á–µ—Ç –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø—Ä–µ–∂–¥–µ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–∫—Ä—ã—Ç–∏–π
   - ‚ö†Ô∏è Win rate –æ—Å—Ç–∞–Ω–µ—Ç—Å—è ~20% (–Ω—É–∂–Ω–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏)

---

## ‚ö†Ô∏è –í–ê–ñ–ù–û: –ß—Ç–æ –ù–ï —Ä–µ—à–µ–Ω–æ

–≠—Ç–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ—à–∞—é—Ç **—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –±–∞–≥–∏**, –Ω–æ **–ù–ï —Ä–µ—à–∞—é—Ç –ø—Ä–æ–±–ª–µ–º—É –Ω–∏–∑–∫–æ–π –ø—Ä–∏–±—ã–ª—å–Ω–æ—Å—Ç–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏**:

- ‚ùå Win rate 20% –æ—Å—Ç–∞–Ω–µ—Ç—Å—è (–Ω—É–∂–Ω–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏)
- ‚ùå –°–ª–∏—à–∫–æ–º —á–∞—Å—Ç—ã–µ —Å–¥–µ–ª–∫–∏ (–Ω—É–∂–Ω–æ –ø–æ–≤—ã—Å–∏—Ç—å –ø–æ—Ä–æ–≥–∏ –≤—Ö–æ–¥–∞)
- ‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —É–±—ã—Ç–æ–∫ BTC-USDT (–Ω—É–∂–µ–Ω –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Å—Ç–æ–ø-–ª–æ—Å—Å)

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ (—Å–º. `–ß–¢–û_–†–ï–®–ê–¢_–ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø_–ê–ù–ê–õ–ò–ó.md`)

---

**–î–∞—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** 2025-11-19  
**–í—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã:** ‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ –ª–∏–Ω—Ç–µ—Ä–∞

