🔴 БЛОК 2: ПОЛНЫЙ ПЛАН ИСПРАВЛЕНИЙ ФИЛЬТРОВ
════════════════════════════════════════════════════════════════════════════════

ДАТА: 8 января 2026
СТАТУС: ВЫЯВЛЕНЫ 5 КРИТИЧНЫХ ПРОБЛЕМ

════════════════════════════════════════════════════════════════════════════════
🔴 ПРОБЛЕМА #1: ADX ФИЛЬТР ПРОПУСКАЕТ СЛАБЫЕ ТРЕНДЫ
════════════════════════════════════════════════════════════════════════════════

Где: src/strategies/scalping/futures/signals/filter_manager.py:813-820
Проблема:
  └─ RANGING режим: ADX вообще НЕ блокирует (return signal без проверки)
  └─ Это логично для ranging, НО проблема в том что:
     ├─ Иногда режим НЕВЕРНО определяется как RANGING когда надо TRENDING
     └─ В таких случаях слабые сигналы пропускаются

Пример из логов:
  ├─ SOL-USDT: ADX=10.3, режим DETECTED=RANGING (правильно!)
  ├─ BUT: log говорит "trending" в signal (неправильно!)
  └─ Результат: Signal пропущен, хотя должен был заблокирован

Решение:
  1. Добавить ДОПОЛНИТЕЛЬНУЮ проверку: если режим == RANGING, то проверить ADX > 8
  2. Добавить логирование: "Режим в сигнале" vs "Детектированный режим"
  3. Если расхождение > добавить WARNING

════════════════════════════════════════════════════════════════════════════════
🔴 ПРОБЛЕМА #2: CORRELATION FILTER ПРОПУСКАЕТ КОРРЕЛИРОВАННЫЕ ПОЗИЦИИ
════════════════════════════════════════════════════════════════════════════════

Где: src/strategies/modules/correlation_filter.py
Проблема:
  └─ SOL-USDT с корреляцией 0.93 с XRP-USDT (ОЧЕНЬ ВЫСОКАЯ!)
  └─ Оба пытаются открыться в LONG (одна позиция уже открыта)
  └─ Фильтр ПРОПУСКАЕТ вторую позицию вместо БЛОКИРОВКИ

Логика ошибки:
  ├─ check_entry() проверяет если XRP уже открыта
  ├─ Если YES и LONG → должна блокировать SOL LONG
  └─ Но вместо этого логирует DEBUG и ПРОПУСКАЕТ!

Решение:
  1. Изменить логику: correlation > 0.8 + LONG/LONG → BLOCK
  2. Изменить log с DEBUG на INFO (чтобы было видно)
  3. Добавить return None вместо продолжения

════════════════════════════════════════════════════════════════════════════════
🔴 ПРОБЛЕМА #3: PIVOT POINTS - 6,899 ОШИБОК РАСЧЕТА
════════════════════════════════════════════════════════════════════════════════

Где: src/strategies/modules/pivot_points.py
Проблема:
  └─ Формулы расчета pivot точек неверны
  └─ 6,899 ошибок в час = систематическая проблема

Диагностика нужна:
  1. Проверить формулу PP = (H + L + C) / 3
  2. Проверить R1/S1 = 2*PP - L/H
  3. Проверить кэширование данных

Решение:
  1. Логировать входные данные (H, L, C)
  2. Логировать выходные точки (PP, R1, S1)
  3. Сравнить с ручным расчетом

════════════════════════════════════════════════════════════════════════════════
🔴 ПРОБЛЕМА #4: HOLDING TIME METRICS - 222 ОШИБКИ
════════════════════════════════════════════════════════════════════════════════

Где: src/strategies/scalping/futures/positions/exit_analyzer.py
Ошибка: 'HoldingTimeMetrics' has no attribute 'record_holding_time'
Решение:
  1. Проверить класс HoldingTimeMetrics
  2. Добавить метод record_holding_time() если отсутствует
  3. Или переименовать вызов на существующий метод

════════════════════════════════════════════════════════════════════════════════
🔴 ПРОБЛЕМА #5: FAST ADX - 13 ОШИБОК
════════════════════════════════════════════════════════════════════════════════

Где: src/strategies/scalping/futures/positions/exit_analyzer.py
Ошибка: 'FastADX' has no attribute 'get_adx'
Решение:
  1. Проверить метод FastADX.get_adx()
  2. Возможно переименовать на get_value() или adx_value
  3. Добавить проверку if hasattr()

════════════════════════════════════════════════════════════════════════════════
📋 ПЛАН ДЕЙСТВИЙ (в порядке приоритета)
════════════════════════════════════════════════════════════════════════════════

ЭТАП 1: Исправление фильтров (1-2 часа)
  ✓ Проблема #1: ADX filter режимы → добавить проверку
  ✓ Проблема #2: Correlation filter → добавить блокировку
  ✓ Создать test case для验证 фильтров

ЭТАП 2: Исправление ошибок (30 минут)
  ✓ Проблема #4: HoldingTimeMetrics → добавить метод
  ✓ Проблема #5: FastADX → добавить метод / переименовать

ЭТАП 3: Диагностика Pivot Points (1 час)
  ✓ Логирование входа/выхода
  ✓ Проверка формул
  ✓ Исправление расчетов

ЭТАП 4: Логирование сигналов (30 минут)
  ✓ Логировать ДО открытия позиции
  ✓ Не потерять 19 сигналов

════════════════════════════════════════════════════════════════════════════════
НАЧИНАЕМ С ПРОБЛЕМЫ #2 (Correlation Filter) - САМАЯ КРИТИЧНАЯ!
════════════════════════════════════════════════════════════════════════════════
