# üìä –ö–ê–ö –ú–û–î–£–õ–ò –û–¢–ö–†–´–¢–ò–Ø –ò –ó–ê–ö–†–´–¢–ò–Ø –ë–£–î–£–¢ –ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨ –°–ò–°–¢–ï–ú–£ –°–í–ï–ß–ï–ô

**–î–∞—Ç–∞:** 26.11.2025

---

## ‚ùì –í–û–ü–†–û–°

**"–ö–æ–≥–¥–∞ –±—É–¥–µ—Ç —Å—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –º–æ–¥—É–ª—å –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏ –∏ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏, –æ–Ω–∏ –±—É–¥—É—Ç –±—Ä–∞—Ç—å –∏–Ω—Ñ—É –æ—Ç—Å—é–¥–∞? –ò–ª–∏ –∫–∞–∫?"**

---

## ‚úÖ –û–¢–í–ï–¢: –î–ê, –ë–£–î–£–¢ –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò –ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨!

### **–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  –ù–û–í–ê–Ø –°–ò–°–¢–ï–ú–ê: –í—Å–µ –¥–∞–Ω–Ω—ã–µ –≤ DataRegistry                    ‚îÇ
‚îÇ  - –°–≤–µ—á–∏ (1m, 5m, 1H) - –∏–∑ CandleBuffer                     ‚îÇ
‚îÇ  - –¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞ - –∏–∑ WebSocket —Ç–∏–∫–µ—Ä–æ–≤                       ‚îÇ
‚îÇ  - –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã - —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–µ –Ω–∞ —Å–≤–µ—á–∞—Ö                       ‚îÇ
‚îÇ  - –†–µ–∂–∏–º—ã —Ä—ã–Ω–∫–∞ - –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –Ω–∞ —Å–≤–µ—á–∞—Ö                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                        ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  –ú–û–î–£–õ–ò –û–¢–ö–†–´–¢–ò–Ø –ò –ó–ê–ö–†–´–¢–ò–Ø                                  ‚îÇ
‚îÇ  –ë–ï–†–£–¢ –î–ê–ù–ù–´–ï –ò–ó DataRegistry                                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üîß –ú–û–î–£–õ–¨ –û–¢–ö–†–´–¢–ò–Ø –ü–û–ó–ò–¶–ò–ô (EntryManager)

### **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç EntryManager:**

1. **–ü–æ–ª—É—á–∞–µ—Ç —Å–∏–≥–Ω–∞–ª** –æ—Ç SignalGenerator
2. **–†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Ä–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏** —á–µ—Ä–µ–∑ RiskManager/PositionSizer
3. **–û—Ç–∫—Ä—ã–≤–∞–µ—Ç –ø–æ–∑–∏—Ü–∏—é** —á–µ—Ä–µ–∑ OrderExecutor
4. **–†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –ø–æ–∑–∏—Ü–∏—é** –≤ PositionRegistry

### **–ö–∞–∫ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–≤–µ—á–∏:**

#### **1. EntryManager –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–≤–µ—á–∏ –Ω–∞–ø—Ä—è–º—É—é:**

```python
# EntryManager –ø–æ–ª—É—á–∞–µ—Ç signal —Å —É–∂–µ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏:
signal = {
    "symbol": "BTC-USDT",
    "side": "buy",
    "price": 43500.0,  # ‚úÖ –¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞ (–∏–∑ DataRegistry –∏–ª–∏ WebSocket)
    "tp_percent": 1.5,
    "sl_percent": 0.8,
    "regime": "trending",  # ‚úÖ –†–µ–∂–∏–º (—É–∂–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –Ω–∞ —Å–≤–µ—á–∞—Ö)
    # ... –¥—Ä—É–≥–∏–µ –¥–∞–Ω–Ω—ã–µ
}
```

**EntryManager –ø—Ä–æ—Å—Ç–æ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –ø–æ–∑–∏—Ü–∏—é –ø–æ —Å–∏–≥–Ω–∞–ª—É!**

#### **2. –ù–æ SignalGenerator –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–≤–µ—á–∏ (—á–µ—Ä–µ–∑ DataRegistry):**

```python
# SignalGenerator –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–∏–≥–Ω–∞–ª—ã, –∏—Å–ø–æ–ª—å–∑—É—è —Å–≤–µ—á–∏:
async def generate_signals():
    # ‚úÖ –ë–µ—Ä–µ—Ç —Å–≤–µ—á–∏ –∏–∑ DataRegistry (–Ω–µ –∏–∑ API!)
    candles_1m = await data_registry.get_candles("BTC-USDT", "1m")
    
    # –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –Ω–∞ —Å–≤–µ—á–∞—Ö
    indicators = calculate_indicators(candles_1m)
    
    # –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä–µ–∂–∏–º —Ä—ã–Ω–∫–∞
    regime = determine_regime(candles_1m, indicators)
    
    # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–∏–≥–Ω–∞–ª
    signal = create_signal(indicators, regime)
    
    return signal  # –≠—Ç–æ—Ç —Å–∏–≥–Ω–∞–ª –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ EntryManager
```

**–í—ã–≤–æ–¥:** EntryManager –ø–æ–ª—É—á–∞–µ—Ç —Å–∏–≥–Ω–∞–ª —Å —É–∂–µ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ (–Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–≤–µ—á–µ–π –∏–∑ DataRegistry).

---

### **3. RiskManager –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–≤–µ—á–∏ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Ä–∞–∑–º–µ—Ä–∞:**

```python
# RiskManager —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Ä–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏:
async def calculate_position_size(signal):
    # ‚úÖ –ë–µ—Ä–µ—Ç –±–∞–ª–∞–Ω—Å –∏–∑ DataRegistry
    balance = await data_registry.get_balance_value()
    
    # ‚úÖ –ë–µ—Ä–µ—Ç —Ç–µ–∫—É—â—É—é —Ü–µ–Ω—É –∏–∑ DataRegistry (–∏–ª–∏ WebSocket)
    price = await data_registry.get_price(signal["symbol"])
    
    # ‚úÖ –ú–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–≤–µ—á–∏ –¥–ª—è ATR-—Ä–∞—Å—á–µ—Ç–∞ —Ä–∏—Å–∫–∞
    candles = await data_registry.get_candles(signal["symbol"], "1m")
    atr = calculate_atr(candles)
    
    # –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Ä–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏
    position_size = calculate_size(balance, price, atr, signal["regime"])
    
    return position_size
```

**–í—ã–≤–æ–¥:** RiskManager –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–≤–µ—á–∏ –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ —Ä–∞–∑–º–µ—Ä–∞.

---

## üîß –ú–û–î–£–õ–¨ –ó–ê–ö–†–´–¢–ò–Ø –ü–û–ó–ò–¶–ò–ô (PositionManager)

### **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç PositionManager:**

1. **–ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç –æ—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ–∑–∏—Ü–∏–∏**
2. **–ü—Ä–æ–≤–µ—Ä—è–µ—Ç TP/SL**
3. **–ó–∞–∫—Ä—ã–≤–∞–µ—Ç –ø–æ–∑–∏—Ü–∏–∏** –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ TP/SL
4. **–ò—Å–ø–æ–ª—å–∑—É–µ—Ç Trailing Stop Loss**

### **–ö–∞–∫ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–≤–µ—á–∏:**

#### **1. –¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞ - –∏–∑ WebSocket (–±—ã—Å—Ç—Ä–æ):**

```python
# PositionManager –ø–æ–ª—É—á–∞–µ—Ç —Ç–µ–∫—É—â—É—é —Ü–µ–Ω—É –∏–∑ WebSocket:
async def manage_position(position):
    symbol = position["symbol"]
    
    # ‚úÖ –ë–µ—Ä–µ—Ç —Ç–µ–∫—É—â—É—é —Ü–µ–Ω—É –∏–∑ DataRegistry (–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ WebSocket)
    current_price = await data_registry.get_price(symbol)
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ—Ç TP/SL
    if profit_pct >= tp_percent:
        close_position()  # –ó–∞–∫—Ä—ã–≤–∞–µ—Ç –ø–æ TP
```

**–í—ã–≤–æ–¥:** –î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ TP/SL –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–µ–∫—É—â–∞—è —Ü–µ–Ω–∞ –∏–∑ WebSocket (–±—ã—Å—Ç—Ä–æ).

---

#### **2. –ù–æ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–≤–µ—á–∏:**

```python
# PositionManager –º–æ–∂–µ—Ç –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–≤–µ—á–∏ –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π:
async def should_close_position(position):
    symbol = position["symbol"]
    
    # ‚úÖ –ë–µ—Ä–µ—Ç —Å–≤–µ—á–∏ –∏–∑ DataRegistry –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
    candles_1m = await data_registry.get_candles(symbol, "1m")
    candles_5m = await data_registry.get_candles(symbol, "5m")
    
    # –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ç—Ä–µ–Ω–¥ –Ω–∞ —Å–≤–µ—á–∞—Ö
    trend_changed = analyze_trend_reversal(candles_5m)
    
    # –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –æ–±—ä–µ–º
    volume_decreasing = analyze_volume_decrease(candles_1m)
    
    # –ü—Ä–∏–Ω–∏–º–∞–µ—Ç —Ä–µ—à–µ–Ω–∏–µ
    if trend_changed or volume_decreasing:
        return True  # –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç –∑–∞–∫—Ä—ã—Ç—å –ø–æ–∑–∏—Ü–∏—é
    
    return False
```

**–í—ã–≤–æ–¥:** –î–ª—è —Å–ª–æ–∂–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ (ExitAnalyzer) –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å–≤–µ—á–∏.

---

#### **3. Trailing Stop Loss –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–µ–∫—É—â—É—é —Ü–µ–Ω—É:**

```python
# TrailingSL –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ WebSocket —Ç–∏–∫–µ—Ä—ã:
async def update_trailing_sl(symbol, current_price):
    # ‚úÖ current_price –ø—Ä–∏—Ö–æ–¥–∏—Ç –∏–∑ WebSocket (–±—ã—Å—Ç—Ä–æ)
    # –ù–ï –Ω—É–∂–Ω–æ –∂–¥–∞—Ç—å —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è —Å–≤–µ—á–∏!
    
    tsl = trailing_sl_by_symbol[symbol]
    new_stop = tsl.update(current_price)
    
    # –ï—Å–ª–∏ —Ü–µ–Ω–∞ –ø—Ä–æ–±–∏–ª–∞ —Å—Ç–æ–ø - –∑–∞–∫—Ä—ã–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é
    if current_price <= new_stop:  # –¥–ª—è LONG
        close_position()
```

**–í—ã–≤–æ–¥:** TSL —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —Ç–∏–∫–µ—Ä–∞—Ö (–±—ã—Å—Ç—Ä–æ), –Ω–µ –∂–¥–µ—Ç —Å–≤–µ—á–∏.

---

## üìä –ò–¢–û–ì–û–í–ê–Ø –°–•–ï–ú–ê

### **–î–ª—è –û–¢–ö–†–´–¢–ò–Ø –ø–æ–∑–∏—Ü–∏–π:**

```
SignalGenerator
  ‚Üì (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–≤–µ—á–∏ –∏–∑ DataRegistry)
  –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–∏–≥–Ω–∞–ª —Å —Ä–µ–∂–∏–º–æ–º, –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞–º–∏
  ‚Üì
RiskManager
  ‚Üì (–º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–≤–µ—á–∏ –¥–ª—è ATR)
  –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Ä–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏
  ‚Üì
EntryManager
  ‚Üì (–ø–æ–ª—É—á–∞–µ—Ç –≥–æ—Ç–æ–≤—ã–π —Å–∏–≥–Ω–∞–ª)
  –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –ø–æ–∑–∏—Ü–∏—é –Ω–∞ –±–∏—Ä–∂–µ
  ‚Üì
PositionRegistry
  –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –ø–æ–∑–∏—Ü–∏—é
```

---

### **–î–ª—è –ó–ê–ö–†–´–¢–ò–Ø –ø–æ–∑–∏—Ü–∏–π:**

```
WebSocket —Ç–∏–∫–µ—Ä
  ‚Üì (–æ–±–Ω–æ–≤–ª—è–µ—Ç —Ü–µ–Ω—É –≤ DataRegistry)
  current_price –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
  ‚Üì
PositionManager / TrailingSL
  ‚Üì (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç current_price –∏–∑ DataRegistry)
  –ü—Ä–æ–≤–µ—Ä—è–µ—Ç TP/SL –±—ã—Å—Ç—Ä–æ (–Ω–µ –∂–¥–µ—Ç —Å–≤–µ—á–∏)
  ‚Üì
ExitAnalyzer (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  ‚Üì (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–≤–µ—á–∏ –∏–∑ DataRegistry –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞)
  –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ç—Ä–µ–Ω–¥, –æ–±—ä–µ–º, –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã
  –ü—Ä–∏–Ω–∏–º–∞–µ—Ç —Ä–µ—à–µ–Ω–∏–µ: –∑–∞–∫—Ä—ã—Ç—å / –ø—Ä–æ–¥–ª–∏—Ç—å TP / —á–∞—Å—Ç–∏—á–Ω–æ –∑–∞–∫—Ä—ã—Ç—å
  ‚Üì
PositionManager
  –í—ã–ø–æ–ª–Ω—è–µ—Ç —Ä–µ—à–µ–Ω–∏–µ: –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –ø–æ–∑–∏—Ü–∏—é
```

---

## ‚úÖ –ö–õ–Æ–ß–ï–í–´–ï –ú–û–ú–ï–ù–¢–´

### **1. EntryManager:**

- **–ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–≤–µ—á–∏ –Ω–∞–ø—Ä—è–º—É—é**
- **–ü–æ–ª—É—á–∞–µ—Ç –≥–æ—Ç–æ–≤—ã–π —Å–∏–≥–Ω–∞–ª** —Å —É–∂–µ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- **–°–∏–≥–Ω–∞–ª —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–≤–µ—á–µ–π** –∏–∑ DataRegistry (–≤ SignalGenerator)

### **2. PositionManager:**

- **–ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–µ–∫—É—â—É—é —Ü–µ–Ω—É –∏–∑ WebSocket** (–±—ã—Å—Ç—Ä–æ, –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É)
- **–ú–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–≤–µ—á–∏** –¥–ª—è —Å–ª–æ–∂–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ (ExitAnalyzer)
- **TSL –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –Ω–∞ —Ç–∏–∫–µ—Ä–∞—Ö** (–Ω–µ –∂–¥–µ—Ç —Å–≤–µ—á–∏)

### **3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**

- ‚úÖ **–í—Å–µ –º–æ–¥—É–ª–∏ –ø–æ–ª—É—á–∞—é—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ DataRegistry**
- ‚úÖ **DataRegistry –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è** —á–µ—Ä–µ–∑ WebSocket
- ‚úÖ **–°–≤–µ—á–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ** (–Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∫–∞–∂–¥—ã–π —Ä–∞–∑)
- ‚úÖ **–ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –ª–æ–≥–∏–∫–µ** –æ—Ç–∫—Ä—ã—Ç–∏—è/–∑–∞–∫—Ä—ã—Ç–∏—è - –ø—Ä–æ—Å—Ç–æ –º–µ–Ω—è–µ—Ç—Å—è –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö

---

## üéØ –ü–†–ê–ö–¢–ò–ß–ï–°–ö–ò–ô –ü–†–ò–ú–ï–†

### **–°—Ü–µ–Ω–∞—Ä–∏–π: –û—Ç–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–∏**

```python
# 1. WebSocket –ø–æ–ª—É—á–∞–µ—Ç —Ç–∏–∫–µ—Ä
websocket_coordinator.handle_ticker_data("BTC-USDT", ticker)
  ‚Üì
  –û–±–Ω–æ–≤–ª—è–µ—Ç —Ü–µ–Ω—É –≤ DataRegistry: data_registry.update_market_data(...)
  –û–±–Ω–æ–≤–ª—è–µ—Ç —Å–≤–µ—á—É –≤ CandleBuffer (–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ)
  ‚Üì

# 2. SignalGenerator –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–∏–≥–Ω–∞–ª
signal_generator.generate_signals()
  ‚Üì
  –ë–µ—Ä–µ—Ç —Å–≤–µ—á–∏: candles = await data_registry.get_candles("BTC-USDT", "1m")
  –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –Ω–∞ —Å–≤–µ—á–∞—Ö
  –°–æ–∑–¥–∞–µ—Ç —Å–∏–≥–Ω–∞–ª: {"symbol": "BTC-USDT", "side": "buy", ...}
  ‚Üì

# 3. SignalCoordinator –ø–æ–ª—É—á–∞–µ—Ç —Å–∏–≥–Ω–∞–ª
signal_coordinator.check_for_signals("BTC-USDT", price)
  ‚Üì
  –ü–µ—Ä–µ–¥–∞–µ—Ç —Å–∏–≥–Ω–∞–ª –≤ EntryManager
  ‚Üì

# 4. EntryManager –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –ø–æ–∑–∏—Ü–∏—é
entry_manager.open_position_with_size(signal, position_size)
  ‚Üì
  –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –ø–æ–∑–∏—Ü–∏—é –Ω–∞ –±–∏—Ä–∂–µ
  –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –≤ PositionRegistry
```

**–í—ã–≤–æ–¥:** EntryManager —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –≥–æ—Ç–æ–≤—ã–º —Å–∏–≥–Ω–∞–ª–æ–º, –Ω–æ —Å–∏–≥–Ω–∞–ª —Å–æ–∑–¥–∞–Ω –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–≤–µ—á–µ–π –∏–∑ DataRegistry!

---

### **–°—Ü–µ–Ω–∞—Ä–∏–π: –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–∏**

```python
# 1. WebSocket –ø–æ–ª—É—á–∞–µ—Ç —Ç–∏–∫–µ—Ä
websocket_coordinator.handle_ticker_data("BTC-USDT", ticker)
  ‚Üì
  –û–±–Ω–æ–≤–ª—è–µ—Ç —Ü–µ–Ω—É –≤ DataRegistry: current_price = 43600.0
  –û–±–Ω–æ–≤–ª—è–µ—Ç —Å–≤–µ—á—É –≤ CandleBuffer (–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ)
  ‚Üì

# 2. PositionManager –ø—Ä–æ–≤–µ—Ä—è–µ—Ç TP/SL
position_manager.manage_position(position)
  ‚Üì
  –ë–µ—Ä–µ—Ç —Ü–µ–Ω—É: current_price = await data_registry.get_price("BTC-USDT")
  –ü—Ä–æ–≤–µ—Ä—è–µ—Ç: profit_pct = (current_price - entry_price) / entry_price
  ‚Üì
  –ï—Å–ª–∏ profit_pct >= tp_percent:
    close_position()  # –ó–∞–∫—Ä—ã–≤–∞–µ—Ç –ø–æ–∑–∏—Ü–∏—é
```

**–í—ã–≤–æ–¥:** PositionManager –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–µ–∫—É—â—É—é —Ü–µ–Ω—É –∏–∑ DataRegistry (–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ WebSocket), —Å–≤–µ—á–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–ª–æ–∂–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞!

---

## ‚úÖ –ò–¢–û–ì–û–í–´–ô –û–¢–í–ï–¢

### **–î–ê, –º–æ–¥—É–ª–∏ –±—É–¥—É—Ç –±—Ä–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ DataRegistry!**

1. **EntryManager:**
   - –ü–æ–ª—É—á–∞–µ—Ç –≥–æ—Ç–æ–≤—ã–π —Å–∏–≥–Ω–∞–ª (–∫–æ—Ç–æ—Ä—ã–π —Å–æ–∑–¥–∞–Ω –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–≤–µ—á–µ–π –∏–∑ DataRegistry)
   - –°–∞–º –Ω–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Å–≤–µ—á–∏, –Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –¥–∞–Ω–Ω—ã–º–∏, —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–º–∏ –Ω–∞ –Ω–∏—Ö

2. **PositionManager:**
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–µ–∫—É—â—É—é —Ü–µ–Ω—É –∏–∑ DataRegistry (–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ WebSocket)
   - –ú–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–≤–µ—á–∏ –¥–ª—è —Å–ª–æ–∂–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ (ExitAnalyzer)
   - TSL –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –Ω–∞ —Ç–∏–∫–µ—Ä–∞—Ö (–±—ã—Å—Ç—Ä–æ, –Ω–µ –∂–¥–µ—Ç —Å–≤–µ—á–∏)

3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:**
   - –í—Å–µ –º–æ–¥—É–ª–∏ –ø–æ–ª—É—á–∞—é—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ DataRegistry
   - DataRegistry –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ WebSocket
   - –ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –ª–æ–≥–∏–∫–µ - –ø—Ä–æ—Å—Ç–æ –º–µ–Ω—è–µ—Ç—Å—è –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö

---

**‚úÖ –í–´–í–û–î: –í—Å–µ –º–æ–¥—É–ª–∏ –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ DataRegistry (—Å–≤–µ—á–∏, —Ü–µ–Ω—ã, –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã)!**






