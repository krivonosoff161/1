═══════════════════════════════════════════════════════════════════════════════
                    🏗️ АРХИТЕКТУРА ГИБРИДНОГО БОТА
═══════════════════════════════════════════════════════════════════════════════

📦 simple-trading-bot-okx/
│
├── 📂 src/                                    # ИСХОДНЫЙ КОД
│   │
│   ├── 📄 main.py (200 строк)                # 🎯 ТОЧКА ВХОДА
│   │   └─> Запускает бота
│   │   └─> Инициализирует все компоненты
│   │   └─> Главный async loop
│   │
│   ├── 📄 config.py (150 строк)              # ⚙️ КОНФИГУРАЦИЯ
│   │   └─> Парсит config.yaml
│   │   └─> Создает Pydantic модели
│   │   └─> Валидирует параметры
│   │
│   ├── 📄 models.py (300 строк)              # 📦 МОДЕЛИ ДАННЫХ
│   │   └─> Position (позиция)
│   │   └─> Signal (торговый сигнал)
│   │   └─> Tick (цена)
│   │   └─> OrderSide, PositionSide (enum)
│   │
│   ├── 📄 okx_client.py (600 строк)          # 🔌 OKX API КЛИЕНТ
│   │   └─> REST API запросы
│   │   └─> Подпись (HMAC)
│   │   └─> get_candles(), place_order(), get_balance()
│   │
│   ├── ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
│   ├── 📂 strategies/                         # 🎯 ТОРГОВЫЕ СТРАТЕГИИ
│   │   │
│   │   ├── 📄 base_strategy.py (200 строк)   # 🏛️ БАЗОВЫЙ КЛАСС
│   │   │   └─> Абстрактный класс (ABC)
│   │   │   └─> process_tick() - обязательный метод
│   │   │   └─> can_trade() - обязательный метод
│   │   │   └─> Общий интерфейс для всех стратегий
│   │   │
│   │   ├── 📄 scalping_engine.py (1500 строк) # 📈 СКАЛЬПИНГ
│   │   │   └─> Из текущего scalping.py (рефакторинг)
│   │   │   └─> Scoring система (0-12 баллов)
│   │   │   └─> RANGING фильтр
│   │   │   └─> Break-even, Trailing, Partial TP
│   │   │   └─> Все текущие защиты
│   │   │   └─> Использует модули (MTF, Correlation, etc)
│   │   │
│   │   ├── 📄 grid_engine.py (800 строк)     # 🌊 GRID TRADING
│   │   │   └─> Расчет уровней сетки (5-7 шт)
│   │   │   └─> Размещение buy/sell ордеров
│   │   │   └─> Автоматическое переоткрытие
│   │   │   └─> Grid SL/TP (глобальные)
│   │   │   └─> Time Stop для Grid
│   │   │   └─> Использует Pivots для границ
│   │   │   └─> Использует VPOC для центра
│   │   │
│   │   ├── 📄 hybrid_orchestrator.py (500 строк) # 🎮 ОРКЕСТРАТОР
│   │   │   └─> Переключает Scalping ↔ Grid
│   │   │   └─> Детектирует режим рынка
│   │   │   └─> Гистерезис (5 мин подтверждения)
│   │   │   └─> Управление капиталом (allocation)
│   │   │   └─> Координация позиций
│   │   │
│   │   └── 📂 modules/                        # ✨ МОДУЛИ УЛУЧШЕНИЙ
│   │       │
│   │       ├── 📄 multi_timeframe.py (300 строк)    # ⏱️ MTF
│   │       │   └─> Проверяет 5m таймфрейм
│   │       │   └─> EMA8/21 подтверждение
│   │       │   └─> +2 балла или блокировка
│   │       │   └─> Используется: Scalping
│   │       │
│   │       ├── 📄 correlation_filter.py (250 строк) # 🔗 КОРРЕЛЯЦИЯ
│   │       │   └─> Pearson correlation (24h)
│   │       │   └─> Макс 2 коррелированных позиции
│   │       │   └─> Блокировка при превышении
│   │       │   └─> Используется: Scalping + Grid
│   │       │
│   │       ├── 📄 time_filter.py (400 строк)       # 🕐 ВРЕМЯ
│   │       │   └─> Статистика Win Rate по часам
│   │       │   └─> Blacklist часы (<35% WR)
│   │       │   └─> Whitelist часы (>65% WR)
│   │       │   └─> SQL запросы к trading_bot.db
│   │       │   └─> Обновление каждый день
│   │       │   └─> Используется: Scalping + Grid
│   │       │
│   │       ├── 📄 pivot_points.py (350 строк)      # 📍 PIVOT POINTS
│   │       │   └─> 3 метода: Standard, Fibonacci, Camarilla
│   │       │   └─> Расчет R1/R2/R3, S1/S2/S3, PP
│   │       │   └─> +2 балла около уровня
│   │       │   └─> Корректировка TP/SL
│   │       │   └─> Используется: Scalping (TP/SL), Grid (границы)
│   │       │
│   │       ├── 📄 order_book_analyzer.py (300 строк) # 📊 ORDER BOOK
│   │       │   └─> Получает Order Book через API
│   │       │   └─> Расчет Bid/Ask imbalance
│   │       │   └─> Depth ratio (топ 10 уровней)
│   │       │   └─> Spread проверка
│   │       │   └─> +1 балл при имбалансе
│   │       │   └─> Используется: Scalping
│   │       │
│   │       └── 📄 liquidity_zones.py (400 строк)   # 💧 ЛИКВИДНОСТЬ
│   │           └─> Кластеризация уровней в Order Book
│   │           └─> Находит зоны высокой ликвидности
│   │           └─> +2 балла около кластера
│   │           └─> TP перед кластером сопротивления
│   │           └─> Используется: Scalping
│   │
│   ├── ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
│   ├── 📂 indicators/                          # 📊 ИНДИКАТОРЫ
│   │   │
│   │   ├── 📄 base.py (400 строк)             # Текущие индикаторы
│   │   │   └─> RSI (14)
│   │   │   └─> SMA Fast/Slow (5/20)
│   │   │   └─> EMA Fast/Slow (8/21)
│   │   │   └─> Bollinger Bands (20, 2σ)
│   │   │   └─> ATR (14)
│   │   │   └─> MACD (12, 26, 9)
│   │   │   └─> Volume
│   │   │   └─> Используется: ВЕЗДЕ
│   │   │
│   │   └── 📂 advanced/                       # ✨ ПРОДВИНУТЫЕ
│   │       │
│   │       ├── 📄 volume_profile.py (500 строк) # 📊 VOLUME PROFILE
│   │       │   └─> Анализ распределения объема
│   │       │   └─> VPOC (точка максимального объема)
│   │       │   └─> Value Area (70% объема)
│   │       │   └─> HVA/LVA зоны
│   │       │   └─> Используется: Scalping (входы), Grid (центр)
│   │       │
│   │       ├── 📄 pivot_calculator.py (300 строк) # 📍 PIVOT CALC
│   │       │   └─> Расчеты для Pivot Points модуля
│   │       │   └─> 3 метода расчета
│   │       │   └─> Используется: pivot_points.py модуль
│   │       │
│   │       └── 📄 adaptive_indicators.py (600 строк) # 🔄 ADAPTIVE
│   │           └─> Adaptive RSI (период 10-20)
│   │           └─> Adaptive MACD (периоды меняются)
│   │           └─> ОПЦИОНАЛЬНО (сложное)
│   │           └─> Используется: Scalping (если включено)
│   │
│   ├── ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
│   ├── 📂 filters/                             # 🛡️ ФИЛЬТРЫ
│   │   │
│   │   ├── 📄 regime_detector.py (300 строк)  # 🌊 ДЕТЕКТОР РЕЖИМОВ
│   │   │   └─> 5 режимов: EXTREME/HIGH/NORMAL/LOW VOL, RANGING, TRENDING
│   │   │   └─> Рассчитывает volatility, trend strength
│   │   │   └─> Возвращает параметры для режима
│   │   │   └─> Используется: Hybrid Orchestrator
│   │   │
│   │   ├── 📄 correlation_manager.py (250 строк) # 🔗 КОРРЕЛЯЦИЯ
│   │   │   └─> Хранит матрицу корреляций
│   │   │   └─> Обновляет каждый час
│   │   │   └─> can_open_position() проверка
│   │   │   └─> Используется: Scalping + Grid (через модуль)
│   │   │
│   │   ├── 📄 time_session_manager.py (400 строк) # 🕐 ВРЕМЯ
│   │   │   └─> SQL запросы к базе
│   │   │   └─> Статистика Win Rate по часам
│   │   │   └─> Blacklist/Whitelist часы
│   │   │   └─> Обновление ежедневно
│   │   │   └─> Используется: Scalping + Grid (через модуль)
│   │   │
│   │   └── 📄 spread_filter.py (100 строк)     # 💸 СПРЕД
│   │       └─> Проверка спреда (уже есть в коде)
│   │       └─> Выделен в отдельный модуль
│   │
│   ├── ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
│   ├── 📂 risk/                                # 💰 РИСК-МЕНЕДЖМЕНТ
│   │   │
│   │   ├── 📄 position_sizer.py (300 строк)   # 💵 РАЗМЕР ПОЗИЦИИ
│   │   │   └─> Fixed Risk (1%)
│   │   │   └─> Kelly Criterion (оптимальный)
│   │   │   └─> calculate_size(balance, sl_distance)
│   │   │   └─> Используется: Scalping + Grid
│   │   │
│   │   ├── 📄 risk_calculator.py (200 строк)  # 📊 РАСЧЕТ РИСКОВ
│   │   │   └─> Выделено из scalping.py
│   │   │   └─> Расчет SL/TP дистанций
│   │   │   └─> Max position size
│   │   │   └─> Используется: Scalping + Grid
│   │   │
│   │   └── 📄 portfolio_monitor.py (250 строк) # 👁️ ПОРТФЕЛЬ
│   │       └─> Мониторит exposure по активам
│   │       └─> Проверяет correlation риск
│   │       └─> Проверяет daily loss
│   │       └─> Используется: Hybrid Orchestrator
│   │
│   ├── ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
│   ├── 📂 ml/                                  # 🤖 ML (ОПЦИОНАЛЬНО)
│   │   │
│   │   ├── 📄 rl_environment.py (400 строк)   # 🎮 RL СРЕДА
│   │   │   └─> OpenAI Gym environment
│   │   │   └─> State, Action, Reward
│   │   │
│   │   ├── 📄 rl_agent.py (600 строк)         # 🧠 RL АГЕНТ
│   │   │   └─> PPO (Proximal Policy Optimization)
│   │   │   └─> Нейронная сеть (128-256-128)
│   │   │   └─> predict_action()
│   │   │
│   │   └── 📄 model_trainer.py (400 строк)    # 🎓 ОБУЧЕНИЕ
│   │       └─> Тренировка на исторических данных
│   │       └─> Сохранение/загрузка модели
│   │
│   ├── ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
│   ├── 📂 utils/                               # 🔧 УТИЛИТЫ
│   │   │
│   │   ├── 📄 feature_flags.py (150 строк)    # 🎚️ FEATURE FLAGS
│   │   │   └─> Читает config.features
│   │   │   └─> is_enabled("multi_timeframe")
│   │   │   └─> Используется: ВЕЗДЕ
│   │   │
│   │   ├── 📄 helpers.py (200 строк)          # 🛠️ ХЕЛПЕРЫ
│   │   │   └─> format_price()
│   │   │   └─> calculate_percentage()
│   │   │   └─> round_to_tick_size()
│   │   │
│   │   └── 📄 validators.py (100 строк)       # ✅ ВАЛИДАТОРЫ
│   │       └─> validate_order()
│   │       └─> validate_balance()
│   │
│   └── ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
│   └── 📂 web/                                 # 🌐 WEB (ОПЦИОНАЛЬНО)
│       │
│       ├── 📄 app.py (300 строк)              # 🚀 FASTAPI
│       │   └─> FastAPI приложение
│       │   └─> Endpoints: /health, /status, /start, /stop
│       │
│       ├── 📂 routes/
│       │   ├── 📄 health.py
│       │   ├── 📄 status.py
│       │   └── 📄 control.py
│       │
│       └── 📂 static/
│           └── 📄 dashboard.html              # 📺 HTML
│
├── ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
├── 📂 config/                                  # ⚙️ КОНФИГУРАЦИЯ
│   │
│   ├── 📄 config.yaml                         # 🎛️ ОСНОВНАЯ
│   │   └─> Все параметры стратегии
│   │   └─> Risk management
│   │   └─> Indicators settings
│   │   └─> ~300 строк
│   │
│   ├── 📄 features.yaml                       # 🎚️ FEATURE FLAGS
│   │   └─> multi_timeframe_enabled: false
│   │   └─> correlation_filter_enabled: false
│   │   └─> ... (все модули)
│   │   └─> Включаем/выключаем по одному!
│   │
│   ├── 📄 config.demo.yaml                    # 🧪 DEMO
│   │   └─> Настройки для demo счета
│   │   └─> sandbox: true
│   │   └─> Больше логирования
│   │
│   └── 📄 config.prod.yaml                    # 🚀 PRODUCTION
│       └─> Настройки для реального счета
│       └─> Консервативные параметры
│       └─> Меньше логов (INFO, не DEBUG)
│
├── ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
├── 📂 data/                                    # 💾 ДАННЫЕ
│   │
│   ├── 📂 historical/                         # 📜 ИСТОРИЯ (для бэктеста)
│   │   ├── BTC-USDT_1m_2024-01.csv
│   │   ├── ETH-USDT_1m_2024-01.csv
│   │   └── SOL-USDT_1m_2024-01.csv
│   │
│   ├── 📂 cache/                              # 🗄️ КЭШ
│   │   ├── indicators_cache.pkl              # Кэш индикаторов (ускорение)
│   │   └── correlations_cache.pkl            # Кэш корреляций
│   │
│   └── 📄 trading_bot.db                      # 🗃️ SQLITE БАЗА
│       Tables:
│       ├── trades                            # История сделок
│       │   Columns: id, symbol, side, entry_price, exit_price,
│       │            quantity, pnl, win, hour_utc, timestamp
│       │
│       ├── positions                         # Текущие позиции
│       │   Columns: symbol, side, entry_price, quantity,
│       │            strategy_type (SCALPING/GRID), ...
│       │
│       ├── hour_statistics                   # Статистика по часам
│       │   Columns: hour_utc, total_trades, win_rate, avg_pnl
│       │
│       ├── regime_history                    # История режимов
│       │   Columns: symbol, regime, timestamp
│       │
│       └── performance_metrics               # Метрики
│           Columns: date, daily_pnl, win_rate, sharpe_ratio, ...
│
├── ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
├── 📂 logs/                                    # 📝 ЛОГИ
│   │
│   ├── 📄 trading_bot_2025-10-12.log          # 📊 ОСНОВНОЙ ЛОГ
│   │   └─> Всё подряд (INFO + DEBUG)
│   │   └─> Rotation: 100 MB
│   │   └─> Retention: 30 дней
│   │
│   ├── 📄 errors_2025-10-12.log               # ❌ ОШИБКИ
│   │   └─> Только ERROR + CRITICAL
│   │   └─> Для быстрого поиска проблем
│   │
│   ├── 📄 trades_2025-10-12.log               # 💰 СДЕЛКИ
│   │   └─> Только сделки (open/close)
│   │   └─> Для анализа торговли
│   │
│   └── 📄 modules_debug_2025-10-12.log        # 🔍 DEBUG МОДУЛЕЙ
│       └─> Детали работы каждого модуля
│       └─> MTF проверки, корреляции, и т.д.
│       └─> Только если DEBUG уровень
│
├── ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
├── 📂 backups/                                 # 💾 BACKUP (опционально)
│   │
│   ├── 📄 state_20251012_143000.json          # 📸 СНИМКИ СОСТОЯНИЯ
│   │   └─> Позиции, ордера, статистика
│   │   └─> Каждые 5 минут (incremental)
│   │   └─> JSON формат
│   │
│   └── 📄 trading_bot_20251012.db             # 🗃️ BACKUP БАЗЫ
│       └─> Полная копия БД
│       └─> Каждый день в 00:00 UTC
│       └─> Retention: 30 дней
│
├── ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
├── 📂 tests/                                   # 🧪 ТЕСТЫ (добавим)
│   │
│   ├── 📂 unit/                               # 🔬 UNIT ТЕСТЫ
│   │   ├── test_scalping_engine.py
│   │   │   └─> Тесты Scoring системы
│   │   │   └─> Тесты позиционирования
│   │   │
│   │   ├── test_grid_engine.py
│   │   │   └─> Тесты расчета Grid
│   │   │   └─> Тесты переоткрытия ордеров
│   │   │
│   │   ├── test_multi_timeframe.py
│   │   │   └─> Тесты MTF логики
│   │   │
│   │   └── test_indicators.py
│   │       └─> Тесты расчетов индикаторов
│   │
│   ├── 📂 integration/                        # 🔗 INTEGRATION
│   │   ├── test_okx_connection.py
│   │   │   └─> Реальные вызовы API
│   │   │
│   │   └── test_hybrid_orchestrator.py
│   │       └─> Переключения режимов
│   │
│   └── 📂 backtest/                           # 📈 BACKTEST
│       └── test_historical_strategy.py
│           └─> Тесты на истории
│
├── ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
├── 📂 scripts/                                 # 🔧 СКРИПТЫ УТИЛИТ
│   │
│   ├── 📄 collect_statistics.py               # 📊 СТАТИСТИКА
│   │   └─> Анализирует trading_bot.db
│   │   └─> Собирает статистику по часам
│   │   └─> Обновляет hour_statistics таблицу
│   │   └─> Запуск: python scripts/collect_statistics.py
│   │
│   ├── 📄 optimize_parameters.py              # 🎯 ОПТИМИЗАЦИЯ
│   │   └─> A/B тестирование параметров
│   │   └─> Grid search по конфигам
│   │   └─> Находит лучшие значения
│   │   └─> Запуск: python scripts/optimize_parameters.py
│   │
│   ├── 📄 backtest_runner.py                  # 🔙 BACKTEST
│   │   └─> Запускает бэктест на истории
│   │   └─> Использует data/historical/
│   │   └─> Генерирует отчет
│   │   └─> Запуск: python scripts/backtest_runner.py --days 90
│   │
│   └── 📄 generate_report.py                  # 📄 ОТЧЕТЫ
│       └─> Генерирует PDF/Excel отчеты
│       └─> Анализирует performance
│       └─> Экспорт для налогов
│
├── ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
├── 📂 docs/                                    # 📚 ДОКУМЕНТАЦИЯ
│   │
│   ├── ГЛУБОКИЙ_АНАЛИЗ_СТРАТЕГИИ.md           # Анализ индикаторов
│   ├── КОНЦЕПЦИЯ_ГИБРИДНОГО_БОТА.md           # Гибрид Scalp+Grid
│   ├── ДЕТАЛЬНОЕ_ОПИСАНИЕ_МОДУЛЕЙ.md          # Детали Phase 1-3
│   ├── ПЛАН_МОДЕРНИЗАЦИИ_СТРАТЕГИИ.md         # Roadmap
│   ├── СРАВНЕНИЕ_ДВУХ_ПРОЕКТОВ.md             # Проект A vs B
│   ├── АРХИТЕКТУРА_ГИБРИДНОГО_ПРОЕКТА.md      # Структура проекта
│   └── СХЕМА_АРХИТЕКТУРЫ_С_ОПИСАНИЯМИ.txt     # Этот файл!
│
├── ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
├── 📄 .env                                     # 🔐 СЕКРЕТЫ (НЕ В GIT!)
│   └─> OKX_API_KEY=...
│   └─> OKX_API_SECRET=...
│   └─> OKX_PASSPHRASE=...
│
├── 📄 .env.example                             # 📋 ПРИМЕР
│   └─> Шаблон для .env
│
├── 📄 .gitignore                               # 🚫 GIT IGNORE
│   └─> venv/, .env, *.log, __pycache__/, data/cache/
│
├── 📄 requirements.txt                         # 📦 ЗАВИСИМОСТИ
│   └─> Python пакеты (~20 строк)
│
├── 📄 config.yaml                              # ⚙️ КОНФИГ (симлинк)
│   └─> Симлинк на config/config.yaml
│
├── 📄 README.md                                # 📖 ДОКУМЕНТАЦИЯ
│   └─> Главная документация проекта
│
├── 📄 run_bot.py                               # ▶️ ЗАПУСК
│   └─> Простой запуск: python run_bot.py
│
├── 📄 start_bot.bat                            # 🪟 WINDOWS ЗАПУСК
│   └─> Двойной клик для запуска
│
└── 📄 stop_bot.bat                             # ⛔ WINDOWS ОСТАНОВКА
    └─> Двойной клик для остановки

═══════════════════════════════════════════════════════════════════════════════


🎯 ОБЩАЯ СТАТИСТИКА:

📊 Количество файлов:
   - Python файлов: ~30
   - Конфигураций: ~4
   - Документации: ~10
   - Скриптов: ~5
   - ИТОГО: ~50 файлов

📏 Количество строк кода:
   - Core: ~1,250
   - Strategies: ~3,000
   - Modules: ~2,400
   - Indicators: ~1,200
   - Filters: ~950
   - Risk: ~750
   - ML: ~1,400 (опционально)
   - Utils: ~450
   - Web: ~600 (опционально)
   - ИТОГО: ~8,700 строк (без ML и Web)
   - С ML и Web: ~12,000 строк

📂 Структура папок:
   - Глубина: 3 уровня (src/strategies/modules/)
   - Модульность: Высокая
   - Сложность: Средняя

💪 Управляемость:
   - Для 1 человека: ✅ ДА (с Feature Flags)
   - Время на изучение: 3-4 дня
   - Время на модификацию: Быстро (модули изолированы)


═══════════════════════════════════════════════════════════════════════════════
                            🔄 ПОТОК ДАННЫХ
═══════════════════════════════════════════════════════════════════════════════

                              ┌─────────────┐
                              │   OKX API   │
                              └──────┬──────┘
                                     │
                         ┌───────────▼────────────┐
                         │   okx_client.py        │
                         │  get_candles()         │
                         │  place_order()         │
                         └───────────┬────────────┘
                                     │
                         ┌───────────▼────────────┐
                         │   main.py              │
                         │   Инициализация        │
                         └───────────┬────────────┘
                                     │
                    ┌────────────────▼────────────────┐
                    │  hybrid_orchestrator.py         │
                    │  ┌─────────────────────────┐    │
                    │  │ Детектор режима:        │    │
                    │  │ - Volatility            │    │
                    │  │ - Trend Strength        │    │
                    │  │ → RANGING или TRENDING  │    │
                    │  └────────┬────────────────┘    │
                    └───────────┼─────────────────────┘
                                │
              ┌─────────────────┴─────────────────┐
              │                                   │
    ┌─────────▼──────────┐            ┌──────────▼─────────┐
    │  grid_engine.py    │            │ scalping_engine.py │
    │  (RANGING режим)   │            │ (TRENDING режим)   │
    └─────────┬──────────┘            └──────────┬─────────┘
              │                                   │
              │ Использует модули:                │ Использует модули:
              │ - Correlation ✅                   │ - Multi-timeframe ✅
              │ - Time Filter ✅                   │ - Correlation ✅
              │ - Pivots ✅                        │ - Time Filter ✅
              │ - Volume Profile ✅                │ - Pivots ✅
              │                                   │ - Volume Profile ✅
              │                                   │ - Order Book ✅
              │                                   │ - Liquidity Zones ✅
              │                                   │
              ├─> Генерация Grid ордеров          ├─> Scoring (0-12)
              ├─> Размещение сетки                ├─> Фильтры (MTF, Corr, ...)
              └─> Мониторинг исполнений           ├─> Бонусы (Pivots, VP, OB)
                                                  ├─> Порог >= 7
                                                  └─> Открытие позиции
                                                  
              ┌──────────────────────────────────┐
              │      Position Management         │
              │  - Break-even (1 ATR)            │
              │  - Trailing (1.5 ATR)            │
              │  - Partial TPs (3 уровня)        │
              │  - Time Stop (15 мин)            │
              └──────────────────────────────────┘


═══════════════════════════════════════════════════════════════════════════════
                        💡 КЛЮЧЕВЫЕ ПРИНЦИПЫ
═══════════════════════════════════════════════════════════════════════════════

1. МОДУЛЬНОСТЬ:
   ✅ Каждая фича - отдельный файл
   ✅ Легко добавить/убрать модуль
   ✅ Feature Flags для управления

2. ИЗОЛЯЦИЯ:
   ✅ Модули независимы
   ✅ Один сломался → остальные работают
   ✅ Легко тестировать отдельно

3. ПЕРЕИСПОЛЬЗОВАНИЕ:
   ✅ Shared modules для обоих движков
   ✅ Нет дублирования кода
   ✅ Обновили модуль → работает везде

4. ПОСТЕПЕННОСТЬ:
   ✅ Включаем модули по одному
   ✅ Тестируем каждый
   ✅ Откат возможен всегда

5. ПРОСТОТА:
   ✅ Не усложняем без нужды
   ✅ Нет Kubernetes, PostgreSQL (пока)
   ✅ Управляемо для 1 человека


═══════════════════════════════════════════════════════════════════════════════
                        🚀 СЛЕДУЮЩИЕ ШАГИ
═══════════════════════════════════════════════════════════════════════════════

1. ФАЗА 0: Рефакторинг (1 неделя)
   Создаем структуру папок
   Выделяем base_strategy.py
   scalping.py → scalping_engine.py
   Добавляем feature_flags.py

2. ФАЗА 1: Модули Phase 1 (6 недель)
   Week 1: multi_timeframe.py
   Week 2: correlation_filter.py
   Week 3: time_filter.py
   Week 4: pivot_points.py
   Week 5: volume_profile.py
   Week 6: Тестирование всех

3. ФАЗА 2: Модули Phase 2 (2 недели)
   Week 7: order_book_analyzer.py
   Week 8: liquidity_zones.py

4. ФАЗА 3: Grid Engine (2 недели)
   Week 9: grid_engine.py
   Week 10: Тестирование Grid

5. ФАЗА 4: Hybrid (2 недели)
   Week 11: hybrid_orchestrator.py
   Week 12: Интеграция + тесты

ИТОГО: 12 недель до полного Гибрида! 🎯


═══════════════════════════════════════════════════════════════════════════════
Готов начинать когда скажете! 🚀
═══════════════════════════════════════════════════════════════════════════════

