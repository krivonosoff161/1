# ‚úÖ –ü–û–õ–ù–´–ô –ß–ï–ö–õ–ò–°–¢ –õ–û–ì–ò–†–û–í–ê–ù–ò–Ø (–ù–∏—á–µ–≥–æ –ù–µ –£–ø—É—Å—Ç–∏–º!)

**–î–∞—Ç–∞:** 2026-01-07  
**–°—Ç–∞—Ç—É—Å:** –ü–†–ê–í–ò–õ–¨–ù–ê–Ø –í–ï–†–°–ò–Ø (–±–µ–∑ –ø—Ä–æ–ø—É—Å–∫–æ–≤)

---

## üéØ –ß–¢–û –ù–£–ñ–ù–û –õ–û–ì–ò–†–û–í–ê–¢–¨ (–° –î–ï–¢–ê–õ–Ø–ú–ò)

### –†–ê–ó–î–ï–õ A: –†–ï–ñ–ò–ú–´ –ò –ü–ê–†–ê–ú–ï–¢–†–´

#### A1: AdaptiveRegimeManager - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –†–µ–∂–∏–º–∞
```python
# –§–∞–π–ª: src/strategies/modules/adaptive_regime_manager.py
# –ö–∞–∂–¥—ã–π —Ä–∞–∑ –∫–æ–≥–¥–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —Ä–µ–∂–∏–º:

logger.info(f"[REGIME_MANAGER] {symbol}:")
logger.info(f"  Trend: {trend_strength:.3f} (strength)")
logger.info(f"  Volatility: {volatility:.4f}")
logger.info(f"  Range: {range_percent:.3f}%")
logger.info(f"  >> DETERMINED REGIME: {regime} (trending/consolidating/breakout)")

# –≠—Ç–æ –ö–†–ò–¢–ò–ß–ù–û - –±–µ–∑ —ç—Ç–æ–≥–æ –Ω–µ –∑–Ω–∞–µ–º –∫–∞–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–æ–ª–∂–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è!
```

#### A2: Per-Symbol Parameter Loading
```python
# –§–∞–π–ª: src/strategies/modules/adaptive_regime_manager.py
# –ö–æ–≥–¥–∞ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —Å–∏–º–≤–æ–ª–∞:

logger.info(f"[SYMBOL_PARAMS] {symbol}:")
logger.info(f"  Loaded from config: {yaml_path}")
logger.info(f"  RSI_PERIOD: {rsi_period}")
logger.info(f"  ATR_PERIOD: {atr_period}")
logger.info(f"  MACD_FAST: {macd_fast}, MACD_SLOW: {macd_slow}")
logger.info(f"  Regime params: {regime_params}")

# –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ª–∏ –æ–Ω–∏ –≤–æ–æ–±—â–µ!
```

#### A3: –í—ã–±–æ—Ä –ü–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (Signal Generator)
```python
# –§–∞–π–ª: src/strategies/scalping/futures/signal_generator.py
# –ö–æ–≥–¥–∞ –≤—ã–±–∏—Ä–∞—é—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –î–õ–Ø –ö–ê–ñ–î–û–ì–û –°–ò–ú–í–û–õ–ê:

logger.debug(f"[PARAM_SELECT] {symbol}:")
logger.debug(f"  Detected regime: {regime}")
logger.debug(f"  Using parameters:")
logger.debug(f"    - RSI_PERIOD: {rsi_period} (per-symbol={per_symbol})")
logger.debug(f"    - ATR_PERIOD: {atr_period} (per-symbol={per_symbol})")
logger.debug(f"    - MACD params: {macd_fast}/{macd_slow} (per-symbol={per_symbol})")
logger.debug(f"  Source: {'per_symbol' if per_symbol else 'GLOBAL (FALLBACK!)'}")

# –ö–õ–Æ–ß–ï–í–û–ô –í–û–ü–†–û–°: per_symbol=True –∏–ª–∏ False? –ó–¥–µ—Å—å –æ—Ç–≤–µ—Ç!
```

---

### –†–ê–ó–î–ï–õ B: –ò–ù–î–ò–ö–ê–¢–û–†–´ –ò –î–∞—Ç–∞–†–µ–≥–∏—Å—Ç—Ä

#### B1: Initialization DataRegistry
```python
# –§–∞–π–ª: src/strategies/scalping/futures/signal_generator.py
# –ü—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:

logger.info(f"[DATAREG_INIT] DataRegistry initialized")
logger.info(f"  Indicators available: {list(self.data_registry.indicators.keys())}")
logger.info(f"  Symbols: {list(self.data_registry.get_symbols())}")

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ –≤–æ–æ–±—â–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –≤ —Ä–µ–µ—Å—Ç—Ä–µ
```

#### B2: Indicator Calculation (For Each Symbol)
```python
# –§–∞–π–ª: src/indicators/indicator_manager.py
# –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–∏–º–≤–æ–ª–∞ –ø—Ä–∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏–∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤:

logger.debug(f"[INDICATOR] {symbol}: Calculating indicators")
logger.debug(f"  SMA20: {sma20_value:.4f}")
logger.debug(f"  EMA12: {ema12_value:.4f}")
logger.debug(f"  RSI14: {rsi14_value:.2f}")
logger.debug(f"  RSI(per_symbol): {rsi_custom_value:.2f} (if applicable)")
logger.debug(f"  MACD: {macd_value:.6f}, Signal: {macd_signal:.6f}")
logger.debug(f"  ATR14: {atr_value:.6f}")
logger.debug(f"  ATR(per_symbol): {atr_custom_value:.6f} (if applicable)")
logger.debug(f"  BB Upper: {bb_upper:.4f}, Lower: {bb_lower:.4f}")

# –ö–õ–Æ–ß–ï–í–û: –µ—Å—Ç—å –ª–∏ per_symbol –≤–µ—Ä—Å–∏–∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤? –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ª–∏ –æ–Ω–∏?
```

#### B3: DataRegistry Population
```python
# –§–∞–π–ª: src/strategies/scalping/futures/signal_generator.py
# –ö–æ–≥–¥–∞ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –≤ DataRegistry:

logger.debug(f"[DATAREG_STORE] {symbol}:")
logger.debug(f"  Stored ATR: {stored_atr:.6f}")
logger.debug(f"  Stored RSI: {stored_rsi:.2f}")
logger.debug(f"  Stored MACD: {stored_macd:.6f}")

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ –∂–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ—Ç–æ–º –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ executor?
```

#### B4: DataRegistry Retrieval in Order Executor
```python
# –§–∞–π–ª: src/strategies/scalping/futures/order_executor.py
# –ö–æ–≥–¥–∞ –ü–û–õ–£–ß–ê–Æ–¢–°–Ø –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –∏–∑ —Ä–µ–µ—Å—Ç—Ä–∞:

logger.debug(f"[DATAREG_GET] {symbol}:")
logger.debug(f"  Retrieved ATR from registry: {retrieved_atr:.6f}")
logger.debug(f"  Retrieved RSI from registry: {retrieved_rsi:.2f}")
if retrieved_atr != signal_atr:
    logger.warning(f"[DATAREG_MISMATCH] ATR changed: signal={signal_atr:.6f} ‚Üí registry={retrieved_atr:.6f}")

# –ö–†–ò–¢–ò–ß–ù–û: –Ω–∞—Ö–æ–¥–∏–º –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –º–µ–∂–¥—É signal –∏ executor!
```

---

### –†–ê–ó–î–ï–õ C: –°–ò–ì–ù–ê–õ–´ - –î–û –§–ò–õ–¨–¢–†–û–í

#### C1: Raw Signals (Before Filters)
```python
# –§–∞–π–ª: src/strategies/scalping/futures/signal_generator.py
# –°–†–ê–ó–£ –ø–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–∏–≥–Ω–∞–ª–∞ –∏–∑ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤:

logger.info(f"[RAW_SIGNAL #{signal_id}] {symbol}:")
logger.info(f"  Direction: {direction} (from indicators)")
logger.info(f"  Price: {price:.6f}")
logger.info(f"  Strength: {strength:.2f}")
logger.info(f"  ATR (signal): {atr_from_signal:.6f}")
logger.info(f"  Confidence: {confidence:.2f}")
logger.info(f"  Reason: {reason}")
logger.info(f"  Timestamp: {signal_timestamp}")

# –ù—É–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å signal_id –¥–ª—è –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏ –º–µ–∂–¥—É –ª–æ–≥–∞–º–∏!
```

#### C2: Signal Complete Object (Before Filters)
```python
# –ü–µ—Ä–µ–¥ –ø–µ—Ä–µ–¥–∞—á–µ–π –≤ —Ñ–∏–ª—å—Ç—Ä—ã:

logger.debug(f"[RAW_SIGNAL_FULL #{signal_id}] {symbol}:")
logger.debug(f"  Complete object:")
logger.debug(f"    - direction: {signal.get('direction')}")
logger.debug(f"    - price: {signal.get('price')}")
logger.debug(f"    - atr: {signal.get('atr')}")
logger.debug(f"    - rsi: {signal.get('rsi')}")
logger.debug(f"    - regime: {signal.get('regime')}")
logger.debug(f"    - all keys: {list(signal.keys())}")

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—Å—è –ª–∏ ATR –≤ signal –∏–ª–∏ —Ç–µ—Ä—è–µ—Ç—Å—è?
```

---

### –†–ê–ó–î–ï–õ D: –§–ò–õ–¨–¢–†–´

#### D1: Filter Input (What Enters Filter)
```python
# –§–∞–π–ª: src/strategies/scalping/futures/signals/filter_manager.py –∏–ª–∏ –∫–∞–∂–¥—ã–π —Ñ–∏–ª—å—Ç—Ä
# –ü–ï–†–ï–î –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º —Ñ–∏–ª—å—Ç—Ä–∞:

logger.info(f"[FILTER_INPUT] {filter_name}: {len(signals)} signals entering")
for sig in signals:
    logger.debug(f"  - {sig.get('symbol')}: {sig.get('direction')} @ {sig.get('price')}")

# –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –í–°–ï —Å–∏–≥–Ω–∞–ª—ã —á—Ç–æ –≤—Ö–æ–¥—è—Ç –≤ —Ñ–∏–ª—å—Ç—Ä
```

#### D2: Filter Logic Execution
```python
# –í–ù–£–¢–†–ò —Ñ–∏–ª—å—Ç—Ä–∞, –≤–æ –≤—Ä–µ–º—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —É—Å–ª–æ–≤–∏—è:

logger.debug(f"[FILTER_LOGIC] {filter_name} checking {symbol}:")
logger.debug(f"  Condition A: {condition_a} (pass={pass_a})")
logger.debug(f"  Condition B: {condition_b} (pass={pass_b})")
logger.debug(f"  Combined: {combined_result}")
logger.debug(f"  Decision: {'PASS' if decision == 'pass' else 'REJECT'}")

# –î–ª—è –ö–ê–ñ–î–û–ì–û —Ñ–∏–ª—å—Ç—Ä–∞ –ª–æ–≥–∏—Ä—É–µ–º –ö–ê–ñ–î–£–Æ –ø—Ä–æ–≤–µ—Ä–∫—É!
```

#### D3: Filter Output (Rejected Signals)
```python
# –ö–æ–≥–¥–∞ —Å–∏–≥–Ω–∞–ª –æ—Ç–∫–ª–æ–Ω—ë–Ω:

logger.info(f"[FILTER_REJECT #{signal_id}] {filter_name}:")
logger.info(f"  Symbol: {symbol}")
logger.info(f"  Original: {direction} @ {price}")
logger.info(f"  Reject reason: {detailed_reason}")
logger.info(f"  Failed condition: {failed_condition}")

# –ö–õ–Æ–ß–ï–í–û: —Ç–æ—á–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è!
```

#### D4: Filter Statistics (After Processing All)
```python
# –ü–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –í–°–ï —Å–∏–≥–Ω–∞–ª–æ–≤ —Ñ–∏–ª—å—Ç—Ä–æ–º:

logger.info(f"[FILTER_STATS] {filter_name}:")
logger.info(f"  Input: {input_count}")
logger.info(f"  Output: {output_count}")
logger.info(f"  Rejected: {input_count - output_count} ({(input_count-output_count)/input_count*100:.1f}%)")
logger.info(f"  Pass rate by direction:")
logger.info(f"    - BUY signals: {buy_pass}/{buy_input} passed ({buy_pass/buy_input*100:.1f}%)")
logger.info(f"    - SELL signals: {sell_pass}/{sell_input} passed ({sell_pass/sell_input*100:.1f}%)")

# –í–∏–¥–∏–º –∫–∞–∫–æ–π —Ñ–∏–ª—å—Ç—Ä –æ—Ç–∫–ª–æ–Ω—è–µ—Ç –±–æ–ª—å—à–µ!
```

---

### –†–ê–ó–î–ï–õ E: –§–ò–ù–ê–õ–¨–ù–´–ï –°–ò–ì–ù–ê–õ–´

#### E1: Final Signals (Ready to Execute)
```python
# –§–∞–π–ª: src/strategies/scalping/futures/signal_generator.py
# –ü–û–°–õ–ï –≤—Å–µ—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤:

logger.info(f"[FINAL_SIGNALS] Batch processing complete:")
logger.info(f"  Raw signals: {raw_count}")
logger.info(f"  Final signals: {final_count}")
logger.info(f"  Acceptance rate: {final_count/raw_count*100:.2f}%")
logger.info(f"  Rejected: {raw_count - final_count}")

for sig in final_signals:
    logger.info(f"[FINAL_SIG #{sig['id']}] {sig['symbol']}:")
    logger.info(f"  Direction: {sig['direction']}")
    logger.info(f"  Price: {sig['price']:.6f}")
    logger.info(f"  ATR (signal): {sig.get('atr'):.6f}")
    logger.info(f"  Regime: {sig.get('regime')}")
    logger.info(f"  Timestamp: {sig.get('timestamp')}")

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–æ—à–ª–∞ –¥–æ executor
```

---

### –†–ê–ó–î–ï–õ F: –ò–°–ü–û–õ–ù–ï–ù–ò–ï - ATR

#### F1: ATR Fetching (Before API Call)
```python
# –§–∞–π–ª: src/strategies/scalping/futures/order_executor.py
# –í _get_current_atr(), –î–û API call:

logger.info(f"[ATR_FETCH] {symbol}:")
logger.info(f"  Entry price: {price:.6f}")
logger.info(f"  Fetching from OKX API...")
logger.info(f"  Timestamp: {datetime.now().isoformat()}")

# –ë–µ—Ä—ë–º –≤—Ä–µ–º–µ–Ω–Ω—É—é –º–µ—Ç–∫—É –¥–ª—è –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏!
```

#### F2: ATR API Response
```python
# –°—Ä–∞–∑—É –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–∞:

logger.debug(f"[ATR_API] {symbol}:")
logger.debug(f"  Status: {resp.status}")
logger.debug(f"  Candles received: {len(candles)}")
logger.debug(f"  Time range: {candles[-1][0]} to {candles[0][0]} (in reverse)")
logger.debug(f"  High: {max(c[2] for c in candles):.6f}, Low: {min(c[3] for c in candles):.6f}")

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —á—Ç–æ –ø—Ä–∏—à–ª–∏
```

#### F3: ATR Calculation (If Successful)
```python
# –ï—Å–ª–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ candles:

logger.info(f"[ATR_CALC] {symbol}:")
logger.info(f"  Method: TR (True Range)")
logger.info(f"  Candles used: {len(candles)}")
logger.info(f"  TR values: {tr_values}")  # –ü–æ–∫–∞–∂–µ–º –≤—Å–µ TR
logger.info(f"  ATR value: {atr:.6f}")
logger.info(f"  ATR % of price: {atr/price*100:.4f}%")
logger.info(f"  ATR range: {atr_min:.6f} - {atr_max:.6f}")

# –í–∏–¥–∏–º –∫–∞–∫ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è
```

#### F4: ATR Fallback (When Fails)
```python
# –ï—Å–ª–∏ < 15 candles –∏–ª–∏ API failed:

logger.warning(f"[ATR_FALLBACK] {symbol}:")
logger.warning(f"  Reason: {'not enough candles' if len(candles) < 15 else 'API error'}")
logger.warning(f"  Candles available: {len(candles)}")
logger.warning(f"  Fallback formula: price * 0.01")
logger.warning(f"  Fallback value: {price * 0.01:.6f}")
logger.warning(f"  Fallback % of price: {0.01 * 100:.4f}%")

# –ö–õ–Æ–ß–ï–í–û: –∫–∞–∫ —á–∞—Å—Ç–æ fallback –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è!
```

#### F5: ATR vs Signal ATR (Comparison)
```python
# –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º ATR –æ—Ç signal —Å ATR —á—Ç–æ —Ä–∞—Å—Å—á–∏—Ç–∞–ª–∏:

atr_from_signal = signal.get('atr', -1)
logger.warning(f"[ATR_MISMATCH] {symbol}:")
logger.warning(f"  ATR from signal: {atr_from_signal:.6f}")
logger.warning(f"  ATR calculated now: {atr_now:.6f}")
logger.warning(f"  Difference: {abs(atr_from_signal - atr_now):.6f}")
logger.warning(f"  Relative diff: {abs(atr_from_signal - atr_now)/atr_now*100:.3f}%")

# –ù–∞—Ö–æ–¥–∏–º –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ!
```

---

### –†–ê–ó–î–ï–õ G: –ò–°–ü–û–õ–ù–ï–ù–ò–ï - SL/TP –†–ê–°–ß–Å–¢

#### G1: TP/SL Calculation Start
```python
# –§–∞–π–ª: src/strategies/scalping/futures/order_executor.py
# –í _calculate_tp_sl_prices(), –≤ –Ω–∞—á–∞–ª–µ:

logger.info(f"[TPSL_START] {symbol}:")
logger.info(f"  Signal ID: {signal.get('id')}")
logger.info(f"  Entry price: {entry_price:.6f}")
logger.info(f"  Side: {side}")
logger.info(f"  Timestamp: {datetime.now().isoformat()}")

# –î–ª—è –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏ —Å [RAW_SIGNAL]
```

#### G2: Regime Detection and Parameters
```python
# –ö–æ–≥–¥–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —Ä–µ–∂–∏–º –∏ –±–µ—Ä—É—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

logger.info(f"[TPSL_REGIME] {symbol}:")
logger.info(f"  Detected regime: {regime}")
logger.info(f"  Regime params: {regime_params}")
logger.info(f"  Per-symbol params loaded: {per_symbol_loaded}")

if not regime_params:
    logger.warning(f"[TPSL_REGIME] {symbol}: regime_params is None! Using defaults")

if not per_symbol_loaded:
    logger.warning(f"[TPSL_REGIME] {symbol}: Per-symbol params NOT loaded! Using global")
```

#### G3: ATR Selection
```python
# –ö–∞–∫–æ–π ATR –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è?

logger.info(f"[TPSL_ATR] {symbol}:")
logger.info(f"  ATR sources checked in order:")
logger.info(f"    1. Signal ATR: {signal.get('atr', 'NOT_PRESENT')}")
logger.info(f"    2. Registry ATR: {registry_atr if registry_available else 'NOT_AVAILABLE'}")
logger.info(f"    3. Fresh HTTP ATR: {http_atr if http_available else 'NOT_AVAILABLE'}")
logger.info(f"  >> SELECTED ATR: {selected_atr:.6f} (from source: {atr_source})")

# –í–∏–¥–∏–º –∫–∞–∫–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω!
```

#### G4: Multiplier Selection (TP/SL Parameters)
```python
# –ö–∞–∫–∏–µ –º–Ω–æ–∂–∏—Ç–µ–ª–∏ –¥–ª—è TP –∏ SL?

logger.info(f"[TPSL_MULTIPLIER] {symbol}:")
logger.info(f"  TP multiplier: {tp_multiplier:.2f}")
logger.info(f"    - Source: {'regime_params' if from_regime else 'global_config'}")
logger.info(f"    - Config value: tp_percent={config_tp}")
logger.info(f"  SL multiplier: {sl_multiplier:.2f}")
logger.info(f"    - Source: {'regime_params' if from_regime else 'global_config'}")
logger.info(f"    - Config value: sl_percent={config_sl}")
logger.info(f"  WARNING: Config says 'percent' but used as multiplier on ATR!")

# –ö–†–ò–¢–ò–ß–ù–û: –≤–∏–¥–∏–º –ø—É—Ç–∞–Ω–∏—Ü—É –ø—Ä–æ—Ü–µ–Ω—Ç vs –º–Ω–æ–∂–∏—Ç–µ–ª—å!
```

#### G5: Distance Calculation
```python
# –†–∞—Å—á—ë—Ç —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è:

logger.info(f"[TPSL_DISTANCE] {symbol}:")
logger.info(f"  ATR: {atr:.6f}")
logger.info(f"  TP distance = ATR √ó {tp_multiplier} = {tp_distance:.6f}")
logger.info(f"  SL distance = ATR √ó {sl_multiplier} = {sl_distance:.6f}")
logger.info(f"  Distance in %: TP={tp_distance/entry_price*100:.4f}%, SL={sl_distance/entry_price*100:.4f}%")

# –í–∏–¥–∏–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –≤ –∞–±—Å–æ–ª—é—Ç–∞—Ö –∏ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö
```

#### G6: Fallback Check (If SL Too Small)
```python
# –ï—Å–ª–∏ SL —Å–ª–∏—à–∫–æ–º –º–∞–ª - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è fallback –Ω–∞ –ø—Ä–æ—Ü–µ–Ω—Ç:

if use_percent_fallback:
    logger.warning(f"[TPSL_FALLBACK] {symbol}:")
    logger.warning(f"  ATR-based SL too small: {sl_distance:.6f}")
    logger.warning(f"  Fallback to percent-based SL")
    logger.warning(f"  SL percent: {sl_percent}%")
    logger.warning(f"  SL percent abs: {sl_percent_abs:.6f}")
    logger.warning(f"  New SL distance: {sl_distance_new:.6f}")
    logger.warning(f"  PROBLEM: Both ATR and percent fallback are small!")
    logger.warning(f"    ATR-based: {atr * sl_multiplier:.6f}")
    logger.warning(f"    Percent-based: {sl_percent_abs:.6f}")
    logger.warning(f"    Minimum: {min(atr * sl_multiplier, sl_percent_abs):.6f}")

# –ö–õ–Æ–ß–ï–í–û: –≤–∏–¥–∏–º –ø—Ä–æ–±–ª–µ–º—É —Å micro-–ø–∞—Ä–∞–º–∏!
```

#### G7: Final TP/SL Prices
```python
# –§–∏–Ω–∞–ª—å–Ω—ã–µ —Ü–µ–Ω—ã:

logger.info(f"[TPSL_FINAL] {symbol}:")
logger.info(f"  Entry:        {entry_price:.6f}")
logger.info(f"  TP:           {tp_price:.6f}")
logger.info(f"  SL:           {sl_price:.6f}")
logger.info(f"  TP distance:  {abs(tp_price - entry_price):.6f} ({abs(tp_price - entry_price)/entry_price*100:.4f}%)")
logger.info(f"  SL distance:  {abs(sl_price - entry_price):.6f} ({abs(sl_price - entry_price)/entry_price*100:.4f}%)")
logger.info(f"  Risk/Reward:  {abs(sl_price - entry_price) / abs(tp_price - entry_price):.3f}x")

if abs(sl_price - entry_price) < entry_price * 0.0001:
    logger.error(f"[TPSL_ERROR] {symbol}: SL is IDENTICAL to entry! BUG!")

# –ù–∞—Ö–æ–¥–∏–º entry=stop bug –∏–º–µ–Ω–Ω–æ –∑–¥–µ—Å—å!
```

---

### –†–ê–ó–î–ï–õ H: –ò–°–ü–û–õ–ù–ï–ù–ò–ï - –†–ê–ó–ú–ï–† –ü–û–ó–ò–¶–ò–ò

#### H1: Position Size Calculation
```python
# –§–∞–π–ª: src/strategies/scalping/futures/order_executor.py
# –ö–æ–≥–¥–∞ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è —Ä–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏:

logger.info(f"[POS_SIZE] {symbol}:")
logger.info(f"  Account balance: {balance:.2f} USD")
logger.info(f"  Risk per trade: {risk_percent}%")
logger.info(f"  Risk amount: {risk_amount:.2f} USD")
logger.info(f"  SL distance: {sl_distance:.6f}")
logger.info(f"  Position size = Risk / SL = {risk_amount} / {sl_distance}")
logger.info(f"  Position size: {quantity} contracts")

# –í–∏–¥–∏–º –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è —Ä–∞–∑–º–µ—Ä
```

#### H2: Risk Controller Check
```python
# –ü–µ—Ä–µ–¥ –æ—Ç–∫—Ä—ã—Ç–∏–µ–º –ø–æ–∑–∏—Ü–∏–∏ - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∏—Å–∫–∞:

logger.info(f"[RISK_CHECK] {symbol}:")
logger.info(f"  Max position % of balance: {max_pos_percent}%")
logger.info(f"  Max open positions: {max_open_pos}")
logger.info(f"  Daily loss limit: {daily_loss_limit} USD")
logger.info(f"  Current open positions: {current_open}")
logger.info(f"  Current daily loss: {daily_loss:.2f} USD")
logger.info(f"  Check results:")
logger.info(f"    - Position size OK: {size_ok}")
logger.info(f"    - Not exceeding max open: {open_ok}")
logger.info(f"    - Daily loss OK: {loss_ok}")
logger.info(f"  Final decision: {'ALLOW' if allow else 'REJECT'}")

# –í–∏–¥–∏–º –∫–∞–∫–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è risk controller
```

---

### –†–ê–ó–î–ï–õ I: –†–ê–ó–ú–ï–©–ï–ù–ò–ï –û–†–î–ï–†–ê

#### I1: Before Placing Order
```python
# –§–∞–π–ª: src/strategies/scalping/futures/order_executor.py
# –ü–µ—Ä–µ–¥ API call:

logger.info(f"[ORDER_PLACE] {symbol}: BEFORE API CALL:")
logger.info(f"  ID: {order_id if hasattr else 'auto-generated'}")
logger.info(f"  Symbol: {symbol}-SWAP")
logger.info(f"  Side: {side} ({side.upper()})")
logger.info(f"  Entry price: {entry_price:.6f}")
logger.info(f"  Entry order: Market")
logger.info(f"  TP price: {tp_price:.6f}")
logger.info(f"  TP order: Limit")
logger.info(f"  SL price: {sl_price:.6f}")
logger.info(f"  SL order: Market")
logger.info(f"  Quantity: {quantity}")
logger.info(f"  Leverage: {leverage}x")
logger.info(f"  Type: OCO (One Cancels Other)")
logger.info(f"  Timestamp: {datetime.now().isoformat()}")

# –í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ—Ä–¥–µ—Ä–∞ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
```

#### I2: API Response
```python
# –°—Ä–∞–∑—É –ø–æ—Å–ª–µ API call:

logger.info(f"[ORDER_PLACED] {symbol}: API Response:")
logger.info(f"  Status: {resp.status if hasattr else 'unknown'}")
logger.info(f"  Order ID: {order_id}")
logger.info(f"  Response time: {response_time_ms}ms")

if status != 200:
    logger.error(f"[ORDER_ERROR] {symbol}: API Error {status}")
    logger.error(f"  Error code: {error_code}")
    logger.error(f"  Error message: {error_message}")

# –í–∏–¥–∏–º —É—Å–ø–µ—à–Ω–æ –ª–∏ —Ä–∞–∑–º–µ—â–µ–Ω –æ—Ä–¥–µ—Ä
```

---

### –†–ê–ó–î–ï–õ J: –ó–ê–ö–†–´–¢–ò–ï –ü–û–ó–ò–¶–ò–ò

#### J1: Position Closed
```python
# –§–∞–π–ª: src/strategies/scalping/futures/position_manager.py
# –ö–æ–≥–¥–∞ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø–æ–∑–∏—Ü–∏—è:

logger.info(f"[POSITION_CLOSE] {symbol}:")
logger.info(f"  Order ID: {order_id}")
logger.info(f"  Entry price: {entry_price:.6f}")
logger.info(f"  Exit price: {exit_price:.6f}")
logger.info(f"  Quantity: {quantity}")
logger.info(f"  Close reason: {close_reason}")  # tp_hit, sl_hit, time_limit, etc.
logger.info(f"  Duration: {duration_seconds}s")
logger.info(f"  P&L: {pnl:.6f} USD")
logger.info(f"  P&L %: {pnl_percent:.4f}%")
logger.info(f"  Timestamp: {datetime.now().isoformat()}")

# –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–¥–µ–ª–∫–∏
```

#### J2: Trade Analysis
```python
# –ü–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è - –∞–Ω–∞–ª–∏–∑:

logger.info(f"[TRADE_ANALYSIS] {symbol}:")
logger.info(f"  Win/Loss: {'WIN ‚úì' if pnl > 0 else 'LOSS ‚úó'}")
logger.info(f"  P&L in points: {pnl_points}")
logger.info(f"  Original risk: {original_risk_usd:.2f} USD")
logger.info(f"  Risk/Reward ratio: {pnl / original_risk_usd:.2f}x")
logger.info(f"  Expected RR: 1.0x (if risk = {expected_loss})")
logger.info(f"  Signal quality: {signal_quality_metrics}")

# –í–∏–¥–∏–º –ø–æ—á–µ–º—É –≤—ã–∏–≥—Ä–∞–ª–∞ –∏–ª–∏ –ø—Ä–æ–∏–≥—Ä–∞–ª–∞ —Å–¥–µ–ª–∫–∞
```

---

## üìä –§–ò–õ–¨–¢–†–´ - –î–ï–¢–ê–õ–¨–ù–û–ï –õ–û–ì–ò–†–û–í–ê–ù–ò–ï

### –î–ª—è –ö–ê–ñ–î–û–ì–û —Ñ–∏–ª—å—Ç—Ä–∞ –ª–æ–≥–∏—Ä—É–µ–º:

```python
# Template –¥–ª—è –≤—Å–µ—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤:

class AnyFilter:
    def apply(self, signals):
        logger.debug(f"[{self.NAME}] START: {len(signals)} signals")
        
        passed = []
        rejected = []
        
        for sig in signals:
            symbol = sig['symbol']
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ª–æ–≤–∏–µ
            logger.debug(f"[{self.NAME}] Checking {symbol}")
            logger.debug(f"  Condition 1: {condition1} ‚Üí {result1}")
            logger.debug(f"  Condition 2: {condition2} ‚Üí {result2}")
            
            if passes:
                passed.append(sig)
                logger.debug(f"  >> PASS")
            else:
                rejected.append(sig)
                logger.warning(f"  >> REJECT: {reason}")
        
        logger.info(f"[{self.NAME}] RESULT:")
        logger.info(f"  Input: {len(signals)}")
        logger.info(f"  Passed: {len(passed)} ({len(passed)/len(signals)*100:.1f}%)")
        logger.info(f"  Rejected: {len(rejected)} ({len(rejected)/len(signals)*100:.1f}%)")
        
        return passed
```

---

## üîó –ö–û–†–†–ï–õ–Ø–¶–ò–Ø –ú–ï–ñ–î–£ –õ–û–ì–ê–ú–ò

–ß—Ç–æ–±—ã —Å–æ–æ—Ç–Ω–µ—Å—Ç–∏ –ª–æ–≥–∏ –º–µ–∂–¥—É –º–æ–¥—É–ª—è–º–∏ - –∏—Å–ø–æ–ª—å–∑—É–µ–º:

```python
# 1. Signal ID (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å–∏–≥–Ω–∞–ª–∞):
signal_id = f"{symbol}_{timestamp_ms}_{sequence_number}"
logger.info(f"[XXX #{signal_id}]")

# 2. Timestamp (–¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω–æ–π –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏):
logger.info(f"  Timestamp: {datetime.now().isoformat()}")

# 3. Tracking number (—á–µ—Ä–µ–∑ –≤–µ—Å—å –ø—Ä–æ—Ü–µ—Å—Å):
order_tracking = f"SIG_{signal_id}‚ÜíORD_{order_id}‚ÜíPOS_{position_id}"
logger.info(f"  Tracking: {order_tracking}")
```

–¢–æ–≥–¥–∞ –≤ –ª–æ–≥–∞—Ö –º–æ–∂–µ–º –Ω–∞–π—Ç–∏:
```
[RAW_SIGNAL #BTC_1673000001000_1] ...
  [FILTER_REJECT] ...
  [FILTER_ACCEPT] ...
[FINAL_SIG #BTC_1673000001000_1] ...
[ORDER_PLACE #BTC_1673000001000_1] ...
[POSITION_CLOSE #BTC_1673000001000_1] ...
```

---

## üìù –°–ö–û–õ–¨–ö–û –õ–û–ì–û–í –ü–û–ù–ê–î–û–ë–ò–¢–°–Ø

**–î–ª—è 1 —á–∞—Å–∞ —Ç–æ—Ä–≥–æ–≤–ª–∏ (~100-200 –ø–æ–ø—ã—Ç–æ–∫):**

```
RAW signals: 100-200 —Å—Ç—Ä–æ–∫
Filter operations: 500-1000 —Å—Ç—Ä–æ–∫
Final signals: 20-50 —Å—Ç—Ä–æ–∫
Order execution: 200-400 —Å—Ç—Ä–æ–∫ (20-50 –ø–æ—Ä—è–¥–∫–æ–≤ √ó 10-20 —Å—Ç—Ä–æ–∫)
Position closes: 50-100 —Å—Ç—Ä–æ–∫
ATR operations: 100-200 —Å—Ç—Ä–æ–∫
TP/SL calculations: 200-400 —Å—Ç—Ä–æ–∫
```

**–ò—Ç–æ–≥–æ:** ~1500-3000 —Å—Ç—Ä–æ–∫ –ª–æ–≥–æ–≤ –Ω–∞ 1 —á–∞—Å  
**–†–∞–∑–º–µ—Ä:** ~500 KB - 1 MB  
**–í—Ä–µ–º—è –∞–Ω–∞–ª–∏–∑–∞:** 30-60 –º–∏–Ω—É—Ç

---

## ‚úÖ –ß–ï–ö–õ–ò–°–¢ –î–û –ó–ê–ü–£–°–ö–ê

–ü–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —É–±–µ–¥–∏—Ç–µ—Å—å:

- [ ] –ù–µ—Ç –∫—Ä–∏—Ç–∏—á–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (–Ω–µ –∑–∞–º–µ–¥–ª–∏—Ç —Å–∏—Å—Ç–µ–º—É)
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –µ—Å—Ç—å –≤ —Å–∏–≥–Ω–∞–ª-–ø–∞—Ç—Ç–µ—Ä–Ω–∞—Ö (`[TAG]`)
- [ ] –í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏ –≤–µ–∑–¥–µ (`datetime.now().isoformat()`)
- [ ] Signal ID –≤–µ–∑–¥–µ –¥–ª—è –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏
- [ ] Per-symbol –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
- [ ] Fallback —Å–∏—Ç—É–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
- [ ] –í—Å–µ —Ñ–∏–ª—å—Ç—Ä—ã –ª–æ–≥–∏—Ä—É—é—Ç –≤—Ö–æ–¥—ã/–≤—ã—Ö–æ–¥—ã
- [ ] –û—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –∫–∞–∫ `ERROR` –Ω–µ `DEBUG`
- [ ] –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è `None` –∏ –≤–≤–æ–¥—è—Ç—Å—è –ª–æ–≥–∞—Ä–∏—Ñ–º–∏—á–µ—Å–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è

---

## üéØ –≠–¢–ê–ü –ê–ù–ê–õ–ò–ó–ê

–ü–æ—Å–ª–µ —Å–±–æ—Ä–∞ –ª–æ–≥–æ–≤ - –±—É–∫–≤–∞–ª—å–Ω–æ —Ä–∞–∑–±–∏—Ä–∞–µ–º—Å—è:

```bash
# –°–∫–æ–ª—å–∫–æ RAW —Å–∏–≥–Ω–∞–ª–æ–≤?
grep -c "\[RAW_SIGNAL" logs/*.log

# –ö–∞–∫–æ–π —Ñ–∏–ª—å—Ç—Ä –æ—Ç–∫–ª–æ–Ω—è–µ—Ç –±–æ–ª—å—à–µ?
grep "\[FILTER\]" logs/*.log | cut -d: -f1 | sort | uniq -c | sort -rn

# –ö–∞–∫ —á–∞—Å—Ç–æ fallback?
grep -c "FALLBACK" logs/*.log

# –ï—Å—Ç—å –ª–∏ entry=stop?
grep "Entry.*Stop" logs/*.log | grep "IDENTICAL\|equal"

# Per-symbol –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è?
grep "Per-symbol params" logs/*.log | grep "NOT\|FALSE"
```

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ - **100% –∑–Ω–∞–µ–º –≥–¥–µ –ø—Ä–æ–±–ª–µ–º–∞**!

