# –ê–ù–ê–õ–ò–ó: TP –∏ Trailing Stop Loss –ø–æ —Ä–µ–∂–∏–º–∞–º

## üîç –¢–ï–ö–£–©–ê–Ø –°–ò–¢–£–ê–¶–ò–Ø

### 1. TP (Take Profit)

**–ü—Ä–æ–±–ª–µ–º–∞**: 
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `tp_percent` –Ω–∞ –≤–µ—Ä—Ö–Ω–µ–º —É—Ä–æ–≤–Ω–µ —Å–∏–º–≤–æ–ª–∞ (per-symbol)
- ‚ùå **–ù–ï –¥–æ–±–∞–≤–ª–µ–Ω** `tp_percent` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ–∂–∏–º–∞ (trending, ranging, choppy)
- ‚ö†Ô∏è –í –∫–æ–Ω—Ñ–∏–≥–µ –µ—Å—Ç—å `tp_atr_multiplier` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ–∂–∏–º–∞, –Ω–æ –æ–Ω –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ—Ü–µ–Ω—Ç–Ω–æ–≥–æ TP

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
```python
# position_manager.py
tp_percent = self.scalping_config.tp_percent  # –ì–ª–æ–±–∞–ª—å–Ω—ã–π (fallback)
symbol_tp_percent = symbol_dict.get("tp_percent")  # Per-symbol (–≤–µ—Ä—Ö–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å)
# ‚ùå –ù–ï–¢ per-regime tp_percent!
```

### 2. Trailing Stop Loss

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç**:
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç **–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ** –æ—Ç TP
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–æ—Ü–µ–Ω—Ç—ã –æ—Ç **—Ü–µ–Ω—ã** (–Ω–µ –æ—Ç –º–∞—Ä–∂–∏)
- ‚úÖ –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: `initial_trail`, `max_trail`, `min_trail` (–≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö –æ—Ç —Ü–µ–Ω—ã)
- ‚úÖ –£–∂–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç per-regime –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —á–µ—Ä–µ–∑ `trailing_sl` –≤ —Ä–µ–∂–∏–º–∞—Ö

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
```python
# trailing_stop_loss.py
stop_loss = highest_price * (1 - current_trail)  # –ü—Ä–æ—Ü–µ–Ω—Ç –æ—Ç —Ü–µ–Ω—ã
# –ù–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç TP!
```

---

## üéØ –ß–¢–û –ù–£–ñ–ù–û –ò–°–ü–†–ê–í–ò–¢–¨

### 1. –î–æ–±–∞–≤–∏—Ç—å per-regime TP

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ**: –†–∞–∑–Ω—ã–µ TP –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ä–µ–∂–∏–º–æ–≤:
- **Trending**: –ë–æ–ª—å—à–µ TP (–±–æ–ª—å—à–µ —Ä–∏—Å–∫, –±–æ–ª—å—à–µ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª)
- **Ranging**: –°—Ä–µ–¥–Ω–∏–π TP (—Å—Ç–∞–Ω–¥–∞—Ä—Ç)
- **Choppy**: –ú–µ–Ω—å—à–µ TP (–±—ã—Å—Ç—Ä—ã–π –≤—ã—Ö–æ–¥)

**–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–∏—Ç—å `tp_percent` –≤ –∫–∞–∂–¥—ã–π —Ä–µ–∂–∏–º –≤ `symbol_profiles`:

```yaml
symbol_profiles:
  BTC-USDT:
    tp_percent: 1.0  # Fallback (–µ—Å–ª–∏ —Ä–µ–∂–∏–º –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω)
    trending:
      tp_percent: 1.2  # ‚úÖ –ù–û–í–û–ï: –ë–æ–ª—å—à–µ TP –¥–ª—è —Ç—Ä–µ–Ω–¥–∞
      # ... –¥—Ä—É–≥–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
    ranging:
      tp_percent: 1.0  # ‚úÖ –ù–û–í–û–ï: –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π TP
      # ... –¥—Ä—É–≥–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
    choppy:
      tp_percent: 0.8  # ‚úÖ –ù–û–í–û–ï: –ú–µ–Ω—å—à–µ TP –¥–ª—è —Ö–∞–æ—Å–∞
      # ... –¥—Ä—É–≥–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
```

### 2. –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è per-regime TP

**–§–∞–π–ª**: `src/strategies/scalping/futures/position_manager.py`

```python
# –ü–æ–ª—É—á–∞–µ–º —Ä–µ–∂–∏–º –∏–∑ –ø–æ–∑–∏—Ü–∏–∏ –∏–ª–∏ —Å–∏–≥–Ω–∞–ª–∞
regime = position.get("regime") or signal.get("regime")

# –ü–æ–ª—É—á–∞–µ–º tp_percent –¥–ª—è —Å–∏–º–≤–æ–ª–∞ –∏ —Ä–µ–∂–∏–º–∞
tp_percent = self.scalping_config.tp_percent  # –ì–ª–æ–±–∞–ª—å–Ω—ã–π (fallback)
if symbol and self.symbol_profiles:
    symbol_profile = self.symbol_profiles.get(symbol, {})
    if symbol_profile:
        symbol_dict = self._to_dict(symbol_profile)
        
        # 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º per-regime TP
        if regime and regime.lower() in symbol_dict:
            regime_profile = symbol_dict[regime.lower()]
            regime_tp = regime_profile.get("tp_percent")
            if regime_tp is not None:
                tp_percent = float(regime_tp)
                logger.debug(f"üìä Per-regime TP –¥–ª—è {symbol} ({regime}): {tp_percent}%")
        
        # 2. Fallback: per-symbol TP
        elif "tp_percent" in symbol_dict:
            tp_percent = float(symbol_dict["tp_percent"])
            logger.debug(f"üìä Per-symbol TP –¥–ª—è {symbol}: {tp_percent}%")
```

---

## üìä –ü–†–ï–î–õ–û–ñ–ï–ù–ò–Ø –ü–û –ù–ê–°–¢–†–û–ô–ö–ê–ú

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

**–õ–æ–≥–∏–∫–∞**: –ë–æ–ª—å—à–µ TP –¥–ª—è —Ç—Ä–µ–Ω–¥–∞ (–±–æ–ª—å—à–µ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª), –º–µ–Ω—å—à–µ –¥–ª—è —Ö–∞–æ—Å–∞ (–±—ã—Å—Ç—Ä—ã–π –≤—ã—Ö–æ–¥)

| –†–µ–∂–∏–º | BTC-USDT | ETH-USDT | SOL-USDT | DOGE-USDT | XRP-USDT |
|-------|----------|----------|----------|-----------|----------|
| **Trending** | 1.2% | 1.15% | 1.1% | 1.0% | 1.0% |
| **Ranging** | 1.0% | 0.95% | 0.9% | 0.85% | 0.85% |
| **Choppy** | 0.8% | 0.75% | 0.7% | 0.65% | 0.65% |

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ê–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π

**–õ–æ–≥–∏–∫–∞**: –ú–µ–Ω—å—à–µ TP –¥–ª—è —Ç—Ä–µ–Ω–¥–∞ (–¥–µ—Ä–∂–∏–º –¥–æ–ª—å—à–µ), –±–æ–ª—å—à–µ –¥–ª—è —Ö–∞–æ—Å–∞ (–±—ã—Å—Ç—Ä—ã–π –≤—ã—Ö–æ–¥)

| –†–µ–∂–∏–º | BTC-USDT | ETH-USDT | SOL-USDT | DOGE-USDT | XRP-USDT |
|-------|----------|----------|----------|-----------|----------|
| **Trending** | 0.9% | 0.85% | 0.8% | 0.75% | 0.75% |
| **Ranging** | 1.0% | 0.95% | 0.9% | 0.85% | 0.85% |
| **Choppy** | 1.1% | 1.05% | 1.0% | 0.95% | 0.95% |

### –í–∞—Ä–∏–∞–Ω—Ç 3: –°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

**–õ–æ–≥–∏–∫–∞**: –°—Ä–µ–¥–Ω–∏–π TP –¥–ª—è –≤—Å–µ—Ö —Ä–µ–∂–∏–º–æ–≤, –Ω–æ —Ä–∞–∑–Ω—ã–µ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ø–∞—Ä

| –†–µ–∂–∏–º | BTC-USDT | ETH-USDT | SOL-USDT | DOGE-USDT | XRP-USDT |
|-------|----------|----------|----------|-----------|----------|
| **Trending** | 1.1% | 1.05% | 1.0% | 0.95% | 0.95% |
| **Ranging** | 1.0% | 0.95% | 0.9% | 0.85% | 0.85% |
| **Choppy** | 0.9% | 0.85% | 0.8% | 0.75% | 0.75% |

---

## üîó TRAILING STOP LOSS –ò TP

### –ö–∞–∫ –æ–Ω–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –≤–º–µ—Å—Ç–µ:

1. **TP (Take Profit)**:
   - –ü—Ä–æ—Ü–µ–Ω—Ç –æ—Ç **–º–∞—Ä–∂–∏**
   - –ó–∞–∫—Ä—ã–≤–∞–µ—Ç –ø–æ–∑–∏—Ü–∏—é –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ —Ü–µ–ª–µ–≤–æ–π –ø—Ä–∏–±—ã–ª–∏
   - –†–∞–±–æ—Ç–∞–µ—Ç **–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ** –æ—Ç Trailing Stop Loss

2. **Trailing Stop Loss**:
   - –ü—Ä–æ—Ü–µ–Ω—Ç –æ—Ç **—Ü–µ–Ω—ã**
   - –ó–∞—â–∏—â–∞–µ—Ç –ø—Ä–∏–±—ã–ª—å –ø—Ä–∏ —Ä–∞–∑–≤–æ—Ä–æ—Ç–∞—Ö
   - –†–∞–±–æ—Ç–∞–µ—Ç **–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ** –æ—Ç TP

3. **–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ**:
   - –ï—Å–ª–∏ —Ü–µ–Ω–∞ –¥–æ—Å—Ç–∏–≥–ª–∞ TP ‚Üí –ø–æ–∑–∏—Ü–∏—è –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø–æ TP
   - –ï—Å–ª–∏ —Ü–µ–Ω–∞ —Ä–∞–∑–≤–µ—Ä–Ω—É–ª–∞—Å—å –∏ –¥–æ—Å—Ç–∏–≥–ª–∞ Trailing SL ‚Üí –ø–æ–∑–∏—Ü–∏—è –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø–æ Trailing SL
   - **–û–±–∞ —Ä–∞–±–æ—Ç–∞—é—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ**, —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–æ—Ç, –∫–æ—Ç–æ—Ä—ã–π –¥–æ—Å—Ç–∏–≥–Ω—É—Ç –ø–µ—Ä–≤—ã–º

### –ü—Ä–∏–º–µ—Ä:

**–ü–æ–∑–∏—Ü–∏—è BTC-USDT (trending —Ä–µ–∂–∏–º)**:
- –†–∞–∑–º–µ—Ä: $122.16
- –ú–∞—Ä–∂–∞: $24.43
- TP: 1.2% –æ—Ç –º–∞—Ä–∂–∏ = $0.293
- Trailing SL: 0.5% –æ—Ç —Ü–µ–Ω—ã = $525 (–ø—Ä–∏ —Ü–µ–Ω–µ $105,000)

**–°—Ü–µ–Ω–∞—Ä–∏–π 1**: –¶–µ–Ω–∞ –≤—ã—Ä–æ—Å–ª–∞ –Ω–∞ 1.2% –æ—Ç –º–∞—Ä–∂–∏ ‚Üí **TP —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç**

**–°—Ü–µ–Ω–∞—Ä–∏–π 2**: –¶–µ–Ω–∞ –≤—ã—Ä–æ—Å–ª–∞ –Ω–∞ 0.8%, –∑–∞—Ç–µ–º —Ä–∞–∑–≤–µ—Ä–Ω—É–ª–∞—Å—å –Ω–∞ 0.5% ‚Üí **Trailing SL —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç**

---

## ‚úÖ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

1. **–î–æ–±–∞–≤–∏—Ç—å per-regime TP** –≤ –∫–æ–Ω—Ñ–∏–≥ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–∏–º–≤–æ–ª–∞
2. **–û–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥** –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è per-regime TP
3. **Trailing Stop Loss** —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ (–Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç TP)
4. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –í–∞—Ä–∏–∞–Ω—Ç 3 (–°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)** –¥–ª—è –Ω–∞—á–∞–ª–∞

---

## üìã –ü–õ–ê–ù –†–ï–ê–õ–ò–ó–ê–¶–ò–ò

1. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å `tp_percent` –≤ –∫–∞–∂–¥—ã–π —Ä–µ–∂–∏–º –≤ `symbol_profiles`
2. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥ –≤ `position_manager.py` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è per-regime TP
3. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —Ä–µ–∂–∏–º–∞—Ö
4. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

