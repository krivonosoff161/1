# üìä –ê–Ω–∞–ª–∏–∑ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ö–∏–º—ã: –£–º–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –Ω–∞ –±–∞–∑–µ –ø–æ–ª–Ω–æ–≥–æ —Ä—ã–Ω–æ—á–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞

## ‚úÖ –ß—Ç–æ –ø–æ–Ω—è—Ç–Ω–æ –∏ –≥–æ—Ç–æ–≤–æ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### 1. **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è**
- ‚úÖ –õ–æ–≥–∏–∫–∞ –ø–æ–Ω—è—Ç–Ω–∞: –ø—Ä–æ–≤–µ—Ä—è—Ç—å —É–±—ã—Ç–æ—á–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ (‚â• 1.5 * SL) —á–µ—Ä–µ–∑ 7 –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤
- ‚úÖ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–æ—Å—Ç—å –Ω–µ –ª–æ–º–∞–µ—Ç—Å—è: SmartExit ‚Üí ExitAnalyzer ‚Üí TSL
- ‚úÖ –ú–µ—Å—Ç–æ –≤—Å—Ç–∞–≤–∫–∏ —è—Å–Ω–æ: –ø–µ—Ä–µ–¥ –ø—Ä–æ–≤–µ—Ä–∫–æ–π `max_holding_exceeded_but_loss` –≤ –∫–∞–∂–¥–æ–º —Ä–µ–∂–∏–º–Ω–æ–º –º–µ—Ç–æ–¥–µ

### 2. **–ß—Ç–æ —É–∂–µ –µ—Å—Ç—å –≤ –∫–æ–¥–µ**

#### ‚úÖ –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
- **`_check_reversal_signals`** (—Å—Ç—Ä–æ–∫–∏ 773-831) ‚Äî —É–∂–µ –µ—Å—Ç—å, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `bool`
- **`_analyze_trend_strength`** (—Å—Ç—Ä–æ–∫–∏ 729-771) ‚Äî —É–∂–µ –µ—Å—Ç—å, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `Dict`
- **`data_registry.get_price(symbol)`** ‚Äî –µ—Å—Ç—å –º–µ—Ç–æ–¥ –ø–æ–ª—É—á–µ–Ω–∏—è —Ü–µ–Ω—ã
- **`data_registry.get_candles(symbol, timeframe)`** ‚Äî –µ—Å—Ç—å –º–µ—Ç–æ–¥ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–≤–µ—á–µ–π
- **`VolumeProfileCalculator`** ‚Äî —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ `src/indicators/advanced/volume_profile.py`
- **`PivotCalculator`** ‚Äî —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ `src/indicators/advanced/pivot_calculator.py`
- **`FundingRateMonitor`** ‚Äî —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –¥–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑ `orchestrator.funding_monitor`
- **`LiquidityFilter`** ‚Äî —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –Ω–æ —ç—Ç–æ —Ñ–∏–ª—å—Ç—Ä –¥–ª—è –≤—Ö–æ–¥–∞, –Ω–µ –¥–ª—è —É—Ä–æ–≤–Ω–µ–π –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏

#### ‚úÖ –î–æ—Å—Ç—É–ø–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:
- `self.orchestrator` ‚Äî –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø
- `self.data_registry` ‚Äî –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø
- `self.order_flow` ‚Äî –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø
- `self.fast_adx` ‚Äî –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø

---

## ‚ö†Ô∏è –ß—Ç–æ –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å/—É—Ç–æ—á–Ω–∏—Ç—å

### 1. **–ü—Ä–æ–±–ª–µ–º–∞ —Å `price_cache` –∏ `candles_cache`**

**–í –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–∏:**
```python
current_price = self.price_cache.get(symbol)
last_3 = self.candles_cache.get(symbol, [])[-3:]
```

**–†–µ–∞–ª—å–Ω–æ—Å—Ç—å:**
- ‚ùå `self.price_cache` –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- ‚ùå `self.candles_cache` –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

**–†–µ—à–µ–Ω–∏–µ:**
```python
# –í–º–µ—Å—Ç–æ self.price_cache.get(symbol)
current_price = await self.data_registry.get_price(symbol)

# –í–º–µ—Å—Ç–æ self.candles_cache.get(symbol, [])[-3:]
candles = await self.data_registry.get_candles(symbol, "1m")
if candles and len(candles) >= 3:
    last_3 = candles[-3:]
```

---

### 2. **–ü—Ä–æ–±–ª–µ–º–∞ —Å `_check_reversal_signals` –≤ `asyncio.gather`**

**–í –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–∏:**
```python
tasks = [
    self._check_reversal_signals(symbol, side),  # –£–∂–µ async, –Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç bool
    ...
]
results = await asyncio.gather(*tasks)
reversal_score = sum(results)  # bool –Ω–µ–ª—å–∑—è —Å—É–º–º–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–ø—Ä—è–º—É—é
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `_check_reversal_signals` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `bool`, –∞ –Ω–µ —á–∏—Å–ª–æ
- –ù—É–∂–Ω–æ –æ–±–µ—Ä–Ω—É—Ç—å –≤ —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `0` –∏–ª–∏ `1`

**–†–µ—à–µ–Ω–∏–µ:**
```python
async def _check_reversal_signals_score(self, symbol: str, side: str) -> int:
    """–û–±–µ—Ä—Ç–∫–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è score (0 –∏–ª–∏ 1)"""
    result = await self._check_reversal_signals(symbol, side)
    return 1 if result else 0

# –í tasks:
tasks = [
    self._check_reversal_signals_score(symbol, side),
    ...
]
```

---

### 3. **–ü—Ä–æ–±–ª–µ–º–∞ —Å –ø–æ–ª—É—á–µ–Ω–∏–µ–º funding rate**

**–í –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–∏:**
```python
async def _get_funding_rate(self, symbol: str) -> Optional[float]:
    funding = await self._get_funding_rate(symbol)  # –†–µ–∫—É—Ä—Å–∏—è!
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –≤—ã–∑–æ–≤ —Å–∞–º–æ–≥–æ —Å–µ–±—è
- –ù–µ —É–∫–∞–∑–∞–Ω–æ, –æ—Ç–∫—É–¥–∞ –±—Ä–∞—Ç—å funding rate

**–†–µ—à–µ–Ω–∏–µ:**
```python
async def _get_funding_rate(self, symbol: str) -> Optional[float]:
    """–ü–æ–ª—É—á–∏—Ç—å funding rate —á–µ—Ä–µ–∑ orchestrator.funding_monitor –∏–ª–∏ client"""
    if self.orchestrator and hasattr(self.orchestrator, 'funding_monitor'):
        funding_monitor = self.orchestrator.funding_monitor
        if funding_monitor:
            return funding_monitor.get_current_funding()
    
    # Fallback: —á–µ—Ä–µ–∑ client (–µ—Å–ª–∏ –µ—Å—Ç—å)
    if self.orchestrator and hasattr(self.orchestrator, 'client'):
        try:
            # –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –µ—Å—Ç—å –ª–∏ –º–µ—Ç–æ–¥ get_funding_rate –≤ client
            # –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å FundingRateFilter
            pass
        except:
            pass
    
    return None
```

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `FundingRateFilter` –∏–∑ `signal_generator`, –µ—Å–ª–∏ –æ–Ω –¥–æ—Å—Ç—É–ø–µ–Ω

---

### 4. **–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –º–æ–¥—É–ª–∏ –≤ `src/market_data/`**

**–í –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–∏:**
```
src/market_data/
‚îú‚îÄ‚îÄ correlation.py      ‚Üí async get_correlation()
‚îú‚îÄ‚îÄ liquidity.py        ‚Üí async get_nearest_liquidity()
‚îú‚îÄ‚îÄ volume_profile.py    ‚Üí async get_volume_profile()
‚îî‚îÄ‚îÄ pivot.py            ‚Üí async get_pivot_levels()
```

**–†–µ–∞–ª—å–Ω–æ—Å—Ç—å:**
- ‚ùå –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è `src/market_data/` –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- ‚úÖ `VolumeProfileCalculator` –µ—Å—Ç—å –≤ `src/indicators/advanced/volume_profile.py`
- ‚úÖ `PivotCalculator` –µ—Å—Ç—å –≤ `src/indicators/advanced/pivot_calculator.py`
- ‚ùå `correlation.py` –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- ‚ùå `liquidity.py` (–¥–ª—è —É—Ä–æ–≤–Ω–µ–π –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏) –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

**–†–µ—à–µ–Ω–∏–µ:**
1. **–°–æ–∑–¥–∞—Ç—å `src/market_data/`** –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–æ–¥—É–ª–∏
2. **–î–ª—è Volume Profile –∏ Pivot:** —Å–æ–∑–¥–∞—Ç—å –æ–±–µ—Ä—Ç–∫–∏ –≤ `exit_analyzer.py` –∏–ª–∏ –≤ –Ω–æ–≤—ã—Ö –º–æ–¥—É–ª—è—Ö
3. **–î–ª—è Correlation:** —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –º–æ–¥—É–ª—å
4. **–î–ª—è Liquidity:** —Å–æ–∑–¥–∞—Ç—å –º–æ–¥—É–ª—å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —É—Ä–æ–≤–Ω–µ–π –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏ (–Ω–µ —Ñ–∏–ª—å—Ç—Ä)

---

### 5. **–ü—Ä–æ–±–ª–µ–º–∞ —Å –º–µ—Ç–æ–¥–∞–º–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤**

**–í –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–∏:**
```python
async def _check_funding_bias(self, symbol: str, side: str) -> bool:
    funding = await self._get_funding_rate(symbol)
    if funding is None:
        return False
    # –ü—Ä–æ—Ç–∏–≤ —Ç—Ä–µ–Ω–¥–∞ = —à–∞–Ω—Å –Ω–∞ –æ—Ç–∫–∞—Ç
    if side == "long" and funding < -0.02:
        return True
    if side == "short" and funding > 0.02:
        return True
    return False
```

**–í–æ–ø—Ä–æ—Å—ã:**
- –ü–æ—Ä–æ–≥–∏ `-0.02` –∏ `0.02` ‚Äî —ç—Ç–æ 2% –∏–ª–∏ 0.02%? –ù—É–∂–Ω–æ —É—Ç–æ—á–Ω–∏—Ç—å
- –õ–æ–≥–∏–∫–∞: –µ—Å–ª–∏ funding –ø—Ä–æ—Ç–∏–≤ –Ω–∞—Å, —ç—Ç–æ –ø—Ä–∏–∑–Ω–∞–∫ –æ—Ç–∫–∞—Ç–∞? –ò–ª–∏ –Ω–∞–æ–±–æ—Ä–æ—Ç?

**–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–ª—è –¥—Ä—É–≥–∏—Ö –º–µ—Ç–æ–¥–æ–≤:**
- `_check_correlation_bias`: –ø–æ—Ä–æ–≥ `0.85` ‚Äî —ç—Ç–æ 85% –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏?
- `_check_liquidity_sweep`: –æ—Ç–∫—É–¥–∞ –±—Ä–∞—Ç—å `get_nearest_liquidity`?
- `_check_reversal_candles`: –º–µ—Ç–æ–¥—ã `_is_hammer`, `_is_engulfing_bearish` –Ω–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç
- `_check_volume_profile_support`: –º–µ—Ç–æ–¥ `is_high_volume_zone` –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ `VolumeProfileData`
- `_check_pivot_support`: –Ω—É–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å pivot levels —á–µ—Ä–µ–∑ `PivotCalculator`

---

### 6. **–ü—Ä–æ–±–ª–µ–º–∞ —Å `_analyze_trend_strength` –≤ `_should_force_close_by_smart_analysis`**

**–í –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–∏:**
```python
trend_data = await self._analyze_trend_strength(symbol)
trend_against = 0.0
if trend_data:
    ts = trend_data.get("trend_strength", 0.0)
    direction = trend_data.get("trend_direction", "neutral")
    if (side == "long" and direction == "bearish") or (side == "short" and direction == "bullish"):
        trend_against = ts
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `_analyze_trend_strength` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `Optional[Dict]`, –Ω–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–∂–µ—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è
- –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –∫–∞–∫–∏–µ –∫–ª—é—á–∏ —Ä–µ–∞–ª—å–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∞–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–≥–æ —Å–ª–æ–≤–∞—Ä—è –∏–∑ `_analyze_trend_strength`

---

### 7. **–ü—Ä–æ–±–ª–µ–º–∞ —Å –ø–æ—Ä–æ–≥–∞–º–∏ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏**

**–í –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–∏:**
- `reversal_score <= 2` ‚Äî –∑–∞–∫—Ä—ã–≤–∞–µ–º
- `trend_against >= 0.7` ‚Äî –∑–∞–∫—Ä—ã–≤–∞–µ–º
- `funding < -0.02` –∏–ª–∏ `funding > 0.02` ‚Äî –ø—Ä–∏–∑–Ω–∞–∫ –æ—Ç–∫–∞—Ç–∞
- `corr < 0.85` ‚Äî –Ω–µ –≤ –Ω–∞—à—É –ø–æ–ª—å–∑—É
- `liq["below"]["ratio"] > 0.9` ‚Äî —à–∞–Ω—Å –Ω–∞ –æ—Ç—Å–∫–æ–∫

**–í–æ–ø—Ä–æ—Å—ã:**
- –≠—Ç–∏ –ø–æ—Ä–æ–≥–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ –∫–æ–Ω—Ñ–∏–≥–µ –∏–ª–∏ –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω—ã?
- –ù—É–∂–Ω—ã –ª–∏ –æ–Ω–∏ –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–º–∏ –ø–æ —Ä–µ–∂–∏–º—É (trending/ranging/choppy)?

---

## üìã –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (—á—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å)

### –≠—Ç–∞–ø 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
1. ‚úÖ –°–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `src/market_data/` (–∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–æ–¥—É–ª–∏)
2. ‚úÖ –°–æ–∑–¥–∞—Ç—å –æ–±–µ—Ä—Ç–∫–∏ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ Volume Profile –∏ Pivot
3. ‚úÖ –°–æ–∑–¥–∞—Ç—å –º–æ–¥—É–ª—å `correlation.py` –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏
4. ‚úÖ –°–æ–∑–¥–∞—Ç—å –º–æ–¥—É–ª—å `liquidity.py` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —É—Ä–æ–≤–Ω–µ–π –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏

### –≠—Ç–∞–ø 2: –ú–µ—Ç–æ–¥—ã –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
1. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `_get_funding_rate` —á–µ—Ä–µ–∑ `orchestrator.funding_monitor`
2. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `_get_correlation` —á–µ—Ä–µ–∑ –Ω–æ–≤—ã–π –º–æ–¥—É–ª—å
3. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `_get_nearest_liquidity` —á–µ—Ä–µ–∑ –Ω–æ–≤—ã–π –º–æ–¥—É–ª—å
4. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `_get_volume_profile` —á–µ—Ä–µ–∑ –æ–±–µ—Ä—Ç–∫—É –Ω–∞–¥ `VolumeProfileCalculator`
5. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `_get_pivot_levels` —á–µ—Ä–µ–∑ –æ–±–µ—Ä—Ç–∫—É –Ω–∞–¥ `PivotCalculator`
6. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Ü–µ–Ω–µ –∏ —Å–≤–µ—á–∞–º —á–µ—Ä–µ–∑ `data_registry`

### –≠—Ç–∞–ø 3: –ú–µ—Ç–æ–¥—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤
1. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `_check_funding_bias` (—Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø–æ—Ä–æ–≥–∞–º–∏)
2. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `_check_correlation_bias` (—Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø–æ—Ä–æ–≥–∞–º–∏)
3. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `_check_liquidity_sweep` (—Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –¥–∞–Ω–Ω—ã—Ö)
4. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `_check_reversal_candles` (—Å –º–µ—Ç–æ–¥–∞–º–∏ `_is_hammer`, `_is_engulfing_bearish`)
5. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `_check_volume_profile_support` (—Å –º–µ—Ç–æ–¥–æ–º `is_high_volume_zone`)
6. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `_check_pivot_support` (—Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π pivot levels)

### –≠—Ç–∞–ø 4: –û—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥
1. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `_should_force_close_by_smart_analysis` —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏
2. ‚úÖ –û–±–µ—Ä–Ω—É—Ç—å `_check_reversal_signals` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è score
3. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É `trend_against`

### –≠—Ç–∞–ø 5: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
1. ‚úÖ –í—Å—Ç–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –≤ `_generate_exit_for_trending` (–ø–µ—Ä–µ–¥ —Å—Ç—Ä–æ–∫–æ–π 1294)
2. ‚úÖ –í—Å—Ç–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –≤ `_generate_exit_for_ranging` (–ø–µ—Ä–µ–¥ —Å—Ç—Ä–æ–∫–æ–π 1592)
3. ‚úÖ –í—Å—Ç–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –≤ `_generate_exit_for_choppy` (–ø–µ—Ä–µ–¥ –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–æ–π)

---

## ‚ùì –í–æ–ø—Ä–æ—Å—ã –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è —É –ö–∏–º—ã

### 1. **–ü–æ—Ä–æ–≥–∏ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- –ü–æ—Ä–æ–≥–∏ `reversal_score <= 2`, `trend_against >= 0.7` ‚Äî —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–ª–∏ –≤ –∫–æ–Ω—Ñ–∏–≥–µ?
- –ü–æ—Ä–æ–≥–∏ funding (`-0.02`, `0.02`) ‚Äî —ç—Ç–æ 2% –∏–ª–∏ 0.02%? –ò –ª–æ–≥–∏–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è?
- –ü–æ—Ä–æ–≥ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏ `0.85` ‚Äî —ç—Ç–æ 85%? –ò –ª–æ–≥–∏–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è?

### 2. **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö:**
- –ö–∞–∫ –¥–æ–ª–∂–Ω–∞ –≤—ã–≥–ª—è–¥–µ—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ `get_nearest_liquidity`? `{"below": {"ratio": 0.9}, "above": {"ratio": 0.9}}`?
- –ö–∞–∫ –¥–æ–ª–∂–Ω–∞ –≤—ã–≥–ª—è–¥–µ—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ `get_pivot_levels`? `{"s1": 100, "r1": 110, ...}`?

### 3. **–ú–µ—Ç–æ–¥—ã —Å–≤–µ—á–µ–π:**
- –ù—É–∂–Ω—ã –ª–∏ –º–µ—Ç–æ–¥—ã `_is_hammer` –∏ `_is_engulfing_bearish`? –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏?

### 4. **Volume Profile:**
- –ù—É–∂–Ω–æ –ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ `is_high_volume_zone` –≤ `VolumeProfileData`? –ò–ª–∏ —Å–æ–∑–¥–∞—Ç—å –æ–±–µ—Ä—Ç–∫—É?

### 5. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
- –î–æ–ª–∂–Ω—ã –ª–∏ –ø–æ—Ä–æ–≥–∏ –±—ã—Ç—å –≤ `config_futures.yaml`? –ò–ª–∏ –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω—ã?

---

## ‚úÖ –ò—Ç–æ–≥–æ–≤—ã–π –≤–µ—Ä–¥–∏–∫—Ç

### **–ß—Ç–æ –ø–æ–Ω—è—Ç–Ω–æ:**
- ‚úÖ –û–±—â–∞—è –ª–æ–≥–∏–∫–∞ –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- ‚úÖ –ú–µ—Å—Ç–æ –≤—Å—Ç–∞–≤–∫–∏ –∫–æ–¥–∞
- ‚úÖ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–æ—Å—Ç—å –Ω–µ –ª–æ–º–∞–µ—Ç—Å—è
- ‚úÖ –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç

### **–ß—Ç–æ –Ω—É–∂–Ω–æ —É—Ç–æ—á–Ω–∏—Ç—å:**
- ‚ö†Ô∏è –ü–æ—Ä–æ–≥–∏ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–ª–∏ –≤ –∫–æ–Ω—Ñ–∏–≥–µ?)
- ‚ö†Ô∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è liquidity –∏ pivot
- ‚ö†Ô∏è –ú–µ—Ç–æ–¥—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–≤–µ—á–µ–π (hammer, engulfing)
- ‚ö†Ô∏è –õ–æ–≥–∏–∫–∞ funding bias (–ø—Ä–æ—Ç–∏–≤ —Ç—Ä–µ–Ω–¥–∞ = –æ—Ç–∫–∞—Ç?)

### **–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å:**
- üìù –ú–æ–¥—É–ª–∏ –≤ `src/market_data/` (–∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ)
- üìù –û–±–µ—Ä—Ç–∫–∏ –¥–ª—è Volume Profile –∏ Pivot
- üìù –ú–µ—Ç–æ–¥—ã –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö (funding, correlation, liquidity, candles, price)
- üìù –ú–µ—Ç–æ–¥—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ (7 –º–µ—Ç–æ–¥–æ–≤)
- üìù –û—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥ `_should_force_close_by_smart_analysis`

### **–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**
- üü° **70% –≥–æ—Ç–æ–≤–æ** ‚Äî –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø–æ–Ω—è—Ç–Ω–∞, –Ω–æ –Ω—É–∂–Ω—ã —É—Ç–æ—á–Ω–µ–Ω–∏—è –ø–æ –ø–æ—Ä–æ–≥–∞–º –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –¥–∞–Ω–Ω—ã—Ö

---

## üìå –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–°–Ω–∞—á–∞–ª–∞ —É—Ç–æ—á–Ω–∏—Ç—å —É –ö–∏–º—ã:**
   - –ü–æ—Ä–æ–≥–∏ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
   - –°—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö –¥–ª—è liquidity –∏ pivot
   - –õ–æ–≥–∏–∫—É funding bias

2. **–ó–∞—Ç–µ–º —Å–æ–∑–¥–∞—Ç—å –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É:**
   - –ú–æ–¥—É–ª–∏ –≤ `src/market_data/`
   - –û–±–µ—Ä—Ç–∫–∏ –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤

3. **–ü–æ—Ç–æ–º —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥—ã:**
   - –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤
   - –û—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥

4. **–ò –Ω–∞–∫–æ–Ω–µ—Ü –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å:**
   - –í—Å—Ç–∞–≤–∏—Ç—å –≤ —Ä–µ–∂–∏–º–Ω—ã–µ –º–µ—Ç–æ–¥—ã
   - –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

---

**–í—ã–≤–æ–¥:** –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –ø–æ–Ω—è—Ç–Ω–æ –Ω–∞ 70%, –Ω–æ –Ω—É–∂–Ω—ã —É—Ç–æ—á–Ω–µ–Ω–∏—è –ø–æ –ø–æ—Ä–æ–≥–∞–º, —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –¥–∞–Ω–Ω—ã—Ö –∏ –ª–æ–≥–∏–∫–µ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤. –ü–æ—Å–ª–µ —É—Ç–æ—á–Ω–µ–Ω–∏–π –º–æ–∂–Ω–æ –ø—Ä–∏—Å—Ç—É–ø–∞—Ç—å –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.

