# üîç –ü–†–û–í–ï–†–ö–ê –õ–û–ì–ò–†–û–í–ê–ù–ò–Ø

**–î–∞—Ç–∞:** 26.11.2025 23:20  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ü–†–û–í–ï–†–ï–ù–û**

---

## ‚úÖ –ü–†–û–í–ï–†–ö–ê –ú–ï–¢–û–î–û–í StructuredLogger

**–ú–µ—Ç–æ–¥—ã –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Å–≤–µ—á–µ–π:**
- ‚úÖ `log_candle_init` - —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- ‚úÖ `log_candle_new` - —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- ‚úÖ `log_candle_stats` - —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- ‚úÖ `log_candle_usage` - —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

---

## ‚úÖ –ü–†–û–í–ï–†–ö–ê –í–´–ó–û–í–û–í

### **1. log_candle_init –≤ orchestrator.py** ‚úÖ

**–ú–µ—Å—Ç–æ:** `_initialize_candle_buffers()`

**–í—ã–∑–æ–≤:**
```python
self.structured_logger.log_candle_init(
    symbol=symbol,
    timeframe=timeframe,
    candles_count=len(ohlcv_data),
    status="success",
)
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- ‚úÖ –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Å–∏–≥–Ω–∞—Ç—É—Ä–µ
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `if self.structured_logger:` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
- ‚úÖ –û–±–µ—Ä–Ω—É—Ç–æ –≤ `try/except`

---

### **2. log_candle_new –≤ websocket_coordinator.py** ‚ö†Ô∏è

**–ú–µ—Å—Ç–æ:** `_update_candle_for_timeframe()`

**–ü—Ä–æ–±–ª–µ–º–∞:**
```python
last_candle_after = await self.data_registry.get_last_candle(symbol, timeframe)
if last_candle_after:
    self.structured_logger.log_candle_new(
        symbol=symbol,
        timeframe=timeframe,
        timestamp=current_candle_timestamp,
        price=price,
        open=last_candle_after.open,  # ‚ö†Ô∏è –≠—Ç–æ –¥–∞–Ω–Ω—ã–µ –°–¢–ê–†–û–ô —Å–≤–µ—á–∏!
        high=last_candle_after.high,   # ‚ö†Ô∏è –≠—Ç–æ –¥–∞–Ω–Ω—ã–µ –°–¢–ê–†–û–ô —Å–≤–µ—á–∏!
        low=last_candle_after.low,     # ‚ö†Ô∏è –≠—Ç–æ –¥–∞–Ω–Ω—ã–µ –°–¢–ê–†–û–ô —Å–≤–µ—á–∏!
        close=last_candle_after.close, # ‚ö†Ô∏è –≠—Ç–æ –¥–∞–Ω–Ω—ã–µ –°–¢–ê–†–û–ô —Å–≤–µ—á–∏!
    )
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ –°–¢–ê–†–û–ô —Å–≤–µ—á–∏ –≤–º–µ—Å—Ç–æ –ù–û–í–û–ô!

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –ù—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ `new_candle`, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤—ã—à–µ.

---

### **3. log_candle_usage –≤ multi_timeframe.py** ‚úÖ

**–ú–µ—Å—Ç–æ:** `_get_htf_candles()`

**–í—ã–∑–æ–≤:**
```python
self.structured_logger.log_candle_usage(
    filter_name="MTF",
    symbol=symbol,
    timeframe=self.config.confirmation_timeframe,
    source="dataregistry",
    candles_count=len(candles),
    fallback_to_api=False,
)
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- ‚úÖ –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Å–∏–≥–Ω–∞—Ç—É—Ä–µ
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `hasattr(self, "structured_logger") and self.structured_logger`
- ‚úÖ –û–±–µ—Ä–Ω—É—Ç–æ –≤ `try/except`

---

## ‚ö†Ô∏è –ù–ê–ô–î–ï–ù–ù–ê–Ø –ü–†–û–ë–õ–ï–ú–ê

### **log_candle_new –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–∞–Ω–Ω—ã–µ —Å—Ç–∞—Ä–æ–π —Å–≤–µ—á–∏**

**–§–∞–π–ª:** `src/strategies/scalping/futures/coordinators/websocket_coordinator.py`  
**–°—Ç—Ä–æ–∫–∞:** ~431

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π —Å–≤–µ—á–∏, –º—ã –ø–æ–ª—É—á–∞–µ–º `last_candle_after` –∏–∑ DataRegistry
- –ù–æ —ç—Ç–æ –≤—Å–µ –µ—â–µ –°–¢–ê–†–ê–Ø —Å–≤–µ—á–∞ (—Ç–∞, –∫–æ—Ç–æ—Ä–∞—è –±—ã–ª–∞ –¥–æ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π)
- –ù—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ `new_candle`, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤—ã—à–µ

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ `new_candle` –≤–º–µ—Å—Ç–æ `last_candle_after`

---

## ‚úÖ –û–°–¢–ê–õ–¨–ù–´–ï –ü–†–û–í–ï–†–ö–ò

### **–õ–∏–Ω—Ç–µ—Ä:**
- ‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ –ª–∏–Ω—Ç–µ—Ä–∞

### **–ü—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ None:**
- ‚úÖ –í—Å–µ –≤—ã–∑–æ–≤—ã –æ–±–µ—Ä–Ω—É—Ç—ã –≤ –ø—Ä–æ–≤–µ—Ä–∫–∏ `if self.structured_logger:`
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `hasattr()` –≥–¥–µ –Ω—É–∂–Ω–æ

### **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**
- ‚úÖ –í—Å–µ –≤—ã–∑–æ–≤—ã –æ–±–µ—Ä–Ω—É—Ç—ã –≤ `try/except`
- ‚úÖ –û—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ `logger.debug()` –∏–ª–∏ `logger.error()`

---

**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è **–ù–ê–ô–î–ï–ù–ê 1 –ü–†–û–ë–õ–ï–ú–ê**

–ù—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å–≤–µ—á–∏ –≤ `log_candle_new`.






