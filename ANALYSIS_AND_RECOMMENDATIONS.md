# üìä –ê–ù–ê–õ–ò–ó –ò –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

**–î–∞—Ç–∞:** 2025-12-07  
**–°—Ç–∞—Ç—É—Å:** –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω, —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –≥–æ—Ç–æ–≤—ã

---

## üî¥ –ü–†–û–ë–õ–ï–ú–ê #1: –û–¢–†–ò–¶–ê–¢–ï–õ–¨–ù–û–ï –í–†–ï–ú–Ø –í –ü–û–ó–ò–¶–ò–ò

### –ü—Ä–∏—á–∏–Ω–∞:
**–ü—Ä–æ–±–ª–µ–º–∞ —Å —á–∞—Å–æ–≤—ã–º –ø–æ—è—Å–æ–º –∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–µ–π timestamp**

–ö–æ–≥–¥–∞ `entry_time` —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∫–∞–∫ `datetime` **–ë–ï–ó timezone** (naive datetime), Python –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ—Ç –µ–≥–æ –∫–∞–∫ **–ª–æ–∫–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è** (UTC+3 –¥–ª—è –ú–æ—Å–∫–≤—ã).

–ü—Ä–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –≤ timestamp:
- `datetime(2025, 12, 7, 12, 4, 18)` –ë–ï–ó timezone ‚Üí Python —Å—á–∏—Ç–∞–µ—Ç —ç—Ç–æ –ª–æ–∫–∞–ª—å–Ω—ã–º –≤—Ä–µ–º–µ–Ω–µ–º (UTC+3)
- `datetime.now(timezone.utc).timestamp()` ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç UTC timestamp
- –†–∞–∑–Ω–∏—Ü–∞: **-3 —á–∞—Å–∞** (‚âà -10800 —Å–µ–∫—É–Ω–¥)

**–ü—Ä–∏–º–µ—Ä –∏–∑ –ª–æ–≥–æ–≤:**
```
entry_timestamp=1765109058.114  (—ç—Ç–æ 12:04:18 UTC+3 = 09:04:18 UTC)
current_timestamp=1765098277.870776  (—ç—Ç–æ —Ç–µ–∫—É—â–µ–µ UTC –≤—Ä–µ–º—è)
–†–∞–∑–Ω–∏—Ü–∞: -10780 —Å–µ–∫—É–Ω–¥ ‚âà -3 —á–∞—Å–∞
```

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:
‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ `entry_manager.py`:**
- –î–æ–±–∞–≤–ª–µ–Ω `tz=timezone.utc` –ø—Ä–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ timestamp –∏–∑ API

**–ù—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –µ—â–µ:**
1. `position_manager.py` - —Å—Ç—Ä–æ–∫–∏ 972, 979, 1099, 1108, 1128, 3564
2. `orchestrator.py` - —Å—Ç—Ä–æ–∫–∏ 1395, 2117
3. `trailing_sl_coordinator.py` - —Å—Ç—Ä–æ–∫–∞ 510

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `datetime.fromtimestamp(timestamp, tz=timezone.utc)` –ø—Ä–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ timestamp.

---

## üî¥ –ü–†–û–ë–õ–ï–ú–ê #2: –ù–ï–¢ CSV –õ–û–ì–ò–†–û–í–ê–ù–ò–Ø –û–¢–ö–†–´–¢–ò–Ø –ü–û–ó–ò–¶–ò–ô

### –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:
- CSV –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ **–∑–∞–∫—Ä—ã—Ç–∏–∏** –ø–æ–∑–∏—Ü–∏–∏ —á–µ—Ä–µ–∑ `record_trade()`
- –ù–µ—Ç CSV —Ñ–∞–π–ª–∞ –¥–ª—è **–æ—Ç–∫—Ä—ã—Ç–∏—è** –ø–æ–∑–∏—Ü–∏–π
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ—Ç—Å–ª–µ–¥–∏—Ç—å, –∫–æ–≥–¥–∞ –∏ –∫–∞–∫ –æ—Ç–∫—Ä—ã–≤–∞–ª–∏—Å—å –ø–æ–∑–∏—Ü–∏–∏

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:
**–î–æ–±–∞–≤–∏—Ç—å CSV –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–π:**

1. **–°–æ–∑–¥–∞—Ç—å –º–µ—Ç–æ–¥ –≤ `PerformanceTracker`:**
```python
def record_position_open(
    self,
    symbol: str,
    side: str,
    entry_price: float,
    size: float,
    regime: str,
    order_id: Optional[str] = None,
    order_type: Optional[str] = None,
) -> None:
    """–ó–∞–ø–∏—Å–∞—Ç—å –æ—Ç–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –≤ CSV"""
```

2. **–°–æ–∑–¥–∞—Ç—å CSV —Ñ–∞–π–ª:** `logs/positions_open_YYYY-MM-DD.csv`

3. **–§–æ—Ä–º–∞—Ç CSV:**
```csv
timestamp,symbol,side,entry_price,size,regime,order_id,order_type
```

4. **–í—ã–∑—ã–≤–∞—Ç—å –≤ `entry_manager.py`** –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏

---

## üî¥ –ü–†–û–ë–õ–ï–ú–ê #3: –ù–ï–¢ CSV –õ–û–ì–ò–†–û–í–ê–ù–ò–Ø –û–†–î–ï–†–û–í

### –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:
- –û—Ä–¥–µ—Ä–∞ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ –æ–±—ã—á–Ω—ã–µ –ª–æ–≥–∏ (INFO/DEBUG)
- –ù–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ CSV –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ—Ç—Å–ª–µ–¥–∏—Ç—å:
  - –ö–æ–≥–¥–∞ —Ä–∞–∑–º–µ—â–µ–Ω –æ—Ä–¥–µ—Ä
  - –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª–Ω–µ–Ω (fills)
  - –°–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–Ω—è–ª–æ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ
  - –ü—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏–µ

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:
**–î–æ–±–∞–≤–∏—Ç—å CSV –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ä–¥–µ—Ä–æ–≤:**

1. **–°–æ–∑–¥–∞—Ç—å –∫–ª–∞—Å—Å `OrderLogger`** –∏–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –≤ `PerformanceTracker`

2. **–°–æ–∑–¥–∞—Ç—å CSV —Ñ–∞–π–ª:** `logs/orders_YYYY-MM-DD.csv`

3. **–§–æ—Ä–º–∞—Ç CSV:**
```csv
timestamp,symbol,side,order_type,order_id,size,price,status,fill_price,fill_size,execution_time_ms,slippage
```

4. **–õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤ `order_executor.py`:**
   - **–†–∞–∑–º–µ—â–µ–Ω–∏–µ –æ—Ä–¥–µ—Ä–∞:** `record_order_placed()`
   - **–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Ä–¥–µ—Ä–∞ (fills):** `record_order_filled()`
   - **–û—Ç–º–µ–Ω–∞ –æ—Ä–¥–µ—Ä–∞:** `record_order_cancelled()`

5. **–õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∂–¥—ã–π fill –æ—Ç–¥–µ–ª—å–Ω–æ:**
   - OKX –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–∞—Å—Å–∏–≤ `fills` –ø—Ä–∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–∏
   - –ö–∞–∂–¥—ã–π fill –Ω—É–∂–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ–π —Å—Ç—Ä–æ–∫–æ–π

---

## üî¥ –ü–†–û–ë–õ–ï–ú–ê #4: –õ–û–ì–ò–†–û–í–ê–ù–ò–ï –°–ò–ì–ù–ê–õ–û–í

### –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:
- –ï—Å—Ç—å `log_signal()` –≤ `StructuredLogger` (JSON —Ñ–æ—Ä–º–∞—Ç)
- –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ª–∏ –æ–Ω
- –ù–µ—Ç CSV –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –∞–Ω–∞–ª–∏–∑–∞

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:
**–£–ª—É—á—à–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–æ–≤:**

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—ã–∑–æ–≤—ã `log_signal()`** –≤ `signal_generator.py`

2. **–î–æ–±–∞–≤–∏—Ç—å CSV –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–æ–≤:**
   - –°–æ–∑–¥–∞—Ç—å CSV —Ñ–∞–π–ª: `logs/signals_YYYY-MM-DD.csv`
   - –§–æ—Ä–º–∞—Ç:
   ```csv
   timestamp,symbol,side,price,strength,regime,filters_passed,executed,order_id
   ```

3. **–õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å:**
   - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–∞
   - –ü—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤
   - –ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–∞ (—Å–≤—è–∑—å —Å order_id)

---

## üî¥ –ü–†–û–ë–õ–ï–ú–ê #5: –ë–û–¢ –ù–ï –í–ò–î–ò–¢ –ü–û–ó–ò–¶–ò–ò –°–†–ê–ó–£

### –û–±—ä—è—Å–Ω–µ–Ω–∏–µ:
**–≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ!**

1. **–†–∞–∑–º–µ—â–µ–Ω–∏–µ –æ—Ä–¥–µ—Ä–∞** ‚Üí –û—Ä–¥–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –±–∏—Ä–∂—É
2. **–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Ä–¥–µ—Ä–∞** ‚Üí –û—Ä–¥–µ—Ä –∏—Å–ø–æ–ª–Ω–µ–Ω (fills)
3. **–ü–æ—è–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏** ‚Üí –ü–æ–∑–∏—Ü–∏—è –ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤ API —á–µ—Ä–µ–∑ –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è (–æ–±—ã—á–Ω–æ 0.5-2 —Å–µ–∫—É–Ω–¥—ã)

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- `entry_manager.py` –∂–¥–µ—Ç 1 —Å–µ–∫—É–Ω–¥—É –ø–æ—Å–ª–µ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –æ—Ä–¥–µ—Ä–∞
- –ó–∞—Ç–µ–º –¥–µ–ª–∞–µ—Ç retry, –µ—Å–ª–∏ –ø–æ–∑–∏—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞
- –≠—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:
**–£–ª—É—á—à–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞:**

1. **–õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ –æ—Ä–¥–µ—Ä–∞:**
   ```
   üì§ ORDER_PLACED: BTC-USDT BUY limit, order_id=xxx, size=0.1, price=89000
   ```

2. **–õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Ä–¥–µ—Ä–∞ (fills):**
   ```
   ‚úÖ ORDER_FILLED: BTC-USDT BUY, order_id=xxx, fill_price=89001, fill_size=0.1, slippage=0.01%
   ```

3. **–õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –ø–æ—è–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏:**
   ```
   üìä POSITION_OPENED: BTC-USDT LONG, entry_price=89001, size=0.1
   ```

4. **–õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–µ—Ä–∂–∫–∏:**
   ```
   ‚è±Ô∏è POSITION_SYNC_DELAY: BTC-USDT, delay=1.2s (order ‚Üí position)
   ```

---

## üìã –ü–†–ò–û–†–ò–¢–ï–¢–´ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1 (–ö–†–ò–¢–ò–ß–ù–û - –ª–æ–º–∞–µ—Ç —Ä–∞–±–æ—Ç—É):
1. ‚úÖ **–ò—Å–ø—Ä–∞–≤–∏—Ç—å timezone –≤ `datetime.fromtimestamp()`** - —á–∞—Å—Ç–∏—á–Ω–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
2. ‚ö†Ô∏è **–ò—Å–ø—Ä–∞–≤–∏—Ç—å –æ—Å—Ç–∞–ª—å–Ω—ã–µ –º–µ—Å—Ç–∞** –≤ `position_manager.py`, `orchestrator.py`, `trailing_sl_coordinator.py`

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2 (–í–ê–ñ–ù–û - –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞):
3. **–î–æ–±–∞–≤–∏—Ç—å CSV –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–π**
4. **–î–æ–±–∞–≤–∏—Ç—å CSV –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ä–¥–µ—Ä–æ–≤ (—Ä–∞–∑–º–µ—â–µ–Ω–∏–µ + fills)**
5. **–£–ª—É—á—à–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–æ–≤**

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3 (–£–õ–£–ß–®–ï–ù–ò–Ø):
6. **–£–ª—É—á—à–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏** (–æ—Ä–¥–µ—Ä ‚Üí fill ‚Üí –ø–æ–∑–∏—Ü–∏—è)
7. **–î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –≤—Ä–µ–º–µ–Ω–∏** (–∑–∞–¥–µ—Ä–∂–∫–∏ –º–µ–∂–¥—É —Å–æ–±—ã—Ç–∏—è–º–∏)

---

## üîç –ü–†–û–í–ï–†–ö–ê –ü–û–°–õ–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô

1. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `entry_time` –≤—Å–µ–≥–¥–∞ —Å `timezone.utc`
2. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –Ω–µ—Ç –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –≤ –ø–æ–∑–∏—Ü–∏–∏
3. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ CSV —Ñ–∞–π–ª—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –∏ –∑–∞–ø–æ–ª–Ω—è—é—Ç—Å—è
4. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤—Å–µ —Å–æ–±—ã—Ç–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è (–æ—Ä–¥–µ—Ä–∞, –ø–æ–∑–∏—Ü–∏–∏, —Å–∏–≥–Ω–∞–ª—ã)
5. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ fills –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ

---

## üìù –í–´–í–û–î–´

**–û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è timestamp –∏–∑-–∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è timezone –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–º—É –≤—Ä–µ–º–µ–Ω–∏ –≤ –ø–æ–∑–∏—Ü–∏–∏, —á—Ç–æ –ª–æ–º–∞–µ—Ç –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Ä–µ–º–µ–Ω–∏ (max_holding, duration_sec).

**–†–µ—à–µ–Ω–∏–µ:** –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `datetime.fromtimestamp(timestamp, tz=timezone.utc)` –ø—Ä–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ timestamp.

**–£–ª—É—á—à–µ–Ω–∏—è:** –î–æ–±–∞–≤–∏—Ç—å CSV –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –≤—Å–µ—Ö –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π (–æ—Ä–¥–µ—Ä–∞, –ø–æ–∑–∏—Ü–∏–∏, —Å–∏–≥–Ω–∞–ª—ã) –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –∞–Ω–∞–ª–∏–∑–∞ –∏ –æ—Ç–ª–∞–¥–∫–∏.

