# üîç –ü–û–õ–ù–´–ô –ê–ù–ê–õ–ò–ó –¶–ï–ü–û–ß–ï–ö FALLBACK –ó–ù–ê–ß–ï–ù–ò–ô

**–î–∞—Ç–∞:** 25 –¥–µ–∫–∞–±—Ä—è 2025  
**–¶–µ–ª—å:** –ù–∞–π—Ç–∏, –ø–æ—á–µ–º—É –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è fallback –≤–º–µ—Å—Ç–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞

---

## üî¥ –ü–†–û–ë–õ–ï–ú–ê #1: `regime = "ranging"` (FALLBACK)

### üìä –¶–ï–ü–û–ß–ö–ê –ü–û–õ–£–ß–ï–ù–ò–Ø –†–ï–ñ–ò–ú–ê:

#### –®–∞–≥ 1: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ (RegimeManager)
**–§–∞–π–ª:** `src/strategies/scalping/futures/adaptivity/regime_manager.py:618-627`

```python
def get_current_regime(self) -> Optional[str]:
    """–ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º —Ä—ã–Ω–∫–∞ –≤ –≤–∏–¥–µ —Å—Ç—Ä–æ–∫–∏."""
    if not hasattr(self, "current_regime") or self.current_regime is None:
        return None  # ‚ö†Ô∏è –ü–†–û–ë–õ–ï–ú–ê: –ú–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å None!
    return self.current_regime.value.lower() if self.current_regime else None
```

**–ü—Ä–æ–±–ª–µ–º–∞:** 
- –ï—Å–ª–∏ `current_regime` –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `None`
- –ï—Å–ª–∏ `current_regime` = `None` ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `None`

---

#### –®–∞–≥ 2: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ –≤ —Å–∏–≥–Ω–∞–ª (SignalGenerator)
**–§–∞–π–ª:** `src/strategies/scalping/futures/signal_generator.py:3845-3870`

```python
regime_manager = self.regime_managers.get(symbol) or self.regime_manager
current_regime_name = (
    regime_manager.get_current_regime() if regime_manager else None
)
if current_regime_name:
    signal["regime"] = current_regime_name
else:
    # ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –Ø–≤–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º fallback, –µ—Å–ª–∏ —Ä–µ–∂–∏–º –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω
    signal["regime"] = "ranging"  # ‚ö†Ô∏è FALLBACK!
    logger.warning(
        f"‚ö†Ô∏è –†–µ–∂–∏–º –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –¥–ª—è {symbol} –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–∏–≥–Ω–∞–ª–∞, "
        f"–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è fallback 'ranging'"
    )
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ï—Å–ª–∏ `regime_manager` = `None` ‚Üí `current_regime_name` = `None`
- –ï—Å–ª–∏ `get_current_regime()` –≤–µ—Ä–Ω—É–ª `None` ‚Üí `current_regime_name` = `None`
- ‚Üí –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è fallback `"ranging"`

**–ü–æ—á–µ–º—É `regime_manager` –º–æ–∂–µ—Ç –±—ã—Ç—å `None`?**
1. RegimeManager –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
2. RegimeManager –Ω–µ –æ–±–Ω–æ–≤–ª—è–ª—Å—è (–Ω–µ –≤—ã–∑—ã–≤–∞–ª—Å—è `update_regime()`)
3. –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ RegimeManager

---

#### –®–∞–≥ 3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ–∂–∏–º–∞ –≤ SignalCoordinator
**–§–∞–π–ª:** `src/strategies/scalping/futures/coordinators/signal_coordinator.py:1680`

```python
regime = signal.get("regime") or "ranging"  # ‚ö†Ô∏è FALLBACK!
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ï—Å–ª–∏ `signal["regime"]` –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `"ranging"`
- –ï—Å–ª–∏ `signal["regime"]` = `None` ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `"ranging"`

---

### üîç –ö–û–†–ù–ï–í–ê–Ø –ü–†–ò–ß–ò–ù–ê:

1. **RegimeManager –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è:**
   - `update_regime()` –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ä–µ–≥—É–ª—è—Ä–Ω–æ
   - `current_regime` –æ—Å—Ç–∞–µ—Ç—Å—è `None`

2. **RegimeManager –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω:**
   - –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ RegimeManager
   - `regime_manager` = `None`

3. **–†–µ–∂–∏–º –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω:**
   - –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞
   - `get_current_regime()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `None`

---

## üî¥ –ü–†–û–ë–õ–ï–ú–ê #2: `entry_time = datetime.now()` (FALLBACK)

### üìä –¶–ï–ü–û–ß–ö–ê –ü–û–õ–£–ß–ï–ù–ò–Ø entry_time:

#### –®–∞–≥ 1: –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ —Å –±–∏—Ä–∂–∏ (API)
**–§–∞–π–ª:** `src/strategies/scalping/futures/orchestrator.py:1530-1565`

```python
# ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ü–æ–ª—É—á–∞–µ–º —Ä–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏ –∏–∑ API
entry_time_dt = None
c_time = pos.get("cTime")  # ‚ö†Ô∏è –ú–æ–∂–µ—Ç –±—ã—Ç—å None
u_time = pos.get("uTime")  # ‚ö†Ô∏è –ú–æ–∂–µ—Ç –±—ã—Ç—å None
entry_time_str = c_time or u_time

if entry_time_str:
    try:
        entry_timestamp_ms = int(entry_time_str)
        entry_timestamp_sec = entry_timestamp_ms / 1000.0
        entry_time_dt = datetime.fromtimestamp(
            entry_timestamp_sec, tz=timezone.utc
        )
    except (ValueError, TypeError) as e:
        logger.warning(
            f"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å cTime/uTime –¥–ª—è {symbol}: {e}, "
            f"–∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è (fallback)"
        )
        entry_time_dt = datetime.now(timezone.utc)  # ‚ö†Ô∏è FALLBACK!
else:
    logger.warning(
        f"‚ö†Ô∏è cTime/uTime –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –¥–ª—è {symbol} –≤ –¥–∞–Ω–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–∏, "
        f"–∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è (fallback)"
    )
    entry_time_dt = datetime.now(timezone.utc)  # ‚ö†Ô∏è FALLBACK!
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ï—Å–ª–∏ `cTime` –∏ `uTime` –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤ –æ—Ç–≤–µ—Ç–µ API ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `datetime.now()`
- –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å `cTime`/`uTime` ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `datetime.now()`

**–ü–æ—á–µ–º—É `cTime`/`uTime` –º–æ–≥—É—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å?**
1. API –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —ç—Ç–∏ –ø–æ–ª—è (—Å—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è API)
2. –ü–æ–∑–∏—Ü–∏—è –±—ã–ª–∞ –æ—Ç–∫—Ä—ã—Ç–∞ –¥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è API
3. –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç)

---

#### –®–∞–≥ 2: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ–∑–∏—Ü–∏–π —Å –±–∏—Ä–∂–µ–π
**–§–∞–π–ª:** `src/strategies/scalping/futures/orchestrator.py:1860-1903`

```python
c_time = pos.get("cTime")
u_time = pos.get("uTime")
entry_time_str = c_time or u_time

if entry_time_str:
    try:
        entry_timestamp_ms = int(entry_time_str)
        entry_timestamp_sec = entry_timestamp_ms / 1000.0
        timestamp = datetime.fromtimestamp(
            entry_timestamp_sec, tz=timezone.utc
        )
    except (ValueError, TypeError, AttributeError) as e:
        logger.debug(
            f"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å cTime/uTime –¥–ª—è {symbol}: {e}, "
            f"–∏—Å–ø–æ–ª—å–∑—É–µ–º datetime.now() –∫–∞–∫ fallback"
        )

# Fallback –Ω–∞ datetime.now() —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å –±–∏—Ä–∂–∏
if timestamp is None:
    timestamp = datetime.now(timezone.utc)  # ‚ö†Ô∏è FALLBACK!
    logger.debug(
        f"‚ö†Ô∏è cTime/uTime –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –¥–ª—è {symbol} –≤ –¥–∞–Ω–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–∏, "
        f"–∏—Å–ø–æ–ª—å–∑—É–µ–º datetime.now() –∫–∞–∫ fallback"
    )
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –¢–∞ –∂–µ —Å–∞–º–∞—è - –µ—Å–ª–∏ API –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `cTime`/`uTime`

---

### üîç –ö–û–†–ù–ï–í–ê–Ø –ü–†–ò–ß–ò–ù–ê:

1. **API –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `cTime`/`uTime`:**
   - –°—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è API OKX
   - –ü–æ–∑–∏—Ü–∏—è –±—ã–ª–∞ –æ—Ç–∫—Ä—ã—Ç–∞ –¥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è API
   - –ü—Ä–æ–±–ª–µ–º–∞ —Å —Ñ–æ—Ä–º–∞—Ç–æ–º –æ—Ç–≤–µ—Ç–∞ API

2. **–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞:**
   - –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –≤—Ä–µ–º–µ–Ω–∏
   - `cTime`/`uTime` –Ω–µ —è–≤–ª—è—é—Ç—Å—è —á–∏—Å–ª–∞–º–∏

---

## üî¥ –ü–†–û–ë–õ–ï–ú–ê #3: `leverage = 3` –∏–ª–∏ `5` (FALLBACK)

### üìä –¶–ï–ü–û–ß–ö–ê –ü–û–õ–£–ß–ï–ù–ò–Ø leverage:

#### –®–∞–≥ 1: –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π leverage (AdaptiveLeverage)
**–§–∞–π–ª:** `src/strategies/scalping/futures/risk/adaptive_leverage.py:50-215`

```python
async def calculate_leverage(
    self,
    signal: Dict[str, Any],
    regime: Optional[str] = None,
    volatility: Optional[float] = None,
    client: Optional[Any] = None,
    base_position_margin_usd: Optional[float] = None,
) -> int:
    try:
        # ... —Ä–∞—Å—á–µ—Ç leverage ...
        return leverage
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–≥–æ –ª–µ–≤–µ—Ä–∏–¥–∂–∞: {e}", exc_info=True)
        return 5  # ‚ö†Ô∏è FALLBACK: —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ª–µ–≤–µ—Ä–∏–¥–∂
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ï—Å–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `5`
- –ï—Å–ª–∏ `adaptive_leverage` –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è fallback

---

#### –®–∞–≥ 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ leverage –≤ SignalCoordinator
**–§–∞–π–ª:** `src/strategies/scalping/futures/coordinators/signal_coordinator.py:1756-1781`

```python
# –ò—Å–ø–æ–ª—å–∑—É–µ–º –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π –ª–µ–≤–µ—Ä–∏–¥–∂ –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω, –∏–Ω–∞—á–µ fallback –Ω–∞ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π
if not self.adaptive_leverage:
    # Fallback –Ω–∞ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π leverage –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
    leverage_config = getattr(self.scalping_config, "leverage", None)
    if leverage_config is None or leverage_config <= 0:
        logger.warning(
            f"‚ö†Ô∏è leverage –Ω–µ —É–∫–∞–∑–∞–Ω –≤ –∫–æ–Ω—Ñ–∏–≥–µ –¥–ª—è {symbol}, –∏—Å–ø–æ–ª—å–∑—É–µ–º 3 (fallback)"
        )
        leverage_config = 3  # ‚ö†Ô∏è FALLBACK!
else:
    # Fallback –Ω–∞ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π leverage –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
    leverage_config = getattr(self.scalping_config, "leverage", None)
    if leverage_config is None or leverage_config <= 0:
        logger.warning(
            f"‚ö†Ô∏è leverage –Ω–µ —É–∫–∞–∑–∞–Ω –≤ –∫–æ–Ω—Ñ–∏–≥–µ –¥–ª—è {symbol}, –∏—Å–ø–æ–ª—å–∑—É–µ–º 3 (fallback)"
        )
        leverage_config = 3  # ‚ö†Ô∏è FALLBACK!
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ï—Å–ª–∏ `adaptive_leverage` = `None` ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
- –ï—Å–ª–∏ `leverage` –Ω–µ —É–∫–∞–∑–∞–Ω –≤ –∫–æ–Ω—Ñ–∏–≥–µ ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `3`

**–ü–æ—á–µ–º—É `adaptive_leverage` –º–æ–∂–µ—Ç –±—ã—Ç—å `None`?**
1. AdaptiveLeverage –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
2. –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ AdaptiveLeverage
3. `self.adaptive_leverage` –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω

---

### üîç –ö–û–†–ù–ï–í–ê–Ø –ü–†–ò–ß–ò–ù–ê:

1. **AdaptiveLeverage –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω:**
   - –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ AdaptiveLeverage
   - `self.adaptive_leverage` = `None`

2. **–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ leverage:**
   - –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –≤ `calculate_leverage()`
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è fallback `5`

3. **Leverage –Ω–µ —É–∫–∞–∑–∞–Ω –≤ –∫–æ–Ω—Ñ–∏–≥–µ:**
   - `scalping_config.leverage` = `None`
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è fallback `3`

---

## üî¥ –ü–†–û–ë–õ–ï–ú–ê #4: –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–∏—Å–∫–∞ (FALLBACK)

### üìä –¶–ï–ü–û–ß–ö–ê –ü–û–õ–£–ß–ï–ù–ò–Ø –ü–ê–†–ê–ú–ï–¢–†–û–í –†–ò–°–ö–ê:

#### –®–∞–≥ 1: –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–¥–∞–ø—Ç–∏–≤–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Ä–∏—Å–∫–∞
**–§–∞–π–ª:** `src/strategies/scalping/futures/orchestrator.py:3095-3141`

```python
async def _get_adaptive_risk_params(
    self, balance: float, regime: Optional[str] = None, symbol: Optional[str] = None
) -> Dict[str, Any]:
    try:
        # 1. –ü–æ–ª—É—á–∞–µ–º –±–∞–∑–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
        risk_config = getattr(self.config, "risk", None)
        if not risk_config:
            logger.warning(
                "‚ö†Ô∏è risk –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º fallback –∑–Ω–∞—á–µ–Ω–∏—è"
            )
            return self._get_fallback_risk_params()  # ‚ö†Ô∏è FALLBACK!

        # ‚úÖ –≠–¢–ê–ü 1: –ò—Å–ø–æ–ª—å–∑—É–µ–º ConfigManager –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∞–¥–∞–ø—Ç–∏–≤–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Ä–∏—Å–∫–∞
        return self.config_manager.get_adaptive_risk_params(
            balance, regime, symbol, signal_generator=self.signal_generator
        )
    except Exception as e:
        logger.error(
            f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∞–¥–∞–ø—Ç–∏–≤–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Ä–∏—Å–∫–∞: {e}", exc_info=True
        )
        return self.config_manager.get_fallback_risk_params()  # ‚ö†Ô∏è FALLBACK!
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ï—Å–ª–∏ `risk` –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è fallback
- –ï—Å–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è fallback

---

#### –®–∞–≥ 2: ConfigManager.get_adaptive_risk_params()
**–§–∞–π–ª:** `src/strategies/scalping/futures/config/config_manager.py:1150-1299`

```python
def get_adaptive_risk_params(
    self,
    balance: float,
    regime: Optional[str] = None,
    symbol: Optional[str] = None,
    signal_generator=None,
) -> Dict[str, Any]:
    try:
        # 1. –ü–æ–ª—É—á–∞–µ–º risk –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
        risk_config = getattr(self.config, "risk", None)
        if not risk_config:
            logger.warning("‚ö†Ô∏è risk –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞")
            return self.get_fallback_risk_params()  # ‚ö†Ô∏è FALLBACK!

        # 2. –ü–æ–ª—É—á–∞–µ–º —Ä–µ–∂–∏–º
        if not regime:
            if signal_generator:
                regime_manager = signal_generator.regime_manager
                if regime_manager:
                    regime = regime_manager.get_current_regime()
            if not regime:
                regime = "ranging"  # ‚ö†Ô∏è FALLBACK!

        # 3. –ü–æ–ª—É—á–∞–µ–º –±–∞–ª–∞–Ω—Å –ø—Ä–æ—Ñ–∏–ª—å
        balance_profile = self.get_balance_profile(balance)
        profile_name = balance_profile.get("name", "small")

        # 4. –ü–æ–ª—É—á–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º: —Ä–µ–∂–∏–º > –±–∞–ª–∞–Ω—Å > –±–∞–∑–æ–≤—ã–µ
        # ... –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ ...

        # 5. –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
        validated_params = self.validate_risk_params(
            result_params, regime, profile_name
        )

        return validated_params
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∞–¥–∞–ø—Ç–∏–≤–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Ä–∏—Å–∫–∞: {e}")
        return self.get_fallback_risk_params()  # ‚ö†Ô∏è FALLBACK!
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ï—Å–ª–∏ `risk` –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è fallback
- –ï—Å–ª–∏ —Ä–µ–∂–∏–º –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `"ranging"` (fallback)
- –ï—Å–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è fallback

---

#### –®–∞–≥ 3: –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
**–§–∞–π–ª:** `src/strategies/scalping/futures/config/config_manager.py:1067-1140`

```python
def validate_risk_params(
    self, params: Dict[str, Any], regime: str, profile_name: str
) -> Dict[str, Any]:
    validated = params.copy()
    fallback_params = self.get_fallback_risk_params()

    for param in required_params:
        if param not in validated or validated[param] is None:
            logger.warning(
                f"‚ö†Ô∏è –ü–∞—Ä–∞–º–µ—Ç—Ä {param} –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –∫–æ–Ω—Ñ–∏–≥–µ –¥–ª—è —Ä–µ–∂–∏–º–∞={regime}, –ø—Ä–æ—Ñ–∏–ª—å={profile_name}, "
                f"–∏—Å–ø–æ–ª—å–∑—É–µ–º fallback –∑–Ω–∞—á–µ–Ω–∏–µ: {fallback_params[param]}"
            )
            validated[param] = fallback_params[param]  # ‚ö†Ô∏è FALLBACK!
        elif (
            not isinstance(validated[param], (int, float)) or validated[param] <= 0
        ):
            logger.error(
                f"‚ùå –ü–∞—Ä–∞–º–µ—Ç—Ä {param} –∏–º–µ–µ—Ç –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: {validated[param]}, "
                f"–∏—Å–ø–æ–ª—å–∑—É–µ–º fallback –∑–Ω–∞—á–µ–Ω–∏–µ: {fallback_params[param]}"
            )
            validated[param] = fallback_params[param]  # ‚ö†Ô∏è FALLBACK!
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ï—Å–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –∫–æ–Ω—Ñ–∏–≥–µ ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è fallback
- –ï—Å–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä –Ω–µ–≤–∞–ª–∏–¥–µ–Ω (<= 0) ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è fallback

---

### üîç –ö–û–†–ù–ï–í–ê–Ø –ü–†–ò–ß–ò–ù–ê:

1. **Risk –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞:**
   - `config.risk` = `None`
   - –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–Ω—Ñ–∏–≥–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è

2. **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ –∫–æ–Ω—Ñ–∏–≥–µ:**
   - –ü–∞—Ä–∞–º–µ—Ç—Ä –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ `risk.by_regime[regime]`
   - –ü–∞—Ä–∞–º–µ—Ç—Ä –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ `risk.by_balance[profile]`
   - –ü–∞—Ä–∞–º–µ—Ç—Ä –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ `risk.base`

3. **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–µ–≤–∞–ª–∏–¥–Ω—ã:**
   - –ü–∞—Ä–∞–º–µ—Ç—Ä <= 0
   - –ü–∞—Ä–∞–º–µ—Ç—Ä –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —á–∏—Å–ª–æ–º

---

## üìä –ò–¢–û–ì–û–í–ê–Ø –¢–ê–ë–õ–ò–¶–ê –ü–†–û–ë–õ–ï–ú

| –ü—Ä–æ–±–ª–µ–º–∞ | –ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞ | –ì–¥–µ —Ç–µ—Ä—è—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ |
|----------|------------------|---------------------|
| **regime = "ranging"** | RegimeManager –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∏–ª–∏ –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω | `signal_generator.py:3866` |
| **entry_time = now()** | API –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `cTime`/`uTime` | `orchestrator.py:1555, 1894` |
| **leverage = 3/5** | AdaptiveLeverage –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –∏–ª–∏ –æ—à–∏–±–∫–∞ | `signal_coordinator.py:1764, 1781` |
| **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–∏—Å–∫–∞** | Risk –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –∏–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç | `config_manager.py:1097, 1105` |

---

## üéØ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –ò–°–ü–†–ê–í–õ–ï–ù–ò–Æ

### 1. –†–µ–∂–∏–º (regime)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é RegimeManager
- ‚úÖ –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ `update_regime()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ä–µ–≥—É–ª—è—Ä–Ω–æ
- ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É: –µ—Å–ª–∏ —Ä–µ–∂–∏–º –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω, –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –ø–æ–ª—É—á–∏—Ç—å –∏–∑ DataRegistry

### 2. entry_time
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ API OKX
- ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ `entry_time` (WebSocket, PositionRegistry)
- ‚úÖ –°–æ—Ö—Ä–∞–Ω—è—Ç—å `entry_time` –≤ PositionRegistry –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ø–æ–∑–∏—Ü–∏–∏

### 3. leverage
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é AdaptiveLeverage
- ‚úÖ –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ `leverage` —É–∫–∞–∑–∞–Ω –≤ –∫–æ–Ω—Ñ–∏–≥–µ
- ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É: –µ—Å–ª–∏ `adaptive_leverage` –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞

### 4. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–∏—Å–∫–∞
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–æ–Ω—Ñ–∏–≥–∞ `risk`
- ‚úÖ –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —É–∫–∞–∑–∞–Ω—ã –≤ –∫–æ–Ω—Ñ–∏–≥–µ
- ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É: –µ—Å–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç, –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å WARNING

---

**üìä –û–¢–ß–ï–¢ –°–û–ó–î–ê–ù**  
**–î–∞—Ç–∞:** 25 –¥–µ–∫–∞–±—Ä—è 2025, 12:00  
**–í–µ—Ä—Å–∏—è:** 1.0  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü–û–õ–ù–´–ô –ê–ù–ê–õ–ò–ó –¶–ï–ü–û–ß–ï–ö FALLBACK –ó–ù–ê–ß–ï–ù–ò–ô



