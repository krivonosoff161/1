# üß™ –ò–ù–°–¢–†–£–ö–¶–ò–Ø –ü–û –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Æ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô

**–î–∞—Ç–∞:** 09.01.2026  
**–í–µ—Ä—Å–∏—è:** 1.0

---

## ‚úÖ –ß–¢–û –ë–´–õ–û –ò–°–ü–†–ê–í–õ–ï–ù–û

```
‚ùå –î–û: ExitAnalyzer –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª REST API (1-5 —Å–µ–∫ –Ω–∞ VPN)
‚úÖ –ü–û–°–õ–ï: ExitAnalyzer –∏—Å–ø–æ–ª—å–∑—É–µ—Ç WebSocket –∏–∑ DataRegistry (<100ms)

‚ùå –î–û: TrailingSL –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª —Å—Ç–∞—Ä—ã–µ —Å–≤–µ—á–∏ (30-60 —Å–µ–∫)
‚úÖ –ü–û–°–õ–ï: TrailingSL –∏—Å–ø–æ–ª—å–∑—É–µ—Ç WebSocket –∏–∑ DataRegistry (<100ms)

‚ùå –î–û: WebSocket –¥–∞–Ω–Ω—ã–µ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–ª–∏—Å—å –≤ current_tick
‚úÖ –ü–û–°–õ–ï: WebSocket –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ DataRegistry.current_tick
```

---

## üöÄ –ë–´–°–¢–†–´–ô –¢–ï–°–¢

### 1Ô∏è‚É£ –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç

```bash
# –ù–∞ staging/dev
python run.py --mode futures
```

### 2Ô∏è‚É£ –°–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç "‚úÖ" —Å–æ–æ–±—â–µ–Ω–∏–π

```bash
# –ù–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–π –∫–æ–Ω—Å–æ–ª–∏
tail -f logs/futures/futures_main_*.log | grep -E "ExitAnalyzer.*WebSocket|TSL.*WebSocket|current_tick"
```

### 3Ô∏è‚É£ –£–°–ü–ï–• = –≤–∏–¥–∏–º —ç—Ç–∏ –ª–æ–≥–∏ —á–∞—Å—Ç–æ (–∫–∞–∂–¥—ã–π –∞–Ω–∞–ª–∏–∑ –≤—ã—Ö–æ–¥–∞):

```
‚úÖ ExitAnalyzer: WebSocket real-time price for BTC-USDT: 90250.50
‚úÖ TSL: WebSocket real-time price for BTC-USDT: 90250.75
```

### 4Ô∏è‚É£ –ù–ï –¥–æ–ª–∂–Ω—ã –≤–∏–¥–µ—Ç—å —ç—Ç–∏ –ª–æ–≥–∏ —á–∞—Å—Ç–æ:

```
üî¥ ExitAnalyzer: Using REST API  (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Ä–µ–¥–∫–æ)
üî¥ TSL: Using REST API           (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Ä–µ–¥–∫–æ)
```

---

## üìä –ë–û–õ–ï–ï –ü–û–õ–ù–´–ô –¢–ï–°–¢ (15-30 –ú–ò–ù–£–¢)

### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞

1. –û—Ç–∫—Ä—ã—Ç—å 2 —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ —Ä—è–¥–æ–º:
   - –¢–µ—Ä–º–∏–Ω–∞–ª #1: –ë–æ—Ç (logs –≤—ã–≤–æ–¥—è—Ç –Ω–∞ —ç–∫—Ä–∞–Ω)
   - –¢–µ—Ä–º–∏–Ω–∞–ª #2: –ê–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤ (watch mode)

### –¢–µ—Ä–º–∏–Ω–∞–ª #1: –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞

```bash
cd C:\Users\krivo\simple\ trading\ bot\ okx
python run.py --mode futures 2>&1 | tee test_session_$(date +%Y%m%d_%H%M%S).log
```

### –¢–µ—Ä–º–∏–Ω–∞–ª #2: Watch –ª–æ–≥–∏ –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç "WebSocket price"

```bash
# Windows PowerShell
Get-Content logs\futures\futures_main_*.log -Wait | Select-String "WebSocket real-time"

# –ò–ª–∏ Unix-like
tail -f logs/futures/futures_main_*.log | grep "WebSocket real-time"
```

### –û–∂–∏–¥–∞–Ω–∏—è:

**–ó–∞ 15 –º–∏–Ω—É—Ç –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:**

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –û–∂–∏–¥–∞–Ω–∏–µ | –°–∏–≥–Ω–∞–ª |
|-----------|----------|--------|
| SignalGenerator | +10-15 —Å–∏–≥–Ω–∞–ª–æ–≤ | ‚úÖ WebSocket prices –ª–æ–≥–∏—Ä—É—é—Ç—Å—è |
| ExitAnalyzer | +20-40 –∞–Ω–∞–ª–∏–∑–æ–≤ | ‚úÖ WebSocket prices –¥–ª—è –≤—ã—Ö–æ–¥–æ–≤ |
| TrailingSL | +30-50 checks | ‚úÖ WebSocket prices –¥–ª—è TSL |

**–ï—Å–ª–∏ —ç—Ç–æ–≥–æ –Ω–µ –≤–∏–¥–∏–º:** –ï—Å—Ç—å –ø—Ä–æ–±–ª–µ–º–∞ —Å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π!

---

## üî¥ –û–ë–ù–ê–†–£–ñ–ï–ù–ò–ï –ü–†–û–ë–õ–ï–ú

### –ü—Ä–æ–±–ª–µ–º–∞ 1: position_registry –Ω–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ TSL

**–ü—Ä–∏–∑–Ω–∞–∫:**
```
Traceback: AttributeError: 'TrailingSLCoordinator' has no attribute 'position_registry'
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```python
# –í orchestrator.py –ª–∏–Ω–∏—è ~520
self.trailing_sl_coordinator = TrailingSLCoordinator(
    ...
    position_registry=self.position_registry,  # ‚úÖ –î–û–õ–ñ–ù–û –ë–´–¢–¨!
)
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ `position_registry=self.position_registry,` –µ—Å—Ç—å –≤ –≤—ã–∑–æ–≤–µ

### –ü—Ä–æ–±–ª–µ–º–∞ 2: current_tick –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è

**–ü—Ä–∏–∑–Ω–∞–∫:**
```
‚ö†Ô∏è TSL: Failed to get DataRegistry real-time price
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```python
# –í websocket_coordinator.py –ª–∏–Ω–∏—è ~360
current_tick = CurrentTick(...)
await self.data_registry.update_market_data(
    symbol,
    {"current_tick": current_tick, ...}  # ‚úÖ –î–û–õ–ñ–ù–û –ë–´–¢–¨!
)
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ current_tick —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤ WebSocket handler

### –ü—Ä–æ–±–ª–µ–º–∞ 3: ExitAnalyzer –Ω–µ –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å data_registry

**–ü—Ä–∏–∑–Ω–∞–∫:**
```
AttributeError: 'ExitAnalyzer' has no attribute 'data_registry'
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```python
# –í exit_analyzer.py –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä (–ª–∏–Ω–∏—è ~67)
def __init__(self, position_registry, data_registry, ...):
    self.data_registry = data_registry  # ‚úÖ –î–û–õ–ñ–ù–û –ë–´–¢–¨!
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ data_registry —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ __init__

---

## üìà –ú–ï–¢–†–ò–ö–ò –î–õ–Ø –°–†–ê–í–ù–ï–ù–ò–Ø

### –ó–∞–ø—É—Å—Ç–∏—Ç—å –î–í–ê–ñ–î–´: –î–æ –∏ –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

#### Test Session #1 (–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π - –µ—Å–ª–∏ –µ—Å—Ç—å backup)

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ä—É—é –≤–µ—Ä—Å–∏—é
grep "ExitAnalyzer.*price\|TSL.*price" old_logs/futures_main.log | tail -20
```

–û–∂–∏–¥–∞–Ω–∏–µ: REST API delays, slow responses

#### Test Session #2 (–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π)

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é  
grep "ExitAnalyzer.*WebSocket\|TSL.*WebSocket" logs/futures/futures_main_*.log | tail -20
```

–û–∂–∏–¥–∞–Ω–∏–µ: WebSocket real-time prices, <100ms

### –°—Ä–∞–≤–Ω–∏—Ç—å:

```
–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
- ExitAnalyzer –≤—Ä–µ–º—è response: 1-5 —Å–µ–∫ (REST API)
- TSL checks –≤—Ä–µ–º—è: 30-60 –º—Å (—Å—Ç–∞—Ä–∞—è —Å–≤–µ—á–∞)
- Slippage: 0.5-2% (–∏–∑-–∑–∞ —Å—Ç–∞—Ä—ã—Ö —Ü–µ–Ω)

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
- ExitAnalyzer –≤—Ä–µ–º—è response: <100–º—Å (WebSocket)
- TSL checks –≤—Ä–µ–º—è: <100–º—Å (WebSocket)
- Slippage: <0.1% (—Å–≤–µ–∂–∏–µ —Ü–µ–Ω—ã)
```

---

## üß† –í–ê–ñ–ù–û: –ß–¢–û –û–¢–°–õ–ï–ñ–ò–í–ê–¢–¨

### ‚úÖ –•–æ—Ä–æ—à–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–∏:

1. –ß–∞—Å—Ç—ã–µ "‚úÖ ExitAnalyzer: WebSocket real-time price" –ª–æ–≥–∏
2. –ß–∞—Å—Ç—ã–µ "‚úÖ TSL: WebSocket real-time price" –ª–æ–≥–∏
3. –†–µ–¥–∫–∏–µ "‚ö†Ô∏è Using last candle" –ª–æ–≥–∏ (–∑–Ω–∞—á–∏—Ç WebSocket —Ä–∞–±–æ—Ç–∞–µ—Ç —Ö–æ—Ä–æ—à–æ)
4. –û—á–µ–Ω—å —Ä–µ–¥–∫–∏–µ "üî¥ REST API" –ª–æ–≥–∏

### ‚ö†Ô∏è –¢—Ä–µ–≤–æ–∂–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏:

1. –ú–Ω–æ–≥–æ "‚ö†Ô∏è Using last candle" –ª–æ–≥–æ–≤ (WebSocket –æ—Ç—Å—Ç–∞–µ—Ç –∏–ª–∏ —É–º–µ—Ä)
2. –ú–Ω–æ–≥–æ "üî¥ REST API callback" –ª–æ–≥–æ–≤ (fallback –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —á–∞—Å—Ç–æ)
3. "Failed to get DataRegistry" –æ—à–∏–±–∫–∏ (–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–±–ª–µ–º–∞)
4. –ü–æ–∑–∏—Ü–∏–∏ –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è –º–µ–¥–ª–µ–Ω–Ω–æ (exit analysis –º–µ–¥–ª–µ–Ω–Ω–∞—è)

### üî¥ –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

1. AttributeError –Ω–∞ position_registry –∏–ª–∏ data_registry (–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è broken)
2. –ë–æ—Ç –≤–æ–æ–±—â–µ –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è (syntax error –≤ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö)
3. –¢–æ–ª—å–∫–æ REST API –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –Ω–∏–∫–æ–≥–¥–∞ WebSocket (DataRegistry –º–µ—Ä—Ç–≤–∞)

---

## üìù –ò–¢–û–ì–û–í–´–ô –ß–ï–ö–õ–ò–°–¢ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø

- [ ] –ë–æ—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] –í –ª–æ–≥–∞—Ö –≤–∏–¥–Ω—ã "‚úÖ WebSocket real-time price" —Å–æ–æ–±—â–µ–Ω–∏—è
- [ ] ExitAnalyzer –≤–∏–¥–∏—Ç WebSocket prices (–Ω–µ REST API)
- [ ] TrailingSL –≤–∏–¥–∏—Ç WebSocket prices (–Ω–µ —Å—Ç–∞—Ä—ã–µ —Å–≤–µ—á–∏)
- [ ] Fallback —Ä–∞–±–æ—Ç–∞–µ—Ç –µ—Å–ª–∏ WebSocket –≤—Ä–µ–º–µ–Ω–Ω–æ unavailable
- [ ] –ü–æ–∑–∏—Ü–∏–∏ –æ—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è –≤ –Ω–æ—Ä–º–∞–ª—å–Ω—ã—Ö —Ç–æ—á–∫–∞—Ö (–Ω–µ –¥–∞–ª–µ–∫–æ –æ—Ç —Ä—ã–Ω–∫–∞)
- [ ] –ü–æ–∑–∏—Ü–∏–∏ –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è –±—ã—Å—Ç—Ä–æ (–Ω–µ —Å 1-5 —Å–µ–∫ –∑–∞–¥–µ—Ä–∂–∫–æ–π)
- [ ] –ù–∞ –ø–ª–æ—Ö–æ–º –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ –±–æ—Ç –Ω–µ –∑–∞–≤–∏—Å–∞–µ—Ç
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥ –º–µ–∂–¥—É —É—Ä–æ–≤–Ω—è–º–∏ fallback

---

## üéØ –ò–¢–û–ì–û–í–´–ô –£–°–ü–ï–•

**–†–µ–∑—É–ª—å—Ç–∞—Ç SUCCESS –µ—Å–ª–∏:**

1. ‚úÖ –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ—à–∏–±–æ–∫
2. ‚úÖ –í–∏–¥–Ω—ã "WebSocket real-time price" –ª–æ–≥–∏ –æ—Ç ExitAnalyzer –∏ TSL
3. ‚úÖ –í—ã—Ö–æ–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç –±—ã—Å—Ç—Ä–æ (<1 —Å–µ–∫ –∞–Ω–∞–ª–∏–∑)
4. ‚úÖ –í—Ö–æ–¥—ã –≤ –Ω–æ—Ä–º–∞–ª—å–Ω—ã—Ö —Ç–æ—á–∫–∞—Ö (–Ω–µ 0.5-2% —Å–ª–∏–ø–¥–∂)
5. ‚úÖ –ù–∞ VPN –±–æ—Ç –Ω–µ –∑–∞–≤–∏—Å–∞–µ—Ç, graceful fallback —Ä–∞–±–æ—Ç–∞–µ—Ç

**–†–µ–∑—É–ª—å—Ç–∞—Ç FAILED –µ—Å–ª–∏:**

1. ‚ùå AttributeError –Ω–∞ position_registry –∏–ª–∏ data_registry
2. ‚ùå –¢–æ–ª—å–∫–æ REST API –ª–æ–≥–∏, –Ω–∏–∫–æ–≥–¥–∞ WebSocket
3. ‚ùå ExitAnalyzer –∏—Å–ø–æ–ª—å–∑—É–µ—Ç REST API –∫–∞–∂–¥—ã–π —Ä–∞–∑
4. ‚ùå –ü–æ–∑–∏—Ü–∏–∏ –≤—Å–µ –µ—â–µ –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π 1-5 —Å–µ–∫
5. ‚ùå –í—Ö–æ–¥—ã —Å –±–æ–ª—å—à–∏–º —Å–ª–∏–ø–¥–∂–µ–º (0.5-2%)

---

**–î–∞—Ç–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:** _______________  
**–í–µ—Ä—Å–∏—è –±–æ—Ç–∞:** _______________  
**–°—Ç–∞—Ç—É—Å:** [ ] PASS [ ] FAIL  
**–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:** _______________
