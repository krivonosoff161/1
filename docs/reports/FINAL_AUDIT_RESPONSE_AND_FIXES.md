# –§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –Ω–∞ –∞—É–¥–∏—Ç Qwen3-Max: –ü–ª–∞–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

**–î–∞—Ç–∞:** 2025-12-07  
**–ê—É–¥–∏—Ç–æ—Ä:** Qwen3-Max (Kimi)  
**–°—Ç–∞—Ç—É—Å:** –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Ç—Ä–µ–±—É—é—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –î–û live-—Ç–æ—Ä–≥–æ–≤–ª–∏

---

## üìä –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ –∞—É–¥–∏—Ç–∞

**–¢–æ—á–Ω–æ—Å—Ç—å:** ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (5/5) - –ê—É–¥–∏—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ç–æ—á–µ–Ω  
**–£—á–µ—Ç –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç–∏:** ‚≠ê‚≠ê‚≠ê‚≠ê (4/5) - –•–æ—Ä–æ—à–æ —É—á—Ç–µ–Ω–∞, –Ω–æ –º–æ–∂–Ω–æ –≥–ª—É–±–∂–µ  
**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º:** ‚≠ê‚≠ê‚≠ê‚≠ê (4/5) - –†–µ–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã, —Ç—Ä–µ–±—É—é—â–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

**–í—ã–≤–æ–¥:** –ê—É–¥–∏—Ç **–ø–æ–ª–Ω–æ—Å—Ç—å—é –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω**. –í—Å–µ 4 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Ä–µ–∞–ª—å–Ω—ã –∏ —Ç—Ä–µ–±—É—é—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è.

---

## ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ: –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ö–æ—Ä–æ—à–æ

–ê—É–¥–∏—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤—ã–¥–µ–ª–∏–ª —Å–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã:

1. ‚úÖ **–ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞** - –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ö–æ—Ä–æ—à–æ
2. ‚úÖ **–ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π —Ä–∏—Å–∫-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç** - –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
3. ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏** - LiquidityFilter —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
4. ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - sandbox –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, .env –¥–ª—è –∫–ª—é—á–µ–π

**–ù–∏–∫–∞–∫–∏—Ö –∑–∞–º–µ—á–∞–Ω–∏–π - –≤—Å–µ –≤–µ—Ä–Ω–æ.**

---

## üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã: –ü–ª–∞–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### üî¥ 1. Kelly Criterion: –õ–æ–≥–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞

**–ü—Ä–æ–±–ª–µ–º–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞:** ‚úÖ –î–∞, –ª–æ–≥–∏–∫–∞ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è.

**–¢–µ–∫—É—â–∏–π –∫–æ–¥ (margin_calculator.py:624-625):**
```python
kelly_fraction_safe = min(kelly_fraction * 0.25, 0.1)  # –ú–∞–∫—Å–∏–º—É–º 10%
kelly_multiplier = max(0.5, min(2.0, kelly_fraction_safe / risk_percentage))
adjusted_risk_percentage = risk_percentage * kelly_multiplier
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
1. Kelly –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –º–Ω–æ–∂–∏—Ç–µ–ª—å –∫ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–º—É 3%, —á—Ç–æ –∏—Å–∫–∞–∂–∞–µ—Ç —Å–º—ã—Å–ª
2. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ `kelly_multiplier ‚â§ 2.0` –æ–∑–Ω–∞—á–∞–µ—Ç –º–∞–∫—Å–∏–º—É–º 6% –¥–∞–∂–µ –µ—Å–ª–∏ Kelly = 10%
3. –î–ª—è —Å–∫–∞–ª—å–ø–∏–Ω–≥–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±—ã—Å—Ç—Ä–æ —É—Å—Ç–∞—Ä–µ–≤–∞–µ—Ç

**–†–µ—à–µ–Ω–∏–µ:**

**–í–∞—Ä–∏–∞–Ω—Ç A: –ü–æ–ª–Ω–æ—Å—Ç—å—é —É–±—Ä–∞—Ç—å Kelly (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è —Å–∫–∞–ª—å–ø–∏–Ω–≥–∞)**

```python
# –í margin_calculator.py, –º–µ—Ç–æ–¥ calculate_optimal_position_size()
# –£–î–ê–õ–ò–¢–¨ –≤–µ—Å—å –±–ª–æ–∫ —Å Kelly Criterion (—Å—Ç—Ä–æ–∫–∏ ~600-645)

# –û—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ:
adjusted_risk_percentage = risk_percentage  # –ë–µ–∑ Kelly
max_risk_usdt = equity * adjusted_risk_percentage
```

**–í–∞—Ä–∏–∞–Ω—Ç B: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Kelly –Ω–∞–ø—Ä—è–º—É—é (–µ—Å–ª–∏ –≤—Å–µ –∂–µ –Ω—É–∂–µ–Ω)**

```python
# –í margin_calculator.py
if kelly_fraction > 0:
    # –ò—Å–ø–æ–ª—å–∑—É–µ–º Kelly –Ω–∞–ø—Ä—è–º—É—é, –Ω–æ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
    kelly_fraction_safe = min(kelly_fraction * 0.25, 0.02)  # –ú–∞–∫—Å–∏–º—É–º 2%
    # –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–∞–∫ –º–Ω–æ–∂–∏—Ç–µ–ª—å, –∞ –∫–∞–∫ –ø—Ä—è–º–æ–π —Ä–∏—Å–∫
    adjusted_risk_percentage = kelly_fraction_safe
else:
    # –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π Kelly - –∏—Å–ø–æ–ª—å–∑—É–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∏—Å–∫
    adjusted_risk_percentage = risk_percentage * 0.5  # 50% –æ—Ç –±–∞–∑–æ–≤–æ–≥–æ
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –í–∞—Ä–∏–∞–Ω—Ç A (—É–±—Ä–∞—Ç—å Kelly) - –¥–ª—è —Å–∫–∞–ª—å–ø–∏–Ω–≥–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–ª–∏—à–∫–æ–º —à—É–º–Ω–∞—è.

---

### üî¥ 2. –ü—Ä–æ—Ç–∏–≤–æ—Ç—Ä–µ–Ω–¥–æ–≤—ã–µ —Å–∏–≥–Ω–∞–ª—ã –≤ —Ä–µ–∂–∏–º–µ "trending"

**–ü—Ä–æ–±–ª–µ–º–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞:** ‚úÖ –î–∞, —Å–∏–≥–Ω–∞–ª—ã –ø—Ä–æ—Ö–æ–¥—è—Ç –¥–∞–∂–µ –ø—Ä–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–µ —Å —Ç—Ä–µ–Ω–¥–æ–º.

**–¢–µ–∫—É—â–∏–π –∫–æ–¥ (signal_generator.py:2005-2047):**
```python
if is_downtrend:  # RSI oversold, –Ω–æ EMA bearish
    strength *= conflict_multiplier  # –û–±—ã—á–Ω–æ 0.5
    confidence = normal_conf * 0.5
    # –ù–û —Å–∏–≥–Ω–∞–ª –≤—Å–µ —Ä–∞–≤–Ω–æ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è!

# –ü—Ä–æ–≤–µ—Ä–∫–∞ ADX —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ—á–µ–Ω—å —Å–∏–ª—å–Ω—ã–π —Ç—Ä–µ–Ω–¥
if adx_trend == "bearish" and adx_value >= adx_threshold:
    # –û—Ç–º–µ–Ω—è–µ–º —Å–∏–≥–Ω–∞–ª
else:
    signals.append(...)  # –°–∏–≥–Ω–∞–ª –ø—Ä–æ—Ö–æ–¥–∏—Ç
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –í trending —Ä–µ–∂–∏–º–µ ADX —á–∞—Å—Ç–æ 20-25 (–Ω–µ –æ—á–µ–Ω—å —Å–∏–ª—å–Ω—ã–π)
- –°–∏–≥–Ω–∞–ª –ø—Ä–æ—Ö–æ–¥–∏—Ç —Å –æ—Å–ª–∞–±–ª–µ–Ω–Ω—ã–º strength
- –†–µ–∑—É–ª—å—Ç–∞—Ç: —É–±—ã—Ç–æ—á–Ω–∞—è —Å–¥–µ–ª–∫–∞ –ø—Ä–æ—Ç–∏–≤ —Ç—Ä–µ–Ω–¥–∞

**–†–µ—à–µ–Ω–∏–µ:**

```python
# –í signal_generator.py, –º–µ—Ç–æ–¥ _generate_rsi_signals()

# –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º
regime_manager = self.regime_managers.get(symbol) or self.regime_manager
current_regime = (
    regime_manager.get_current_regime().lower() 
    if regime_manager else "ranging"
)

# –î–ª—è LONG —Å–∏–≥–Ω–∞–ª–∞ (RSI oversold)
if rsi < rsi_oversold:
    is_downtrend = ema_fast < ema_slow and current_price < ema_fast
    
    # ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –í trending —Ä–µ–∂–∏–º–µ - –ø–æ–ª–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞
    if current_regime == "trending" and is_downtrend:
        logger.debug(
            f"üö´ RSI OVERSOLD —Å–∏–≥–Ω–∞–ª –ü–û–õ–ù–û–°–¢–¨–Æ –ó–ê–ë–õ–û–ö–ò–†–û–í–ê–ù –¥–ª—è {symbol}: "
            f"trending —Ä–µ–∂–∏–º + EMA bearish (–∫–æ–Ω—Ñ–ª–∏–∫—Ç —Å —Ç—Ä–µ–Ω–¥–æ–º)"
        )
        # –ù–ï –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–∏–≥–Ω–∞–ª –≤–æ–æ–±—â–µ
        continue  # –∏–ª–∏ return None
    
    # –î–ª—è ranging/choppy - –æ—Å–ª–∞–±–ª—è–µ–º, –Ω–æ –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ–º
    elif is_downtrend:
        strength *= conflict_multiplier  # –û–±—ã—á–Ω–æ 0.5
        confidence = normal_conf * 0.5
        has_conflict = True
    else:
        confidence = normal_conf
        has_conflict = False
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ ADX (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞)
    if adx_trend == "bearish" and adx_value >= adx_threshold:
        logger.debug(
            f"üö´ RSI OVERSOLD —Å–∏–≥–Ω–∞–ª –û–¢–ú–ï–ù–ï–ù –¥–ª—è {symbol}: "
            f"ADX –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∏—Å—Ö–æ–¥—è—â–∏–π —Ç—Ä–µ–Ω–¥ (ADX={adx_value:.1f})"
        )
        continue  # –ù–ï –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–∏–≥–Ω–∞–ª
    
    # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–∏–≥–Ω–∞–ª —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ –∏–ª–∏ —Ä–µ–∂–∏–º –Ω–µ trending
    signals.append({
        "symbol": symbol,
        "side": "buy",
        "type": "rsi_oversold",
        "strength": strength,
        "confidence": confidence,
        "has_conflict": has_conflict,
        ...
    })

# –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–ª—è SHORT —Å–∏–≥–Ω–∞–ª–∞ (RSI overbought)
elif rsi > rsi_overbought:
    is_uptrend = ema_fast > ema_slow and current_price > ema_fast
    
    # ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –í trending —Ä–µ–∂–∏–º–µ - –ø–æ–ª–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞
    if current_regime == "trending" and is_uptrend:
        logger.debug(
            f"üö´ RSI OVERBOUGHT —Å–∏–≥–Ω–∞–ª –ü–û–õ–ù–û–°–¢–¨–Æ –ó–ê–ë–õ–û–ö–ò–†–û–í–ê–ù –¥–ª—è {symbol}: "
            f"trending —Ä–µ–∂–∏–º + EMA bullish (–∫–æ–Ω—Ñ–ª–∏–∫—Ç —Å —Ç—Ä–µ–Ω–¥–æ–º)"
        )
        continue  # –ù–ï –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–∏–≥–Ω–∞–ª
    
    # –î–ª—è ranging/choppy - –æ—Å–ª–∞–±–ª—è–µ–º
    elif is_uptrend:
        strength *= conflict_multiplier
        confidence = normal_conf * 0.5
        has_conflict = True
    else:
        confidence = normal_conf
        has_conflict = False
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ ADX
    if adx_trend == "bullish" and adx_value >= adx_threshold:
        logger.debug(
            f"üö´ RSI OVERBOUGHT —Å–∏–≥–Ω–∞–ª –û–¢–ú–ï–ù–ï–ù –¥–ª—è {symbol}: "
            f"ADX –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤–æ—Å—Ö–æ–¥—è—â–∏–π —Ç—Ä–µ–Ω–¥ (ADX={adx_value:.1f})"
        )
        continue
    
    signals.append({
        "symbol": symbol,
        "side": "sell",
        "type": "rsi_overbought",
        "strength": strength,
        "confidence": confidence,
        "has_conflict": has_conflict,
        ...
    })
```

**–¢–∞–∫–∂–µ –æ–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥:**

```yaml
# config/config_futures.yaml
scalping:
  adaptive_regime:
    trending:
      # ‚úÖ –ù–û–í–û–ï: –ü–æ–ª–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø—Ä–æ—Ç–∏–≤–æ—Ç—Ä–µ–Ω–¥–æ–≤—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤
      block_counter_trend: true  # –ë–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Å–∏–≥–Ω–∞–ª—ã –ø—Ä–æ—Ç–∏–≤ —Ç—Ä–µ–Ω–¥–∞
      conflict_multiplier: 0.0   # 0.0 = –ø–æ–ª–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞
    ranging:
      block_counter_trend: false
      conflict_multiplier: 0.3   # –°–∏–ª—å–Ω–æ–µ –æ—Å–ª–∞–±–ª–µ–Ω–∏–µ
    choppy:
      block_counter_trend: false
      conflict_multiplier: 0.5   # –£–º–µ—Ä–µ–Ω–Ω–æ–µ –æ—Å–ª–∞–±–ª–µ–Ω–∏–µ
```

---

### üü° 3. ATR-based TP/SL ‚Äî –¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é

**–ü—Ä–æ–±–ª–µ–º–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞:** ‚úÖ –î–∞, ATR —É–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ñ–∏–Ω–∞–ª—å–Ω–æ–º —Ä–∞—Å—á–µ—Ç–µ.

**–¢–µ–∫—É—â–∏–π –∫–æ–¥ (position_manager.py:220-264):**
```python
# ‚úÖ –≠–¢–ê–ü 2.3: –ü—Ä–æ–≤–µ—Ä—è–µ–º ATR-based TP –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ
if current_price and current_price > 0 and regime:
    # –ü–æ–ª—É—á–∞–µ–º tp_atr_multiplier –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
    # –ù–û –≤ —Ñ–∏–Ω–∞–ª—å–Ω–æ–º return –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ tp_percent!
    return tp_percent  # ATR –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
```

**–†–µ—à–µ–Ω–∏–µ:**

```python
# –í position_manager.py, –º–µ—Ç–æ–¥ _get_adaptive_tp_percent()

def _get_adaptive_tp_percent(
    self,
    symbol: str,
    regime: Optional[str] = None,
    current_price: Optional[float] = None,
) -> float:
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ –ø–æ–ª—É—á–µ–Ω–∏—è tp_percent –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ ...
    
    # ‚úÖ –ù–û–í–û–ï: ATR-based —Ä–∞—Å—á–µ—Ç
    tp_atr_percent = None
    if current_price and current_price > 0 and regime:
        try:
            # –ü–æ–ª—É—á–∞–µ–º regime_params
            regime_params = None
            if hasattr(self, "orchestrator") and self.orchestrator:
                if hasattr(self.orchestrator, "config_manager"):
                    regime_params = (
                        self.orchestrator.config_manager.get_regime_params(
                            regime, symbol
                        )
                    )
            
            if regime_params:
                tp_atr_multiplier = regime_params.get("tp_atr_multiplier")
                
                # –ü–æ–ª—É—á–∞–µ–º ATR —á–µ—Ä–µ–∑ orchestrator
                if hasattr(self, "orchestrator") and self.orchestrator:
                    if hasattr(self.orchestrator, "signal_generator"):
                        signal_gen = self.orchestrator.signal_generator
                        
                        # –ü–æ–ª—É—á–∞–µ–º market_data
                        market_data = await signal_gen._get_market_data(symbol)
                        if market_data and market_data.ohlcv_data:
                            # –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º ATR
                            from src.indicators import ATR
                            
                            high_data = [candle.high for candle in market_data.ohlcv_data[-20:]]
                            low_data = [candle.low for candle in market_data.ohlcv_data[-20:]]
                            close_data = [candle.close for candle in market_data.ohlcv_data[-20:]]
                            
                            atr_indicator = ATR(period=14)
                            atr_result = atr_indicator.calculate(high_data, low_data, close_data)
                            atr_value = atr_result.value
                            
                            if atr_value > 0 and tp_atr_multiplier:
                                # –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º TP% –Ω–∞ –æ—Å–Ω–æ–≤–µ ATR
                                tp_atr_percent = (atr_value * tp_atr_multiplier / current_price) * 100
                                
                                logger.debug(
                                    f"üìä ATR-based TP –¥–ª—è {symbol}: "
                                    f"ATR={atr_value:.2f}, multiplier={tp_atr_multiplier}, "
                                    f"tp_atr_percent={tp_atr_percent:.2f}%"
                                )
        except Exception as e:
            logger.debug(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ ATR-based TP –¥–ª—è {symbol}: {e}")
    
    # ‚úÖ –§–ò–ù–ê–õ–¨–ù–´–ô –†–ê–°–ß–ï–¢: max(–∫–æ–Ω—Ñ–∏–≥ TP%, ATR-based TP%)
    if tp_atr_percent is not None:
        final_tp_percent = max(tp_percent, tp_atr_percent)
        logger.debug(
            f"üìä –§–∏–Ω–∞–ª—å–Ω—ã–π TP –¥–ª—è {symbol}: "
            f"config={tp_percent:.2f}%, atr={tp_atr_percent:.2f}%, "
            f"final={final_tp_percent:.2f}%"
        )
        return final_tp_percent
    else:
        return tp_percent
```

**–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–ª—è SL:**

```python
def _get_adaptive_sl_percent(
    self,
    symbol: str,
    regime: Optional[str] = None,
    current_price: Optional[float] = None,
) -> float:
    # ... –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–π –∫–æ–¥ –¥–ª—è SL ...
    
    # ATR-based SL
    sl_atr_percent = None
    if current_price and current_price > 0 and regime:
        # ... –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ TP ...
        if atr_value > 0 and sl_atr_multiplier:
            sl_atr_percent = (atr_value * sl_atr_multiplier / current_price) * 100
    
    # –§–∏–Ω–∞–ª—å–Ω—ã–π SL: max(–∫–æ–Ω—Ñ–∏–≥ SL%, ATR-based SL%)
    if sl_atr_percent is not None:
        final_sl_percent = max(sl_percent, sl_atr_percent)
        return final_sl_percent
    else:
        return sl_percent
```

---

### üü° 4. –ë–∞–∑–æ–≤—ã–π risk_per_trade = 3% ‚Äî —Å–Ω–∏–∑–∏—Ç—å

**–ü—Ä–æ–±–ª–µ–º–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞:** ‚úÖ –î–∞, 3% —Å–ª–∏—à–∫–æ–º –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ –¥–ª—è —Å–∫–∞–ª—å–ø–∏–Ω–≥–∞.

**–¢–µ–∫—É—â–∏–π –∫–æ–Ω—Ñ–∏–≥:**
```yaml
scalping:
  base_risk_percentage: 0.03  # 3%
  
risk:
  risk_per_trade_percent: 1.5  # 1.5%
  
  by_regime:
    trending:
      max_loss_per_trade_percent: 1.5  # 1.5%
    ranging:
      max_loss_per_trade_percent: 2.0  # 2.0%
    choppy:
      max_loss_per_trade_percent: 2.5  # 2.5%
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `base_risk_percentage: 0.03` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏
- –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (1.5-2.5%) –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è max_loss
- –≠—Ç–æ —Å–æ–∑–¥–∞–µ—Ç –ø—É—Ç–∞–Ω–∏—Ü—É

**–†–µ—à–µ–Ω–∏–µ:**

**–í–∞—Ä–∏–∞–Ω—Ç A: –°–Ω–∏–∑–∏—Ç—å –±–∞–∑–æ–≤—ã–π —Ä–∏—Å–∫ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è**

```yaml
# config/config_futures.yaml
scalping:
  base_risk_percentage: 0.01  # ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –°–Ω–∏–∂–µ–Ω–æ —Å 0.03 –¥–æ 0.01 (1%)
  # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –∫–∞–∫ fallback, –µ—Å–ª–∏ —Ä–µ–∂–∏–º –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω

risk:
  risk_per_trade_percent: 1.0  # ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –°–Ω–∏–∂–µ–Ω–æ —Å 1.5 –¥–æ 1.0 (1%)
  
  by_regime:
    trending:
      max_loss_per_trade_percent: 1.0  # ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –°–Ω–∏–∂–µ–Ω–æ —Å 1.5 –¥–æ 1.0
      risk_per_trade_percent: 1.0  # ‚úÖ –ù–û–í–û–ï: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Ä–∞–∑–º–µ—Ä–∞
    ranging:
      max_loss_per_trade_percent: 1.5  # ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –°–Ω–∏–∂–µ–Ω–æ —Å 2.0 –¥–æ 1.5
      risk_per_trade_percent: 1.5  # ‚úÖ –ù–û–í–û–ï
    choppy:
      max_loss_per_trade_percent: 2.0  # ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –°–Ω–∏–∂–µ–Ω–æ —Å 2.5 –¥–æ 2.0
      risk_per_trade_percent: 2.0  # ‚úÖ –ù–û–í–û–ï
```

**–í–∞—Ä–∏–∞–Ω—Ç B: –ü–æ–ª–Ω–æ—Å—Ç—å—é —É–±—Ä–∞—Ç—å –±–∞–∑–æ–≤—ã–π —Ä–∏—Å–∫, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–µ**

```yaml
# config/config_futures.yaml
scalping:
  # base_risk_percentage: –£–î–ê–õ–ï–ù–û - –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
  # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ risk.by_regime

risk:
  risk_per_trade_percent: 1.0  # Fallback, –µ—Å–ª–∏ —Ä–µ–∂–∏–º –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω
  
  by_regime:
    trending:
      risk_per_trade_percent: 1.0  # –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Ä–∞–∑–º–µ—Ä–∞
      max_loss_per_trade_percent: 1.0  # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø–æ—Ç–µ—Ä—è
    ranging:
      risk_per_trade_percent: 1.5
      max_loss_per_trade_percent: 1.5
    choppy:
      risk_per_trade_percent: 2.0
      max_loss_per_trade_percent: 2.0
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –í–∞—Ä–∏–∞–Ω—Ç B - –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥, –±–µ–∑ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –±–∞–∑–æ–≤–æ–≥–æ —Ä–∏—Å–∫–∞.

**–û–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥ –≤ risk_manager.py:**

```python
# –í risk_manager.py, –º–µ—Ç–æ–¥ calculate_position_size()

# ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –ò—Å–ø–æ–ª—å–∑—É–µ–º –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π risk_per_trade –∏–∑ —Ä–µ–∂–∏–º–∞
risk_per_trade = None
if regime and regime_params:
    # –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: risk_per_trade_percent –∏–∑ —Ä–µ–∂–∏–º–∞
    risk_per_trade = regime_params.get("risk_per_trade_percent")
    
if risk_per_trade is None:
    # –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: risk_per_trade_percent –∏–∑ risk —Å–µ–∫—Ü–∏–∏
    risk_per_trade = getattr(self.risk_config, "risk_per_trade_percent", 0.01)
    
if risk_per_trade is None:
    # Fallback: –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∏—Å–∫ 1%
    risk_per_trade = 0.01

# –ò—Å–ø–æ–ª—å–∑—É–µ–º risk_per_trade –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Ä–∞–∑–º–µ—Ä–∞
base_usd_size = balance * risk_per_trade  # –í–º–µ—Å—Ç–æ base_risk_percentage
```

---

## üìã –ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫)

### –≠—Ç–∞–ø 1: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–î–û sandbox —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

1. ‚úÖ **–ò—Å–ø—Ä–∞–≤–∏—Ç—å Kelly Criterion** (–í–∞—Ä–∏–∞–Ω—Ç A: —É–±—Ä–∞—Ç—å)
   - –§–∞–π–ª: `src/strategies/scalping/futures/calculations/margin_calculator.py`
   - –£–¥–∞–ª–∏—Ç—å –±–ª–æ–∫ —Å Kelly (—Å—Ç—Ä–æ–∫–∏ ~600-645)
   - –û—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ `adjusted_risk_percentage = risk_percentage`

2. ‚úÖ **–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ç–∏–≤–æ—Ç—Ä–µ–Ω–¥–æ–≤—ã–µ —Å–∏–≥–Ω–∞–ª—ã –≤ trending**
   - –§–∞–π–ª: `src/strategies/scalping/futures/signal_generator.py`
   - –ú–µ—Ç–æ–¥: `_generate_rsi_signals()`
   - –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–Ω—É—é –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –ø—Ä–∏ `regime == "trending"` –∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–µ EMA

3. ‚úÖ **–°–Ω–∏–∑–∏—Ç—å –±–∞–∑–æ–≤—ã–π —Ä–∏—Å–∫ –¥–æ 1%**
   - –§–∞–π–ª: `config/config_futures.yaml`
   - –ò–∑–º–µ–Ω–∏—Ç—å `base_risk_percentage: 0.03` ‚Üí `0.01`
   - –ò–ª–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–±—Ä–∞—Ç—å, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è

### –≠—Ç–∞–ø 2: –í–∞–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (–ø–µ—Ä–µ–¥ live)

4. ‚úÖ **–î–æ—Ä–∞–±–æ—Ç–∞—Ç—å ATR-based TP/SL**
   - –§–∞–π–ª: `src/strategies/scalping/futures/position_manager.py`
   - –ú–µ—Ç–æ–¥—ã: `_get_adaptive_tp_percent()`, `_get_adaptive_sl_percent()`
   - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ä–∞—Å—á–µ—Ç ATR –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `max(tp_percent, tp_atr_percent)`

### –≠—Ç–∞–ø 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

5. ‚úÖ **–ó–∞–ø—É—Å—Ç–∏—Ç—å –≤ sandbox –Ω–∞ 2-4 –Ω–µ–¥–µ–ª–∏**
   - –°–æ–±—Ä–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É: win rate, avg win/loss, slippage
   - –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å CSV —Ñ–∞–π–ª—ã
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø—Ä–æ—Ç–∏–≤–æ—Ç—Ä–µ–Ω–¥–æ–≤—ã–µ —Å–∏–≥–Ω–∞–ª—ã –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –≤ trending

6. ‚úÖ **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π live —Å $50-100**
   - –¢–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ sandbox —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
   - –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –∫–∞–∂–¥—ã–π –¥–µ–Ω—å
   - –°—Ä–∞–≤–Ω–∏–≤–∞—Ç—å —Å sandbox —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏

### –≠—Ç–∞–ø 4: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (–ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞)

7. ‚è≥ **Backtesting –º–æ–¥—É–ª—å** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
8. ‚è≥ **–ú–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ slippage** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
9. ‚è≥ **–ú–µ—Ç—Ä–∏–∫–∏ drawdown** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

---

## üéØ –î–µ—Ä–µ–≤–æ –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π –¥–ª—è –≤—Ö–æ–¥–∞ –≤ —Å–¥–µ–ª–∫—É

```
1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–∞ (signal_generator.py)
   ‚îÇ
   ‚îú‚îÄ 1.1. –†–∞—Å—á–µ—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ (RSI, EMA, ATR, ADX)
   ‚îÇ
   ‚îú‚îÄ 1.2. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ —Ä—ã–Ω–∫–∞ (trending/ranging/choppy)
   ‚îÇ
   ‚îú‚îÄ 1.3. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è RSI —Å–∏–≥–Ω–∞–ª–∞
   ‚îÇ   ‚îÇ
   ‚îÇ   ‚îú‚îÄ 1.3.1. RSI oversold (BUY)?
   ‚îÇ   ‚îÇ   ‚îÇ
   ‚îÇ   ‚îÇ   ‚îú‚îÄ 1.3.1.1. –†–µ–∂–∏–º = trending?
   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ
   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ 1.3.1.1.1. EMA bearish (–∫–æ–Ω—Ñ–ª–∏–∫—Ç)?
   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ ‚ùå –ë–õ–û–ö–ò–†–û–í–ê–¢–¨ (–Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–∏–≥–Ω–∞–ª)
   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ
   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ 1.3.1.1.2. EMA bullish (—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å)?
   ‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ ‚úÖ –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–∏–≥–Ω–∞–ª
   ‚îÇ   ‚îÇ   ‚îÇ
   ‚îÇ   ‚îÇ   ‚îî‚îÄ 1.3.1.2. –†–µ–∂–∏–º = ranging/choppy?
   ‚îÇ   ‚îÇ       ‚îÇ
   ‚îÇ   ‚îÇ       ‚îú‚îÄ 1.3.1.2.1. EMA bearish (–∫–æ–Ω—Ñ–ª–∏–∫—Ç)?
   ‚îÇ   ‚îÇ       ‚îÇ   ‚îî‚îÄ ‚ö†Ô∏è –û—Å–ª–∞–±–∏—Ç—å —Å–∏–≥–Ω–∞–ª (strength *= 0.3-0.5)
   ‚îÇ   ‚îÇ       ‚îÇ
   ‚îÇ   ‚îÇ       ‚îî‚îÄ 1.3.1.2.2. EMA bullish?
   ‚îÇ   ‚îÇ           ‚îî‚îÄ ‚úÖ –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–∏–≥–Ω–∞–ª
   ‚îÇ   ‚îÇ
   ‚îÇ   ‚îî‚îÄ 1.3.2. RSI overbought (SELL)?
   ‚îÇ       ‚îî‚îÄ (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–ª—è SHORT)
   ‚îÇ
   ‚îú‚îÄ 1.4. –ü—Ä–æ–≤–µ—Ä–∫–∞ ADX
   ‚îÇ   ‚îÇ
   ‚îÇ   ‚îú‚îÄ 1.4.1. ADX —Å–∏–ª—å–Ω—ã–π + –∫–æ–Ω—Ñ–ª–∏–∫—Ç —Å —Å–∏–≥–Ω–∞–ª–æ–º?
   ‚îÇ   ‚îÇ   ‚îî‚îÄ ‚ùå –ë–õ–û–ö–ò–†–û–í–ê–¢–¨
   ‚îÇ   ‚îÇ
   ‚îÇ   ‚îî‚îÄ 1.4.2. ADX —Å–ª–∞–±—ã–π –∏–ª–∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å?
   ‚îÇ       ‚îî‚îÄ ‚úÖ –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å
   ‚îÇ
   ‚îú‚îÄ 1.5. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤
   ‚îÇ   ‚îÇ
   ‚îÇ   ‚îú‚îÄ 1.5.1. LiquidityFilter
   ‚îÇ   ‚îÇ   ‚îú‚îÄ –û–±—ä–µ–º –Ω–∞ bid/ask –¥–æ—Å—Ç–∞—Ç–æ—á–µ–Ω?
   ‚îÇ   ‚îÇ   ‚îú‚îÄ –ì–ª—É–±–∏–Ω–∞ —Å—Ç–∞–∫–∞–Ω–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞?
   ‚îÇ   ‚îÇ   ‚îî‚îÄ –°–ø—Ä–µ–¥ –ø—Ä–∏–µ–º–ª–µ–º?
   ‚îÇ   ‚îÇ
   ‚îÇ   ‚îú‚îÄ 1.5.2. OrderFlowFilter
   ‚îÇ   ‚îú‚îÄ 1.5.3. VolatilityFilter
   ‚îÇ   ‚îî‚îÄ 1.5.4. FundingRateFilter
   ‚îÇ
   ‚îî‚îÄ 1.6. –†–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –≤—ã–±–æ—Ä
       ‚îÇ
       ‚îú‚îÄ 1.6.1. –†–∞—Å—á–µ—Ç score (strength √ó confidence √ó filters)
       ‚îÇ
       ‚îú‚îÄ 1.6.2. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å min_score_threshold –¥–ª—è —Ä–µ–∂–∏–º–∞
       ‚îÇ
       ‚îî‚îÄ 1.6.3. –í—ã–±–æ—Ä –ª—É—á—à–∏—Ö —Å–∏–≥–Ω–∞–ª–æ–≤

2. –†–∞—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏ (risk_manager.py)
   ‚îÇ
   ‚îú‚îÄ 2.1. –ü–æ–ª—É—á–∏—Ç—å –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π risk_per_trade –¥–ª—è —Ä–µ–∂–∏–º–∞
   ‚îÇ   ‚îÇ
   ‚îÇ   ‚îú‚îÄ 2.1.1. –†–µ–∂–∏–º = trending? ‚Üí risk = 1.0%
   ‚îÇ   ‚îú‚îÄ 2.1.2. –†–µ–∂–∏–º = ranging? ‚Üí risk = 1.5%
   ‚îÇ   ‚îî‚îÄ 2.1.3. –†–µ–∂–∏–º = choppy? ‚Üí risk = 2.0%
   ‚îÇ
   ‚îú‚îÄ 2.2. –ë–∞–∑–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä = balance √ó risk_per_trade
   ‚îÇ
   ‚îú‚îÄ 2.3. –†–µ–∂–∏–º–Ω—ã–π –º–Ω–æ–∂–∏—Ç–µ–ª—å (trending: 1.1, ranging: 1.0, choppy: 0.8)
   ‚îÇ
   ‚îú‚îÄ 2.4. –ú–Ω–æ–∂–∏—Ç–µ–ª—å —Å–∏–ª—ã —Å–∏–≥–Ω–∞–ª–∞ (0.8-1.2)
   ‚îÇ
   ‚îú‚îÄ 2.5. ‚ùå Kelly Criterion –£–î–ê–õ–ï–ù (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
   ‚îÇ
   ‚îú‚îÄ 2.6. –ê–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ (ATR multiplier)
   ‚îÇ
   ‚îî‚îÄ 2.7. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º —Ä–∞–∑–º–µ—Ä–æ–º

3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∏—Å–∫–æ–≤ (risk_manager.py)
   ‚îÇ
   ‚îú‚îÄ 3.1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–Ω–µ–≤–Ω–æ–≥–æ –ª–∏–º–∏—Ç–∞ —É–±—ã—Ç–∫–æ–≤ (5%)
   ‚îÇ
   ‚îú‚îÄ 3.2. –ü—Ä–æ–≤–µ—Ä–∫–∞ circuit breaker (5 —É–±—ã—Ç–∫–æ–≤ –ø–æ–¥—Ä—è–¥)
   ‚îÇ
   ‚îú‚îÄ 3.3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ–∑–∏—Ü–∏–π (5)
   ‚îÇ
   ‚îî‚îÄ 3.4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∞—Ä–∂–∏ (–∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –º–∞—Ä–∂–∞)

4. –†–∞–∑–º–µ—â–µ–Ω–∏–µ –æ—Ä–¥–µ—Ä–∞ (order_executor.py)
   ‚îÇ
   ‚îú‚îÄ 4.1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏ (LiquidityFilter)
   ‚îÇ
   ‚îú‚îÄ 4.2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ (minSz)
   ‚îÇ
   ‚îú‚îÄ 4.3. –†–∞–∑–º–µ—â–µ–Ω–∏–µ limit/market –æ—Ä–¥–µ—Ä–∞
   ‚îÇ
   ‚îî‚îÄ 4.4. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–∑–∏—Ü–∏–∏ –≤ PositionRegistry
```

---

## üìù –ì–æ—Ç–æ–≤—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–¥–∞

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 1: –£–±—Ä–∞—Ç—å Kelly Criterion

**–§–∞–π–ª:** `src/strategies/scalping/futures/calculations/margin_calculator.py`

**–°—Ç—Ä–æ–∫–∏:** ~600-645

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ:**
```python
# –£–î–ê–õ–ò–¢–¨ –≤–µ—Å—å –±–ª–æ–∫ —Å Kelly Criterion
# –û—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ:
adjusted_risk_percentage = risk_percentage
max_risk_usdt = equity * adjusted_risk_percentage
```

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 2: –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ç–∏–≤–æ—Ç—Ä–µ–Ω–¥–æ–≤—ã–µ —Å–∏–≥–Ω–∞–ª—ã –≤ trending

**–§–∞–π–ª:** `src/strategies/scalping/futures/signal_generator.py`

**–ú–µ—Ç–æ–¥:** `_generate_rsi_signals()`

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–Ω—É—é –±–ª–æ–∫–∏—Ä–æ–≤–∫—É (—Å–º. –∫–æ–¥ –≤—ã—à–µ –≤ —Ä–∞–∑–¥–µ–ª–µ "–†–µ—à–µ–Ω–∏–µ")

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 3: –°–Ω–∏–∑–∏—Ç—å –±–∞–∑–æ–≤—ã–π —Ä–∏—Å–∫

**–§–∞–π–ª:** `config/config_futures.yaml`

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ:**
```yaml
scalping:
  base_risk_percentage: 0.01  # –ë—ã–ª–æ 0.03

risk:
  risk_per_trade_percent: 1.0  # –ë—ã–ª–æ 1.5
  
  by_regime:
    trending:
      risk_per_trade_percent: 1.0  # –ù–û–í–û–ï
      max_loss_per_trade_percent: 1.0  # –ë—ã–ª–æ 1.5
    ranging:
      risk_per_trade_percent: 1.5  # –ù–û–í–û–ï
      max_loss_per_trade_percent: 1.5  # –ë—ã–ª–æ 2.0
    choppy:
      risk_per_trade_percent: 2.0  # –ù–û–í–û–ï
      max_loss_per_trade_percent: 2.0  # –ë—ã–ª–æ 2.5
```

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 4: –î–æ—Ä–∞–±–æ—Ç–∞—Ç—å ATR-based TP/SL

**–§–∞–π–ª:** `src/strategies/scalping/futures/position_manager.py`

**–ú–µ—Ç–æ–¥—ã:** `_get_adaptive_tp_percent()`, `_get_adaptive_sl_percent()`

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ä–∞—Å—á–µ—Ç ATR –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `max(tp_percent, tp_atr_percent)` (—Å–º. –∫–æ–¥ –≤—ã—à–µ)

---

## ‚úÖ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–ê—É–¥–∏—Ç Qwen3-Max –ø–æ–ª–Ω–æ—Å—Ç—å—é –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω.** –í—Å–µ 4 –ø—Ä–æ–±–ª–µ–º—ã —Ä–µ–∞–ª—å–Ω—ã –∏ —Ç—Ä–µ–±—É—é—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è.

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:**
1. üî¥ **–ö—Ä–∏—Ç–∏—á–Ω–æ:** Kelly Criterion, –ø—Ä–æ—Ç–∏–≤–æ—Ç—Ä–µ–Ω–¥–æ–≤—ã–µ —Å–∏–≥–Ω–∞–ª—ã, –±–∞–∑–æ–≤—ã–π —Ä–∏—Å–∫
2. üü° **–í–∞–∂–Ω–æ:** ATR-based TP/SL
3. üü¢ **–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ:** Backtesting, –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ slippage

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–æ—Ä—è–¥–æ–∫:**
1. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã (1-2 —á–∞—Å–∞ —Ä–∞–±–æ—Ç—ã)
2. –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤ sandbox –Ω–∞ 2-4 –Ω–µ–¥–µ–ª–∏
3. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
4. –î–æ—Ä–∞–±–æ—Ç–∞—Ç—å ATR-based TP/SL
5. –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π live —Å $50-100

**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ live –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:** ‚≠ê‚≠ê‚≠ê‚≠ê (4/5) - –ú–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –ø–æ—Å–ª–µ sandbox —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

---

**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:** 1.0  
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-12-07

