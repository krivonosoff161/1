# üîç –ü–û–õ–ù–´–ô –ê–ù–ê–õ–ò–ó –¶–ï–ü–û–ß–ö–ò –†–ê–ó–ú–ï–©–ï–ù–ò–Ø –û–†–î–ï–†–û–í

**–î–∞—Ç–∞:** 2025-11-12  
**–¶–µ–ª—å:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å—é —Ü–µ–ø–æ—á–∫—É –æ—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–∏–≥–Ω–∞–ª–∞ –¥–æ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –æ—Ä–¥–µ—Ä–∞

---

## üìä –¶–ï–ü–û–ß–ö–ê –í–´–ó–û–í–û–í

### 1. –ì–ï–ù–ï–†–ê–¶–ò–Ø –°–ò–ì–ù–ê–õ–ê

**–§–∞–π–ª:** `src/strategies/scalping/futures/orchestrator.py`

**–ú–µ—Ç–æ–¥:** `_check_for_signals()` (—Å—Ç—Ä–æ–∫–∞ ~1830)

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. –ë–æ—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–∞–∂–¥—ã–π —Å–∏–º–≤–æ–ª –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Å–∏–≥–Ω–∞–ª–æ–≤
2. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–∏–≥–Ω–∞–ª—ã —á–µ—Ä–µ–∑ `signal_generator.generate_signals()`
3. –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–∏–≥–Ω–∞–ª–∞ –≤—ã–∑—ã–≤–∞–µ—Ç `_execute_signal_from_price(symbol, price, signal)`

**–ö–æ–¥:**
```python
signals = await self.signal_generator.generate_signals(symbol, market_data)
for signal in signals:
    success = await self._execute_signal_from_price(symbol, price, signal)
```

---

### 2. –í–´–ü–û–õ–ù–ï–ù–ò–ï –°–ò–ì–ù–ê–õ–ê

**–§–∞–π–ª:** `src/strategies/scalping/futures/orchestrator.py`

**–ú–µ—Ç–æ–¥:** `_execute_signal_from_price()` (—Å—Ç—Ä–æ–∫–∞ 1934)

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –Ω–µ—Ç –ª–∏ —É–∂–µ –æ—Ç–∫—Ä—ã—Ç–æ–π –ø–æ–∑–∏—Ü–∏–∏ –Ω–∞ –±–∏—Ä–∂–µ (—Å—Ç—Ä–æ–∫–∞ 1941-2001)
2. ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –Ω–µ—Ç –ª–∏ –∞–∫—Ç–∏–≤–Ω—ã—Ö –æ—Ä–¥–µ—Ä–æ–≤ (—Å—Ç—Ä–æ–∫–∞ 1971-1994)
3. ‚úÖ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç leverage –ø–µ—Ä–µ–¥ –æ—Ç–∫—Ä—ã—Ç–∏–µ–º (—Å—Ç—Ä–æ–∫–∞ 2074-2091)
4. ‚úÖ –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Ä–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏: `position_size = await self._calculate_position_size(balance, price, signal)` (—Å—Ç—Ä–æ–∫–∞ 2106)
5. ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —á–µ—Ä–µ–∑ MaxSizeLimiter: `size_usd = position_size * price` (—Å—Ç—Ä–æ–∫–∞ 2115)
6. ‚úÖ –í—ã–ø–æ–ª–Ω—è–µ—Ç –æ—Ä–¥–µ—Ä: `result = await self.order_executor.execute_signal(signal, position_size)` (—Å—Ç—Ä–æ–∫–∞ 2185)

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Å—Ç–∞:**
- **–°—Ç—Ä–æ–∫–∞ 2106:** `position_size = await self._calculate_position_size(balance, price, signal)`
  - `position_size` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ **–ú–û–ù–ï–¢–ê–•** (BTC/ETH)
- **–°—Ç—Ä–æ–∫–∞ 2115:** `size_usd = position_size * price`
  - –≠—Ç–æ **notional** (–Ω–æ–º–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å) = —Ä–∞–∑–º–µ—Ä –≤ –º–æ–Ω–µ—Ç–∞—Ö √ó —Ü–µ–Ω–∞
- **–°—Ç—Ä–æ–∫–∞ 2185:** `result = await self.order_executor.execute_signal(signal, position_size)`
  - `position_size` –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ **–ú–û–ù–ï–¢–ê–•**

---

### 3. –†–ê–°–ß–ï–¢ –†–ê–ó–ú–ï–†–ê –ü–û–ó–ò–¶–ò–ò

**–§–∞–π–ª:** `src/strategies/scalping/futures/orchestrator.py`

**–ú–µ—Ç–æ–¥:** `_calculate_position_size()` (—Å—Ç—Ä–æ–∫–∞ 2494)

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. ‚úÖ –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –±–∞–ª–∞–Ω—Å–æ–≤—ã–π –ø—Ä–æ—Ñ–∏–ª—å (—Å—Ç—Ä–æ–∫–∞ 2560-2610)
2. ‚úÖ –ü–æ–ª—É—á–∞–µ—Ç –±–∞–∑–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ (—Å—Ç—Ä–æ–∫–∞ 2615-2625)
3. ‚úÖ –ü—Ä–∏–º–µ–Ω—è–µ—Ç –º–Ω–æ–∂–∏—Ç–µ–ª—å —Ä–µ–∂–∏–º–∞ (—Å—Ç—Ä–æ–∫–∞ 2630-2645)
4. ‚úÖ –ü—Ä–∏–º–µ–Ω—è–µ—Ç –º–Ω–æ–∂–∏—Ç–µ–ª—å —Å–∏–ª—ã —Å–∏–≥–Ω–∞–ª–∞ (—Å—Ç—Ä–æ–∫–∞ 2647-2693)
5. ‚úÖ –ü—Ä–∏–º–µ–Ω—è–µ—Ç leverage: `margin_required = base_usd_size / leverage` (—Å—Ç—Ä–æ–∫–∞ 2737)
6. ‚úÖ –ü—Ä–∏–º–µ–Ω—è–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –º–∞—Ä–∂–∏ (—Å—Ç—Ä–æ–∫–∞ 2790-2822)
7. ‚úÖ –ü—Ä–∏–º–µ–Ω—è–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ä–∏—Å–∫–∞ (—Å—Ç—Ä–æ–∫–∞ 2824-2864)
8. ‚úÖ –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –º–∞—Ä–∂—É –≤ –º–æ–Ω–µ—Ç—ã: `position_size = (margin_usd * leverage) / price` (—Å—Ç—Ä–æ–∫–∞ 2885)

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Å—Ç–∞:**
- **–°—Ç—Ä–æ–∫–∞ 2737:** `margin_required_initial = base_usd_size / leverage`
  - `base_usd_size` —ç—Ç–æ **notional** (–Ω–æ–º–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å)
  - `margin_required` —ç—Ç–æ **–º–∞—Ä–∂–∞** (—Ç—Ä–µ–±—É–µ–º–∞—è –º–∞—Ä–∂–∞)
- **–°—Ç—Ä–æ–∫–∞ 2885:** `position_size = (margin_usd * leverage) / price`
  - `margin_usd` —ç—Ç–æ **–º–∞—Ä–∂–∞** (—Ñ–∏–Ω–∞–ª—å–Ω–∞—è –º–∞—Ä–∂–∞ –ø–æ—Å–ª–µ –≤—Å–µ—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π)
  - `position_size` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ **–ú–û–ù–ï–¢–ê–•** (BTC/ETH)
  - –§–æ—Ä–º—É–ª–∞: `notional = margin_usd * leverage`, –∑–∞—Ç–µ–º `position_size = notional / price`

**–ü—Ä–∏–º–µ—Ä:**
- `margin_usd = $35.47` (–º–∞—Ä–∂–∞)
- `leverage = 3x`
- `notional = $35.47 * 3 = $106.41` (–Ω–æ–º–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å)
- `price = $104,028` (—Ü–µ–Ω–∞ BTC)
- `position_size = $106.41 / $104,028 = 0.001023 BTC` (—Ä–∞–∑–º–µ—Ä –≤ –º–æ–Ω–µ—Ç–∞—Ö)

---

### 4. –†–ê–ó–ú–ï–©–ï–ù–ò–ï –û–†–î–ï–†–ê

**–§–∞–π–ª:** `src/strategies/scalping/futures/order_executor.py`

**–ú–µ—Ç–æ–¥:** `execute_signal()` (—Å—Ç—Ä–æ–∫–∞ 78)

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. ‚úÖ –í—ã–∑—ã–≤–∞–µ—Ç `_execute_order(signal, position_size)` (—Å—Ç—Ä–æ–∫–∞ 134)
2. ‚úÖ –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∏–ø –æ—Ä–¥–µ—Ä–∞ (market/limit) (—Å—Ç—Ä–æ–∫–∞ 146)
3. ‚úÖ –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Ü–µ–Ω—É –¥–ª—è –ª–∏–º–∏—Ç–Ω–æ–≥–æ –æ—Ä–¥–µ—Ä–∞ (—Å—Ç—Ä–æ–∫–∞ 151)
4. ‚úÖ –†–∞–∑–º–µ—â–∞–µ—Ç –æ—Ä–¥–µ—Ä —á–µ—Ä–µ–∑ `_place_market_order()` –∏–ª–∏ `_place_limit_order()` (—Å—Ç—Ä–æ–∫–∞ 163-167)

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Å—Ç–∞:**
- **–°—Ç—Ä–æ–∫–∞ 114:** `size=position_size`
  - `position_size` –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ **–ú–û–ù–ï–¢–ê–•**
- **–°—Ç—Ä–æ–∫–∞ 163:** `result = await self._place_market_order(symbol, side, position_size)`
  - `position_size` –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ **–ú–û–ù–ï–¢–ê–•**
- **–°—Ç—Ä–æ–∫–∞ 165:** `result = await self._place_limit_order(symbol, side, position_size, price)`
  - `position_size` –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ **–ú–û–ù–ï–¢–ê–•**

---

### 5. –†–ê–ó–ú–ï–©–ï–ù–ò–ï –†–´–ù–û–ß–ù–û–ì–û –û–†–î–ï–†–ê

**–§–∞–π–ª:** `src/strategies/scalping/futures/order_executor.py`

**–ú–µ—Ç–æ–¥:** `_place_market_order()` (—Å—Ç—Ä–æ–∫–∞ 292)

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. ‚úÖ –í—ã–∑—ã–≤–∞–µ—Ç `client.place_futures_order(symbol, side, size, order_type="market")` (—Å—Ç—Ä–æ–∫–∞ 299)
2. ‚úÖ `size` –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ **–ú–û–ù–ï–¢–ê–•**

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Å—Ç–∞:**
- **–°—Ç—Ä–æ–∫–∞ 297:** `logger.info(f"üìà –†–∞–∑–º–µ—â–µ–Ω–∏–µ —Ä—ã–Ω–æ—á–Ω–æ–≥–æ –æ—Ä–¥–µ—Ä–∞: {symbol} {side} {size:.6f}")`
  - `size` —ç—Ç–æ `position_size` –≤ **–ú–û–ù–ï–¢–ê–•**
- **–°—Ç—Ä–æ–∫–∞ 299:** `result = await self.client.place_futures_order(symbol=symbol, side=side, size=size, order_type="market")`
  - `size` –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ **–ú–û–ù–ï–¢–ê–•**

---

### 6. –†–ê–ó–ú–ï–©–ï–ù–ò–ï –õ–ò–ú–ò–¢–ù–û–ì–û –û–†–î–ï–†–ê

**–§–∞–π–ª:** `src/strategies/scalping/futures/order_executor.py`

**–ú–µ—Ç–æ–¥:** `_place_limit_order()` (—Å—Ç—Ä–æ–∫–∞ 326)

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. ‚úÖ –í—ã–∑—ã–≤–∞–µ—Ç `client.place_futures_order(symbol, side, size, price, order_type="limit")` (—Å—Ç—Ä–æ–∫–∞ 337)
2. ‚úÖ `size` –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ **–ú–û–ù–ï–¢–ê–•**

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Å—Ç–∞:**
- **–°—Ç—Ä–æ–∫–∞ 334:** `logger.info(f"üìä –†–∞–∑–º–µ—â–µ–Ω–∏–µ –ª–∏–º–∏—Ç–Ω–æ–≥–æ –æ—Ä–¥–µ—Ä–∞: {symbol} {side} {size:.6f} @ {price:.2f}")`
  - `size` —ç—Ç–æ `position_size` –≤ **–ú–û–ù–ï–¢–ê–•**
- **–°—Ç—Ä–æ–∫–∞ 337:** `result = await self.client.place_futures_order(symbol=symbol, side=side, size=size, price=price, order_type="limit")`
  - `size` –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ **–ú–û–ù–ï–¢–ê–•**

---

### 7. –ö–û–ù–í–ï–†–¢–ê–¶–ò–Ø –í –ö–û–ù–¢–†–ê–ö–¢–´

**–§–∞–π–ª:** `src/clients/futures_client.py`

**–ú–µ—Ç–æ–¥:** `place_futures_order()` (—Å—Ç—Ä–æ–∫–∞ 577)

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. ‚úÖ –ü–æ–ª—É—á–∞–µ—Ç –¥–µ—Ç–∞–ª–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞: `ctVal`, `lotSz`, `minSz` (—Å—Ç—Ä–æ–∫–∞ 600)
2. ‚úÖ –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç —Ä–∞–∑–º–µ—Ä –∏–∑ –º–æ–Ω–µ—Ç –≤ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã: `size_in_contracts_value = size / ctVal` (—Å—Ç—Ä–æ–∫–∞ 608)
3. ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: `if size_in_contracts_value < min_sz` (—Å—Ç—Ä–æ–∫–∞ 617)
4. ‚úÖ –û–∫—Ä—É–≥–ª—è–µ—Ç –¥–æ `lotSz`: `rounded_size = round_to_step(size_in_contracts_value, lot_sz)` (—Å—Ç—Ä–æ–∫–∞ 623)
5. ‚úÖ –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Ä–∞–∑–º–µ—Ä: `formatted_size = f"{rounded_size:.2f}"` (—Å—Ç—Ä–æ–∫–∞ 637)
6. ‚úÖ –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ –±–∏—Ä–∂—É: `payload = {"sz": formatted_size}` (—Å—Ç—Ä–æ–∫–∞ 652)

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Å—Ç–∞:**
- **–°—Ç—Ä–æ–∫–∞ 593:** `size: –†–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏ (–≤ –º–æ–Ω–µ—Ç–∞—Ö, –µ—Å–ª–∏ size_in_contracts=False, –∏–Ω–∞—á–µ –≤ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞—Ö)`
  - –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é `size_in_contracts=False`, –∑–Ω–∞—á–∏—Ç `size` –≤ **–ú–û–ù–ï–¢–ê–•**
- **–°—Ç—Ä–æ–∫–∞ 608:** `size_in_contracts_value = size / ctVal`
  - –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è: –º–æ–Ω–µ—Ç—ã ‚Üí –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã
  - –ù–∞–ø—Ä–∏–º–µ—Ä: `0.001023 BTC / 0.01 = 0.1023 –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤`
- **–°—Ç—Ä–æ–∫–∞ 623:** `rounded_size = round_to_step(size_in_contracts_value, lot_sz)`
  - –û–∫—Ä—É–≥–ª–µ–Ω–∏–µ –¥–æ `lotSz` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `0.1023` ‚Üí `0.10` –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤)
- **–°—Ç—Ä–æ–∫–∞ 652:** `payload = {"sz": formatted_size}`
  - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Ä–∞–∑–º–µ—Ä –≤ **–ö–û–ù–¢–†–ê–ö–¢–ê–•**

**–ü—Ä–∏–º–µ—Ä –¥–ª—è BTC-USDT:**
- `size = 0.001023 BTC` (–≤ –º–æ–Ω–µ—Ç–∞—Ö)
- `ctVal = 0.01` (1 –∫–æ–Ω—Ç—Ä–∞–∫—Ç = 0.01 BTC)
- `size_in_contracts_value = 0.001023 / 0.01 = 0.1023 –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤`
- `lotSz = 0.01` (—à–∞–≥ –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è)
- `rounded_size = 0.10 –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤` (–æ–∫—Ä—É–≥–ª–µ–Ω–æ –¥–æ lotSz)
- `formatted_size = "0.10"` (—Å—Ç—Ä–æ–∫–∞ –¥–ª—è API)
- API –ø–æ–ª—É—á–∞–µ—Ç: `sz = "0.10"` –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤

---

### 8. –û–ë–ù–û–í–õ–ï–ù–ò–ï –ü–û–°–õ–ï –û–¢–ö–†–´–¢–ò–Ø –ü–û–ó–ò–¶–ò–ò

**–§–∞–π–ª:** `src/strategies/scalping/futures/orchestrator.py`

**–ú–µ—Ç–æ–¥:** `_execute_signal_from_price()` (—Å—Ç—Ä–æ–∫–∞ 2385-2408)

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. ‚úÖ –ü–æ–ª—É—á–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—É—é —Ü–µ–Ω—É –≤—Ö–æ–¥–∞ —Å –±–∏—Ä–∂–∏: `real_entry_price = float(avg_px)` (—Å—Ç—Ä–æ–∫–∞ 2360)
2. ‚úÖ –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –Ω–æ–º–∏–Ω–∞–ª—å–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å: `notional = position_size * real_entry_price` (—Å—Ç—Ä–æ–∫–∞ 2386)
3. ‚úÖ –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –º–∞—Ä–∂—É: `margin_used = notional / leverage` (—Å—Ç—Ä–æ–∫–∞ 2388)
4. ‚úÖ –û–±–Ω–æ–≤–ª—è–µ—Ç `total_margin_used` —Å –±–∏—Ä–∂–∏ (—Å—Ç—Ä–æ–∫–∞ 2400)
5. ‚úÖ –î–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–∑–∏—Ü–∏—é –≤ MaxSizeLimiter: `size_usd_real = position_size * real_entry_price` (—Å—Ç—Ä–æ–∫–∞ 2412-2415)

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Å—Ç–∞:**
- **–°—Ç—Ä–æ–∫–∞ 2386:** `notional = position_size * real_entry_price`
  - `position_size` –≤ **–ú–û–ù–ï–¢–ê–•**
  - `notional` —ç—Ç–æ **–Ω–æ–º–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å** (USD)
- **–°—Ç—Ä–æ–∫–∞ 2388:** `margin_used = notional / leverage`
  - `margin_used` —ç—Ç–æ **–º–∞—Ä–∂–∞** (USD)
- **–°—Ç—Ä–æ–∫–∞ 2412:** `size_usd_real = position_size * real_entry_price`
  - –≠—Ç–æ **notional** (–Ω–æ–º–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å) –¥–ª—è MaxSizeLimiter

---

## ‚ö†Ô∏è –í–û–ó–ú–û–ñ–ù–´–ï –ü–†–û–ë–õ–ï–ú–´

### 1. –î–£–ë–õ–ò–†–û–í–ê–ù–ò–ï –†–ê–°–ß–ï–¢–ê –ú–ê–†–ñ–ò

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –í `_calculate_position_size()` —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è `margin_usd` (—Å—Ç—Ä–æ–∫–∞ 2872)
- –í `_execute_signal_from_price()` —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è `margin_used` –∑–∞–Ω–æ–≤–æ (—Å—Ç—Ä–æ–∫–∞ 2388)
- –≠—Ç–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—é –∏–∑-–∑–∞ –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è

**–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `margin_usd` –∏–∑ `_calculate_position_size()` –Ω–∞–ø—Ä—è–º—É—é
- ‚úÖ –ò–ª–∏ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—Ç—å —Å —Ä–µ–∞–ª—å–Ω–æ–π —Ü–µ–Ω–æ–π –≤—Ö–æ–¥–∞ (—á—Ç–æ —É–∂–µ –¥–µ–ª–∞–µ—Ç—Å—è)

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- ‚úÖ –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è —Å —Ä–µ–∞–ª—å–Ω–æ–π —Ü–µ–Ω–æ–π –≤—Ö–æ–¥–∞ (`real_entry_price`) - —ç—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ!
- ‚úÖ –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Å –±–∏—Ä–∂–∏ —á–µ—Ä–µ–∑ `_get_used_margin()` - —ç—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ!

---

### 2. –û–ö–†–£–ì–õ–ï–ù–ò–ï –†–ê–ó–ú–ï–†–ê –ü–û–ó–ò–¶–ò–ò

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `position_size` —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –≤ –º–æ–Ω–µ—Ç–∞—Ö (—Å—Ç—Ä–æ–∫–∞ 2885)
- –ü—Ä–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –≤ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ (—Å—Ç—Ä–æ–∫–∞ 623 –≤ `futures_client.py`)
- –û–∫—Ä—É–≥–ª–µ–Ω–∏–µ –º–æ–∂–µ—Ç —É–º–µ–Ω—å—à–∏—Ç—å —Ä–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏

**–ü—Ä–∏–º–µ—Ä:**
- –†–∞—Å—á–µ—Ç: `position_size = 0.001023 BTC` (–≤ –º–æ–Ω–µ—Ç–∞—Ö)
- –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è: `0.001023 / 0.01 = 0.1023 –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤`
- –û–∫—Ä—É–≥–ª–µ–Ω–∏–µ: `0.1023 ‚Üí 0.10 –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤` (–æ–∫—Ä—É–≥–ª–µ–Ω–æ –¥–æ `lotSz = 0.01`)
- –†–µ–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: `0.10 * 0.01 = 0.001 BTC` (–≤ –º–æ–Ω–µ—Ç–∞—Ö)
- **–£–º–µ–Ω—å—à–µ–Ω–∏–µ:** `0.001023 ‚Üí 0.001` (–Ω–∞ 2.3%)

**–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ –£—á–∏—Ç—ã–≤–∞—Ç—å `lotSz` –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏
- ‚úÖ –†–∞—Å—Å—á–∏—Ç—ã–≤–∞—Ç—å —Ä–∞–∑–º–µ—Ä –≤ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞—Ö, –∑–∞—Ç–µ–º –æ–∫—Ä—É–≥–ª—è—Ç—å, –∑–∞—Ç–µ–º –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ä–∞—Ç–Ω–æ –≤ –º–æ–Ω–µ—Ç—ã
- ‚úÖ –ò–ª–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—Ç—å —Ä–∞–∑–º–µ—Ä —Å —É—á–µ—Ç–æ–º –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- ‚ö†Ô∏è –û–∫—Ä—É–≥–ª–µ–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ `place_futures_order()`, –Ω–æ –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ —Ä–∞–∑–º–µ—Ä–∞
- ‚ö†Ô∏è –≠—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ —Ç–æ–º—É, —á—Ç–æ —Ä–µ–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏ –º–µ–Ω—å—à–µ —Ä–∞—Å—á–µ—Ç–Ω–æ–≥–æ

---

### 3. –ü–†–û–í–ï–†–ö–ê –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–û–ì–û –†–ê–ó–ú–ï–†–ê

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –í `_execute_signal_from_price()` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è `size_usd = position_size * price` (—Å—Ç—Ä–æ–∫–∞ 2115)
- –ù–æ `position_size` –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–∫—Ä—É–≥–ª–µ–Ω –≤ `place_futures_order()`
- –†–µ–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏ –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–Ω—å—à–µ, —á–µ–º –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–π

**–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ –£—á–∏—Ç—ã–≤–∞—Ç—å –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞
- ‚úÖ –ò–ª–∏ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –ø–æ—Å–ª–µ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –≤ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- ‚ö†Ô∏è –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –¥–æ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –≤ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã
- ‚ö†Ô∏è –†–µ–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–Ω—å—à–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω–æ–≥–æ –∏–∑-–∑–∞ –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è

---

### 4. –†–ê–°–ß–ï–¢ –†–ê–ó–ú–ï–†–ê –ü–û–ó–ò–¶–ò–ò –ò –û–ì–†–ê–ù–ò–ß–ï–ù–ò–Ø

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –í `_calculate_position_size()` –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
- –†–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏ –º–æ–∂–µ—Ç —É–º–µ–Ω—å—à–∞—Ç—å—Å—è –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–∞–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Å—Ä–∞–±–æ—Ç–∞–ª–∏, –Ω–æ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ –æ–Ω–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π (—Å—Ç—Ä–æ–∫–∞ 2763-2881)
- ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è, –∫–∞–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —É–º–µ–Ω—å—à–∏–ª–∏ —Ä–∞–∑–º–µ—Ä –∏ –Ω–∞ —Å–∫–æ–ª—å–∫–æ
- ‚úÖ –≠—Ç–æ –ø–æ–º–æ–∂–µ—Ç –ø–æ–Ω—è—Ç—å, –ø–æ—á–µ–º—É —Ä–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏ —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è

---

## üìù –í–´–í–û–î–´

### ‚úÖ –ß–¢–û –†–ê–ë–û–¢–ê–ï–¢ –ü–†–ê–í–ò–õ–¨–ù–û:

1. **–†–∞—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏:**
   - ‚úÖ –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –≤ –º–æ–Ω–µ—Ç–∞—Ö (BTC/ETH)
   - ‚úÖ –£—á–∏—Ç—ã–≤–∞–µ—Ç –±–∞–ª–∞–Ω—Å–æ–≤—ã–π –ø—Ä–æ—Ñ–∏–ª—å, —Ä–µ–∂–∏–º —Ä—ã–Ω–∫–∞, —Å–∏–ª—É —Å–∏–≥–Ω–∞–ª–∞
   - ‚úÖ –ü—Ä–∏–º–µ–Ω—è–µ—Ç –≤—Å–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ä–∏—Å–∫–∞
   - ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–∞–∑–º–µ—Ä –≤ –º–æ–Ω–µ—Ç–∞—Ö

2. **–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã:**
   - ‚úÖ –ü—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ `place_futures_order()`
   - ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `ctVal` –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏
   - ‚úÖ –û–∫—Ä—É–≥–ª—è–µ—Ç –¥–æ `lotSz`
   - ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä

3. **–†–∞–∑–º–µ—â–µ–Ω–∏–µ –æ—Ä–¥–µ—Ä–∞:**
   - ‚úÖ –ü–µ—Ä–µ–¥–∞–µ—Ç —Ä–∞–∑–º–µ—Ä –≤ –º–æ–Ω–µ—Ç–∞—Ö –≤ `order_executor`
   - ‚úÖ `order_executor` –ø–µ—Ä–µ–¥–∞–µ—Ç —Ä–∞–∑–º–µ—Ä –≤ –º–æ–Ω–µ—Ç–∞—Ö –≤ `place_futures_order`
   - ‚úÖ `place_futures_order` –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –≤ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ –±–∏—Ä–∂—É

4. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –æ—Ç–∫—Ä—ã—Ç–∏—è:**
   - ‚úÖ –ü–æ–ª—É—á–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—É—é —Ü–µ–Ω—É –≤—Ö–æ–¥–∞ —Å –±–∏—Ä–∂–∏
   - ‚úÖ –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç –º–∞—Ä–∂—É —Å —Ä–µ–∞–ª—å–Ω–æ–π —Ü–µ–Ω–æ–π
   - ‚úÖ –û–±–Ω–æ–≤–ª—è–µ—Ç `total_margin_used` —Å –±–∏—Ä–∂–∏
   - ‚úÖ –î–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–∑–∏—Ü–∏—é –≤ MaxSizeLimiter

---

### ‚ö†Ô∏è –í–û–ó–ú–û–ñ–ù–´–ï –ü–†–û–ë–õ–ï–ú–´:

1. **–û–∫—Ä—É–≥–ª–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏:**
   - ‚ö†Ô∏è –†–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏ –º–æ–∂–µ—Ç —É–º–µ–Ω—å—à–∞—Ç—å—Å—è –∏–∑-–∑–∞ –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è –≤ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã
   - ‚ö†Ô∏è –≠—Ç–æ –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏
   - ‚ö†Ô∏è –†–µ–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–Ω—å—à–µ —Ä–∞—Å—á–µ—Ç–Ω–æ–≥–æ

2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞:**
   - ‚ö†Ô∏è –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –¥–æ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –≤ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã
   - ‚ö†Ô∏è –†–µ–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–Ω—å—à–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω–æ–≥–æ –∏–∑-–∑–∞ –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è

3. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞—Å—á–µ—Ç–∞ –º–∞—Ä–∂–∏:**
   - ‚ö†Ô∏è –ú–∞—Ä–∂–∞ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –¥–≤–∞–∂–¥—ã: –≤ `_calculate_position_size()` –∏ –≤ `_execute_signal_from_price()`
   - ‚ö†Ô∏è –≠—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—é –∏–∑-–∑–∞ –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è
   - ‚úÖ –ù–æ –ø–µ—Ä–µ—Å—á–µ—Ç —Å —Ä–µ–∞–ª—å–Ω–æ–π —Ü–µ–Ω–æ–π –≤—Ö–æ–¥–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π!

---

## üéØ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### 1. –£–ß–ï–¢ –û–ö–†–£–ì–õ–ï–ù–ò–Ø –ü–†–ò –†–ê–°–ß–ï–¢–ï –†–ê–ó–ú–ï–†–ê –ü–û–ó–ò–¶–ò–ò

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –†–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –≤ –º–æ–Ω–µ—Ç–∞—Ö, –Ω–æ –ø—Ä–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –≤ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ
- –û–∫—Ä—É–≥–ª–µ–Ω–∏–µ –º–æ–∂–µ—Ç —É–º–µ–Ω—å—à–∏—Ç—å —Ä–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏ –Ω–∞ 1-5%

**–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ –†–∞—Å—Å—á–∏—Ç—ã–≤–∞—Ç—å —Ä–∞–∑–º–µ—Ä –≤ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞—Ö —Å —É—á–µ—Ç–æ–º –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è
- ‚úÖ –ò–ª–∏ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–µ–±–æ–ª—å—à–æ–π –∑–∞–ø–∞—Å (1-2%) –¥–ª—è —É—á–µ—Ç–∞ –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è
- ‚úÖ –ò–ª–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—Ç—å —Ä–∞–∑–º–µ—Ä —Å —É—á–µ—Ç–æ–º `lotSz` –∏ `minSz`

**–ü—Ä–∏–º–µ—Ä:**
```python
# –¢–µ–∫—É—â–∏–π —Ä–∞—Å—á–µ—Ç:
position_size = (margin_usd * leverage) / price  # –í –º–æ–Ω–µ—Ç–∞—Ö
# –ü–æ—Å–ª–µ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –≤ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã:
size_in_contracts = position_size / ct_val  # –ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã
rounded_size = round_to_step(size_in_contracts, lot_sz)  # –û–∫—Ä—É–≥–ª–µ–Ω–æ
real_size = rounded_size * ct_val  # –†–µ–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –≤ –º–æ–Ω–µ—Ç–∞—Ö

# –£–ª—É—á—à–µ–Ω–Ω—ã–π —Ä–∞—Å—á–µ—Ç:
# –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä –≤ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞—Ö –Ω–∞–ø—Ä—è–º—É—é
size_in_contracts = (margin_usd * leverage) / (price * ct_val)
rounded_size = round_to_step(size_in_contracts, lot_sz)
position_size = rounded_size * ct_val  # –†–∞–∑–º–µ—Ä –≤ –º–æ–Ω–µ—Ç–∞—Ö —Å —É—á–µ—Ç–æ–º –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è
```

---

### 2. –£–õ–£–ß–®–ï–ù–ò–ï –ü–†–û–í–ï–†–ö–ò –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–û–ì–û –†–ê–ó–ú–ï–†–ê

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –¥–æ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –≤ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã
- –†–µ–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–Ω—å—à–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω–æ–≥–æ –∏–∑-–∑–∞ –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è

**–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è—Ç—å —Ä–∞–∑–º–µ—Ä –ø–æ—Å–ª–µ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –≤ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã
- ‚úÖ –ò–ª–∏ —É—á–∏—Ç—ã–≤–∞—Ç—å –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ

**–ü—Ä–∏–º–µ—Ä:**
```python
# –¢–µ–∫—É—â–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞:
size_usd = position_size * price  # Notional
can_open = self.max_size_limiter.can_open_position(symbol, size_usd)

# –£–ª—É—á—à–µ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞:
# –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã –∏ –æ–∫—Ä—É–≥–ª—è–µ–º
size_in_contracts = position_size / ct_val
rounded_size = round_to_step(size_in_contracts, lot_sz)
real_position_size = rounded_size * ct_val
real_size_usd = real_position_size * price  # –†–µ–∞–ª—å–Ω—ã–π notional
can_open = self.max_size_limiter.can_open_position(symbol, real_size_usd)
```

---

### 3. –£–õ–£–ß–®–ï–ù–ò–ï –õ–û–ì–ò–†–û–í–ê–ù–ò–Ø

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
- ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è, –∫–∞–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —É–º–µ–Ω—å—à–∏–ª–∏ —Ä–∞–∑–º–µ—Ä –∏ –Ω–∞ —Å–∫–æ–ª—å–∫–æ

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
- ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏
- ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –ø–æ—Å–ª–µ –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è
- ‚úÖ –°—Ä–∞–≤–Ω–∏–≤–∞—Ç—å —Ä–∞—Å—á–µ—Ç–Ω—ã–π –∏ —Ä–µ–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä

---

## üìä –¢–ê–ë–õ–ò–¶–ê –¶–ï–ü–û–ß–ö–ò –í–´–ó–û–í–û–í

| –≠—Ç–∞–ø | –§–∞–π–ª | –ú–µ—Ç–æ–¥ | –í—Ö–æ–¥ | –í—ã—Ö–æ–¥ | –ï–¥–∏–Ω–∏—Ü—ã |
|------|------|-------|------|-------|---------|
| 1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–∞ | `orchestrator.py` | `_check_for_signals()` | - | `signal` | - |
| 2. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–∞ | `orchestrator.py` | `_execute_signal_from_price()` | `signal` | `position_size` | –ú–æ–Ω–µ—Ç—ã (BTC/ETH) |
| 3. –†–∞—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–∞ | `orchestrator.py` | `_calculate_position_size()` | `balance, price, signal` | `position_size` | –ú–æ–Ω–µ—Ç—ã (BTC/ETH) |
| 4. –†–∞–∑–º–µ—â–µ–Ω–∏–µ –æ—Ä–¥–µ—Ä–∞ | `order_executor.py` | `execute_signal()` | `signal, position_size` | `result` | - |
| 5. –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è | `futures_client.py` | `place_futures_order()` | `size` (–º–æ–Ω–µ—Ç—ã) | `sz` (–∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã) | –ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã |
| 6. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ | `orchestrator.py` | `_execute_signal_from_price()` | `real_entry_price` | `margin_used` | USD |

---

## üîç –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ú–ï–°–¢–ê –î–õ–Ø –ü–†–û–í–ï–†–ö–ò

### 1. –†–ê–°–ß–ï–¢ –†–ê–ó–ú–ï–†–ê –ü–û–ó–ò–¶–ò–ò

**–§–∞–π–ª:** `src/strategies/scalping/futures/orchestrator.py`

**–ú–µ—Ç–æ–¥:** `_calculate_position_size()` (—Å—Ç—Ä–æ–∫–∞ 2494)

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è `base_usd_size` –∏–∑ –±–∞–ª–∞–Ω—Å–æ–≤–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è?
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –º–Ω–æ–∂–∏—Ç–µ–ª–∏ —Ä–µ–∂–∏–º–∞ –∏ —Å–∏–ª—ã —Å–∏–≥–Ω–∞–ª–∞?
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –º–∞—Ä–∂–∏ –∏ —Ä–∏—Å–∫–∞?
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –º–∞—Ä–∂–∞ –≤ –º–æ–Ω–µ—Ç—ã?
- ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –ª–∏ —Ä–∞–∑–º–µ—Ä –≤ –º–æ–Ω–µ—Ç–∞—Ö?

**–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π (—Å—Ç—Ä–æ–∫–∞ 2763-2881)
- ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è, –∫–∞–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —É–º–µ–Ω—å—à–∏–ª–∏ —Ä–∞–∑–º–µ—Ä –∏ –Ω–∞ —Å–∫–æ–ª—å–∫–æ

---

### 2. –ö–û–ù–í–ï–†–¢–ê–¶–ò–Ø –í –ö–û–ù–¢–†–ê–ö–¢–´

**–§–∞–π–ª:** `src/clients/futures_client.py`

**–ú–µ—Ç–æ–¥:** `place_futures_order()` (—Å—Ç—Ä–æ–∫–∞ 577)

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ –ø–æ–ª—É—á–∞–µ—Ç—Å—è `ctVal` –∏–∑ API?
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è —Ä–∞–∑–º–µ—Ä –∏–∑ –º–æ–Ω–µ—Ç –≤ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã?
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ –æ–∫—Ä—É–≥–ª—è–µ—Ç—Å—è —Ä–∞–∑–º–µ—Ä –¥–æ `lotSz`?
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä?
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç—Å—è —Ä–∞–∑–º–µ—Ä –¥–ª—è API?

**–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- ‚úÖ –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è (—Å—Ç—Ä–æ–∫–∞ 609-610)
- ‚úÖ –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ (—Å—Ç—Ä–æ–∫–∞ 642-645)

---

### 3. –ü–†–û–í–ï–†–ö–ê –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–û–ì–û –†–ê–ó–ú–ï–†–ê

**–§–∞–π–ª:** `src/strategies/scalping/futures/orchestrator.py`

**–ú–µ—Ç–æ–¥:** `_execute_signal_from_price()` (—Å—Ç—Ä–æ–∫–∞ 2114-2120)

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è `size_usd`?
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ MaxSizeLimiter?
- ‚úÖ –£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ª–∏ –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ?

**–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- ‚ö†Ô∏è –ù–µ—Ç –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ MaxSizeLimiter
- ‚úÖ –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ (—Å—Ç—Ä–æ–∫–∞ 2119)

---

## üéØ –ò–¢–û–ì–û–í–´–ï –í–´–í–û–î–´

### ‚úÖ –¶–ï–ü–û–ß–ö–ê –†–ê–ë–û–¢–ê–ï–¢ –ü–†–ê–í–ò–õ–¨–ù–û:

1. **–†–∞—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏:**
   - ‚úÖ –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –≤ –º–æ–Ω–µ—Ç–∞—Ö —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
   - ‚úÖ –ü—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –≤—Å–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ä–∏—Å–∫–∞
   - ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —Ä–∞–∑–º–µ—Ä –≤ –º–æ–Ω–µ—Ç–∞—Ö

2. **–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã:**
   - ‚úÖ –ü—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ `place_futures_order()`
   - ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `ctVal` –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏
   - ‚úÖ –û–∫—Ä—É–≥–ª—è–µ—Ç –¥–æ `lotSz`
   - ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä

3. **–†–∞–∑–º–µ—â–µ–Ω–∏–µ –æ—Ä–¥–µ—Ä–∞:**
   - ‚úÖ –†–∞–∑–º–µ—Ä –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ —á–µ—Ä–µ–∑ –≤—Å—é —Ü–µ–ø–æ—á–∫—É
   - ‚úÖ –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –º–µ—Å—Ç–µ
   - ‚úÖ –û—Ä–¥–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ –±–∏—Ä–∂—É —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —Ä–∞–∑–º–µ—Ä–æ–º

---

### ‚ö†Ô∏è –í–û–ó–ú–û–ñ–ù–´–ï –£–õ–£–ß–®–ï–ù–ò–Ø:

1. **–£—á–µ—Ç –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è:**
   - ‚ö†Ô∏è –†–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏ –º–æ–∂–µ—Ç —É–º–µ–Ω—å—à–∞—Ç—å—Å—è –∏–∑-–∑–∞ –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è
   - ‚úÖ –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∞—Å (1-2%) –¥–ª—è —É—á–µ—Ç–∞ –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è
   - ‚úÖ –ò–ª–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—Ç—å —Ä–∞–∑–º–µ—Ä —Å —É—á–µ—Ç–æ–º –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è

2. **–£–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:**
   - ‚ö†Ô∏è –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –¥–æ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –≤ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã
   - ‚úÖ –ú–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –ø–æ—Å–ª–µ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ —Å —É—á–µ—Ç–æ–º –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è

3. **–£–ª—É—á—à–µ–Ω–∏–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:**
   - ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
   - ‚úÖ –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –¶–ï–ü–û–ß–ö–ê –†–ê–ë–û–¢–ê–ï–¢ –ü–†–ê–í–ò–õ–¨–ù–û, –Ω–æ –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å —É—á–µ—Ç –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è


