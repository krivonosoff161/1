# ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è MIN_HOLDING –¥–ª—è Profit Harvesting

**–î–∞—Ç–∞:** 29.11.2025  
**–ü—Ä–æ–±–ª–µ–º–∞:** PH –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª—Å—è MIN_HOLDING (3 –º–∏–Ω—É—Ç—ã), –¥–∞–∂–µ –ø—Ä–∏ —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–æ –±–æ–ª—å—à–∏—Ö –ø—Ä–∏–±—ã–ª—è—Ö ($0.83 –ø—Ä–∏ –ø–æ—Ä–æ–≥–µ $0.15)

## üîß –í–Ω–µ—Å–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. ‚úÖ –£–º–µ–Ω—å—à–µ–Ω MIN_HOLDING –¥–ª—è ranging —Ä–µ–∂–∏–º–∞

**–§–∞–π–ª:** `config/config_futures.yaml`

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ:**
```yaml
ranging:
  ph_enabled: true
  ph_threshold: 0.15
  ph_time_limit: 120
  min_holding_minutes: 1  # ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –£–º–µ–Ω—å—à–µ–Ω–æ —Å 3 –¥–æ 1 –º–∏–Ω—É—Ç—ã
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** PH —Å–º–æ–∂–µ—Ç —Å—Ä–∞–±–æ—Ç–∞—Ç—å —á–µ—Ä–µ–∑ 1 –º–∏–Ω—É—Ç—É –≤–º–µ—Å—Ç–æ 3 –º–∏–Ω—É—Ç –¥–ª—è ranging —Ä–µ–∂–∏–º–∞.

### 2. ‚úÖ –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ MIN_HOLDING –¥–ª—è —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–æ –±–æ–ª—å—à–∏—Ö –ø—Ä–∏–±—ã–ª–µ–π

**–§–∞–π–ª:** `src/strategies/scalping/futures/position_manager.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞: –µ—Å–ª–∏ –ø—Ä–∏–±—ã–ª—å >= 2x –ø–æ—Ä–æ–≥–∞ PH, MIN_HOLDING –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è
- –î–ª—è –ø—Ä–∏–±—ã–ª–∏ $0.30+ (2x –ø–æ—Ä–æ–≥–∞ $0.15) PH —Å—Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ

**–ö–æ–¥:**
```python
# ‚úÖ –ù–û–í–û–ï: –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º MIN_HOLDING –¥–ª—è —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–æ –±–æ–ª—å—à–∏—Ö –ø—Ä–∏–±—ã–ª–µ–π (> 2x –ø–æ—Ä–æ–≥–∞)
ignore_min_holding = False
if net_pnl_usd >= ph_threshold * 2.0:  # –ü—Ä–∏–±—ã–ª—å –≤ 2 —Ä–∞–∑–∞ –±–æ–ª—å—à–µ –ø–æ—Ä–æ–≥–∞
    ignore_min_holding = True
    logger.info(
        f"üö® –≠–ö–°–¢–†–ï–ú–ê–õ–¨–ù–ê–Ø –ü–†–ò–ë–´–õ–¨! {symbol}: ${net_pnl_usd:.4f} "
        f"(2x –ø–æ—Ä–æ–≥–∞: ${ph_threshold * 2.0:.2f}) - –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º MIN_HOLDING"
    )

# –ü—Ä–æ–≤–µ—Ä—è–µ–º MIN_HOLDING —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º
if not ignore_min_holding and time_since_open < min_holding_seconds:
    return False  # –ù–ï –∑–∞–∫—Ä—ã–≤–∞–µ–º - –∑–∞—â–∏—Ç–∞ –æ—Ç —à—É–º–∞ –∞–∫—Ç–∏–≤–Ω–∞!
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü—Ä–∏ –ø—Ä–∏–±—ã–ª–∏ $0.30+ (–∫–∞–∫ –≤ —Å–ª—É—á–∞–µ DOGE —Å $0.83) PH —Å—Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ, –Ω–µ –¥–æ–∂–∏–¥–∞—è—Å—å MIN_HOLDING.

### 3. ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ min_holding_minutes –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞

**–§–∞–π–ª:** `src/strategies/scalping/futures/position_manager.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ:**
- –ö–æ–¥ —Ç–µ–ø–µ—Ä—å —á–∏—Ç–∞–µ—Ç `min_holding_minutes` –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ–∂–∏–º–∞
- Fallback –Ω–∞ –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –≤ –∫–æ–Ω—Ñ–∏–≥–µ

**–ö–æ–¥:**
```python
# ‚úÖ –ù–û–í–û–ï: –ò—Å–ø–æ–ª—å–∑—É–µ–º min_holding –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ –µ—Å–ª–∏ –µ—Å—Ç—å, –∏–Ω–∞—á–µ fallback
if config_min_holding is not None:
    min_holding_minutes = float(config_min_holding)
    logger.debug(
        f"üìä –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è min_holding_minutes={min_holding_minutes:.1f} –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ –¥–ª—è {symbol} (regime={market_regime})"
    )
elif market_regime == "trending":
    min_holding_minutes = 5.0  # 5 –º–∏–Ω—É—Ç –≤ —Ç—Ä–µ–Ω–¥–µ
elif market_regime == "choppy":
    min_holding_minutes = 1.0  # 1 –º–∏–Ω—É—Ç–∞ –≤ —Ö–∞–æ—Å–µ
else:  # ranging
    min_holding_minutes = 1.0  # ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: 1 –º–∏–Ω—É—Ç–∞ –≤ –±–æ–∫–æ–≤–∏–∫–µ (–±—ã–ª–æ 3.0)
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** MIN_HOLDING —Ç–µ–ø–µ—Ä—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –∫–æ–Ω—Ñ–∏–≥.

### 4. ‚úÖ –ù–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ Profit Drawdown –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø–∏–∫–∞

**–§–∞–π–ª:** `src/strategies/scalping/futures/position_manager.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ:**
- –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ `peak_profit` —Å—Ä–∞–∑—É –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è `profit_drawdown`
- –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–∫—Ä—ã—Ç—å –ø–æ–∑–∏—Ü–∏—é –±—ã—Å—Ç—Ä–µ–µ –ø—Ä–∏ –æ—Ç–∫–∞—Ç–µ –æ—Ç –º–∞–∫—Å–∏–º—É–º–∞

**–ö–æ–¥:**
```python
# ‚úÖ –ù–û–í–û–ï: –ù–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ profit_drawdown –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∏–∫–∞
try:
    drawdown_should_close = await self._check_profit_drawdown(position)
    if drawdown_should_close:
        logger.warning(
            f"üìâ –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ Profit Drawdown –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∏–∫–∞ –¥–ª—è {symbol}"
        )
        await self._close_position_by_reason(position, "profit_drawdown")
        return  # –ü–æ–∑–∏—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∞, –≤—ã—Ö–æ–¥–∏–º
except Exception as e:
    logger.debug(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ profit_drawdown –¥–ª—è {symbol}: {e}")
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** Profit Drawdown –±—É–¥–µ—Ç —Å—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –±—ã—Å—Ç—Ä–µ–µ, –Ω–µ –¥–æ–∂–∏–¥–∞—è—Å—å —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ü–∏–∫–ª–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–∑–∏—Ü–∏–π.

## üìä –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- PH –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª—Å—è MIN_HOLDING (3 –º–∏–Ω—É—Ç—ã)
- –ü—Ä–∏–±—ã–ª—å $0.83 –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–ª–∞—Å—å, –∂–¥–∞–ª–∏ –æ—Ç–∫–∞—Ç –¥–æ $0.15
- –£–ø—É—â–µ–Ω–Ω–∞—è –ø—Ä–∏–±—ã–ª—å: $0.53 (63.5% –æ—Ç –ø–∏–∫–∞)

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- PH —Å—Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ 1 –º–∏–Ω—É—Ç—É –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –ø—Ä–∏–±—ã–ª–µ–π ($0.15+)
- PH —Å—Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –¥–ª—è —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã—Ö –ø—Ä–∏–±—ã–ª–µ–π ($0.30+)
- Profit Drawdown –±—É–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø–∏–∫–∞
- –û–∂–∏–¥–∞–µ–º–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ: –∑–∞—Ö–≤–∞—Ç 80-90% –ø–∏–∫–æ–≤–æ–π –ø—Ä–∏–±—ã–ª–∏ –≤–º–µ—Å—Ç–æ 36.5%

## ‚úÖ –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –º–µ—Ö–∞–Ω–∏–∑–º–∞–º–∏

–í—Å–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã –∑–∞—â–∏—Ç—ã –æ—Å—Ç–∞—é—Ç—Å—è –Ω–µ—Ç—Ä–æ–Ω—É—Ç—ã–º–∏:

1. ‚úÖ **Emergency Close** - —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ
2. ‚úÖ **TSL Loss Cut** - –∏–º–µ–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞–¥ MIN_HOLDING
3. ‚úÖ **TSL Timeout** - —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ
4. ‚úÖ **Big Profit Exit** - –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å PH
5. ‚úÖ **Stop Loss / Take Profit** - —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ

## üéØ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–π (–ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è)

1. **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç #1:** Emergency Close (–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ—Å–∞–¥–∫–∞ –º–∞—Ä–∂–∏)
2. **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç #2:** Profit Harvesting (–±—ã—Å—Ç—Ä–∞—è –ø—Ä–∏–±—ã–ª—å)
   - –û–±—ã—á–Ω–∞—è –ø—Ä–∏–±—ã–ª—å: —á–µ—Ä–µ–∑ 1 –º–∏–Ω—É—Ç—É (MIN_HOLDING)
   - –≠–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–∞—è –ø—Ä–∏–±—ã–ª—å (> 2x –ø–æ—Ä–æ–≥–∞): –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ (MIN_HOLDING –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è)
3. **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç #3:** Profit Drawdown (–æ—Ç–∫–∞—Ç –æ—Ç –ø–∏–∫–∞)
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ peak_profit
4. **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç #4:** Take Profit (–¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ TP%)
5. **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç #5:** MAX_HOLDING (–ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ —É–¥–µ—Ä–∂–∞–Ω–∏—è)
6. **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç #6:** Stop Loss / Trailing Stop Loss

## üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
- üö® –≠–ö–°–¢–†–ï–ú–ê–õ–¨–ù–ê–Ø –ü–†–ò–ë–´–õ–¨ - –∫–æ–≥–¥–∞ MIN_HOLDING –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è
- üìä –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ min_holding –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
- üìâ –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ Profit Drawdown

## ‚úÖ –í—ã–≤–æ–¥—ã

1. ‚úÖ MIN_HOLDING —É–º–µ–Ω—å—à–µ–Ω —Å 3 –¥–æ 1 –º–∏–Ω—É—Ç—ã –¥–ª—è ranging
2. ‚úÖ MIN_HOLDING –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è –¥–ª—è —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–æ –±–æ–ª—å—à–∏—Ö –ø—Ä–∏–±—ã–ª–µ–π (> 2x –ø–æ—Ä–æ–≥–∞)
3. ‚úÖ Profit Drawdown –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø–∏–∫–∞
4. ‚úÖ –í—Å–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã –∑–∞—â–∏—Ç—ã –æ—Å—Ç–∞—é—Ç—Å—è –Ω–µ—Ç—Ä–æ–Ω—É—Ç—ã–º–∏
5. ‚úÖ –û–∂–∏–¥–∞–µ—Ç—Å—è –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ –∑–∞—Ö–≤–∞—Ç–∞ –ø—Ä–∏–±—ã–ª–∏ (—Å 36.5% –¥–æ 80-90% –ø–∏–∫–∞)

