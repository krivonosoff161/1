# üî¥ –ê–ù–ê–õ–ò–ó –ü–†–û–ë–õ–ï–ú #2 –∏ #3: BUY –°–∏–≥–Ω–∞–ª—ã & –ö–æ–º–∏—Å—Å–∏–∏ (10 —è–Ω–≤–∞—Ä—è 2026)

## üìå –°—Ç–∞—Ç—É—Å –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

**Fix #1 (TSL price=0):** ‚úÖ –ì–û–¢–û–í–û - –¥–æ–±–∞–≤–ª–µ–Ω REST API fallback –≤ ExitAnalyzer

**–ü—Ä–æ–±–ª–µ–º–∞ #2 (BUY —Å–∏–≥–Ω–∞–ª—ã):** üîç –ù–ê–ô–î–ï–ù–´ –ö–û–†–ù–ò
**–ü—Ä–æ–±–ª–µ–º–∞ #3 (–ö–æ–º–∏—Å—Å–∏–∏):** üîç –ù–ê–ô–î–ï–ù–´ –ö–û–†–ù–ò

---

## üî¥ –ü—Ä–æ–±–ª–µ–º–∞ #2: BUY –°–∏–≥–Ω–∞–ª—ã (132k –≤—Ö–æ–¥—è—Ç, 8 –æ—Ä–¥–µ—Ä–æ–≤ –≤—ã—Ö–æ–¥—è—Ç)

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ –∫–æ–¥–µ (–ù–ê–ô–î–ï–ù–û!)

**–¶–µ–ø–æ—á–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ BUY —Å–∏–≥–Ω–∞–ª–æ–≤:**

```
Signal Generated (BUY) 
   ‚Üì
Check: allow_long_positions? ‚úÖ (true –≤ –∫–æ–Ω—Ñ–∏–≥–µ)
   ‚Üì
Check: MTF Filter block_neutral? üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï!
   ‚Üì
Result: BUY –æ—Ç—Å–µ–∫–∞–µ—Ç—Å—è –µ—Å–ª–∏ MTF –≤–µ—Ä–Ω—É–ª–∞ NEUTRAL
```

### –ö–æ—Ä–Ω–µ–≤–∞—è –ü—Ä–∏—á–∏–Ω–∞ #1: block_neutral=true

**–§–∞–π–ª:** `config/config_futures.yaml`

**–ü—Ä–æ–±–ª–µ–º–∞:**
```yaml
# –°—Ç—Ä–æ–∫–∏ 424-426:
multi_timeframe:
  block_neutral: true  # ‚Üê –ë–õ–û–ö–ò–†–£–ï–¢ BUY –∫–æ–≥–¥–∞ MTF = NEUTRAL
```

**–≠—Ç–æ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫:**
- BTC-USDT (line 426)
- ETH-USDT (line 507)  
- SOL-USDT (line 578)
- DOGE-USDT (–Ω–µ –ø–æ–∫–∞–∑–∞–Ω–æ –Ω–æ –≤–µ—Ä–æ—è—Ç–Ω–æ true)

**–ê XRP:**
```yaml
# Line 1110:
multi_timeframe:
  block_neutral: false  # ‚Üê –ù–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç, –ø–æ—ç—Ç–æ–º—É —Ç–∞–º –±–æ–ª—å—à–µ —Å–¥–µ–ª–æ–∫
```

### –ß—Ç–æ —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç

–ö–æ–≥–¥–∞ 5-–º–∏–Ω—É—Ç–Ω—ã–π/15-–º–∏–Ω—É—Ç–Ω—ã–π MTF –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç **NEUTRAL** (–Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π —Ç—Ä–µ–Ω–¥):
- ‚ùå BTC/ETH/SOL: BUY —Å–∏–≥–Ω–∞–ª **–∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è**
- ‚úÖ XRP: BUY —Å–∏–≥–Ω–∞–ª **–ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è**

–í —Å–µ—Å—Å–∏–∏ 17:02-17:30 BTC/ETH –±—ã–ª–∏ –≤ –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –Ω–∞ MTF ‚Üí –≤—Å–µ LONG —Å–∏–≥–Ω–∞–ª—ã –ø–æ—Ç–µ—Ä—è–Ω—ã.

### –ö–æ—Ä–Ω–µ–≤–∞—è –ü—Ä–∏—á–∏–Ω–∞ #2: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –°–∏–≥–Ω–∞–ª–æ–≤ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç 0

**–§–∞–π–ª:** `signal_generator.py:1685-1691`

```python
base_signals = await self._generate_base_signals(symbol)
if not base_signals:
    logger.debug(
        f"üìä {symbol}: –ë–∞–∑–æ–≤—ã–µ —Å–∏–≥–Ω–∞–ª—ã –Ω–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã "
        f"(—Å–º. –¥–µ—Ç–∞–ª–∏ –≤ _generate_base_signals)"
    )
    return []  # ‚Üê –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ü–£–°–¢–û–ô —Å–ø–∏—Å–æ–∫!
```

**–í –∫–æ–¥–µ —ç—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å –µ—Å–ª–∏:**
1. –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å–≤–µ—á–µ–π (<30) - line 1473
2. –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –Ω–µ –≥–æ—Ç–æ–≤—ã
3. ADX filter –Ω–µ –ø—Ä–æ—à–µ–ª (—Å–ª–∏—à–∫–æ–º –Ω–∏–∑–∫–∏–π ADX)

### ‚úÖ –†–ï–®–ï–ù–ò–ï –¥–ª—è –ü—Ä–æ–±–ª–µ–º—ã #2

–ï—Å—Ç—å –¢–†–ò –≤–∞—Ä–∏–∞–Ω—Ç–∞ (–ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É):

**–í–∞—Ä–∏–∞–Ω—Ç A: –û—Ç–∫–ª—é—á–∏—Ç—å block_neutral –¥–ª—è BTC/ETH (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)**
```yaml
# config_futures.yaml:426
multi_timeframe:
  block_neutral: false  # –†–∞–∑—Ä–µ—à–∏—Ç—å BUY –ø—Ä–∏ –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ–º —Ç—Ä–µ–Ω–¥–µ
```

**–≠—Ñ—Ñ–µ–∫—Ç:** –°–∏–≥–Ω–∞–ª—ã BUY –±—É–¥—É—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç—å –¥–∞–∂–µ –ø—Ä–∏ NEUTRAL MTF

**–í–∞—Ä–∏–∞–Ω—Ç B: –°–Ω–∏–∑–∏—Ç—å —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å ADX —Ñ–∏–ª—å—Ç—Ä–∞**
```yaml
# –î–æ–ø—É—Å—Ç–∏—Ç—å –±–æ–ª–µ–µ —Å–ª–∞–±—ã–µ —Ç—Ä–µ–Ω–¥—ã
adx_threshold: 15  # –ë—ã–ª–æ 20
```

**–í–∞—Ä–∏–∞–Ω—Ç C: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å more permissive —Ä–µ–∂–∏–º –¥–ª—è ranging**
```yaml
ranging:
  adx_threshold: 12  # –û—á–µ–Ω—å –Ω–∏–∑–∫–∏–π –ø–æ—Ä–æ–≥ –¥–ª—è –¥–∏–∞–ø–∞–∑–æ–Ω—á–∏–∫–∞
```

---

## üî¥ –ü—Ä–æ–±–ª–µ–º–∞ #3: –ö–æ–º–∏—Å—Å–∏–∏ Taker —É–±–∏–≤–∞—é—Ç –ø—Ä–∏–±—ã–ª—å

### –ü–æ—á–µ–º—É net < 0 –ø—Ä–∏ gross > 0

**–ò–∑ –¥–∞–Ω–Ω—ã—Ö —Å–µ—Å—Å–∏–∏:**
- –ú–µ–¥–∏–∞–Ω–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–¥–µ–ª–∫–∏: ~68 —Å–µ–∫—É–Ω–¥
- Gross PnL: +0.16% (—Å—Ä–µ–¥–Ω–∏–π profit)
- Commission: ~0.30% (taker fee –Ω–∞ –≤—Ö–æ–¥–µ + –≤—ã—Ö–æ–¥–µ)
- Net PnL: gross - commission = **–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ!**

**–ü—Ä–∏–º–µ—Ä:**
```
ETH SHORT: 
  gross = +0.2209% (—Ü–µ–Ω–∞ —É–ø–∞–ª–∞, profit!)
  commission = -0.2758% (two takers: entry 0.02% + exit 0.02%)
  net = -0.0550% (—É–±—ã—Ç–æ–∫!!!)
```

### –ö–æ—Ä–Ω–µ–≤–∞—è –ü—Ä–∏—á–∏–Ω–∞ #3A: –î–ª–∏–Ω–Ω—ã–µ –°–¥–µ–ª–∫–∏ = –í—ã—Å–æ–∫–∏–µ –ö–æ–º–∏—Å—Å–∏–∏

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ë–æ—Ç–Ω–µ—ç –º–æ–∂–µ—Ç –∑–∞–∫—Ä—ã–≤–∞—Ç—å –ø–æ–∑–∏—Ü–∏–∏ –æ—á–µ–Ω—å –±—ã—Å—Ç—Ä–æ (68 —Å–µ–∫ –≤ —Å—Ä–µ–¥–Ω–µ–º)
- –ü—Ä–∏ —Ç–∞–∫–æ–º –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–æ—Ñ–∏—Ç –µ–¥–≤–∞ –ª–∏ –ø–æ–∫—Ä—ã–≤–∞–µ—Ç –¥–≤–µ taker –∫–æ–º–∏—Å—Å–∏–∏
- –ù—É–∂–Ω–æ –º–∏–Ω–∏–º—É–º 0.05-0.10% –ø—Ä–æ—Ñ–∏—Ç–∞ —á—Ç–æ–±—ã –ø–æ–∫—Ä—ã—Ç—å 0.04% –∫–æ–º–∏—Å—Å–∏–∏

**–†–µ—à–µ–Ω–∏–µ:**
```python
# –í exit decision (trailing_stop_loss.py –∏–ª–∏ exit_analyzer.py):
min_profit_for_exit = 0.05  # –í—ã—Ö–æ–¥–∏–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ profit > 0.05%
# –≤–º–µ—Å—Ç–æ —Ç–µ–∫—É—â–µ–≥–æ –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –±—ã—Ç—å < 0.01%
```

### –ö–æ—Ä–Ω–µ–≤–∞—è –ü—Ä–∏—á–∏–Ω–∞ #3B: Limit Orders –æ—Ç–∫–ª–æ–Ω—è—é—Ç—Å—è ‚Üí Market Fallback

**–ù–∞–π–¥–µ–Ω–æ –≤ –ª–æ–≥–∞—Ö:**
- –û—à–∏–±–∫–∞ 51006: "—Ü–µ–Ω–∞ –ª–∏–º–∏—Ç–Ω–∏–∫–∞ –≤–Ω–µ –¥–∏–∞–ø–∞–∑–æ–Ω–∞" (7 —Ä–∞–∑)
- DataRegistry stale: –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ä–∞—Å—á–µ—Ç —Ü–µ–Ω—ã (20 —Ä–∞–∑)
- –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ ‚Üí fallback –Ω–∞ market order ‚Üí taker –∫–æ–º–∏—Å—Å–∏—è

**–¶–µ–ø–æ—á–∫–∞:**
```
limit_price = entry_price ¬± ATR * –Ω–µ–∫–∏–π_–∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç
   ‚Üì
–ï—Å–ª–∏ spread —Å–ª–∏—à–∫–æ–º —à–∏—Ä–æ–∫–∏–π –∏–ª–∏ —Ü–µ–Ω–∞ –¥–≤–∏–≥–∞–ª–∞—Å—å ‚Üí limit –≤–Ω–µ –¥–∏–∞–ø–∞–∑–æ–Ω–∞
   ‚Üì
–û—à–∏–±–∫–∞ 51006
   ‚Üì
Fallback –Ω–∞ market order
   ‚Üì
TAKER –∫–æ–º–∏—Å—Å–∏—è –≤–º–µ—Å—Ç–æ MAKER (–æ–±—ã—á–Ω–æ 0.02% vs 0% maker)
```

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–ª—É—á—à–∏—Ç—å —Ä–∞—Å—á–µ—Ç limit_price (–Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ATR, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ–∫—É—â–∏–π bid/ask)
2. –£–≤–µ–ª–∏—á–∏—Ç—å tolerance –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ limit_price
3. –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å —Ü–µ–Ω—ã –≤ —Å–ª—É—á–∞–µ stale DataRegistry

### –ö–æ—Ä–Ω–µ–≤–∞—è –ü—Ä–∏—á–∏–Ω–∞ #3C: AttributeError: get_market_data

**–í –∫–æ–¥–µ order_executor:**
```python
# ‚ùå –û–®–ò–ë–ö–ê: –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –º–µ—Ç–æ–¥
self.client.get_market_data(symbol)

# ‚úÖ –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
self.client.get_ticker(symbol)  # –∏–ª–∏ –ø–æ–¥–æ–±–Ω—ã–π –º–µ—Ç–æ–¥
```

–≠—Ç–æ –ª–æ–º–∞–µ—Ç —Ä–∞—Å—á–µ—Ç —Å–ø—Ä–µ–¥–∞ ‚Üí –±–æ–ª–µ–µ —Ö—É–¥—ã–µ –ª–∏–º–∏—Ç–Ω—ã–µ —Ü–µ–Ω—ã ‚Üí 51006 –æ—à–∏–±–∫–∏

---

## üìä –°–≤–æ–¥–∫–∞ –í—Å–µ—Ö 3 –ü—Ä–æ–±–ª–µ–º

| –ü—Ä–æ–±–ª–µ–º–∞ | –°—Ç–∞—Ç—É—Å | –†–µ—à–µ–Ω–∏–µ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
|----------|--------|---------|-----------|
| **#1: TSL price=0** | ‚úÖ FIX –ì–û–¢–û–í | –î–æ–±–∞–≤–ª–µ–Ω REST API fallback –≤ ExitAnalyzer | –í–´–°–û–ö–ò–ô |
| **#2: BUY –Ω–µ –¥–æ—Ö–æ–¥—è—Ç** | üîç –ù–ê–ô–î–ï–ù–û | block_neutral=false –≤ config | –í–´–°–û–ö–ò–ô |
| **#3: –ö–æ–º–∏—Å—Å–∏–∏ —É–±–∏–≤–∞—é—Ç** | üîç –ù–ê–ô–î–ï–ù–û | –£–ª—É—á—à–∏—Ç—å limit_price —Ä–∞—Å—á–µ—Ç | –°–†–ï–î–ù–ò–ô |
| **#3B: –û—à–∏–±–∫–∞ 51006** | üîç –ù–ê–ô–î–ï–ù–û | –ò—Å–ø—Ä–∞–≤–∏—Ç—å tolerance –≤ limit_price | –°–†–ï–î–ù–ò–ô |
| **#3C: get_market_data** | üîç –ù–ê–ô–î–ï–ù–û | –ò—Å–ø—Ä–∞–≤–∏—Ç—å –≤—ã–∑–æ–≤ –º–µ—Ç–æ–¥–∞ –≤ order_executor | –í–´–°–û–ö–ò–ô |

---

## üöÄ –ß–¢–û –î–ï–õ–ê–¢–¨ –î–ê–õ–¨–®–ï

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ (–°–ï–ô–ß–ê–°):

1. **–ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç** —Å Fix #1 (TSL price=0) ‚úÖ –ì–û–¢–û–í–û

2. **–ò–∑–º–µ–Ω–∏–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥** –¥–ª—è Fix #2 (block_neutral):
   ```yaml
   # config_futures.yaml - —Å—Ç—Ä–æ–∫–∞ 426, 507, 578, ...
   multi_timeframe:
     block_neutral: false  # –ë—ã–ª–æ: true
   ```

3. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å –æ—à–∏–±–∫—É** get_market_data –≤ order_executor:
   ```python
   # –ù–∞–π—Ç–∏: self.client.get_market_data(symbol)
   # –ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞: self.client.get_ticker(symbol)
   ```

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π - –¢–ï–°–¢–ò–†–û–í–ê–¢–¨:

1. ‚úÖ –ù–µ—Ç –±–æ–ª—å—à–µ price=0 –≤ –ª–æ–≥–∞—Ö ExitAnalyzer
2. ‚úÖ BUY —Å–∏–≥–Ω–∞–ª—ã –¥–æ—Ö–æ–¥—è—Ç –¥–æ –æ—Ä–¥–µ—Ä–æ–≤ (–≤–º–µ—Å—Ç–æ 8 –æ—Ä–¥–µ—Ä–æ–≤ - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å >20)
3. ‚úÖ N–µ—Ç –±–æ–ª—å—à–µ –æ—à–∏–±–æ–∫ 51006 –≤ order_executor
4. ‚úÖ –ö–æ–º–∏—Å—Å–∏–∏ —É–º–µ–Ω—å—à–∞—Ç—Å—è –ø–æ—Ç–æ–º—É —á—Ç–æ limit orders –±—É–¥—É—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å—Å—è

---

## üìÑ –§–∞–π–ª—ã –¥–ª—è –ò–∑–º–µ–Ω–µ–Ω–∏—è

1. ‚úÖ `exit_analyzer.py` - –°–î–ï–õ–ê–ù–û (REST API fallback)
2. ‚è≥ `trailing_stop_loss.py` - –°–î–ï–õ–ê–ù–û (No-fees –¥–ª—è fallback)
3. ‚è∏Ô∏è `config/config_futures.yaml` - –ù–£–ñ–ù–û –°–î–ï–õ–ê–¢–¨ (block_neutral=false)
4. ‚è∏Ô∏è `order_executor.py` - –ù–£–ñ–ù–û –ù–ê–ô–¢–ò –ò –ò–°–ü–†–ê–í–ò–¢–¨ (get_market_data)

---

**–ì–æ—Ç–æ–≤ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —à–∞–≥—É!**
