# üèóÔ∏è –ü–û–õ–ù–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê –¢–û–†–ì–û–í–û–ì–û –ë–û–¢–ê OKX

## üìã –û–ì–õ–ê–í–õ–ï–ù–ò–ï
1. [–û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã](#–æ–±–∑–æ—Ä-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã)
2. [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-—Ñ–∞–π–ª–æ–≤)
3. [–¢–æ—á–∫–∏ –≤—Ö–æ–¥–∞](#—Ç–æ—á–∫–∏-–≤—Ö–æ–¥–∞)
4. [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è](#–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
5. [–ö–ª–∏–µ–Ω—Ç—ã API](#–∫–ª–∏–µ–Ω—Ç—ã-api)
6. [–°—Ç—Ä–∞—Ç–µ–≥–∏–∏](#—Å—Ç—Ä–∞—Ç–µ–≥–∏–∏)
7. [–ú–æ–¥—É–ª–∏](#–º–æ–¥—É–ª–∏)
8. [–ü–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö](#–ø–æ—Ç–æ–∫–∏-–¥–∞–Ω–Ω—ã—Ö)
9. [–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ](#–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ)
10. [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)

---

## üéØ –û–ë–ó–û–† –ê–†–•–ò–¢–ï–ö–¢–£–†–´

### –î–≤—É—Ö—Ä–µ–∂–∏–º–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    TRADING BOT OKX                          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  üöÄ LAUNCHER (run.py)                                       ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Spot Mode    ‚Üí src/main_spot.py                        ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ Futures Mode ‚Üí src/main_futures.py                     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  üìÅ SHARED COMPONENTS                                       ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Config Management (src/config.py)                      ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Models (src/models.py)                                ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Indicators (src/indicators/)                           ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ Utils (src/utils/)                                     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  üìÅ SPOT STRATEGY                                           ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Orchestrator (src/strategies/scalping/spot/)           ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Signal Generator                                       ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Order Executor                                         ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Position Manager                                       ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ Performance Tracker                                   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  üìÅ FUTURES STRATEGY                                       ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Orchestrator (src/strategies/scalping/futures/)       ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Signal Generator                                       ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Order Executor                                         ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Position Manager                                       ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Margin Calculator                                      ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Liquidation Guard                                      ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ Slippage Guard                                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üìÅ –°–¢–†–£–ö–¢–£–†–ê –§–ê–ô–õ–û–í

### –ö–æ—Ä–Ω–µ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
```
simple-trading-bot-okx/
‚îú‚îÄ‚îÄ üìÅ config/                    # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
‚îÇ   ‚îú‚îÄ‚îÄ config_spot.yaml         # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Spot —Ç–æ—Ä–≥–æ–≤–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ config_futures.yaml      # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Futures —Ç–æ—Ä–≥–æ–≤–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ manual_pools.yaml        # –†—É—á–Ω—ã–µ –ø—É–ª—ã –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ features.yaml            # –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
‚îú‚îÄ‚îÄ üìÅ src/                      # –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥
‚îÇ   ‚îú‚îÄ‚îÄ main_spot.py             # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ Spot
‚îÇ   ‚îú‚îÄ‚îÄ main_futures.py          # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ Futures
‚îÇ   ‚îú‚îÄ‚îÄ config.py                # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ models.py                # –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ clients/              # API –∫–ª–∏–µ–Ω—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ strategies/           # –¢–æ—Ä–≥–æ–≤—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ indicators/           # –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ filters/              # –§–∏–ª—å—Ç—Ä—ã —Å–∏–≥–Ω–∞–ª–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ risk/                 # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∏—Å–∫–∞–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ balance/              # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–æ–º
‚îÇ   ‚îî‚îÄ‚îÄ üìÅ utils/                # –£—Ç–∏–ª–∏—Ç—ã
‚îú‚îÄ‚îÄ üìÅ tests/                    # –¢–µ—Å—Ç—ã
‚îú‚îÄ‚îÄ üìÅ logs/                     # –õ–æ–≥–∏
‚îú‚îÄ‚îÄ üìÅ data/                     # –î–∞–Ω–Ω—ã–µ
‚îú‚îÄ‚îÄ run.py                       # CLI Launcher
‚îú‚îÄ‚îÄ start.bat                    # Windows Launcher
‚îî‚îÄ‚îÄ requirements.txt             # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```

### –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ src/
```
src/
‚îú‚îÄ‚îÄ üìÅ clients/                  # API –∫–ª–∏–µ–Ω—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ spot_client.py          # OKX Spot API
‚îÇ   ‚îú‚îÄ‚îÄ futures_client.py       # OKX Futures API
‚îÇ   ‚îî‚îÄ‚îÄ __init__.py
‚îú‚îÄ‚îÄ üìÅ strategies/               # –¢–æ—Ä–≥–æ–≤—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ scalping/           # –°–∫–∞–ª—å–ø–∏–Ω–≥ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÅ spot/           # Spot —Å–∫–∞–ª—å–ø–∏–Ω–≥
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ orchestrator.py        # –ì–ª–∞–≤–Ω—ã–π –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ signal_generator.py   # –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å–∏–≥–Ω–∞–ª–æ–≤
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ order_executor.py     # –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –æ—Ä–¥–µ—Ä–æ–≤
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ position_manager.py  # –ú–µ–Ω–µ–¥–∂–µ—Ä –ø–æ–∑–∏—Ü–∏–π
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ performance_tracker.py # –¢—Ä–µ–∫–µ—Ä –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ websocket_orchestrator.py # WebSocket –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÅ futures/        # Futures —Å–∫–∞–ª—å–ø–∏–Ω–≥
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ orchestrator.py        # Futures –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ signal_generator.py    # Futures —Å–∏–≥–Ω–∞–ª—ã
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ order_executor.py      # Futures –æ—Ä–¥–µ—Ä–∞
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ position_manager.py   # Futures –ø–æ–∑–∏—Ü–∏–∏
‚îÇ   ‚îî‚îÄ‚îÄ üìÅ modules/            # –û–±—â–∏–µ –º–æ–¥—É–ª–∏
‚îÇ       ‚îú‚îÄ‚îÄ adaptive_regime_manager.py    # –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º
‚îÇ       ‚îú‚îÄ‚îÄ balance_checker.py           # –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞
‚îÇ       ‚îú‚îÄ‚îÄ correlation_filter.py        # –ö–æ—Ä—Ä–µ–ª—è—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä
‚îÇ       ‚îú‚îÄ‚îÄ liquidation_guard.py         # –ó–∞—â–∏—Ç–∞ –æ—Ç –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏
‚îÇ       ‚îú‚îÄ‚îÄ margin_calculator.py         # –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –º–∞—Ä–∂–∏
‚îÇ       ‚îú‚îÄ‚îÄ multi_timeframe.py           # –ú—É–ª—å—Ç–∏—Ç–∞–π–º—Ñ—Ä–µ–π–º
‚îÇ       ‚îú‚îÄ‚îÄ pivot_points.py              # –ü–∏–≤–æ—Ç–Ω—ã–µ —Ç–æ—á–∫–∏
‚îÇ       ‚îú‚îÄ‚îÄ slippage_guard.py            # –ó–∞—â–∏—Ç–∞ –æ—Ç –ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏—è
‚îÇ       ‚îî‚îÄ‚îÄ volume_profile_filter.py    # –§–∏–ª—å—Ç—Ä –æ–±—ä–µ–º–Ω–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è
‚îú‚îÄ‚îÄ üìÅ indicators/             # –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ base.py                # –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ advanced/           # –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pivot_calculator.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ volume_profile.py
‚îÇ   ‚îî‚îÄ‚îÄ __init__.py
‚îú‚îÄ‚îÄ üìÅ filters/               # –§–∏–ª—å—Ç—Ä—ã —Å–∏–≥–Ω–∞–ª–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ correlation_manager.py
‚îÇ   ‚îú‚îÄ‚îÄ time_session_manager.py
‚îÇ   ‚îî‚îÄ‚îÄ __init__.py
‚îú‚îÄ‚îÄ üìÅ risk/                  # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∏—Å–∫–∞–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ risk_controller.py
‚îÇ   ‚îú‚îÄ‚îÄ risk_controller_config.py
‚îÇ   ‚îî‚îÄ‚îÄ __init__.py
‚îú‚îÄ‚îÄ üìÅ balance/               # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–æ–º
‚îÇ   ‚îú‚îÄ‚îÄ adaptive_balance_manager.py
‚îÇ   ‚îî‚îÄ‚îÄ __init__.py
‚îî‚îÄ‚îÄ üìÅ utils/                 # –£—Ç–∏–ª–∏—Ç—ã
    ‚îú‚îÄ‚îÄ logging_setup.py
    ‚îú‚îÄ‚îÄ telegram_notifier.py
    ‚îî‚îÄ‚îÄ __init__.py
```

---

## üöÄ –¢–û–ß–ö–ò –í–•–û–î–ê

### 1. CLI Launcher (run.py)
```python
# –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:
python run.py --mode spot          # –ó–∞–ø—É—Å–∫ Spot –±–æ—Ç–∞
python run.py --mode futures       # –ó–∞–ø—É—Å–∫ Futures –±–æ—Ç–∞
python run.py --interactive        # –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º
python run.py --check-config       # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
```

### 2. –ü—Ä—è–º—ã–µ —Ç–æ—á–∫–∏ –≤—Ö–æ–¥–∞
```python
# Spot —Ç–æ—Ä–≥–æ–≤–ª—è
python src/main_spot.py

# Futures —Ç–æ—Ä–≥–æ–≤–ª—è  
python src/main_futures.py
```

### 3. Windows Batch Launcher
```batch
# start.bat - –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –≤—ã–±–æ—Ä —Ä–µ–∂–∏–º–∞
start.bat
```

---

## ‚öôÔ∏è –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
```yaml
# config/config_spot.yaml
api:
  okx:
    api_key: "your_api_key"
    api_secret: "your_api_secret"
    passphrase: "your_passphrase"
    sandbox: true

trading:
  symbols: ["BTC-USDT", "ETH-USDT"]
  base_currency: "USDT"

risk:
  max_position_size_percent: 5.0
  max_daily_loss_percent: 10.0
  risk_per_trade_percent: 1.0
  max_open_positions: 3
  adaptive_minimums:
    small:
      balance_threshold: 1500.0
      minimum_order_usd: 10.0
    medium:
      balance_threshold: 2300.0
      minimum_order_usd: 15.0
    large:
      balance_threshold: 999999.0
      minimum_order_usd: 20.0

scalping:
  enabled: true
  symbols: ["BTC-USDT", "ETH-USDT"]
  timeframe: "1m"
  indicators:
    sma_fast: 5
    sma_slow: 20
    ema_fast: 8
    ema_slow: 21
    rsi_period: 14
    atr_period: 14
  entry:
    min_volatility_atr: 0.0005
    rsi_overbought: 70
    rsi_oversold: 30
    volume_threshold: 1.2
  exit:
    take_profit_atr_multiplier: 2.0
    stop_loss_atr_multiplier: 1.5
    max_holding_minutes: 15

manual_pools: {}
```

### –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
```python
# src/config.py
class BotConfig(BaseModel):
    api: Dict[str, APIConfig]
    trading: TradingConfig
    risk: RiskConfig
    scalping: ScalpingConfig
    manual_pools: Optional[Dict] = Field(default_factory=dict)

    @classmethod
    def load_from_file(cls, config_path: str) -> "BotConfig":
        # –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è YAML –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
```

---

## üîå –ö–õ–ò–ï–ù–¢–´ API

### Spot Client (src/clients/spot_client.py)
```python
class OKXClient:
    """OKX Spot API –∫–ª–∏–µ–Ω—Ç"""
    
    async def get_balance(self) -> float
    async def place_order(self, symbol: str, side: str, size: float, price: float) -> dict
    async def place_oco_order(self, symbol: str, side: str, size: float, tp_price: float, sl_price: float) -> dict
    async def cancel_order(self, symbol: str, order_id: str) -> dict
    async def get_positions(self) -> list
    async def get_ticker(self, symbol: str) -> dict
```

### Futures Client (src/clients/futures_client.py)
```python
class OKXFuturesClient:
    """OKX Futures API –∫–ª–∏–µ–Ω—Ç"""
    
    async def get_balance(self) -> float
    async def get_margin_info(self, symbol: str) -> dict
    async def set_leverage(self, symbol: str, leverage: int) -> dict
    async def place_futures_order(self, symbol: str, side: str, size: float, price: float) -> dict
    async def place_oco_order(self, symbol: str, side: str, size: float, tp_price: float, sl_price: float) -> dict
    async def get_positions(self, symbol: Optional[str] = None) -> list
    async def batch_amend_orders(self, amend_list: list) -> dict
```

---

## üìà –°–¢–†–ê–¢–ï–ì–ò–ò

### Spot Strategy (src/strategies/scalping/spot/)

#### Orchestrator (orchestrator.py)
```python
class ScalpingOrchestrator:
    """–ì–ª–∞–≤–Ω—ã–π –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä Spot —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏"""
    
    def __init__(self, config: BotConfig):
        self.client = OKXClient(config.get_okx_config())
        self.signal_generator = SignalGenerator(config.scalping)
        self.order_executor = OrderExecutor(config.scalping)
        self.position_manager = PositionManager(config.scalping)
        self.performance_tracker = PerformanceTracker()
        
        # Phase 1 –º–æ–¥—É–ª–∏
        self.mtf_filter = MultiTimeframeFilter(config.scalping.multi_timeframe)
        self.correlation_filter = CorrelationFilter(config.scalping.correlation_filter)
        self.adx_filter = ADXFilter(config.scalping.adx_filter)
        self.time_filter = TimeSessionManager(config.scalping.time_filter)
        self.pivot_filter = PivotPointsFilter(config.scalping.pivot_points)
        self.volume_profile_filter = VolumeProfileFilter(config.scalping.volume_profile)
        self.balance_checker = BalanceChecker(config.scalping.balance_checker)
        self.adaptive_regime = AdaptiveRegimeManager(config.scalping.adaptive_regime)
    
    async def start(self):
        """–ó–∞–ø—É—Å–∫ —Ç–æ—Ä–≥–æ–≤–æ–≥–æ —Ü–∏–∫–ª–∞"""
        while True:
            # 1. –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä—ã–Ω–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
            market_data = await self.client.get_ticker(self.symbol)
            
            # 2. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤
            signals = await self.signal_generator.generate_signals(market_data)
            
            # 3. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤ —á–µ—Ä–µ–∑ –º–æ–¥—É–ª–∏
            filtered_signals = await self._apply_filters(signals, market_data)
            
            # 4. –ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Ä–¥–µ—Ä–æ–≤
            if filtered_signals:
                await self.order_executor.execute_orders(filtered_signals)
            
            # 5. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏—è–º–∏
            await self.position_manager.manage_positions()
            
            # 6. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
            await self.performance_tracker.update_stats()
            
            await asyncio.sleep(1)
```

#### Signal Generator (signal_generator.py)
```python
class SignalGenerator:
    """–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ç–æ—Ä–≥–æ–≤—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤ –¥–ª—è Spot"""
    
    async def generate_signals(self, market_data: MarketData) -> List[Signal]:
        """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤"""
        
        # 1. –†–∞—Å—á–µ—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤
        sma_fast = self._calculate_sma(market_data.close_prices, self.config.indicators.sma_fast)
        sma_slow = self._calculate_sma(market_data.close_prices, self.config.indicators.sma_slow)
        rsi = self._calculate_rsi(market_data.close_prices, self.config.indicators.rsi_period)
        atr = self._calculate_atr(market_data.high_prices, market_data.low_prices, market_data.close_prices)
        
        # 2. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤
        signals = []
        
        # Long —Å–∏–≥–Ω–∞–ª
        if (sma_fast > sma_slow and 
            rsi < self.config.entry.rsi_oversold and
            atr > self.config.entry.min_volatility_atr):
            signals.append(Signal(
                symbol=market_data.symbol,
                side="buy",
                entry_price=market_data.last_price,
                tp_price=market_data.last_price * (1 + self.config.exit.take_profit_atr_multiplier * atr),
                sl_price=market_data.last_price * (1 - self.config.exit.stop_loss_atr_multiplier * atr)
            ))
        
        return signals
```

#### Order Executor (order_executor.py)
```python
class OrderExecutor:
    """–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –æ—Ä–¥–µ—Ä–æ–≤ –¥–ª—è Spot"""
    
    async def execute_orders(self, signals: List[Signal]):
        """–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–æ—Ä–≥–æ–≤—ã—Ö –æ—Ä–¥–µ—Ä–æ–≤"""
        
        for signal in signals:
            try:
                # 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞
                if not await self.balance_checker.check_balance(signal):
                    continue
                
                # 2. –†–∞–∑–º–µ—â–µ–Ω–∏–µ OCO –æ—Ä–¥–µ—Ä–∞
                order_result = await self.client.place_oco_order(
                    symbol=signal.symbol,
                    side=signal.side,
                    size=signal.size,
                    tp_price=signal.tp_price,
                    sl_price=signal.sl_price
                )
                
                # 3. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ä–¥–µ—Ä–∞
                await self.position_manager.add_position(signal, order_result)
                
            except Exception as e:
                logger.error(f"–û—à–∏–±–∫–∞ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –æ—Ä–¥–µ—Ä–∞: {e}")
```

### Futures Strategy (src/strategies/scalping/futures/)

#### Orchestrator (orchestrator.py)
```python
class FuturesScalpingOrchestrator:
    """–ì–ª–∞–≤–Ω—ã–π –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä Futures —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏"""
    
    def __init__(self, config: BotConfig):
        self.client = OKXFuturesClient(config.get_okx_config())
        self.signal_generator = FuturesSignalGenerator(config.scalping)
        self.order_executor = FuturesOrderExecutor(config.scalping)
        self.position_manager = FuturesPositionManager(config.scalping)
        
        # Futures-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –º–æ–¥—É–ª–∏
        self.margin_calculator = MarginCalculator(leverage=3)
        self.liquidation_guard = LiquidationGuard()
        self.slippage_guard = SlippageGuard()
    
    async def start(self):
        """–ó–∞–ø—É—Å–∫ Futures —Ç–æ—Ä–≥–æ–≤–æ–≥–æ —Ü–∏–∫–ª–∞"""
        while True:
            # 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∞—Ä–∂–∏
            await self.liquidation_guard.check_margin_health(self.client, self.position_manager)
            
            # 2. –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä—ã–Ω–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
            market_data = await self.client.get_ticker(self.symbol)
            
            # 3. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤
            signals = await self.signal_generator.generate_signals(market_data)
            
            # 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏—è
            filtered_signals = []
            for signal in signals:
                if await self.slippage_guard.check_slippage_before_order(self.client, signal.symbol, signal.entry_price, signal.side):
                    filtered_signals.append(signal)
            
            # 5. –ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Ä–¥–µ—Ä–æ–≤
            if filtered_signals:
                await self.order_executor.execute_orders(filtered_signals)
            
            # 6. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏—è–º–∏
            await self.position_manager.manage_positions()
            
            await asyncio.sleep(0.5)  # –ë–æ–ª–µ–µ —á–∞—Å—Ç—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–ª—è Futures
```

---

## üß© –ú–û–î–£–õ–ò

### –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º (adaptive_regime_manager.py)
```python
class AdaptiveRegimeManager:
    """–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä —Ä–µ–∂–∏–º–æ–≤ —Ä—ã–Ω–∫–∞"""
    
    def __init__(self, config: RegimeConfig):
        self.volatility_thresholds = config.volatility_thresholds
        self.balance_thresholds = config.balance_thresholds
        self.adx_thresholds = config.adx_thresholds
    
    async def determine_regime(self, market_data: MarketData, balance: float) -> Regime:
        """–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —Ä–µ–∂–∏–º–∞ —Ä—ã–Ω–∫–∞"""
        
        # 1. –ê–Ω–∞–ª–∏–∑ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏
        volatility = self._calculate_volatility(market_data)
        
        # 2. –ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–Ω–¥–∞ (ADX)
        adx = self._calculate_adx(market_data)
        
        # 3. –ê–Ω–∞–ª–∏–∑ –±–∞–ª–∞–Ω—Å–∞
        balance_regime = self._determine_balance_regime(balance)
        
        # 4. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞
        if volatility < self.volatility_thresholds.low and adx < self.adx_thresholds.weak:
            return Regime.FLAT
        elif volatility > self.volatility_thresholds.high and adx > self.adx_thresholds.strong:
            return Regime.TRENDING
        else:
            return Regime.SIDEWAYS
    
    def get_adaptive_parameters(self, regime: Regime, balance_regime: str) -> AdaptiveParameters:
        """–ü–æ–ª—É—á–µ–Ω–∏–µ –∞–¥–∞–ø—Ç–∏–≤–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤"""
        
        if regime == Regime.FLAT:
            return AdaptiveParameters(
                tp_multiplier=0.8,  # –ú–µ–Ω—å—à–∏–π TP –¥–ª—è —Ñ–ª—ç—Ç–∞
                sl_multiplier=0.6,  # –ú–µ–Ω—å—à–∏–π SL –¥–ª—è —Ñ–ª—ç—Ç–∞
                position_size_multiplier=0.7
            )
        elif regime == Regime.TRENDING:
            return AdaptiveParameters(
                tp_multiplier=1.5,  # –ë–æ–ª—å—à–∏–π TP –¥–ª—è —Ç—Ä–µ–Ω–¥–∞
                sl_multiplier=1.2,  # –ë–æ–ª—å—à–∏–π SL –¥–ª—è —Ç—Ä–µ–Ω–¥–∞
                position_size_multiplier=1.0
            )
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ (balance_checker.py)
```python
class BalanceChecker:
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ –ø–µ—Ä–µ–¥ –æ—Ç–∫—Ä—ã—Ç–∏–µ–º –ø–æ–∑–∏—Ü–∏–π"""
    
    def __init__(self, config: BalanceCheckConfig):
        self.config = config
        self.adaptive_minimums = config.adaptive_minimums
    
    async def check_balance(self, signal: Signal) -> bool:
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ—Å—Ç–∏ –±–∞–ª–∞–Ω—Å–∞"""
        
        # 1. –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –±–∞–ª–∞–Ω—Å–∞
        balance = await self.client.get_balance()
        
        # 2. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–≥–æ –º–∏–Ω–∏–º—É–º–∞
        adaptive_minimum = self._get_adaptive_minimum(balance)
        
        # 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ USDT –±–∞–ª–∞–Ω—Å–∞ –¥–ª—è LONG
        if signal.side == "buy":
            required_usdt = signal.size * signal.entry_price
            if balance.free_usdt < required_usdt + adaptive_minimum:
                logger.warning(f"–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ USDT: {balance.free_usdt} < {required_usdt + adaptive_minimum}")
                return False
        
        # 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–∞ –¥–ª—è SHORT
        elif signal.side == "sell":
            if balance.free_asset < signal.size:
                logger.warning(f"–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∞–∫—Ç–∏–≤–∞: {balance.free_asset} < {signal.size}")
                return False
        
        return True
    
    def _get_adaptive_minimum(self, total_balance_usd: float) -> float:
        """–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–≥–æ –º–∏–Ω–∏–º—É–º–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –±–∞–ª–∞–Ω—Å–∞"""
        
        if self.adaptive_minimums:
            if total_balance_usd <= self.adaptive_minimums["small"]["balance_threshold"]:
                return self.adaptive_minimums["small"]["minimum_order_usd"]
            elif total_balance_usd <= self.adaptive_minimums["medium"]["balance_threshold"]:
                return self.adaptive_minimums["medium"]["minimum_order_usd"]
            else:
                return self.adaptive_minimums["large"]["minimum_order_usd"]
        
        # Fallback –∑–Ω–∞—á–µ–Ω–∏—è
        if total_balance_usd <= 1500:
            return 10.0
        elif total_balance_usd <= 2300:
            return 15.0
        else:
            return 20.0
```

### –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –º–∞—Ä–∂–∏ (margin_calculator.py)
```python
class MarginCalculator:
    """–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –º–∞—Ä–∂–∏ –¥–ª—è Futures"""
    
    def __init__(self, leverage=3, safety_buffer=0.01, maintenance_margin_rate=0.005, initial_margin_rate=0.01):
        self.leverage = leverage
        self.safety_buffer = safety_buffer
        self.maintenance_margin_rate = maintenance_margin_rate
        self.initial_margin_rate = initial_margin_rate
    
    def calculate_max_safe_size(self, balance_usd: float, entry_price: float, sl_percent: float) -> float:
        """–†–∞—Å—á–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏"""
        
        # 1. –†–∞—Å—á–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ–π –º–∞—Ä–∂–∏
        available_margin = balance_usd * (1 - self.safety_buffer)
        
        # 2. –†–∞—Å—á–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –Ω–æ–º–∏–Ω–∞–ª–∞
        max_notional = available_margin * self.leverage
        
        # 3. –†–∞—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏
        max_size = max_notional / entry_price
        
        # 4. –£—á–µ—Ç —Å—Ç–æ–ø-–ª–æ—Å—Å–∞
        sl_distance = sl_percent * entry_price
        max_safe_size = max_size * (1 - sl_percent)
        
        return max_safe_size
    
    def calculate_liquidation_price(self, entry_price: float, position_side: str, leverage: Optional[int] = None) -> float:
        """–†–∞—Å—á–µ—Ç —Ü–µ–Ω—ã –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏"""
        
        leverage = leverage or self.leverage
        
        if position_side == "long":
            # –î–ª—è –ª–æ–Ω–≥–∞: liq_price = entry_price * (1 - (1/leverage) + maintenance_margin)
            liq_price = entry_price * (1 - (1/leverage) + self.maintenance_margin_rate)
        else:
            # –î–ª—è —à–æ—Ä—Ç–∞: liq_price = entry_price * (1 + (1/leverage) - maintenance_margin)
            liq_price = entry_price * (1 + (1/leverage) - self.maintenance_margin_rate)
        
        return liq_price
```

### –ó–∞—â–∏—Ç–∞ –æ—Ç –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏ (liquidation_guard.py)
```python
class LiquidationGuard:
    """–ó–∞—â–∏—Ç–∞ –æ—Ç –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏ –ø–æ–∑–∏—Ü–∏–π"""
    
    def __init__(self, warning_threshold=1.8, danger_threshold=1.3, critical_threshold=1.1, auto_close_threshold=1.1, auto_close_percent=0.5):
        self.warning_threshold = warning_threshold
        self.danger_threshold = danger_threshold
        self.critical_threshold = critical_threshold
        self.auto_close_threshold = auto_close_threshold
        self.auto_close_percent = auto_close_percent
    
    async def check_margin_health(self, client, position_manager):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è –º–∞—Ä–∂–∏"""
        
        # 1. –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –º–∞—Ä–∂–µ
        margin_info = await client.get_margin_info()
        margin_ratio = margin_info.get("mgnRatio", 0)
        
        # 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä–æ–≥–æ–≤
        if margin_ratio <= self.critical_threshold:
            await self._handle_critical_margin(margin_ratio, position_manager)
        elif margin_ratio <= self.danger_threshold:
            await self._handle_danger_margin(margin_ratio, position_manager)
        elif margin_ratio <= self.warning_threshold:
            await self._handle_warning_margin(margin_ratio, position_manager)
    
    async def _handle_critical_margin(self, margin_ratio, position_manager):
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ —É—Ä–æ–≤–Ω—è –º–∞—Ä–∂–∏"""
        
        logger.critical(f"üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –£–†–û–í–ï–ù–¨ –ú–ê–†–ñ–ò: {margin_ratio}")
        
        # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ —á–∞—Å—Ç–∏ –ø–æ–∑–∏—Ü–∏–π
        if margin_ratio <= self.auto_close_threshold:
            logger.critical("üõë –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–û–ï –ó–ê–ö–†–´–¢–ò–ï –ü–û–ó–ò–¶–ò–ô!")
            await position_manager.close_positions_percent(self.auto_close_percent)
```

### –ó–∞—â–∏—Ç–∞ –æ—Ç –ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏—è (slippage_guard.py)
```python
class SlippageGuard:
    """–ó–∞—â–∏—Ç–∞ –æ—Ç –ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏—è"""
    
    def __init__(self, max_slippage_percent=0.1, max_spread_percent=0.05, price_fetch_timeout=30.0):
        self.max_slippage_percent = max_slippage_percent
        self.max_spread_percent = max_spread_percent
        self.price_fetch_timeout = price_fetch_timeout
    
    async def check_slippage_before_order(self, client, symbol, order_price, order_side):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏—è –ø–µ—Ä–µ–¥ –æ—Ä–¥–µ—Ä–æ–º"""
        
        # 1. –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π —Ü–µ–Ω—ã
        current_price = await self.get_current_price(client, symbol)
        
        # 2. –†–∞—Å—á–µ—Ç –ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏—è
        if order_side == "buy":
            slippage = (order_price - current_price.ask) / current_price.ask
        else:
            slippage = (current_price.bid - order_price) / current_price.bid
        
        # 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–ø—Ä–µ–¥–∞
        spread = (current_price.ask - current_price.bid) / current_price.mid
        
        # 4. –ü—Ä–∏–Ω—è—Ç–∏–µ —Ä–µ—à–µ–Ω–∏—è
        if slippage > self.max_slippage_percent:
            logger.warning(f"–ü—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏–µ —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–µ: {slippage:.4f}")
            return False
        
        if spread > self.max_spread_percent:
            logger.warning(f"–°–ø—Ä–µ–¥ —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π: {spread:.4f}")
            return False
        
        return True
```

---

## üìä –ü–û–¢–û–ö–ò –î–ê–ù–ù–´–•

### Spot Trading Flow
```
1. Market Data ‚Üí Signal Generator ‚Üí Filters ‚Üí Order Executor ‚Üí Position Manager
2. Position Manager ‚Üí Performance Tracker ‚Üí Statistics
3. Risk Controller ‚Üí Position Manager (risk limits)
4. Balance Checker ‚Üí Order Executor (balance validation)
```

### Futures Trading Flow
```
1. Market Data ‚Üí Signal Generator ‚Üí Filters ‚Üí Order Executor ‚Üí Position Manager
2. Margin Calculator ‚Üí Position Manager (position sizing)
3. Liquidation Guard ‚Üí Position Manager (margin monitoring)
4. Slippage Guard ‚Üí Order Executor (slippage protection)
5. Position Manager ‚Üí Performance Tracker ‚Üí Statistics
```

### WebSocket Data Flow
```
WebSocket Manager ‚Üí Market Data ‚Üí Signal Generator
                ‚Üí Account Updates ‚Üí Position Manager
                ‚Üí Order Updates ‚Üí Order Executor
```

---

## üìù –õ–û–ì–ò–†–û–í–ê–ù–ò–ï

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ª–æ–≥–æ–≤
```
logs/
‚îú‚îÄ‚îÄ üìÅ spot/                   # –õ–æ–≥–∏ Spot —Ç–æ—Ä–≥–æ–≤–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ spot_main.log         # –û—Å–Ω–æ–≤–Ω–æ–π –ª–æ–≥ Spot
‚îÇ   ‚îú‚îÄ‚îÄ trades_2025-10-26.csv # –ò—Å—Ç–æ—Ä–∏—è —Å–¥–µ–ª–æ–∫
‚îÇ   ‚îî‚îÄ‚îÄ performance.log       # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ üìÅ futures/               # –õ–æ–≥–∏ Futures —Ç–æ—Ä–≥–æ–≤–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ futures_main.log      # –û—Å–Ω–æ–≤–Ω–æ–π –ª–æ–≥ Futures
‚îÇ   ‚îú‚îÄ‚îÄ trades_2025-10-26.csv # –ò—Å—Ç–æ—Ä–∏—è —Å–¥–µ–ª–æ–∫
‚îÇ   ‚îî‚îÄ‚îÄ margin_monitor.log    # –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –º–∞—Ä–∂–∏
‚îî‚îÄ‚îÄ üìÅ extracted/             # –ò–∑–≤–ª–µ—á–µ–Ω–Ω—ã–µ –ª–æ–≥–∏
```

### –£—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
```python
# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logger.remove()
logger.add(
    sys.stdout,
    level="INFO",
    format="<green>{time:YYYY-MM-DD HH:mm:ss}</green> | <level>{level: <8}</level> | <cyan>{name}</cyan>:<cyan>{function}</cyan>:<cyan>{line}</cyan> - <level>{message}</level>",
)

# –§–∞–π–ª–æ–≤–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
logger.add(
    "logs/spot/spot_main.log",
    level="DEBUG",
    format="{time:YYYY-MM-DD HH:mm:ss} | {level: <8} | {name}:{function}:{line} - {message}",
    rotation="10 MB",
    retention="7 days",
    compression="zip",
)
```

---

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤
```
tests/
‚îú‚îÄ‚îÄ üìÅ unit/                  # –Æ–Ω–∏—Ç —Ç–µ—Å—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ test_balance_checker.py
‚îÇ   ‚îú‚îÄ‚îÄ test_margin_calculator.py
‚îÇ   ‚îî‚îÄ‚îÄ test_adaptive_regime.py
‚îú‚îÄ‚îÄ üìÅ integration/           # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ test_spot_integration.py
‚îÇ   ‚îú‚îÄ‚îÄ test_futures_integration.py
‚îÇ   ‚îî‚îÄ‚îÄ test_api_clients.py
‚îú‚îÄ‚îÄ üìÅ futures/              # –¢–µ—Å—Ç—ã Futures
‚îÇ   ‚îú‚îÄ‚îÄ test_futures_client.py
‚îÇ   ‚îú‚îÄ‚îÄ test_margin_calculator.py
‚îÇ   ‚îî‚îÄ‚îÄ test_integration.py
‚îú‚îÄ‚îÄ üìÅ spot/                 # –¢–µ—Å—Ç—ã Spot
‚îÇ   ‚îú‚îÄ‚îÄ test_spot_client.py
‚îÇ   ‚îî‚îÄ‚îÄ test_spot_strategy.py
‚îî‚îÄ‚îÄ üìÅ debug/               # –û—Ç–ª–∞–¥–æ—á–Ω—ã–µ —Ç–µ—Å—Ç—ã
    ‚îú‚îÄ‚îÄ quick_balance.py
    ‚îî‚îÄ‚îÄ calc_total.py
```

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã
python -m pytest tests/

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è
python -m pytest tests/unit/
python -m pytest tests/integration/
python -m pytest tests/futures/

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ—Å—Ç
python -m pytest tests/unit/test_balance_checker.py
```

---

## üîß –ö–û–ú–ê–ù–î–´ –ó–ê–ü–£–°–ö–ê

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
```bash
# –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –∑–∞–ø—É—Å–∫
python run.py

# –ü—Ä—è–º–æ–π –∑–∞–ø—É—Å–∫ Spot
python run.py --mode spot
python src/main_spot.py

# –ü—Ä—è–º–æ–π –∑–∞–ø—É—Å–∫ Futures
python run.py --mode futures
python src/main_futures.py

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
python run.py --check-config

# Windows –∑–∞–ø—É—Å–∫
start.bat
```

### –û—Ç–ª–∞–¥–æ—á–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞
python tests/debug/quick_balance.py

# –†–∞—Å—á–µ—Ç –æ–±—â–µ–π —Å—É–º–º—ã
python tests/debug/calc_total.py

# –¢–µ—Å—Ç API –∫–ª–∏–µ–Ω—Ç–æ–≤
python tests/integration/test_api_clients.py
```

---

## üìã –ö–õ–Æ–ß–ï–í–´–ï –û–°–û–ë–ï–ù–ù–û–°–¢–ò

### 1. –î–≤—É—Ö—Ä–µ–∂–∏–º–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- **Spot**: –ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–∞—è —Ç–æ—Ä–≥–æ–≤–ª—è –±–µ–∑ –ª–µ–≤–µ—Ä–∏–¥–∂–∞
- **Futures**: –ê–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è —Ç–æ—Ä–≥–æ–≤–ª—è —Å –ª–µ–≤–µ—Ä–∏–¥–∂–µ–º 3x

### 2. –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–¥—Å—Ç—Ä–æ–π–∫–∞ TP/SL –ø–æ–¥ —Ä–µ–∂–∏–º —Ä—ã–Ω–∫–∞
- –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã –ø–æ–∑–∏—Ü–∏–π –ø–æ –±–∞–ª–∞–Ω—Å—É
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –º–∏–Ω–∏–º—É–º—ã –æ—Ä–¥–µ—Ä–æ–≤

### 3. –ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- –ù–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –º–æ–¥—É–ª–∏ –¥–ª—è –∫–∞–∂–¥–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
- –õ–µ–≥–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤
- –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –º–µ–∂–¥—É —Ä–µ–∂–∏–º–∞–º–∏

### 4. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å Futures
- –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –º–∞—Ä–∂–∏
- –ó–∞—â–∏—Ç–∞ –æ—Ç –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏
- –ó–∞—â–∏—Ç–∞ –æ—Ç –ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏—è

### 5. –ì–∏–±–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- YAML –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ–∂–∏–º–∞
- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –í–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ Pydantic

---

## üö® –í–ê–ñ–ù–´–ï –ó–ê–ú–ï–ß–ê–ù–ò–Ø

### –î–ª—è Spot —Ç–æ—Ä–≥–æ–≤–ª–∏:
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –æ—Ä–¥–µ—Ä: $10
- –ö–æ–º–∏—Å—Å–∏—è: 0.08% (maker)
- –ë–µ–∑ —Ä–∏—Å–∫–∞ –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏
- –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö

### –î–ª—è Futures —Ç–æ—Ä–≥–æ–≤–ª–∏:
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –æ—Ä–¥–µ—Ä: $5 (–º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–Ω—å—à–µ)
- –ö–æ–º–∏—Å—Å–∏—è: 0.02% (maker)
- –õ–µ–≤–µ—Ä–∏–¥–∂: 3x
- –í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫ –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏
- –¢—Ä–µ–±—É–µ—Ç –æ–ø—ã—Ç

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:
- –í—Å–µ–≥–¥–∞ —Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –≤ sandbox —Ä–µ–∂–∏–º–µ
- –ù–∞—á–∏–Ω–∞–π—Ç–µ —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã—Ö —Å—É–º–º
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–æ—Ä–æ–≥–∏ –º–∞—Ä–∂–∏
- –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –ª–æ–≥–∏ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ

---

## üìû –ü–û–î–î–ï–†–ñ–ö–ê

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ `logs/`
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç—ã: `python run.py --check-config`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é API –∫–ª—é—á–µ–π
4. –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –Ω–∞–ª–∏—á–∏–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞

---

*–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞: 26.10.2025*
*–í–µ—Ä—Å–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã: 2.0*
