# ‚úÖ –†–µ–∞–ª–∏–∑–∞—Ü–∏—è "—É–º–Ω–æ–≥–æ —Ñ–∏–ª—å—Ç—Ä–∞" –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–π (29.11.2025)

## üìä –°–æ–∑–¥–∞–Ω –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–æ–¥—É–ª—å

### –§–∞–π–ª: `src/strategies/scalping/futures/coordinators/smart_exit_coordinator.py`

**–û—Ç–¥–µ–ª—å–Ω—ã–π –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä**, –∫–æ—Ç–æ—Ä—ã–π:
- ‚úÖ –ù–µ —É—Å–ª–æ–∂–Ω—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ (`position_manager.py` –æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ —á–µ—Ä–µ–∑ WebSocket (–∫–∞–∂–¥–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω—ã)
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã (RSI, MACD) –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ —Å–∏—Å—Ç–µ–º—É —á–µ—Ä–µ–∑ `WebSocketCoordinator`

---

## üîÑ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ü–æ—Ç–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏:

```
WebSocket ‚Üí handle_ticker_data()
    ‚Üì
    –ü–æ–ª—É—á–∞–µ–º —Ü–µ–Ω—É –∏ –æ–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã
    ‚Üì
    –ï–°–õ–ò –ø–æ–∑–∏—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç–∞:
        ‚Üì
        ‚úÖ SmartExitCoordinator.check_position() (–ù–û–í–û–ï)
        ‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç RSI: –ø–µ—Ä–µ–∫—É–ø–ª–µ–Ω/–ø–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω?
        ‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç MACD: —Ä–∞–∑–≤–æ—Ä–æ—Ç —Å–∏–≥–Ω–∞–ª–∞?
        ‚îî‚îÄ –ï—Å–ª–∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Ä–∞–∑–≤–æ—Ä–æ—Ç ‚Üí –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –ø–æ–∑–∏—Ü–∏—é
        ‚Üì
        PositionManager.manage_position() (—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π)
        ‚îú‚îÄ Profit Harvesting
        ‚îú‚îÄ Profit Drawdown
        ‚îî‚îÄ TP/SL
        ‚Üì
        TrailingSLCoordinator (—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π)
```

---

## üí° –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –º–æ–¥—É–ª—è

1. **–ù–µ —É—Å–ª–æ–∂–Ω—è–µ—Ç –∫–æ–¥:**
   - `position_manager.py` –æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π (4894 —Å—Ç—Ä–æ–∫–∏)
   - –û—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª `smart_exit_coordinator.py` (~200 —Å—Ç—Ä–æ–∫)

2. **–õ–µ–≥–∫–æ –æ—Ç–∫–ª—é—á–∞—Ç—å:**
   - –ú–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `enabled=False` –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ
   - –ú–æ–∂–Ω–æ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –≤ `orchestrator`

3. **–õ–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:**
   - –û—Ç–¥–µ–ª—å–Ω—ã–π –º–æ–¥—É–ª—å - –ª–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ
   - –ù–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –¥—Ä—É–≥–∏—Ö –º–æ–¥—É–ª–µ–π

4. **–†–∞–±–æ—Ç–∞–µ—Ç –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏:**
   - –ö–∞–∂–¥–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω—ã —á–µ—Ä–µ–∑ WebSocket ‚Üí –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤
   - –ù–µ—Ç –∑–∞–¥–µ—Ä–∂–∫–∏ –≤ 5 —Å–µ–∫—É–Ω–¥

---

## üìù –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### 1. –°–æ–∑–¥–∞–Ω `SmartExitCoordinator` –≤ `orchestrator.py`:

```python
# ‚úÖ –ù–û–í–û–ï: SmartExitCoordinator –¥–ª—è —É–º–Ω–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–π —á–µ—Ä–µ–∑ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã
self.smart_exit_coordinator = SmartExitCoordinator(
    position_registry=self.position_registry,
    data_registry=self.data_registry,
    close_position_callback=self._close_position,
    enabled=True,  # –ú–æ–∂–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å —á–µ—Ä–µ–∑ –∫–æ–Ω—Ñ–∏–≥
)
```

### 2. –ü–µ—Ä–µ–¥–∞–Ω –≤ `WebSocketCoordinator`:

```python
self.websocket_coordinator = WebSocketCoordinator(
    # ... –¥—Ä—É–≥–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ...
    smart_exit_coordinator=self.smart_exit_coordinator,  # ‚úÖ –ù–û–í–û–ï
)
```

### 3. –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ `WebSocketCoordinator.handle_ticker_data()`:

```python
# ‚úÖ –ù–û–í–û–ï: –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º —É–º–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤
if self.smart_exit_coordinator:
    decision = await self.smart_exit_coordinator.check_position(
        symbol, self.active_positions_ref[symbol]
    )
    if decision and decision.get("action") == "close":
        # –ü–æ–∑–∏—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∞ –ø–æ —É–º–Ω–æ–º—É —Ñ–∏–ª—å—Ç—Ä—É, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
        continue
```

---

## üéØ –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

### –ü—Ä–æ–≤–µ—Ä–∫–∞ RSI:
- **LONG –ø–æ–∑–∏—Ü–∏—è:**
  - RSI > 70 (–ø–µ—Ä–µ–∫—É–ø–ª–µ–Ω) ‚Üí **–ó–∞–∫—Ä—ã—Ç—å**
  - RSI < 50 (–Ω–µ –ø–µ—Ä–µ–∫—É–ø–ª–µ–Ω) ‚Üí **–ë–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∑–∞–∫—Ä—ã—Ç–∏–µ** (—Ç—Ä–µ–Ω–¥ –º–æ–∂–µ—Ç –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å—Å—è)

- **SHORT –ø–æ–∑–∏—Ü–∏—è:**
  - RSI < 30 (–ø–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω) ‚Üí **–ó–∞–∫—Ä—ã—Ç—å**
  - RSI > 50 (–Ω–µ –ø–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω) ‚Üí **–ë–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∑–∞–∫—Ä—ã—Ç–∏–µ** (—Ç—Ä–µ–Ω–¥ –º–æ–∂–µ—Ç –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å—Å—è)

### –ü—Ä–æ–≤–µ—Ä–∫–∞ MACD:
- **LONG –ø–æ–∑–∏—Ü–∏—è:**
  - MACD < Signal (–º–µ–¥–≤–µ–∂–∏–π) ‚Üí **–ó–∞–∫—Ä—ã—Ç—å**
  - MACD > Signal (–±—ã—á–∏–π) ‚Üí **–ë–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∑–∞–∫—Ä—ã—Ç–∏–µ**

- **SHORT –ø–æ–∑–∏—Ü–∏—è:**
  - MACD > Signal (–±—ã—á–∏–π) ‚Üí **–ó–∞–∫—Ä—ã—Ç—å**
  - MACD < Signal (–º–µ–¥–≤–µ–∂–∏–π) ‚Üí **–ë–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∑–∞–∫—Ä—ã—Ç–∏–µ**

---

## ‚úÖ –ò—Ç–æ–≥

**–°–æ–∑–¥–∞–Ω –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–æ–¥—É–ª—å `SmartExitCoordinator`, –∫–æ—Ç–æ—Ä—ã–π:**
- ‚úÖ –ù–µ —É—Å–ª–æ–∂–Ω—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ —á–µ—Ä–µ–∑ WebSocket
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π
- ‚úÖ –õ–µ–≥–∫–æ –æ—Ç–∫–ª—é—á–∞—Ç—å –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

**–ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üöÄ

