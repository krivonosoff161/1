# ü§ñ –ü–û–õ–ù–û–ï –û–ü–ò–°–ê–ù–ò–ï –¢–û–†–ì–û–í–û–ì–û –ë–û–¢–ê OKX FUTURES

> **‚ö†Ô∏è –í–ê–ñ–ù–û: –ù–ï –£–î–ê–õ–Ø–¢–¨ –≠–¢–û–¢ –§–ê–ô–õ!**  
> –≠—Ç–æ—Ç —Ñ–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–Ω–æ–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–æ—Ä–≥–æ–≤–æ–≥–æ –±–æ—Ç–∞ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –≤ –Ω–µ–π—Ä–æ—Å–µ—Ç—å Kimi.

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 30 –Ω–æ—è–±—Ä—è 2025  
**–î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 23 –¥–µ–∫–∞–±—Ä—è 2025  
**–¢–∏–ø —Ç–æ—Ä–≥–æ–≤–ª–∏:** Futures (—Ñ—å—é—á–µ—Ä—Å—ã) –Ω–∞ –±–∏—Ä–∂–µ OKX  
**–°—Ç–∞—Ç—É—Å:** –ê–∫—Ç–∏–≤–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç  
**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:** 2.1 (–æ–±–Ω–æ–≤–ª–µ–Ω–æ —Å –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏)

---

## üìã –°–û–î–ï–†–ñ–ê–ù–ò–ï

1. [–û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#–æ–±—â–∞—è-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
2. [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ –∏ —Ñ–∞–π–ª—ã](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞-–∏-—Ñ–∞–π–ª—ã)
3. [–ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –±–æ—Ç–∞](#–∂–∏–∑–Ω–µ–Ω–Ω—ã–π-—Ü–∏–∫–ª-–±–æ—Ç–∞)
4. [–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤](#–≥–µ–Ω–µ—Ä–∞—Ü–∏—è-—Å–∏–≥–Ω–∞–ª–æ–≤)
5. [–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ä–¥–µ—Ä–æ–≤](#—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ-–æ—Ä–¥–µ—Ä–æ–≤)
6. [–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏—è–º–∏](#—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ-–ø–æ–∑–∏—Ü–∏—è–º–∏)
7. [–ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–π](#–∑–∞–∫—Ä—ã—Ç–∏–µ-–ø–æ–∑–∏—Ü–∏–π)
8. [–°–∏—Å—Ç–µ–º—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏](#—Å–∏—Å—Ç–µ–º—ã-—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏)
9. [–°–∏—Å—Ç–µ–º—ã –∑–∞—â–∏—Ç—ã](#—Å–∏—Å—Ç–µ–º—ã-–∑–∞—â–∏—Ç—ã)
10. [–†–∞—Å—á–µ—Ç—ã –∏ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞](#—Ä–∞—Å—á–µ—Ç—ã-–∏-–º–∞—Ç–µ–º–∞—Ç–∏–∫–∞)
11. [–†–∞–±–æ—Ç–∞ —Å –±–∏—Ä–∂–µ–π OKX](#—Ä–∞–±–æ—Ç–∞-—Å-–±–∏—Ä–∂–µ–π-okx)
12. [–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã](#–∞–¥–∞–ø—Ç–∏–≤–Ω—ã–µ-—Å–∏—Å—Ç–µ–º—ã)
13. [–ê–¥–∞–ø—Ç–∏–≤–Ω–æ–µ –ø–ª–µ—á–æ (Adaptive Leverage)](#–∞–¥–∞–ø—Ç–∏–≤–Ω–æ–µ-–ø–ª–µ—á–æ-adaptive-leverage)
14. [–õ–µ—Å—Ç–Ω–∏—á–Ω—ã–π –≤—Ö–æ–¥ (Ladder Entry / Position Scaling)](#–ª–µ—Å—Ç–Ω–∏—á–Ω—ã–π-–≤—Ö–æ–¥-ladder-entry--position-scaling)
15. [Exit Analyzer - –£–º–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–π](#exit-analyzer---—É–º–Ω–æ–µ-–∑–∞–∫—Ä—ã—Ç–∏–µ-–ø–æ–∑–∏—Ü–∏–π)
16. [Position Registry - –†–µ–µ—Å—Ç—Ä –ø–æ–∑–∏—Ü–∏–π](#position-registry---—Ä–µ–µ—Å—Ç—Ä-–ø–æ–∑–∏—Ü–∏–π)
17. [Position Sync - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –±–∏—Ä–∂–µ–π](#position-sync---—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è-—Å-–±–∏—Ä–∂–µ–π)
18. [–ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤ V2](#–∞–¥–∞–ø—Ç–∏–≤–Ω–∞—è-—Å–∏—Å—Ç–µ–º–∞-—Ñ–∏–ª—å—Ç—Ä–æ–≤-v2)
19. [Trading Control Center](#trading-control-center)

---

## üèóÔ∏è –û–ë–©–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

–ë–æ—Ç –ø–æ—Å—Ç—Ä–æ–µ–Ω –ø–æ –º–æ–¥—É–ª—å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ —Å —á–µ—Ç–∫–∏–º —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              FuturesScalpingOrchestrator                 ‚îÇ
‚îÇ              (–ì–ª–∞–≤–Ω—ã–π –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä)                       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ                 ‚îÇ                 ‚îÇ
        ‚ñº                 ‚ñº                 ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Signal       ‚îÇ  ‚îÇ Order        ‚îÇ  ‚îÇ Position     ‚îÇ
‚îÇ Generator    ‚îÇ  ‚îÇ Executor     ‚îÇ  ‚îÇ Manager      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ                 ‚îÇ                 ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                        ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ               ‚îÇ               ‚îÇ
        ‚ñº               ‚ñº               ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Filters      ‚îÇ ‚îÇ Risk         ‚îÇ ‚îÇ Indicators   ‚îÇ
‚îÇ (10+ —Ç–∏–ø–æ–≤)  ‚îÇ ‚îÇ Manager      ‚îÇ ‚îÇ (RSI, MACD...)‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

- **–Ø–∑—ã–∫:** Python 3.8+
- **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å:** asyncio
- **API –±–∏—Ä–∂–∏:** OKX REST API + WebSocket
- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:** YAML (Pydantic)
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:** loguru
- **–¢–∏–ø —Ç–æ—Ä–≥–æ–≤–ª–∏:** Futures (USDT-Margined Perpetual Swaps)
- **–†–µ–∂–∏–º –º–∞—Ä–∂–∏:** Isolated Margin
- **–ü–ª–µ—á–æ:** –ê–¥–∞–ø—Ç–∏–≤–Ω–æ–µ 3-30x (–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–∞—á–µ—Å—Ç–≤–∞ —Å–∏–≥–Ω–∞–ª–∞)

---

## üìÅ –°–¢–†–£–ö–¢–£–†–ê –ü–†–û–ï–ö–¢–ê –ò –§–ê–ô–õ–´

### –ö–æ—Ä–Ω–µ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

```
simple trading bot okx/
‚îú‚îÄ‚îÄ run.py                          # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (–≤—ã–±–æ—Ä Spot/Futures)
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ main_futures.py             # –ó–∞–ø—É—Å–∫ Futures –±–æ—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ clients/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ futures_client.py       # –ö–ª–∏–µ–Ω—Ç OKX Futures API
‚îÇ   ‚îú‚îÄ‚îÄ strategies/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ scalping/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ futures/
‚îÇ   ‚îÇ           ‚îú‚îÄ‚îÄ orchestrator.py        # –ì–ª–∞–≤–Ω—ã–π –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä
‚îÇ   ‚îÇ           ‚îú‚îÄ‚îÄ signal_generator.py     # –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å–∏–≥–Ω–∞–ª–æ–≤
‚îÇ   ‚îÇ           ‚îú‚îÄ‚îÄ order_executor.py      # –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –æ—Ä–¥–µ—Ä–æ–≤
‚îÇ   ‚îÇ           ‚îú‚îÄ‚îÄ position_manager.py     # –ú–µ–Ω–µ–¥–∂–µ—Ä –ø–æ–∑–∏—Ü–∏–π
‚îÇ   ‚îÇ           ‚îú‚îÄ‚îÄ risk_manager.py         # –ú–µ–Ω–µ–¥–∂–µ—Ä —Ä–∏—Å–∫–æ–≤
‚îÇ   ‚îÇ           ‚îú‚îÄ‚îÄ positions/
‚îÇ   ‚îÇ           ‚îÇ   ‚îú‚îÄ‚îÄ exit_analyzer.py    # –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–π
‚îÇ   ‚îÇ           ‚îÇ   ‚îî‚îÄ‚îÄ position_scaling_manager.py  # –õ–µ—Å—Ç–Ω–∏—á–Ω—ã–π –≤—Ö–æ–¥
‚îÇ   ‚îÇ           ‚îú‚îÄ‚îÄ risk/
‚îÇ   ‚îÇ           ‚îÇ   ‚îî‚îÄ‚îÄ adaptive_leverage.py  # –ê–¥–∞–ø—Ç–∏–≤–Ω–æ–µ –ø–ª–µ—á–æ
‚îÇ   ‚îÇ           ‚îú‚îÄ‚îÄ adaptivity/
‚îÇ   ‚îÇ           ‚îÇ   ‚îú‚îÄ‚îÄ filter_parameters.py  # ‚úÖ –ù–û–í–û–ï: –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤ V2
‚îÇ   ‚îÇ           ‚îÇ   ‚îú‚îÄ‚îÄ regime_manager.py     # –ú–µ–Ω–µ–¥–∂–µ—Ä —Ä–µ–∂–∏–º–æ–≤ —Ä—ã–Ω–∫–∞
‚îÇ   ‚îÇ           ‚îÇ   ‚îî‚îÄ‚îÄ balance_manager.py    # –ú–µ–Ω–µ–¥–∂–µ—Ä –±–∞–ª–∞–Ω—Å–∞
‚îÇ   ‚îÇ           ‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îÇ           ‚îÇ   ‚îú‚îÄ‚îÄ position_registry.py  # –†–µ–µ—Å—Ç—Ä –ø–æ–∑–∏—Ü–∏–π
‚îÇ   ‚îÇ           ‚îÇ   ‚îú‚îÄ‚îÄ position_sync.py      # –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –±–∏—Ä–∂–µ–π
‚îÇ   ‚îÇ           ‚îÇ   ‚îú‚îÄ‚îÄ data_registry.py      # –†–µ–µ—Å—Ç—Ä –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îÇ           ‚îÇ   ‚îî‚îÄ‚îÄ trading_control_center.py  # ‚úÖ –ù–û–í–û–ï: –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä
‚îÇ   ‚îÇ           ‚îú‚îÄ‚îÄ filters/               # –§–∏–ª—å—Ç—Ä—ã —Å–∏–≥–Ω–∞–ª–æ–≤
‚îÇ   ‚îÇ           ‚îú‚îÄ‚îÄ indicators/            # –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã
‚îÇ   ‚îÇ           ‚îú‚îÄ‚îÄ coordinators/          # –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä—ã –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
‚îÇ   ‚îÇ           ‚îî‚îÄ‚îÄ calculations/         # –†–∞—Å—á–µ—Ç–Ω—ã–µ –º–æ–¥—É–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ strategies/modules/         # –û–±—â–∏–µ –º–æ–¥—É–ª–∏
‚îÇ   ‚îî‚îÄ‚îÄ risk/                       # –°–∏—Å—Ç–µ–º—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∏—Å–∫–∞–º–∏
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ config_futures.yaml        # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Futures
‚îî‚îÄ‚îÄ logs/
    ‚îî‚îÄ‚îÄ futures/                    # –õ–æ–≥–∏ Futures —Ç–æ—Ä–≥–æ–≤–ª–∏
```

### –ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã –∏ –∏—Ö —Ñ—É–Ω–∫—Ü–∏–∏

#### 1. `run.py` - –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
- –í—ã–±–æ—Ä —Ä–µ–∂–∏–º–∞ —Ç–æ—Ä–≥–æ–≤–ª–∏ (Spot/Futures)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –ó–∞–ø—É—Å–∫ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ –±–æ—Ç–∞

#### 2. `src/main_futures.py` - –ó–∞–ø—É—Å–∫ Futures –±–æ—Ç–∞
- –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ `config_futures.yaml`
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è `FuturesScalpingOrchestrator`
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ graceful shutdown

#### 3. `src/strategies/scalping/futures/orchestrator.py` - –ì–ª–∞–≤–Ω—ã–π –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:**
- –ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π
- –ì–ª–∞–≤–Ω—ã–π —Ç–æ—Ä–≥–æ–≤—ã–π —Ü–∏–∫–ª
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º –ø–æ–∑–∏—Ü–∏–π
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

**–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã:**
- `start()` - –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
- `run()` - –ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª —Ç–æ—Ä–≥–æ–≤–ª–∏
- `_process_symbol()` - –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞–∂–¥–æ–≥–æ —Å–∏–º–≤–æ–ª–∞
- `_update_trailing_stop_loss()` - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç—Ä–µ–π–ª–∏–Ω–≥-—Å—Ç–æ–ø–∞
- `_close_position()` - –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–∏

#### 4. `src/strategies/scalping/futures/signal_generator.py` - –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å–∏–≥–Ω–∞–ª–æ–≤
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:**
- –†–∞—Å—á–µ—Ç —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–æ—Ä–≥–æ–≤—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤ (BUY/SELL)
- –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤
- –ê–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ —Ä–µ–∂–∏–º —Ä—ã–Ω–∫–∞ (ARM)

**–ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã:**
- RSI (Relative Strength Index)
- MACD (Moving Average Convergence Divergence)
- Bollinger Bands
- EMA (Exponential Moving Average)
- SMA (Simple Moving Average)
- ATR (Average True Range)

#### 5. `src/strategies/scalping/futures/order_executor.py` - –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –æ—Ä–¥–µ—Ä–æ–≤
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:**
- –†–∞–∑–º–µ—â–µ–Ω–∏–µ –æ—Ä–¥–µ—Ä–æ–≤ –Ω–∞ –±–∏—Ä–∂–µ
- –í—ã–±–æ—Ä —Ç–∏–ø–∞ –æ—Ä–¥–µ—Ä–∞ (MARKET/LIMIT)
- –†–∞—Å—á–µ—Ç —Ü–µ–Ω—ã –¥–ª—è –ª–∏–º–∏—Ç–Ω—ã—Ö –æ—Ä–¥–µ—Ä–æ–≤
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏

#### 6. `src/strategies/scalping/futures/position_manager.py` - –ú–µ–Ω–µ–¥–∂–µ—Ä –ø–æ–∑–∏—Ü–∏–π
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:**
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π
- –†–∞—Å—á–µ—Ç PnL (–ø—Ä–∏–±—ã–ª—å/—É–±—ã—Ç–æ–∫)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π –∑–∞–∫—Ä—ã—Ç–∏—è (TP/SL)
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Trailing Stop Loss

#### 7. `src/strategies/scalping/futures/risk_manager.py` - –ú–µ–Ω–µ–¥–∂–µ—Ä —Ä–∏—Å–∫–æ–≤
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:**
- –†–∞—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤ –º–∞—Ä–∂–∏
- –ó–∞—â–∏—Ç–∞ –æ—Ç –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏
- –ö–æ–Ω—Ç—Ä–æ–ª—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã—Ö –ø–æ—Ç–µ—Ä—å

#### 8. `src/strategies/scalping/futures/risk/adaptive_leverage.py` - –ê–¥–∞–ø—Ç–∏–≤–Ω–æ–µ –ø–ª–µ—á–æ
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:**
- –†–∞—Å—á–µ—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ –ø–ª–µ—á–∞ (3-30x) –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–∞—á–µ—Å—Ç–≤–∞ —Å–∏–≥–Ω–∞–ª–∞
- –£—á–µ—Ç —Ä–µ–∂–∏–º–∞ —Ä—ã–Ω–∫–∞ (trending/ranging/choppy)
- –£—á–µ—Ç –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ (ATR)
- –û–∫—Ä—É–≥–ª–µ–Ω–∏–µ –¥–æ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –Ω–∞ –±–∏—Ä–∂–µ

**–õ–æ–≥–∏–∫–∞:**
- –°–∏–ª–∞ —Å–∏–≥–Ω–∞–ª–∞ 0.0-0.3 ‚Üí 3x (very_weak)
- –°–∏–ª–∞ —Å–∏–≥–Ω–∞–ª–∞ 0.3-0.5 ‚Üí 5x (weak)
- –°–∏–ª–∞ —Å–∏–≥–Ω–∞–ª–∞ 0.5-0.7 ‚Üí 10x (medium)
- –°–∏–ª–∞ —Å–∏–≥–Ω–∞–ª–∞ 0.7-0.9 ‚Üí 20x (strong)
- –°–∏–ª–∞ —Å–∏–≥–Ω–∞–ª–∞ 0.9-1.0 ‚Üí 30x (very_strong)

#### 9. `src/strategies/scalping/futures/positions/position_scaling_manager.py` - –õ–µ—Å—Ç–Ω–∏—á–Ω—ã–π –≤—Ö–æ–¥
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫ –ø–æ–∑–∏—Ü–∏–∏
- –†–∞—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–∞ —Å–ª–µ–¥—É—é—â–µ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ –ª–µ—Å—Ç–Ω–∏—Ü–µ
- –í–∞–ª–∏–¥–∞—Ü–∏—è –ª–∏–º–∏—Ç–æ–≤ (max_additions, min_interval, max_loss)
- –ó–∞–ø–∏—Å—å –∏—Å—Ç–æ—Ä–∏–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–π

**–õ–µ—Å—Ç–Ω–∏—Ü–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:** [1.0, 0.8, 0.6, 0.4, 0.3, 0.2, 0.15]
- 1-–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ: 100% –æ—Ç –±–∞–∑–æ–≤–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞
- 2-–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ: 80% –æ—Ç –±–∞–∑–æ–≤–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞
- 3-–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ: 60% –æ—Ç –±–∞–∑–æ–≤–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞
- –ò —Ç–∞–∫ –¥–∞–ª–µ–µ...

#### 10. `src/strategies/scalping/futures/positions/exit_analyzer.py` - Exit Analyzer
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:**
- –£–º–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø–æ–∑–∏—Ü–∏–π –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π –æ –∑–∞–∫—Ä—ã—Ç–∏–∏
- –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ–∂–∏–º–∞ (trending/ranging/choppy)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Ä–µ—Å—É—Ä—Å–æ–≤: ADX, Order Flow, MTF, –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã
- –ü—Ä–æ–¥–ª–µ–Ω–∏–µ TP –ø—Ä–∏ —Å–∏–ª—å–Ω–æ–º —Ç—Ä–µ–Ω–¥–µ
- –ó–∞—â–∏—Ç–∞ –ø—Ä–∏–±—ã–ª–∏ —á–µ—Ä–µ–∑ trailing stop
- ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û (23.12.2025):** –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —á—Ç–µ–Ω–∏–µ SL –∏–∑ `adaptive_regime.{regime}.sl_percent`

#### 11. `src/strategies/scalping/futures/core/position_registry.py` - –†–µ–µ—Å—Ç—Ä –ø–æ–∑–∏—Ü–∏–π
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:**
- –ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã –¥–ª—è –≤—Å–µ—Ö –ø–æ–∑–∏—Ü–∏–π
- –•—Ä–∞–Ω–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö (entry_time, regime, balance_profile, leverage, scaling_history)
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ peak_profit (–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–∏–±—ã–ª–∏)
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ partial_tp_executed —Ñ–ª–∞–≥–æ–º

#### 12. `src/strategies/scalping/futures/core/position_sync.py` - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ–∑–∏—Ü–∏–π
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:**
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π —Å –±–∏—Ä–∂–µ–π
- –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ "drift" –ø–æ–∑–∏—Ü–∏–π (–Ω–∞ –±–∏—Ä–∂–µ, –Ω–æ –Ω–µ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º —Ä–µ–µ—Å—Ç—Ä–µ)
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è drift –ø–æ–∑–∏—Ü–∏–π –≤ PositionRegistry
- –û—á–∏—Å—Ç–∫–∞ –∑–∞–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π

#### 13. `src/clients/futures_client.py` - –ö–ª–∏–µ–Ω—Ç OKX API
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:**
- REST API –∑–∞–ø—Ä–æ—Å—ã –∫ –±–∏—Ä–∂–µ
- –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä—ã–Ω–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –†–∞–∑–º–µ—â–µ–Ω–∏–µ –æ—Ä–¥–µ—Ä–æ–≤
- –ü–æ–ª—É—á–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –∏ –ø–æ–∑–∏—Ü–∏–π

---

## üîÑ –ñ–ò–ó–ù–ï–ù–ù–´–ô –¶–ò–ö–õ –ë–û–¢–ê

### 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è (`orchestrator.start()`)

```python
1. –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏–∑ config_futures.yaml
2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è OKXFuturesClient (API –∫–ª—é—á–∏, sandbox —Ä–µ–∂–∏–º)
3. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π:
   - SignalGenerator (–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å–∏–≥–Ω–∞–ª–æ–≤)
   - OrderExecutor (–∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –æ—Ä–¥–µ—Ä–æ–≤)
   - PositionManager (–º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ–∑–∏—Ü–∏–π)
   - RiskManager (–º–µ–Ω–µ–¥–∂–µ—Ä —Ä–∏—Å–∫–æ–≤)
   - –§–∏–ª—å—Ç—Ä—ã (10+ —Ç–∏–ø–æ–≤)
   - –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã (RSI, MACD, BB, EMA, SMA, ATR)
4. –ó–∞–≥—Ä—É–∑–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–∑–∏—Ü–∏–π —Å –±–∏—Ä–∂–∏
5. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Trailing Stop Loss –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–∑–∏—Ü–∏–π
6. –ó–∞–ø—É—Å–∫ WebSocket –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä—ã–Ω–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
7. –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞
```

### 2. –ì–ª–∞–≤–Ω—ã–π —Ç–æ—Ä–≥–æ–≤—ã–π —Ü–∏–∫–ª (`orchestrator.run()`)

**–¶–∏–∫–ª –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ ~6 —Å–µ–∫—É–Ω–¥:**

```python
while active:
    for symbol in symbols:  # BTC-USDT, ETH-USDT, SOL-USDT...
        # –®–ê–ì 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ rate limit
        await _check_rate_limit()
        
        # –®–ê–ì 2: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä—ã–Ω–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        await _update_market_data(symbol)
        # - –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–≤–µ—á–µ–π 5m —á–µ—Ä–µ–∑ REST API
        # - –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π —Ü–µ–Ω—ã —á–µ—Ä–µ–∑ WebSocket
        
        # –®–ê–ì 3: –†–∞—Å—á–µ—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤
        indicators = indicator_manager.calculate_all(candles)
        # - RSI, MACD, Bollinger Bands, EMA, SMA, ATR
        
        # –®–ê–ì 4: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ —Ä—ã–Ω–∫–∞ (ARM)
        regime = regime_manager.detect_regime(candles, current_price)
        # - TRENDING (—Ç—Ä–µ–Ω–¥–æ–≤—ã–π)
        # - RANGING (–±–æ–∫–æ–≤–æ–π)
        # - CHOPPY (—Ö–∞–æ—Ç–∏—á–Ω—ã–π)
        
        # –®–ê–ì 5: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–∑–∏—Ü–∏–π
        if symbol in active_positions:
            position = active_positions[symbol]
            
            # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Trailing Stop Loss
            await _update_trailing_stop_loss(symbol, current_price)
            
            # –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π –∑–∞–∫—Ä—ã—Ç–∏—è
            await position_manager.manage_position(position)
            # - –ü—Ä–æ–≤–µ—Ä–∫–∞ TP (Take Profit)
            # - –ü—Ä–æ–≤–µ—Ä–∫–∞ SL (Stop Loss)
            # - –ü—Ä–æ–≤–µ—Ä–∫–∞ Trailing SL
            # - –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ —É–¥–µ—Ä–∂–∞–Ω–∏—è
            
        # –®–ê–ì 6: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–æ–≤—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤ (–µ—Å–ª–∏ can_trade)
        if can_trade(symbol):
            signal = await signal_generator.generate_signal(
                symbol=symbol,
                indicators=indicators,
                tick=current_price,
                current_positions=active_positions
            )
            
            # –®–ê–ì 7: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤
            if signal:
                if await _apply_filters(signal):
                    # –®–ê–ì 8: –ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–∞
                    await _execute_signal(signal)
        
        # –®–ê–ì 9: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–∫–∞–∂–¥—ã–µ 60 —Å–µ–∫)
        if time.time() - last_stats_time > 60:
            _log_statistics()
```

### 3. –û—Å—Ç–∞–Ω–æ–≤–∫–∞ (`orchestrator.stop()`)

```python
1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ñ–ª–∞–≥–∞ active = False
2. –ó–∞–∫—Ä—ã—Ç–∏–µ –≤—Å–µ—Ö –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
3. –ó–∞–∫—Ä—ã—Ç–∏–µ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
4. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
5. –ó–∞–ø–∏—Å—å —Ñ–∏–Ω–∞–ª—å–Ω—ã—Ö –ª–æ–≥–æ–≤
```

---

## üìä –ì–ï–ù–ï–†–ê–¶–ò–Ø –°–ò–ì–ù–ê–õ–û–í

### –ü—Ä–æ—Ü–µ—Å—Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–∏–≥–Ω–∞–ª–∞

#### 1. –†–∞—Å—á–µ—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤

**RSI (Relative Strength Index):**
```python
# –ü–µ—Ä–∏–æ–¥: 14 (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è)
# –ü–µ—Ä–µ–∫—É–ø–ª–µ–Ω–Ω–æ—Å—Ç—å: RSI > 70
# –ü–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω–Ω–æ—Å—Ç—å: RSI < 30

if RSI < 30:
    long_score += 2  # –°–∏–≥–Ω–∞–ª –Ω–∞ –ø–æ–∫—É–ø–∫—É
elif RSI > 70:
    short_score += 2  # –°–∏–≥–Ω–∞–ª –Ω–∞ –ø—Ä–æ–¥–∞–∂—É
```

**MACD (Moving Average Convergence Divergence):**
```python
# –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: fast=12, slow=26, signal=9
# –°–∏–≥–Ω–∞–ª BUY: macd_line > signal_line AND histogram > 0
# –°–∏–≥–Ω–∞–ª SELL: macd_line < signal_line AND histogram < 0

if macd_line > signal_line and histogram > 0:
    long_score += 2
elif macd_line < signal_line and histogram < 0:
    short_score += 2
```

**Bollinger Bands:**
```python
# –ü–µ—Ä–∏–æ–¥: 20, —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ: 2.0
# –°–∏–≥–Ω–∞–ª BUY: —Ü–µ–Ω–∞ <= –Ω–∏–∂–Ω—è—è –ø–æ–ª–æ—Å–∞
# –°–∏–≥–Ω–∞–ª SELL: —Ü–µ–Ω–∞ >= –≤–µ—Ä—Ö–Ω—è—è –ø–æ–ª–æ—Å–∞

if price <= bb_lower:
    long_score += 2
elif price >= bb_upper:
    short_score += 2
```

**EMA (Exponential Moving Average):**
```python
# EMA_12 –∏ EMA_26
# –°–∏–≥–Ω–∞–ª BUY: EMA_12 > EMA_26 AND —Ü–µ–Ω–∞ > EMA_12
# –°–∏–≥–Ω–∞–ª SELL: EMA_12 < EMA_26 AND —Ü–µ–Ω–∞ < EMA_12

if ema_12 > ema_26 and price > ema_12:
    long_score += 2
elif ema_12 < ema_26 and price < ema_12:
    short_score += 2
```

**ATR (Average True Range):**
```python
# –ü–µ—Ä–∏–æ–¥: 14
# –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏
# –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å –¥–ª—è –≤—Ö–æ–¥–∞: 0.0004 (0.04%)
```

#### 2. –°–∏—Å—Ç–µ–º–∞ –æ—Ü–µ–Ω–∫–∏ (Scoring System)

**–ë–∞–∑–æ–≤—ã–µ –±–∞–ª–ª—ã (0-12):**
- SMA Trend: +1 –±–∞–ª–ª
- EMA Trend: +2 –±–∞–ª–ª–∞
- RSI: +2 –±–∞–ª–ª–∞
- Bollinger Bands: +2 –±–∞–ª–ª–∞
- Volume: +2 –±–∞–ª–ª–∞
- MACD: +2 –±–∞–ª–ª–∞

**–ë–æ–Ω—É—Å—ã –æ—Ç —Ñ–∏–ª—å—Ç—Ä–æ–≤:**
- Multi-Timeframe: +1-3 –±–∞–ª–ª–∞
- Pivot Points: +1-3 –±–∞–ª–ª–∞
- Volume Profile: +1-3 –±–∞–ª–ª–∞

**–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø–æ—Ä–æ–≥ (–∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π –ø–æ —Ä–µ–∂–∏–º—É):**
- TRENDING: 6/12 –±–∞–ª–ª–æ–≤ (50%)
- RANGING: 4/12 –±–∞–ª–ª–æ–≤ (33%)
- CHOPPY: 7/12 –±–∞–ª–ª–æ–≤ (58%)

#### 3. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–∏–≥–Ω–∞–ª–∞

```python
if long_score >= threshold and long_score > short_score:
    signal_direction = "LONG"
    signal_strength = long_score / 12.0
elif short_score >= threshold and short_score > long_score:
    signal_direction = "SHORT"
    signal_strength = short_score / 12.0
else:
    return None  # –°–∏–≥–Ω–∞–ª –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è
```

#### 4. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤

–ü–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–∏–≥–Ω–∞–ª –ø—Ä–æ—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º—É —Ñ–∏–ª—å—Ç—Ä–æ–≤ (—Å–º. —Ä–∞–∑–¥–µ–ª [–°–∏—Å—Ç–µ–º—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏](#—Å–∏—Å—Ç–µ–º—ã-—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏)).

---

## üìù –§–û–†–ú–ò–†–û–í–ê–ù–ò–ï –û–†–î–ï–†–û–í

### –ü—Ä–æ—Ü–µ—Å—Å —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –æ—Ä–¥–µ—Ä–∞

#### 1. –†–∞—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏ (`risk_manager.calculate_position_size()`)

**–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏ –±–∞–ª–∞–Ω—Å–∞:**

**SMALL (< $1,500):**
```python
base_position = $50
min_position = $20
max_position = $120
max_open = 2 –ø–æ–∑–∏—Ü–∏–∏
max_percent = 8% –æ—Ç –±–∞–ª–∞–Ω—Å–∞
```

**MEDIUM ($1,500 - $3,500):**
```python
base_position = $100
min_position = $40
max_position = $200
max_open = 3 –ø–æ–∑–∏—Ü–∏–∏
max_percent = 6% –æ—Ç –±–∞–ª–∞–Ω—Å–∞
```

**LARGE (> $3,500):**
```python
base_position = $200
min_position = $80
max_position = $400
max_open = 3 –ø–æ–∑–∏—Ü–∏–∏
max_percent = 5% –æ—Ç –±–∞–ª–∞–Ω—Å–∞
```

**–†–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º —Ä–µ–∂–∏–º–∞:**
```python
# –ü–æ–ª—É—á–∞–µ–º –ø—Ä–æ—Ñ–∏–ª—å –¥–ª—è —Ä–µ–∂–∏–º–∞
regime_profile = get_regime_profile(symbol, regime)

# –ë–∞–∑–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä –∏–∑ –ø—Ä–æ—Ñ–∏–ª—è
base_size = regime_profile.get("base_position", $100)

# –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –Ω–∞ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å
atr_percent = calculate_atr_percent(candles, current_price)
volatility_multiplier = calculate_volatility_multiplier(atr_percent, regime)

# –§–∏–Ω–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä
position_size = base_size * volatility_multiplier

# –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
position_size = min(position_size, max_position)
position_size = max(position_size, min_position)
position_size = min(position_size, balance * max_percent)
```

#### 2. –í—ã–±–æ—Ä —Ç–∏–ø–∞ –æ—Ä–¥–µ—Ä–∞

**LIMIT –æ—Ä–¥–µ—Ä (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é):**
```python
# –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
# - –ö–æ–º–∏—Å—Å–∏—è maker: 0.02% (–≤–º–µ—Å—Ç–æ 0.05% taker)
# - –ö–æ–Ω—Ç—Ä–æ–ª—å —Ü–µ–Ω—ã –≤—Ö–æ–¥–∞
# - –≠–∫–æ–Ω–æ–º–∏—è –Ω–∞ –∫–æ–º–∏—Å—Å–∏—è—Ö

# –†–∞—Å—á–µ—Ç —Ü–µ–Ω—ã –¥–ª—è LIMIT:
if side == "LONG":
    # –ü–æ–∫—É–ø–∞–µ–º –Ω–∏–∂–µ —Ç–µ–∫—É—â–µ–π —Ü–µ–Ω—ã
    limit_price = current_price * (1 - offset_percent)
elif side == "SHORT":
    # –ü—Ä–æ–¥–∞–µ–º –≤—ã—à–µ —Ç–µ–∫—É—â–µ–π —Ü–µ–Ω—ã
    limit_price = current_price * (1 + offset_percent)

# Offset –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–µ–∂–∏–º–∞:
# - TRENDING: 0.05% (0.0005)
# - RANGING: 0.03% (0.0003)
# - CHOPPY: 0.08% (0.0008)
```

**MARKET –æ—Ä–¥–µ—Ä (fallback):**
```python
# –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –µ—Å–ª–∏:
# - –ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å —Ü–µ–Ω—É –¥–ª—è LIMIT
# - –°—Ä–æ—á–Ω—ã–π –≤—Ö–æ–¥ (–≤—ã—Å–æ–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å)
# - –û—à–∏–±–∫–∞ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è LIMIT –æ—Ä–¥–µ—Ä–∞

# –†–∞–∑–º–µ—â–∞–µ—Ç—Å—è –ø–æ —Ç–µ–∫—É—â–µ–π —Ä—ã–Ω–æ—á–Ω–æ–π —Ü–µ–Ω–µ
```

#### 3. –†–∞–∑–º–µ—â–µ–Ω–∏–µ –æ—Ä–¥–µ—Ä–∞ –Ω–∞ –±–∏—Ä–∂–µ (`order_executor.execute_signal()`)

**REST API –∑–∞–ø—Ä–æ—Å:**
```python
POST /api/v5/trade/order

{
    "instId": "BTC-USDT-SWAP",
    "tdMode": "isolated",  # Isolated margin
    "side": "buy",  # –∏–ª–∏ "sell"
    "ordType": "limit",  # –∏–ª–∏ "market"
    "sz": "0.01",  # –†–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏
    "px": "50000.0",  # –¶–µ–Ω–∞ (–¥–ª—è LIMIT)
    "posSide": "long",  # –∏–ª–∏ "short"
    "lever": "5"  # –ü–ª–µ—á–æ
}
```

**–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞:**
```python
if order_status == "filled":
    # –û—Ä–¥–µ—Ä –∏—Å–ø–æ–ª–Ω–µ–Ω
    position = create_position(order)
    active_positions[symbol] = position
    
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Trailing Stop Loss
    trailing_sl.initialize(
        entry_price=order.fill_price,
        side=signal.side,
        symbol=symbol
    )
    
elif order_status == "partially_filled":
    # –ß–∞—Å—Ç–∏—á–Ω–æ–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ
    # –ñ–¥–µ–º –ø–æ–ª–Ω–æ–≥–æ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –∏–ª–∏ –æ—Ç–º–µ–Ω—è–µ–º
    
elif order_status == "canceled":
    # –û—Ä–¥–µ—Ä –æ—Ç–º–µ–Ω–µ–Ω
    # –õ–æ–≥–∏—Ä—É–µ–º –ø—Ä–∏—á–∏–Ω—É
```

---

## üìà –£–ü–†–ê–í–õ–ï–ù–ò–ï –ü–û–ó–ò–¶–ò–Ø–ú–ò

### –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–π

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏:**
```python
position = {
    "symbol": "BTC-USDT",
    "side": "long",  # –∏–ª–∏ "short"
    "entry_price": 50000.0,
    "size": 0.01,
    "margin": 100.0,  # –ú–∞—Ä–∂–∞
    "leverage": 5,
    "entry_time": datetime.now(),
    "regime": "trending",  # –†–µ–∂–∏–º –ø—Ä–∏ –≤—Ö–æ–¥–µ
    "trailing_sl": TrailingStopLoss(),
    "tp_percent": 2.4,  # Take Profit %
    "sl_percent": 1.2,  # Stop Loss %
    "pnl": 0.0,  # –¢–µ–∫—É—â–∏–π PnL
    "pnl_percent": 0.0  # PnL –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö
}
```

### –†–∞—Å—á–µ—Ç PnL (Profit and Loss)

**–î–ª—è LONG –ø–æ–∑–∏—Ü–∏–∏:**
```python
pnl = (current_price - entry_price) * size
pnl_percent = (current_price - entry_price) / entry_price * 100

# –° —É—á–µ—Ç–æ–º –∫–æ–º–∏—Å—Å–∏–π:
pnl_net = pnl - (entry_price * size * fee_rate) - (current_price * size * fee_rate)
pnl_percent_net = pnl_net / (entry_price * size) * 100
```

**–î–ª—è SHORT –ø–æ–∑–∏—Ü–∏–∏:**
```python
pnl = (entry_price - current_price) * size
pnl_percent = (entry_price - current_price) / entry_price * 100

# –° —É—á–µ—Ç–æ–º –∫–æ–º–∏—Å—Å–∏–π:
pnl_net = pnl - (entry_price * size * fee_rate) - (current_price * size * fee_rate)
pnl_percent_net = pnl_net / (entry_price * size) * 100
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Trailing Stop Loss

**–õ–æ–≥–∏–∫–∞ –¥–ª—è LONG:**
```python
# –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é —Ü–µ–Ω—É
if current_price > highest_price:
    highest_price = current_price
    
    # –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –ø—Ä–∏–±—ã–ª—å
    profit_pct = (highest_price - entry_price) / entry_price
    
    # –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ç—Ä–µ–π–ª–∏–Ω–≥ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø—Ä–∏–±—ã–ª–∏
    if profit_pct < 0.5%:
        trail_multiplier = 1.5x
    elif profit_pct < 1.5%:
        trail_multiplier = 2.0x
    else:
        trail_multiplier = 3.0x
    
    # –ù–æ–≤—ã–π —Å—Ç–æ–ø-–ª–æ—Å—Å
    trailing_sl = highest_price * (1 - initial_trail * trail_multiplier)
    
    # –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
    trailing_sl = max(trailing_sl, entry_price * (1 - max_trail))
    trailing_sl = min(trailing_sl, entry_price * (1 - min_trail))
```

**–õ–æ–≥–∏–∫–∞ –¥–ª—è SHORT:**
```python
# –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é —Ü–µ–Ω—É
if current_price < lowest_price:
    lowest_price = current_price
    
    # –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –ø—Ä–∏–±—ã–ª—å
    profit_pct = (entry_price - lowest_price) / entry_price
    
    # –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ç—Ä–µ–π–ª–∏–Ω–≥
    # (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ LONG, –Ω–æ –≤ –æ–±—Ä–∞—Ç–Ω—É—é —Å—Ç–æ—Ä–æ–Ω—É)
    
    # –ù–æ–≤—ã–π —Å—Ç–æ–ø-–ª–æ—Å—Å
    trailing_sl = lowest_price * (1 + initial_trail * trail_multiplier)
```

---

## üö™ –ó–ê–ö–†–´–¢–ò–ï –ü–û–ó–ò–¶–ò–ô

### –£—Å–ª–æ–≤–∏—è –∑–∞–∫—Ä—ã—Ç–∏—è

#### 1. Take Profit (TP)

**–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π TP:**
```python
# TP —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ø–æ–∑–∏—Ü–∏–∏
tp_percent = 2.4%  # –ê–¥–∞–ø—Ç–∏–≤–Ω–æ –ø–æ —Ä–µ–∂–∏–º—É

# –ü—Ä–æ–≤–µ—Ä–∫–∞:
if pnl_percent >= tp_percent:
    await close_position(symbol, reason="tp")
```

**–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π TP –ø–æ —Ä–µ–∂–∏–º—É:**
- TRENDING: 2.4% (1.2x ATR)
- RANGING: 1.8% (0.6x ATR)
- CHOPPY: 2.0% (0.8x ATR)

#### 2. Stop Loss (SL)

**–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π SL:**
```python
# SL —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ø–æ–∑–∏—Ü–∏–∏
sl_percent = 1.2%  # –ê–¥–∞–ø—Ç–∏–≤–Ω–æ –ø–æ —Ä–µ–∂–∏–º—É

# –ü—Ä–æ–≤–µ—Ä–∫–∞:
if pnl_percent <= -sl_percent:
    await close_position(symbol, reason="sl")
```

**–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π SL –ø–æ —Ä–µ–∂–∏–º—É:**
- TRENDING: 1.2% (0.8x ATR)
- RANGING: 0.8% (0.4x ATR)
- CHOPPY: 1.5% (1.2x ATR)

#### 3. Trailing Stop Loss

**–õ–æ–≥–∏–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è:**
```python
# –î–ª—è LONG:
if current_price <= trailing_sl:
    await close_position(symbol, reason="trailing_sl")

# –î–ª—è SHORT:
if current_price >= trailing_sl:
    await close_position(symbol, reason="trailing_sl")
```

#### 4. Partial Take Profit

**–ß–∞—Å—Ç–∏—á–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ:**
```python
# –¢—Ä–∏–≥–≥–µ—Ä: –ø—Ä–∏–±—ã–ª—å –¥–æ—Å—Ç–∏–≥–ª–∞ trigger_percent
if pnl_percent >= trigger_percent:
    # –ó–∞–∫—Ä—ã–≤–∞–µ–º —á–∞—Å—Ç—å –ø–æ–∑–∏—Ü–∏–∏
    close_size = position_size * fraction
    
    # –ê–¥–∞–ø—Ç–∏–≤–Ω–æ –ø–æ —Ä–µ–∂–∏–º—É:
    # - TRENDING: 50% –ø—Ä–∏ 0.5%
    # - RANGING: 60% –ø—Ä–∏ 0.6%
    # - CHOPPY: 70% –ø—Ä–∏ 0.3%
    
    await close_position_partial(symbol, close_size, reason="partial_tp")
```

#### 5. Time Stop

**–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è —É–¥–µ—Ä–∂–∞–Ω–∏—è:**
```python
# –ê–¥–∞–ø—Ç–∏–≤–Ω–æ –ø–æ —Ä–µ–∂–∏–º—É:
# - TRENDING: 45 –º–∏–Ω—É—Ç
# - RANGING: 12 –º–∏–Ω—É—Ç
# - CHOPPY: 30 –º–∏–Ω—É—Ç

holding_time = current_time - entry_time
if holding_time > max_holding_time:
    await close_position(symbol, reason="time_stop")
```

#### 6. Break-even Stop Loss

**–ó–∞—â–∏—Ç–∞ –ø—Ä–∏–±—ã–ª–∏:**
```python
# –ü–æ—Å–ª–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è 1.0 ATR –ø—Ä–∏–±—ã–ª–∏
if pnl_percent >= 1.0 * atr_percent:
    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º SL –Ω–∞ —É—Ä–æ–≤–µ–Ω—å –≤—Ö–æ–¥–∞ (break-even)
    sl_price = entry_price
    # –ó–∞—â–∏—â–∞–µ–º –æ—Ç —É–±—ã—Ç–∫–∞
```

### –ü—Ä–æ—Ü–µ—Å—Å –∑–∞–∫—Ä—ã—Ç–∏—è

```python
async def close_position(symbol: str, reason: str):
    # –®–ê–ì 1: –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏
    position = active_positions.get(symbol)
    if not position:
        return
    
    # –®–ê–ì 2: –†–∞–∑–º–µ—â–µ–Ω–∏–µ MARKET –æ—Ä–¥–µ—Ä–∞ –Ω–∞ –∑–∞–∫—Ä—ã—Ç–∏–µ
    if position.side == "long":
        close_side = "sell"
    else:
        close_side = "buy"
    
    order = await client.place_order(
        symbol=symbol,
        side=close_side,
        order_type="market",
        quantity=position.size
    )
    
    # –®–ê–ì 3: –û–∂–∏–¥–∞–Ω–∏–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è
    await wait_for_order_fill(order)
    
    # –®–ê–ì 4: –†–∞—Å—á–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ PnL
    final_pnl = calculate_pnl(position, order.fill_price)
    
    # –®–ê–ì 5: –ó–∞–ø–∏—Å—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    trading_statistics.record_trade(
        symbol=symbol,
        side=position.side,
        pnl=final_pnl,
        reason=reason
    )
    
    # –®–ê–ì 6: –£–¥–∞–ª–µ–Ω–∏–µ –∏–∑ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π
    del active_positions[symbol]
    
    # –®–ê–ì 7: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
    logger.info(f"‚úÖ –ü–æ–∑–∏—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∞: {symbol} | –ü—Ä–∏—á–∏–Ω–∞: {reason} | PnL: {final_pnl:.2f}%")
```

---

## üîç –°–ò–°–¢–ï–ú–´ –§–ò–õ–¨–¢–†–ê–¶–ò–ò

### –¢–∏–ø—ã —Ñ–∏–ª—å—Ç—Ä–æ–≤

#### 1. Correlation Filter (–§–∏–ª—å—Ç—Ä –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–π –≤ —Å–∏–ª—å–Ω–æ –∫–æ—Ä—Ä–µ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–∞—Ä–∞—Ö.

**–õ–æ–≥–∏–∫–∞:**
```python
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏ –º–µ–∂–¥—É –ø–∞—Ä–∞–º–∏
correlation = calculate_correlation(symbol1, symbol2)

# –ï—Å–ª–∏ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏—è > 0.7 –∏ —É–∂–µ –µ—Å—Ç—å –ø–æ–∑–∏—Ü–∏—è –≤ –æ–¥–Ω–æ–π –ø–∞—Ä–µ
if correlation > 0.7 and has_position(symbol1):
    if same_direction(symbol1, symbol2):
        block_signal(symbol2, reason="high_correlation")
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `correlation_threshold: 0.7` - –ü–æ—Ä–æ–≥ –≤—ã—Å–æ–∫–æ–π –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏
- `max_correlated_positions: 1` - –ú–∞–∫—Å–∏–º—É–º –ø–æ–∑–∏—Ü–∏–π –≤ –∫–æ—Ä—Ä–µ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–∞—Ä–∞—Ö
- `block_same_direction_only: true` - –ë–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è

#### 2. Multi-Timeframe Filter (–ú—É–ª—å—Ç–∏—Ç–∞–π–º—Ñ—Ä–µ–π–º —Ñ–∏–ª—å—Ç—Ä)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç —Å–∏–≥–Ω–∞–ª –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ç–∞–π–º—Ñ—Ä–µ–π–º–∞—Ö.

**–õ–æ–≥–∏–∫–∞:**
```python
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —Ç–∞–π–º—Ñ—Ä–µ–π–º–∞—Ö
timeframes = ["5m", "15m", "1h"]

for tf in timeframes:
    candles_tf = get_candles(symbol, tf)
    indicators_tf = calculate_indicators(candles_tf)
    
    if confirm_signal(indicators_tf, direction):
        confirmation_score += 1

# –ú–∏–Ω–∏–º—É–º 2 –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∏–∑ 3
if confirmation_score >= 2:
    allow_signal()
else:
    block_signal(reason="insufficient_timeframe_confirmation")
```

**–ë–æ–Ω—É—Å—ã:**
- 1 –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ: +1 –±–∞–ª–ª
- 2 –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è: +2 –±–∞–ª–ª–∞
- 3 –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è: +3 –±–∞–ª–ª–∞

#### 3. ADX Filter (–§–∏–ª—å—Ç—Ä —Å–∏–ª—ã —Ç—Ä–µ–Ω–¥–∞)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –§–∏–ª—å—Ç—Ä—É–µ—Ç —Å–ª–∞–±—ã–µ —Ç—Ä–µ–Ω–¥—ã.

**–õ–æ–≥–∏–∫–∞:**
```python
# –†–∞—Å—á–µ—Ç ADX (Average Directional Index)
adx = calculate_adx(candles, period=14)

# –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –ø–æ—Ä–æ–≥ –ø–æ —Ä–µ–∂–∏–º—É:
# - TRENDING: ADX > 25
# - RANGING: ADX > 20
# - CHOPPY: ADX > 25

if adx < threshold:
    block_signal(reason="weak_trend_strength")

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è (+DI vs -DI)
if direction == "LONG" and di_plus < di_minus + di_difference:
    block_signal(reason="wrong_trend_direction")
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `adx_threshold: 25.0` - –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å–∏–ª–∞ —Ç—Ä–µ–Ω–¥–∞
- `di_difference: 1.5` - –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É +DI –∏ -DI
- `adx_period: 14` - –ü–µ—Ä–∏–æ–¥ —Ä–∞—Å—á–µ—Ç–∞ ADX

#### 4. Pivot Points Filter (–§–∏–ª—å—Ç—Ä —Ç–æ—á–µ–∫ —Ä–∞–∑–≤–æ—Ä–æ—Ç–∞)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —É—Ä–æ–≤–Ω–∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏/—Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏—è.

**–õ–æ–≥–∏–∫–∞:**
```python
# –†–∞—Å—á–µ—Ç Pivot Points
pivot = (high + low + close) / 3
resistance = 2 * pivot - low
support = 2 * pivot - high

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–ª–∏–∑–æ—Å—Ç–∏ –∫ —É—Ä–æ–≤–Ω—è–º
if direction == "LONG":
    if price <= support * 1.002:  # –í –ø—Ä–µ–¥–µ–ª–∞—Ö 0.2% –æ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏
        allow_signal()
        bonus_score += 2
elif direction == "SHORT":
    if price >= resistance * 0.998:  # –í –ø—Ä–µ–¥–µ–ª–∞—Ö 0.2% –æ—Ç —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏—è
        allow_signal()
        bonus_score += 2
```

**–ë–æ–Ω—É—Å—ã:**
- TRENDING: +1-2 –±–∞–ª–ª–∞ √ó 1.5
- RANGING: +2 –±–∞–ª–ª–∞ √ó 1.5
- CHOPPY: +3 –±–∞–ª–ª–∞ √ó 2.0

#### 5. Volume Profile Filter (–§–∏–ª—å—Ç—Ä –ø—Ä–æ—Ñ–∏–ª—è –æ–±—ä–µ–º–∞)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ–±—ä–µ–º–∞ –ø–æ —Ü–µ–Ω–∞–º.

**–õ–æ–≥–∏–∫–∞:**
```python
# –†–∞—Å—á–µ—Ç Volume Profile
volume_profile = calculate_volume_profile(candles)

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–æ–Ω –≤—ã—Å–æ–∫–æ–π –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏
high_volume_zones = get_high_volume_zones(volume_profile)

if price in high_volume_zones:
    allow_signal()
    bonus_score += 2
```

**–ë–æ–Ω—É—Å—ã:**
- TRENDING: +1-2 –±–∞–ª–ª–∞ √ó 1.0
- RANGING: +2 –±–∞–ª–ª–∞ √ó 1.5
- CHOPPY: +3 –±–∞–ª–ª–∞ √ó 2.0

#### 6. Funding Rate Filter (–§–∏–ª—å—Ç—Ä funding rate)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –£—á–∏—Ç—ã–≤–∞–µ—Ç funding rate –¥–ª—è Futures.

**–õ–æ–≥–∏–∫–∞:**
```python
# –ü–æ–ª—É—á–µ–Ω–∏–µ funding rate
funding_rate = await client.get_funding_rate(symbol)

# –î–ª—è LONG: –∏–∑–±–µ–≥–∞–µ–º –≤—ã—Å–æ–∫–∏–π –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–π funding
if direction == "LONG" and funding_rate > 0.01:  # > 1%
    block_signal(reason="high_funding_rate_long")

# –î–ª—è SHORT: –∏–∑–±–µ–≥–∞–µ–º –≤—ã—Å–æ–∫–∏–π –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π funding
if direction == "SHORT" and funding_rate < -0.01:  # < -1%
    block_signal(reason="high_funding_rate_short")
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `max_funding_rate: 0.01` - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π funding rate (1%)

#### 7. Liquidity Filter (–§–∏–ª—å—Ç—Ä –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—É—é –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å –¥–ª—è –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è.

**–õ–æ–≥–∏–∫–∞:**
```python
# –ü–æ–ª—É—á–µ–Ω–∏–µ order book
order_book = await client.get_order_book(symbol)

# –†–∞—Å—á–µ—Ç –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö 0.5% –æ—Ç —Ç–µ–∫—É—â–µ–π —Ü–µ–Ω—ã
liquidity = calculate_liquidity(order_book, price_range=0.005)

# –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å: $10,000
if liquidity < 10000:
    block_signal(reason="insufficient_liquidity")
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `min_liquidity: 10000` - –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å (USD)

#### 8. Order Flow Filter (–§–∏–ª—å—Ç—Ä –ø–æ—Ç–æ–∫–∞ –æ—Ä–¥–µ—Ä–æ–≤)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø–æ—Ç–æ–∫ –ø–æ–∫—É–ø–æ–∫/–ø—Ä–æ–¥–∞–∂.

**–õ–æ–≥–∏–∫–∞:**
```python
# –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ —Å–¥–µ–ª–∫–∞—Ö
trades = await client.get_recent_trades(symbol)

# –†–∞—Å—á–µ—Ç –ø–æ—Ç–æ–∫–∞
buy_volume = sum(t.volume for t in trades if t.side == "buy")
sell_volume = sum(t.volume for t in trades if t.side == "sell")

# –î–ª—è LONG: –Ω—É–∂–µ–Ω –ø—Ä–µ–æ–±–ª–∞–¥–∞—é—â–∏–π –ø–æ—Ç–æ–∫ –ø–æ–∫—É–ø–æ–∫
if direction == "LONG":
    if buy_volume < sell_volume * 1.2:  # –ü–æ–∫—É–ø–∫–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –Ω–∞ 20% –±–æ–ª—å—à–µ
        block_signal(reason="weak_buy_pressure")
```

#### 9. Volatility Regime Filter (–§–∏–ª—å—Ç—Ä —Ä–µ–∂–∏–º–∞ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ê–¥–∞–ø—Ç–∏—Ä—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å.

**–õ–æ–≥–∏–∫–∞:**
```python
# –†–∞—Å—á–µ—Ç –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ (ATR %)
atr_percent = calculate_atr_percent(candles, current_price)

# –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏
if atr_percent < 0.01:  # < 1%
    volatility_regime = "low"
elif atr_percent > 0.03:  # > 3%
    volatility_regime = "high"
else:
    volatility_regime = "normal"

# –ê–¥–∞–ø—Ç–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
if volatility_regime == "low":
    # –£–º–µ–Ω—å—à–∞–µ–º —Ä–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏
    position_size *= 0.5
elif volatility_regime == "high":
    # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º SL
    sl_percent *= 1.5
```

#### 10. Momentum Filter (–§–∏–ª—å—Ç—Ä –∏–º–ø—É–ª—å—Å–∞)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–∏–ª—É –∏–º–ø—É–ª—å—Å–∞ –¥–≤–∏–∂–µ–Ω–∏—è.

**–õ–æ–≥–∏–∫–∞:**
```python
# –†–∞—Å—á–µ—Ç –∏–º–ø—É–ª—å—Å–∞ (–∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–µ–Ω—ã –∑–∞ –ø–µ—Ä–∏–æ–¥)
momentum = (current_price - price_n_periods_ago) / price_n_periods_ago

# –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∏–º–ø—É–ª—å—Å: 0.2%
if abs(momentum) < 0.002:
    block_signal(reason="weak_momentum")

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
if direction == "LONG" and momentum < 0:
    block_signal(reason="negative_momentum")
```

#### 11. Time Filter (–§–∏–ª—å—Ç—Ä –≤—Ä–µ–º–µ–Ω–∏)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –¢–æ—Ä–≥–æ–≤–ª—è –≤ –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Å—Å–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ).

**–õ–æ–≥–∏–∫–∞:**
```python
# –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–æ—Ä–≥–æ–≤–æ–π —Å–µ—Å—Å–∏–∏
current_hour = datetime.utcnow().hour

# –ê–∑–∏–∞—Ç—Å–∫–∞—è —Å–µ—Å—Å–∏—è: 00:00-09:00 UTC
# –ï–≤—Ä–æ–ø–µ–π—Å–∫–∞—è —Å–µ—Å—Å–∏—è: 07:00-16:00 UTC
# –ê–º–µ—Ä–∏–∫–∞–Ω—Å–∫–∞—è —Å–µ—Å—Å–∏—è: 13:00-22:00 UTC

if not is_trading_session(current_hour):
    block_signal(reason="outside_trading_hours")
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ—Ç–∫–ª—é—á–µ–Ω (–∫—Ä–∏–ø—Ç–∞ —Ç–æ—Ä–≥—É–µ—Ç—Å—è 24/7).

#### 12. Balance Checker (–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ—Å—Ç—å –±–∞–ª–∞–Ω—Å–∞.

**–õ–æ–≥–∏–∫–∞:**
```python
# –ü–æ–ª—É—á–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
balance = await client.get_balance()

# –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å: $50
if balance < 50:
    block_signal(reason="insufficient_balance")

# –†–µ–∑–µ—Ä–≤: 10% –æ—Ç –±–∞–ª–∞–Ω—Å–∞
reserve = balance * 0.1
available = balance - reserve

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ—Å—Ç–∏ –¥–ª—è –ø–æ–∑–∏—Ü–∏–∏
if position_size > available:
    block_signal(reason="insufficient_available_balance")
```

---

## üõ°Ô∏è –°–ò–°–¢–ï–ú–´ –ó–ê–©–ò–¢–´

### –ó–∞—â–∏—Ç—ã –æ—Ç —Ä–∏—Å–∫–æ–≤

#### 1. Consecutive Losses Protection (–ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —É–±—ã—Ç–∫–æ–≤)

**–õ–æ–≥–∏–∫–∞:**
```python
# –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —É–±—ã—Ç–∫–æ–≤
if trade.pnl < 0:
    consecutive_losses += 1
else:
    consecutive_losses = 0

# –ú–∞–∫—Å–∏–º—É–º 3 –ø–æ–¥—Ä—è–¥ —É–±—ã—Ç–∫–∞ ‚Üí STOP
if consecutive_losses >= 3:
    emergency_stop()
    block_all_trading()
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `max_consecutive_losses: 3` - –ú–∞–∫—Å–∏–º—É–º –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —É–±—ã—Ç–∫–æ–≤

#### 2. Daily Loss Limit (–î–Ω–µ–≤–Ω–æ–π –ª–∏–º–∏—Ç —É–±—ã—Ç–∫–æ–≤)

**–õ–æ–≥–∏–∫–∞:**
```python
# –†–∞—Å—á–µ—Ç –¥–Ω–µ–≤–Ω–æ–≥–æ PnL
daily_pnl = sum(trade.pnl for trade in today_trades)

# –õ–∏–º–∏—Ç: 10% –æ—Ç –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞
if daily_pnl <= -initial_balance * 0.10:
    emergency_stop()
    block_all_trading()
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `daily_loss_limit: 0.10` - 10% –æ—Ç –±–∞–ª–∞–Ω—Å–∞

#### 3. Daily Profit Lock (–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –¥–Ω–µ–≤–Ω–æ–π –ø—Ä–∏–±—ã–ª–∏)

**–õ–æ–≥–∏–∫–∞:**
```python
# –†–∞—Å—á–µ—Ç –¥–Ω–µ–≤–Ω–æ–≥–æ PnL
daily_pnl = sum(trade.pnl for trade in today_trades)

# –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø—Ä–∏ +5% –ø—Ä–∏–±—ã–ª–∏
if daily_pnl >= initial_balance * 0.05:
    stop_trading()
    logger.info("‚úÖ –î–Ω–µ–≤–Ω–∞—è –ø—Ä–∏–±—ã–ª—å –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–∞: +5%")
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `daily_profit_lock: 0.05` - 5% –æ—Ç –±–∞–ª–∞–Ω—Å–∞

#### 4. Max Open Positions (–ú–∞–∫—Å–∏–º—É–º –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π)

**–õ–æ–≥–∏–∫–∞:**
```python
# –ü–æ–¥—Å—á–µ—Ç –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π
open_positions_count = len(active_positions)

# –ú–∞–∫—Å–∏–º—É–º: 3 –ø–æ–∑–∏—Ü–∏–∏
if open_positions_count >= 3:
    block_new_signals(reason="max_positions_reached")
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `max_open_positions: 3` - –ú–∞–∫—Å–∏–º—É–º –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π

#### 5. Max Position Size (–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏)

**–õ–æ–≥–∏–∫–∞:**
```python
# –†–∞—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏
position_size = calculate_position_size(...)

# –ú–∞–∫—Å–∏–º—É–º: 5% –æ—Ç –±–∞–ª–∞–Ω—Å–∞
max_size = balance * 0.05

if position_size > max_size:
    position_size = max_size
    logger.warning("‚ö†Ô∏è –†–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω –¥–æ 5%")
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `max_position_size_percent: 0.05` - 5% –æ—Ç –±–∞–ª–∞–Ω—Å–∞

#### 6. Max Loss per Trade (–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø–æ—Ç–µ—Ä—è –Ω–∞ —Å–¥–µ–ª–∫—É)

**–õ–æ–≥–∏–∫–∞:**
```python
# –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø–æ—Ç–µ—Ä—è: 2% –æ—Ç –±–∞–ª–∞–Ω—Å–∞
max_loss = balance * 0.02

# –†–∞—Å—á–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏
# –ï—Å–ª–∏ SL = 1.2%, —Ç–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä:
max_position = max_loss / 0.012

if position_size > max_position:
    position_size = max_position
    logger.warning("‚ö†Ô∏è –†–∞–∑–º–µ—Ä –æ–≥—Ä–∞–Ω–∏—á–µ–Ω max_loss_per_trade")
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `max_loss_per_trade: 0.02` - 2% –æ—Ç –±–∞–ª–∞–Ω—Å–∞

#### 7. Max Margin Used (–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–∞—Ä–∂–∏)

**–õ–æ–≥–∏–∫–∞:**
```python
# –†–∞—Å—á–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω–æ–π –º–∞—Ä–∂–∏
used_margin = sum(pos.margin for pos in active_positions.values())

# –ú–∞–∫—Å–∏–º—É–º: 80% –æ—Ç –±–∞–ª–∞–Ω—Å–∞
max_margin = balance * 0.80

if used_margin + new_position_margin > max_margin:
    block_signal(reason="max_margin_reached")
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `max_margin_percent: 0.80` - 80% –æ—Ç –±–∞–ª–∞–Ω—Å–∞

#### 8. Drawdown Protection (–ó–∞—â–∏—Ç–∞ –æ—Ç –ø—Ä–æ—Å–∞–¥–∫–∏)

**–õ–æ–≥–∏–∫–∞:**
```python
# –†–∞—Å—á–µ—Ç –ø—Ä–æ—Å–∞–¥–∫–∏
drawdown = (initial_balance - current_balance) / initial_balance

# –ú–∞–∫—Å–∏–º—É–º: 5% –ø—Ä–æ—Å–∞–¥–∫–∏
if drawdown > 0.05:
    emergency_stop()
    close_all_positions()
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `max_drawdown: 0.05` - 5% –ø—Ä–æ—Å–∞–¥–∫–∏

### –ó–∞—â–∏—Ç—ã –ø–æ–∑–∏—Ü–∏–π

#### 9. Break-even Stop Loss

**–õ–æ–≥–∏–∫–∞:**
```python
# –ü–æ—Å–ª–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è 1.0 ATR –ø—Ä–∏–±—ã–ª–∏
if pnl_percent >= 1.0 * atr_percent:
    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º SL –Ω–∞ —É—Ä–æ–≤–µ–Ω—å –≤—Ö–æ–¥–∞
    sl_price = entry_price
    # –ó–∞—â–∏—â–∞–µ–º –æ—Ç —É–±—ã—Ç–∫–∞
```

#### 10. Trailing Stop Loss

**–û–ø–∏—Å–∞–Ω–∏–µ:** –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –ø–æ–¥—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç —Å—Ç–æ–ø-–ª–æ—Å—Å –ø–æ–¥ –¥–≤–∏–∂–µ–Ω–∏–µ —Ü–µ–Ω—ã (—Å–º. —Ä–∞–∑–¥–µ–ª [–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏—è–º–∏](#—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ-–ø–æ–∑–∏—Ü–∏—è–º–∏)).

#### 11. Partial Take Profit

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ß–∞—Å—Ç–∏—á–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –¥–ª—è —Ñ–∏–∫—Å–∞—Ü–∏–∏ –ø—Ä–∏–±—ã–ª–∏ (—Å–º. —Ä–∞–∑–¥–µ–ª [–ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–π](#–∑–∞–∫—Ä—ã—Ç–∏–µ-–ø–æ–∑–∏—Ü–∏–π)).

#### 12. Time Stop

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è —É–¥–µ—Ä–∂–∞–Ω–∏—è –ø–æ–∑–∏—Ü–∏–∏ (—Å–º. —Ä–∞–∑–¥–µ–ª [–ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–π](#–∑–∞–∫—Ä—ã—Ç–∏–µ-–ø–æ–∑–∏—Ü–∏–π)).

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∑–∞—â–∏—Ç—ã

#### 13. Spread Filter (–§–∏–ª—å—Ç—Ä —Å–ø—Ä–µ–¥–∞)

**–õ–æ–≥–∏–∫–∞:**
```python
# –†–∞—Å—á–µ—Ç —Å–ø—Ä–µ–¥–∞
spread = (ask_price - bid_price) / bid_price

# –ú–∞–∫—Å–∏–º—É–º: 0.1%
if spread > 0.001:
    block_signal(reason="spread_too_wide")
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `max_spread: 0.001` - 0.1% —Å–ø—Ä–µ–¥–∞

#### 14. Min Order Value (–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –æ—Ä–¥–µ—Ä–∞)

**–õ–æ–≥–∏–∫–∞:**
```python
# –†–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –æ—Ä–¥–µ—Ä–∞
order_value = position_size * current_price

# –ú–∏–Ω–∏–º—É–º: $30
if order_value < 30:
    block_signal(reason="order_value_too_small")
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `min_order_value: 30` - $30 USD

#### 15. Rate Limiting (–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤)

**–õ–æ–≥–∏–∫–∞:**
```python
# –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–ø—Ä–æ—Å–æ–≤
requests_count = count_requests_in_last_minute()

# –ú–∞–∫—Å–∏–º—É–º: 60 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω—É—Ç—É
if requests_count >= 60:
    wait_until_rate_limit_reset()
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `max_requests_per_minute: 60` - 60 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω—É—Ç—É

#### 16. Slippage Guard (–ó–∞—â–∏—Ç–∞ –æ—Ç –ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏—è)

**–õ–æ–≥–∏–∫–∞:**
```python
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏—è –ø—Ä–∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–∏
expected_price = signal.price
actual_price = order.fill_price

slippage = abs(actual_price - expected_price) / expected_price

# –ú–∞–∫—Å–∏–º—É–º: 0.2% –ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏—è
if slippage > 0.002:
    logger.warning(f"‚ö†Ô∏è –í—ã—Å–æ–∫–æ–µ –ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏–µ: {slippage:.2%}")
    # –õ–æ–≥–∏—Ä—É–µ–º –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `max_slippage: 0.002` - 0.2% –ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏—è

#### 17. Liquidation Protector (–ó–∞—â–∏—Ç–∞ –æ—Ç –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏)

**–õ–æ–≥–∏–∫–∞:**
```python
# –†–∞—Å—á–µ—Ç –ª–∏–∫–≤–∏–¥–∞—Ü–∏–æ–Ω–Ω–æ–π —Ü–µ–Ω—ã
liquidation_price = calculate_liquidation_price(position)

# –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ: 5% –æ—Ç —Ç–µ–∫—É—â–µ–π —Ü–µ–Ω—ã
safe_distance = current_price * 0.05

if abs(current_price - liquidation_price) < safe_distance:
    logger.warning("‚ö†Ô∏è –ë–ª–∏–∑–∫–æ –∫ –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏!")
    # –†–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–µ–º –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–∏
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `liquidation_safety_distance: 0.05` - 5% –æ—Ç —Ü–µ–Ω—ã

---

## üßÆ –†–ê–°–ß–ï–¢–´ –ò –ú–ê–¢–ï–ú–ê–¢–ò–ö–ê

### –†–∞—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏

**–ë–∞–∑–æ–≤–∞—è —Ñ–æ—Ä–º—É–ª–∞:**
```python
# 1. –ë–∞–∑–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä –∏–∑ –ø—Ä–æ—Ñ–∏–ª—è –±–∞–ª–∞–Ω—Å–∞
base_size = get_base_size_from_profile(balance)

# 2. –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –Ω–∞ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å
atr_percent = calculate_atr_percent(candles, price)
volatility_multiplier = calculate_volatility_multiplier(atr_percent, regime)

# 3. –§–∏–Ω–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä
position_size = base_size * volatility_multiplier

# 4. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
position_size = min(position_size, max_position)
position_size = max(position_size, min_position)
position_size = min(position_size, balance * max_percent)
position_size = min(position_size, max_loss / sl_percent)
```

**–ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –Ω–∞ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å:**
```python
# –ë–∞–∑–æ–≤—ã–π ATR % –¥–ª—è —Ä–µ–∂–∏–º–∞
base_atr = regime_profile.base_atr_percent

# –¢–µ–∫—É—â–∏–π ATR %
current_atr = calculate_atr_percent(candles, price)

# –ú–Ω–æ–∂–∏—Ç–µ–ª—å
if current_atr < base_atr * 0.5:
    multiplier = min_multiplier  # 0.5x
elif current_atr > base_atr * 1.5:
    multiplier = max_multiplier  # 1.5x
else:
    multiplier = 1.0 + (current_atr / base_atr - 1.0) * 0.5
```

### –†–∞—Å—á–µ—Ç –º–∞—Ä–∂–∏

**–î–ª—è Futures —Å –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –º–∞—Ä–∂–æ–π:**
```python
# –†–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏ –≤ USD
position_value = position_size * entry_price

# –ú–∞—Ä–∂–∞ —Å —É—á–µ—Ç–æ–º –ø–ª–µ—á–∞
margin_required = position_value / leverage

# Maintenance margin (–¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏)
maintenance_margin = position_value * maintenance_margin_ratio

# Initial margin (—Ç—Ä–µ–±—É–µ–º–∞—è –º–∞—Ä–∂–∞)
initial_margin = position_value * initial_margin_ratio

# –ò—Å–ø–æ–ª—å–∑—É–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
margin = max(margin_required, initial_margin)
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `leverage: 5` - –ü–ª–µ—á–æ
- `maintenance_margin_ratio: 0.01` - 1% maintenance margin
- `initial_margin_ratio: 0.20` - 20% initial margin (–¥–ª—è 5x –ø–ª–µ—á–∞)

### –†–∞—Å—á–µ—Ç PnL

**–î–ª—è LONG –ø–æ–∑–∏—Ü–∏–∏:**
```python
# –í–∞–ª–æ–≤–∞—è –ø—Ä–∏–±—ã–ª—å
gross_pnl = (exit_price - entry_price) * size

# –ö–æ–º–∏—Å—Å–∏–∏
entry_fee = entry_price * size * fee_rate
exit_fee = exit_price * size * fee_rate
total_fees = entry_fee + exit_fee

# –ß–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å
net_pnl = gross_pnl - total_fees

# PnL –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö
pnl_percent = net_pnl / (entry_price * size) * 100
```

**–î–ª—è SHORT –ø–æ–∑–∏—Ü–∏–∏:**
```python
# –í–∞–ª–æ–≤–∞—è –ø—Ä–∏–±—ã–ª—å
gross_pnl = (entry_price - exit_price) * size

# –ö–æ–º–∏—Å—Å–∏–∏ (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ)
total_fees = (entry_price + exit_price) * size * fee_rate

# –ß–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å
net_pnl = gross_pnl - total_fees

# PnL –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö
pnl_percent = net_pnl / (entry_price * size) * 100
```

### –†–∞—Å—á–µ—Ç Trailing Stop Loss

**–î–ª—è LONG:**
```python
# –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞
highest_price = max(highest_price, current_price)

# –ü—Ä–∏–±—ã–ª—å
profit_pct = (highest_price - entry_price) / entry_price

# –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –º–Ω–æ–∂–∏—Ç–µ–ª—å —Ç—Ä–µ–π–ª–∏–Ω–≥–∞
if profit_pct < 0.005:  # < 0.5%
    multiplier = 1.5
elif profit_pct < 0.015:  # 0.5-1.5%
    multiplier = 2.0
else:  # > 1.5%
    multiplier = 3.0

# –¢–µ–∫—É—â–∏–π —Ç—Ä–µ–π–ª–∏–Ω–≥
current_trail = initial_trail + profit_pct * multiplier
current_trail = min(current_trail, max_trail)
current_trail = max(current_trail, min_trail)

# –¶–µ–Ω–∞ —Å—Ç–æ–ø-–ª–æ—Å—Å–∞
trailing_sl_price = highest_price * (1 - current_trail)
```

**–î–ª—è SHORT:**
```python
# –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞
lowest_price = min(lowest_price, current_price)

# –ü—Ä–∏–±—ã–ª—å
profit_pct = (entry_price - lowest_price) / entry_price

# –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –º–Ω–æ–∂–∏—Ç–µ–ª—å (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ)

# –¶–µ–Ω–∞ —Å—Ç–æ–ø-–ª–æ—Å—Å–∞
trailing_sl_price = lowest_price * (1 + current_trail)
```

### –†–∞—Å—á–µ—Ç ATR (Average True Range)

**–§–æ—Ä–º—É–ª–∞:**
```python
# True Range –¥–ª—è –∫–∞–∂–¥–æ–π —Å–≤–µ—á–∏
true_range = max(
    high - low,  # –†–∞–∑–Ω–∏—Ü–∞ High –∏ Low
    abs(high - prev_close),  # –†–∞–∑–Ω–∏—Ü–∞ High –∏ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ Close
    abs(low - prev_close)  # –†–∞–∑–Ω–∏—Ü–∞ Low –∏ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ Close
)

# ATR = —Å—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ True Range –∑–∞ –ø–µ—Ä–∏–æ–¥
atr = sum(true_ranges[-period:]) / period

# ATR –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö –æ—Ç —Ü–µ–Ω—ã
atr_percent = atr / current_price
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `atr_period: 14` - –ü–µ—Ä–∏–æ–¥ —Ä–∞—Å—á–µ—Ç–∞ ATR

### –†–∞—Å—á–µ—Ç RSI (Relative Strength Index)

**–§–æ—Ä–º—É–ª–∞:**
```python
# –ò–∑–º–µ–Ω–µ–Ω–∏—è —Ü–µ–Ω—ã
deltas = [price[i] - price[i-1] for i in range(1, len(price))]

# –ü—Ä–∏–±—ã–ª–∏ –∏ —É–±—ã—Ç–∫–∏
gains = [delta if delta > 0 else 0 for delta in deltas]
losses = [-delta if delta < 0 else 0 for delta in deltas]

# –°—Ä–µ–¥–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è
avg_gain = sum(gains[-period:]) / period
avg_loss = sum(losses[-period:]) / period

# Relative Strength
rs = avg_gain / avg_loss if avg_loss > 0 else float('inf')

# RSI
rsi = 100 - (100 / (1 + rs))
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `rsi_period: 14` - –ü–µ—Ä–∏–æ–¥ —Ä–∞—Å—á–µ—Ç–∞ RSI
- `overbought: 70` - –£—Ä–æ–≤–µ–Ω—å –ø–µ—Ä–µ–∫—É–ø–ª–µ–Ω–Ω–æ—Å—Ç–∏
- `oversold: 30` - –£—Ä–æ–≤–µ–Ω—å –ø–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω–Ω–æ—Å—Ç–∏

---

## üåê –†–ê–ë–û–¢–ê –° –ë–ò–†–ñ–ï–ô OKX

### –¢–∏–ø —Ç–æ—Ä–≥–æ–≤–ª–∏

**Futures (USDT-Margined Perpetual Swaps):**
- –¢–∏–ø –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞: Perpetual Swap
- –í–∞–ª—é—Ç–∞ –º–∞—Ä–∂–∏: USDT
- –†–µ–∂–∏–º –º–∞—Ä–∂–∏: Isolated Margin (–∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –º–∞—Ä–∂–∞)
- –ü–ª–µ—á–æ: 5x (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è)

### API Endpoints

#### 1. –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä—ã–Ω–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

**–°–≤–µ—á–∏:**
```python
GET /api/v5/market/candles
{
    "instId": "BTC-USDT-SWAP",
    "bar": "5m",  # 5-–º–∏–Ω—É—Ç–Ω—ã–µ —Å–≤–µ—á–∏
    "limit": 50  # 50 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–≤–µ—á–µ–π
}
```

**–¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞:**
```python
GET /api/v5/market/ticker
{
    "instId": "BTC-USDT-SWAP"
}
```

**Order Book:**
```python
GET /api/v5/market/books
{
    "instId": "BTC-USDT-SWAP",
    "sz": 20  # –ì–ª—É–±–∏–Ω–∞ —Å—Ç–∞–∫–∞–Ω–∞
}
```

#### 2. –†–∞–∑–º–µ—â–µ–Ω–∏–µ –æ—Ä–¥–µ—Ä–æ–≤

**MARKET –æ—Ä–¥–µ—Ä:**
```python
POST /api/v5/trade/order
{
    "instId": "BTC-USDT-SWAP",
    "tdMode": "isolated",  # Isolated margin
    "side": "buy",  # –∏–ª–∏ "sell"
    "ordType": "market",
    "sz": "0.01",  # –†–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏
    "posSide": "long",  # –∏–ª–∏ "short"
    "lever": "5"  # –ü–ª–µ—á–æ
}
```

**LIMIT –æ—Ä–¥–µ—Ä:**
```python
POST /api/v5/trade/order
{
    "instId": "BTC-USDT-SWAP",
    "tdMode": "isolated",
    "side": "buy",
    "ordType": "limit",
    "sz": "0.01",
    "px": "50000.0",  # –¶–µ–Ω–∞
    "posSide": "long",
    "lever": "5"
}
```

#### 3. –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–π

```python
GET /api/v5/account/positions
{
    "instId": "BTC-USDT-SWAP"
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
    "data": [{
        "instId": "BTC-USDT-SWAP",
        "pos": "0.01",  # –†–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏
        "posSide": "long",  # –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
        "avgPx": "50000.0",  # –°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞ –≤—Ö–æ–¥–∞
        "markPx": "50100.0",  # –¢–µ–∫—É—â–∞—è –º–∞—Ä–∫–∏—Ä–æ–≤–æ—á–Ω–∞—è —Ü–µ–Ω–∞
        "upl": "1.0",  # –ù–µ—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π PnL
        "margin": "100.0",  # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω–∞—è –º–∞—Ä–∂–∞
        "liqPx": "45000.0"  # –õ–∏–∫–≤–∏–¥–∞—Ü–∏–æ–Ω–Ω–∞—è —Ü–µ–Ω–∞
    }]
}
```

#### 4. –ü–æ–ª—É—á–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞

```python
GET /api/v5/account/balance
{
    "ccy": "USDT"
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
    "data": [{
        "details": [{
            "ccy": "USDT",
            "eq": "1000.0",  # Equity (–±–∞–ª–∞–Ω—Å)
            "availEq": "900.0"  # –î–æ—Å—Ç—É–ø–Ω—ã–π –±–∞–ª–∞–Ω—Å
        }]
    }]
}
```

#### 5. –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–∏

```python
POST /api/v5/trade/order
{
    "instId": "BTC-USDT-SWAP",
    "tdMode": "isolated",
    "side": "sell",  # –ü—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω–∞—è —Å—Ç–æ—Ä–æ–Ω–∞
    "ordType": "market",
    "sz": "0.01",  # –†–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏ –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è
    "posSide": "long",
    "ccy": "USDT",
    "reduceOnly": true  # –¢–æ–ª—å–∫–æ –∑–∞–∫—Ä—ã—Ç–∏–µ
}
```

### WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

**–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Ç–∏–∫–µ—Ä—ã:**
```python
# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
ws = await websocket_connect("wss://ws.okx.com:8443/ws/v5/public")

# –ü–æ–¥–ø–∏—Å–∫–∞
subscribe = {
    "op": "subscribe",
    "args": [{
        "channel": "tickers",
        "instId": "BTC-USDT-SWAP"
    }]
}
await ws.send_json(subscribe)

# –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
while True:
    message = await ws.receive_json()
    if message.get("arg", {}).get("channel") == "tickers":
        ticker_data = message["data"][0]
        current_price = float(ticker_data["last"])
```

### –ö–æ–º–∏—Å—Å–∏–∏

**Maker –∫–æ–º–∏—Å—Å–∏—è (LIMIT –æ—Ä–¥–µ—Ä–∞):**
- 0.02% –æ—Ç –æ–±—ä–µ–º–∞ —Å–¥–µ–ª–∫–∏

**Taker –∫–æ–º–∏—Å—Å–∏—è (MARKET –æ—Ä–¥–µ—Ä–∞):**
- 0.05% –æ—Ç –æ–±—ä–µ–º–∞ —Å–¥–µ–ª–∫–∏

**–†–∞—Å—á–µ—Ç –∫–æ–º–∏—Å—Å–∏–π:**
```python
# –î–ª—è LIMIT –æ—Ä–¥–µ—Ä–∞ (maker)
entry_fee = entry_price * size * 0.0002  # 0.02%
exit_fee = exit_price * size * 0.0002   # 0.02%
total_fees = entry_fee + exit_fee

# –î–ª—è MARKET –æ—Ä–¥–µ—Ä–∞ (taker)
entry_fee = entry_price * size * 0.0005  # 0.05%
exit_fee = exit_price * size * 0.0005   # 0.05%
total_fees = entry_fee + exit_fee
```

---

## üéØ –ê–î–ê–ü–¢–ò–í–ù–´–ï –°–ò–°–¢–ï–ú–´

### ARM (Adaptive Regime Manager)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä–µ–∂–∏–º —Ä—ã–Ω–∫–∞ –∏ –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ç–æ—Ä–≥–æ–≤–ª–∏.

#### –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞

**TRENDING (–¢—Ä–µ–Ω–¥–æ–≤—ã–π):**
```python
# –£—Å–ª–æ–≤–∏—è:
# - ADX > 25
# - –ß–µ—Ç–∫–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (+DI –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –±–æ–ª—å—à–µ -DI)
# - –ù–∏–∑–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å —Ä–∞–∑–≤–æ—Ä–æ—Ç–æ–≤

if adx > 25 and di_plus > di_minus + 1.5 and reversals < 3:
    regime = "TRENDING"
```

**RANGING (–ë–æ–∫–æ–≤–æ–π):**
```python
# –£—Å–ª–æ–≤–∏—è:
# - ADX < 20
# - –ë–æ–∫–æ–≤–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ (—Ü–µ–Ω–∞ –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ)
# - –ù–∏–∑–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å

if adx < 20 and range_width < price * 0.02 and volatility < 0.01:
    regime = "RANGING"
```

**CHOPPY (–•–∞–æ—Ç–∏—á–Ω—ã–π):**
```python
# –£—Å–ª–æ–≤–∏—è:
# - ADX > 25
# - –í—ã—Å–æ–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å
# - –ú–Ω–æ–≥–æ —Ä–∞–∑–≤–æ—Ä–æ—Ç–æ–≤

if adx > 25 and volatility > 0.03 and reversals > 5:
    regime = "CHOPPY"
```

#### –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ —Ä–µ–∂–∏–º—É

**TRENDING:**
```python
tp_percent = 2.4%  # 1.2x ATR
sl_percent = 1.2%  # 0.8x ATR
score_threshold = 6/12  # 50%
max_holding_time = 45 –º–∏–Ω—É—Ç
partial_tp_fraction = 0.5  # 50%
partial_tp_trigger = 0.5%
```

**RANGING:**
```python
tp_percent = 1.8%  # 0.6x ATR
sl_percent = 0.8%  # 0.4x ATR
score_threshold = 4/12  # 33%
max_holding_time = 12 –º–∏–Ω—É—Ç
partial_tp_fraction = 0.6  # 60%
partial_tp_trigger = 0.6%
```

**CHOPPY:**
```python
tp_percent = 2.0%  # 0.8x ATR
sl_percent = 1.5%  # 1.2x ATR
score_threshold = 7/12  # 58%
max_holding_time = 30 –º–∏–Ω—É—Ç
partial_tp_fraction = 0.7  # 70%
partial_tp_trigger = 0.3%
```

### Adaptive Balance Manager

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ê–¥–∞–ø—Ç–∏—Ä—É–µ—Ç —Ä–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–π –ø–æ–¥ –±–∞–ª–∞–Ω—Å —Å—á–µ—Ç–∞.

**–ü—Ä–æ—Ñ–∏–ª–∏ –±–∞–ª–∞–Ω—Å–∞:**
- SMALL (< $1,500): –ë–∞–∑–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä $50
- MEDIUM ($1,500 - $3,500): –ë–∞–∑–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä $100
- LARGE (> $3,500): –ë–∞–∑–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä $200

**–ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –Ω–∞ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å:**
- –ù–∏–∑–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å: √ó0.5
- –ù–æ—Ä–º–∞–ª—å–Ω–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å: √ó1.0
- –í—ã—Å–æ–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å: √ó1.5

---

## ‚ö° –ê–î–ê–ü–¢–ò–í–ù–û–ï –ü–õ–ï–ß–û (ADAPTIVE LEVERAGE)

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ –ø–ª–µ—á–æ (3-30x) –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–∞—á–µ—Å—Ç–≤–∞ —Å–∏–≥–Ω–∞–ª–∞, —Ä–µ–∂–∏–º–∞ —Ä—ã–Ω–∫–∞ –∏ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏.

### –õ–æ–≥–∏–∫–∞ —Ä–∞—Å—á–µ—Ç–∞

**–ë–∞–∑–æ–≤–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–∏–ª—ã —Å–∏–≥–Ω–∞–ª–∞:**
```python
# –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∫–∞—á–µ—Å—Ç–≤–∞ —Å–∏–≥–Ω–∞–ª–∞:
very_weak (0.0-0.3)   ‚Üí 3x  –ø–ª–µ—á–æ
weak (0.3-0.5)        ‚Üí 5x  –ø–ª–µ—á–æ
medium (0.5-0.7)      ‚Üí 10x –ø–ª–µ—á–æ
strong (0.7-0.9)      ‚Üí 20x –ø–ª–µ—á–æ
very_strong (0.9-1.0)  ‚Üí 30x –ø–ª–µ—á–æ
```

**–ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –Ω–∞ —Ä–µ–∂–∏–º —Ä—ã–Ω–∫–∞:**
```python
# –ú–Ω–æ–∂–∏—Ç–µ–ª—å —Ä–µ–∂–∏–º–∞:
if regime == "trending":
    regime_multiplier = 1.2  # +20% –∫ –ø–ª–µ—á—É –≤ —Ç—Ä–µ–Ω–¥–µ
elif regime == "choppy":
    regime_multiplier = 0.8  # -20% –∫ –ø–ª–µ—á—É –≤ —Ö–∞–æ—Å–µ
else:  # ranging
    regime_multiplier = 1.0  # –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
```

**–ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –Ω–∞ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å:**
```python
# –ú–Ω–æ–∂–∏—Ç–µ–ª—å –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏:
if volatility > 0.05:  # –í—ã—Å–æ–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å (>5%)
    volatility_multiplier = 0.7  # –£–º–µ–Ω—å—à–∞–µ–º –ø–ª–µ—á–æ –Ω–∞ 30%
elif volatility < 0.01:  # –ù–∏–∑–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å (<1%)
    volatility_multiplier = 1.3  # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –ø–ª–µ—á–æ –Ω–∞ 30%
else:
    volatility_multiplier = 1.0  # –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
```

**–§–∏–Ω–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç:**
```python
# –ü—Ä–∏–º–µ–Ω—è–µ–º –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏:
adjusted_strength = signal_strength * regime_multiplier * volatility_multiplier
adjusted_strength = max(0.0, min(1.0, adjusted_strength))  # –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º 0-1

# –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∏ –ø–æ–ª—É—á–∞–µ–º –ø–ª–µ—á–æ:
leverage = leverage_map[category]

# –û–∫—Ä—É–≥–ª—è–µ–º –¥–æ –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –Ω–∞ –±–∏—Ä–∂–µ (3, 5, 10, 20, 30):
leverage = round_to_available_leverage(leverage, symbol)
```

### –ü—Ä–∏–º–µ—Ä—ã

**–°–∏–ª—å–Ω—ã–π —Å–∏–≥–Ω–∞–ª –≤ —Ç—Ä–µ–Ω–¥–µ:**
- –°–∏–ª–∞ —Å–∏–≥–Ω–∞–ª–∞: 0.85
- –†–µ–∂–∏–º: trending (√ó1.2)
- –í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å: –Ω–æ—Ä–º–∞–ª—å–Ω–∞—è (√ó1.0)
- –ò—Ç–æ–≥: 0.85 √ó 1.2 = 1.02 ‚Üí very_strong ‚Üí **30x**

**–°–ª–∞–±—ã–π —Å–∏–≥–Ω–∞–ª –≤ —Ö–∞–æ—Å–µ:**
- –°–∏–ª–∞ —Å–∏–≥–Ω–∞–ª–∞: 0.4
- –†–µ–∂–∏–º: choppy (√ó0.8)
- –í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å: –≤—ã—Å–æ–∫–∞—è (√ó0.7)
- –ò—Ç–æ–≥: 0.4 √ó 0.8 √ó 0.7 = 0.224 ‚Üí very_weak ‚Üí **3x**

---

## üìä –õ–ï–°–¢–ù–ò–ß–ù–´–ô –í–•–û–î (LADDER ENTRY / POSITION SCALING)

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏–π —Å —É–º–µ–Ω—å—à–∞—é—â–∏–º—Å—è —Ä–∞–∑–º–µ—Ä–æ–º (–ª–µ—Å—Ç–Ω–∏—Ü–∞).

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:**
```python
{
    "max_additions": 7,              # –ú–∞–∫—Å–∏–º—É–º 7 –¥–æ–±–∞–≤–ª–µ–Ω–∏–π
    "min_interval_seconds": 30,      # –ú–∏–Ω–∏–º—É–º 30 —Å–µ–∫—É–Ω–¥ –º–µ–∂–¥—É –¥–æ–±–∞–≤–ª–µ–Ω–∏—è–º–∏
    "max_loss_for_addition": -3.0,   # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —É–±—ã—Ç–æ–∫ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è: -3%
    "ladder": [1.0, 0.8, 0.6, 0.4, 0.3, 0.2, 0.15]  # –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –ª–µ—Å—Ç–Ω–∏—Ü—ã
}
```

**–õ–µ—Å—Ç–Ω–∏—Ü–∞:**
- 1-–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ: 100% –æ—Ç –±–∞–∑–æ–≤–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞
- 2-–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ: 80% –æ—Ç –±–∞–∑–æ–≤–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞
- 3-–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ: 60% –æ—Ç –±–∞–∑–æ–≤–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞
- 4-–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ: 40% –æ—Ç –±–∞–∑–æ–≤–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞
- 5-–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ: 30% –æ—Ç –±–∞–∑–æ–≤–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞
- 6-–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ: 20% –æ—Ç –±–∞–∑–æ–≤–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞
- 7-–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ: 15% –æ—Ç –±–∞–∑–æ–≤–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞

### –£—Å–ª–æ–≤–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è

**–ü—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º:**
```python
# 1. –ù–µ –ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∏–π
if addition_count >= max_additions:
    return False

# 2. –ü—Ä–æ—à–ª–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤—Ä–µ–º–µ–Ω–∏ —Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
if time_since_last_addition < min_interval_seconds:
    return False

# 3. –£–±—ã—Ç–æ–∫ –Ω–µ –ø—Ä–µ–≤—ã—à–∞–µ—Ç –ª–∏–º–∏—Ç
if pnl_percent <= max_loss_for_addition:
    return False

# 4. –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–∞–ª–∞–Ω—Å–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
if available_balance < addition_size:
    return False
```

### –†–∞—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è

```python
# –ü–æ–ª—É—á–∞–µ–º –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –∏–∑ –ª–µ—Å—Ç–Ω–∏—Ü—ã:
addition_count = len(scaling_history)  # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–Ω—ã—Ö –¥–æ–±–∞–≤–ª–µ–Ω–∏–π

if addition_count >= len(ladder):
    ladder_coefficient = ladder[-1]  # –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç
else:
    ladder_coefficient = ladder[addition_count]  # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π

# –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä –¥–æ–±–∞–≤–ª–µ–Ω–∏—è:
addition_size_usd = base_size_usd * ladder_coefficient

# –ü—Ä–∏–º–µ–Ω—è–µ–º –≤–∞–ª–∏–¥–∞—Ü–∏—é:
addition_size_usd = min(addition_size_usd, max_addition_size)
addition_size_usd = max(addition_size_usd, min_addition_size)
```

### –ò—Å—Ç–æ—Ä–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏–π

–ö–∞–∂–¥–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ `PositionMetadata.scaling_history`:
```python
scaling_history = [
    {
        "timestamp": "2025-12-21T10:00:00",
        "size_usd": 100.0,
        "leverage": 10,
        "price": 50000.0,
        "addition_number": 1
    },
    {
        "timestamp": "2025-12-21T10:00:30",
        "size_usd": 80.0,  # 80% –æ—Ç –±–∞–∑–æ–≤–æ–≥–æ
        "leverage": 10,
        "price": 49950.0,
        "addition_number": 2
    },
    # ...
]
```

### –£—Å—Ä–µ–¥–Ω–µ–Ω–∏–µ —Ü–µ–Ω—ã –≤—Ö–æ–¥–∞

–ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∫ –ø–æ–∑–∏—Ü–∏–∏ —Ü–µ–Ω–∞ –≤—Ö–æ–¥–∞ —É—Å—Ä–µ–¥–Ω—è–µ—Ç—Å—è:
```python
# –¢–µ–∫—É—â–∞—è –ø–æ–∑–∏—Ü–∏—è:
entry_price = 50000.0
size = 0.01

# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ:
addition_price = 49950.0
addition_size = 0.008  # 80% –æ—Ç –±–∞–∑–æ–≤–æ–≥–æ

# –ù–æ–≤–∞—è —É—Å—Ä–µ–¥–Ω–µ–Ω–Ω–∞—è —Ü–µ–Ω–∞:
total_size = size + addition_size
weighted_price = (entry_price * size + addition_price * addition_size) / total_size
# weighted_price = (50000 * 0.01 + 49950 * 0.008) / 0.018 = 49977.78
```

---

## üß† EXIT ANALYZER - –£–ú–ù–û–ï –ó–ê–ö–†–´–¢–ò–ï –ü–û–ó–ò–¶–ò–ô

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–∏–µ–º –ø–æ–∑–∏—Ü–∏–π —Å –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–π –ª–æ–≥–∏–∫–æ–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ–∂–∏–º–∞ —Ä—ã–Ω–∫–∞.

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

**–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- `ExitAnalyzer` - –≥–ª–∞–≤–Ω—ã–π –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä
- `_generate_exit_for_trending()` - –ª–æ–≥–∏–∫–∞ –¥–ª—è —Ç—Ä–µ–Ω–¥–æ–≤–æ–≥–æ —Ä–µ–∂–∏–º–∞
- `_generate_exit_for_ranging()` - –ª–æ–≥–∏–∫–∞ –¥–ª—è –±–æ–∫–æ–≤–æ–≥–æ —Ä–µ–∂–∏–º–∞
- `_generate_exit_for_choppy()` - –ª–æ–≥–∏–∫–∞ –¥–ª—è —Ö–∞–æ—Ç–∏—á–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞

### –õ–æ–≥–∏–∫–∞ –¥–ª—è RANGING —Ä–µ–∂–∏–º–∞

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫:**
1. **Stop Loss** - –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ SL
2. **Partial Take Profit** - —á–∞—Å—Ç–∏—á–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ trigger_percent
3. **Take Profit** - –ø–æ–ª–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ TP
4. **Time Stop** - –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–º—É –≤—Ä–µ–º–µ–Ω–∏ —É–¥–µ—Ä–∂–∞–Ω–∏—è
5. **Big Profit Exit** - –∑–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏ –±–æ–ª—å—à–æ–π –ø—Ä–∏–±—ã–ª–∏ (>2x TP)

**Partial Take Profit:**
```python
# –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞:
if pnl_percent >= trigger_percent:  # –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é 1.0%
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ —É–¥–µ—Ä–∂–∞–Ω–∏—è (–∞–¥–∞–ø—Ç–∏–≤–Ω–∞—è)
    if can_partial_close:  # –ü—Ä–æ—à–ª–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤—Ä–µ–º–µ–Ω–∏
        # –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –¥–æ–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è:
        if pnl_percent < 1.0%:
            fraction = 0.4  # 40% –ø–æ–∑–∏—Ü–∏–∏
        elif pnl_percent >= 2.0%:
            fraction = 0.8  # 80% –ø–æ–∑–∏—Ü–∏–∏
        else:
            fraction = 0.6  # 60% –ø–æ–∑–∏—Ü–∏–∏ (—Å—Ç–∞–Ω–¥–∞—Ä—Ç)
        
        await close_position_partial(symbol, fraction, reason="partial_tp")
```

**–ê–¥–∞–ø—Ç–∏–≤–Ω–æ–µ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è —É–¥–µ—Ä–∂–∞–Ω–∏—è:**
```python
# –î–ª—è partial_tp —Ç—Ä–µ–±—É–µ—Ç—Å—è –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è —É–¥–µ—Ä–∂–∞–Ω–∏—è:
# - –ï—Å–ª–∏ –ø—Ä–∏–±—ã–ª—å < 0.5%: min_holding = 30 —Å–µ–∫—É–Ω–¥
# - –ï—Å–ª–∏ –ø—Ä–∏–±—ã–ª—å 0.5-1.0%: min_holding = 60 —Å–µ–∫—É–Ω–¥
# - –ï—Å–ª–∏ –ø—Ä–∏–±—ã–ª—å > 1.0%: min_holding = 90 —Å–µ–∫—É–Ω–¥

# –≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–µ–∂–¥–µ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ
```

### –õ–æ–≥–∏–∫–∞ –¥–ª—è TRENDING —Ä–µ–∂–∏–º–∞

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ü—Ä–æ–¥–ª–µ–Ω–∏–µ TP –ø—Ä–∏ —Å–∏–ª—å–Ω–æ–º —Ç—Ä–µ–Ω–¥–µ
- –ë–æ–ª–µ–µ —à–∏—Ä–æ–∫–∏–π trailing stop
- –î–æ–ª—å—à–µ —É–¥–µ—Ä–∂–∞–Ω–∏–µ –ø—Ä–∏–±—ã–ª—å–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π

**–ü—Ä–æ–¥–ª–µ–Ω–∏–µ TP:**
```python
# –ï—Å–ª–∏ –ø—Ä–∏–±—ã–ª—å –¥–æ—Å—Ç–∏–≥–ª–∞ TP, –Ω–æ —Ç—Ä–µ–Ω–¥ —Å–∏–ª—å–Ω—ã–π:
if pnl_percent >= tp_percent:
    if adx > 30 and trend_strength > 0.7:
        # –ü—Ä–æ–¥–ª–µ–≤–∞–µ–º TP –Ω–∞ 50%
        extended_tp = tp_percent * 1.5
        tp_extension_count += 1
        # –ú–∞–∫—Å–∏–º—É–º 2 –ø—Ä–æ–¥–ª–µ–Ω–∏—è
        if tp_extension_count < 2:
            return {"action": "extend_tp", "new_tp": extended_tp}
```

### –õ–æ–≥–∏–∫–∞ –¥–ª—è CHOPPY —Ä–µ–∂–∏–º–∞

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ë–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ
- –ó–∞—â–∏—Ç–∞ –æ—Ç —Ä–∞–∑–≤–æ—Ä–æ—Ç–æ–≤
- –ë—ã—Å—Ç—Ä–∞—è —Ñ–∏–∫—Å–∞—Ü–∏—è –ø—Ä–∏–±—ã–ª–∏

---

## üìã POSITION REGISTRY - –†–ï–ï–°–¢–† –ü–û–ó–ò–¶–ò–ô

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã –¥–ª—è –≤—Å–µ—Ö –ø–æ–∑–∏—Ü–∏–π –≤ —Å–∏—Å—Ç–µ–º–µ. –•—Ä–∞–Ω–∏—Ç position –¥–∞–Ω–Ω—ã–µ + –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ.

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ PositionMetadata

```python
@dataclass
class PositionMetadata:
    entry_time: datetime                    # –í—Ä–µ–º—è –≤—Ö–æ–¥–∞
    position_id: Optional[str]               # –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –ø–æ–∑–∏—Ü–∏–∏
    regime: Optional[str]                    # –†–µ–∂–∏–º –ø—Ä–∏ –≤—Ö–æ–¥–µ (trending/ranging/choppy)
    balance_profile: Optional[str]          # –ü—Ä–æ—Ñ–∏–ª—å –±–∞–ª–∞–Ω—Å–∞ (small/medium/large)
    entry_price: Optional[float]            # –¶–µ–Ω–∞ –≤—Ö–æ–¥–∞
    position_side: Optional[str]            # –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (long/short)
    order_id: Optional[str]                 # ID –æ—Ä–¥–µ—Ä–∞ –≤—Ö–æ–¥–∞
    tp_percent: Optional[float]              # Take Profit –≤ %
    sl_percent: Optional[float]             # Stop Loss –≤ %
    leverage: Optional[int]                  # –ü–ª–µ—á–æ (3-30x)
    size_in_coins: Optional[float]          # –†–∞–∑–º–µ—Ä –≤ –º–æ–Ω–µ—Ç–∞—Ö
    margin_used: Optional[float]            # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω–∞—è –º–∞—Ä–∂–∞
    min_holding_seconds: Optional[float]   # –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è —É–¥–µ—Ä–∂–∞–Ω–∏—è
    created_at: datetime                    # –í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏
    
    # –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–∏–±—ã–ª–∏:
    peak_profit_usd: float = 0.0           # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–∏–±—ã–ª—å –≤ USD
    peak_profit_time: Optional[datetime]    # –í—Ä–µ–º—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –º–∞–∫—Å–∏–º—É–º–∞
    peak_profit_price: Optional[float]      # –¶–µ–Ω–∞ –ø—Ä–∏ –º–∞–∫—Å–∏–º—É–º–µ
    
    # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ TP:
    tp_extension_count: int = 0             # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–¥–ª–µ–Ω–∏–π TP
    partial_tp_executed: bool = False      # –§–ª–∞–≥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è partial_tp
    
    # –ò—Å—Ç–æ—Ä–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏–π (–ª–µ—Å—Ç–Ω–∏—á–Ω—ã–π –≤—Ö–æ–¥):
    scaling_history: Optional[List[Dict]]   # –ò—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö –¥–æ–±–∞–≤–ª–µ–Ω–∏–π
```

### –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã

**–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–∑–∏—Ü–∏–∏:**
```python
await position_registry.register_position(
    symbol="BTC-USDT",
    position={
        "instId": "BTC-USDT-SWAP",
        "posSide": "long",
        "pos": "0.01",
        "avgPx": "50000.0",
        "margin": "100.0"
    },
    metadata=PositionMetadata(
        entry_time=datetime.now(timezone.utc),
        regime="trending",
        balance_profile="medium",
        entry_price=50000.0,
        position_side="long",
        leverage=10,
        size_in_coins=0.01,
        margin_used=100.0
    )
)
```

**–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö:**
```python
await position_registry.update_position(
    symbol="BTC-USDT",
    position_side="long",
    updates={
        "peak_profit_usd": 50.0,
        "peak_profit_time": datetime.now(timezone.utc),
        "partial_tp_executed": True
    }
)
```

**–ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏:**
```python
position, metadata = await position_registry.get_position("BTC-USDT", "long")
```

---

## üîÑ POSITION SYNC - –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø –° –ë–ò–†–ñ–ï–ô

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –ø–æ–∑–∏—Ü–∏—è–º–∏ –Ω–∞ –±–∏—Ä–∂–µ. –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è "drift" –ø–æ–∑–∏—Ü–∏–π.

### –ü—Ä–æ—Ü–µ—Å—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

**–®–∞–≥ 1: –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–π —Å –±–∏—Ä–∂–∏**
```python
exchange_positions = await client.get_positions()
# –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π –Ω–∞ –±–∏—Ä–∂–µ
```

**–®–∞–≥ 2: –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –ª–æ–∫–∞–ª—å–Ω—ã–º —Ä–µ–µ—Å—Ç—Ä–æ–º**
```python
for exchange_pos in exchange_positions:
    symbol = exchange_pos["instId"].replace("-SWAP", "")
    pos_side = exchange_pos["posSide"]
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º —Ä–µ–µ—Å—Ç—Ä–µ:
    local_pos = await position_registry.get_position(symbol, pos_side)
    
    if not local_pos:
        # DRIFT_ADD: –ü–æ–∑–∏—Ü–∏—è –Ω–∞ –±–∏—Ä–∂–µ, –Ω–æ –Ω–µ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º —Ä–µ–µ—Å—Ç—Ä–µ
        await register_drift_position(exchange_pos)
    elif local_pos["pos"] == "0":
        # DRIFT_REMOVE: –ü–æ–∑–∏—Ü–∏—è –≤ —Ä–µ–µ—Å—Ç—Ä–µ, –Ω–æ –∑–∞–∫—Ä—ã—Ç–∞ –Ω–∞ –±–∏—Ä–∂–µ
        await remove_drift_position(symbol, pos_side)
```

**–®–∞–≥ 3: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è drift –ø–æ–∑–∏—Ü–∏–π**
```python
async def register_drift_position(exchange_pos):
    # –°–æ–∑–¥–∞–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –¥–ª—è drift –ø–æ–∑–∏—Ü–∏–∏:
    metadata = PositionMetadata(
        entry_time=datetime.now(timezone.utc),
        regime="drift_add",  # –£–∫–∞–∑—ã–≤–∞–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫
        balance_profile=get_balance_profile(),
        entry_price=float(exchange_pos["avgPx"]),
        position_side=exchange_pos["posSide"],
        size_in_coins=float(exchange_pos["pos"]),
        margin_used=float(exchange_pos["margin"]),
        leverage=int(exchange_pos["lever"])
    )
    
    # –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –≤ PositionRegistry:
    await position_registry.register_position(
        symbol=symbol,
        position=exchange_pos,
        metadata=metadata
    )
```

### –¢–∏–ø—ã drift

**DRIFT_ADD:**
- –ü–æ–∑–∏—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –Ω–∞ –±–∏—Ä–∂–µ, –Ω–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º —Ä–µ–µ—Å—Ç—Ä–µ
- –ü—Ä–∏—á–∏–Ω—ã: –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞, —Ä—É—á–Ω–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ, –æ—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- –î–µ–π—Å—Ç–≤–∏–µ: —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ PositionRegistry —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏

**DRIFT_REMOVE:**
- –ü–æ–∑–∏—Ü–∏—è –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º —Ä–µ–µ—Å—Ç—Ä–µ, –Ω–æ –∑–∞–∫—Ä—ã—Ç–∞ –Ω–∞ –±–∏—Ä–∂–µ
- –ü—Ä–∏—á–∏–Ω—ã: –ª–∏–∫–≤–∏–¥–∞—Ü–∏—è, —Ä—É—á–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ, –æ—à–∏–±–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- –î–µ–π—Å—Ç–≤–∏–µ: —É–¥–∞–ª–µ–Ω–∏–µ –∏–∑ PositionRegistry

---

## üéØ –ê–î–ê–ü–¢–ò–í–ù–ê–Ø –°–ò–°–¢–ï–ú–ê –§–ò–õ–¨–¢–†–û–í V2

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞–¥–∞–ø—Ç–∏–≤–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Ñ–∏–ª—å—Ç—Ä–æ–≤, –∫–æ—Ç–æ—Ä–∞—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –ø–æ–¥—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–¥ —Ç–µ–∫—É—â–∏–µ —Ä—ã–Ω–æ—á–Ω—ã–µ —É—Å–ª–æ–≤–∏—è.

**–§–∞–π–ª:** `src/strategies/scalping/futures/adaptivity/filter_parameters.py`

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

**–ö–ª–∞—Å—Å:** `AdaptiveFilterParameters`

**–§–∞–∫—Ç–æ—Ä—ã –∞–¥–∞–ø—Ç–∞—Ü–∏–∏:**
1. **–†–µ–∂–∏–º —Ä—ã–Ω–∫–∞** (trending/ranging/choppy) - 50% –≤–ª–∏—è–Ω–∏—è
2. **–í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å** (ATR) - 30% –≤–ª–∏—è–Ω–∏—è
3. **Win Rate** (–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å) - 20% –≤–ª–∏—è–Ω–∏—è

### –§–æ—Ä–º—É–ª–∞ –∞–¥–∞–ø—Ç–∞—Ü–∏–∏

**–í–∑–≤–µ—à–µ–Ω–Ω–æ–µ —Å—É–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```python
final_value = base * (1 + 0.5*regime_factor + 0.3*volatility_factor + 0.2*winrate_factor)
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –õ–∏–Ω–µ–π–Ω–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å (–ø—Ä–æ—â–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)
- –ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ
- –ú–µ–Ω—å—à–µ —Ä–∏—Å–∫–∞ –ø–µ—Ä–µ–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

**1. Reversal Threshold (–ø–æ—Ä–æ–≥ V-–æ–±—Ä–∞–∑–Ω–æ–≥–æ —Ä–∞–∑–≤–æ—Ä–æ—Ç–∞):**
- –ë–∞–∑–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: 0.15%
- –î–∏–∞–ø–∞–∑–æ–Ω: 0.05% - 0.5%
- –ê–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –ø–æ–¥ —Ä–µ–∂–∏–º –∏ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å

**2. ADX Threshold:**
- –ë–∞–∑–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: 20.0
- –î–∏–∞–ø–∞–∑–æ–Ω: 15.0 - 30.0
- –ê–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –ø–æ–¥ —Ä–µ–∂–∏–º –∏ win rate

**3. Correlation Threshold:**
- –ë–∞–∑–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: 0.7
- –î–∏–∞–ø–∞–∑–æ–Ω: 0.5 - 0.9
- –ê–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –ø–æ–¥ —Ä–µ–∂–∏–º –∏ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —á—Ç–µ–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

1. **per-symbol per-regime** (symbol_profiles[symbol][regime])
2. **per-regime** (adaptive_regime[regime])
3. **global** (scalping_config)
4. **fallback** (–∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ)

### –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

- **TTL:** 60 —Å–µ–∫—É–Ω–¥
- **–ö–ª—é—á –∫—ç—à–∞:** `{parameter}_{symbol}_{regime}`
- **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:** –°–Ω–∏–∂–∞–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ —Å–∏—Å—Ç–µ–º—É

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

**SignalGenerator:**
```python
# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
self.adaptive_filter_params = AdaptiveFilterParameters(
    config_manager=self.config_manager,
    regime_manager=self.regime_manager,
    data_registry=self.data_registry,
    trading_statistics=self.trading_statistics
)

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
reversal_threshold = self.adaptive_filter_params.get_reversal_threshold(
    symbol=symbol,
    regime=regime_name_ma
)
```

---

## üéõÔ∏è TRADING CONTROL CENTER

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä —Ç–æ—Ä–≥–æ–≤–æ–π –ª–æ–≥–∏–∫–∏, —É–ø—Ä–∞–≤–ª—è—é—â–∏–π –≥–ª–∞–≤–Ω—ã–º —Ü–∏–∫–ª–æ–º —Ç–æ—Ä–≥–æ–≤–ª–∏.

**–§–∞–π–ª:** `src/strategies/scalping/futures/core/trading_control_center.py`

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

**1. –ì–ª–∞–≤–Ω—ã–π —Ç–æ—Ä–≥–æ–≤—ã–π —Ü–∏–∫–ª:**
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö —Å–∏–º–≤–æ–ª–æ–≤
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏—è–º–∏
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–∏—Å–∫–æ–≤

**2. –ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è –º–æ–¥—É–ª–µ–π:**
- SignalGenerator - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤
- SignalCoordinator - –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤
- PositionManager - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏—è–º–∏
- OrderCoordinator - –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Ä–¥–µ—Ä–æ–≤
- TrailingSLCoordinator - —Ç—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å

**3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:**
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ —Ü–∏–∫–ª–æ–≤
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ç—Ä–∏–∫

### –¶–∏–∫–ª —Ä–∞–±–æ—Ç—ã

```python
while active:
    for symbol in symbols:
        # 1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä—ã–Ω–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        await _update_market_data(symbol)
        
        # 2. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤
        signal = await signal_generator.generate_signal(symbol)
        
        # 3. –ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤
        if signal:
            await signal_coordinator.process_signal(signal)
        
        # 4. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏—è–º–∏
        await position_manager.manage_positions()
        
        # 5. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å
        await trailing_sl_coordinator.update_all()
```

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- **–¶–µ–ª–µ–≤–æ–µ –≤—Ä–µ–º—è —Ü–∏–∫–ª–∞:** < 5 —Å–µ–∫—É–Ω–¥
- **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:** –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö, –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:** –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞

---

## üìù –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

–≠—Ç–æ—Ç —Ç–æ—Ä–≥–æ–≤—ã–π –±–æ—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π —Å–ª–æ–∂–Ω—É—é —Å–∏—Å—Ç–µ–º—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Ç–æ—Ä–≥–æ–≤–ª–∏ –Ω–∞ —Ñ—å—é—á–µ—Ä—Å–∞—Ö OKX —Å –º–Ω–æ–∂–µ—Å—Ç–≤–æ–º –∞–¥–∞–ø—Ç–∏–≤–Ω—ã—Ö –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤, —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∏ –∑–∞—â–∏—Ç. –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ä–µ–∂–∏–º–µ **Futures (USDT-Margined Perpetual Swaps)** —Å –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –º–∞—Ä–∂–æ–π –∏ **–∞–¥–∞–ø—Ç–∏–≤–Ω—ã–º –ø–ª–µ—á–æ–º 3-30x**.

**–ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- ‚úÖ –ê–¥–∞–ø—Ç–∏–≤–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ (ARM)
- ‚úÖ **–ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤ V2** - —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
- ‚úÖ **–ê–¥–∞–ø—Ç–∏–≤–Ω–æ–µ –ø–ª–µ—á–æ 3-30x** –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–∞—á–µ—Å—Ç–≤–∞ —Å–∏–≥–Ω–∞–ª–∞
- ‚úÖ **–õ–µ—Å—Ç–Ω–∏—á–Ω—ã–π –≤—Ö–æ–¥** - –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–π
- ‚úÖ **Exit Analyzer** - —É–º–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–π —Å –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–π –ª–æ–≥–∏–∫–æ–π
- ‚úÖ **Position Registry** - –µ–¥–∏–Ω—ã–π —Ä–µ–µ—Å—Ç—Ä —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏
- ‚úÖ **Position Sync** - —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –±–∏—Ä–∂–µ–π
- ‚úÖ **Trading Control Center** - —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä —Ç–æ—Ä–≥–æ–≤–ª–∏
- ‚úÖ 10+ —Ç–∏–ø–æ–≤ —Ñ–∏–ª—å—Ç—Ä–æ–≤ —Å–∏–≥–Ω–∞–ª–æ–≤
- ‚úÖ 17+ —Å–∏—Å—Ç–µ–º –∑–∞—â–∏—Ç—ã –æ—Ç —Ä–∏—Å–∫–æ–≤
- ‚úÖ Trailing Stop Loss —Å –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–º —Ç—Ä–µ–π–ª–∏–Ω–≥–æ–º
- ‚úÖ Partial Take Profit –¥–ª—è —Ñ–∏–∫—Å–∞—Ü–∏–∏ –ø—Ä–∏–±—ã–ª–∏
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å OKX REST API –∏ WebSocket
- ‚úÖ –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

**–ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (–¥–µ–∫–∞–±—Ä—å 2025):**
- ‚úÖ **–ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤ V2** (23 –¥–µ–∫–∞–±—Ä—è) - —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
- ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á—Ç–µ–Ω–∏—è SL –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞** (23 –¥–µ–∫–∞–±—Ä—è) - –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —á—Ç–µ–Ω–∏–µ –∏–∑ adaptive_regime
- ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ datetime –æ—à–∏–±–æ–∫** (23 –¥–µ–∫–∞–±—Ä—è) - timezone-aware –æ–ø–µ—Ä–∞—Ü–∏–∏
- ‚úÖ –ê–¥–∞–ø—Ç–∏–≤–Ω–æ–µ –ø–ª–µ—á–æ (3-30x) –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–∏–ª—ã —Å–∏–≥–Ω–∞–ª–∞
- ‚úÖ –õ–µ—Å—Ç–Ω–∏—á–Ω—ã–π –≤—Ö–æ–¥ —Å —É–º–µ–Ω—å—à–∞—é—â–∏–º—Å—è —Ä–∞–∑–º–µ—Ä–æ–º –¥–æ–±–∞–≤–ª–µ–Ω–∏–π
- ‚úÖ Exit Analyzer —Å —Ä–µ–∂–∏–º-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ–π –ª–æ–≥–∏–∫–æ–π –∑–∞–∫—Ä—ã—Ç–∏—è
- ‚úÖ Position Registry —Å –ø–æ–ª–Ω—ã–º–∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏
- ‚úÖ Position Sync –¥–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è drift –ø–æ–∑–∏—Ü–∏–π
- ‚úÖ –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ peak_profit (–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–∏–±—ã–ª–∏)
- ‚úÖ –ê–¥–∞–ø—Ç–∏–≤–Ω–æ–µ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è —É–¥–µ—Ä–∂–∞–Ω–∏—è –¥–ª—è partial_tp

**–í–∞–∂–Ω–æ:** –ë–æ—Ç –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –∞–∫—Ç–∏–≤–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –∏ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —É–ª—É—á—à–∞–µ—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ç–æ—Ä–≥–æ–≤–ª–∏.

---

**–î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 23 –¥–µ–∫–∞–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:** 2.1





