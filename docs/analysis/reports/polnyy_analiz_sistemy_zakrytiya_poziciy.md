# üîç –ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Å–∏—Å—Ç–µ–º—ã –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–π

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** 29.11.2025  
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ–∑–∏—Ü–∏–∏ –≤–∏—Å—è—Ç 6+ —á–∞—Å–æ–≤, –Ω–µ –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è

---

## üìä –¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è

### –í—Ä–µ–º—è —É–¥–µ—Ä–∂–∞–Ω–∏—è –ø–æ–∑–∏—Ü–∏–π
- **–í—Ä–µ–º—è –æ—Ç–∫—Ä—ã—Ç–∏—è:** 28.11.2025 23:31:17
- **–¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è:** 29.11.2025 05:51:02
- **–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** **6 —á–∞—Å–æ–≤ 19 –º–∏–Ω—É—Ç 45 —Å–µ–∫—É–Ω–¥** ‚ö†Ô∏è

### –ü–æ–∑–∏—Ü–∏–∏
1. **SOL-USDT LONG** - 6—á 20–º (PnL: -0.0125 USDT)
2. **DOGE-USDT SHORT** - 6—á 20–º (PnL: +0.3441 USDT) ‚úÖ
3. **BTC-USDT SHORT** - 6—á 20–º (PnL: -0.0393 USDT)
4. **XRP-USDT SHORT** - 6—á 20–º (PnL: -0.1254 USDT)
5. **ETH-USDT LONG** - 6—á 20–º (PnL: -0.2681 USDT)

---

## üîÑ –ú–µ—Ö–∞–Ω–∏–∑–º—ã –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–π (–ü–†–ò–û–†–ò–¢–ï–¢–´)

### 1Ô∏è‚É£ –ü–†–ò–û–†–ò–¢–ï–¢ #1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø–æ–∑–∏—Ü–∏–∏
**–ú–µ—Ç–æ–¥:** `_check_position_safety()`
- **–ö–æ–≥–¥–∞:** –ü—Ä–∏ –∫–∞–∂–¥–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø–æ–∑–∏—Ü–∏–∏
- **–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:**
  - Margin ratio (–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –º–∞—Ä–∂–∏)
  - Liquidation price (—Ü–µ–Ω–∞ –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏)
  - Emergency close (–∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ)
- **–ó–∞—â–∏—Ç–∞:** –ú–∏–Ω–∏–º—É–º 10 —Å–µ–∫—É–Ω–¥ –ø–æ—Å–ª–µ –æ—Ç–∫—Ä—ã—Ç–∏—è (–∑–∞—â–∏—Ç–∞ –æ—Ç –ª–æ–∂–Ω—ã—Ö —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π)
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç (84.8% –ø–æ–∑–∏—Ü–∏–π –±–µ–∑–æ–ø–∞—Å–Ω—ã)

### 2Ô∏è‚É£ –ü–†–ò–û–†–ò–¢–ï–¢ #2: Profit Harvesting (PH)
**–ú–µ—Ç–æ–¥:** `_check_profit_harvesting()`
- **–ö–æ–≥–¥–∞:** –ü–ï–†–ï–î –ø—Ä–æ–≤–µ—Ä–∫–æ–π TP/SL
- **–£—Å–ª–æ–≤–∏—è:**
  - –ü—Ä–∏–±—ã–ª—å >= `ph_threshold` (–∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞)
  - –í—Ä–µ–º—è –≤ –ø–æ–∑–∏—Ü–∏–∏ >= `ph_time_limit` (–∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞)
  - **MIN_HOLDING –∑–∞—â–∏—Ç–∞:** –ù–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –¥–æ 35 –º–∏–Ω—É—Ç (–∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞)
- **–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è **–ü–†–û–ë–õ–ï–ú–ê** - min_holding = 35 –º–∏–Ω—É—Ç –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–∫—Ä—ã—Ç–∏–µ!

### 3Ô∏è‚É£ –ü–†–ò–û–†–ò–¢–ï–¢ #3: Take Profit (TP)
**–ú–µ—Ç–æ–¥:** `_check_tp_only()`
- **–ö–æ–≥–¥–∞:** –ü–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ PH
- **–£—Å–ª–æ–≤–∏—è:**
  - PnL% >= TP% + –∫–æ–º–∏—Å—Å–∏—è + slippage buffer
  - **MIN_HOLDING –∑–∞—â–∏—Ç–∞:** –ù–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –¥–æ min_holding_minutes (–∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞)
- **–ü—Ä–æ–¥–ª–µ–Ω–∏–µ TP:**
  - –ï—Å–ª–∏ —Ç—Ä–µ–Ω–¥ —Å–∏–ª—å–Ω—ã–π (trend_strength >= 0.7)
  - –ò PnL > 0
  - TP –ø—Ä–æ–¥–ª–µ–≤–∞–µ—Ç—Å—è: `current_tp + extension_step` (–¥–æ max_tp)
- **–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è **–ü–†–û–ë–õ–ï–ú–ê** - –ø—Ä–æ–¥–ª–µ–Ω–∏–µ TP –º–æ–∂–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∑–∞–∫—Ä—ã—Ç–∏–µ!

### 4Ô∏è‚É£ –ü–†–ò–û–†–ò–¢–ï–¢ #4: Stop Loss (SL)
**–ú–µ—Ç–æ–¥:** `_check_sl()`
- **–ö–æ–≥–¥–∞:** –ü–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ TP
- **–£—Å–ª–æ–≤–∏—è:**
  - PnL% <= -SL%
  - **MIN_HOLDING –∑–∞—â–∏—Ç–∞:** –ù–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –¥–æ min_holding_minutes (–∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞)
- **–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è **–ü–†–û–ë–õ–ï–ú–ê** - min_holding –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ SL!

### 5Ô∏è‚É£ –ü–†–ò–û–†–ò–¢–ï–¢ #5: Trailing Stop Loss (TSL)
**–ú–µ—Ç–æ–¥:** `TrailingStopLoss.should_close_position()`
- **–ö–æ–≥–¥–∞:** –ß–µ—Ä–µ–∑ orchestrator._update_trailing_stop_loss
- **–£—Å–ª–æ–≤–∏—è:**
  - –¶–µ–Ω–∞ –¥–æ—Å—Ç–∏–≥–ª–∞ trailing stop
  - **Timeout loss-cut:** –ï—Å–ª–∏ –ø–æ–∑–∏—Ü–∏—è –¥–µ—Ä–∂–∏—Ç—Å—è >= `timeout_minutes` –ò PnL <= -`timeout_loss_percent`
- **–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è **–ü–†–û–ë–õ–ï–ú–ê** - timeout —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è —É–±—ã—Ç–æ—á–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π!

### 6Ô∏è‚É£ –ü–†–ò–û–†–ò–¢–ï–¢ #6: Emergency Close
**–ú–µ—Ç–æ–¥:** `_emergency_close_position()`
- **–ö–æ–≥–¥–∞:** –ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–∞—Ä–∂–∏
- **–£—Å–ª–æ–≤–∏—è:**
  - Margin ratio < critical threshold
  - –ó–∞—â–∏—Ç–∞ –æ—Ç –ª–æ–∂–Ω—ã—Ö —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π (–º–∏–Ω–∏–º—É–º 10 —Å–µ–∫—É–Ω–¥)
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç

### 7Ô∏è‚É£ –ü–†–ò–û–†–ò–¢–ï–¢ #7: Exit Analyzer
**–ú–µ—Ç–æ–¥:** `ExitAnalyzer.analyze_position()`
- **–ö–æ–≥–¥–∞:** –ß–µ—Ä–µ–∑ PositionMonitor (–∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥)
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
  - –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ä–µ–∂–∏–º —Ä—ã–Ω–∫–∞ (trending/ranging/choppy)
  - –ü—Ä–∏–Ω–∏–º–∞–µ—Ç —Ä–µ—à–µ–Ω–∏—è: extend_tp, close, protect
- **–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è **–ü–†–û–ë–õ–ï–ú–ê** - –º–æ–∂–µ—Ç –ø—Ä–æ–¥–ª–µ–≤–∞—Ç—å TP –≤–º–µ—Å—Ç–æ –∑–∞–∫—Ä—ã—Ç–∏—è!

### 8Ô∏è‚É£ –ü–†–ò–û–†–ò–¢–ï–¢ #8: Timeout Protection
**–ú–µ—Ç–æ–¥:** `TrailingStopLoss.should_close_position()` (timeout branch)
- **–ö–æ–≥–¥–∞:** –ü–æ–∑–∏—Ü–∏—è –¥–µ—Ä–∂–∏—Ç—Å—è >= `timeout_minutes`
- **–£—Å–ª–æ–≤–∏—è:**
  - –í—Ä–µ–º—è –≤ –ø–æ–∑–∏—Ü–∏–∏ >= timeout_minutes
  - **–ò** PnL <= -timeout_loss_percent (–æ—Ç –º–∞—Ä–∂–∏)
- **–°—Ç–∞—Ç—É—Å:** ‚ùå **–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê** - —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è —É–±—ã—Ç–æ—á–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π!

---

## ‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´

### –ü—Ä–æ–±–ª–µ–º–∞ #1: –ù–ï–¢ MAX_HOLDING –¥–ª—è –≤—Å–µ—Ö –ø–æ–∑–∏—Ü–∏–π
**–û–ø–∏—Å–∞–Ω–∏–µ:** 
- –í –∫–æ–¥–µ –Ω–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ `max_holding_minutes` –¥–ª—è –≤—Å–µ—Ö –ø–æ–∑–∏—Ü–∏–π
- Timeout —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤ TrailingStopLoss –∏ —Ç–æ–ª—å–∫–æ –¥–ª—è —É–±—ã—Ç–æ—á–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π
- –ü–æ–∑–∏—Ü–∏–∏ –º–æ–≥—É—Ç –≤–∏—Å–µ—Ç—å –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ, –µ—Å–ª–∏ –Ω–µ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç TP/SL

**–ì–¥–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
```python
# –í position_manager.py –∏–ª–∏ exit_analyzer.py
max_holding_minutes = get_max_holding_for_regime(regime)
if minutes_in_position >= max_holding_minutes:
    await self._close_position_by_reason(position, "max_holding_exceeded")
```

**–í–ª–∏—è–Ω–∏–µ:**
- –ü–æ–∑–∏—Ü–∏–∏ –≤–∏—Å—è—Ç 6+ —á–∞—Å–æ–≤
- –£–ø—É—â–µ–Ω–Ω–∞—è –ø—Ä–∏–±—ã–ª—å (DOGE –≤ +0.34 USDT, –Ω–æ –Ω–µ –∑–∞–∫—Ä—ã—Ç–∞)
- –†–∏—Å–∫ —Ä–∞–∑–≤–æ—Ä–æ—Ç–∞ —Ä—ã–Ω–∫–∞

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî• **–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô**

---

### –ü—Ä–æ–±–ª–µ–º–∞ #2: MIN_HOLDING –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–∫—Ä—ã—Ç–∏–µ
**–û–ø–∏—Å–∞–Ω–∏–µ:**
- `min_holding_minutes` –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç –ø—Ä–µ–∂–¥–µ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è
- –ù–æ –¥–ª—è PH —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω **35 –º–∏–Ω—É—Ç** - —Å–ª–∏—à–∫–æ–º –¥–æ–ª–≥–æ!
- –î–ª—è TP/SL –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è min_holding –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–µ–∂–∏–º–∞)

**–ì–¥–µ:**
- `_check_profit_harvesting()`: min_holding = 35.0 –º–∏–Ω—É—Ç (hardcoded!)
- `_check_sl()`: min_holding –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ (–∞–¥–∞–ø—Ç–∏–≤–Ω–æ)
- `_check_tp_only()`: min_holding –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ (–∞–¥–∞–ø—Ç–∏–≤–Ω–æ)

**–í–ª–∏—è–Ω–∏–µ:**
- PH –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–æ 35 –º–∏–Ω—É—Ç
- –ü–æ–∑–∏—Ü–∏–∏ –Ω–µ –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è –¥–∞–∂–µ –ø—Ä–∏ –±–æ–ª—å—à–æ–π –ø—Ä–∏–±—ã–ª–∏

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî• **–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô**

---

### –ü—Ä–æ–±–ª–µ–º–∞ #3: –ü—Ä–æ–¥–ª–µ–Ω–∏–µ TP –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–∫—Ä—ã—Ç–∏–µ
**–û–ø–∏—Å–∞–Ω–∏–µ:**
- –ï—Å–ª–∏ —Ç—Ä–µ–Ω–¥ —Å–∏–ª—å–Ω—ã–π (trend_strength >= 0.7) –∏ PnL > 0
- TP –ø—Ä–æ–¥–ª–µ–≤–∞–µ—Ç—Å—è –≤–º–µ—Å—Ç–æ –∑–∞–∫—Ä—ã—Ç–∏—è
- –ü–æ–∑–∏—Ü–∏—è –º–æ–∂–µ—Ç –≤–∏—Å–µ—Ç—å –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ, –æ–∂–∏–¥–∞—è –Ω–æ–≤–æ–≥–æ TP

**–ì–¥–µ:**
```python
# position_manager.py:2015-2065
if trend_strength >= min_trend_strength:
    new_tp = min(current_tp + extension_step, max_tp)
    if pnl_percent < new_tp + commission + slippage:
        return  # –ù–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º, –ø—Ä–æ–¥–ª–µ–≤–∞–µ–º TP
```

**–í–ª–∏—è–Ω–∏–µ:**
- –ü–æ–∑–∏—Ü–∏–∏ –Ω–µ –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ TP
- TP –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –ø—Ä–æ–¥–ª–µ–≤–∞–µ—Ç—Å—è –≤ —Ç—Ä–µ–Ω–¥–µ

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** ‚ö†Ô∏è **–í–´–°–û–ö–ò–ô**

---

### –ü—Ä–æ–±–ª–µ–º–∞ #4: Timeout —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è —É–±—ã—Ç–∫–æ–≤
**–û–ø–∏—Å–∞–Ω–∏–µ:**
- Timeout loss-cut –≤ TrailingStopLoss —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏:
  - –í—Ä–µ–º—è >= timeout_minutes
  - **–ò** PnL <= -timeout_loss_percent
- –î–ª—è –ø—Ä–∏–±—ã–ª—å–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π timeout –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç!

**–ì–¥–µ:**
```python
# trailing_stop_loss.py:618-649
if (minutes_in_position >= self.timeout_minutes 
    and profit_pct <= -timeout_loss_from_price):
    return True, "timeout"  # –ó–∞–∫—Ä—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —É–±—ã—Ç–∫–µ!
```

**–í–ª–∏—è–Ω–∏–µ:**
- –ü—Ä–∏–±—ã–ª—å–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ (DOGE +0.34 USDT) –Ω–µ –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è –ø–æ timeout
- –ü–æ–∑–∏—Ü–∏–∏ –≤–∏—Å—è—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî• **–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô**

---

## üìã –ü–æ—Ä—è–¥–æ–∫ –ø—Ä–æ–≤–µ—Ä–æ–∫ –∑–∞–∫—Ä—ã—Ç–∏—è (—Ç–µ–∫—É—â–∏–π)

```
1. _check_position_safety()      ‚Üí Emergency close (–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –º–∞—Ä–∂–∞)
2. _check_profit_harvesting()    ‚Üí PH (–µ—Å–ª–∏ –ø—Ä–∏–±—ã–ª—å >= threshold –ò –≤—Ä–µ–º—è >= ph_time_limit –ò –≤—Ä–µ–º—è >= 35 –º–∏–Ω)
3. _check_tp_only()              ‚Üí TP (–µ—Å–ª–∏ PnL >= TP% + –∫–æ–º–∏—Å—Å–∏—è –ò –≤—Ä–µ–º—è >= min_holding)
   ‚îî‚îÄ –ü—Ä–æ–¥–ª–µ–Ω–∏–µ TP (–µ—Å–ª–∏ —Ç—Ä–µ–Ω–¥ —Å–∏–ª—å–Ω—ã–π –ò PnL > 0)
4. _check_sl()                    ‚Üí SL (–µ—Å–ª–∏ PnL <= -SL% –ò –≤—Ä–µ–º—è >= min_holding)
5. TrailingStopLoss               ‚Üí TSL (–µ—Å–ª–∏ —Ü–µ–Ω–∞ –¥–æ—Å—Ç–∏–≥–ª–∞ trailing stop)
   ‚îî‚îÄ Timeout loss-cut (–µ—Å–ª–∏ –≤—Ä–µ–º—è >= timeout_minutes –ò PnL <= -timeout_loss%)
6. ExitAnalyzer                   ‚Üí –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ (–º–æ–∂–µ—Ç –ø—Ä–æ–¥–ª–µ–≤–∞—Ç—å TP)
7. ‚ùå MAX_HOLDING                 ‚Üí –ù–ï –†–ï–ê–õ–ò–ó–û–í–ê–ù–û!
```

---

## ‚úÖ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –ò–°–ü–†–ê–í–õ–ï–ù–ò–Æ

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ #1: –î–æ–±–∞–≤–∏—Ç—å MAX_HOLDING –ø—Ä–æ–≤–µ—Ä–∫—É
**–ì–¥–µ:** `position_manager.py` –≤ –º–µ—Ç–æ–¥–µ `_manage_position()`

```python
# –ü–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ TP/SL, –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
max_holding_minutes = await self._get_max_holding_minutes(symbol, regime)
if minutes_in_position >= max_holding_minutes:
    logger.warning(
        f"‚è∞ MAX HOLDING EXCEEDED: {symbol} "
        f"Time: {minutes_in_position:.1f} min / {max_holding_minutes} min"
    )
    await self._close_position_by_reason(position, "max_holding_exceeded")
    return
```

**–ó–Ω–∞—á–µ–Ω–∏—è –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞:**
- **Trending:** 60 –º–∏–Ω—É—Ç (—Ç—Ä–µ–Ω–¥ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è)
- **Ranging:** 120 –º–∏–Ω—É—Ç (2 —á–∞—Å–∞ - –±–æ–∫–æ–≤–∏–∫)
- **Choppy:** 30 –º–∏–Ω—É—Ç (–±—ã—Å—Ç—Ä–æ –∑–∞–∫—Ä—ã–≤–∞–µ–º)

---

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ #2: –ò—Å–ø—Ä–∞–≤–∏—Ç—å MIN_HOLDING –¥–ª—è PH
**–ì–¥–µ:** `position_manager.py` –≤ –º–µ—Ç–æ–¥–µ `_check_profit_harvesting()`

```python
# –í–º–µ—Å—Ç–æ hardcoded 35.0 –º–∏–Ω—É—Ç
min_holding_minutes = await self._get_min_holding_minutes(symbol, regime)
# Trending: 5 –º–∏–Ω—É—Ç
# Ranging: 10 –º–∏–Ω—É—Ç
# Choppy: 3 –º–∏–Ω—É—Ç—ã
```

---

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ #3: –î–æ–±–∞–≤–∏—Ç—å timeout –¥–ª—è –ø—Ä–∏–±—ã–ª—å–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π
**–ì–¥–µ:** `trailing_stop_loss.py` –≤ –º–µ—Ç–æ–¥–µ `should_close_position()`

```python
# –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É timeout –¥–ª—è –≤—Å–µ—Ö –ø–æ–∑–∏—Ü–∏–π (–Ω–µ —Ç–æ–ª—å–∫–æ —É–±—ã—Ç–æ—á–Ω—ã—Ö)
if (self.timeout_minutes is not None 
    and minutes_in_position >= self.timeout_minutes):
    # –î–ª—è –ø—Ä–∏–±—ã–ª—å–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π - –∑–∞–∫—Ä—ã–≤–∞–µ–º –µ—Å–ª–∏ –ø—Ä–∏–±—ã–ª—å < –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π
    if profit_pct > 0 and profit_pct < min_profit_threshold:
        return True, "timeout_low_profit"
    # –î–ª—è —É–±—ã—Ç–æ—á–Ω—ã—Ö - –∫–∞–∫ —Ä–∞–Ω—å—à–µ
    elif profit_pct <= -timeout_loss_from_price:
        return True, "timeout"
```

---

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ #4: –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –ø—Ä–æ–¥–ª–µ–Ω–∏–µ TP
**–ì–¥–µ:** `position_manager.py` –≤ –º–µ—Ç–æ–¥–µ `_check_tp_only()`

```python
# –î–æ–±–∞–≤–∏—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–¥–ª–µ–Ω–∏–π
max_tp_extensions = 3  # –ú–∞–∫—Å–∏–º—É–º 3 –ø—Ä–æ–¥–ª–µ–Ω–∏—è
if tp_extension_count >= max_tp_extensions:
    # –ü–æ—Å–ª–µ 3 –ø—Ä–æ–¥–ª–µ–Ω–∏–π - –∑–∞–∫—Ä—ã–≤–∞–µ–º –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ —Ç–µ–∫—É—â–µ–≥–æ TP
    logger.info(f"üìà TP –ø—Ä–æ–¥–ª–µ–≤–∞–ª—Å—è {tp_extension_count} —Ä–∞–∑, –∑–∞–∫—Ä—ã–≤–∞–µ–º –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏")
```

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ: –î–æ–ª–∂–Ω–æ –±—ã—Ç—å vs –ï—Å—Ç—å —Å–µ–π—á–∞—Å

| –ú–µ—Ö–∞–Ω–∏–∑–º | –î–æ–ª–∂–Ω–æ –±—ã—Ç—å | –ï—Å—Ç—å —Å–µ–π—á–∞—Å | –°—Ç–∞—Ç—É—Å |
|----------|-------------|-------------|--------|
| MAX_HOLDING | ‚úÖ –ï—Å—Ç—å (60-120 –º–∏–Ω) | ‚ùå –ù–ï–¢ | üî• –ö–†–ò–¢–ò–ß–ù–û |
| MIN_HOLDING –¥–ª—è PH | ‚úÖ –ê–¥–∞–ø—Ç–∏–≤–Ω–æ (3-10 –º–∏–Ω) | ‚ùå 35 –º–∏–Ω (hardcoded) | üî• –ö–†–ò–¢–ò–ß–ù–û |
| Timeout –¥–ª—è –ø—Ä–∏–±—ã–ª–∏ | ‚úÖ –ï—Å—Ç—å | ‚ùå –¢–æ–ª—å–∫–æ –¥–ª—è —É–±—ã—Ç–∫–æ–≤ | üî• –ö–†–ò–¢–ò–ß–ù–û |
| –ü—Ä–æ–¥–ª–µ–Ω–∏–µ TP | ‚úÖ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–æ | ‚ö†Ô∏è –ë–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π | ‚ö†Ô∏è –ü–†–û–ë–õ–ï–ú–ê |
| Emergency Close | ‚úÖ –ï—Å—Ç—å | ‚úÖ –ï—Å—Ç—å | ‚úÖ OK |
| Profit Harvesting | ‚úÖ –ï—Å—Ç—å | ‚ö†Ô∏è –ë–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è | ‚ö†Ô∏è –ü–†–û–ë–õ–ï–ú–ê |

---

## üéØ –ü–õ–ê–ù –î–ï–ô–°–¢–í–ò–ô

1. **–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ:** –î–æ–±–∞–≤–∏—Ç—å MAX_HOLDING –ø—Ä–æ–≤–µ—Ä–∫—É
2. **–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ:** –ò—Å–ø—Ä–∞–≤–∏—Ç—å MIN_HOLDING –¥–ª—è PH (35 –º–∏–Ω ‚Üí –∞–¥–∞–ø—Ç–∏–≤–Ω–æ)
3. **–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ:** –î–æ–±–∞–≤–∏—Ç—å timeout –¥–ª—è –ø—Ä–∏–±—ã–ª—å–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π
4. **–í–∞–∂–Ω–æ:** –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –ø—Ä–æ–¥–ª–µ–Ω–∏–µ TP (–º–∞–∫—Å–∏–º—É–º 3 —Ä–∞–∑–∞)
5. **–ü—Ä–æ–≤–µ—Ä–∫–∞:** –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ç–µ–∫—É—â–∏—Ö –ø–æ–∑–∏—Ü–∏—è—Ö

---

**–û—Ç—á–µ—Ç —Å–æ–∑–¥–∞–Ω:** 29.11.2025  
**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º

