# üî¥ –ü—Ä–æ–±–ª–µ–º–∞: Margin Ratio = 0.10 (–ö–†–ò–¢–ò–ß–ù–û)

## –ù–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ, –ø—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏

### –ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ?

–í –ª–æ–≥–∞—Ö –±–æ—Ç–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
```
[MARGIN_RATIO] safe=False | margin_ratio=0.10 [CRITICAL] (threshold=1.80)
```

**–ß—Ç–æ —ç—Ç–æ –∑–Ω–∞—á–∏—Ç?** Margin ratio = 0.10 –æ–∑–Ω–∞—á–∞–µ—Ç —á—Ç–æ **—É –≤–∞—Å –æ—Å—Ç–∞–ª–æ—Å—å —Ç–æ–ª—å–∫–æ 10% –æ—Ç –Ω—É–∂–Ω–æ–π –º–∞—Ä–∂–∏**. –≠—Ç–æ –û–ß–ï–ù–¨ –æ–ø–∞—Å–Ω–æ - –ø–æ–∑–∏—Ü–∏—è –º–æ–∂–µ—Ç –±—ã—Ç—å –ª–∏–∫–≤–∏–¥–∏—Ä–æ–≤–∞–Ω–∞!

### –ö–∞–∫ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å?

**–§–æ—Ä–º—É–ª–∞:** `margin_ratio = equity / margin_used`

**–ù–æ—Ä–º–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:**
- `margin_ratio > 1.80` = ‚úÖ –ë–ï–ó–û–ü–ê–°–ù–û (–ø–æ—Ä–æ–≥ –¥–ª—è —Ç–æ—Ä–≥–æ–≤–ª–∏)
- `margin_ratio = 1.0` = ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–û (–º–∞—Ä–∂–∞ –Ω–∞ –º–∏–Ω–∏–º—É–º–µ)
- `margin_ratio = 0.10` = üî¥ –õ–ò–ö–í–ò–î–ê–¶–ò–Ø! (–º–∞—Ä–∂–∏ –ø–æ—á—Ç–∏ –Ω–µ—Ç)

### –ü—Ä–∏–º–µ—Ä —Ä–∞—Å—á–µ—Ç–∞ (–∏–∑ –≤–∞—à–µ–≥–æ —Ç–µ—Å—Ç–∞)

**–í—ã –æ—Ç–∫—Ä—ã–ª–∏ –ø–æ–∑–∏—Ü–∏—é:**
- Symbol: ETH-USDT SHORT
- Notional: $213.95 (—Ä–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏)
- Leverage: 5x
- –í–∞—à –±–∞–ª–∞–Ω—Å: $665.22

**–ù—É–∂–Ω–∞—è –º–∞—Ä–∂–∞:**
```
margin_used = $213.95 / 5 = $42.79
```

**Margin ratio –î–û–õ–ñ–ï–ù –±—ã—Ç—å:**
```
margin_ratio = $665.22 / $42.79 = 15.5 ‚úÖ (–û–¢–õ–ò–ß–ù–û!)
```

**–ù–æ –≤ –ª–æ–≥–∞—Ö –ø–æ–∫–∞–∑–∞–ª–æ 0.10** ‚ùå

### –ü–æ—á–µ–º—É –ø–æ–ª—É—á–∏–ª–æ—Å—å 0.10?

–ï—Å—Ç—å –î–í–ï –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:

#### –í–∞—Ä–∏–∞–Ω—Ç 1: Equity —á–∏—Ç–∞–µ—Ç—Å—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ

–ë–æ—Ç –≤–∏–¥–∏—Ç equity –Ω–µ $665.22, –∞ –Ω–∞–ø—Ä–∏–º–µ—Ä $4.28:
```
margin_ratio = $4.28 / $42.79 = 0.10 ‚ùå
```

**–ü—Ä–∏—á–∏–Ω–∞:** OKX API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `equity` –¥–ª—è –ö–û–ù–ö–†–ï–¢–ù–û–ô –ø–æ–∑–∏—Ü–∏–∏ (–∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –º–∞—Ä–∂–∞), –∞ –Ω–µ –æ–±—â–∏–π –±–∞–ª–∞–Ω—Å —Å—á–µ—Ç–∞.

#### –í–∞—Ä–∏–∞–Ω—Ç 2: Margin_used —Å—á–∏—Ç–∞–µ—Ç—Å—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ

–ë–æ—Ç –¥—É–º–∞–µ—Ç —á—Ç–æ –Ω—É–∂–Ω–æ $6,652 –º–∞—Ä–∂–∏ –≤–º–µ—Å—Ç–æ $42.79:
```
margin_ratio = $665.22 / $6,652 = 0.10 ‚ùå
```

**–ü—Ä–∏—á–∏–Ω–∞:** –§–æ—Ä–º—É–ª–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–ª–µ—á–æ –∏–ª–∏ —Å—á–∏—Ç–∞–µ—Ç –±–µ–∑ leverage.

---

## –ö–∞–∫ –∏—Å–ø—Ä–∞–≤–∏—Ç—å?

### –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï #1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –û–ë–©–ò–ô –±–∞–ª–∞–Ω—Å —Å—á–µ—Ç–∞

–í–º–µ—Å—Ç–æ equity –ø–æ–∑–∏—Ü–∏–∏ –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **total equity** –≤—Å–µ–≥–æ —Å—á–µ—Ç–∞:

```python
# ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: –ß–∏—Ç–∞–µ–º equity –ø–æ–∑–∏—Ü–∏–∏
equity = position_data.get("eq")  # –≠—Ç–æ –º–∞—Ä–∂–∞ –¢–û–õ–¨–ö–û —ç—Ç–æ–π –ø–æ–∑–∏—Ü–∏–∏!

# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –ß–∏—Ç–∞–µ–º –æ–±—â–∏–π –±–∞–ª–∞–Ω—Å —Å—á–µ—Ç–∞
total_balance = await self.client.get_balance()  # –í–µ—Å—å USDT –±–∞–ª–∞–Ω—Å
equity = total_balance
```

### –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï #2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–æ—Ä–º—É–ª—É margin_used

–£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è leverage:

```python
# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û
margin_used = position_value / leverage

# ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û
margin_used = position_value  # –ó–∞–±—ã–ª–∏ –ø–æ–¥–µ–ª–∏—Ç—å –Ω–∞ leverage!
```

---

## –ß—Ç–æ –¥–∞–ª—å—à–µ?

1. ‚úÖ **–ù–∞–π—Ç–∏ –∫–æ–¥** –≥–¥–µ —Å—á–∏—Ç–∞–µ—Ç—Å—è margin_ratio –¥–ª—è –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π
2. ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–∏ total balance –∏–ª–∏ position equity
3. ‚úÖ **–ò—Å–ø—Ä–∞–≤–∏—Ç—å** —á—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –æ–±—â–∏–π –±–∞–ª–∞–Ω—Å —Å—á–µ—Ç–∞
4. ‚úÖ **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å** —á—Ç–æ margin_ratio —Ç–µ–ø–µ—Ä—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ

---

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏ (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞)

**–§–∞–π–ª—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:**
- `src/strategies/scalping/futures/calculations/margin_calculator.py` (—Å—Ç—Ä–æ–∫–∞ 153)
- `src/strategies/scalping/futures/core/position_manager.py` (–≥–¥–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è calculate_margin_ratio)
- `src/clients/futures_client.py` (–º–µ—Ç–æ–¥ get_isolated_margin_info)

**–ú–µ—Ç–æ–¥ calculate_margin_ratio:**
```python
def calculate_margin_ratio(
    self, position_value: float, equity: float, leverage: Optional[int] = None
) -> float:
    if leverage is None:
        leverage = self.default_leverage
    
    margin_used = position_value / leverage
    margin_ratio = equity / margin_used if margin_used > 0 else float("inf")
    
    return margin_ratio
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–∞—Ä–∞–º–µ—Ç—Ä `equity` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å TOTAL BALANCE, –∞ –Ω–µ position equity!

---

–î–∞—Ç–∞: 7 —è–Ω–≤–∞—Ä—è 2026  
–°—Ç–∞—Ç—É—Å: –¢–†–ï–ë–£–ï–¢ –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø
