# üìä –ü–û–õ–ù–´–ô –ê–ù–ê–õ–ò–ó –¢–û–†–ì–û–í–´–• –ü–û–ó–ò–¶–ò–ô - 30.12.2025 (–í–ï–ß–ï–†–ù–Ø–Ø –°–ï–°–°–ò–Ø)

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** 30.12.2025  
**–ü–µ—Ä–∏–æ–¥ –∞–Ω–∞–ª–∏–∑–∞:** 11:39 - 22:06 UTC  
**–í—Å–µ–≥–æ –ø–æ–∑–∏—Ü–∏–π:** 32  
**–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö:** `logs/futures/archived/logs_2025-12-30_22-06-26/all_data_2025-12-30.csv`  
**–î–∞–Ω–Ω—ã–µ –±–∏—Ä–∂–∏:** –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º

---

## üìã –î–ê–ù–ù–´–ï –î–õ–Ø –ê–ù–ê–õ–ò–ó–ê

### 1. –¢–æ—Ä–≥–æ–≤—ã–µ –ø–æ–∑–∏—Ü–∏–∏ (30.12.2025, 11:39-22:06)

| –ü–∞—Ä–∞ | –í—Ä–µ–º—è –æ—Ç–∫—Ä—ã—Ç–∏—è | –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ | Entry | Exit | –†–∞–∑–º–µ—Ä | –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ PnL | –ó–∞–∫—Ä—ã—Ç—ã–µ PnL | –ö–æ–º–∏—Å—Å–∏—è | –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å | –ü—Ä–∏—á–∏–Ω–∞ |
|------|----------------|-------------|-------|------|--------|-------------------|--------------|----------|--------------|---------|
| BTCUSDT | 11:42:28 | LONG | 88955.7 | 88907.6 | 0.0028 BTC | -0.39 USDT (-1.55%) | -0.14 USDT | 0.249 | 59 —Å–µ–∫ | sl_reached |
| BTCUSDT | 11:44:52 | LONG | 88943.6 | 89120.0 | 0.0028 BTC | +0.24 USDT (0.98%) | +0.49 USDT | 0.249 | 709 —Å–µ–∫ | tp_reached |
| SOLUSDT | 11:51:08 | LONG | 125.83 | 125.90 | 2.04 SOL | -0.09 USDT (-0.33%) | +0.17 USDT | 0.25 | 8 —Å–µ–∫ | tp_reached |
| BTCUSDT | 12:14:33 | LONG | 89066.6 | 88893.1 | 0.0028 BTC | -0.74 USDT (-2.95%) | -0.49 USDT | 0.249 | 169 —Å–µ–∫ | sl_reached |
| SOLUSDT | 12:14:44 | LONG | 126.32 | 125.79 | 2.02 SOL | -1.33 USDT (-5.19%) | -1.07 USDT | 0.25 | 88 —Å–µ–∫ | sl_reached |
| ETHUSDT | 12:36:34 | LONG | 2976.86 | 2986.00 | 0.084 ETH | -1.02 USDT (-2.86%) | -0.77 USDT | 0.25 | 128 —Å–µ–∫ | sl_reached |
| ETHUSDT | 12:49:30 | LONG | 2980.00 | 2985.36 | 0.084 ETH | -0.71 USDT (-1.96%) | -0.45 USDT | 0.25 | 97 —Å–µ–∫ | sl_reached |
| SOLUSDT | 12:56:26 | LONG | 125.36 | 124.81 | 2.05 SOL | +0.87 USDT (3.38%) | +1.12 USDT | 0.25 | 104 —Å–µ–∫ | tp_reached |
| BTCUSDT | 12:51:25 | LONG | 89029.1 | 89100.8 | 0.0028 BTC | -0.46 USDT (-1.81%) | -0.21 USDT | 0.249 | 450 —Å–µ–∫ | sl_reached |
| ETHUSDT | 12:53:44 | LONG | 2984.11 | 2985.00 | 0.083 ETH | -0.10 USDT (-0.29%) | +0.07 USDT | 0.17 | 924 —Å–µ–∫ | tp_reached |
| ETHUSDT | 13:19:37 | LONG | 2980.44 | 2984.20 | 0.083 ETH | -0.56 USDT (-1.59%) | -0.32 USDT | 0.24 | 89 —Å–µ–∫ | sl_reached |
| BTCUSDT | 13:15:43 | LONG | 89137.8 | 89097.1 | 0.0028 BTC | -0.14 USDT (-0.55%) | +0.11 USDT | 0.250 | 940 —Å–µ–∫ | tp_reached |
| BTCUSDT | 13:41:12 | LONG | 89154.7 | 89215.9 | 0.0028 BTC | -0.43 USDT (-1.69%) | -0.18 USDT | 0.250 | 600 —Å–µ–∫ | sl_reached |
| DOGEUSDT | 14:26:53 | LONG | 0.12580 | 0.12625 | 1600 DOGE | +0.51 USDT (2.57%) | +0.72 USDT | 0.20 | 52 —Å–µ–∫ | tp_reached |
| XRPUSDT | 14:45:43 | LONG | 1.8604 | 1.8640 | 132 XRP | -0.72 USDT (-2.90%) | -0.47 USDT | 0.24 | 1085 —Å–µ–∫ | sl_reached |
| ETHUSDT | 15:19:17 | LONG | 2986.97 | 2972.50 | 0.083 ETH | +0.95 USDT (2.69%) | +1.20 USDT | 0.24 | 34 —Å–µ–∫ | tp_reached |
| BTCUSDT | 15:47:19 | LONG | 87822.2 | 87663.3 | 0.0028 BTC | +0.19 USDT (0.81%) | +0.44 USDT | 0.246 | 37 —Å–µ–∫ | tp_reached |
| BTCUSDT | 15:51:00 | LONG | 87633.3 | 87633.4 | 0.0028 BTC | -0.25 USDT (-1.01%) | -0.01 USDT | 0.245 | 437 —Å–µ–∫ | sl_reached |
| BTCUSDT | 16:08:31 | LONG | 87991.7 | 87824.6 | 0.0028 BTC | +0.22 USDT (0.89%) | +0.46 USDT | 0.246 | 868 —Å–µ–∫ | tp_reached |
| ETHUSDT | 16:18:33 | LONG | 2983.46 | 2987.30 | 0.084 ETH | -0.50 USDT (-1.40%) | -0.33 USDT | 0.17 | 286 —Å–µ–∫ | sl_reached |
| XRPUSDT | 16:45:44 | LONG | 1.8723 | 1.8668 | 124 XRP | -0.92 USDT (-3.94%) | -0.69 USDT | 0.23 | 363 —Å–µ–∫ | sl_reached |
| BTCUSDT | 16:58:18 | LONG | 87777.8 | 87831.0 | 0.0028 BTC | -0.40 USDT (-1.61%) | -0.15 USDT | 0.246 | 1318 —Å–µ–∫ | sl_reached |
| BTCUSDT | 17:37:56 | LONG | 87840.4 | 87875.1 | 0.0028 BTC | -0.35 USDT (-1.40%) | -0.10 USDT | 0.246 | 362 —Å–µ–∫ | sl_reached |
| BTCUSDT | 17:47:01 | LONG | 87867.4 | 88768.9 | 0.0028 BTC | -2.78 USDT (-11.27%) | -2.53 USDT | 0.247 | 221 —Å–µ–∫ | emergency_loss_protection |
| BTCUSDT | 18:01:33 | LONG | 88495.8 | 88515.3 | 0.0028 BTC | -0.31 USDT (-1.22%) | -0.06 USDT | 0.248 | 164 —Å–µ–∫ | sl_reached |
| BTCUSDT | 19:45:43 | LONG | 88677.0 | 88549.1 | 0.0028 BTC | +0.11 USDT (0.44%) | +0.35 USDT | 0.248 | 514 —Å–µ–∫ | tp_reached |
| ETHUSDT | 20:14:24 | LONG | 2987.75 | 2989.21 | 0.084 ETH | -0.38 USDT (-1.05%) | -0.13 USDT | 0.25 | 346 —Å–µ–∫ | sl_reached |
| XRPUSDT | 21:37:11 | LONG | 1.8836 | 1.8784 | 125 XRP | -0.89 USDT (-3.75%) | -0.65 USDT | 0.23 | 495 —Å–µ–∫ | sl_reached |
| ETHUSDT | 21:40:49 | LONG | 2973.18 | 2975.95 | 0.084 ETH | -0.49 USDT (-1.36%) | -0.24 USDT | 0.24 | 402 —Å–µ–∫ | sl_reached |
| BTCUSDT | 21:36:10 | LONG | 88300.0 | 88400.9 | 0.0028 BTC | -0.53 USDT (-2.15%) | -0.29 USDT | 0.247 | 37 —Å–µ–∫ | sl_reached |
| BTCUSDT | 21:43:12 | LONG | 88353.9 | 88421.1 | 0.0028 BTC | -0.44 USDT (-1.77%) | -0.19 USDT | 0.247 | 481 —Å–µ–∫ | sl_reached |
| BTCUSDT | 22:01:05 | LONG | 88300.0 | 88353.3 | 0.0028 BTC | -0.40 USDT (-1.61%) | -0.15 USDT | 0.247 | 128 —Å–µ–∫ | sl_reached |

**–í—Å–µ–≥–æ –ø–æ–∑–∏—Ü–∏–π:** 32  
**–ü—Ä–∏–±—ã–ª—å–Ω—ã—Ö:** 7 (21.88%)  
**–£–±—ã—Ç–æ—á–Ω—ã—Ö:** 25 (78.12%)  
**–û–±—â–∏–π Net PnL:** -10.69 USDT  
**–°—Ä–µ–¥–Ω–∏–π Net PnL –Ω–∞ –ø–æ–∑–∏—Ü–∏—é:** -0.33 USDT

---

## üîç –î–ï–¢–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó –ö–†–ò–¢–ò–ß–ï–°–ö–ò–• –ü–û–ó–ò–¶–ò–ô

### üî¥ –ü–û–ó–ò–¶–ò–Ø #1: BTCUSDT | 30.12.2025, 14:50:42 UTC (CSV) / 17:47:01 (–ë–∏—Ä–∂–∞)

**–ë–ê–ó–û–í–´–ï –î–ê–ù–ù–´–ï:**

**–¶–ò–¢–ê–¢–ê –ò–ó CSV:**
```
trades,2025-12-30T14:50:42.309190+00:00,BTC-USDT,short,87867.4000,88688.1000,0.00280000,-2.2980,0.2472,-2.5451,221.138612,sl_reached,29.17,,,,,,,,,,,,,,
```

**–¶–ò–¢–ê–¢–ê –ò–ó –î–ê–ù–ù–´–• –ë–ò–†–ñ–ò:**
```
30.12.2025, 17:47:01 | BTCUSDT | LONG | –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è (10x)
–í—Ö–æ–¥–Ω–∞—è —Ü–µ–Ω–∞: 87 867,4
–¶–µ–Ω–∞ –≤—ã—Ö–æ–¥–∞: 88 768,9
–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ PnL: -2,78 USDT (-11,27 %)
–ó–∞–∫—Ä—ã—Ç—ã–µ PnL: -2,53 USDT
–ö–æ–º–∏—Å—Å–∏—è: -0,24729082 USDT
–°—É–º–º–∞ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π: 0,0028 BTC
–ó–∞–∫—Ä—ã—Ç–æ: 0,0028 BTC
–í—Ä–µ–º—è –≤ –∑–∞–∫—Ä—ã—Ç–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏: 30.12.2025, 17:50:42
```

**–°–†–ê–í–ù–ï–ù–ò–ï –î–ê–ù–ù–´–•:**

| –ü–∞—Ä–∞–º–µ—Ç—Ä | CSV | –ë–∏—Ä–∂–∞ | –†–∞–∑–Ω–∏—Ü–∞ |
|----------|-----|-------|---------|
| –í—Ö–æ–¥–Ω–∞—è —Ü–µ–Ω–∞ | 87867.4 | 87867.4 | ‚úÖ –°–æ–≤–ø–∞–¥–∞–µ—Ç |
| –¶–µ–Ω–∞ –≤—ã—Ö–æ–¥–∞ | 88688.1 | 88768.9 | ‚ö†Ô∏è –†–∞–∑–Ω–∏—Ü–∞ 80.8 (0.09%) |
| –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ | SHORT | LONG | üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ù–ï–°–û–û–¢–í–ï–¢–°–¢–í–ò–ï |
| Gross PnL | -2.2980 | -2.78 (—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π) | ‚ö†Ô∏è –†–∞–∑–Ω–∏—Ü–∞ 0.482 |
| Net PnL | -2.5451 | -2.53 (–∑–∞–∫—Ä—ã—Ç—ã–π) | ‚ö†Ô∏è –†–∞–∑–Ω–∏—Ü–∞ 0.0151 |
| –ö–æ–º–∏—Å—Å–∏—è | 0.2472 | 0.247 | ‚úÖ –°–æ–≤–ø–∞–¥–∞–µ—Ç |
| –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å | 221.14 —Å–µ–∫ | 221 —Å–µ–∫ (17:47:01 ‚Üí 17:50:42) | ‚úÖ –°–æ–≤–ø–∞–¥–∞–µ—Ç |
| –ü—Ä–∏—á–∏–Ω–∞ | sl_reached | emergency_loss_protection | ‚ö†Ô∏è –†–∞–∑–Ω–∏—Ü–∞ |
| –ü–ª–µ—á–æ | 10x | 10x (–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ –¥–∞–Ω–Ω—ã–º–∏ –±–∏—Ä–∂–∏) | ‚úÖ –°–æ–≤–ø–∞–¥–∞–µ—Ç |
| –†–∞–∑–º–µ—Ä | 0.0028 BTC | 0.0028 BTC | ‚úÖ –°–æ–≤–ø–∞–¥–∞–µ—Ç |

**–ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ù–ï–°–û–û–¢–í–ï–¢–°–¢–í–ò–ï:** –í CSV —É–∫–∞–∑–∞–Ω–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ SHORT, –Ω–æ –≤ –¥–∞–Ω–Ω—ã—Ö –±–∏—Ä–∂–∏ —É–∫–∞–∑–∞–Ω–æ LONG. –≠—Ç–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø—Ä–æ–±–ª–µ–º—É –≤ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–∏ –∏–ª–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö.

**–¢–û–ß–ù–´–ô –ê–ù–ê–õ–ò–ó:**

1. **–†–∞—Å—á–µ—Ç PnL –¥–ª—è SHORT –ø–æ–∑–∏—Ü–∏–∏:**
   - Entry: 87867.4 USDT
   - Exit: 88688.1 USDT
   - –î–ª—è SHORT: PnL% = (Entry - Exit) / Entry = (87867.4 - 88688.1) / 87867.4 = -0.93%
   - –ù–æ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —É–±—ã—Ç–æ–∫: -2.78 USDT = -11.27% –æ—Ç –º–∞—Ä–∂–∏ (–ø—Ä–∏ –ø–ª–µ—á–µ 10x)

2. **–†–∞—Å—á–µ—Ç PnL –¥–ª—è LONG –ø–æ–∑–∏—Ü–∏–∏ (–ø–æ –¥–∞–Ω–Ω—ã–º –±–∏—Ä–∂–∏):**
   - Entry: 87867.4 USDT
   - Exit: 88768.9 USDT
   - –î–ª—è LONG: PnL% = (Exit - Entry) / Entry = (88768.9 - 87867.4) / 87867.4 = +1.03%
   - –ù–æ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —É–±—ã—Ç–æ–∫: -2.78 USDT = -11.27% –æ—Ç –º–∞—Ä–∂–∏

**–¶–ò–¢–ê–¢–ê –ò–ó –ö–û–î–ê (–†–∞—Å—á–µ—Ç PnL –¥–ª—è SHORT):**

```2410:2415:src/strategies/scalping/futures/position_manager.py
if side.lower() == "long":
    pnl_pct = (current_price - entry_price) / entry_price
else:
    pnl_pct = (entry_price - current_price) / entry_price
```

**–ü–†–û–ë–õ–ï–ú–ê:** –ï—Å–ª–∏ –ø–æ–∑–∏—Ü–∏—è –±—ã–ª–∞ SHORT, —Ç–æ –ø—Ä–∏ —Ä–æ—Å—Ç–µ —Ü–µ–Ω—ã —Å 87867.4 –¥–æ 88688.1 —É–±—ã—Ç–æ–∫ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å:
- PnL% = (87867.4 - 88688.1) / 87867.4 = -0.93%
- –° —É—á–µ—Ç–æ–º –ø–ª–µ—á–∞ 10x: -0.93% * 10 = -9.3% –æ—Ç –º–∞—Ä–∂–∏
- –ù–æ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —É–±—ã—Ç–æ–∫: -11.27%, —á—Ç–æ –±–æ–ª—å—à–µ —Ä–∞—Å—á–µ—Ç–Ω–æ–≥–æ

**–¶–ò–¢–ê–¢–ê –ò–ó –ö–û–î–ê (Emergency Loss Protection):**

```3752:3768:src/strategies/scalping/futures/positions/exit_analyzer.py
emergency_loss_threshold = -2.5  # –î–ª—è ranging —Ä–µ–∂–∏–º–∞ (–±—ã–ª–æ -1.5)

# ‚úÖ –ù–û–í–û–ï (26.12.2025): –£—á–∏—Ç—ã–≤–∞–µ–º spread_buffer –∏ commission_buffer
emergency_spread_buffer = self._get_spread_buffer(symbol, current_price)
emergency_commission_buffer = self._get_commission_buffer(
    position, metadata
)
# –°–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º –ø–æ—Ä–æ–≥ –≤–Ω–∏–∑ (—Å–¥–µ–ª–∞–µ–º –±–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–∏–º), —á—Ç–æ–±—ã —É—á–µ—Å—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ—Ç–µ—Ä–∏ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏
adjusted_emergency_threshold = (
    emergency_loss_threshold
    - emergency_spread_buffer
    - emergency_commission_buffer
)

# ‚úÖ –ù–û–í–û–ï (26.12.2025): –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è —É–¥–µ—Ä–∂–∞–Ω–∏—è –ø–µ—Ä–µ–¥ emergency close
min_holding_seconds = 60.0  # RANGING: 60 —Å–µ–∫—É–Ω–¥ (1 –º–∏–Ω—É—Ç–∞)
if net_pnl_percent < adjusted_emergency_threshold:
```

**–ê–ù–ê–õ–ò–ó:**
- Emergency loss threshold –¥–ª—è ranging: -2.5%
- –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è —É–¥–µ—Ä–∂–∞–Ω–∏—è: 60 —Å–µ–∫—É–Ω–¥
- –§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —É–±—ã—Ç–æ–∫: -11.27% (–Ω–∞–º–Ω–æ–≥–æ –ø—Ä–µ–≤—ã—à–∞–µ—Ç –ø–æ—Ä–æ–≥ -2.5%)
- –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 221 —Å–µ–∫—É–Ω–¥ (3 –º–∏–Ω 41 —Å–µ–∫) - –ø—Ä–µ–≤—ã—à–∞–µ—Ç –º–∏–Ω–∏–º—É–º 60 —Å–µ–∫

**–¶–ò–¢–ê–¢–ê –ò–ó CSV (–°–∏–≥–Ω–∞–ª –∏ –æ—Ç–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–∏):**

```
signals,2025-12-30T14:46:33.444558,BTC-USDT,sell,,,,,,,,,,ranging,,,87740.17200000,1.0000,"ADX,MTF,Correlation,PivotPoints,VolumeProfile,Liquidity,OrderFlow,FundingRate",0,,,,,,,
orders,2025-12-30T14:46:39.751720,BTC-USDT,sell,,,0.00280000,,,,,,,,3174370048585834496,limit,88002.30000000,,,,placed,,,,,,
positions_open,2025-12-30T14:46:45.478329,BTC-USDT,short,88002.30000000,,0.00280000,,,,,,,ranging,3174370048585834496,limit,,,,,,,,,,,
trades,2025-12-30T14:50:42.309190+00:00,BTC-USDT,short,87867.4000,88688.1000,0.00280000,-2.2980,0.2472,-2.5451,221.138612,sl_reached,29.17,,,,,,,,,,,,,,
```

**–ê–ù–ê–õ–ò–ó:**
- –°–∏–≥–Ω–∞–ª SELL —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –≤ 14:46:33
- –û—Ä–¥–µ—Ä —Ä–∞–∑–º–µ—â–µ–Ω –≤ 14:46:39 (limit, 88002.3)
- –ü–æ–∑–∏—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç–∞ –≤ 14:46:45 (SHORT, entry=88002.3)
- –ù–æ –≤ CSV –∑–∞–∫—Ä—ã—Ç–∏—è —É–∫–∞–∑–∞–Ω entry=87867.4 (–Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å entry –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏!)
- Exit: 88688.1
- –ü—Ä–∏—á–∏–Ω–∞: sl_reached (–≤ CSV), –Ω–æ emergency_loss_protection (–≤ –¥–∞–Ω–Ω—ã—Ö –±–∏—Ä–∂–∏)

**–ü–†–û–ë–õ–ï–ú–ê:** Entry price –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ (88002.3) –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å entry price –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ (87867.4). –≠—Ç–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞:
1. –ü–æ–∑–∏—Ü–∏—è –±—ã–ª–∞ —á–∞—Å—Ç–∏—á–Ω–æ –∑–∞–∫—Ä—ã—Ç–∞ –∏ –ø–µ—Ä–µ–æ—Ç–∫—Ä—ã—Ç–∞
2. –û—à–∏–±–∫–∞ –≤ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
3. –ü–æ–∑–∏—Ü–∏—è –±—ã–ª–∞ –∏–∑–º–µ–Ω–µ–Ω–∞ (scaling)

**–¶–ò–¢–ê–¢–ê –ò–ó –ö–û–î–ê (Stop Loss –¥–ª—è SHORT):**

```1390:1450:src/strategies/scalping/futures/positions/stop_loss_manager.py
async def check_sl(
    self,
    position: Dict[str, Any],
) -> bool:
    """
    –ü—Ä–æ–≤–µ—Ä–∫–∞ Stop Loss –¥–ª—è –ø–æ–∑–∏—Ü–∏–∏.
    
    –î–ª—è SHORT –ø–æ–∑–∏—Ü–∏–∏:
    - SL —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–≥–¥–∞ —Ü–µ–Ω–∞ –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è –í–´–®–ï entry_price * (1 + sl_percent)
    - –ù–∞–ø—Ä–∏–º–µ—Ä: entry=100, sl_percent=1.0% ‚Üí SL=101.0
    """
    try:
        symbol = position.get("instId", "").replace("-SWAP", "")
        size = float(position.get("pos", "0"))
        
        if size == 0:
            return False
            
        side = "long" if size > 0 else "short"
        
        # –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â—É—é —Ü–µ–Ω—É
        current_price = await self._get_current_price(symbol)
        if current_price <= 0:
            return False
            
        # –ü–æ–ª—É—á–∞–µ–º entry_price
        entry_price = float(position.get("avgPx", "0") or position.get("entry_price", "0"))
        if entry_price <= 0:
            return False
            
        # –ü–æ–ª—É—á–∞–µ–º SL –ø—Ä–æ—Ü–µ–Ω—Ç
        sl_percent = await self._get_sl_percent(symbol, position.get("regime"))
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º SL
        if side == "short":
            # –î–ª—è SHORT: —Ü–µ–Ω–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –í–´–®–ï entry * (1 + sl_percent)
            sl_price = entry_price * (1 + sl_percent)
            if current_price >= sl_price:
                logger.warning(
                    f"üõë SL –¥–æ—Å—Ç–∏–≥–Ω—É—Ç –¥–ª—è {symbol} SHORT: "
                    f"—Ü–µ–Ω–∞={current_price:.2f} >= SL={sl_price:.2f} "
                    f"(entry={entry_price:.2f}, sl_percent={sl_percent:.2f}%)"
                )
                return True
```

**–†–ê–°–ß–ï–¢ SL –¥–ª—è BTCUSDT SHORT:**
- Entry: 87867.4 USDT
- SL% –¥–ª—è BTC –≤ ranging: 2.0% (–∏–∑ config_futures.yaml —Å—Ç—Ä–æ–∫–∞ 525)
- SL —Ü–µ–Ω–∞: 87867.4 * (1 + 0.02) = 89624.7 USDT
- –§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π exit: 88688.1 USDT
- **–ü–†–û–ë–õ–ï–ú–ê:** Exit —Ü–µ–Ω–∞ (88688.1) –ù–ò–ñ–ï SL —Ü–µ–Ω—ã (89624.7), –Ω–æ –ø–æ–∑–∏—Ü–∏—è –∑–∞–∫—Ä—ã–ª–∞—Å—å –ø–æ sl_reached. –≠—Ç–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —Ç–æ, —á—Ç–æ:
  1. SL –±—ã–ª —Ä–∞—Å—Å—á–∏—Ç–∞–Ω –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
  2. –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –¥—Ä—É–≥–æ–π SL –ø—Ä–æ—Ü–µ–Ω—Ç
  3. –ò–ª–∏ –ø–æ–∑–∏—Ü–∏—è –±—ã–ª–∞ LONG, –∞ –Ω–µ SHORT

**–¶–ò–¢–ê–¢–ê –ò–ó –ö–û–î–ê (SL –¥–ª—è BTC –≤ ranging):**

```525:525:config/config_futures.yaml
sl_percent: 2.0  # ‚úÖ –ù–û–í–û–ï: –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π SL –¥–ª—è BTC –≤ ranging (–∂–µ—Å—Ç–∫–∏–π —Å—Ç–æ–ø –ø–æ—Å–ª–µ min_holding)
```

**–í–´–í–û–î:** –ï—Å–ª–∏ –ø–æ–∑–∏—Ü–∏—è –±—ã–ª–∞ SHORT —Å entry=87867.4 –∏ SL%=2.0%, —Ç–æ SL –¥–æ–ª–∂–µ–Ω –±—ã–ª —Å—Ä–∞–±–æ—Ç–∞—Ç—å –ø—Ä–∏ —Ü–µ–Ω–µ 89624.7 USDT. –ù–æ –ø–æ–∑–∏—Ü–∏—è –∑–∞–∫—Ä—ã–ª–∞—Å—å –ø—Ä–∏ 88688.1 USDT, —á—Ç–æ –Ω–∏–∂–µ SL. –≠—Ç–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —Ç–æ, —á—Ç–æ –ª–∏–±–æ:
1. –ü–æ–∑–∏—Ü–∏—è –±—ã–ª–∞ LONG (—Ç–æ–≥–¥–∞ —É–±—ã—Ç–æ–∫ -11.27% –æ–±—ä—è—Å–Ω—è–µ—Ç—Å—è –ø–∞–¥–µ–Ω–∏–µ–º —Ü–µ–Ω—ã)
2. SL –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª –≤–æ–≤—Ä–µ–º—è
3. Emergency loss protection —Å—Ä–∞–±–æ—Ç–∞–ª —Ä–∞–Ω—å—à–µ SL

---

### üî¥ –ü–û–ó–ò–¶–ò–Ø #2: XRPUSDT | 30.12.2025, 13:51:47 UTC

**–ë–ê–ó–û–í–´–ï –î–ê–ù–ù–´–ï:**

**–¶–ò–¢–ê–¢–ê –ò–ó CSV:**
```
trades,2025-12-30T13:51:47.671209+00:00,XRP-USDT,long,1.8723,1.8673,124.00000000,-0.6200,0.2319,-0.8519,362.949209,emergency_loss_protection,33.33,,,,,,,,,,,,,,
```

**–°–†–ê–í–ù–ï–ù–ò–ï –° –î–ê–ù–ù–´–ú–ò –ë–ò–†–ñ–ò:**
–í –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –±–∏—Ä–∂–∏ –Ω–µ—Ç –ø–æ–∑–∏—Ü–∏–∏, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–∫—Ä—ã—Ç–∏—è —ç—Ç–æ–π –ø–æ–∑–∏—Ü–∏–∏ (30.12.2025, 15:19:17).

**–ê–ù–ê–õ–ò–ó:**
- Entry: 1.8723 USDT
- Exit: 1.8673 USDT
- PnL%: (1.8673 - 1.8723) / 1.8723 = -0.27%
- –° —É—á–µ—Ç–æ–º –ø–ª–µ—á–∞ 10x: -0.27% * 10 = -2.7% –æ—Ç –º–∞—Ä–∂–∏
- –§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π Net PnL: -0.8519 USDT
- –ü—Ä–∏—á–∏–Ω–∞: emergency_loss_protection
- –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 362.95 —Å–µ–∫ (6 –º–∏–Ω 3 —Å–µ–∫)

**–¶–ò–¢–ê–¢–ê –ò–ó –ö–û–î–ê (Emergency Loss Protection –¥–ª—è ranging):**

```3752:3802:src/strategies/scalping/futures/positions/exit_analyzer.py
emergency_loss_threshold = -2.5  # –î–ª—è ranging —Ä–µ–∂–∏–º–∞ (–±—ã–ª–æ -1.5)

# ‚úÖ –ù–û–í–û–ï (26.12.2025): –£—á–∏—Ç—ã–≤–∞–µ–º spread_buffer –∏ commission_buffer
emergency_spread_buffer = self._get_spread_buffer(symbol, current_price)
emergency_commission_buffer = self._get_commission_buffer(
    position, metadata
)
# –°–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º –ø–æ—Ä–æ–≥ –≤–Ω–∏–∑ (—Å–¥–µ–ª–∞–µ–º –±–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–∏–º), —á—Ç–æ–±—ã —É—á–µ—Å—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ—Ç–µ—Ä–∏ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏
adjusted_emergency_threshold = (
    emergency_loss_threshold
    - emergency_spread_buffer
    - emergency_commission_buffer
)

# ‚úÖ –ù–û–í–û–ï (26.12.2025): –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è —É–¥–µ—Ä–∂–∞–Ω–∏—è –ø–µ—Ä–µ–¥ emergency close
min_holding_seconds = 60.0  # RANGING: 60 —Å–µ–∫—É–Ω–¥ (1 –º–∏–Ω—É—Ç–∞)
if net_pnl_percent < adjusted_emergency_threshold:
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è —É–¥–µ—Ä–∂–∞–Ω–∏—è
    if entry_time:
        try:
            if isinstance(entry_time, str):
                entry_time_dt = datetime.fromisoformat(
                    entry_time.replace("Z", "+00:00")
                )
            else:
                entry_time_dt = entry_time

            # –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ entry_time –≤ UTC
            if entry_time_dt.tzinfo is None:
                entry_time_dt = entry_time_dt.replace(tzinfo=timezone.utc)
            elif entry_time_dt.tzinfo != timezone.utc:
                entry_time_dt = entry_time_dt.astimezone(timezone.utc)

            holding_seconds = (
                datetime.now(timezone.utc) - entry_time_dt
            ).total_seconds()

            if holding_seconds < min_holding_seconds:
                logger.debug(
                    f"‚è≥ ExitAnalyzer RANGING: Emergency close –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –¥–ª—è {symbol} - "
                    f"–≤—Ä–µ–º—è —É–¥–µ—Ä–∂–∞–Ω–∏—è {holding_seconds:.1f}—Å < –º–∏–Ω–∏–º—É–º {min_holding_seconds:.1f}—Å "
                    f"(PnL={net_pnl_percent:.2f}% < –ø–æ—Ä–æ–≥={emergency_loss_threshold:.1f}%)"
                )
                # –ù–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º, –µ—Å–ª–∏ –Ω–µ –ø—Ä–æ—à–ª–æ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è
                return None
        except Exception as e:
            logger.debug(
                f"‚ö†Ô∏è ExitAnalyzer RANGING: –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Ä–µ–º–µ–Ω–∏ —É–¥–µ—Ä–∂–∞–Ω–∏—è –¥–ª—è {symbol}: {e}"
            )
            # –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ —Ä–∞–∑—Ä–µ—à–∞–µ–º emergency close (–±–µ–∑–æ–ø–∞—Å–Ω–µ–µ)

    logger.warning(
        f"üö® ExitAnalyzer RANGING: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —É–±—ã—Ç–æ–∫ {net_pnl_percent:.2f}% –¥–ª—è {symbol} "
        f"(–ø–æ—Ä–æ–≥: {emergency_loss_threshold:.1f}%, —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω: {adjusted_emergency_threshold:.2f}% "
        f"—Å —É—á–µ—Ç–æ–º spread={emergency_spread_buffer:.3f}% + commission={emergency_commission_buffer:.3f}%), "
        f"–≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º —ç–∫—Å—Ç—Ä–µ–Ω–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ (–ø–æ—Å–ª–µ–¥–Ω—è—è –∑–∞—â–∏—Ç–∞ –ø–æ—Å–ª–µ –≤—Å–µ—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫)"
    )
```

**–ê–ù–ê–õ–ò–ó:**
- Emergency loss threshold: -2.5%
- –§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π Net PnL%: -2.7% (—Å —É—á–µ—Ç–æ–º –ø–ª–µ—á–∞ 10x)
- –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 362.95 —Å–µ–∫ > 60 —Å–µ–∫ (–º–∏–Ω–∏–º—É–º –ø—Ä–æ–π–¥–µ–Ω)
- **–í–´–í–û–î:** Emergency loss protection —Å—Ä–∞–±–æ—Ç–∞–ª –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, —Ç–∞–∫ –∫–∞–∫ Net PnL% (-2.7%) –ø—Ä–µ–≤—ã—Å–∏–ª –ø–æ—Ä–æ–≥ (-2.5%)

---

### üî¥ –ü–û–ó–ò–¶–ò–Ø #3: XRPUSDT | 30.12.2025, 18:45:26 UTC

**–ë–ê–ó–û–í–´–ï –î–ê–ù–ù–´–ï:**

**–¶–ò–¢–ê–¢–ê –ò–ó CSV:**
```
trades,2025-12-30T18:45:26.524392+00:00,XRP-USDT,long,1.8836,1.8788,125.00000000,-0.5986,0.2351,-0.8337,494.960396,emergency_loss_protection,27.59,,,,,,,,,,,,,,
```

**–°–†–ê–í–ù–ï–ù–ò–ï –° –î–ê–ù–ù–´–ú–ò –ë–ò–†–ñ–ò:**
–í –¥–∞–Ω–Ω—ã—Ö –±–∏—Ä–∂–∏ —É–∫–∞–∑–∞–Ω–∞ –ø–æ–∑–∏—Ü–∏—è XRPUSDT 21:37:11 —Å entry=1.8836, exit=1.8784, —á—Ç–æ –±–ª–∏–∑–∫–æ –∫ –¥–∞–Ω–Ω—ã–º CSV, –Ω–æ –≤—Ä–µ–º—è –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç.

**–ê–ù–ê–õ–ò–ó:**
- Entry: 1.8836 USDT
- Exit: 1.8788 USDT
- PnL%: (1.8788 - 1.8836) / 1.8836 = -0.25%
- –° —É—á–µ—Ç–æ–º –ø–ª–µ—á–∞ 10x: -0.25% * 10 = -2.5% –æ—Ç –º–∞—Ä–∂–∏
- –§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π Net PnL: -0.8337 USDT
- –ü—Ä–∏—á–∏–Ω–∞: emergency_loss_protection
- –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 494.96 —Å–µ–∫ (8 –º–∏–Ω 15 —Å–µ–∫)

**–í–´–í–û–î:** Emergency loss protection —Å—Ä–∞–±–æ—Ç–∞–ª –Ω–∞ –≥—Ä–∞–Ω–∏—Ü–µ –ø–æ—Ä–æ–≥–∞ (-2.5%), —á—Ç–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Ä–∞–±–æ—Ç—É —Å–∏—Å—Ç–µ–º—ã –∑–∞—â–∏—Ç—ã.

---

## üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê

### –ü–æ –ø–∞—Ä–∞–º:

| –ü–∞—Ä–∞ | –ü–æ–∑–∏—Ü–∏–π | –ü—Ä–∏–±—ã–ª—å–Ω—ã—Ö | –£–±—ã—Ç–æ—á–Ω—ã—Ö | Net PnL | Win Rate |
|------|---------|------------|-----------|---------|----------|
| BTCUSDT | 18 | 4 | 14 | -6.46 USDT | 22.22% |
| ETHUSDT | 7 | 1 | 6 | -2.94 USDT | 14.29% |
| XRPUSDT | 2 | 0 | 2 | -1.61 USDT | 0% |
| SOLUSDT | 3 | 2 | 1 | -0.55 USDT | 66.67% |
| DOGEUSDT | 1 | 1 | 0 | +0.51 USDT | 100% |

### –ü–æ –ø—Ä–∏—á–∏–Ω–∞–º –∑–∞–∫—Ä—ã—Ç–∏—è:

| –ü—Ä–∏—á–∏–Ω–∞ | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ | % |
|---------|-----------|---|
| sl_reached | 23 | 71.88% |
| tp_reached | 8 | 25.00% |
| emergency_loss_protection | 1 | 3.12% |

---

## ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´

### üî¥ –ü–†–û–ë–õ–ï–ú–ê #1: –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–∏ (BTCUSDT 14:50:42)

**–û–ø–∏—Å–∞–Ω–∏–µ:** –í CSV —É–∫–∞–∑–∞–Ω–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ SHORT, –Ω–æ –≤ –¥–∞–Ω–Ω—ã—Ö –±–∏—Ä–∂–∏ —É–∫–∞–∑–∞–Ω–æ LONG –¥–ª—è –ø–æ–∑–∏—Ü–∏–∏ —Å —Ç–µ–º–∏ –∂–µ entry/exit —Ü–µ–Ω–∞–º–∏.

**–í–ª–∏—è–Ω–∏–µ:** –≠—Ç–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫—É—é –æ—à–∏–±–∫—É –≤ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–∏ –∏–ª–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –±–æ—Ç–æ–º –∏ –±–∏—Ä–∂–µ–π.

**–¢—Ä–µ–±—É–µ—Ç—Å—è:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–∏–∫–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–∏ –≤ `position_sync.py` –∏ `position_registry.py`.

### üî¥ –ü–†–û–ë–õ–ï–ú–ê #2: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —É–±—ã—Ç–æ–∫ -11.27% (BTCUSDT 17:47:01)

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü–æ–∑–∏—Ü–∏—è –ø–æ—Ç–µ—Ä—è–ª–∞ -11.27% –≤–º–µ—Å—Ç–æ –æ–∂–∏–¥–∞–µ–º–æ–≥–æ SL ~-2%.

**–ü—Ä–∏—á–∏–Ω—ã:**
1. SL –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª –≤–æ–≤—Ä–µ–º—è: –µ—Å–ª–∏ –ø–æ–∑–∏—Ü–∏—è –±—ã–ª–∞ SHORT, SL –¥–æ–ª–∂–µ–Ω –±—ã–ª —Å—Ä–∞–±–æ—Ç–∞—Ç—å –ø—Ä–∏ 89624.7 USDT, –Ω–æ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–æ–∏–∑–æ—à–ª–æ –ø—Ä–∏ 88688.1 USDT
2. Emergency loss protection —Å—Ä–∞–±–æ—Ç–∞–ª —Å–ª–∏—à–∫–æ–º –ø–æ–∑–¥–Ω–æ: –ø–æ—Ä–æ–≥ -2.5%, –Ω–æ —É–±—ã—Ç–æ–∫ –¥–æ—Å—Ç–∏–≥ -11.27%
3. Entry price –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ (87867.4) –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç entry price –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ (88002.3), —á—Ç–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏

**–¶–ò–¢–ê–¢–ê –ò–ó –ö–û–î–ê (–ü—Ä–æ–≤–µ—Ä–∫–∞ SL –¥–ª—è SHORT):**

```1390:1450:src/strategies/scalping/futures/positions/stop_loss_manager.py
if side == "short":
    # –î–ª—è SHORT: —Ü–µ–Ω–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –í–´–®–ï entry * (1 + sl_percent)
    sl_price = entry_price * (1 + sl_percent)
    if current_price >= sl_price:
        logger.warning(
            f"üõë SL –¥–æ—Å—Ç–∏–≥–Ω—É—Ç –¥–ª—è {symbol} SHORT: "
            f"—Ü–µ–Ω–∞={current_price:.2f} >= SL={sl_price:.2f} "
            f"(entry={entry_price:.2f}, sl_percent={sl_percent:.2f}%)"
        )
        return True
```

**–¢–†–ï–ë–£–ï–¢–°–Ø:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è, –ø–æ—á–µ–º—É SL –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –ø–æ—Ä–æ–≥–∞.

### üî¥ –ü–†–û–ë–õ–ï–ú–ê #3: –í—ã—Å–æ–∫–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç —É–±—ã—Ç–æ—á–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π (78.12%)

**–û–ø–∏—Å–∞–Ω–∏–µ:** 25 –∏–∑ 32 –ø–æ–∑–∏—Ü–∏–π –∑–∞–∫—Ä—ã–ª–∏—Å—å —Å —É–±—ã—Ç–∫–æ–º.

**–ü—Ä–∏—á–∏–Ω—ã:**
1. –°–ª–∞–±—ã–µ —Å–∏–≥–Ω–∞–ª—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —Ñ–∏–ª—å—Ç—Ä—ã
2. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ —Ä—ã–Ω–∫–∞
3. SL —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–ª–∏—à–∫–æ–º —á–∞—Å—Ç–æ –∏–∑-–∑–∞ —É–∑–∫–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

**–¢–†–ï–ë–£–ï–¢–°–Ø:** –ê–Ω–∞–ª–∏–∑ —Å–∏–≥–Ω–∞–ª–æ–≤ –∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–π —É–±—ã—Ç–æ—á–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏.

---

## üìù –ü–†–ò–ú–ï–ß–ê–ù–ò–Ø

**–í–ê–ñ–ù–û:** –î–ª—è –ø–æ–ª–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ —Ç—Ä–µ–±—É–µ—Ç—Å—è:

1. –¢–æ—á–Ω–æ–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –º–µ—Ç–æ–∫ –º–µ–∂–¥—É CSV –∏ –¥–∞–Ω–Ω—ã–º–∏ –±–∏—Ä–∂–∏ (–≤–æ–∑–º–æ–∂–Ω—ã —Ä–∞–∑–ª–∏—á–∏—è –≤ —á–∞—Å–æ–≤—ã—Ö –ø–æ—è—Å–∞—Ö)
2. –î–æ—Å—Ç—É–ø –∫ –ø–æ–ª–Ω—ã–º –ª–æ–≥–∞–º –¥–ª—è –∫–∞–∂–¥–æ–π –ø–æ–∑–∏—Ü–∏–∏
3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π –ø–æ–∑–∏—Ü–∏–π (CSV –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç SHORT, –¥–∞–Ω–Ω—ã–µ –±–∏—Ä–∂–∏ - LONG –¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –ø–æ–∑–∏—Ü–∏–π)

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –ü–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –ø–æ–ª–Ω—ã–º –ª–æ–≥–∞–º –∏ –ø—Ä–æ–≤–µ—Å—Ç–∏ –¥–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∫–∞–∂–¥–æ–π –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –ø–æ–∑–∏—Ü–∏–∏ –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É –æ—Ç—á–µ—Ç—É.

---

---

---

## üîç –ê–ù–ê–õ–ò–ó –ü–†–ï–û–ë–†–ê–ó–û–í–ê–ù–ò–Ø –ù–ê–ü–†–ê–í–õ–ï–ù–ò–Ø –ü–û–ó–ò–¶–ò–ò (SIDE)

**–í–ê–ñ–ù–û:** –ü—Ä–æ–≤–µ–¥–µ–Ω –¥–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è `side` –∏–∑ —Å–∏–≥–Ω–∞–ª–∞ (buy/sell) –≤ –ø–æ–∑–∏—Ü–∏—é (long/short) –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è.

**–î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Å–º.:** `docs/analysis/reports/2025-12/–ê–ù–ê–õ–ò–ó_–ü–†–ï–û–ë–†–ê–ó–û–í–ê–ù–ò–Ø_SIDE.md`

### –ö—Ä–∞—Ç–∫–∏–π –≤—ã–≤–æ–¥:

**–¶–ò–¢–ê–¢–ê –ò–ó –ö–û–î–ê (–ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –¥–ª—è –±–∏—Ä–∂–∏):**
```1194:1198:src/clients/futures_client.py
# –î–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –Ω–æ–≤—ã—Ö –ø–æ–∑–∏—Ü–∏–π –¥–æ–±–∞–≤–ª—è–µ–º posSide
if side.lower() == "buy":
    payload["posSide"] = "long"
elif side.lower() == "sell":
    payload["posSide"] = "short"
```

**–¶–ò–¢–ê–¢–ê –ò–ó –ö–û–î–ê (–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ CSV):**
```657:657:src/strategies/scalping/futures/positions/entry_manager.py
side=position_data.get("position_side", "long"),
```

**–¶–ò–¢–ê–¢–ê –ò–ó –ö–û–î–ê (–ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ position_side –∏–∑ —Å–∏–≥–Ω–∞–ª–∞):**
```498:503:src/strategies/scalping/futures/positions/entry_manager.py
"posSide": "long" if side == "buy" else "short",
...
"position_side": "long" if side == "buy" else "short",
```

**–ê–ù–ê–õ–ò–ó –¶–ï–ü–û–ß–ö–ò:**
1. ‚úÖ –°–∏–≥–Ω–∞–ª: `side="sell"` (–∏–∑ CSV)
2. ‚úÖ Order Executor: `side="sell"` (–ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
3. ‚úÖ Futures Client: `side="sell"` ‚Üí `posSide="short"` (–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ)
4. ‚úÖ –ë–∏—Ä–∂–∞: –î–æ–ª–∂–Ω–∞ –ø–æ–ª—É—á–∏—Ç—å `posSide="short"`
5. ‚úÖ Entry Manager: –ß–∏—Ç–∞–µ—Ç `posSide` —Å –±–∏—Ä–∂–∏ ‚Üí `position_side="short"`
6. ‚úÖ CSV (positions_open): `side="short"` (–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ)

**–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –í–´–í–û–î:** –õ–æ–≥–∏–∫–∞ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è `side` –∏–∑ —Å–∏–≥–Ω–∞–ª–∞ –≤ –ø–æ–∑–∏—Ü–∏—é –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –≤–æ –≤—Å–µ—Ö –∑–≤–µ–Ω—å—è—Ö —Ü–µ–ø–æ—á–∫–∏. –ö–æ–¥ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –æ—à–∏–±–æ–∫. –ü—Ä–æ–±–ª–µ–º–∞ –ù–ï –≤ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–∏ side –≤ –∫–æ–¥–µ –±–æ—Ç–∞. –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –º–µ–∂–¥—É CSV (SHORT) –∏ –¥–∞–Ω–Ω—ã–º–∏ –±–∏—Ä–∂–∏ (LONG) –≤—ã–∑–≤–∞–Ω–æ –æ–¥–Ω–∏–º –∏–∑ —Å–ª–µ–¥—É—é—â–∏—Ö:
1. –ü–æ–∑–∏—Ü–∏—è –±—ã–ª–∞ –∏–∑–º–µ–Ω–µ–Ω–∞ –≤—Ä—É—á–Ω—É—é –Ω–∞ –±–∏—Ä–∂–µ –ø–æ—Å–ª–µ –æ—Ç–∫—Ä—ã—Ç–∏—è
2. –û—à–∏–±–∫–∞ –≤ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö (—Ä–∞–∑–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –∏–ª–∏ –≤—Ä–µ–º—è)
3. –ü–æ–∑–∏—Ü–∏—è –±—ã–ª–∞ —á–∞—Å—Ç–∏—á–Ω–æ –∑–∞–∫—Ä—ã—Ç–∞ –∏ –ø–µ—Ä–µ–æ—Ç–∫—Ä—ã—Ç–∞ –≤ –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏

---

## üìÅ –°–ü–ò–°–û–ö –ü–†–û–ê–ù–ê–õ–ò–ó–ò–†–û–í–ê–ù–ù–´–• –§–ê–ô–õ–û–í

### ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –§–ê–ô–õ–´ (–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞)

1. **`src/strategies/scalping/futures/positions/exit_analyzer.py`** (—Å—Ç—Ä–æ–∫–∏ 3750-3828)
   - **–ü—Ä–∏—á–∏–Ω–∞ –≤–∫–ª—é—á–µ–Ω–∏—è:** –ö—Ä–∏—Ç–∏—á–µ–Ω –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –ª–æ–≥–∏–∫–∏ emergency_loss_protection
   - **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ:** –ê–Ω–∞–ª–∏–∑ –ø–æ—Ä–æ–≥–∞ emergency_loss_threshold (-2.5% –¥–ª—è ranging —Ä–µ–∂–∏–º–∞)
   - **–ù–∞–π–¥–µ–Ω–æ:** Emergency loss protection —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä–∏ net_pnl_percent < adjusted_emergency_threshold –ø–æ—Å–ª–µ min_holding_seconds (60 —Å–µ–∫)

2. **`src/strategies/scalping/futures/positions/stop_loss_manager.py`** (—Å—Ç—Ä–æ–∫–∏ 78-224)
   - **–ü—Ä–∏—á–∏–Ω–∞ –≤–∫–ª—é—á–µ–Ω–∏—è:** –ö—Ä–∏—Ç–∏—á–µ–Ω –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –ª–æ–≥–∏–∫–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ SL
   - **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ:** –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ SL –¥–ª—è SHORT –ø–æ–∑–∏—Ü–∏–π
   - **–ù–∞–π–¥–µ–Ω–æ:** TSL –ù–ï –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫—É SL (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç 30.12.2025)

3. **`src/strategies/scalping/futures/core/position_sync.py`** (—Å—Ç—Ä–æ–∫–∏ 146-148)
   - **–ü—Ä–∏—á–∏–Ω–∞ –≤–∫–ª—é—á–µ–Ω–∏—è:** –ö—Ä–∏—Ç–∏—á–µ–Ω –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–∏
   - **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ:** –ê–Ω–∞–ª–∏–∑ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è (SHORT vs LONG)
   - **–ù–∞–π–¥–µ–Ω–æ:** pos_side –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∏–∑ `pos.get("posSide", "").lower()`, fallback –ø–æ –∑–Ω–∞–∫—É pos_size

4. **`logs/futures/archived/logs_2025-12-30_22-06-26/all_data_2025-12-30.csv`**
   - **–ü—Ä–∏—á–∏–Ω–∞ –≤–∫–ª—é—á–µ–Ω–∏—è:** –û—Å–Ω–æ–≤–Ω–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–∑–∏—Ü–∏—è—Ö
   - **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ:** –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–ø–∏—Å–µ–π –æ –ø–æ–∑–∏—Ü–∏—è—Ö, —Å–∏–≥–Ω–∞–ª–∞—Ö, –æ—Ä–¥–µ—Ä–∞—Ö
   - **–ù–∞–π–¥–µ–Ω–æ:** 32 –∑–∞–∫—Ä—ã—Ç—ã–µ –ø–æ–∑–∏—Ü–∏–∏, 1 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è (BTCUSDT -11.27%)

### üü° –í–ê–ñ–ù–´–ï –§–ê–ô–õ–´ (–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã —á–∞—Å—Ç–∏—á–Ω–æ)

5. **`src/strategies/scalping/futures/position_manager.py`** (—Å—Ç—Ä–æ–∫–∏ 2410-2415, 4142-4171)
   - **–ü—Ä–∏—á–∏–Ω–∞ –≤–∫–ª—é—á–µ–Ω–∏—è:** –í–∞–∂–µ–Ω –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è —Ä–∞—Å—á–µ—Ç–∞ PnL –∏ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–π
   - **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ:** –ê–Ω–∞–ª–∏–∑ —Ä–∞—Å—á–µ—Ç–∞ PnL –¥–ª—è SHORT/LONG –ø–æ–∑–∏—Ü–∏–π
   - **–ù–∞–π–¥–µ–Ω–æ:** PnL% —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø–æ-—Ä–∞–∑–Ω–æ–º—É –¥–ª—è LONG –∏ SHORT

6. **`src/strategies/scalping/futures/coordinators/exit_decision_coordinator.py`** (—Å—Ç—Ä–æ–∫–∏ 31-41)
   - **–ü—Ä–∏—á–∏–Ω–∞ –≤–∫–ª—é—á–µ–Ω–∏—è:** –í–∞–∂–µ–Ω –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤ –∑–∞–∫—Ä—ã—Ç–∏—è
   - **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ:** –ê–Ω–∞–ª–∏–∑ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ emergency_loss_protection (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1)
   - **–ù–∞–π–¥–µ–Ω–æ:** Emergency loss protection –∏–º–µ–µ—Ç –Ω–∞–∏–≤—ã—Å—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (1)

### ‚ùå –ò–ì–ù–û–†–ò–†–û–í–ê–ù–ù–´–ï –§–ê–ô–õ–´ (–ü—Ä–∏—á–∏–Ω—ã –∏—Å–∫–ª—é—á–µ–Ω–∏—è)

1. **`src/strategies/scalping/spot/orchestrator.py`**
   - **–ü—Ä–∏—á–∏–Ω–∞:** –û—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ Spot —Ç–æ—Ä–≥–æ–≤–ª–µ, –Ω–µ –∫ Futures

2. **`src/tests/`** (–≤—Å–µ —Ñ–∞–π–ª—ã)
   - **–ü—Ä–∏—á–∏–Ω–∞:** –¢–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã, –Ω–µ –≤–ª–∏—è—é—Ç –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω –ª–æ–≥–∏–∫—É

3. **`src/old/`** (–≤—Å–µ —Ñ–∞–π–ª—ã)
   - **–ü—Ä–∏—á–∏–Ω–∞:** –£—Å—Ç–∞—Ä–µ–≤—à–∏–µ –≤–µ—Ä—Å–∏–∏ –∫–æ–¥–∞

4. **`venv/`**
   - **–ü—Ä–∏—á–∏–Ω–∞:** –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ, –Ω–µ –∫–æ–¥

5. **`docs/`** (–∫—Ä–æ–º–µ –æ—Ç—á–µ—Ç–æ–≤)
   - **–ü—Ä–∏—á–∏–Ω–∞:** –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è, –Ω–µ –∫–æ–¥

---

## üîç –î–ï–¢–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó –ö–†–ò–¢–ò–ß–ï–°–ö–û–ô –ü–û–ó–ò–¶–ò–ò BTCUSDT 17:47:01

### üìä –ë–ê–ó–û–í–´–ï –î–ê–ù–ù–´–ï

**–¶–ò–¢–ê–¢–ê –ò–ó CSV (—Å—Ç—Ä–æ–∫–∞ 265):**
```
trades,2025-12-30T14:50:42.309190+00:00,BTC-USDT,short,87867.4000,88688.1000,0.00280000,-2.2980,0.2472,-2.5451,221.138612,sl_reached,29.17
```

**–¶–ò–¢–ê–¢–ê –ò–ó CSV (—Å–∏–≥–Ω–∞–ª –∏ –æ—Ç–∫—Ä—ã—Ç–∏–µ):**
```
signals,2025-12-30T14:46:33.444558,BTC-USDT,sell,,,,,,,,,,ranging,,,87740.17200000,1.0000,"ADX,MTF,Correlation,PivotPoints,VolumeProfile,Liquidity,OrderFlow,FundingRate",0
orders,2025-12-30T14:46:39.751720,BTC-USDT,sell,,,0.00280000,,,,,,,,3174370048585834496,limit,88002.30000000,,,,placed
positions_open,2025-12-30T14:46:45.478329,BTC-USDT,short,88002.30000000,,0.00280000,,,,,,,ranging,3174370048585834496,limit
```

**–¶–ò–¢–ê–¢–ê –ò–ó –î–ê–ù–ù–´–• –ë–ò–†–ñ–ò:**
```
30.12.2025, 17:47:01 | BTCUSDT | LONG | –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è (10x)
–í—Ö–æ–¥–Ω–∞—è —Ü–µ–Ω–∞: 87 867,4
–¶–µ–Ω–∞ –≤—ã—Ö–æ–¥–∞: 88 768,9
–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ PnL: -2,78 USDT (-11,27 %)
–ó–∞–∫—Ä—ã—Ç—ã–µ PnL: -2,53 USDT
–ö–æ–º–∏—Å—Å–∏—è: -0,24729082 USDT
```

### üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ù–ï–°–û–û–¢–í–ï–¢–°–¢–í–ò–ï #1: –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏

**–ü—Ä–æ–±–ª–µ–º–∞:** –í CSV —É–∫–∞–∑–∞–Ω–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ SHORT, –Ω–æ –≤ –¥–∞–Ω–Ω—ã—Ö –±–∏—Ä–∂–∏ —É–∫–∞–∑–∞–Ω–æ LONG.

**–î–ï–¢–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó –ü–†–ï–û–ë–†–ê–ó–û–í–ê–ù–ò–Ø SIDE:**

#### 1. –¶–µ–ø–æ—á–∫–∞ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è (–ø—Ä–æ–≤–µ—Ä–µ–Ω–∞ –ø–æ –∫–æ–¥—É):

**–¶–ò–¢–ê–¢–ê –ò–ó –ö–û–î–ê (–ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –¥–ª—è –±–∏—Ä–∂–∏):**
```1194:1198:src/clients/futures_client.py
# –î–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –Ω–æ–≤—ã—Ö –ø–æ–∑–∏—Ü–∏–π –¥–æ–±–∞–≤–ª—è–µ–º posSide
if side.lower() == "buy":
    payload["posSide"] = "long"
elif side.lower() == "sell":
    payload["posSide"] = "short"
```

**–¶–ò–¢–ê–¢–ê –ò–ó –ö–û–î–ê (–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ CSV):**
```657:657:src/strategies/scalping/futures/positions/entry_manager.py
side=position_data.get("position_side", "long"),
```

**–¶–ò–¢–ê–¢–ê –ò–ó –ö–û–î–ê (–ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ position_side –∏–∑ —Å–∏–≥–Ω–∞–ª–∞):**
```498:503:src/strategies/scalping/futures/positions/entry_manager.py
"posSide": "long" if side == "buy" else "short",
...
"position_side": "long" if side == "buy" else "short",
```

**–ê–ù–ê–õ–ò–ó –¶–ï–ü–û–ß–ö–ò:**
1. ‚úÖ –°–∏–≥–Ω–∞–ª: `side="sell"` (–∏–∑ CSV)
2. ‚úÖ Order Executor: `side="sell"` (–ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
3. ‚úÖ Futures Client: `side="sell"` ‚Üí `posSide="short"` (–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ)
4. ‚úÖ –ë–∏—Ä–∂–∞: –î–æ–ª–∂–Ω–∞ –ø–æ–ª—É—á–∏—Ç—å `posSide="short"`
5. ‚úÖ Entry Manager: –ß–∏—Ç–∞–µ—Ç `posSide` —Å –±–∏—Ä–∂–∏ ‚Üí `position_side="short"`
6. ‚úÖ CSV (positions_open): `side="short"` (–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ)

**–í–´–í–û–î:** –õ–æ–≥–∏–∫–∞ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è `side` –∏–∑ —Å–∏–≥–Ω–∞–ª–∞ –≤ –ø–æ–∑–∏—Ü–∏—é –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –≤–æ –≤—Å–µ—Ö –∑–≤–µ–Ω—å—è—Ö —Ü–µ–ø–æ—á–∫–∏. –ö–æ–¥ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –æ—à–∏–±–æ–∫.

#### 2. –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è:

**–¶–ò–¢–ê–¢–ê –ò–ó –ö–û–î–ê (–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏):**
```146:148:src/strategies/scalping/futures/core/position_sync.py
pos_side = pos.get("posSide", "").lower()
if pos_side not in ["long", "short"]:
    pos_side = "long" if pos_size > 0 else "short"
```

**–í–û–ó–ú–û–ñ–ù–´–ï –°–¶–ï–ù–ê–†–ò–ò:**

1. **–ü–æ–∑–∏—Ü–∏—è –±—ã–ª–∞ –∏–∑–º–µ–Ω–µ–Ω–∞ –≤—Ä—É—á–Ω—É—é –Ω–∞ –±–∏—Ä–∂–µ**
   - –ü–æ–∑–∏—Ü–∏—è –±—ã–ª–∞ –æ—Ç–∫—Ä—ã—Ç–∞ –∫–∞–∫ SHORT (–∫–∞–∫ –∑–∞–ø–∏—Å–∞–Ω–æ –≤ CSV)
   - –ó–∞—Ç–µ–º –∏–∑–º–µ–Ω–µ–Ω–∞ –Ω–∞ LONG –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –±–∏—Ä–∂–∏
   - –≠—Ç–æ –æ–±—ä—è—Å–Ω—è–µ—Ç –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ

2. **–†–∞–∑–Ω–∏—Ü–∞ –≤ entry price**
   - Entry price –≤ CSV (88002.3) –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç entry price –≤ –¥–∞–Ω–Ω—ã—Ö –±–∏—Ä–∂–∏ (87867.4)
   - –†–∞–∑–Ω–∏—Ü–∞ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç 134.9 USDT (0.15%)
   - –≠—Ç–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —Ç–æ, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –æ—Ç–Ω–æ—Å—è—Ç—Å—è –∫ —Ä–∞–∑–Ω—ã–º –º–æ–º–µ–Ω—Ç–∞–º –≤—Ä–µ–º–µ–Ω–∏ –∏–ª–∏ –ø–æ–∑–∏—Ü–∏—è –±—ã–ª–∞ –∏–∑–º–µ–Ω–µ–Ω–∞

3. **–ü–æ–∑–∏—Ü–∏—è –±—ã–ª–∞ –∏–∑–º–µ–Ω–µ–Ω–∞**
   - Entry price –∏–∑–º–µ–Ω–∏–ª—Å—è —Å 88002.3 –Ω–∞ 87867.4
   - –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å —Å SHORT (CSV) –Ω–∞ LONG (–¥–∞–Ω–Ω—ã–µ –±–∏—Ä–∂–∏)
   - –≠—Ç–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —Ç–æ, —á—Ç–æ –ø–æ–∑–∏—Ü–∏—è –±—ã–ª–∞ –∏–∑–º–µ–Ω–µ–Ω–∞ (—á–∞—Å—Ç–∏—á–Ω–æ –∑–∞–∫—Ä—ã—Ç–∞ –∏ –ø–µ—Ä–µ–æ—Ç–∫—Ä—ã—Ç–∞, –∏–ª–∏ –∑–∞–∫—Ä—ã—Ç–∞ –∏ –æ—Ç–∫—Ä—ã—Ç–∞ –Ω–æ–≤–∞—è)

4. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è payload**
   - –í –∫–æ–¥–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ payload –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –Ω–∞ –±–∏—Ä–∂—É (—Å—Ç—Ä–æ–∫–∏ 1166-1220 futures_client.py)
   - –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –∫–∞–∫–æ–π –∏–º–µ–Ω–Ω–æ `posSide` –±—ã–ª –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –±–∏—Ä–∂—É –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –æ—Ä–¥–µ—Ä–∞

**–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê –í –ö–û–î–ï:**

**–¶–ò–¢–ê–¢–ê –ò–ó –ö–û–î–ê (fallback –ª–æ–≥–∏–∫–∞, —Å—Ç—Ä–æ–∫–∏ 475-503 entry_manager.py):**
```475:503:src/strategies/scalping/futures/positions/entry_manager.py
# –ï—Å–ª–∏ –≤—Å—ë –µ—â—ë –Ω–µ –Ω–∞—à–ª–∏ ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º order_result.price (–ª–∏–º–∏—Ç–Ω–∞—è —Ü–µ–Ω–∞)
if not position_data:
    side = signal.get("side", "").lower()
    position_data = {
        "posSide": "long" if side == "buy" else "short",  # ‚ö†Ô∏è –ü–†–û–ë–õ–ï–ú–ê: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è side –∏–∑ —Å–∏–≥–Ω–∞–ª–∞!
        "position_side": "long" if side == "buy" else "short",  # ‚ö†Ô∏è –ü–†–û–ë–õ–ï–ú–ê: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è side –∏–∑ —Å–∏–≥–Ω–∞–ª–∞!
    }
```

**–ü–†–û–ë–õ–ï–ú–ê:** –ï—Å–ª–∏ –ø–æ–∑–∏—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –Ω–∞ –±–∏—Ä–∂–µ –ø–æ—Å–ª–µ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –æ—Ä–¥–µ—Ä–∞, –±–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç fallback –ª–æ–≥–∏–∫—É –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `position_side` –Ω–∞ –æ—Å–Ω–æ–≤–µ `side` –∏–∑ —Å–∏–≥–Ω–∞–ª–∞, –∞ –Ω–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–π –ø–æ–∑–∏—Ü–∏–∏ –Ω–∞ –±–∏—Ä–∂–µ. –≠—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—é `side` –≤ CSV, –µ—Å–ª–∏ –ø–æ–∑–∏—Ü–∏—è –Ω–µ –±—ã–ª–∞ –Ω–∞–π–¥–µ–Ω–∞ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –æ—Ä–¥–µ—Ä–∞.

**–¶–ò–¢–ê–¢–ê –ò–ó –ö–û–î–ê (—á—Ç–µ–Ω–∏–µ posSide —Å –±–∏—Ä–∂–∏, —Å—Ç—Ä–æ–∫–∏ 298-326 entry_manager.py):**
```298:326:src/strategies/scalping/futures/positions/entry_manager.py
positions = await client.get_positions()
for pos in positions:
    if (pos_inst_id == inst_id or pos_inst_id == symbol) and pos_size > 0.000001:
        pos_side_raw = pos.get("posSide", "").lower()
        if pos_side_raw in ["long", "short"]:
            position_side = pos_side_raw
```

**–ü–†–û–ë–õ–ï–ú–ê:** –ë–æ—Ç –ø–µ—Ä–µ–±–∏—Ä–∞–µ—Ç –≤—Å–µ –ø–æ–∑–∏—Ü–∏–∏ –∏ –≤—ã–±–∏—Ä–∞–µ—Ç –ø–µ—Ä–≤—É—é –Ω–∞–π–¥–µ–Ω–Ω—É—é, –∫–æ—Ç–æ—Ä–∞—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å–∏–º–≤–æ–ª—É –∏ –∏–º–µ–µ—Ç —Ä–∞–∑–º–µ—Ä > 0.000001. –ö–æ–¥ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `order_id` –¥–ª—è —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –æ—Ç–∫—Ä—ã—Ç–æ–≥–æ –æ—Ä–¥–µ—Ä–∞ —Å –ø–æ–∑–∏—Ü–∏–µ–π –Ω–∞ –±–∏—Ä–∂–µ. –ï—Å–ª–∏ –Ω–∞ –±–∏—Ä–∂–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–∑–∏—Ü–∏–π –ø–æ –æ–¥–Ω–æ–º—É —Å–∏–º–≤–æ–ª—É (LONG –∏ SHORT), –±–æ—Ç –≤—ã–±–µ—Ä–µ—Ç –ø–µ—Ä–≤—É—é –Ω–∞–π–¥–µ–Ω–Ω—É—é, –∞ –Ω–µ —Ç—É, –∫–æ—Ç–æ—Ä–∞—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ—Ç–∫—Ä—ã—Ç–æ–º—É –æ—Ä–¥–µ—Ä—É.

**–§–ò–ù–ê–õ–¨–ù–´–ô –í–´–í–û–î:** –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ `side` –∏–∑ —Å–∏–≥–Ω–∞–ª–∞ –≤ `posSide` –¥–ª—è –±–∏—Ä–∂–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ (—Å—Ç—Ä–æ–∫–∏ 1194-1198 futures_client.py). –ü—Ä–æ–±–ª–µ–º—ã –≤ –ª–æ–≥–∏–∫–µ —á—Ç–µ–Ω–∏—è `posSide` —Å –±–∏—Ä–∂–∏ –∏ fallback –ª–æ–≥–∏–∫–µ –ø—Ä–∏–≤–æ–¥—è—Ç –∫ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—é `side` –≤ CSV. –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –º–µ–∂–¥—É CSV (SHORT) –∏ –¥–∞–Ω–Ω—ã–º–∏ –±–∏—Ä–∂–∏ (LONG) –≤—ã–∑–≤–∞–Ω–æ:

1. **Fallback –ª–æ–≥–∏–∫–∞ (—Å—Ç—Ä–æ–∫–∏ 475-503 entry_manager.py):** –ï—Å–ª–∏ –ø–æ–∑–∏—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –Ω–∞ –±–∏—Ä–∂–µ, –±–æ—Ç —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `position_side` –Ω–∞ –æ—Å–Ω–æ–≤–µ `side` –∏–∑ —Å–∏–≥–Ω–∞–ª–∞ (`sell` ‚Üí `short`), –∞ –Ω–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–π –ø–æ–∑–∏—Ü–∏–∏ –Ω–∞ –±–∏—Ä–∂–µ.

2. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –ø–æ order_id (—Å—Ç—Ä–æ–∫–∏ 298-326 entry_manager.py):** –ë–æ—Ç –≤—ã–±–∏—Ä–∞–µ—Ç –ø–µ—Ä–≤—É—é –Ω–∞–π–¥–µ–Ω–Ω—É—é –ø–æ–∑–∏—Ü–∏—é –ø–æ —Å–∏–º–≤–æ–ª—É –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `order_id` –¥–ª—è —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è. –ï—Å–ª–∏ –Ω–∞ –±–∏—Ä–∂–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–∑–∏—Ü–∏–π –ø–æ –æ–¥–Ω–æ–º—É —Å–∏–º–≤–æ–ª—É (LONG –∏ SHORT), –±–æ—Ç –≤—ã–±–µ—Ä–µ—Ç –ø–µ—Ä–≤—É—é –Ω–∞–π–¥–µ–Ω–Ω—É—é, –∞ –Ω–µ —Ç—É, –∫–æ—Ç–æ—Ä–∞—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ—Ç–∫—Ä—ã—Ç–æ–º—É –æ—Ä–¥–µ—Ä—É.

3. **Race condition:** –ü–æ–∑–∏—Ü–∏—è –Ω–µ –±—ã–ª–∞ –Ω–∞–π–¥–µ–Ω–∞ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –æ—Ä–¥–µ—Ä–∞ (1 —Å–µ–∫—É–Ω–¥–∞ –∑–∞–¥–µ—Ä–∂–∫–∞ –≤ –∫–æ–¥–µ, —Å—Ç—Ä–æ–∫–∞ 296 entry_manager.py), –∏ –±–æ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª fallback –ª–æ–≥–∏–∫—É.

### üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ù–ï–°–û–û–¢–í–ï–¢–°–¢–í–ò–ï #2: Entry price –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ vs –∑–∞–∫—Ä—ã—Ç–∏–∏

**–ü—Ä–æ–±–ª–µ–º–∞:** Entry price –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ (88002.3) –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å entry price –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ (87867.4).

**–ê–ù–ê–õ–ò–ó:** –†–∞–∑–Ω–∏—Ü–∞ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç 134.9 USDT (0.15%). –≠—Ç–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —Ç–æ, —á—Ç–æ:
1. –ü–æ–∑–∏—Ü–∏—è –±—ã–ª–∞ –∏–∑–º–µ–Ω–µ–Ω–∞ (—á–∞—Å—Ç–∏—á–Ω–æ –∑–∞–∫—Ä—ã—Ç–∞ –∏ –ø–µ—Ä–µ–æ—Ç–∫—Ä—ã—Ç–∞, –∏–ª–∏ –∑–∞–∫—Ä—ã—Ç–∞ –∏ –æ—Ç–∫—Ä—ã—Ç–∞ –Ω–æ–≤–∞—è)
2. –î–∞–Ω–Ω—ã–µ –æ—Ç–Ω–æ—Å—è—Ç—Å—è –∫ —Ä–∞–∑–Ω—ã–º –º–æ–º–µ–Ω—Ç–∞–º –≤—Ä–µ–º–µ–Ω–∏
3. Entry price –±—ã–ª –∏–∑–º–µ–Ω–µ–Ω –Ω–∞ –±–∏—Ä–∂–µ (scaling –∏–ª–∏ –¥—Ä—É–≥–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏)

### üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê #3: –£–±—ã—Ç–æ–∫ -11.27% –≤–º–µ—Å—Ç–æ –æ–∂–∏–¥–∞–µ–º–æ–≥–æ SL ~-2%

**–†–ê–°–ß–ï–¢ –î–õ–Ø SHORT –ü–û–ó–ò–¶–ò–ò:**
- Entry: 87867.4 USDT
- Exit: 88688.1 USDT
- PnL% –æ—Ç —Ü–µ–Ω—ã: (87867.4 - 88688.1) / 87867.4 = -0.93%
- –° —É—á–µ—Ç–æ–º –ø–ª–µ—á–∞ 10x: -0.93% * 10 = -9.3% –æ—Ç –º–∞—Ä–∂–∏
- –§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —É–±—ã—Ç–æ–∫: -11.27% –æ—Ç –º–∞—Ä–∂–∏

**–¶–ò–¢–ê–¢–ê –ò–ó –ö–û–î–ê (—Ä–∞—Å—á–µ—Ç PnL –¥–ª—è SHORT):**
```2410:2415:src/strategies/scalping/futures/position_manager.py
if side.lower() == "long":
    pnl_pct = (current_price - entry_price) / entry_price
else:
    pnl_pct = (entry_price - current_price) / entry_price
```

**–†–ê–°–ß–ï–¢ SL –î–õ–Ø BTCUSDT SHORT:**
- Entry: 87867.4 USDT
- SL% –¥–ª—è BTC –≤ ranging: 2.0% (–∏–∑ config_futures.yaml)
- SL —Ü–µ–Ω–∞: 87867.4 * (1 + 0.02) = 89624.7 USDT
- –§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π exit: 88688.1 USDT
- **–ü–†–û–ë–õ–ï–ú–ê:** Exit —Ü–µ–Ω–∞ (88688.1) –ù–ò–ñ–ï SL —Ü–µ–Ω—ã (89624.7), –Ω–æ –ø–æ–∑–∏—Ü–∏—è –∑–∞–∫—Ä—ã–ª–∞—Å—å –ø–æ sl_reached

**–¶–ò–¢–ê–¢–ê –ò–ó –ö–û–î–ê (Emergency Loss Protection):**
```3752:3768:src/strategies/scalping/futures/positions/exit_analyzer.py
emergency_loss_threshold = -2.5  # –î–ª—è ranging —Ä–µ–∂–∏–º–∞ (–±—ã–ª–æ -1.5)

# ‚úÖ –ù–û–í–û–ï (26.12.2025): –£—á–∏—Ç—ã–≤–∞–µ–º spread_buffer –∏ commission_buffer
emergency_spread_buffer = self._get_spread_buffer(symbol, current_price)
emergency_commission_buffer = self._get_commission_buffer(
    position, metadata
)
# –°–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º –ø–æ—Ä–æ–≥ –≤–Ω–∏–∑ (—Å–¥–µ–ª–∞–µ–º –±–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–∏–º), —á—Ç–æ–±—ã —É—á–µ—Å—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ—Ç–µ—Ä–∏ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏
adjusted_emergency_threshold = (
    emergency_loss_threshold
    - emergency_spread_buffer
    - emergency_commission_buffer
)

# ‚úÖ –ù–û–í–û–ï (26.12.2025): –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è —É–¥–µ—Ä–∂–∞–Ω–∏—è –ø–µ—Ä–µ–¥ emergency close
min_holding_seconds = 60.0  # RANGING: 60 —Å–µ–∫—É–Ω–¥ (1 –º–∏–Ω—É—Ç–∞)
if net_pnl_percent < adjusted_emergency_threshold:
```

**–ê–ù–ê–õ–ò–ó:**
- Emergency loss threshold: -2.5%
- –§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —É–±—ã—Ç–æ–∫: -11.27% (–ø—Ä–µ–≤—ã—à–∞–µ—Ç –ø–æ—Ä–æ–≥ –≤ 4.5 —Ä–∞–∑–∞!)
- –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 221 —Å–µ–∫—É–Ω–¥ (3 –º–∏–Ω 41 —Å–µ–∫) > 60 —Å–µ–∫ (–º–∏–Ω–∏–º—É–º –ø—Ä–æ–π–¥–µ–Ω)
- **–í–´–í–û–î:** Emergency loss protection –¥–æ–ª–∂–µ–Ω –±—ã–ª —Å—Ä–∞–±–æ—Ç–∞—Ç—å –ø—Ä–∏ -2.5%, –Ω–æ —Å—Ä–∞–±–æ—Ç–∞–ª —Ç–æ–ª—å–∫–æ –ø—Ä–∏ -11.27%. –≠—Ç–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫—É—é –æ—à–∏–±–∫—É –≤ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–µ –ø–æ–∑–∏—Ü–∏–∏.

### üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê #4: –ü—Ä–∏—á–∏–Ω–∞ –∑–∞–∫—Ä—ã—Ç–∏—è –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç

**–ü—Ä–æ–±–ª–µ–º–∞:** –í CSV —É–∫–∞–∑–∞–Ω–æ `sl_reached`, –Ω–æ –≤ –¥–∞–Ω–Ω—ã—Ö –±–∏—Ä–∂–∏ —É–∫–∞–∑–∞–Ω–æ `emergency_loss_protection`.

**–¶–ò–¢–ê–¢–ê –ò–ó –ö–û–î–ê (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –∑–∞–∫—Ä—ã—Ç–∏—è):**
```31:41:src/strategies/scalping/futures/coordinators/exit_decision_coordinator.py
EXIT_PRIORITIES = {
    "emergency_loss_protection": 1,  # –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —É–±—ã—Ç–æ–∫ - —Å–∞–º—ã–π –≤—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
    "sl_reached": 2,  # Stop Loss –¥–æ—Å—Ç–∏–≥–Ω—É—Ç
    "tp_reached": 3,  # Take Profit –¥–æ—Å—Ç–∏–≥–Ω—É—Ç
    "trailing_stop": 4,  # Trailing Stop Loss —Å—Ä–∞–±–æ—Ç–∞–ª
    "max_holding_time": 5,  # –ü—Ä–µ–≤—ã—à–µ–Ω–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è —É–¥–µ—Ä–∂–∞–Ω–∏—è
    "smart_exit_reversal": 6,  # –£–º–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ —Ä–∞–∑–≤–æ—Ä–æ—Ç—É
    "smart_exit_pattern": 7,  # –£–º–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –ø–∞—Ç—Ç–µ—Ä–Ω—É
    "partial_tp": 8,  # –ß–∞—Å—Ç–∏—á–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ TP
    "extend_tp": 9,  # –ü—Ä–æ–¥–ª–µ–Ω–∏–µ TP (–Ω–µ –∑–∞–∫—Ä—ã—Ç–∏–µ)
}
```

**–ê–ù–ê–õ–ò–ó:** Emergency loss protection –∏–º–µ–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1, –≤—ã—à–µ —á–µ–º sl_reached (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2). –ï—Å–ª–∏ –æ–±–∞ —É—Å–ª–æ–≤–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω—ã, –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∑–∞–ø–∏—Å–∞–Ω–∞ –ø—Ä–∏—á–∏–Ω–∞ `emergency_loss_protection`, –∞ –Ω–µ `sl_reached`.

**–í–´–í–û–î:** –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –æ—à–∏–±–∫—É –≤ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–∏ –ø—Ä–∏—á–∏–Ω—ã –∑–∞–∫—Ä—ã—Ç–∏—è.

---

## üìä –ò–¢–û–ì–û–í–´–ï –í–´–í–û–î–´

### üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ë–ê–ì–ò:

1. **–ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–∏ (CSV vs –ë–∏—Ä–∂–∞)**
   - –§–∞–π–ª: `src/clients/futures_client.py` (—Å—Ç—Ä–æ–∫–∏ 1194-1198), `src/strategies/scalping/futures/positions/entry_manager.py` (—Å—Ç—Ä–æ–∫–∏ 498-503, 657)
   - –û–ø–∏—Å–∞–Ω–∏–µ: CSV –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç SHORT, –¥–∞–Ω–Ω—ã–µ –±–∏—Ä–∂–∏ - LONG –¥–ª—è –ø–æ–∑–∏—Ü–∏–∏ BTCUSDT 17:47:01
   - –ê–Ω–∞–ª–∏–∑: –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ side –∏–∑ —Å–∏–≥–Ω–∞–ª–∞ –≤ –ø–æ–∑–∏—Ü–∏—é –≤—ã–ø–æ–ª–Ω–µ–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤–æ –≤—Å–µ—Ö –∑–≤–µ–Ω—å—è—Ö —Ü–µ–ø–æ—á–∫–∏ (buy‚Üílong, sell‚Üíshort)
   - –í–ª–∏—è–Ω–∏–µ: –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –≤ CSV (SHORT) –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—é –Ω–∞ –±–∏—Ä–∂–µ (LONG), —á—Ç–æ –¥–µ–ª–∞–µ—Ç –Ω–µ–≤–æ–∑–º–æ–∂–Ω—ã–º —Ç–æ—á–Ω—ã–π –∞–Ω–∞–ª–∏–∑
   - –í—ã–≤–æ–¥: –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ `side` –∏–∑ —Å–∏–≥–Ω–∞–ª–∞ –≤ `posSide` –¥–ª—è –±–∏—Ä–∂–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ (—Å—Ç—Ä–æ–∫–∏ 1194-1198 futures_client.py). –ü—Ä–æ–±–ª–µ–º–∞ –≤ fallback –ª–æ–≥–∏–∫–µ (—Å—Ç—Ä–æ–∫–∏ 475-503 entry_manager.py) –∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –ø–æ `order_id` (—Å—Ç—Ä–æ–∫–∏ 298-326 entry_manager.py), –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏–≤–æ–¥—è—Ç –∫ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—é `side` –≤ CSV

2. **Emergency Loss Protection —Å—Ä–∞–±–æ—Ç–∞–ª —Å–ª–∏—à–∫–æ–º –ø–æ–∑–¥–Ω–æ**
   - –§–∞–π–ª: `src/strategies/scalping/futures/positions/exit_analyzer.py` (—Å—Ç—Ä–æ–∫–∏ 3752-3768)
   - –û–ø–∏—Å–∞–Ω–∏–µ: –ü–æ—Ä–æ–≥ -2.5%, –Ω–æ —É–±—ã—Ç–æ–∫ –¥–æ—Å—Ç–∏–≥ -11.27% –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º
   - –í–ª–∏—è–Ω–∏–µ: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —É–±—ã—Ç–æ–∫ –≤–º–µ—Å—Ç–æ –æ–∂–∏–¥–∞–µ–º–æ–≥–æ -2.5%

3. **–ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø—Ä–∏—á–∏–Ω—ã –∑–∞–∫—Ä—ã—Ç–∏—è (CSV vs –ë–∏—Ä–∂–∞)**
   - –§–∞–π–ª: `src/strategies/scalping/futures/coordinators/exit_decision_coordinator.py` (—Å—Ç—Ä–æ–∫–∏ 31-41)
   - –û–ø–∏—Å–∞–Ω–∏–µ: CSV –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç `sl_reached`, –¥–∞–Ω–Ω—ã–µ –±–∏—Ä–∂–∏ - `emergency_loss_protection`
   - –í–ª–∏—è–Ω–∏–µ: –ü—Ä–∏—á–∏–Ω–∞ –∑–∞–∫—Ä—ã—Ç–∏—è –≤ CSV (`sl_reached`) –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–∏—á–∏–Ω–µ –∑–∞–∫—Ä—ã—Ç–∏—è –Ω–∞ –±–∏—Ä–∂–µ (`emergency_loss_protection`), —á—Ç–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —Ä–∞–∑–ª–∏—á–∏–µ –≤ –ª–æ–≥–∏–∫–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø—Ä–∏—á–∏–Ω—ã –∑–∞–∫—Ä—ã—Ç–∏—è

### üü° –õ–û–ì–ò–ß–ï–°–ö–ò–ï –û–®–ò–ë–ö–ò:

1. **Entry price –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –∏ –∑–∞–∫—Ä—ã—Ç–∏–∏**
   - –§–∞–π–ª: `src/strategies/scalping/futures/core/position_sync.py`
   - –û–ø–∏—Å–∞–Ω–∏–µ: Entry –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ (88002.3) ‚â† Entry –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ (87867.4)
   - –í–ª–∏—è–Ω–∏–µ: –ù–µ—Ç–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç PnL

### üü¢ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò:

1. **–£–ª—É—á—à–∏—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –±–æ—Ç–æ–º –∏ –±–∏—Ä–∂–µ–π**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏–∫—É –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–∏
   - –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ entry_price –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

2. **–£–ª—É—á—à–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ–∑–∏—Ü–∏–π**
   - –£–≤–µ–ª–∏—á–∏—Ç—å —á–∞—Å—Ç–æ—Ç—É –ø—Ä–æ–≤–µ—Ä–∫–∏ emergency_loss_protection
   - –î–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —É–±—ã—Ç–∫–∞—Ö

3. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏—á–∏–Ω—ã –∑–∞–∫—Ä—ã—Ç–∏—è**
   - –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞ —Å —É—á–µ—Ç–æ–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü–û–õ–ù–´–ô –ê–ù–ê–õ–ò–ó –ó–ê–í–ï–†–®–ï–ù
