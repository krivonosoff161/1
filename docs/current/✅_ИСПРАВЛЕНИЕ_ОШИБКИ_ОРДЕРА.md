# ИСПРАВЛЕНИЕ ОШИБКИ ОРДЕРА

**Дата:** 23 ноября 2025  
**Проблема:** Ошибка `'NoneType' object has no attribute 'get'` при размещении ордера

---

## ⚠️ ПРОБЛЕМА

### Ошибка в логах:
```
2025-11-23 13:35:24 | ERROR | src.strategies.scalping.futures.order_executor:_execute_order:199 - Ошибка исполнения ордера: 'NoneType' object has no attribute 'get'
```

### Причина:
В `_place_limit_order` при `result.get("code") == "1"` (ошибка) переменная `order_id` не была инициализирована, но использовалась в возвращаемом словаре. Это вызывало ошибку при попытке доступа к `order_id` в `_execute_order`.

---

## ✅ ИСПРАВЛЕНИЕ

### Изменения в `order_executor.py`:

1. **Инициализация `order_id` как `None`** перед проверкой кода результата
2. **Проверка `order_id` перед возвратом** - если `order_id` не установлен, возвращаем ошибку

### Код:
```python
# ✅ КРИТИЧЕСКОЕ ИСПРАВЛЕНИЕ: Инициализируем order_id как None
order_id = None

if result.get("code") == "0":
    order_id = result.get("data", [{}])[0].get("ordId")
    logger.info(f"✅ Лимитный ордер размещен: {order_id}")
elif result.get("code") == "1":
    # ... обработка ошибок ...
    
    # ✅ КРИТИЧЕСКОЕ ИСПРАВЛЕНИЕ: Если order_id не был установлен (ордер не размещен), возвращаем ошибку
    if order_id is None:
        logger.error(
            f"❌ Лимитный ордер не был размещен для {symbol} {side}: "
            f"code={result.get('code')}, msg={error_msg}"
        )
        return {
            "success": False,
            "error": f"Ордер не размещен: {error_msg}",
            "error_code": error_code,
            "order_type": "limit",
            "symbol": symbol,
            "side": side,
            "size": size,
            "price": price,
        }
```

---

## ✅ РЕЗУЛЬТАТ

- ✅ `order_id` всегда инициализирован перед использованием
- ✅ Если ордер не размещен, возвращается правильная ошибка
- ✅ Нет ошибки `'NoneType' object has no attribute 'get'`

---

**Статус:** ✅ ИСПРАВЛЕНО

