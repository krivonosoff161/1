# –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Ç–æ—Ä–≥–æ–≤–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∏ –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤

## üéØ –û–±–∑–æ—Ä —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ Enhanced Scalping v2.0

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

**Enhanced Scalping v2.0** - —ç—Ç–æ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è –≤—ã—Å–æ–∫–æ—á–∞—Å—Ç–æ—Ç–Ω–∞—è —Ç–æ—Ä–≥–æ–≤–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è, —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–Ω–∞—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–∏–±—ã–ª–∏ –æ—Ç –∫—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã—Ö –¥–≤–∏–∂–µ–Ω–∏–π —Ü–µ–Ω—ã –Ω–∞ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–Ω–æ–º —Ä—ã–Ω–∫–µ. –°—Ç—Ä–∞—Ç–µ–≥–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–æ–º–±–∏–Ω–∞—Ü–∏—é —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤, –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è –∏ –∞–¥–∞–ø—Ç–∏–≤–Ω—ã—Ö –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤.

### –ö–ª—é—á–µ–≤—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –±–∞–∑–æ–≤–æ–π –≤–µ—Ä—Å–∏–µ–π

1. **–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–¥—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø–æ–¥ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å —Ä—ã–Ω–∫–∞
2. **–ú—É–ª—å—Ç–∏—Ä–µ–∂–∏–º–Ω–∞—è —Ä–∞–±–æ—Ç–∞** - —Ä–∞–∑–ª–∏—á–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è —Ç—Ä–µ–Ω–¥–æ–≤—ã—Ö –∏ –±–æ–∫–æ–≤—ã—Ö —Ä—ã–Ω–∫–æ–≤
3. **–ö–æ—Ä—Ä–µ–ª—è—Ü–∏–æ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑** - –∑–∞—â–∏—Ç–∞ –æ—Ç —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ —Ä–∏—Å–∫–∞
4. **Kelly Criterion** - –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–π –¥–ª—è –º–∞–∫—Å–∏–º–∏–∑–∞—Ü–∏–∏ –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–π –ø—Ä–∏–±—ã–ª–∏
5. **–ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã–µ –≤—ã—Ö–æ–¥—ã** - –ø–∏—Ä–∞–º–∏–¥–∏–Ω–≥ take-profit –¥–ª—è –º–∞–∫—Å–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–±—ã–ª–∏
6. **–§–∏–ª—å—Ç—Ä—ã –≤—Ä–µ–º–µ–Ω–∏** - —Ç–æ—Ä–≥–æ–≤–ª—è —Ç–æ–ª—å–∫–æ –≤ –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –ø–µ—Ä–∏–æ–¥—ã

---

## üìä –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –∏ –∏—Ö –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ

### 1. –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π RSI (Relative Strength Index)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —É—Å–ª–æ–≤–∏–π –ø–µ—Ä–µ–∫—É–ø–ª–µ–Ω–Ω–æ—Å—Ç–∏/–ø–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω–Ω–æ—Å—Ç–∏ —Å –∞–¥–∞–ø—Ç–∞—Ü–∏–µ–π –∫ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏.

**–£–ª—É—á—à–µ–Ω–∏—è:**
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –ø–æ–¥—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–∏–æ–¥–∞ —Ä–∞—Å—á–µ—Ç–∞ (10-20) –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç ATR
- –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –≥—Ä–∞–Ω–∏—Ü—ã overbought/oversold
- –£—á–µ—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è RSI (momentum)

```python
class EnhancedRSI:
    def __init__(self, base_period=14, adaptive=True):
        self.base_period = base_period
        self.adaptive = adaptive
        self.min_period = 10
        self.max_period = 20
    
    def calculate(self, prices, atr_values=None):
        if self.adaptive and atr_values is not None:
            # –ê–¥–∞–ø—Ç–∞—Ü–∏—è –ø–µ—Ä–∏–æ–¥–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏
            volatility_ratio = atr_values[-1] / np.mean(atr_values[-20:])
            if volatility_ratio > 1.5:  # –í—ã—Å–æ–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å
                period = max(self.min_period, int(self.base_period * 0.7))
            elif volatility_ratio < 0.7:  # –ù–∏–∑–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å
                period = min(self.max_period, int(self.base_period * 1.3))
            else:
                period = self.base_period
        else:
            period = self.base_period
            
        # –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ä–∞—Å—á–µ—Ç RSI —Å –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–º –ø–µ—Ä–∏–æ–¥–æ–º
        rsi = self._calculate_rsi(prices, period)
        
        # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∞–¥–∞–ø—Ç–∏–≤–Ω—ã—Ö –≥—Ä–∞–Ω–∏—Ü
        if atr_values is not None:
            market_regime = self._detect_market_regime(prices, atr_values)
            overbought, oversold = self._get_adaptive_levels(market_regime)
        else:
            overbought, oversold = 70, 30
            
        return {
            'value': rsi,
            'overbought': overbought,
            'oversold': oversold,
            'trend': self._calculate_rsi_trend(rsi),
            'divergence': self._detect_divergence(prices, rsi)
        }
```

**–°–∏–≥–Ω–∞–ª—ã:**
- **Long:** RSI < 30 (–ø–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω–Ω–æ—Å—Ç—å) –∏–ª–∏ RSI –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –æ—Ç oversold
- **Short:** RSI > 70 (–ø–µ—Ä–µ–∫—É–ø–ª–µ–Ω–Ω–æ—Å—Ç—å) –∏–ª–∏ RSI —Å–Ω–∏–∂–∞–µ—Ç—Å—è –æ—Ç overbought
- **–§–∏–ª—å—Ç—Ä:** –î–∏–≤–µ—Ä–≥–µ–Ω—Ü–∏—è –º–µ–∂–¥—É —Ü–µ–Ω–æ–π –∏ RSI —É—Å–∏–ª–∏–≤–∞–µ—Ç —Å–∏–≥–Ω–∞–ª

### 2. –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π MACD

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç—Ä–µ–Ω–¥–æ–≤ –∏ —Ç–æ—á–µ–∫ —Ä–∞–∑–≤–æ—Ä–æ—Ç–∞ —Å –ø–æ–¥—Å—Ç—Ä–æ–π–∫–æ–π –ø–æ–¥ —Ä—ã–Ω–æ—á–Ω—ã–µ —É—Å–ª–æ–≤–∏—è.

**–£–ª—É—á—à–µ–Ω–∏—è:**
- –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –ø–µ—Ä–∏–æ–¥—ã EMA –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã MACD
- –î–µ—Ç–µ–∫—Ü–∏—è –±—ã—á—å–∏—Ö/–º–µ–¥–≤–µ–∂—å–∏—Ö –¥–∏–≤–µ—Ä–≥–µ–Ω—Ü–∏–π

```python
class AdaptiveMACD:
    def __init__(self, fast=12, slow=26, signal=9, adaptive=True):
        self.base_fast = fast
        self.base_slow = slow
        self.base_signal = signal
        self.adaptive = adaptive
    
    def calculate(self, prices, volume=None, atr=None):
        if self.adaptive and atr is not None:
            # –ê–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å
            volatility_factor = np.mean(atr[-5:]) / np.mean(atr[-20:])
            
            if volatility_factor > 1.2:  # –í—ã—Å–æ–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å - –±—ã—Å—Ç—Ä–µ–µ —Ä–µ–∞–∫—Ü–∏—è
                fast_period = max(8, int(self.base_fast * 0.8))
                slow_period = max(18, int(self.base_slow * 0.8))
            elif volatility_factor < 0.8:  # –ù–∏–∑–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å - –º–µ–¥–ª–µ–Ω–Ω–µ–µ
                fast_period = min(16, int(self.base_fast * 1.2))
                slow_period = min(35, int(self.base_slow * 1.2))
            else:
                fast_period = self.base_fast
                slow_period = self.base_slow
        else:
            fast_period = self.base_fast
            slow_period = self.base_slow
        
        # –†–∞—Å—á–µ—Ç MACD —Å –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–º–∏ –ø–µ—Ä–∏–æ–¥–∞–º–∏
        ema_fast = self._ema(prices, fast_period)
        ema_slow = self._ema(prices, slow_period)
        macd_line = ema_fast - ema_slow
        signal_line = self._ema(macd_line, self.base_signal)
        histogram = macd_line - signal_line
        
        return {
            'macd_line': macd_line,
            'signal_line': signal_line,
            'histogram': histogram,
            'crossover': self._detect_crossover(macd_line, signal_line),
            'divergence': self._detect_macd_divergence(prices, macd_line)
        }
```

**–°–∏–≥–Ω–∞–ª—ã:**
- **Long:** MACD –ø–µ—Ä–µ—Å–µ–∫–∞–µ—Ç signal line —Å–Ω–∏–∑—É –≤–≤–µ—Ä—Ö + –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–∞—è –¥–∏–≤–µ—Ä–≥–µ–Ω—Ü–∏—è
- **Short:** MACD –ø–µ—Ä–µ—Å–µ–∫–∞–µ—Ç signal line —Å–≤–µ—Ä—Ö—É –≤–Ω–∏–∑ + –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–∞—è –¥–∏–≤–µ—Ä–≥–µ–Ω—Ü–∏—è
- **–§–∏–ª—å—Ç—Ä:** –°–∏–ª–∞ —Å–∏–≥–Ω–∞–ª–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≤–µ–ª–∏—á–∏–Ω—ã —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è –ª–∏–Ω–∏–π

### 3. –í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–Ω—ã–µ –ø–æ–ª–æ—Å—ã (Adaptive Bollinger Bands)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω–µ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏/—Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏—è –∏ —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã—Ö –¥–≤–∏–∂–µ–Ω–∏–π.

**–£–ª—É—á—à–µ–Ω–∏—è:**
- –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –º—É–ª—å—Ç–∏–ø–ª–∏–∫–∞—Ç–æ—Ä —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è
- –£—á–µ—Ç —Ä—ã–Ω–æ—á–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ (trending/ranging)
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –ø–æ–ª–æ—Å—ã

```python
class VolatilityBands:
    def __init__(self, period=20, std_multiplier=2.0, adaptive=True):
        self.period = period
        self.base_multiplier = std_multiplier
        self.adaptive = adaptive
    
    def calculate(self, prices, atr=None, volume=None):
        sma = self._sma(prices, self.period)
        std = self._rolling_std(prices, self.period)
        
        if self.adaptive:
            # –ê–¥–∞–ø—Ç–∞—Ü–∏—è –º—É–ª—å—Ç–∏–ø–ª–∏–∫–∞—Ç–æ—Ä–∞
            market_regime = self._detect_regime(prices, atr)
            
            if market_regime == 'trending':
                multiplier = self.base_multiplier * 1.2  # –®–∏—Ä–µ –¥–ª—è —Ç—Ä–µ–Ω–¥–æ–≤
            elif market_regime == 'ranging':
                multiplier = self.base_multiplier * 0.8  # –£–∂–µ –¥–ª—è –±–æ–∫–æ–≤–æ–≥–æ –¥–≤–∏–∂–µ–Ω–∏—è
            elif market_regime == 'high_volatility':
                multiplier = self.base_multiplier * 1.5  # –ù–∞–º–Ω–æ–≥–æ —à–∏—Ä–µ
            else:
                multiplier = self.base_multiplier
        else:
            multiplier = self.base_multiplier
        
        upper_band = sma + (std * multiplier)
        lower_band = sma - (std * multiplier)
        
        # –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ –¥–ª—è —á–∞—Å—Ç–∏—á–Ω—ã—Ö –≤—ã—Ö–æ–¥–æ–≤
        upper_mid = sma + (std * multiplier * 0.5)
        lower_mid = sma - (std * multiplier * 0.5)
        
        return {
            'upper_band': upper_band,
            'middle_band': sma,
            'lower_band': lower_band,
            'upper_mid': upper_mid,
            'lower_mid': lower_mid,
            'bandwidth': (upper_band - lower_band) / sma * 100,
            'position': self._calculate_bb_position(prices[-1], lower_band, upper_band)
        }
```

### 4. –û–±—ä–µ–º–Ω—ã–π –∞–Ω–∞–ª–∏–∑

**VWAP (Volume Weighted Average Price):**
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ–π —Ü–µ–Ω—ã —Å —É—á–µ—Ç–æ–º –æ–±—ä–µ–º–æ–≤
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–∞–∫ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –ø–æ–¥–¥–µ—Ä–∂–∫–∏/—Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏—è

**Volume Profile:**
- –ê–Ω–∞–ª–∏–∑ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –æ–±—ä–µ–º–æ–≤ –ø–æ —Ü–µ–Ω–æ–≤—ã–º —É—Ä–æ–≤–Ω—è–º
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–æ–Ω –≤—ã—Å–æ–∫–æ–π –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏

**Order Book Imbalance:**
- –ê–Ω–∞–ª–∏–∑ –¥–∏—Å–±–∞–ª–∞–Ω—Å–∞ –∑–∞—è–≤–æ–∫ –≤ —Å—Ç–∞–∫–∞–Ω–µ
- –ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω–æ–≥–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–≤–∏–∂–µ–Ω–∏—è

---

## üß† –ê–ª–≥–æ—Ä–∏—Ç–º—ã –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è

### 1. –î–µ—Ç–µ–∫—Ç–æ—Ä —Ä—ã–Ω–æ—á–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞

–ö–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ä—ã–Ω–∫–∞ –¥–ª—è –∞–¥–∞–ø—Ç–∞—Ü–∏–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏:

```python
class MarketRegimeDetector:
    def __init__(self):
        self.regimes = ['trending', 'ranging', 'high_volatility', 'low_volatility', 'news_event']
        self.features = []
        
    def extract_features(self, prices, volumes, atr):
        """–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –¥–ª—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏"""
        return {
            'trend_strength': self._calculate_trend_strength(prices),
            'volatility_ratio': atr[-1] / np.mean(atr[-20:]),
            'volume_ratio': volumes[-1] / np.mean(volumes[-20:]),
            'price_momentum': (prices[-1] / prices[-20] - 1) * 100,
            'volatility_acceleration': self._volatility_acceleration(atr),
            'volume_trend': self._volume_trend(volumes)
        }
    
    def detect_regime(self, market_data):
        """–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —Ä–µ–∂–∏–º–∞ —Ä—ã–Ω–∫–∞"""
        features = self.extract_features(
            market_data.prices, 
            market_data.volumes, 
            market_data.atr
        )
        
        # –õ–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞
        if features['volatility_ratio'] > 2.0:
            return MarketRegime.HIGH_VOLATILITY
        elif features['volatility_ratio'] < 0.5:
            return MarketRegime.LOW_VOLATILITY
        elif abs(features['trend_strength']) > 0.7:
            return MarketRegime.TRENDING
        elif features['volume_ratio'] > 3.0:
            return MarketRegime.NEWS_EVENT
        else:
            return MarketRegime.RANGING
```

### 2. –ö–æ—Ä—Ä–µ–ª—è—Ü–∏–æ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑

–ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–∫—Ä—ã—Ç–∏–µ –∫–æ—Ä—Ä–µ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ —Ä–∏—Å–∫–∞:

```python
class CorrelationMatrix:
    def __init__(self, symbols, lookback_period=50):
        self.symbols = symbols
        self.lookback_period = lookback_period
        self.correlation_matrix = None
        
    def calculate_correlations(self, price_data):
        """–†–∞—Å—á–µ—Ç –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–æ–π –º–∞—Ç—Ä–∏—Ü—ã"""
        returns_data = {}
        
        for symbol in self.symbols:
            prices = price_data[symbol][-self.lookback_period:]
            returns = np.diff(np.log(prices))
            returns_data[symbol] = returns
        
        # –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–æ–π –º–∞—Ç—Ä–∏—Ü—ã
        df = pd.DataFrame(returns_data)
        self.correlation_matrix = df.corr()
        
        return self.correlation_matrix
    
    def get_correlation_risk(self, new_symbol, existing_positions):
        """–†–∞—Å—á–µ—Ç –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ä–∏—Å–∫–∞ –¥–ª—è –Ω–æ–≤–æ–π –ø–æ–∑–∏—Ü–∏–∏"""
        if self.correlation_matrix is None:
            return 0.0
        
        max_correlation = 0.0
        
        for existing_symbol in existing_positions.keys():
            if existing_symbol in self.correlation_matrix.columns and new_symbol in self.correlation_matrix.columns:
                correlation = abs(self.correlation_matrix.loc[new_symbol, existing_symbol])
                max_correlation = max(max_correlation, correlation)
        
        return max_correlation
```

---

## üí∞ –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–∞–ø–∏—Ç–∞–ª–æ–º

### Kelly Criterion –¥–ª—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ sizing

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:

```python
class KellyCriterionCalculator:
    def __init__(self, lookback_trades=100):
        self.lookback_trades = lookback_trades
        self.trade_history = []
        
    def add_trade_result(self, pnl_percent):
        """–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —Å–¥–µ–ª–∫–∏"""
        self.trade_history.append(pnl_percent)
        
        # –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –∏—Å—Ç–æ—Ä–∏–∏
        if len(self.trade_history) > self.lookback_trades * 2:
            self.trade_history = self.trade_history[-self.lookback_trades:]
    
    def calculate_kelly_fraction(self):
        """–†–∞—Å—á–µ—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π Kelly fraction"""
        if len(self.trade_history) < 20:
            return 0.25  # –ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–∞—è —Å—Ç–∞—Ä—Ç–æ–≤–∞—è —Ñ—Ä–∞–∫—Ü–∏—è
        
        recent_trades = self.trade_history[-self.lookback_trades:]
        
        # –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –≤—ã–∏–≥—Ä—ã—à–Ω—ã–µ –∏ –ø—Ä–æ–∏–≥—Ä—ã—à–Ω—ã–µ
        wins = [trade for trade in recent_trades if trade > 0]
        losses = [abs(trade) for trade in recent_trades if trade < 0]
        
        if not wins or not losses:
            return 0.25
        
        # Kelly formula: f = (bp - q) / b
        win_rate = len(wins) / len(recent_trades)  # p
        loss_rate = 1 - win_rate  # q
        avg_win = np.mean(wins)  # —Å—Ä–µ–¥–Ω–µ–µ –≤—ã–∏–≥—Ä—ã—à–∞
        avg_loss = np.mean(losses)  # —Å—Ä–µ–¥–Ω–µ–µ –ø—Ä–æ–∏–≥—Ä—ã—à–∞
        win_loss_ratio = avg_win / avg_loss  # b
        
        kelly_fraction = (win_loss_ratio * win_rate - loss_rate) / win_loss_ratio
        
        # –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
        kelly_fraction = max(0.01, min(0.4, kelly_fraction))  # –û—Ç 1% –¥–æ 40%
        
        # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏
        kelly_fraction = self._apply_market_adjustments(kelly_fraction)
        
        return kelly_fraction
    
    def _apply_market_adjustments(self, base_kelly):
        """–ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ Kelly –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä—ã–Ω–æ—á–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π"""
        # –ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–∑–º –≤ –ø–µ—Ä–∏–æ–¥—ã –≤—ã—Å–æ–∫–æ–π –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏
        recent_volatility = self._calculate_recent_volatility()
        
        if recent_volatility > 1.5:  # –í—ã—Å–æ–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å
            return base_kelly * 0.7
        elif recent_volatility < 0.7:  # –ù–∏–∑–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å
            return base_kelly * 1.1
        else:
            return base_kelly
```

### –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –≤—ã—Ö–æ–¥–æ–≤

–ü–∏—Ä–∞–º–∏–¥–∏–Ω–≥ take-profit –¥–ª—è –º–∞–∫—Å–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–±—ã–ª–∏ –æ—Ç —Å–∏–ª—å–Ω—ã—Ö –¥–≤–∏–∂–µ–Ω–∏–π:

```python
class MultiLevelExitManager:
    def __init__(self):
        self.exit_levels = []
        self.partial_exits = {}
        
    def create_exit_strategy(self, entry_price, direction, atr, market_regime):
        """–°–æ–∑–¥–∞–Ω–∏–µ –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –≤—ã—Ö–æ–¥–∞"""
        
        # –ê–¥–∞–ø—Ç–∞—Ü–∏—è —É—Ä–æ–≤–Ω–µ–π –ø–æ–¥ —Ä—ã–Ω–æ—á–Ω—ã–π —Ä–µ–∂–∏–º
        if market_regime == MarketRegime.HIGH_VOLATILITY:
            tp_multipliers = [1.8, 3.5, 6.0]  # –ë–æ–ª–µ–µ —à–∏—Ä–æ–∫–∏–µ —Ü–µ–ª–∏
            sl_multiplier = 2.2
            size_distribution = [0.4, 0.35, 0.25]  # –ë–æ–ª–µ–µ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
        elif market_regime == MarketRegime.TRENDING:
            tp_multipliers = [1.5, 4.0, 8.0]  # –î–∞–ª—å–Ω–∏–µ —Ü–µ–ª–∏ –¥–ª—è —Ç—Ä–µ–Ω–¥–æ–≤
            sl_multiplier = 2.0
            size_distribution = [0.3, 0.3, 0.4]  # –ë–æ–ª—å—à–µ –¥–ª—è –¥–∞–ª—å–Ω–∏—Ö —É—Ä–æ–≤–Ω–µ–π
        else:  # RANGING –∏–ª–∏ –æ–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º
            tp_multipliers = [1.2, 2.5, 4.0]
            sl_multiplier = 1.8
            size_distribution = [0.5, 0.3, 0.2]
        
        exit_strategy = []
        
        for i, (tp_mult, size_pct) in enumerate(zip(tp_multipliers, size_distribution)):
            if direction == 'long':
                tp_price = entry_price + (atr * tp_mult)
            else:
                tp_price = entry_price - (atr * tp_mult)
            
            exit_strategy.append({
                'type': 'take_profit',
                'level': i + 1,
                'price': tp_price,
                'size_percent': size_pct,
                'description': f'TP{i+1}'
            })
        
        # Stop Loss
        if direction == 'long':
            sl_price = entry_price - (atr * sl_multiplier)
        else:
            sl_price = entry_price + (atr * sl_multiplier)
        
        exit_strategy.append({
            'type': 'stop_loss',
            'level': 0,
            'price': sl_price,
            'size_percent': 1.0,  # –í–µ—Å—å –æ—Å—Ç–∞—Ç–æ–∫ –ø–æ–∑–∏—Ü–∏–∏
            'description': 'SL'
        })
        
        return exit_strategy
    
    def check_exit_conditions(self, current_price, position, market_data):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π –≤—ã—Ö–æ–¥–∞"""
        exits_to_execute = []
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –ª–∏–º–∏—Ç–∞
        if self._is_time_limit_exceeded(position):
            exits_to_execute.append({
                'type': 'time_exit',
                'reason': 'max_holding_time_exceeded',
                'size_percent': 1.0
            })
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö —É—Å–ª–æ–≤–∏–π –≤—ã—Ö–æ–¥–∞
        technical_exit = self._check_technical_exit(position, market_data)
        if technical_exit:
            exits_to_execute.append(technical_exit)
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Ä–æ–≤–Ω–µ–π TP/SL
        for exit_level in position.exit_levels:
            if not exit_level.get('executed', False):
                if self._is_level_hit(current_price, exit_level, position.direction):
                    exits_to_execute.append(exit_level)
        
        return exits_to_execute
```

---

## üìà –°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –ú–µ—Ç—Ä–∏–∫–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

```python
class PerformanceTracker:
    def __init__(self):
        self.trades = []
        self.equity_curve = []
        self.daily_returns = []
        
    def calculate_comprehensive_metrics(self):
        """–†–∞—Å—á–µ—Ç –≤—Å–µ—Å—Ç–æ—Ä–æ–Ω–Ω–∏—Ö –º–µ—Ç—Ä–∏–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏"""
        
        if not self.trades:
            return {}
        
        # –ë–∞–∑–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏
        total_trades = len(self.trades)
        winning_trades = len([t for t in self.trades if t.pnl > 0])
        
        # –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
        metrics = {
            # –û—Å–Ω–æ–≤–Ω—ã–µ
            'total_trades': total_trades,
            'win_rate': winning_trades / total_trades * 100,
            'total_pnl': sum(t.pnl for t in self.trades),
            
            # –†–∏—Å–∫-–º–µ—Ç—Ä–∏–∫–∏
            'sharpe_ratio': self._calculate_sharpe_ratio(),
            'sortino_ratio': self._calculate_sortino_ratio(),
            'calmar_ratio': self._calculate_calmar_ratio(),
            'max_drawdown': self._calculate_max_drawdown(),
            
            # –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å
            'profit_factor': self._calculate_profit_factor(),
            'expectancy': self._calculate_expectancy(),
            'kelly_fraction': self._get_current_kelly(),
            
            # –í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
            'avg_trade_duration': self._calculate_avg_duration(),
            'trades_per_day': self._calculate_trade_frequency(),
            
            # –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
            'win_loss_distribution': self._analyze_win_loss_distribution(),
            'monthly_returns': self._calculate_monthly_returns(),
            
            # –°—Ç—Ä–µ—Å—Å–æ–≤—ã–µ –ø–µ—Ä–∏–æ–¥—ã
            'worst_month': self._find_worst_period('month'),
            'worst_week': self._find_worst_period('week'),
            'recovery_factor': self._calculate_recovery_factor()
        }
        
        return metrics
    
    def _calculate_sharpe_ratio(self, risk_free_rate=0.02):
        """–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –®–∞—Ä–ø–∞"""
        if len(self.daily_returns) < 30:
            return 0.0
        
        excess_returns = np.array(self.daily_returns) - (risk_free_rate / 365)
        return np.mean(excess_returns) / np.std(excess_returns) * np.sqrt(365)
    
    def _calculate_sortino_ratio(self, risk_free_rate=0.02):
        """–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –°–æ—Ä—Ç–∏–Ω–æ (—É—á–∏—Ç—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ downside —Ä–∏—Å–∫)"""
        if len(self.daily_returns) < 30:
            return 0.0
        
        returns = np.array(self.daily_returns)
        excess_returns = returns - (risk_free_rate / 365)
        downside_returns = returns[returns < 0]
        
        if len(downside_returns) == 0:
            return float('inf')
        
        downside_deviation = np.std(downside_returns)
        return np.mean(excess_returns) / downside_deviation * np.sqrt(365)
```

### –°–∏—Å—Ç–µ–º–∞ –∞–ª–µ—Ä—Ç–æ–≤ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

```python
class AlertSystem:
    def __init__(self):
        self.alert_rules = {
            'drawdown_alert': {'threshold': -3.0, 'enabled': True},
            'win_rate_alert': {'threshold': 45.0, 'enabled': True},
            'daily_loss_alert': {'threshold': -1.5, 'enabled': True},
            'technical_failure': {'threshold': 5, 'enabled': True},  # –æ—à–∏–±–æ–∫ –ø–æ–¥—Ä—è–¥
        }
        
    async def check_performance_alerts(self, metrics):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–ª–µ—Ä—Ç–æ–≤ –ø–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏"""
        alerts = []
        
        # –ê–ª–µ—Ä—Ç –ø–æ –ø—Ä–æ—Å–∞–¥–∫–µ
        if (metrics.get('current_drawdown', 0) < self.alert_rules['drawdown_alert']['threshold'] 
            and self.alert_rules['drawdown_alert']['enabled']):
            alerts.append({
                'type': 'drawdown',
                'level': 'WARNING',
                'message': f"Drawdown exceeded {self.alert_rules['drawdown_alert']['threshold']}%",
                'value': metrics['current_drawdown'],
                'action': 'Consider reducing position sizes'
            })
        
        # –ê–ª–µ—Ä—Ç –ø–æ –≤–∏–Ω—Ä–µ–π—Ç—É
        if (metrics.get('win_rate', 100) < self.alert_rules['win_rate_alert']['threshold']
            and self.alert_rules['win_rate_alert']['enabled']):
            alerts.append({
                'type': 'win_rate',
                'level': 'INFO',
                'message': f"Win rate below {self.alert_rules['win_rate_alert']['threshold']}%",
                'value': metrics['win_rate'],
                'action': 'Review entry conditions'
            })
        
        return alerts
```

–≠—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø–æ–ª–Ω–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ –∏ –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤ —Ä–∞–±–æ—Ç—ã —É–ª—É—á—à–µ–Ω–Ω–æ–π —Ç–æ—Ä–≥–æ–≤–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏, –∞ —Ç–∞–∫–∂–µ –º–µ—Ç–æ–¥–æ–≤ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.