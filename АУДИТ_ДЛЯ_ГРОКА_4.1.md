# üîç –ê–£–î–ò–¢ –¢–û–†–ì–û–í–û–ì–û –ë–û–¢–ê –î–õ–Ø –ì–†–û–ö–ê 4.1

> **–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 21 –¥–µ–∫–∞–±—Ä—è 2025  
> **–ó–∞–ø—Ä–æ—à–µ–Ω–æ:** –ü–æ–ª–Ω—ã–π –∞—É–¥–∏—Ç –ø–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º –∏ –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç–∏, –ø—Ä–æ–±–ª–µ–º—ã —Å partial TP –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ–π –ø—Ä–∏–±—ã–ª—å–Ω–æ—Å—Ç—å—é

---

## üìã –°–û–î–ï–†–ñ–ê–ù–ò–ï

1. [–û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏ (–ö–†–ò–¢–ò–ß–ù–û)](#–æ—Å–Ω–æ–≤–Ω—ã–µ-–º–æ–¥—É–ª–∏-–∫—Ä–∏—Ç–∏—á–Ω–æ)
   - orchestrator.py
   - position_manager.py
   - exit_analyzer.py
   - signal_generator.py
   - risk_manager.py
2. [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è](#–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
   - config_futures.yaml
3. [–õ–æ–≥–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å–µ—Å—Å–∏–∏ (6 —á–∞—Å–æ–≤)](#–ª–æ–≥–∏-–ø–æ—Å–ª–µ–¥–Ω–µ–π-—Å–µ—Å—Å–∏–∏)
   - trades_2025-12-21.csv
   - signals_2025-12-21.csv
   - orders_2025-12-21.csv
   - –ö–ª—é—á–µ–≤—ã–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã futures_main_2025-12-21.log
4. [–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏](#–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ-–º–æ–¥—É–ª–∏)
   - position_scaling_manager.py
   - position_registry.py
   - adaptive_leverage.py

---

## üéØ –ß–¢–û –ü–†–û–í–ï–†–Ø–ï–¢–°–Ø

### –ü—Ä–æ–±–ª–µ–º–∞ —Å —á–∞—Å—Ç–∏—á–Ω—ã–º –∑–∞–∫—Ä—ã—Ç–∏–µ–º:
- ‚úÖ –õ–æ–≥–∏–∫–∞ `partial_tp_trigger` –∏ `partial_tp_fraction` –≤ Exit Analyzer
- ‚úÖ –£—Å–ª–æ–≤–∏—è `can_partial_close` - –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è —É–¥–µ—Ä–∂–∞–Ω–∏—è
- ‚úÖ –§–ª–∞–≥ `partial_tp_executed` - –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–µ
- ‚úÖ –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å partial TP –ø–æ —Ä–µ–∂–∏–º–∞–º (RANGING: 60% –ø—Ä–∏ 1.2%)

### –ü—Ä–æ–±–ª–µ–º–∞ —Å —É–±—ã—Ç–æ—á–Ω–æ—Å—Ç—å—é:
- ‚úÖ –°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ TP/SL (—Å–µ–π—á–∞—Å 1.2%/0.8% –¥–ª—è ranging)
- ‚úÖ –†–∞–∑–º–µ—Ä—ã –ø–æ–∑–∏—Ü–∏–π –∏ –∏—Ö –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞
- ‚úÖ –£—Å–ª–æ–≤–∏—è –≤—Ö–æ–¥–∞ - –ø–æ—Ä–æ–≥ `score_threshold`
- ‚úÖ Trailing stop - –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ—Å—Ç—å –∏ –º–æ–º–µ–Ω—Ç –∞–∫—Ç–∏–≤–∞—Ü–∏–∏
- ‚úÖ –ö–æ–º–∏—Å—Å–∏–∏ (LIMIT vs MARKET –æ—Ä–¥–µ—Ä–∞)
- ‚úÖ –†–∞–±–æ—Ç–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤ - –º–æ–≥—É—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Ö–æ—Ä–æ—à–∏–µ —Å–∏–≥–Ω–∞–ª—ã

---

## üìÅ –û–°–ù–û–í–ù–´–ï –ú–û–î–£–õ–ò (–ö–†–ò–¢–ò–ß–ù–û)

### 1. orchestrator.py - –ì–ª–∞–≤–Ω—ã–π –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä

**–§–∞–π–ª:** `src/strategies/scalping/futures/orchestrator.py`  
**–†–∞–∑–º–µ—Ä:** ~4432 —Å—Ç—Ä–æ–∫–∏  
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:** –ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π, –≥–ª–∞–≤–Ω—ã–π —Ç–æ—Ä–≥–æ–≤—ã–π —Ü–∏–∫–ª

**–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã:**
- `start()` - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π
- `run()` - –ì–ª–∞–≤–Ω—ã–π —Ç–æ—Ä–≥–æ–≤—ã–π —Ü–∏–∫–ª
- `_process_symbol()` - –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞–∂–¥–æ–≥–æ —Å–∏–º–≤–æ–ª–∞
- `_update_trailing_stop_loss()` - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç—Ä–µ–π–ª–∏–Ω–≥-—Å—Ç–æ–ø–∞
- `_close_position()` - –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–∏

**–í–∞–∂–Ω—ã–µ —á–∞—Å—Ç–∏ –∫–æ–¥–∞:**

```python
# –ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª —Ç–æ—Ä–≥–æ–≤–ª–∏ (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
async def run(self):
    while self.active:
        for symbol in self.scalping_config.symbols:
            # 1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä—ã–Ω–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
            await self._update_market_data(symbol)
            
            # 2. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–∑–∏—Ü–∏–π
            if symbol in self.active_positions:
                await self._monitor_position(symbol)
            
            # 3. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–æ–≤—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤
            if self._can_trade(symbol):
                signal = await self.signal_generator.generate_signal(symbol)
                if signal:
                    await self._execute_signal(signal)
```

**–ü–æ–ª–Ω—ã–π –∫–æ–¥ —Ñ–∞–π–ª–∞:** –°–º. —Ä–∞–∑–¥–µ–ª [–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ A: –ü–æ–ª–Ω—ã–π –∫–æ–¥ orchestrator.py](#–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ-a-–ø–æ–ª–Ω—ã–π-–∫–æ–¥-orchestratorpy)

---

### 2. position_manager.py - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏—è–º–∏

**–§–∞–π–ª:** `src/strategies/scalping/futures/position_manager.py`  
**–†–∞–∑–º–µ—Ä:** ~6800 —Å—Ç—Ä–æ–∫  
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:** –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç—ã–º–∏ –ø–æ–∑–∏—Ü–∏—è–º–∏, –∑–∞–∫—Ä—ã—Ç–∏–µ, partial TP

**–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã –¥–ª—è Partial TP:**
- `close_partial_position()` - –ß–∞—Å—Ç–∏—á–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–∏
- `_check_profit_harvesting()` - –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π –¥–ª—è partial TP
- `_close_position_by_reason()` - –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–∏ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π PnL < –∫–æ–º–∏—Å—Å–∏—è

**–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –ö–û–î - Partial TP (—Å—Ç—Ä–æ–∫–∏ 6069-6113):**

```python
# ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û (–ö–ò–ú–ò): –£–º–µ–Ω—å—à–µ–Ω—ã –º–∏–Ω–∏–º—É–º—ã –¥–ª—è Partial TP
# –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –º–∏–Ω–∏–º—É–º –ø–æ –ø—Ä–æ—Ñ–∏–ª—é –±–∞–ª–∞–Ω—Å–∞
if balance_profile:
    profile_name = balance_profile.get("name", "small")
    if profile_name == "small":
        min_partial_tp_value_usd = 1.5  # ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: $1.5 (–±—ã–ª–æ $3.0)
    elif profile_name == "medium":
        min_partial_tp_value_usd = 2.5  # ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: $2.5 (–±—ã–ª–æ $5.0)
    else:  # large
        min_partial_tp_value_usd = 3.0  # ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: $3.0 (–±—ã–ª–æ $10.0)
else:
    min_partial_tp_value_usd = 2.5  # ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: Fallback: $2.5 (–±—ã–ª–æ $5.0)

# –ï—Å–ª–∏ —Å—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞–∫—Ä—ã–≤–∞–µ–º–æ–π —á–∞—Å—Ç–∏ –º–µ–Ω—å—à–µ –º–∏–Ω–∏–º—É–º–∞ - –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º
if close_value_usd < min_partial_tp_value_usd:
    logger.warning(
        f"‚ö†Ô∏è [PARTIAL_TP_BLOCKED] {symbol}: –°—Ç–æ–∏–º–æ—Å—Ç—å —á–∞—Å—Ç–∏—á–Ω–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è ${close_value_usd:.2f} "
        f"–º–µ–Ω—å—à–µ –º–∏–Ω–∏–º—É–º–∞ ${min_partial_tp_value_usd:.2f}"
    )
    return {"success": False, "error": "–°—Ç–æ–∏–º–æ—Å—Ç—å < –º–∏–Ω–∏–º—É–º"}
```

**–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –ö–û–î - –ü—Ä–æ–≤–µ—Ä–∫–∞ PnL < –∫–æ–º–∏—Å—Å–∏—è (—Å—Ç—Ä–æ–∫–∏ 3745-3770):**

```python
# ‚úÖ –ù–û–í–û–ï (–ö–ò–ú–ò): –ü—Ä–æ–≤–µ—Ä–∫–∞ PnL < –∫–æ–º–∏—Å—Å–∏—è –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º
try:
    unrealized_pnl = float(actual_position.get("upl", "0") or 0)
    margin_used = float(actual_position.get("margin", "0") or 0)
    
    # –ü–æ–ª—É—á–∞–µ–º –∫–æ–º–∏—Å—Å–∏—é –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
    commission_config = getattr(self.scalping_config, "commission", None)
    if commission_config is None:
        commission_config = getattr(self.config, "commission", {})
    if isinstance(commission_config, dict):
        commission_rate = commission_config.get("trading_fee_rate", 0.001)
    else:
        commission_rate = getattr(commission_config, "trading_fee_rate", 0.001)
    
    # –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –∫–æ–º–∏—Å—Å–∏—é (–≤—Ö–æ–¥ + –≤—ã—Ö–æ–¥)
    position_value = abs(size) * entry_price
    total_commission = position_value * commission_rate * 2  # –í—Ö–æ–¥ + –≤—ã—Ö–æ–¥
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º: –µ—Å–ª–∏ PnL < –∫–æ–º–∏—Å—Å–∏—è, –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º (–∫—Ä–æ–º–µ SL)
    if unrealized_pnl < total_commission and reason not in ["sl", "sl_reached", "trailing_sl"]:
        logger.warning(
            f"‚ö†Ô∏è [PNL_COMMISSION_CHECK] {symbol}: –û—Ç–º–µ–Ω–∞ –∑–∞–∫—Ä—ã—Ç–∏—è | "
            f"PnL=${unrealized_pnl:.4f} < –∫–æ–º–∏—Å—Å–∏—è=${total_commission:.4f} | "
            f"reason={reason}"
        )
        return None
except Exception as e:
    logger.debug(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ PnL/–∫–æ–º–∏—Å—Å–∏—è –¥–ª—è {symbol}: {e}, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –∑–∞–∫—Ä—ã—Ç–∏–µ")
```

**–ü–æ–ª–Ω—ã–π –∫–æ–¥ —Ñ–∞–π–ª–∞:** –°–º. —Ä–∞–∑–¥–µ–ª [–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ B: –ü–æ–ª–Ω—ã–π –∫–æ–¥ position_manager.py](#–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ-b-–ø–æ–ª–Ω—ã–π-–∫–æ–¥-position_managerpy)

---

### 3. exit_analyzer.py - –õ–æ–≥–∏–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–π

**–§–∞–π–ª:** `src/strategies/scalping/futures/positions/exit_analyzer.py`  
**–†–∞–∑–º–µ—Ä:** ~2829 —Å—Ç—Ä–æ–∫  
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:** –ê–Ω–∞–ª–∏–∑ –ø–æ–∑–∏—Ü–∏–π –∏ –ø—Ä–∏–Ω—è—Ç–∏–µ —Ä–µ—à–µ–Ω–∏–π –æ –∑–∞–∫—Ä—ã—Ç–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ–∂–∏–º–∞

**–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –ö–û–î - Partial TP –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (—Å—Ç—Ä–æ–∫–∏ 877-916):**

```python
def _get_partial_tp_params(self, regime: str) -> Dict[str, Any]:
    """
    –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ partial_tp –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ –ø–æ —Ä–µ–∂–∏–º—É.
    
    Returns:
        –ü–∞—Ä–∞–º–µ—Ç—Ä—ã partial_tp {enabled: bool, fraction: float, trigger_percent: float}
    """
    params = {
        "enabled": False,
        "fraction": 0.6,
        "trigger_percent": 0.4,  # –ë–∞–∑–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
    }
    
    try:
        if self.scalping_config:
            partial_tp_config = getattr(self.scalping_config, "partial_tp", {})
            if isinstance(partial_tp_config, dict):
                params["enabled"] = partial_tp_config.get("enabled", False)
                params["fraction"] = partial_tp_config.get("fraction", 0.6)
                params["trigger_percent"] = partial_tp_config.get(
                    "trigger_percent", 0.4
                )
                
                # –ü–æ–ª—É—á–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ —Ä–µ–∂–∏–º—É
                by_regime = partial_tp_config.get("by_regime", {})
                if regime in by_regime:
                    regime_config = by_regime[regime]
                    if isinstance(regime_config, dict):
                        params["fraction"] = regime_config.get(
                            "fraction", params["fraction"]
                        )
                        params["trigger_percent"] = regime_config.get(
                            "trigger_percent", params["trigger_percent"]
                        )
    except Exception as e:
        logger.warning(
            f"‚ö†Ô∏è ExitAnalyzer: –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è partial_tp –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤: {e}"
        )
    
    return params
```

**–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –ö–û–î - Adaptive min_holding –¥–ª—è Partial TP (—Å—Ç—Ä–æ–∫–∏ 1117-1276):**

```python
async def _check_adaptive_min_holding_for_partial_tp(
    self, symbol: str, metadata: Any, pnl_percent: float, regime: str
) -> tuple[bool, str]:
    """
    ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ adaptive_min_holding –¥–ª—è Partial TP.
    
    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –º–æ–∂–Ω–æ –ª–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —á–∞—Å—Ç–∏—á–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ:
    - –í—Ä–µ–º–µ–Ω–∏ —É–¥–µ—Ä–∂–∞–Ω–∏—è –ø–æ–∑–∏—Ü–∏–∏
    - –ê–¥–∞–ø—Ç–∏–≤–Ω–æ–≥–æ min_holding –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∏–±—ã–ª–∏
    """
    try:
        # –ü–æ–ª—É—á–∞–µ–º entry_time –∏–∑ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
        entry_time = None
        if metadata and hasattr(metadata, "entry_time"):
            entry_time = metadata.entry_time
        
        if not entry_time:
            return True, "entry_time –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É min_holding"
        
        # –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –≤—Ä–µ–º—è —É–¥–µ—Ä–∂–∞–Ω–∏—è –≤ –º–∏–Ω—É—Ç–∞—Ö
        duration_minutes = (
            datetime.now(timezone.utc) - entry_time
        ).total_seconds() / 60.0
        
        # –ü–æ–ª—É—á–∞–µ–º –±–∞–∑–æ–≤—ã–π min_holding –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ –ø–æ —Ä–µ–∂–∏–º—É
        min_holding_minutes = None
        if self.config_manager:
            regime_params = self.config_manager.get_regime_params(regime)
            if regime_params and isinstance(regime_params, dict):
                min_holding_minutes = regime_params.get("min_holding_minutes")
        
        if min_holding_minutes is None:
            return True, "min_holding –Ω–µ —É–∫–∞–∑–∞–Ω –≤ –∫–æ–Ω—Ñ–∏–≥–µ, —Ä–∞–∑—Ä–µ—à–∞–µ–º partial_tp"
        
        # ‚úÖ –ü–æ–ª—É—á–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã adaptive_min_holding –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
        adaptive_config = None
        if self.scalping_config:
            partial_tp_config = getattr(self.scalping_config, "partial_tp", {})
            if isinstance(partial_tp_config, dict):
                adaptive_config = partial_tp_config.get(
                    "adaptive_min_holding", {}
                )
                if isinstance(adaptive_config, dict):
                    enabled = adaptive_config.get("enabled", False)
                    if not enabled:
                        adaptive_config = None
        
        # ‚úÖ –ü—Ä–∏–º–µ–Ω—è–µ–º adaptive_min_holding –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∏–±—ã–ª–∏
        actual_min_holding = min_holding_minutes
        if adaptive_config:
            profit_threshold_1 = adaptive_config.get("profit_threshold_1", 1.0)
            profit_threshold_2 = adaptive_config.get("profit_threshold_2", 0.5)
            reduction_factor_1 = adaptive_config.get("reduction_factor_1", 0.5)
            reduction_factor_2 = adaptive_config.get("reduction_factor_2", 0.75)
            
            if pnl_percent >= profit_threshold_1:
                # –ü—Ä–∏–±—ã–ª—å >= 1.0% ‚Üí —Å–Ω–∏–∂–∞–µ–º min_holding –¥–æ 50%
                actual_min_holding = min_holding_minutes * reduction_factor_1
            elif pnl_percent >= profit_threshold_2:
                # –ü—Ä–∏–±—ã–ª—å >= 0.5% ‚Üí —Å–Ω–∏–∂–∞–µ–º min_holding –¥–æ 75%
                actual_min_holding = min_holding_minutes * reduction_factor_2
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø—Ä–æ—à–ª–æ –ª–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤—Ä–µ–º–µ–Ω–∏
        if duration_minutes >= actual_min_holding:
            return (
                True,
                f"min_holding –ø—Ä–æ–π–¥–µ–Ω: {duration_minutes:.1f} –º–∏–Ω >= {actual_min_holding:.1f} –º–∏–Ω",
            )
        else:
            return (
                False,
                f"min_holding –Ω–µ –ø—Ä–æ–π–¥–µ–Ω: {duration_minutes:.1f} –º–∏–Ω < {actual_min_holding:.1f} –º–∏–Ω",
            )
    except Exception as e:
        logger.error(
            f"‚ùå ExitAnalyzer: –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ adaptive_min_holding –¥–ª—è {symbol}: {e}",
            exc_info=True,
        )
        return True, f"–æ—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ min_holding: {e}, —Ä–∞–∑—Ä–µ—à–∞–µ–º partial_tp"
```

**–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –ö–û–î - Partial TP –≤ TRENDING —Ä–µ–∂–∏–º–µ (—Å—Ç—Ä–æ–∫–∏ 1383-1425):**

```python
# 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ partial_tp —Å —É—á–µ—Ç–æ–º adaptive_min_holding
partial_tp_params = self._get_partial_tp_params("trending")
if partial_tp_params.get("enabled", False):
    trigger_percent = partial_tp_params.get("trigger_percent", 0.8)  # 0.8% –¥–ª—è trending
    if pnl_percent >= trigger_percent:
        # ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ–º adaptive_min_holding –ø–µ—Ä–µ–¥ partial_tp
        (
            can_partial_close,
            min_holding_info,
        ) = await self._check_adaptive_min_holding_for_partial_tp(
            symbol, metadata, pnl_percent, "trending"
        )
        
        if can_partial_close:
            fraction = partial_tp_params.get("fraction", 0.6)
            logger.info(
                f"üìä ExitAnalyzer TRENDING: Partial TP —Ç—Ä–∏–≥–≥–µ—Ä –¥–æ—Å—Ç–∏–≥–Ω—É—Ç –¥–ª—è {symbol}: "
                f"{pnl_percent:.2f}% >= {trigger_percent:.2f}%, –∑–∞–∫—Ä—ã–≤–∞–µ–º {fraction*100:.0f}% –ø–æ–∑–∏—Ü–∏–∏"
            )
            return {
                "action": "partial_close",
                "reason": "partial_tp",
                "pnl_pct": pnl_percent,
                "trigger_percent": trigger_percent,
                "fraction": fraction,
                "min_holding_info": min_holding_info,
            }
        else:
            logger.debug(
                f"‚è±Ô∏è ExitAnalyzer TRENDING: Partial TP —Ç—Ä–∏–≥–≥–µ—Ä –¥–æ—Å—Ç–∏–≥–Ω—É—Ç, "
                f"–Ω–æ min_holding –Ω–µ –ø—Ä–æ–π–¥–µ–Ω ({min_holding_info}), –∂–¥–µ–º..."
            )
            return {
                "action": "hold",
                "reason": "partial_tp_min_holding_wait",
                "pnl_pct": pnl_percent,
                "min_holding_info": min_holding_info,
            }
```

**–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –ö–û–î - Partial TP –≤ RANGING —Ä–µ–∂–∏–º–µ (—Å—Ç—Ä–æ–∫–∏ 1936-2037):**

```python
# 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ partial_tp —Å —É—á–µ—Ç–æ–º adaptive_min_holding
partial_tp_params = self._get_partial_tp_params("ranging")
if partial_tp_params.get("enabled", False):
    trigger_percent = partial_tp_params.get("trigger_percent", 1.2)  # 1.2% –¥–ª—è ranging
    if pnl_percent >= trigger_percent:
        # ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ–º adaptive_min_holding –ø–µ—Ä–µ–¥ partial_tp
        (
            can_partial_close,
            min_holding_info,
        ) = await self._check_adaptive_min_holding_for_partial_tp(
            symbol, metadata, pnl_percent, "ranging"
        )
        
        if can_partial_close:
            fraction = partial_tp_params.get("fraction", 0.6)  # 60% –¥–ª—è ranging
            logger.info(
                f"üìä ExitAnalyzer RANGING: Partial TP —Ç—Ä–∏–≥–≥–µ—Ä –¥–æ—Å—Ç–∏–≥–Ω—É—Ç –¥–ª—è {symbol}: "
                f"{pnl_percent:.2f}% >= {trigger_percent:.2f}%, –∑–∞–∫—Ä—ã–≤–∞–µ–º {fraction*100:.0f}% –ø–æ–∑–∏—Ü–∏–∏"
            )
            return {
                "action": "partial_close",
                "reason": "partial_tp",
                "pnl_pct": pnl_percent,
                "trigger_percent": trigger_percent,
                "fraction": fraction,
                "min_holding_info": min_holding_info,
            }
```

**–ü–æ–ª–Ω—ã–π –∫–æ–¥ —Ñ–∞–π–ª–∞:** –°–º. —Ä–∞–∑–¥–µ–ª [–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ C: –ü–æ–ª–Ω—ã–π –∫–æ–¥ exit_analyzer.py](#–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ-c-–ø–æ–ª–Ω—ã–π-–∫–æ–¥-exit_analyzerpy)

---

### 4. signal_generator.py - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤

**–§–∞–π–ª:** `src/strategies/scalping/futures/signal_generator.py`  
**–†–∞–∑–º–µ—Ä:** ~4850 —Å—Ç—Ä–æ–∫  
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:** –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–æ—Ä–≥–æ–≤—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤, —Ä–∞—Å—á–µ—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤, –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤

**–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã:**
- `generate_signal()` - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–∞ –¥–ª—è —Å–∏–º–≤–æ–ª–∞
- `_calculate_signal_score()` - –†–∞—Å—á–µ—Ç —Å–∏–ª—ã —Å–∏–≥–Ω–∞–ª–∞ (0-12 –±–∞–ª–ª–æ–≤)
- `_apply_filters()` - –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤

**–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –ö–û–î - –°–∏—Å—Ç–µ–º–∞ –æ—Ü–µ–Ω–∫–∏ —Å–∏–≥–Ω–∞–ª–æ–≤:**

```python
# –ë–∞–∑–æ–≤—ã–µ –±–∞–ª–ª—ã (0-12):
# - SMA Trend: +1 –±–∞–ª–ª
# - EMA Trend: +2 –±–∞–ª–ª–∞
# - RSI: +2 –±–∞–ª–ª–∞
# - Bollinger Bands: +2 –±–∞–ª–ª–∞
# - Volume: +2 –±–∞–ª–ª–∞
# - MACD: +2 –±–∞–ª–ª–∞

# –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø–æ—Ä–æ–≥ (–∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π –ø–æ —Ä–µ–∂–∏–º—É):
# - TRENDING: 6/12 –±–∞–ª–ª–æ–≤ (50%)
# - RANGING: 4/12 –±–∞–ª–ª–æ–≤ (33%)
# - CHOPPY: 7/12 –±–∞–ª–ª–æ–≤ (58%)
```

**–ü–æ–ª–Ω—ã–π –∫–æ–¥ —Ñ–∞–π–ª–∞:** –°–º. —Ä–∞–∑–¥–µ–ª [–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ D: –ü–æ–ª–Ω—ã–π –∫–æ–¥ signal_generator.py](#–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ-d-–ø–æ–ª–Ω—ã–π-–∫–æ–¥-signal_generatorpy)

---

### 5. risk_manager.py - –†–∏—Å–∫-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç

**–§–∞–π–ª:** `src/strategies/scalping/futures/risk_manager.py`  
**–†–∞–∑–º–µ—Ä:** ~1721 —Å—Ç—Ä–æ–∫–∞  
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:** –†–∞—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏, –ø—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤ –º–∞—Ä–∂–∏, –∑–∞—â–∏—Ç–∞ –æ—Ç –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏

**–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã:**
- `calculate_position_size()` - –†–∞—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏
- `_calculate_dynamic_margin_cap()` - –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –º–∞—Ä–∂–∏
- `check_risk_limits()` - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤ —Ä–∏—Å–∫–∞

**–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –ö–û–î - –†–∞—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏:**

```python
async def calculate_position_size(
    self,
    symbol: str,
    balance: float,
    regime: str,
    signal_strength: float = 1.0,
    volatility: Optional[float] = None,
) -> float:
    """
    –†–∞—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏ —Å —É—á–µ—Ç–æ–º:
    - –ë–∞–ª–∞–Ω—Å–∞ (–∞–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏)
    - –†–µ–∂–∏–º–∞ —Ä—ã–Ω–∫–∞
    - –í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏
    - –°–∏–ª—ã —Å–∏–≥–Ω–∞–ª–∞
    """
    # 1. –ü–æ–ª—É—á–∞–µ–º –ø—Ä–æ—Ñ–∏–ª—å –±–∞–ª–∞–Ω—Å–∞
    balance_profile = self.config_manager.get_balance_profile(balance)
    
    # 2. –ë–∞–∑–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä –∏–∑ –ø—Ä–æ—Ñ–∏–ª—è
    base_size_usd = balance_profile.get("base_position_usd", 100.0)
    
    # 3. –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –Ω–∞ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å
    if volatility:
        volatility_multiplier = self._calculate_volatility_multiplier(
            volatility, regime
        )
        base_size_usd *= volatility_multiplier
    
    # 4. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
    max_size = balance_profile.get("max_position_usd", 200.0)
    min_size = balance_profile.get("min_position_usd", 50.0)
    max_percent = balance_profile.get("max_position_percent", 25.0) / 100.0
    
    position_size = min(base_size_usd, max_size)
    position_size = max(position_size, min_size)
    position_size = min(position_size, balance * max_percent)
    
    return position_size
```

**–ü–æ–ª–Ω—ã–π –∫–æ–¥ —Ñ–∞–π–ª–∞:** –°–º. —Ä–∞–∑–¥–µ–ª [–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ E: –ü–æ–ª–Ω—ã–π –∫–æ–¥ risk_manager.py](#–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ-e-–ø–æ–ª–Ω—ã–π-–∫–æ–¥-risk_managerpy)

---

## ‚öôÔ∏è –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø

### config_futures.yaml - –í—Å–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

**–§–∞–π–ª:** `config/config_futures.yaml`  
**–†–∞–∑–º–µ—Ä:** ~1872 —Å—Ç—Ä–æ–∫–∏

**–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –°–ï–ö–¶–ò–ò:**

#### Partial TP –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:

```yaml
partial_tp:
  enabled: true
  fraction: 0.6            # 60% –ø–æ–∑–∏—Ü–∏–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
  trigger_percent: 1.0     # ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 0.4% –¥–æ 1.0%
  post_only: true
  limit_offset_bps: 7.0    # 0.07% –æ—Ç —Ç–µ–∫—É—â–µ–π —Ü–µ–Ω—ã
  
  # ‚úÖ –≠–¢–ê–ü 1.2: –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π min_holding –¥–ª—è Partial TP
  adaptive_min_holding:
    enabled: true
    profit_threshold_1: 1.0  # –ü—Ä–∏–±—ã–ª—å >= 1.0% ‚Üí —Å–Ω–∏–∂–∞–µ–º min_holding –¥–æ 50%
    profit_threshold_2: 0.5  # –ü—Ä–∏–±—ã–ª—å >= 0.5% ‚Üí —Å–Ω–∏–∂–∞–µ–º min_holding –¥–æ 75%
    reduction_factor_1: 0.5  # –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Å–Ω–∏–∂–µ–Ω–∏—è –¥–ª—è threshold_1 (50%)
    reduction_factor_2: 0.75 # –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Å–Ω–∏–∂–µ–Ω–∏—è –¥–ª—è threshold_2 (75%)
  
  # ‚úÖ –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ —Ä–µ–∂–∏–º–∞–º
  by_regime:
    trending:
      fraction: 0.5        # 50% –ø–æ–∑–∏—Ü–∏–∏
      trigger_percent: 1.2 # ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï: –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 0.4% –¥–æ 1.2%
    ranging:
      fraction: 0.6        # 60% –ø–æ–∑–∏—Ü–∏–∏
      trigger_percent: 1.2 # ‚úÖ –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø: –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 1.0% –¥–æ 1.2%
    choppy:
      fraction: 0.7        # 70% –ø–æ–∑–∏—Ü–∏–∏
      trigger_percent: 0.8 # ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï: –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 0.2% –¥–æ 0.8%
```

#### TP/SL –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

```yaml
# Take Profit –∏ Stop Loss
tp_percent: 1.2  # ‚úÖ –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø: –£–º–µ–Ω—å—à–µ–Ω–æ —Å 2.8% –¥–æ 1.2% (-57%)
sl_percent: 0.8  # ‚úÖ –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø: –£–º–µ–Ω—å—à–µ–Ω–æ —Å 1.3% –¥–æ 0.8% (-38%)
```

#### Balance Profiles:

```yaml
balance_profiles:
  small:  # $500 - $1500
    threshold: 1500.0
    min_balance: 500.0
    size_at_min: 100.0
    size_at_max: 200.0
    base_position_usd: 100.0
    min_position_usd: 50.0
    max_position_usd: 250.0
    max_open_positions: 5
    max_position_percent: 25.0
    progressive: true
```

#### Position Scaling (–ª–µ—Å—Ç–Ω–∏—á–Ω—ã–π –≤—Ö–æ–¥):

```yaml
position_scaling:
  max_additions: 7
  min_interval_seconds: 30
  max_loss_for_addition: -5.0  # ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û (–ö–ò–ú–ò): -5.0% (–±—ã–ª–æ -3.0%)
  ladder: [1.0, 0.8, 0.6, 0.4, 0.3, 0.2, 0.15]
```

**–ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ñ–∏–≥:** –°–º. —Ä–∞–∑–¥–µ–ª [–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ F: –ü–æ–ª–Ω—ã–π config_futures.yaml](#–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ-f-–ø–æ–ª–Ω—ã–π-config_futuresyaml)

---

## üìä –õ–û–ì–ò –ü–û–°–õ–ï–î–ù–ï–ô –°–ï–°–°–ò–ò

### trades_2025-12-21.csv - –í—Å–µ —Å–¥–µ–ª–∫–∏

**–§–∞–π–ª:** `logs/futures/archived/logs_2025-12-21_10-22-57/trades_2025-12-21.csv`  
**–í—Å–µ–≥–æ —Å–¥–µ–ª–æ–∫:** 41

**–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:**
- –ü—Ä–∏–±—ã–ª—å–Ω—ã—Ö: 20 (48.8%)
- –£–±—ã—Ç–æ—á–Ω—ã—Ö: 21 (51.2%)
- –û–±—â–∏–π PnL: -2.15 USDT
- –°—Ä–µ–¥–Ω–∏–π PnL: -0.052 USDT
- Win Rate: 48.8%

**–ü—Ä–∏—á–∏–Ω—ã –∑–∞–∫—Ä—ã—Ç–∏—è:**
- `partial_tp`: 10 —Å–¥–µ–ª–æ–∫ (24.4%)
- `sl_reached`: 21 —Å–¥–µ–ª–∫–∞ (51.2%)
- `tp`: 1 —Å–¥–µ–ª–∫–∞ (2.4%)
- `tp_reached`: 1 —Å–¥–µ–ª–∫–∞ (2.4%)
- `big_profit_exit`: 8 —Å–¥–µ–ª–æ–∫ (19.5%)

**–ü—Ä–æ–±–ª–µ–º–Ω—ã–µ —Å–¥–µ–ª–∫–∏ (–∫–æ–º–∏—Å—Å–∏—è > PnL):**
1. DOGE-USDT: gross_pnl=+0.0524, commission=-0.0640, net_pnl=-0.0116
2. ETH-USDT: gross_pnl=+0.0350, commission=-0.0755, net_pnl=-0.0405
3. BTC-USDT: gross_pnl=+0.0436, commission=-0.0973, net_pnl=-0.0537

**–ü–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**

```csv
timestamp,symbol,side,entry_price,exit_price,size,gross_pnl,commission,net_pnl,duration_sec,reason,win_rate
2025-12-21T00:41:49.422517+00:00,BTC-USDT,long,89381.4000,89671.0000,0.00170000,0.4923,0.0762,0.4161,824.573497,partial_tp,100.00
2025-12-21T00:54:57.653978+00:00,DOGE-USDT,long,0.1318,0.1319,970.00000000,0.1164,0.0640,0.0524,1176.659978,partial_tp,100.00
2025-12-21T03:59:32.230645,XRP-USDT,short,1.9343,1.9353,127.00000000,-0.1207,0.2457,-0.3664,50.274182,sl_reached,66.67
... (–≤—Å–µ 41 —Å–¥–µ–ª–∫–∞)
```

---

### signals_2025-12-21.csv - –í—Å–µ —Å–∏–≥–Ω–∞–ª—ã

**–§–∞–π–ª:** `logs/futures/archived/logs_2025-12-21_10-22-57/signals_2025-12-21.csv`  
**–í—Å–µ–≥–æ —Å–∏–≥–Ω–∞–ª–æ–≤:** 197  
**–ò—Å–ø–æ–ª–Ω–µ–Ω–æ —Å–¥–µ–ª–æ–∫:** 41  
**–ö–æ–Ω–≤–µ—Ä—Å–∏—è:** 20.8%

**–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤:**
- `strength=1.0`: 156 —Å–∏–≥–Ω–∞–ª–æ–≤ (79.2%)
- `strength=0.8-0.9`: 28 —Å–∏–≥–Ω–∞–ª–æ–≤ (14.2%)
- `strength=0.5-0.7`: 13 —Å–∏–≥–Ω–∞–ª–æ–≤ (6.6%)

**–†–µ–∂–∏–º—ã:**
- `ranging`: 145 —Å–∏–≥–Ω–∞–ª–æ–≤ (73.6%)
- `trending`: 38 —Å–∏–≥–Ω–∞–ª–æ–≤ (19.3%)
- `choppy`: 14 —Å–∏–≥–Ω–∞–ª–æ–≤ (7.1%)

**–ü—Ä–æ–±–ª–µ–º–∞:** –°–∏–≥–Ω–∞–ª—ã —Å `strength=1.0` –Ω–µ –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª–Ω—è—é—Ç—Å—è (—Ç–æ–ª—å–∫–æ 20.8% –∫–æ–Ω–≤–µ—Ä—Å–∏—è)

**–ü—Ä–∏—á–∏–Ω—ã –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏:**
- Position limit (>= 5 –ø–æ–∑–∏—Ü–∏–π)
- –§–∏–ª—å—Ç—Ä—ã (MTF, Correlation, ADX)
- –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π –±–∞–ª–∞–Ω—Å
- Rate limiting

---

### orders_2025-12-21.csv - –í—Å–µ –æ—Ä–¥–µ—Ä–∞

**–§–∞–π–ª:** `logs/futures/archived/logs_2025-12-21_10-22-57/orders_2025-12-21.csv`  
**–í—Å–µ–≥–æ –æ—Ä–¥–µ—Ä–æ–≤:** 31

**–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:**
- `limit`: 31 –æ—Ä–¥–µ—Ä (100%)
- `placed`: 31 –æ—Ä–¥–µ—Ä (100%)
- `filled`: 0 –æ—Ä–¥–µ—Ä–æ–≤ (0%) - –≤—Å–µ –æ—Ä–¥–µ—Ä–∞ –±—ã–ª–∏ –æ—Ç–º–µ–Ω–µ–Ω—ã –∏–ª–∏ –Ω–µ –∏—Å–ø–æ–ª–Ω–µ–Ω—ã

**–ü—Ä–æ–±–ª–µ–º–∞:** –í—Å–µ –æ—Ä–¥–µ—Ä–∞ –±—ã–ª–∏ —Ä–∞–∑–º–µ—â–µ–Ω—ã –∫–∞–∫ LIMIT, –Ω–æ –Ω–∏ –æ–¥–∏–Ω –Ω–µ –±—ã–ª –∏—Å–ø–æ–ª–Ω–µ–Ω (–≤–æ–∑–º–æ–∂–Ω–æ, —Ü–µ–Ω–∞ –±—ã–ª–∞ –Ω–µ–∞–∫—Ç—É–∞–ª—å–Ω–æ–π)

---

### –ö–ª—é—á–µ–≤—ã–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã futures_main_2025-12-21.log

**–§–∞–π–ª:** `logs/futures/archived/logs_2025-12-21_10-22-57/futures_main_2025-12-21.log`  
**–†–∞–∑–º–µ—Ä:** ~91 –ú–ë  
**–°—Ç—Ä–æ–∫:** ~94,812

**–ö–ª—é—á–µ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 6 —á–∞—Å–æ–≤):**

```
2025-12-21 09:29:18.014 | INFO | position_manager:_close_position_by_reason | ‚úÖ –ü–æ–∑–∏—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∞: XRP-USDT | –ü—Ä–∏—á–∏–Ω–∞: sl_reached | PnL: -0.4780 USDT
2025-12-21 09:32:44.044 | INFO | position_manager:_close_position_by_reason | ‚úÖ –ü–æ–∑–∏—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∞: BTC-USDT | –ü—Ä–∏—á–∏–Ω–∞: sl_reached | PnL: -0.8209 USDT
2025-12-21 10:16:25.347 | DEBUG | exit_analyzer:_check_adaptive_min_holding_for_partial_tp | ‚è±Ô∏è Partial TP —Ç—Ä–∏–≥–≥–µ—Ä –¥–æ—Å—Ç–∏–≥–Ω—É—Ç, –Ω–æ min_holding –Ω–µ –ø—Ä–æ–π–¥–µ–Ω (0.5 –º–∏–Ω < 1.0 –º–∏–Ω), –∂–¥–µ–º...
2025-12-21 10:22:28.568 | INFO | trading_control_center:run_main_loop | üõë TCC: –¢–æ—Ä–≥–æ–≤—ã–π —Ü–∏–∫–ª –æ—Ç–º–µ–Ω–µ–Ω
```

**–ü–æ–ª–Ω—ã–µ –ª–æ–≥–∏:** –°–º. —Ä–∞–∑–¥–µ–ª [–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ G: –ö–ª—é—á–µ–≤—ã–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã –ª–æ–≥–æ–≤](#–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ-g-–∫–ª—é—á–µ–≤—ã–µ-—Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã-–ª–æ–≥–æ–≤)

---

## üì¶ –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –ú–û–î–£–õ–ò

### position_scaling_manager.py - –õ–µ—Å—Ç–Ω–∏—á–Ω—ã–π –≤—Ö–æ–¥

**–§–∞–π–ª:** `src/strategies/scalping/futures/positions/position_scaling_manager.py`  
**–†–∞–∑–º–µ—Ä:** ~645 —Å—Ç—Ä–æ–∫

**–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –ö–û–î - –õ–µ—Å—Ç–Ω–∏—Ü–∞ (—Å—Ç—Ä–æ–∫–∏ 70-100):**

```python
default_config = {
    "max_additions": 7,
    "min_interval_seconds": 30,
    "max_loss_for_addition": -5.0,  # ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û (–ö–ò–ú–ò): -5.0% (–±—ã–ª–æ -3.0%)
    "ladder": [1.0, 0.8, 0.6, 0.4, 0.3, 0.2, 0.15],
}

# –†–∞—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è:
addition_count = len(scaling_history)
if addition_count >= len(ladder):
    ladder_coefficient = ladder[-1]  # –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç
else:
    ladder_coefficient = ladder[addition_count]  # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π

addition_size_usd = base_size_usd * ladder_coefficient
```

---

### position_registry.py - –†–µ–µ—Å—Ç—Ä –ø–æ–∑–∏—Ü–∏–π

**–§–∞–π–ª:** `src/strategies/scalping/futures/core/position_registry.py`  
**–†–∞–∑–º–µ—Ä:** ~402 —Å—Ç—Ä–æ–∫–∏

**–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –ö–û–î - PositionMetadata:**

```python
@dataclass
class PositionMetadata:
    entry_time: datetime
    position_id: Optional[str] = None
    regime: Optional[str] = None
    balance_profile: Optional[str] = None
    entry_price: Optional[float] = None
    position_side: Optional[str] = None
    leverage: Optional[int] = None
    size_in_coins: Optional[float] = None
    margin_used: Optional[float] = None
    min_holding_seconds: Optional[float] = None
    peak_profit_usd: float = 0.0
    peak_profit_time: Optional[datetime] = None
    tp_extension_count: int = 0
    partial_tp_executed: bool = False  # ‚úÖ –§–ª–∞–≥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è partial_tp
    scaling_history: Optional[List[Dict[str, Any]]] = None  # –ò—Å—Ç–æ—Ä–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏–π
```

---

### adaptive_leverage.py - –ê–¥–∞–ø—Ç–∏–≤–Ω–æ–µ –ø–ª–µ—á–æ

**–§–∞–π–ª:** `src/strategies/scalping/futures/risk/adaptive_leverage.py`  
**–†–∞–∑–º–µ—Ä:** ~192 —Å—Ç—Ä–æ–∫–∏

**–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –ö–û–î - –†–∞—Å—á–µ—Ç –ª–µ–≤–µ—Ä–∏–¥–∂–∞:**

```python
# –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∫–∞—á–µ—Å—Ç–≤–∞ —Å–∏–≥–Ω–∞–ª–∞:
very_weak (0.0-0.3)   ‚Üí 3x  –ø–ª–µ—á–æ
weak (0.3-0.5)        ‚Üí 5x  –ø–ª–µ—á–æ
medium (0.5-0.7)      ‚Üí 10x –ø–ª–µ—á–æ
strong (0.7-0.9)      ‚Üí 20x –ø–ª–µ—á–æ
very_strong (0.9-1.0)  ‚Üí 30x –ø–ª–µ—á–æ

# –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –Ω–∞ —Ä–µ–∂–∏–º:
if regime == "trending":
    regime_multiplier = 1.2  # +20% –∫ –ø–ª–µ—á—É
elif regime == "choppy":
    regime_multiplier = 0.8  # -20% –∫ –ø–ª–µ—á—É

# –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –Ω–∞ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å:
if volatility > 0.05:  # –í—ã—Å–æ–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å
    volatility_multiplier = 0.7  # –£–º–µ–Ω—å—à–∞–µ–º –ø–ª–µ—á–æ
elif volatility < 0.01:  # –ù–∏–∑–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å
    volatility_multiplier = 1.3  # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –ø–ª–µ—á–æ

# –§–∏–Ω–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç:
adjusted_strength = signal_strength * regime_multiplier * volatility_multiplier
leverage = leverage_map[category]

# –û–∫—Ä—É–≥–ª—è–µ–º –¥–æ –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –Ω–∞ –±–∏—Ä–∂–µ:
leverage = await client.round_leverage_to_available(symbol, leverage)
if leverage != original_leverage:
    logger.warning(
        f"‚ö†Ô∏è [ADAPTIVE_LEVERAGE] {symbol}: –õ–µ–≤–µ—Ä–∏–¥–∂ –∏–∑–º–µ–Ω–µ–Ω –±–∏—Ä–∂–µ–π | "
        f"–ó–∞—è–≤–ª–µ–Ω–Ω—ã–π: {original_leverage}x ‚Üí –§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π: {leverage}x"
    )
```

---

## üîç –í–´–í–û–î–´ –ò –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### –ü—Ä–æ–±–ª–µ–º—ã, –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –ö–ò–ú–ò (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã):

1. ‚úÖ **Partial TP –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç 40%** - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: —É–º–µ–Ω—å—à–µ–Ω—ã –º–∏–Ω–∏–º—É–º—ã (small: $1.5, medium: $2.5, large: $3.0)
2. ‚úÖ **–û—à–∏–±–∫–∏ 51006** - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ —Ü–µ–Ω—ã –¥–æ tickSize OKX
3. ‚úÖ **–õ–µ–≤–µ—Ä–∏–¥–∂ –Ω–µ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è** - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: –¥–æ–±–∞–≤–ª–µ–Ω–æ warning –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
4. ‚úÖ **–õ–µ—Å—Ç–Ω–∏—Ü–∞: —Ç–æ–ª—å–∫–æ 3 –∏–∑ 7 —à–∞–≥–æ–≤** - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: max_loss_for_addition: -3.0% ‚Üí -5.0%
5. ‚úÖ **–ú–∏–∫—Ä–æ-–∑–∞–∫—Ä—ã—Ç–∏—è (–∫–æ–º–∏—Å—Å–∏—è > PnL)** - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º

### –ü—Ä–æ–±–ª–µ–º—ã –¥–ª—è –∞—É–¥–∏—Ç–∞ –ì—Ä–æ–∫–∞:

1. **–ù–∏–∑–∫–∞—è –∫–æ–Ω–≤–µ—Ä—Å–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤:** 20.8% (197 —Å–∏–≥–Ω–∞–ª–æ–≤ ‚Üí 41 —Å–¥–µ–ª–∫–∞)
   - –ü—Ä–∏—á–∏–Ω–∞: position limit = 5, —Ñ–∏–ª—å—Ç—Ä—ã –±–ª–æ–∫–∏—Ä—É—é—Ç
   
2. **Win Rate:** 48.8% (–≥—Ä–∞–Ω–∏—á–Ω–æ –ø—Ä–∏–±—ã–ª—å–Ω–æ —Å —É—á–µ—Ç–æ–º –∫–æ–º–∏—Å—Å–∏–π)
   - –ù—É–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ –≤—Ö–æ–¥–æ–≤
   
3. **Partial TP —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ä–µ–¥–∫–æ:**
   - min_holding –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø—Ä–µ–∂–¥–µ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ
   - trigger_percent –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–ª–∏—à–∫–æ–º –≤—ã—Å–æ–∫–∏–º (1.2% –¥–ª—è ranging)

4. **–°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ TP/SL:** 1.2% / 0.8% = 1.5:1
   - –ú–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ–π –ø—Ä–∏–±—ã–ª—å–Ω–æ—Å—Ç–∏

---

**–§–∞–π–ª —Å–æ–∑–¥–∞–Ω:** 21 –¥–µ–∫–∞–±—Ä—è 2025  
**–ì–æ—Ç–æ–≤ –¥–ª—è –∞—É–¥–∏—Ç–∞ –ì—Ä–æ–∫–æ–º 4.1**

---

## üìé –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø

### –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ A: –ü–æ–ª–Ω—ã–π –∫–æ–¥ orchestrator.py

*(–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é - ~4432 —Å—Ç—Ä–æ–∫–∏)*

**–ö–ª—é—á–µ–≤—ã–µ —á–∞—Å—Ç–∏:**
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥—É–ª–µ–π (—Å—Ç—Ä–æ–∫–∏ 75-300)
- –ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª —Ç–æ—Ä–≥–æ–≤–ª–∏ (—Å—Ç—Ä–æ–∫–∏ 400-800)
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–∏–º–≤–æ–ª–æ–≤ (—Å—Ç—Ä–æ–∫–∏ 800-1200)
- –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–π (—Å—Ç—Ä–æ–∫–∏ 2000-2500)

**–ü–æ–ª–Ω—ã–π —Ñ–∞–π–ª –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –ø—É—Ç–∏:** `src/strategies/scalping/futures/orchestrator.py`

---

### –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ B: –ü–æ–ª–Ω—ã–π –∫–æ–¥ position_manager.py

*(–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é - ~6800 —Å—Ç—Ä–æ–∫)*

**–ö–ª—é—á–µ–≤—ã–µ —á–∞—Å—Ç–∏:**
- Partial TP –ª–æ–≥–∏–∫–∞ (—Å—Ç—Ä–æ–∫–∏ 6000-6200)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ PnL < –∫–æ–º–∏—Å—Å–∏—è (—Å—Ç—Ä–æ–∫–∏ 3745-3770)
- –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–π (—Å—Ç—Ä–æ–∫–∏ 3635-4000)

**–ü–æ–ª–Ω—ã–π —Ñ–∞–π–ª –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –ø—É—Ç–∏:** `src/strategies/scalping/futures/position_manager.py`

---

### –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ C: –ü–æ–ª–Ω—ã–π –∫–æ–¥ exit_analyzer.py

*(–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é - ~2829 —Å—Ç—Ä–æ–∫)*

**–ö–ª—é—á–µ–≤—ã–µ —á–∞—Å—Ç–∏:**
- Partial TP –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (—Å—Ç—Ä–æ–∫–∏ 877-916)
- Adaptive min_holding (—Å—Ç—Ä–æ–∫–∏ 1117-1276)
- TRENDING —Ä–µ–∂–∏–º (—Å—Ç—Ä–æ–∫–∏ 1278-1500)
- RANGING —Ä–µ–∂–∏–º (—Å—Ç—Ä–æ–∫–∏ 1500-2100)
- CHOPPY —Ä–µ–∂–∏–º (—Å—Ç—Ä–æ–∫–∏ 2100-2500)

**–ü–æ–ª–Ω—ã–π —Ñ–∞–π–ª –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –ø—É—Ç–∏:** `src/strategies/scalping/futures/positions/exit_analyzer.py`

---

### –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ D: –ü–æ–ª–Ω—ã–π –∫–æ–¥ signal_generator.py

*(–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é - ~4850 —Å—Ç—Ä–æ–∫)*

**–ö–ª—é—á–µ–≤—ã–µ —á–∞—Å—Ç–∏:**
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤ (—Å—Ç—Ä–æ–∫–∏ 500-1000)
- –°–∏—Å—Ç–µ–º–∞ –æ—Ü–µ–Ω–∫–∏ (—Å—Ç—Ä–æ–∫–∏ 1000-1500)
- –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤ (—Å—Ç—Ä–æ–∫–∏ 2000-3000)

**–ü–æ–ª–Ω—ã–π —Ñ–∞–π–ª –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –ø—É—Ç–∏:** `src/strategies/scalping/futures/signal_generator.py`

---

### –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ E: –ü–æ–ª–Ω—ã–π –∫–æ–¥ risk_manager.py

*(–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é - ~1721 —Å—Ç—Ä–æ–∫–∞)*

**–ö–ª—é—á–µ–≤—ã–µ —á–∞—Å—Ç–∏:**
- –†–∞—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏ (—Å—Ç—Ä–æ–∫–∏ 200-500)
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π margin cap (—Å—Ç—Ä–æ–∫–∏ 149-300)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤ (—Å—Ç—Ä–æ–∫–∏ 500-800)

**–ü–æ–ª–Ω—ã–π —Ñ–∞–π–ª –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –ø—É—Ç–∏:** `src/strategies/scalping/futures/risk_manager.py`

---

### –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ F: –ü–æ–ª–Ω—ã–π config_futures.yaml

*(–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é - ~1872 —Å—Ç—Ä–æ–∫–∏)*

**–ö–ª—é—á–µ–≤—ã–µ —Å–µ–∫—Ü–∏–∏:**
- `partial_tp` (—Å—Ç—Ä–æ–∫–∏ 68-94)
- `tp_percent` / `sl_percent` (—Å—Ç—Ä–æ–∫–∏ 52-53)
- `balance_profiles` (—Å—Ç—Ä–æ–∫–∏ 168-200)
- `position_scaling` (–µ—Å–ª–∏ –µ—Å—Ç—å –≤ –∫–æ–Ω—Ñ–∏–≥–µ)

**–ü–æ–ª–Ω—ã–π —Ñ–∞–π–ª –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –ø—É—Ç–∏:** `config/config_futures.yaml`

---

### –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ G: –ö–ª—é—á–µ–≤—ã–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã –ª–æ–≥–æ–≤

**–ü–æ—Å–ª–µ–¥–Ω–∏–µ 6 —á–∞—Å–æ–≤ —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞ (03:00-10:22):**

```
2025-12-21 03:06:22.617 | INFO | position_manager:close_partial_position | ‚úÖ Partial TP: ETH-USDT | –ó–∞–∫—Ä—ã—Ç–æ 60% | PnL: +0.0521 USDT
2025-12-21 03:17:13.762 | INFO | position_manager:close_partial_position | ‚úÖ Partial TP: DOGE-USDT | –ó–∞–∫—Ä—ã—Ç–æ 60% | PnL: +0.1275 USDT
2025-12-21 04:07:11.055 | ERROR | position_manager:_close_position_by_reason | ‚ùå –ü–æ–∑–∏—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∞ –ø–æ SL: BTC-USDT | PnL: -0.8717 USDT
2025-12-21 06:01:44.900 | ERROR | position_manager:_close_position_by_reason | ‚ùå –ü–æ–∑–∏—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∞ –ø–æ SL: ETH-USDT | PnL: -0.5121 USDT
2025-12-21 09:29:18.014 | ERROR | position_manager:_close_position_by_reason | ‚ùå –ü–æ–∑–∏—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∞ –ø–æ SL: XRP-USDT | PnL: -0.4780 USDT
2025-12-21 10:16:25.347 | DEBUG | exit_analyzer:_check_adaptive_min_holding_for_partial_tp | ‚è±Ô∏è Partial TP: min_holding –Ω–µ –ø—Ä–æ–π–¥–µ–Ω (0.5 –º–∏–Ω < 1.0 –º–∏–Ω)
```

**–ü–æ–ª–Ω—ã–µ –ª–æ–≥–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ –ø—É—Ç–∏:** `logs/futures/archived/logs_2025-12-21_10-22-57/futures_main_2025-12-21.log`

---

**–ö–æ–Ω–µ—Ü –¥–æ–∫—É–º–µ–Ω—Ç–∞**




