# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞—Å—á–µ—Ç–∞ TP (Take Profit)

## üîç –ü—Ä–æ–±–ª–µ–º–∞

–ü–æ–∑–∏—Ü–∏–∏ –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–ª–∏—Å—å –ø–æ TP, –¥–∞–∂–µ –∫–æ–≥–¥–∞ PnL% –Ω–∞ –±–∏—Ä–∂–µ –ø–æ–∫–∞–∑—ã–≤–∞–ª –∑–Ω–∞—á–µ–Ω–∏—è –≤—ã—à–µ –ø–æ—Ä–æ–≥–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 0.89% –¥–ª—è ETH –ø—Ä–∏ TP=0.4%).

## üîé –ü—Ä–∏—á–∏–Ω–∞

**–†–∞—Å—á–µ—Ç PnL% –±—ã–ª –ù–ï–ü–†–ê–í–ò–õ–¨–ù–´–ú:**

1. **–°—Ç–∞—Ä—ã–π —Ä–∞—Å—á–µ—Ç:** `pnl_percent = (current_price - entry_price) / entry_price * 100`
   - –≠—Ç–æ –ø—Ä–æ—Ü–µ–Ω—Ç –æ—Ç **—Ü–µ–Ω—ã –≤—Ö–æ–¥–∞**, –∞ –Ω–µ –æ—Ç **–º–∞—Ä–∂–∏**!
   - –î–ª—è ETH: Entry=3,885.95, Current=3,897.62 ‚Üí PnL% = 0.30% (–æ—Ç —Ü–µ–Ω—ã)
   - TP = 0.4% ‚Üí 0.30% < 0.4% ‚Üí ‚ùå **–ù–ï –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è!**

2. **–ë–∏—Ä–∂–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:** PnL% –æ—Ç **–º–∞—Ä–∂–∏**
   - –î–ª—è ETH: Margin=120.46, PnL=1.08 ‚Üí PnL% = 0.90% (–æ—Ç –º–∞—Ä–∂–∏)
   - TP = 0.4% ‚Üí 0.90% > 0.4% ‚Üí ‚úÖ **–î–æ–ª–∂–Ω–∞ –∑–∞–∫—Ä—ã—Ç—å—Å—è!**

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

–ò—Å–ø—Ä–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `_check_tp_only` –≤ `position_manager.py`:

1. **–ü–æ–ª—É—á–∞–µ–º margin –∏ unrealizedPnl** –∏–∑ `get_margin_info()` –∏–ª–∏ –∏–∑ –¥–∞–Ω–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–∏
2. **–°—á–∏—Ç–∞–µ–º PnL% –æ—Ç –º–∞—Ä–∂–∏:** `pnl_percent = (unrealized_pnl / margin_used) * 100`
3. **–°—Ä–∞–≤–Ω–∏–≤–∞–µ–º —Å TP:** –ï—Å–ª–∏ `pnl_percent >= tp_percent` ‚Üí –∑–∞–∫—Ä—ã–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é

### Fallback –ª–æ–≥–∏–∫–∞:

–ï—Å–ª–∏ –Ω–µ —É–¥–∞–µ—Ç—Å—è –ø–æ–ª—É—á–∏—Ç—å margin:
- –ü—ã—Ç–∞–µ–º—Å—è —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å –∏–∑ —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏ –∏ `ctVal`
- –ï—Å–ª–∏ –∏ —ç—Ç–æ –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞—Ä—ã–π –º–µ—Ç–æ–¥ (–ø—Ä–æ—Ü–µ–Ω—Ç –æ—Ç —Ü–µ–Ω—ã) —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ–º

## üìä –ü—Ä–∏–º–µ—Ä

**ETH –ø–æ–∑–∏—Ü–∏—è:**
- Entry: 3,885.95
- Current: 3,897.62
- Margin: 120.46 USDT
- Size: 0.14 ETH (14 –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ √ó 0.01 ctVal)
- Leverage: 3x

**–°—Ç–∞—Ä—ã–π —Ä–∞—Å—á–µ—Ç (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π):**
- PnL% = (3897.62 - 3885.95) / 3885.95 √ó 100 = **0.30%**
- 0.30% < 0.4% (TP) ‚Üí ‚ùå –ù–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è

**–ù–æ–≤—ã–π —Ä–∞—Å—á–µ—Ç (–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π):**
- UnrealizedPnl = 0.14 √ó (3897.62 - 3885.95) = **1.63 USDT**
- PnL% = (1.63 / 120.46) √ó 100 = **1.35%**
- 1.35% > 0.4% (TP) ‚Üí ‚úÖ **–ó–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è!**

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

–¢–µ–ø–µ—Ä—å TP –±—É–¥–µ—Ç —Å—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –∫–æ–≥–¥–∞ PnL% –æ—Ç –º–∞—Ä–∂–∏ –¥–æ—Å—Ç–∏–≥–∞–µ—Ç —Ü–µ–ª–µ–≤–æ–≥–æ –ø—Ä–æ—Ü–µ–Ω—Ç–∞, —á—Ç–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç–æ–º—É, —á—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –±–∏—Ä–∂–∞.


