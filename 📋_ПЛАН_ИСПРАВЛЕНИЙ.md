# üìã –ü–õ–ê–ù –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô –ö–†–ò–¢–ò–ß–ï–°–ö–ò–• –ü–†–û–ë–õ–ï–ú

## üîç –ê–ù–ê–õ–ò–ó ADX –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–ô

### –¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è:
- **–ù–∞–π–¥–µ–Ω–æ 31 –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ ADX** –≤ –ª–æ–≥–∞—Ö
- –í—Å–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è: **LONG ‚Üí SHORT** (—Ç—Ä–µ–Ω–¥ –Ω–∏—Å—Ö–æ–¥—è—â–∏–π)
- –í—Å–µ ETH –ø–æ–∑–∏—Ü–∏–∏ –∑–∞–∫—Ä—ã—Ç—ã –∫–∞–∫ **SHORT** –∏ —É–±—ã—Ç–æ—á–Ω—ã–µ
- **–ü—Ä–æ–±–ª–µ–º–∞:** –°–∏–≥–Ω–∞–ª—ã –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –∫–∞–∫ LONG, –Ω–æ ADX –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç –Ω–∞ SHORT –ø—Ä–æ—Ç–∏–≤ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Å–∏–≥–Ω–∞–ª–∞

### –í—ã–≤–æ–¥:
**ADX –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–æ–∂–µ—Ç –≤—Ä–µ–¥–∏—Ç—å**, –µ—Å–ª–∏:
1. –ò—Å—Ö–æ–¥–Ω—ã–π —Å–∏–≥–Ω–∞–ª –±—ã–ª –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º, –Ω–æ ADX –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç –µ–≥–æ –ø—Ä–æ—Ç–∏–≤ —Ç—Ä–µ–Ω–¥–∞
2. –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã –∏–º–µ—é—Ç –Ω–∏–∑–∫—É—é —Å–∏–ª—É (strength –Ω–µ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è)
3. –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ —Å–∏–≥–Ω–∞–ª–∞

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:
**–í–ï–†–ù–£–¢–¨ –ë–õ–û–ö–ò–†–û–í–ö–£** –≤–º–µ—Å—Ç–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è, –Ω–æ —Å –æ–ø—Ü–∏–µ–π –≤ –∫–æ–Ω—Ñ–∏–≥–µ.

---

## üî• –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### 1. –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø entry_time

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `entry_time` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤ —Ä–∞–∑–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö –∏ —Å–ª–æ–≤–∞—Ä—è—Ö
- `position_manager.active_positions` - –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–ª–æ–≤–∞—Ä—å –æ—Ç `orchestrator.active_positions`
- –ü—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –ø–æ–∑–∏—Ü–∏–∏ `entry_time` –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è ‚Üí `duration_sec = 0`

**–†–µ—à–µ–Ω–∏–µ:**
1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ `entry_time` –∏–∑ `orchestrator.active_positions`
2. –ü—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –ø–æ–∑–∏—Ü–∏–∏ –≤ `position_manager` - –ø–æ–ª—É—á–∞—Ç—å `entry_time` –∏–∑ `orchestrator.active_positions`
3. –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `TrailingStopLoss.entry_timestamp`

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `src/strategies/scalping/futures/position_manager.py` (—Å—Ç—Ä–æ–∫–∞ 2298-2315)
- `src/strategies/scalping/futures/coordinators/trailing_sl_coordinator.py` (—Å—Ç—Ä–æ–∫–∞ 428-450)

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
```python
# –í position_manager.py:_close_position_by_reason()
# –ë–´–õ–û:
entry_time = None
if symbol in self.active_positions:
    stored_position = self.active_positions[symbol]
    entry_time = stored_position.get("entry_time")

# –î–û–õ–ñ–ù–û –ë–´–¢–¨:
entry_time = None

# 1. –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –∏–∑ orchestrator.active_positions (–≥–ª–∞–≤–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫)
if hasattr(self, "orchestrator") and self.orchestrator:
    if symbol in self.orchestrator.active_positions:
        stored_position = self.orchestrator.active_positions[symbol]
        if isinstance(stored_position, dict):
            entry_time = stored_position.get("entry_time")
            if isinstance(entry_time, str):
                try:
                    entry_time = datetime.fromisoformat(entry_time.replace("Z", "+00:00"))
                except:
                    entry_time = None

# 2. –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –∏–∑ TrailingStopLoss (–µ—Å–ª–∏ –µ—Å—Ç—å)
if entry_time is None:
    if hasattr(self, "orchestrator") and self.orchestrator:
        if hasattr(self.orchestrator, "trailing_sl_coordinator"):
            tsl_coord = self.orchestrator.trailing_sl_coordinator
            if symbol in tsl_coord.trailing_sl_by_symbol:
                tsl = tsl_coord.trailing_sl_by_symbol[symbol]
                if hasattr(tsl, "entry_timestamp") and tsl.entry_timestamp > 0:
                    entry_time = datetime.fromtimestamp(tsl.entry_timestamp)

# 3. Fallback: —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ)
if entry_time is None:
    logger.warning(f"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ entry_time –¥–ª—è {symbol}, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è")
    entry_time = datetime.now()
```

---

### 2. –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: ADX –§–ò–õ–¨–¢–† - –í–ï–†–ù–£–¢–¨ –ë–õ–û–ö–ò–†–û–í–ö–£

**–ü—Ä–æ–±–ª–µ–º–∞:**
- ADX –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–∞ (LONG ‚Üí SHORT)
- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã –º–æ–≥—É—Ç –±—ã—Ç—å —É–±—ã—Ç–æ—á–Ω—ã–º–∏
- –í—Å–µ 31 –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –±—ã–ª–∏ LONG ‚Üí SHORT, –∏ –≤—Å–µ –ø–æ–∑–∏—Ü–∏–∏ —É–±—ã—Ç–æ—á–Ω—ã–µ

**–†–µ—à–µ–Ω–∏–µ:**
- **–ü—Ä–æ—Å—Ç–æ –≤–µ—Ä–Ω—É—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫—É** –≤–º–µ—Å—Ç–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–±–µ–∑ –æ–ø—Ü–∏–∏ –≤ –∫–æ–Ω—Ñ–∏–≥–µ)
- –ï—Å–ª–∏ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è - –¥–æ–±–∞–≤–∏–º –æ–ø—Ü–∏—é `switch_direction` –ø–æ–∑–∂–µ
- –£–ª—É—á—à–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `src/strategies/scalping/futures/signals/filter_manager.py` (—Å—Ç—Ä–æ–∫–∞ 291-318)
- `src/strategies/scalping/futures/signal_generator.py` (—Å—Ç—Ä–æ–∫–∞ 3287-3328, 3879-3919)

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
```python
# –í filter_manager.py:_apply_adx_filter()
# –ë–´–õ–û:
if not adx_result.allowed:
    # –£–º–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
    is_bullish = (adx_result.plus_di > adx_result.minus_di + self.adx_filter.config.di_difference)
    is_bearish = (adx_result.minus_di > adx_result.plus_di + self.adx_filter.config.di_difference)
    if signal_side_str == "sell" and is_bullish:
        signal["side"] = "buy"
        signal["side_switched_by_adx"] = True
    elif signal_side_str == "buy" and is_bearish:
        signal["side"] = "sell"
        signal["side_switched_by_adx"] = True
    else:
        return None

# –î–û–õ–ñ–ù–û –ë–´–¢–¨:
if not adx_result.allowed:
    # ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –ë–ª–æ–∫–∏—Ä—É–µ–º —Å–∏–≥–Ω–∞–ª –ø—Ä–æ—Ç–∏–≤ —Ç—Ä–µ–Ω–¥–∞ (–Ω–µ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ)
    logger.debug(
        f"üö´ ADX –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª {signal_side_str.upper()} —Å–∏–≥–Ω–∞–ª –¥–ª—è {symbol}: "
        f"—Å–∏–≥–Ω–∞–ª –ø—Ä–æ—Ç–∏–≤ —Ç—Ä–µ–Ω–¥–∞ ({adx_result.reason}, ADX={adx_result.adx_value:.1f}, "
        f"+DI={adx_result.plus_di:.1f}, -DI={adx_result.minus_di:.1f})"
    )
    return None  # –ë–ª–æ–∫–∏—Ä—É–µ–º —Å–∏–≥–Ω–∞–ª
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:**
- –û–ø—Ü–∏—è `switch_direction` –≤ –∫–æ–Ω—Ñ–∏–≥–µ –ù–ï –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è (–ø–æ–∫–∞ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è)
- –ï—Å–ª–∏ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è - –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–∑–∂–µ —á–µ—Ä–µ–∑ `filters_profile.get("adx", {}).get("switch_direction", False)`

---

### 3. –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ü–†–û–í–ï–†–ö–ê CRITICAL_LOSS_CUT_2X –° MIN_HOLDING

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `critical_loss_cut_2x` —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ù–ï–ú–ï–î–õ–ï–ù–ù–û (–¥–∞–∂–µ –ø—Ä–∏ 0 —Å–µ–∫—É–Ω–¥–∞—Ö)
- `min_holding_minutes` –Ω–µ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —É–±—ã—Ç–∫–æ–≤
- –ü–æ–∑–∏—Ü–∏–∏ –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –æ—Ç–∫—Ä—ã—Ç–∏—è

**–†–µ—à–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–∏—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é –∑–∞–¥–µ—Ä–∂–∫—É –¥–∞–∂–µ –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —É–±—ã—Ç–∫–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 5-10 —Å–µ–∫—É–Ω–¥)
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å, —á—Ç–æ —É–±—ã—Ç–æ–∫ —Ä–µ–∞–ª—å–Ω—ã–π (–Ω–µ –∏–∑-–∑–∞ –∫–æ–º–∏—Å—Å–∏–∏)

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `src/strategies/scalping/futures/indicators/trailing_stop_loss.py` (—Å—Ç—Ä–æ–∫–∞ 473-501)

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
```python
# –í trailing_stop_loss.py:should_close_position()
# –ë–´–õ–û:
if self.loss_cut_percent is not None:
    critical_loss_cut_from_price = (self.loss_cut_percent * 2.0) / self.leverage
    if profit_pct <= -critical_loss_cut_from_price:
        return (True, "critical_loss_cut_2x")  # –ù–ï–ú–ï–î–õ–ï–ù–ù–û!

# –î–û–õ–ñ–ù–û –ë–´–¢–¨:
if self.loss_cut_percent is not None:
    loss_cut_from_price = self.loss_cut_percent / self.leverage
    critical_loss_cut_from_price = loss_cut_from_price * 2.0
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —É–±—ã—Ç–æ–∫
    if profit_pct <= -critical_loss_cut_from_price:
        # ‚úÖ –ó–ê–©–ò–¢–ê: –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–∞–∂–µ –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —É–±—ã—Ç–∫–æ–≤ (5 —Å–µ–∫—É–Ω–¥)
        min_critical_hold_seconds = self.min_critical_hold_seconds or 5.0
        seconds_in_position = minutes_in_position * 60.0
        
        if seconds_in_position < min_critical_hold_seconds:
            logger.debug(
                f"‚è±Ô∏è –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π loss_cut –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω (min_hold –∑–∞—â–∏—Ç–∞): "
                f"–ø—Ä–∏–±—ã–ª—å {profit_pct:.2%} –æ—Ç —Ü–µ–Ω—ã <= -{critical_loss_cut_from_price:.2%}, "
                f"–Ω–æ –ø–æ–∑–∏—Ü–∏—è –¥–µ—Ä–∂–∏—Ç—Å—è {seconds_in_position:.1f} —Å–µ–∫ < {min_critical_hold_seconds:.1f} —Å–µ–∫, "
                f"–Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º (entry_time={entry_iso}, branch=min_critical_hold_block)"
            )
            return False, None  # –ù–ï –∑–∞–∫—Ä—ã–≤–∞–µ–º - –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞
        
        # ‚úÖ –ó–ê–©–ò–¢–ê: –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —É–±—ã—Ç–æ–∫ –Ω–µ –∏–∑-–∑–∞ –∫–æ–º–∏—Å—Å–∏–∏
        # –ï—Å–ª–∏ profit_pct –æ—á–µ–Ω—å –±–ª–∏–∑–æ–∫ –∫ -critical_loss_cut_from_price (–≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –∫–æ–º–∏—Å—Å–∏–∏),
        # –≤–æ–∑–º–æ–∂–Ω–æ —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ –∫–æ–º–∏—Å—Å–∏—è, –∞ –Ω–µ —Ä–µ–∞–ª—å–Ω—ã–π —É–±—ã—Ç–æ–∫
        commission_threshold = self.trading_fee_rate * 1.5  # 1.5x –∫–æ–º–∏—Å—Å–∏—è –∫–∞–∫ –±—É—Ñ–µ—Ä
        if abs(profit_pct + critical_loss_cut_from_price) < commission_threshold:
            logger.debug(
                f"‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π loss_cut –º–æ–∂–µ—Ç –±—ã—Ç—å –∏–∑-–∑–∞ –∫–æ–º–∏—Å—Å–∏–∏: "
                f"profit_pct={profit_pct:.4f}, critical={critical_loss_cut_from_price:.4f}, "
                f"—Ä–∞–∑–Ω–∏—Ü–∞={abs(profit_pct + critical_loss_cut_from_price):.4f} < {commission_threshold:.4f}"
            )
            # –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º, –Ω–æ –ª–æ–≥–∏—Ä—É–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
        
        return (True, "critical_loss_cut_2x")
```

---

### 4. –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –†–ê–°–ß–ï–¢ PROFIT_PCT –° –£–ß–ï–¢–û–ú –°–ü–†–ï–î–ê –ü–†–ò –û–¢–ö–†–´–¢–ò–ò

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ø–æ–∑–∏—Ü–∏–∏ —Ü–µ–Ω–∞ –º–æ–∂–µ—Ç —Å–¥–≤–∏–Ω—É—Ç—å—Å—è –Ω–∞ 0.05-0.1%
- –° –∫–æ–º–∏—Å—Å–∏–µ–π 0.1% —ç—Ç–æ —É–∂–µ —É–±—ã—Ç–æ–∫
- `profit_pct` —Å—Ä–∞–∑—É –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π

**–†–µ—à–µ–Ω–∏–µ:**
- –£—á–∏—Ç—ã–≤–∞—Ç—å —Å–ø—Ä–µ–¥ –∏ –ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏–µ –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ `profit_pct`
- –ù–µ —É—á–∏—Ç—ã–≤–∞—Ç—å –∫–æ–º–∏—Å—Å–∏—é –≤ –ø–µ—Ä–≤—ã–µ 5-10 —Å–µ–∫—É–Ω–¥ –ø–æ—Å–ª–µ –æ—Ç–∫—Ä—ã—Ç–∏—è

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `src/strategies/scalping/futures/indicators/trailing_stop_loss.py` (—Å—Ç—Ä–æ–∫–∞ 374-399)

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
```python
# –í trailing_stop_loss.py:get_profit_pct()
# –ë–´–õ–û:
def get_profit_pct(self, current_price: float, include_fees: bool = True) -> float:
    if self.side == "short":
        gross_profit_pct = (self.entry_price - current_price) / self.entry_price
    if include_fees:
        net_profit_pct = gross_profit_pct - self.trading_fee_rate
    return net_profit_pct

# –î–û–õ–ñ–ù–û –ë–´–¢–¨:
def get_profit_pct(self, current_price: float, include_fees: bool = True) -> float:
    if self.entry_price == 0:
        return 0.0
    
    # –ë–∞–∑–æ–≤–∞—è –ø—Ä–∏–±—ã–ª—å –±–µ–∑ –∫–æ–º–∏—Å—Å–∏–∏
    if self.side == "long":
        gross_profit_pct = (current_price - self.entry_price) / self.entry_price
    else:
        gross_profit_pct = (self.entry_price - current_price) / self.entry_price
    
    # ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ù–µ —É—á–∏—Ç—ã–≤–∞–µ–º –∫–æ–º–∏—Å—Å–∏—é –≤ –ø–µ—Ä–≤—ã–µ 10 —Å–µ–∫—É–Ω–¥ –ø–æ—Å–ª–µ –æ—Ç–∫—Ä—ã—Ç–∏—è
    # (—ç—Ç–æ –≤—Ä–µ–º—è –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Ä–µ–∞–ª—å–Ω–æ–π —Ü–µ–Ω—ã, —É—á–∏—Ç—ã–≤–∞—è —Å–ø—Ä–µ–¥ –∏ –ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏–µ)
    if include_fees:
        seconds_since_open = (time.time() - self.entry_timestamp) if self.entry_timestamp > 0 else 0
        if seconds_since_open < 10.0:
            # –í –ø–µ—Ä–≤—ã–µ 10 —Å–µ–∫—É–Ω–¥ –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ–º –∫–æ–º–∏—Å—Å–∏—é (—É—á–∏—Ç—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Ü–µ–Ω—ã)
            logger.debug(
                f"‚è±Ô∏è –ü–æ–∑–∏—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç–∞ {seconds_since_open:.1f} —Å–µ–∫ –Ω–∞–∑–∞–¥, "
                f"–∫–æ–º–∏—Å—Å–∏—è –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –≤ profit_pct (—É—á–∏—Ç—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ —Å–ø—Ä–µ–¥)"
            )
            return gross_profit_pct
        else:
            # –ü–æ—Å–ª–µ 10 —Å–µ–∫—É–Ω–¥ —É—á–∏—Ç—ã–≤–∞–µ–º –∫–æ–º–∏—Å—Å–∏—é
            net_profit_pct = gross_profit_pct - self.trading_fee_rate
            return net_profit_pct
    else:
        return gross_profit_pct
```

---

### 5. –£–õ–£–ß–®–ï–ù–ò–ï: –õ–û–ì–ò–†–û–í–ê–ù–ò–ï –î–õ–Ø –û–¢–õ–ê–î–ö–ò

**–î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –í—Å–µ —Ä–∞—Å—á–µ—Ç—ã: `profit_pct`, `critical_loss_cut_from_price`, `duration_sec`
- –ò—Å—Ç–æ—á–Ω–∏–∫ `entry_time` –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- ADX –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è/–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Å –¥–µ—Ç–∞–ª—è–º–∏

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- –í—Å–µ —Ñ–∞–π–ª—ã —Å —Ä–∞—Å—á–µ—Ç–∞–º–∏ –∏ –∑–∞–∫—Ä—ã—Ç–∏–µ–º –ø–æ–∑–∏—Ü–∏–π

---

## üìã –ü–û–†–Ø–î–û–ö –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1 (–ö–†–ò–¢–ò–ß–ù–û):
1. ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è `entry_time` (–ø—Ä–æ–±–ª–µ–º–∞ —Å `duration_sec = 0`)
2. ‚úÖ ADX —Ñ–∏–ª—å—Ç—Ä - –≤–µ—Ä–Ω—É—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫—É (–ø—Ä–æ–±–ª–µ–º–∞ —Å –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ–º)

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2 (–í–ê–ñ–ù–û):
3. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ `critical_loss_cut_2x` —Å `min_holding`
4. ‚úÖ –†–∞—Å—á–µ—Ç `profit_pct` —Å —É—á–µ—Ç–æ–º —Å–ø—Ä–µ–¥–∞

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3 (–£–õ–£–ß–®–ï–ù–ò–ï):
5. ‚úÖ –£–ª—É—á—à–µ–Ω–∏–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

---

## üéØ –û–ñ–ò–î–ê–ï–ú–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
- ‚úÖ –ü–æ–∑–∏—Ü–∏–∏ –Ω–µ –±—É–¥—É—Ç –∑–∞–∫—Ä—ã–≤–∞—Ç—å—Å—è —Å `duration_sec = 0`
- ‚úÖ ADX –±—É–¥–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Å–∏–≥–Ω–∞–ª—ã –ø—Ä–æ—Ç–∏–≤ —Ç—Ä–µ–Ω–¥–∞ (–Ω–µ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å)
- ‚úÖ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É–±—ã—Ç–∫–∏ –Ω–µ –±—É–¥—É—Ç —Å—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –≤ –ø–µ—Ä–≤—ã–µ —Å–µ–∫—É–Ω–¥—ã
- ‚úÖ `profit_pct` –±—É–¥–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—Ç—å—Å—è —Å —É—á–µ—Ç–æ–º —Å–ø—Ä–µ–¥–∞

---

## üìù –ü–†–ò–ú–ï–ß–ê–ù–ò–Ø

- –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã
- ADX —Ñ–∏–ª—å—Ç—Ä: –ø—Ä–æ—Å—Ç–æ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ (–±–µ–∑ –æ–ø—Ü–∏–∏ –≤ –∫–æ–Ω—Ñ–∏–≥–µ, –µ—Å–ª–∏ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è - –¥–æ–±–∞–≤–∏–º –ø–æ–∑–∂–µ)
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ–¥—Ä–æ–±–Ω—ã–º –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

