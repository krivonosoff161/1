# üîç –ü–û–õ–ù–´–ô –ê–£–î–ò–¢ –ó–ê–•–ê–†–î–ö–û–ñ–ï–ù–ù–´–• –ü–ê–†–ê–ú–ï–¢–†–û–í

## üìã –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´

### 1. **MarginCalculator** (`src/strategies/modules/margin_calculator.py`)

#### ‚ùå –ó–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
- `default_leverage: int = 3` - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
- `maintenance_margin_ratio: float = 0.01` - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
- `initial_margin_ratio: float = 0.1` - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
- `safety_threshold: float = 1.5` - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∞–¥–∞–ø—Ç–∏–≤–Ω–æ –ø–æ —Ä–µ–∂–∏–º–∞–º
- `risk_percentage: float = 0.02` (2%) - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∞–¥–∞–ø—Ç–∏–≤–Ω–æ –ø–æ —Ä–µ–∂–∏–º–∞–º
- –ü–æ—Ä–æ–≥–∏ –≤ `get_margin_health_status`: `3.0`, `2.0`, `1.5`, `1.2` - –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
- –ü–æ—Ä–æ–≥–∏ –≤ `is_position_safe`: `0.3`, `0.1`, `0.15`, `2.0` - –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞

#### ‚úÖ –†–µ—à–µ–Ω–∏–µ:
- –í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–æ–ª–∂–Ω—ã —á–∏—Ç–∞—Ç—å—Å—è –∏–∑ `config_futures.yaml` ‚Üí `margin` —Å–µ–∫—Ü–∏—è
- `safety_threshold` –∏ `risk_percentage` –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–º–∏ –ø–æ —Ä–µ–∂–∏–º–∞–º
- –ü–æ—Ä–æ–≥–∏ –∑–¥–æ—Ä–æ–≤—å—è –º–∞—Ä–∂–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ –∫–æ–Ω—Ñ–∏–≥–µ

---

### 2. **Orchestrator** (`src/strategies/scalping/futures/orchestrator.py`)

#### ‚ùå –ó–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–Ω—ã–µ fallback –∑–Ω–∞—á–µ–Ω–∏—è:
- `max_loss_per_trade = 0.02` (2%) - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏–∑ `risk.by_regime`
- `max_margin_percent = 0.80` (80%) - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏–∑ `risk.by_regime`
- `max_drawdown_percent = 0.05` (5%) - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏–∑ `risk.by_regime`
- `maintenance_margin_ratio = 0.01` - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏–∑ `margin.maintenance_margin_ratio`
- `initial_margin_ratio = 0.1` - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏–∑ `margin.initial_margin_ratio`
- `max_slippage_percent = 0.1` (0.1%) - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏–∑ `futures_modules.slippage_guard`
- `max_spread_percent = 0.05` (0.05%) - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏–∑ `futures_modules.slippage_guard`
- `order_timeout = 30.0` - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏–∑ `futures_modules.slippage_guard`
- `max_funding_rate = 0.05` (0.05%) - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
- `FastADX threshold = 20.0` - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∞–¥–∞–ø—Ç–∏–≤–Ω–æ –ø–æ —Ä–µ–∂–∏–º–∞–º
- `OrderFlowIndicator long_threshold = 0.1` - fallback, –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
- `OrderFlowIndicator short_threshold = -0.1` - fallback, –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
- `MaxSizeLimiter max_single_size_usd = 150.0` - fallback, –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
- `MaxSizeLimiter max_total_size_usd = 600.0` - fallback, –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
- `_tsl_check_interval = 1.5` - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏–∑ `trailing_sl.check_interval_seconds`
- `signal_cooldown_seconds = 0.0` - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞

#### ‚ùå –ó–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–Ω—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏:
- `await asyncio.sleep(0.3)` (300ms) - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
- `await asyncio.sleep(0.2)` (200ms) - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞

#### ‚ùå –ó–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–Ω—ã–µ –ø–æ—Ä–æ–≥–∏ –≤ `LiquidationGuard`:
- `warning_threshold=1.8` - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
- `danger_threshold=1.3` - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
- `critical_threshold=1.1` - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
- `auto_close_threshold=1.05` - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞

#### ‚úÖ –†–µ—à–µ–Ω–∏–µ:
- –í—Å–µ fallback –∑–Ω–∞—á–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —É–¥–∞–ª–µ–Ω—ã –∏–ª–∏ –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ —á—Ç–µ–Ω–∏–µ –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
- –ó–∞–¥–µ—Ä–∂–∫–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ `config_futures.yaml` ‚Üí `delays` —Å–µ–∫—Ü–∏—è
- –ü–æ—Ä–æ–≥–∏ LiquidationGuard –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ `config_futures.yaml` ‚Üí `liquidation_guard` —Å–µ–∫—Ü–∏—è

---

### 3. **SignalGenerator** (`src/strategies/scalping/futures/signal_generator.py`)

#### ‚ùå –ó–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:
- `min_ma_difference_pct = 0.1` - ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û (—Ç–µ–ø–µ—Ä—å –∞–¥–∞–ø—Ç–∏–≤–Ω–æ)
- `price_change > 0.0005` (0.05%) - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∞–¥–∞–ø—Ç–∏–≤–Ω–æ –ø–æ —Ä–µ–∂–∏–º–∞–º
- `strength *= 0.9` - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
- `strength = min(abs(histogram) / 200.0, 1.0)` - `200.0` –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
- `confidence = 0.4`, `0.7`, `0.8`, `0.9`, `0.75` - –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∞–¥–∞–ø—Ç–∏–≤–Ω—ã –ø–æ —Ä–µ–∂–∏–º–∞–º
- `corr_threshold = 0.7` - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
- `pivot_tolerance = 0.003` (0.3%) - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
- `vp_va_percent = 70.0` - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
- `vp_poc_tolerance = 0.005` (0.5%) - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
- `min_signal_strength=0.3` - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∞–¥–∞–ø—Ç–∏–≤–Ω–æ –ø–æ —Ä–µ–∂–∏–º–∞–º
- `base_size = 0.001` - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞

#### ‚úÖ –†–µ—à–µ–Ω–∏–µ:
- –í—Å–µ –ø–æ—Ä–æ–≥–∏ –¥–æ–ª–∂–Ω—ã —á–∏—Ç–∞—Ç—å—Å—è –∏–∑ `config_futures.yaml` ‚Üí `adaptive_regime.{regime}.indicators`
- Confidence –∑–Ω–∞—á–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–º–∏ –ø–æ —Ä–µ–∂–∏–º–∞–º
- Strength multipliers –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ –∫–æ–Ω—Ñ–∏–≥–µ

---

### 4. **–§–∏–ª—å—Ç—Ä—ã** (`src/strategies/scalping/futures/filters/`)

#### ‚ùå MomentumFilter:
- `max_spike_percent = 1.0` - fallback, –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
- `max_price_velocity_percent = 0.5` - fallback, –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
- `max_cv = 0.5` - fallback, –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏–∑ `thresholds.{regime}.max_cv`
- `min_increasing_ratio = 0.6` - fallback, –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏–∑ `thresholds.{regime}.min_increasing_ratio`
- `min_ratio = 0.6` - fallback, –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏–∑ `thresholds.{regime}.min_ratio`

#### ‚ùå OrderFlowFilter:
- `relax_multiplier = 0.5` - fallback, –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
- `min_total_depth = 0.0` - fallback, –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞

#### ‚úÖ –†–µ—à–µ–Ω–∏–µ:
- –í—Å–µ fallback –∑–Ω–∞—á–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —É–¥–∞–ª–µ–Ω—ã
- –ü–æ—Ä–æ–≥–∏ –¥–æ–ª–∂–Ω—ã —á–∏—Ç–∞—Ç—å—Å—è –∏–∑ `config_futures.yaml` ‚Üí `futures_modules.{filter_name}`

---

### 5. **TrailingStopLoss** (`src/strategies/scalping/futures/indicators/trailing_stop_loss.py`)

#### ‚ùå –ó–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–Ω—ã–µ fallback –∑–Ω–∞—á–µ–Ω–∏—è –≤ `_get_trailing_sl_params`:
- `trading_fee_rate = 0.0010` - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ (‚úÖ —É–∂–µ –µ—Å—Ç—å)
- `initial_trail = 0.005` - fallback, –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
- `max_trail = 0.01` - fallback, –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
- `min_trail = 0.003` - fallback, –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
- `high_profit_threshold = 0.01` - fallback, –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
- `high_profit_max_factor = 2.0` - fallback, –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
- `high_profit_reduction_percent = 30` - fallback, –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
- `high_profit_min_reduction = 0.5` - fallback, –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞

#### ‚úÖ –†–µ—à–µ–Ω–∏–µ:
- –í—Å–µ fallback –∑–Ω–∞—á–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —É–¥–∞–ª–µ–Ω—ã –∏–ª–∏ –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ —á—Ç–µ–Ω–∏–µ –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞

---

## üìä –ü–õ–ê–ù –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô

### –≠—Ç–∞–ø 1: MarginCalculator
1. –î–æ–±–∞–≤–∏—Ç—å –≤ `config_futures.yaml` —Å–µ–∫—Ü–∏—é `margin` —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
2. –°–¥–µ–ª–∞—Ç—å `safety_threshold` –∏ `risk_percentage` –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–º–∏ –ø–æ —Ä–µ–∂–∏–º–∞–º
3. –î–æ–±–∞–≤–∏—Ç—å –ø–æ—Ä–æ–≥–∏ –∑–¥–æ—Ä–æ–≤—å—è –º–∞—Ä–∂–∏ –≤ –∫–æ–Ω—Ñ–∏–≥
4. –û–±–Ω–æ–≤–∏—Ç—å `MarginCalculator` –¥–ª—è —á—Ç–µ–Ω–∏—è –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞

### –≠—Ç–∞–ø 2: Orchestrator
1. –£–¥–∞–ª–∏—Ç—å –≤—Å–µ fallback –∑–Ω–∞—á–µ–Ω–∏—è
2. –î–æ–±–∞–≤–∏—Ç—å —Å–µ–∫—Ü–∏—é `delays` –≤ –∫–æ–Ω—Ñ–∏–≥
3. –î–æ–±–∞–≤–∏—Ç—å —Å–µ–∫—Ü–∏—é `liquidation_guard` –≤ –∫–æ–Ω—Ñ–∏–≥
4. –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–ª—è —á—Ç–µ–Ω–∏—è –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞

### –≠—Ç–∞–ø 3: SignalGenerator
1. –°–¥–µ–ª–∞—Ç—å –≤—Å–µ –ø–æ—Ä–æ–≥–∏ –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–º–∏ –ø–æ —Ä–µ–∂–∏–º–∞–º
2. –î–æ–±–∞–≤–∏—Ç—å confidence –∑–Ω–∞—á–µ–Ω–∏—è –≤ –∫–æ–Ω—Ñ–∏–≥ –ø–æ —Ä–µ–∂–∏–º–∞–º
3. –î–æ–±–∞–≤–∏—Ç—å strength multipliers –≤ –∫–æ–Ω—Ñ–∏–≥

### –≠—Ç–∞–ø 4: –§–∏–ª—å—Ç—Ä—ã
1. –£–¥–∞–ª–∏—Ç—å –≤—Å–µ fallback –∑–Ω–∞—á–µ–Ω–∏—è
2. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –≤—Å–µ —Ñ–∏–ª—å—Ç—Ä—ã —á–∏—Ç–∞—é—Ç –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞

### –≠—Ç–∞–ø 5: TrailingStopLoss
1. –£–¥–∞–ª–∏—Ç—å –≤—Å–µ fallback –∑–Ω–∞—á–µ–Ω–∏—è
2. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —á–∏—Ç–∞—é—Ç—Å—è –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞

---

## üéØ –ü–†–ò–û–†–ò–¢–ï–¢–´

1. **–ö–†–ò–¢–ò–ß–ù–û**: MarginCalculator - –≤–ª–∏—è–µ—Ç –Ω–∞ —Ä–∞—Å—á–µ—Ç –ø–æ–∑–∏—Ü–∏–π
2. **–ö–†–ò–¢–ò–ß–ù–û**: Orchestrator fallback –∑–Ω–∞—á–µ–Ω–∏—è - –≤–ª–∏—è—é—Ç –Ω–∞ —Ä–∏—Å–∫-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç
3. **–í–´–°–û–ö–ò–ô**: SignalGenerator –ø–æ—Ä–æ–≥–∏ - –≤–ª–∏—è—é—Ç –Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —Å–∏–≥–Ω–∞–ª–æ–≤
4. **–°–†–ï–î–ù–ò–ô**: –§–∏–ª—å—Ç—Ä—ã fallback - –≤–ª–∏—è—é—Ç –Ω–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é —Å–∏–≥–Ω–∞–ª–æ–≤
5. **–ù–ò–ó–ö–ò–ô**: TrailingStopLoss fallback - —É–∂–µ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –∞–¥–∞–ø—Ç–∏–≤–µ–Ω

---

## ‚úÖ –ß–¢–û –£–ñ–ï –ê–î–ê–ü–¢–ò–í–ù–û

- `min_ma_difference_pct` - ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û (–∞–¥–∞–ø—Ç–∏–≤–Ω–æ –ø–æ —Ä–µ–∂–∏–º–∞–º)
- `trailing_sl` –ø–∞—Ä–∞–º–µ—Ç—Ä—ã - ‚úÖ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –∞–¥–∞–ø—Ç–∏–≤–Ω—ã
- `risk` –ø–∞—Ä–∞–º–µ—Ç—Ä—ã - ‚úÖ –∞–¥–∞–ø—Ç–∏–≤–Ω—ã –ø–æ —Ä–µ–∂–∏–º–∞–º
- `position_size_multiplier` - ‚úÖ –∞–¥–∞–ø—Ç–∏–≤–µ–Ω –ø–æ —Ä–µ–∂–∏–º–∞–º
- `min_score_threshold` - ‚úÖ –∞–¥–∞–ø—Ç–∏–≤–µ–Ω –ø–æ —Ä–µ–∂–∏–º–∞–º







