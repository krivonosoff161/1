# ‚úÖ –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø DEBUG LOGGER –ó–ê–í–ï–†–®–ï–ù–ê - –ì–û–¢–û–í–û –ö –ó–ê–ü–£–°–ö–£!

**–î–∞—Ç–∞:** 22.11.2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û - –ì–û–¢–û–í–û –ö –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Æ  
**–ü—Ä–æ–≤–µ—Ä–∫–∞:** ‚úÖ –í–°–ï –ü–†–û–í–ï–†–ï–ù–û - –†–ê–ë–û–¢–ê–ï–¢!

---

## ‚úÖ –ß–¢–û –ë–´–õ–û –°–î–ï–õ–ê–ù–û

### ‚úÖ –í–´–ü–û–õ–ù–ï–ù–ù–´–ï –®–ê–ì–ò:

1. **‚úÖ –®–ê–ì 1: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è DebugLogger –≤ orchestrator**
   - ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç `from src.strategies.modules.debug_logger import DebugLogger`
   - ‚úÖ –°–æ–∑–¥–∞–Ω `self.debug_logger` –≤ `orchestrator.__init__()`
   - ‚úÖ –ü—É—Ç—å: `logs/futures/debug/` (–≤–Ω—É—Ç—Ä–∏ futures)
   - ‚úÖ CSV —ç–∫—Å–ø–æ—Ä—Ç –≤–∫–ª—é—á–µ–Ω

2. **‚úÖ –®–ê–ì 2: –ü–µ—Ä–µ–¥–∞—á–∞ debug_logger –≤ TrailingStopLoss**
   - ‚úÖ –ü–µ—Ä–µ–¥–∞–Ω `debug_logger=self.debug_logger` –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ TSL
   - ‚úÖ –í –º–µ—Ç–æ–¥–µ `_initialize_trailing_stop()`

3. **‚úÖ –®–ê–ì 3: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ TrailingStopLoss.__init__()**
   - ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `debug_logger=None`
   - ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω –∫–∞–∫ `self.debug_logger`
   - ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `self._symbol` –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

4. **‚úÖ –®–ê–ì 4: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ symbol –≤ initialize()**
   - ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `initialize()` –¥–ª—è –ø—Ä–∏–µ–º–∞ `symbol`
   - ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `self._symbol`

5. **‚úÖ –®–ê–ì 5: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ should_close_position()**
   - ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ min_holding –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ (–ª–∏–Ω–∏—è ~573)
   - ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ loss_cut –ø—Ä–æ–≤–µ—Ä–∫–∏ (–ª–∏–Ω–∏—è ~600)
   - ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ timeout –ø—Ä–æ–≤–µ—Ä–∫–∏ (–ª–∏–Ω–∏—è ~606)
   - ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ (—Ü–µ–Ω–∞ –Ω–µ –¥–æ—Å—Ç–∏–≥–ª–∞ SL)

6. **‚úÖ –®–ê–ì 6: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ orchestrator**
   - ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–∏—è TSL (–≤ `_initialize_trailing_stop()`)
   - ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∫–æ–Ω—Ñ–∏–≥–∞

7. **‚úÖ –®–ê–ì 7: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞**
   - ‚úÖ `debug_logger.py` - –û–ö
   - ‚úÖ `orchestrator.py` - –û–ö
   - ‚úÖ `trailing_stop_loss.py` - –û–ö
   - ‚úÖ –ò–º–ø–æ—Ä—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç!

---

## üéØ –†–ï–ó–£–õ–¨–¢–ê–¢

### ‚úÖ –í–°–ï –ò–ù–¢–ï–ì–†–ò–†–û–í–ê–ù–û:

```
orchestrator.__init__()
  ‚Üì
self.debug_logger = DebugLogger(...)
  ‚Üì
_initialize_trailing_stop()
  ‚Üì
tsl = TrailingStopLoss(..., debug_logger=self.debug_logger)
  ‚Üì
should_close_position()
  ‚Üì
self.debug_logger.log_tsl_*()  ‚úÖ –õ–û–ì–ò–†–£–ï–¢ –í–°–ï!
```

---

## üìÇ –ì–î–ï –°–û–ó–î–ê–Æ–¢–°–Ø –õ–û–ì–ò

### –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞:

```
logs/futures/
‚îú‚îÄ futures_main_2025-11-22.log    ‚Üê –æ—Å–Ω–æ–≤–Ω—ã–µ –ª–æ–≥–∏ (loguru)
‚îî‚îÄ debug/                          ‚Üê DEBUG –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
   ‚îî‚îÄ debug_20251122_HHMMSS.csv   ‚Üê CSV —Å –ø–æ–ª–Ω–æ–π –∏—Å—Ç–æ—Ä–∏–µ–π
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ CSV:

```csv
timestamp,event_type,symbol,data
09:35:04.102,tick,BTC-USDT,regime=ranging|price=84329.1
09:35:04.103,config,BTC-USDT,min_hold=40.0|timeout=90|loss_cut=1.5
09:35:04.104,tsl_create,BTC-USDT,entry=84329.1|min_hold=40.0|timeout=90
09:36:05.234,tsl_check,BTC-USDT,check=min_holding_BLOCKED|minutes=1.0
09:39:51.789,close,BTC-USDT,reason=loss_cut|time_min=4.78|pnl_pct=-2.06%
```

---

## üöÄ –ö–ê–ö –ó–ê–ü–£–°–¢–ò–¢–¨

### 1Ô∏è‚É£ **–ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ start.bat:**

```bash
start.bat
‚Üí –í—ã–±—Ä–∞—Ç—å "2. Futures Trading"
‚Üí –ë–æ—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
‚Üí DebugLogger –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç!
```

### 2Ô∏è‚É£ **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã:**

```bash
# –ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:
dir logs\futures\debug\*.csv

# –î–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ñ–∞–π–ª:
# debug_YYYYMMDD_HHMMSS.csv
```

### 3Ô∏è‚É£ **–ß—Ç–æ –±—É–¥–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å—Å—è:**

- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ TSL (`tsl_create`)
- ‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–Ω—Ñ–∏–≥–∞ (`config`)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∏ TSL (`tsl_check`)
  - min_holding –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
  - loss_cut –ø—Ä–æ–≤–µ—Ä–∫–∏
  - timeout –ø—Ä–æ–≤–µ—Ä–∫–∏
- ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–æ–∫ (close/–Ω–µ close)

---

## üìä –ß–¢–û –£–í–ò–î–ò–®–¨ –í CSV

### –ü—Ä–∏–º–µ—Ä –ª–æ–≥–æ–≤:

```
09:35:04 ‚öôÔ∏è  CONFIG: BTC-USDT min_hold=40.0 timeout=90 loss_cut=1.5
09:35:04 ‚ú® TSL CREATE: BTC-USDT entry=84329.1 min_hold=40.0 timeout=90
09:36:05 üîç TSL CHECK: BTC-USDT check=min_holding_BLOCKED minutes=1.0
09:36:05 üîç TSL CHECK: BTC-USDT check=loss_cut profit=-0.5% close=False
09:39:51 ‚ùå CLOSE: BTC-USDT reason=loss_cut time_min=4.78 pnl_pct=-2.06%
```

**–ü–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–∫–∞, –∫–∞–∂–¥–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏, –∫–∞–∂–¥–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è!**

---

## ‚úÖ –ü–†–û–í–ï–†–ö–ê

### –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞:

1. **‚úÖ –ü–∞–ø–∫–∞ —Å–æ–∑–¥–∞–ª–∞—Å—å:**
   ```bash
   dir logs\futures\debug
   ```

2. **‚úÖ CSV —Ñ–∞–π–ª —Å–æ–∑–¥–∞–ª—Å—è:**
   ```bash
   dir logs\futures\debug\*.csv
   ```

3. **‚úÖ –õ–æ–≥–∏ –ø–∏—à—É—Ç—Å—è:**
   - –û—Ç–∫—Ä—ã—Ç—å CSV –≤ Excel
   - –î–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å—Ç—Ä–æ–∫–∏: `config`, `tsl_create`, `tsl_check`, etc.

4. **‚úÖ –ü–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏:**
   - –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å—Ç—Ä–æ–∫–∞ —Å `event_type=close`
   - –î–æ–ª–∂–µ–Ω –±—ã—Ç—å `reason` (loss_cut, timeout, tsl, etc.)
   - –î–æ–ª–∂–µ–Ω –±—ã—Ç—å `time_min` (–≤—Ä–µ–º—è –≤ –º–∏–Ω—É—Ç–∞—Ö)

---

## üéØ –ò–¢–û–ì

### ‚úÖ –í–°–Å –ì–û–¢–û–í–û:

- [x] DebugLogger —Å–æ–∑–¥–∞–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ orchestrator
- [x] –ü–µ—Ä–µ–¥–∞–Ω –≤ TrailingStopLoss
- [x] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–æ –≤—Å–µ—Ö –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö
- [x] CSV —ç–∫—Å–ø–æ—Ä—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] –°–∏–Ω—Ç–∞–∫—Å–∏—Å –ø—Ä–æ–≤–µ—Ä–µ–Ω
- [x] –ò–º–ø–æ—Ä—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] –ì–æ—Ç–æ–≤ –∫ –∑–∞–ø—É—Å–∫—É!

---

## üöÄ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

### 1. **–ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞:**
```bash
start.bat
```

### 2. **–î–∞—Ç –±–æ—Ç—É –ø–æ—Ä–∞–±–æ—Ç–∞—Ç—å 20-30 –º–∏–Ω—É—Ç**

### 3. **–û—Ç–∫—Ä—ã—Ç—å CSV:**
```
logs/futures/debug/debug_YYYYMMDD_HHMMSS.csv
```

### 4. **–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å:**
- –§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ø–æ `event_type = close`
- –°–º–æ—Ç—Ä–µ—Ç—å `reason` - –ø–æ—á–µ–º—É –∑–∞–∫—Ä—ã–ª–∏?
- –°—Ä–∞–≤–Ω–∏–≤–∞—Ç—å `time_min` —Å –∫–æ–Ω—Ñ–∏–≥–æ–º (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 40+ –º–∏–Ω—É—Ç)

### 5. **–î–∞–π –º–Ω–µ CSV:**
- –°–∫–æ–ø–∏—Ä—É–π CSV —Ñ–∞–π–ª
- –Ø –Ω–∞–π–¥—É –¢–û–ß–ù–£–Æ –ø—Ä–∏—á–∏–Ω—É –ø—Ä–æ–±–ª–µ–º—ã
- –ò—Å–ø—Ä–∞–≤–∏–º –∫–æ–¥!

---

## ‚úÖ –§–ò–ù–ê–õ–¨–ù–´–ô –°–¢–ê–¢–£–°

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:** ‚úÖ –ó–ê–í–ï–†–®–ï–ù–ê  
**–ü—Ä–æ–≤–µ—Ä–∫–∞:** ‚úÖ –í–°–ï –†–ê–ë–û–¢–ê–ï–¢  
**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å:** ‚úÖ –ì–û–¢–û–í –ö –ó–ê–ü–£–°–ö–£

---

**–í—Å—ë –≥–æ—Ç–æ–≤–æ! –ó–∞–ø—É—Å–∫–∞–π –±–æ—Ç–∞ –∏ —Å–º–æ—Ç—Ä–∏ CSV!** üöÄ

