# üéØ –£–ª—É—á—à–µ–Ω–∏–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—Ç–∫—Ä—ã—Ç—ã–º–∏ –ø–æ–∑–∏—Ü–∏—è–º–∏ (7 —è–Ω–≤–∞—Ä—è 2026)

## ‚úÖ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. **EXIT GUARD** ‚Äî –ó–∞—â–∏—Ç–∞ –æ—Ç –ø—Ä–µ–∂–¥–µ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è

**–§–∞–π–ª:** `src/strategies/scalping/futures/position_manager.py`

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –ë–ª–æ–∫–∏—Ä—É–µ—Ç **–Ω–µ–∫—Ä–∏—Ç–∏—á–Ω—ã–µ** –∑–∞–∫—Ä—ã—Ç–∏—è (analyzer, profit_drawdown, reversal) –µ—Å–ª–∏ –ø–æ–∑–∏—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç–∞ –º–µ–Ω—å—à–µ `min_holding_minutes`
- **–ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç –≤—Å–µ–≥–¥–∞:** SL, TSL, TP, liquidation, risk_emergency, margin_call, max_holding

**–õ–æ–≥–∏:**
```
üõ°Ô∏è [EXIT_GUARD] BTC-USDT: –±–ª–æ–∫–∏—Ä—É–µ–º –∑–∞–∫—Ä—ã—Ç–∏–µ (reason=profit_drawdown) 0.35 –º–∏–Ω < 0.50 –º–∏–Ω (regime=ranging)
```

**–ó–∞—á–µ–º:**
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —Ä–∞–Ω–Ω–∏–µ –≤—ã—Ö–æ–¥—ã –Ω–∞ —à—É–º–µ/–æ—Ç–∫–∞—Ç–∞—Ö
- –†–∞–±–æ—Ç–∞–µ—Ç –≤–º–µ—Å—Ç–µ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∫–æ–º–∏—Å—Å–∏–∏ (–Ω–µ –∑–∞–∫—Ä—ã–≤–∞—Ç—å –µ—Å–ª–∏ PnL < fees)
- –†–∏—Å–∫-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç (SL/TP) –ø—Ä–æ—Ö–æ–¥–∏—Ç –≤—Å–µ–≥–¥–∞

---

### 2. **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π TSL** ‚Äî –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π Trailing Stop Loss

**–§–∞–π–ª:** `src/strategies/scalping/futures/coordinators/trailing_sl_coordinator.py`

**–¢—Ä–∏ —Ä–µ–∂–∏–º–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ ADX:**

| –†–µ–∂–∏–º | –£—Å–ª–æ–≤–∏–µ | Distance multiplier | –õ–æ–≥–∏–∫–∞ |
|-------|---------|---------------------|--------|
| **FREEZE** üîµ | ADX > 35 | 1.4x (+40%) | –î–∞—ë–º –≤–æ–∑–¥—É—Ö –¥–ª—è –æ—Ç–∫–∞—Ç–æ–≤ –Ω–∞ —Å–∏–ª—å–Ω–æ–º —Ç—Ä–µ–Ω–¥–µ |
| **NORMAL** üü¢ | ADX 25-35 | 1.0x | –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –ª–æ–≥–∏–∫–∞ |
| **TIGHT** üü° | ADX < 25 | 0.75x (-25%) | –ñ—ë—Å—Ç—á–µ —Ñ–∏–∫—Å–∏—Ä—É–µ–º –Ω–∞ —Å–ª–∞–±–æ–º/ranging |

**–õ–æ–≥–∏:**
```
üîµ [TSL_MODE] BTC-USDT: FREEZE —Ä–µ–∂–∏–º | ADX=42.5 > 35 | distance_mult=1.4x (–¥–∞—ë–º –≤–æ–∑–¥—É—Ö –¥–ª—è –æ—Ç–∫–∞—Ç–æ–≤)
üîÑ [TSL_UPDATE] BTC-USDT: sl=43250.00, mode=freeze, ADX=42.5, distance=0.35%, regime=trending | 
   price=43580.00, entry=43400.00, highest=43620.00, profit=0.41% (net), gross=0.46%, trend=0.85
```

**–ó–∞—á–µ–º:**
- –ù–∞ **—Å–∏–ª—å–Ω–æ–º —Ç—Ä–µ–Ω–¥–µ** (ADX > 35) –Ω–µ –≤—ã–±–∏–≤–∞–µ—Ç –Ω–∞ –æ—Ç–∫–∞—Ç–∞—Ö 0.3-0.4%
- –ù–∞ **—Å–ª–∞–±–æ–º —Ç—Ä–µ–Ω–¥–µ** (ADX < 25) –±—ã—Å—Ç—Ä–µ–µ —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç –ø—Ä–∏–±—ã–ª—å
- **–£–º–Ω–æ–µ —É–¥–µ—Ä–∂–∞–Ω–∏–µ** –≤–º–µ—Å—Ç–æ –∂—ë—Å—Ç–∫–æ–≥–æ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–≥–æ SL

---

### 3. **–î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ—à–µ–Ω–∏–π**

#### 3.1 Profit Harvesting (PH)

**–§–∞–π–ª:** `src/strategies/scalping/futures/position_manager.py`

**–õ–æ–≥–∏:**
```
üéØ [PH_DECISION] BTC-USDT: action=close, reason=profit_harvest ($8.50 >= $7.80) | 
   time=45.2s, min_holding=30.0s
   
‚è∏Ô∏è [PH_DECISION] ETH-USDT: action=hold, reason=min_holding (time=18.5s < 30.0s) | 
   PnL=$6.20, threshold=$7.50
```

**–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç:**
- –ü–æ—á–µ–º—É –∑–∞–∫—Ä—ã–ª–∏ (extreme_profit/profit_harvest/below_threshold)
- –ü–æ—á–µ–º—É –¥–µ—Ä–∂–∏–º (min_holding/below_threshold)
- –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –ø–æ—Ä–æ–≥–∏ –∏ –≤—Ä–µ–º—è

#### 3.2 Exit Analyzer (SL –ø—Ä–æ–≤–µ—Ä–∫–∏)

**–§–∞–π–ª:** `src/strategies/scalping/futures/positions/exit_analyzer.py`

**–õ–æ–≥–∏:**
```
üîç [SL_CHECK] BTC-USDT: gross_pnl=-1.85% vs threshold=-2.50% | 
   net_pnl=-2.10%, sl=2.00%, spread_buffer=0.50% | 
   ADX=28.5, MTF=confirm, regime=trending
```

**–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç:**
- –¢–µ–∫—É—â–∏–π gross PnL (–¥–ª—è SL) vs net PnL (—Å –∫–æ–º–∏—Å—Å–∏–µ–π)
- –ü–æ—Ä–æ–≥ SL —Å —É—á—ë—Ç–æ–º —Å–ø—Ä–µ–¥–∞
- –ö–æ–Ω—Ç–µ–∫—Å—Ç: ADX, MTF —Å–∏–≥–Ω–∞–ª, —Ä–µ–∂–∏–º

#### 3.3 TrailingSL –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

**–§–∞–π–ª—ã:** `trailing_sl_coordinator.py`

**–õ–æ–≥–∏:**
```
üîß [TSL_ADJUST] BTC-USDT: distance 0.250% ‚Üí 0.350%, stop_loss –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω –ø–æ–¥ freeze —Ä–µ–∂–∏–º
```

**–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç:**
- –ö–∞–∫ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å distance –ø–æ–¥ —Ä–µ–∂–∏–º
- –ü–æ—á–µ–º—É TSL –¥–≤–∏–≥–∞–µ—Ç—Å—è –º–µ–¥–ª–µ–Ω–Ω–µ–µ/–±—ã—Å—Ç—Ä–µ–µ

---

## üéÅ –ß—Ç–æ –ø–æ–ª—É—á–∏–ª–∏

### –í–∏–¥–∏–º–æ—Å—Ç—å:
- **–í–∏–¥–Ω–æ –ø–æ—á–µ–º—É** –∑–∞–∫—Ä—ã–ª–∏ –∏–ª–∏ –¥–µ—Ä–∂–∏–º (—Ä–∞–Ω—å—à–µ: "–∑–∞–∫—Ä—ã—Ç–æ", —Ç–µ–ø–µ—Ä—å: –ø—Ä–∏—á–∏–Ω–∞ + –∫–æ–Ω—Ç–µ–∫—Å—Ç)
- **–í–∏–¥–Ω–æ —Å–∏–ª—É —Ç—Ä–µ–Ω–¥–∞** (ADX) –∏ –∫–∞–∫ –æ–Ω–∞ –≤–ª–∏—è–µ—Ç –Ω–∞ TSL
- **–í–∏–¥–Ω–æ —Ñ–∏–ª—å—Ç—Ä—ã** (MTF, ADX, spread, –∫–æ–º–∏—Å—Å–∏—è) –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

### –£–º–Ω–æ–µ —É–¥–µ—Ä–∂–∞–Ω–∏–µ:
- **–ù–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –Ω–∞ —à—É–º–µ** (EXIT_GUARD + min_holding)
- **–î–∞—ë—Ç –≤–æ–∑–¥—É—Ö —Ç—Ä–µ–Ω–¥–∞–º** (FREEZE —Ä–µ–∂–∏–º TSL –Ω–∞ ADX > 35)
- **–ë—ã—Å—Ç—Ä–µ–µ —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç –Ω–∞ —Å–ª–∞–±–æ–º** (TIGHT —Ä–µ–∂–∏–º TSL –Ω–∞ ADX < 25)

### –ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å —Ä–µ—à–µ–Ω–∏–π:
- –ö–∞–∂–¥–æ–µ —Ä–µ—à–µ–Ω–∏–µ –æ –∑–∞–∫—Ä—ã—Ç–∏–∏/—É–¥–µ—Ä–∂–∞–Ω–∏–∏ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
- –õ–µ–≥–∫–æ –Ω–∞–π—Ç–∏: "–ü–æ—á–µ–º—É –∑–∞–∫—Ä—ã–ª —á–µ—Ä–µ–∑ 2 –º–∏–Ω?" ‚Üí `[PH_DECISION]` –ø–æ–∫–∞–∂–µ—Ç –ø—Ä–∏—á–∏–Ω—É
- –õ–µ–≥–∫–æ –Ω–∞–π—Ç–∏: "–ü–æ—á–µ–º—É TSL —Å—Ä–∞–±–æ—Ç–∞–ª –Ω–∞ –æ—Ç–∫–∞—Ç–µ?" ‚Üí `[TSL_UPDATE]` –ø–æ–∫–∞–∂–µ—Ç mode –∏ distance

---

## üìä –ö–∞–∫ —á–∏—Ç–∞—Ç—å –ª–æ–≥–∏

### –ü—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –∏—â–∏—Ç–µ:
```
üéØ [PH_DECISION] SYMBOL: action=close, reason=...
üõ°Ô∏è [EXIT_GUARD] SYMBOL: –±–ª–æ–∫–∏—Ä—É–µ–º –∑–∞–∫—Ä—ã—Ç–∏–µ (reason=...)
üîÑ [TSL_UPDATE] SYMBOL: sl=..., mode=..., ADX=...
üîç [SL_CHECK] SYMBOL: gross_pnl=... vs threshold=...
```

### –ü—Ä–∏ —É–¥–µ—Ä–∂–∞–Ω–∏–∏ –∏—â–∏—Ç–µ:
```
‚è∏Ô∏è [PH_DECISION] SYMBOL: action=hold, reason=min_holding
üîµ [TSL_MODE] SYMBOL: FREEZE —Ä–µ–∂–∏–º | ADX=... (–¥–∞—ë–º –≤–æ–∑–¥—É—Ö)
```

### –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ TSL:
```
üîß [TSL_ADJUST] SYMBOL: distance ... ‚Üí ..., –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω –ø–æ–¥ ... —Ä–µ–∂–∏–º
```

---

## üîú –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥

**–ö–æ—Ä–æ—Ç–∫–∏–π —Ç–µ—Å—Ç (3‚Äì5 –º–∏–Ω—É—Ç):**
- –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞ –≤ —Ä–µ–∂–∏–º–µ futures
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏: `EXIT_GUARD`, `TSL_MODE`, `TSL_UPDATE`, `PH_DECISION`, `SL_CHECK`
- –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –≤—ã—Ö–æ–¥—ã (SL/TP) —Ä–∞–±–æ—Ç–∞—é—Ç
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –Ω–µ–∫—Ä–∏—Ç–∏—á–Ω—ã–µ –≤—ã—Ö–æ–¥—ã –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –¥–æ min_holding

---

## üìù –†–µ–∑—é–º–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ò–∑–º–µ–Ω–µ–Ω–∏–µ | –≠—Ñ—Ñ–µ–∫—Ç |
|-----------|-----------|--------|
| `position_manager.py` | EXIT_GUARD + PH –ª–æ–≥–∏ | –ë–ª–æ–∫–∏—Ä—É–µ—Ç —Ä–∞–Ω–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–∏—è, –ª–æ–≥–∏—Ä—É–µ—Ç —Ä–µ—à–µ–Ω–∏—è PH |
| `trailing_sl_coordinator.py` | –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π TSL (freeze/normal/tight) | –£–º–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è distance –ø–æ ADX |
| `exit_analyzer.py` | SL_CHECK –ª–æ–≥–∏ | –í–∏–¥–Ω—ã –ø—Ä–∏—á–∏–Ω—ã SL —Ä–µ—à–µ–Ω–∏–π —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º |

**–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ–±—Ä–∞—Ç–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã** ‚Äî —Å—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç, –¥–æ–±–∞–≤–ª–µ–Ω—ã —Ç–æ–ª—å–∫–æ –ª–æ–≥–∏ –∏ —É–º–Ω—ã–µ –≥–∞—Ä–¥—ã.
