# üîç –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê: –ò–°–¢–ò–ù–ù–ê–Ø –ü–†–ò–ß–ò–ù–ê –ü–†–û–ë–õ–ï–ú –° API

**–î–∞—Ç–∞:** 7 —è–Ω–≤–∞—Ä—è 2026  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü–†–ò–ß–ò–ù–ê –ù–ê–ô–î–ï–ù–ê

---

## üìå –ö–†–ê–¢–ö–û–ï –†–ï–ó–Æ–ú–ï

**–ü—Ä–æ–±–ª–µ–º–∞ –ù–ï –≤ REST API** - –æ–Ω –¥–æ—Å—Ç—É–ø–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.  
**–ü—Ä–æ–±–ª–µ–º–∞ –ù–ï –≤ —Ñ–æ—Ä–º–∞—Ç–µ –¥–∞–Ω–Ω—ã—Ö** - –∑–∞–ø—Ä–æ—Å—ã –∏ –æ—Ç–≤–µ—Ç—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ OKX.

**–ò–°–¢–ò–ù–ù–ê–Ø –ü–†–ò–ß–ò–ù–ê:** **–°–µ—Ç–µ–≤—ã–µ —Ç–∞–π–º–∞—É—Ç—ã –∏ –æ–±—Ä—ã–≤—ã —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –Ω–∞ —É—Ä–æ–≤–Ω–µ Windows/aiohttp**

---

## üî¨ –î–ò–ê–ì–ù–û–°–¢–ò–ß–ï–°–ö–ò–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´

### ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **DNS —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ:** www.okx.com ‚Üí 172.64.144.82 (Cloudflare CDN) ‚úÖ
2. **Ping:** 0ms –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å, 0% –ø–æ—Ç–µ—Ä—å ‚úÖ
3. **HTTPS –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å:** 200 OK –æ—Ç–≤–µ—Ç—ã ‚úÖ
4. **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:** API –∫–ª—é—á–∏ –≤–∞–ª–∏–¥–Ω—ã ‚úÖ
5. **–§–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–æ–≤:** –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏, –ø–æ–¥–ø–∏—Å—å, body ‚úÖ
6. **–ü–∞—Ä—Å–∏–Ω–≥ –æ—Ç–≤–µ—Ç–æ–≤:** JSON –ø–∞—Ä—Å–∏—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ, —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã ‚úÖ

### ‚ùå –ß—Ç–æ –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è:** –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ –æ–±—Ä—ã–≤—ã —Å –æ—à–∏–±–∫–æ–π:
   ```
   WinError 64: –£–∫–∞–∑–∞–Ω–Ω–æ–µ —Å–µ—Ç–µ–≤–æ–µ –∏–º—è –±–æ–ª–µ–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ
   ConnectionResetError / ClientConnectorError
   ```

2. **Keep-alive —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è:** aiohttp —Å–µ—Å—Å–∏–∏ —Ç–µ—Ä—è—é—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏

3. **–¢–∞–π–º–∞—É—Ç—ã:** –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–µ –∑–∞–≤–µ—Ä—à–∞—é—Ç—Å—è –≤ –æ—Ç–≤–µ–¥–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è (30s)

---

## üß™ –í–û–°–ü–†–û–ò–ó–í–ï–î–ï–ù–ò–ï –ü–†–û–ë–õ–ï–ú–´

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü—Ä–æ—Å—Ç–æ–π HTTP —Ç–µ—Å—Ç
```bash
python test_rest_simple.py
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –†–ê–ë–û–¢–ê–ï–¢ (–µ–¥–∏–Ω–∏—á–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –±–µ–∑ keep-alive)

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –¢–µ—Å—Ç —Å —Ä–µ–∞–ª—å–Ω—ã–º –∫–ª–∏–µ–Ω—Ç–æ–º
```bash
python test_rest_with_client.py
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –†–ê–ë–û–¢–ê–ï–¢ (1-3 –∑–∞–ø—Ä–æ—Å–∞ –ø–æ–¥—Ä—è–¥)

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ë–æ—Ç –≤ —Ä–µ–∞–ª—å–Ω–æ–º —Ä–µ–∂–∏–º–µ (—Ç–æ—Ä–≥–æ–≤—ã–π —Ü–∏–∫–ª)
```bash
python run.py --mode futures
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚ùå –ü–ï–†–ò–û–î–ò–ß–ï–°–ö–ò–ï –°–ë–û–ò
- –ü–æ—Å–ª–µ 1-2 –º–∏–Ω—É—Ç —Ä–∞–±–æ—Ç—ã –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Ç–∞–π–º–∞—É—Ç—ã
- –ß–∞—Å—Ç–æ—Ç–∞: –∫–∞–∂–¥—ã–µ 2-5 –∑–∞–ø—Ä–æ—Å–æ–≤
- –û—à–∏–±–∫–∞: "Cannot connect to host www.okx.com:443"

---

## üéØ –ö–û–†–ù–ï–í–ê–Ø –ü–†–ò–ß–ò–ù–ê

### –ü—Ä–æ–±–ª–µ–º–∞: Keep-Alive Connection Pool Exhaustion

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**

1. –ë–æ—Ç —Å–æ–∑–¥–∞–µ—Ç aiohttp.ClientSession –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
2. –°–µ—Å—Å–∏—è —Å–æ–∑–¥–∞–µ—Ç –ø—É–ª keep-alive —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 100)
3. –ü—Ä–∏ –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ (—Ç–æ—Ä–≥–æ–≤—ã–π —Ü–∏–∫–ª –∫–∞–∂–¥—ã–µ 5—Å):
   - –°—Ç–∞—Ä—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –Ω–µ —É—Å–ø–µ–≤–∞—é—Ç –∑–∞–∫—Ä—ã–≤–∞—Ç—å—Å—è
   - Windows –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–µ TCP —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —á–µ—Ä–µ–∑ 60-120 —Å–µ–∫—É–Ω–¥
   - aiohttp –ø—ã—Ç–∞–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É–∂–µ –∑–∞–∫—Ä—ã—Ç–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
   - –ü–æ–ª—É—á–∞–µ—Ç WinError 64 "–£–∫–∞–∑–∞–Ω–Ω–æ–µ —Å–µ—Ç–µ–≤–æ–µ –∏–º—è –±–æ–ª–µ–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ"

4. Retry –ª–æ–≥–∏–∫–∞ –ø—ã—Ç–∞–µ—Ç—Å—è –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è, –Ω–æ:
   - Timestamp —É–∂–µ —É—Å—Ç–∞—Ä–µ–ª (OKX —Ç—Ä–µ–±—É–µ—Ç —Å–≤–µ–∂–∏–µ timestamp)
   - –ü–æ–¥–ø–∏—Å—å –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è, –Ω–æ –∑–∞–¥–µ—Ä–∂–∫–∞ 1-2 —Å–µ–∫—É–Ω–¥—ã
   - –¢–µ—Ä—è–µ—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å —Ç–æ—Ä–≥–æ–≤–æ–≥–æ —Ü–∏–∫–ª–∞

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã:**

- Windows Firewall –º–æ–∂–µ—Ç —Ä–∞–∑—Ä—ã–≤–∞—Ç—å –¥–æ–ª–≥–æ–∂–∏–≤—É—â–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- NAT —Ä–æ—É—Ç–µ—Ä –º–æ–∂–µ—Ç —Å–±—Ä–∞—Å—ã–≤–∞—Ç—å –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–µ TCP —Å–µ—Å—Å–∏–∏
- Cloudflare CDN –º–æ–∂–µ—Ç —Ä–æ—Ç–∏—Ä–æ–≤–∞—Ç—å IP –∞–¥—Ä–µ—Å–∞ (load balancing)

---

## üõ†Ô∏è –†–ï–®–ï–ù–ò–Ø

### ‚úÖ –†–ï–®–ï–ù–ò–ï #1: –û—Ç–∫–ª—é—á–∏—Ç—å Keep-Alive (–±—ã—Å—Ç—Ä–æ–µ)

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ –≤ `futures_client.py`:**

```python
async def _make_request(...):
    if not self.session or self.session.closed:
        # ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –û—Ç–∫–ª—é—á–∞–µ–º keep-alive
        connector = aiohttp.TCPConnector(
            limit=10,               # –õ–∏–º–∏—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
            limit_per_host=10,      # –õ–∏–º–∏—Ç –Ω–∞ —Ö–æ—Å—Ç
            force_close=True,       # ‚ùó –ö–õ–Æ–ß–ï–í–û–ï: –ó–∞–∫—Ä—ã–≤–∞—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
            enable_cleanup_closed=True  # –û—á–∏—â–∞—Ç—å –∑–∞–∫—Ä—ã—Ç—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
        )
        self.session = aiohttp.ClientSession(connector=connector)
```

**–ü–ª—é—Å—ã:**
- –ü—Ä–æ—Å—Ç–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
- –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ù–µ—Ç –ø—Ä–æ–±–ª–µ–º —Å —É—Å—Ç–∞—Ä–µ–≤—à–∏–º–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è–º–∏

**–ú–∏–Ω—É—Å—ã:**
- –ù–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ —É—Å—Ç–∞–Ω–æ–≤–∫—É –Ω–æ–≤–æ–≥–æ TCP —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ (+50-100ms)
- –ù–æ –¥–ª—è —Å–∫–∞–ª—å–ø–∏–Ω–≥–∞ —ç—Ç–æ –ø—Ä–∏–µ–º–ª–µ–º–æ (–∏–Ω—Ç–µ—Ä–≤–∞–ª 5 —Å–µ–∫—É–Ω–¥ –º–µ–∂–¥—É —Ü–∏–∫–ª–∞–º–∏)

---

### ‚úÖ –†–ï–®–ï–ù–ò–ï #2: –ê–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è –ø–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Å—Å–∏–∏ (—Å—Ä–µ–¥–Ω–µ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏)

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ –≤ `futures_client.py`:**

```python
class OKXFuturesClient:
    def __init__(self, ...):
        ...
        self._session_created_at = None
        self._session_max_age = 60  # –ü–µ—Ä–µ—Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–µ—Å—Å–∏—é –∫–∞–∂–¥—ã–µ 60 —Å–µ–∫—É–Ω–¥
    
    async def _make_request(...):
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–æ–∑—Ä–∞—Å—Ç —Å–µ—Å—Å–∏–∏
        now = time.time()
        if (
            not self.session 
            or self.session.closed 
            or (self._session_created_at and now - self._session_created_at > self._session_max_age)
        ):
            if self.session and not self.session.closed:
                await self.session.close()
            
            connector = aiohttp.TCPConnector(
                limit=10,
                limit_per_host=10,
                ttl_dns_cache=300,  # DNS –∫—ç—à –Ω–∞ 5 –º–∏–Ω—É—Ç
            )
            self.session = aiohttp.ClientSession(connector=connector)
            self._session_created_at = now
            logger.debug("‚ôªÔ∏è –ü–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ aiohttp —Å–µ—Å—Å–∏—è")
```

**–ü–ª—é—Å—ã:**
- –ë–∞–ª–∞–Ω—Å–∏—Ä—É–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å
- Keep-alive —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–Ω—É—Ç—Ä–∏ 60-—Å–µ–∫—É–Ω–¥–Ω–æ–≥–æ –æ–∫–Ω–∞
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–µ –º–µ—Ä—Ç–≤—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

**–ú–∏–Ω—É—Å—ã:**
- –ß—É—Ç—å —Å–ª–æ–∂–Ω–µ–µ –≤ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- –¢—Ä–µ–±—É–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ —Å–æ–∑–¥–∞–Ω–∏—è —Å–µ—Å—Å–∏–∏

---

### ‚úÖ –†–ï–®–ï–ù–ò–ï #3: Backoff + Circuit Breaker (–ø–æ–ª–Ω–æ–µ)

**–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ `futures_client.py`:**

```python
from tenacity import retry, stop_after_attempt, wait_exponential, retry_if_exception_type

class OKXFuturesClient:
    def __init__(self, ...):
        ...
        self._circuit_breaker_failures = 0
        self._circuit_breaker_threshold = 3
        self._circuit_breaker_reset_time = None
    
    @retry(
        stop=stop_after_attempt(3),
        wait=wait_exponential(multiplier=1, min=1, max=10),
        retry=retry_if_exception_type((
            aiohttp.ClientConnectorError,
            asyncio.TimeoutError,
            ConnectionResetError,
        ))
    )
    async def _make_request_with_retry(...):
        # Circuit breaker check
        if self._circuit_breaker_reset_time:
            if time.time() < self._circuit_breaker_reset_time:
                raise RuntimeError("Circuit breaker open - too many failures")
            else:
                # Reset circuit breaker
                self._circuit_breaker_failures = 0
                self._circuit_breaker_reset_time = None
        
        try:
            return await self._make_request(...)
        except (aiohttp.ClientConnectorError, ConnectionResetError) as e:
            self._circuit_breaker_failures += 1
            if self._circuit_breaker_failures >= self._circuit_breaker_threshold:
                self._circuit_breaker_reset_time = time.time() + 30  # 30 sec cooldown
                logger.error("üö® Circuit breaker –æ—Ç–∫—Ä—ã—Ç - —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ —Å–±–æ–µ–≤ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è")
            raise
```

**–ü–ª—é—Å—ã:**
- –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ
- –ó–∞—â–∏—â–∞–µ—Ç –æ—Ç –∫–∞—Å–∫–∞–¥–Ω—ã—Ö —Å–±–æ–µ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è

**–ú–∏–Ω—É—Å—ã:**
- –°–∞–º–æ–µ —Å–ª–æ–∂–Ω–æ–µ –≤ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- –¢—Ä–µ–±—É–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ `tenacity`

---

## üìä –†–ï–ö–û–ú–ï–ù–î–£–ï–ú–û–ï –†–ï–®–ï–ù–ò–ï

### üéØ –ö–æ–º–±–∏–Ω–∞—Ü–∏—è –†–ï–®–ï–ù–ò–ï #1 + –†–ï–®–ï–ù–ò–ï #2

**–ü–æ—á–µ–º—É:**
1. **–†–ï–®–ï–ù–ò–ï #1** (force_close=True) —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ
2. **–†–ï–®–ï–ù–ò–ï #2** (–ø–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞–∂–¥—ã–µ 60—Å) –¥–æ–±–∞–≤–ª—è–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –∑–∞—â–∏—Ç—É
3. –ü—Ä–æ—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è, –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –Ω–æ–≤—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
4. –ü—Ä–∏–µ–º–ª–µ–º–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–ª—è —Å–∫–∞–ª—å–ø–∏–Ω–≥–∞ (–∏–Ω—Ç–µ—Ä–≤–∞–ª 5 —Å–µ–∫—É–Ω–¥)

**–ö–æ–¥ –¥–ª—è –≤–Ω–µ–¥—Ä–µ–Ω–∏—è:**

```python
class OKXFuturesClient:
    def __init__(self, ...):
        ...
        self._session_created_at = None
        self._session_max_age = 60  # –ü–µ—Ä–µ—Å–æ–∑–¥–∞–≤–∞—Ç—å –∫–∞–∂–¥—ã–µ 60 —Å–µ–∫—É–Ω–¥
    
    async def _make_request(self, method: str, endpoint: str, ...):
        url = self.base_url + endpoint
        timestamp = datetime.utcnow().strftime("%Y-%m-%dT%H:%M:%S.%f")[:-3] + "Z"
        
        # ... –ø–æ–¥–ø–∏—Å—å –∏ –∑–∞–≥–æ–ª–æ–≤–∫–∏ ...
        
        # ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏–µ–π —Å force_close
        now = time.time()
        if (
            not self.session 
            or self.session.closed 
            or (self._session_created_at and now - self._session_created_at > self._session_max_age)
        ):
            if self.session and not self.session.closed:
                await self.session.close()
            
            connector = aiohttp.TCPConnector(
                limit=10,
                limit_per_host=10,
                force_close=True,  # ‚ùó –ó–∞–∫—Ä—ã–≤–∞—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –ø–æ—Å–ª–µ –∑–∞–ø—Ä–æ—Å–∞
                enable_cleanup_closed=True,
                ttl_dns_cache=300,
            )
            self.session = aiohttp.ClientSession(connector=connector)
            self._session_created_at = now
            logger.debug("‚ôªÔ∏è –ü–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ aiohttp —Å–µ—Å—Å–∏—è —Å force_close=True")
        
        # ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ ...
```

---

## ‚úÖ –û–ñ–ò–î–ê–ï–ú–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢ –ü–û–°–õ–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

1. **–ù–µ—Ç –æ—à–∏–±–æ–∫ "Cannot connect to host"** ‚úÖ
2. **–°—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ 30+ –º–∏–Ω—É—Ç** ‚úÖ
3. **–¶–∏–∫–ª < 5 —Å–µ–∫—É–Ω–¥** ‚úÖ (–Ω–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ +100ms –ø—Ä–∏–µ–º–ª–µ–º–∞)
4. **Margin ratio –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π** ‚úÖ (–¥–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–∞—é—Ç—Å—è —Å—Ç–∞–±–∏–ª—å–Ω–æ)
5. **ADX —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è** ‚úÖ (—Å–≤–µ—á–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –±–µ–∑ —Å–±–æ–µ–≤)

---

## üìù –ò–¢–û–ì–û–í–´–ô –ß–ï–ö–õ–ò–°–¢

- [x] –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞
- [x] –ü—Ä–∏—á–∏–Ω–∞ –Ω–∞–π–¥–µ–Ω–∞ (—Å–µ—Ç–µ–≤—ã–µ —Ç–∞–π–º–∞—É—Ç—ã keep-alive)
- [ ] –ü—Ä–∏–º–µ–Ω–∏—Ç—å –†–ï–®–ï–ù–ò–ï #1 (force_close=True)
- [ ] –ü—Ä–∏–º–µ–Ω–∏—Ç—å –†–ï–®–ï–ù–ò–ï #2 (–ø–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Å—Å–∏–∏)
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –±–æ—Ç 30+ –º–∏–Ω—É—Ç
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ—à–∏–±–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- [ ] –°–æ–±—Ä–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É vs Jan 7 baseline

---

**–ó–∞–∫–ª—é—á–µ–Ω–∏–µ:** –ü—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ –ù–ï –≤ REST API, –ù–ï –≤ —Ñ–æ—Ä–º–∞—Ç–µ –¥–∞–Ω–Ω—ã—Ö, –∞ –≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ keep-alive —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è–º–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ aiohttp + Windows. –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ—Å—Ç–æ–µ –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ - force_close=True + –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –ø–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Å—Å–∏–∏.
