# –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –ü–†–û–ë–õ–ï–ú –û–ë–ù–ê–†–£–ñ–ï–ù–ù–´–• –í –õ–û–ì–ê–• 2025-12-18

**–î–∞—Ç–∞:** 2025-12-18  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û

---

## üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ü–†–û–ë–õ–ï–ú

### –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:
- **–ù–∞—á–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å:** $788.60
- **–ö–æ–Ω–µ—á–Ω—ã–π –±–∞–ª–∞–Ω—Å:** $689.68
- **–£–±—ã—Ç–æ–∫:** -$98.92 (-12.54%)
- **–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã:** 16 —á–∞—Å–æ–≤ 36 –º–∏–Ω—É—Ç

### –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:
1. **420 –æ—à–∏–±–æ–∫** - `Parameter clOrdId error` –ø—Ä–∏ —Ä–∞–∑–º–µ—â–µ–Ω–∏–∏ TP-–æ—Ä–¥–µ—Ä–æ–≤
2. **100 –æ—à–∏–±–æ–∫** - `could not convert string to float: ''` –≤ `_update_peak_profit`
3. **78 –æ—à–∏–±–æ–∫** - `'NoneType' object has no attribute 'unregister_position'`
4. **–ú–Ω–æ–≥–æ CRITICAL** - DRIFT_ADD (–ø–æ–∑–∏—Ü–∏–∏ –Ω–∞–π–¥–µ–Ω—ã –Ω–∞ –±–∏—Ä–∂–µ, –Ω–æ –Ω–µ –≤ —Ä–µ–µ—Å—Ç—Ä–µ)
5. **68 –æ—à–∏–±–æ–∫** - "–ü–æ–∑–∏—Ü–∏—è —É–∂–µ –æ—Ç–∫—Ä—ã—Ç–∞" (–¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ø—ã—Ç–æ–∫)

---

## ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è clOrdId –¥–ª—è TP-–æ—Ä–¥–µ—Ä–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞:** –§–æ—Ä–º–∞—Ç `TP_SOL-USDT_1766025838975_4771` –æ—Ç–∫–ª–æ–Ω—è–ª—Å—è OKX API —Å –æ—à–∏–±–∫–æ–π `Parameter clOrdId error`.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- –£–±—Ä–∞–Ω –¥–µ—Ñ–∏—Å –∏–∑ symbol –¥–ª—è –±–æ–ª–µ–µ –∫–æ—Ä–æ—Ç–∫–æ–≥–æ ID
- –£–ª—É—á—à–µ–Ω —Ñ–æ—Ä–º–∞—Ç: `TP{symbol_clean}{timestamp_ms}{random_suffix}` (–º–∞–∫—Å 32 —Å–∏–º–≤–æ–ª–∞)
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –∏ –æ–±—Ä–µ–∑–∫–∞ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏–π
- Fallback –Ω–∞ –±–æ–ª–µ–µ –∫–æ—Ä–æ—Ç–∫–∏–π —Ñ–æ—Ä–º–∞—Ç –µ—Å–ª–∏ –æ—Å–Ω–æ–≤–Ω–æ–π –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç

**–§–∞–π–ª:** `src/strategies/scalping/futures/position_manager.py` (—Å—Ç—Ä–æ–∫–∏ 3209-3214, 3244-3251)

**–ö–æ–¥:**
```python
# ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –§–æ—Ä–º–∞—Ç –¥–æ–ª–∂–µ–Ω —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º OKX
timestamp_ms = int(time.time() * 1000)
random_suffix = random.randint(1000, 9999)
symbol_clean = symbol.replace("-", "")
base_id = f"TP{symbol_clean}{timestamp_ms}{random_suffix}"
unique_cl_ord_id = base_id[:32].strip("_")
if not unique_cl_ord_id:
    unique_cl_ord_id = f"TP{symbol_clean[:10]}{random_suffix}"[:32]
```

---

### 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –ø–∞—Ä—Å–∏–Ω–≥ –ø—É—Å—Ç—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –≤ `_update_peak_profit`

**–ü—Ä–æ–±–ª–µ–º–∞:** –û—à–∏–±–∫–∞ `could not convert string to float: ''` –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É –≤ float.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –ø–µ—Ä–µ–¥ `float()`
- Fallback –Ω–∞ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (0.01) –µ—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –ø—É—Å—Ç–æ–µ –∏–ª–∏ –Ω–µ–≤–∞–ª–∏–¥–Ω–æ–µ
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è

**–§–∞–π–ª:** `src/strategies/scalping/futures/position_manager.py` (—Å—Ç—Ä–æ–∫–∏ 4188-4195, 5122-5131)

**–ö–æ–¥:**
```python
# ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –ø–µ—Ä–µ–¥ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–µ–π –≤ float
ct_val_str = details.get("ctVal", "0.01")
if ct_val_str == "" or ct_val_str is None:
    ct_val_str = "0.01"  # Fallback –∑–Ω–∞—á–µ–Ω–∏–µ
try:
    ct_val = float(ct_val_str)
except (ValueError, TypeError):
    logger.warning(f"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å ctVal '{ct_val_str}' –≤ float –¥–ª—è {symbol}, –∏—Å–ø–æ–ª—å–∑—É–µ–º 0.01")
    ct_val = 0.01
if ct_val <= 0:
    logger.warning(f"‚ö†Ô∏è ctVal <= 0 –¥–ª—è {symbol}, –∏—Å–ø–æ–ª—å–∑—É–µ–º 0.01")
    ct_val = 0.01
```

---

### 3. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –æ—à–∏–±–∫–∏ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–π

**–ü—Ä–æ–±–ª–µ–º–∞:** `'NoneType' object has no attribute 'unregister_position'` - –ø–æ–ø—ã—Ç–∫–∞ –≤—ã–∑–≤–∞—Ç—å –º–µ—Ç–æ–¥ –Ω–∞ None –æ–±—ä–µ–∫—Ç–µ.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ `position_registry is not None` –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º –º–µ—Ç–æ–¥–æ–≤
- –î–æ–±–∞–≤–ª–µ–Ω fallback —á–µ—Ä–µ–∑ `orchestrator.position_registry` –µ—Å–ª–∏ –ø—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º

**–§–∞–π–ª:** `src/strategies/scalping/futures/position_manager.py` (—Å—Ç—Ä–æ–∫–∏ 3380-3392, 3418-3429)

**–ö–æ–¥:**
```python
# ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ position_registry –Ω–µ None
if hasattr(self, "position_registry") and self.position_registry is not None:
    try:
        await self.position_registry.unregister_position(symbol)
    except Exception as e:
        logger.warning(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è {symbol} –∏–∑ position_registry: {e}")
elif hasattr(self, "orchestrator") and self.orchestrator:
    if hasattr(self.orchestrator, "position_registry") and self.orchestrator.position_registry is not None:
        try:
            await self.orchestrator.position_registry.unregister_position(symbol)
        except Exception as e:
            logger.warning(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è {symbol} –∏–∑ orchestrator.position_registry: {e}")
```

---

### 4. –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ DRIFT_ADD

**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–Ω–æ–≥–æ CRITICAL –ª–æ–≥–æ–≤ "DRIFT_ADD found on exchange but not in registry" - –ø–æ–∑–∏—Ü–∏–∏ –Ω–∞–π–¥–µ–Ω—ã –Ω–∞ –±–∏—Ä–∂–µ, –Ω–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤ —Ä–µ–µ—Å—Ç—Ä–µ.

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- DRIFT_ADD —É–∂–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –≤ `orchestrator._sync_positions_with_exchange`
- –ü–æ–∑–∏—Ü–∏–∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º `entry_time` –∏–∑ `cTime/uTime` –±–∏—Ä–∂–∏
- –°–æ–∑–¥–∞—é—Ç—Å—è `PositionMetadata` –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è –≤ `PositionRegistry`

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –ª–æ–≥–∏ DRIFT_ADD_SYNCED –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É—Å–ø–µ—à–Ω–æ–≥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è.

**–§–∞–π–ª:** `src/strategies/scalping/futures/orchestrator.py` (—Å—Ç—Ä–æ–∫–∏ 1855-1896)

---

### 5. –£–ª—É—á—à–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–∑–∏—Ü–∏–π

**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–Ω–æ–≥–æ –ø–æ–ø—ã—Ç–æ–∫ –æ—Ç–∫—Ä—ã—Ç—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–∑–∏—Ü–∏–∏.

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–∑–∏—Ü–∏–π –Ω–∞ –±–∏—Ä–∂–µ –ø–µ—Ä–µ–¥ –æ—Ç–∫—Ä—ã—Ç–∏–µ–º —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ (LONG/SHORT)
- –£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è `allow_concurrent_positions` –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
- –î–æ–±–∞–≤–ª–µ–Ω throttling –¥–ª—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É throttling –∏ —É–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

**–§–∞–π–ª:** `src/strategies/scalping/futures/coordinators/signal_coordinator.py` (—Å—Ç—Ä–æ–∫–∏ 1267-1378)

---

## üìã –ò–¢–û–ì–û–í–´–ô –°–ü–ò–°–û–ö –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô

‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**
1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è clOrdId –¥–ª—è TP-–æ—Ä–¥–µ—Ä–æ–≤ (420 –æ—à–∏–±–æ–∫)
2. –ü–∞—Ä—Å–∏–Ω–≥ –ø—É—Å—Ç—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –≤ `_update_peak_profit` (100 –æ—à–∏–±–æ–∫)
3. –ü—Ä–æ–≤–µ—Ä–∫–∞ `position_registry` –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º –ø–æ–∑–∏—Ü–∏–π (78 –æ—à–∏–±–æ–∫)
4. –ü–∞—Ä—Å–∏–Ω–≥ ctVal –≤ `_update_position_stats` (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞)

‚ö†Ô∏è **–¢—Ä–µ–±—É–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:**
1. DRIFT_ADD - –ª–æ–≥–∏–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —É–∂–µ –µ—Å—Ç—å, –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–∑–∏—Ü–∏–π - –ª–æ–≥–∏–∫–∞ –µ—Å—Ç—å, –Ω–æ –º–æ–∂–µ—Ç –±—ã—Ç—å race condition

---

## üéØ –û–ñ–ò–î–ê–ï–ú–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –æ–∂–∏–¥–∞–µ—Ç—Å—è:
- ‚úÖ –£–º–µ–Ω—å—à–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ API –ø—Ä–∏ —Ä–∞–∑–º–µ—â–µ–Ω–∏–∏ TP-–æ—Ä–¥–µ—Ä–æ–≤
- ‚úÖ –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ—à–∏–±–æ–∫ –ø–∞—Ä—Å–∏–Ω–≥–∞ –≤ `_update_peak_profit`
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–π –±–µ–∑ –æ—à–∏–±–æ–∫ NoneType
- ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ–∑–∏—Ü–∏–π —Å –±–∏—Ä–∂–µ–π

---

## üìù –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

1. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:** –°–ª–µ–¥–∏—Ç—å –∑–∞ –ª–æ–≥–∞–º–∏ –ø–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
2. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ TP-–æ—Ä–¥–µ—Ä–æ–≤ –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–º –∞–∫–∫–∞—É–Ω—Ç–µ
3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞:** –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ —É–±—ã—Ç–æ–∫ -12.54% –Ω–µ —Å–≤—è–∑–∞–Ω —Å –æ—à–∏–±–∫–∞–º–∏ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–π
4. **–ê–Ω–∞–ª–∏–∑ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—á–µ–º—É —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –æ—Ä–¥–µ—Ä–æ–≤ —Ç–æ–ª—å–∫–æ 10.7%

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-12-18  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –ü–†–ò–ú–ï–ù–ï–ù–´
