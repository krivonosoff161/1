# –ò–¢–û–ì–û–í–ê–Ø –ü–†–û–í–ï–†–ö–ê –õ–û–ì–ò–ö–ò –ù–ê–ü–†–ê–í–õ–ï–ù–ò–Ø –ò PNL

**–î–∞—Ç–∞:** 23 –Ω–æ—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞

---

## ‚úÖ –ü–†–û–í–ï–†–ö–ê –õ–û–ì–ò–ö–ò –ù–ê–ü–†–ê–í–õ–ï–ù–ò–Ø –°–ò–ì–ù–ê–õ–û–í

### –ú–æ–¥—É–ª—å: `signal_generator.py`

**–ú–µ—Ç–æ–¥:** `_check_ma_signal()` (—Å—Ç—Ä–æ–∫–∏ 2247-2588)

**–õ–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ü–µ–Ω—ã:**
1. ‚úÖ –ë–µ—Ä–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 —Å–≤–µ—á–µ–π –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
2. ‚úÖ –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç –ø–µ—Ä–≤—É—é –∏ –ø–æ—Å–ª–µ–¥–Ω—é—é —Ü–µ–Ω—É –≤ –æ–∫–Ω–µ
3. ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `price_change_threshold` –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 0.0005 = 0.05%)
4. ‚úÖ –¢–∞–∫–∂–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ 3 —Å–≤–µ—á–∏ –¥–ª—è –±–æ–ª–µ–µ –±—ã—Å—Ç—Ä–æ–π —Ä–µ–∞–∫—Ü–∏–∏

**–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤ –ø–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—é:**
- ‚úÖ **BULLISH —Å–∏–≥–Ω–∞–ª:** –ë–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –µ—Å–ª–∏ `price_direction == "down"` (—Å—Ç—Ä–æ–∫–∞ 2487)
- ‚úÖ **BEARISH —Å–∏–≥–Ω–∞–ª:** –ë–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –µ—Å–ª–∏ `price_direction == "up"` (—Å—Ç—Ä–æ–∫–∞ 2540)

**–í—ã–≤–æ–¥:** ‚úÖ –õ–æ–≥–∏–∫–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è. –°–∏–≥–Ω–∞–ª—ã —Ñ–∏–ª—å—Ç—Ä—É—é—Ç—Å—è –ø–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—é —Ü–µ–Ω—ã –≤ `signal_generator.py`.

---

## ‚úÖ –ü–†–û–í–ï–†–ö–ê –†–ê–°–ß–ï–¢–ê PNL

### –ú–æ–¥—É–ª—å: `trailing_stop_loss.py`

**–ú–µ—Ç–æ–¥:** `get_profit_pct()` (—Å—Ç—Ä–æ–∫–∞ 374)

**–§–æ—Ä–º—É–ª–∞ –¥–ª—è LONG:**
```python
profit_pct = (current_price - entry_price) / entry_price
```

**–§–æ—Ä–º—É–ª–∞ –¥–ª—è SHORT:**
```python
profit_pct = (entry_price - current_price) / entry_price
```

**–£—á–µ—Ç –∫–æ–º–∏—Å—Å–∏–π:**
- ‚úÖ –ï—Å–ª–∏ `include_fees=True`: –≤—ã—á–∏—Ç–∞–µ—Ç—Å—è –∫–æ–º–∏—Å—Å–∏—è –≤—Ö–æ–¥–∞ –∏ –≤—ã—Ö–æ–¥–∞
- ‚úÖ –ö–æ–º–∏—Å—Å–∏—è —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ `trading_fee_rate * 2` (–≤—Ö–æ–¥ + –≤—ã—Ö–æ–¥)

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –¥—Ä—É–≥–∏—Ö –º–æ–¥—É–ª—è—Ö:**
- ‚úÖ `position_manager.py` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `tsl.get_profit_pct()` ‚úÖ
- ‚úÖ `trailing_sl_coordinator.py` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `tsl.get_profit_pct()` ‚úÖ

**–í—ã–≤–æ–¥:** ‚úÖ –†–∞—Å—á–µ—Ç PnL –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –¥–ª—è LONG –∏ SHORT –ø–æ–∑–∏—Ü–∏–π –≤–æ –≤—Å–µ—Ö –º–æ–¥—É–ª—è—Ö.

---

## üîç –ê–ù–ê–õ–ò–ó –ü–†–û–ë–õ–ï–ú–´ ETH-USDT SHORT

### –î–∞–Ω–Ω—ã–µ:
- **–°–∏–≥–Ω–∞–ª:** ETH-USDT SHORT @ $2813.49 (—Å–∏–ª–∞=0.56)
- **–¶–µ–Ω–∞ –≤—Ö–æ–¥–∞:** 2816.28 USDT
- **–¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞:** 2843.81 USDT
- **PnL:** -1.76 USDT (-4.87% –æ—Ç –º–∞—Ä–∂–∏)

### –ê–Ω–∞–ª–∏–∑:

**1. –ü–æ—á–µ–º—É —Å–∏–≥–Ω–∞–ª –±—ã–ª SHORT –ø—Ä–∏ —Ä–æ—Å—Ç–µ —Ü–µ–Ω—ã?**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ `price_direction != "up"` —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤ `signal_generator.py`
- ‚ö†Ô∏è –í–æ–∑–º–æ–∂–Ω–∞ –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π —Å–∏–≥–Ω–∞–ª–∞ –∏ –æ—Ç–∫—Ä—ã—Ç–∏–µ–º –ø–æ–∑–∏—Ü–∏–∏
- ‚ö†Ô∏è EMA –º–æ–≥–ª–∞ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–∞–¥–µ–Ω–∏–µ, –Ω–æ —Ü–µ–Ω–∞ —É–∂–µ –Ω–∞—á–∞–ª–∞ —Ä–∞—Å—Ç–∏

**2. –†–∞—Å—á–µ—Ç PnL:**
- ‚úÖ –§–æ—Ä–º—É–ª–∞ –¥–ª—è SHORT: `(2816.28 - 2843.81) / 2816.28 * 100 = -0.98%` –æ—Ç —Ü–µ–Ω—ã
- ‚úÖ –° –ª–µ–≤–µ—Ä–∏–¥–∂–µ–º 5x: `-0.98% * 5 = -4.9%` –æ—Ç –º–∞—Ä–∂–∏ ‚âà -4.87% ‚úÖ
- ‚úÖ –í USD: `(2816.28 - 2843.81) * 0.064 = -1.76 USDT` ‚úÖ

**–í—ã–≤–æ–¥:** ‚úÖ –†–∞—Å—á–µ—Ç PnL –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π. –ü–æ–∑–∏—Ü–∏—è –≤ –º–∏–Ω—É—Å–µ –∏–∑-–∑–∞ —Ä–æ—Å—Ç–∞ —Ü–µ–Ω—ã –ø–æ—Å–ª–µ –æ—Ç–∫—Ä—ã—Ç–∏—è SHORT –ø–æ–∑–∏—Ü–∏–∏.

---

## ‚úÖ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### 1. –õ–æ–≥–∏–∫–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤ ‚úÖ

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è
**–ú–æ–¥—É–ª—å:** `signal_generator.py` (–º–µ—Ç–æ–¥ `_check_ma_signal`)
**–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è:** ‚úÖ –°–∏–≥–Ω–∞–ª—ã —Ñ–∏–ª—å—Ç—Ä—É—é—Ç—Å—è –ø–æ `price_direction` –ø–µ—Ä–µ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** ‚úÖ –õ–æ–≥–∏–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è, –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è.

---

### 2. –†–∞—Å—á–µ—Ç PnL ‚úÖ

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π
**–ú–æ–¥—É–ª—å:** `trailing_stop_loss.py` (–º–µ—Ç–æ–¥ `get_profit_pct`)
**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:** ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–æ –≤—Å–µ—Ö –º–æ–¥—É–ª—è—Ö

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** ‚úÖ –†–∞—Å—á–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π, –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è.

---

### 3. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –æ—Ç–∫—Ä—ã—Ç–∏–µ–º ‚ö†Ô∏è

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π —Å–∏–≥–Ω–∞–ª–∞ –∏ –æ—Ç–∫—Ä—ã—Ç–∏–µ–º –ø–æ–∑–∏—Ü–∏–∏
- EMA –º–æ–∂–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –æ–¥–Ω–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ, –∞ —Ü–µ–Ω–∞ —É–∂–µ –¥–≤–∏–∂–µ—Ç—Å—è –≤ –¥—Ä—É–≥–æ–º

**–†–µ—à–µ–Ω–∏–µ:**
- ‚ö†Ô∏è –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –æ—Ç–∫—Ä—ã—Ç–∏–µ–º –ø–æ–∑–∏—Ü–∏–∏
- ‚ö†Ô∏è –ù–æ —ç—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ñ–∏–ª—å—Ç—Ä–µ –∏–ª–∏ –≤ `signal_generator.py`, –∞ –Ω–µ –≤ `signal_coordinator.py`
- ‚ö†Ô∏è –ò–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –≤ `signal_coordinator.py` –ø–µ—Ä–µ–¥ –æ—Ç–∫—Ä—ã—Ç–∏–µ–º –ø–æ–∑–∏—Ü–∏–∏

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** ‚ö†Ô∏è –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å, –Ω–æ —ç—Ç–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ, —Ç–∞–∫ –∫–∞–∫ –ø—Ä–æ–≤–µ—Ä–∫–∞ —É–∂–µ –µ—Å—Ç—å –≤ `signal_generator.py`.

---

## ‚úÖ –í–´–í–û–î–´

### –õ–æ–≥–∏–∫–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤:
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ `price_direction` –≤ `signal_generator.py`
- ‚úÖ –°–∏–≥–Ω–∞–ª—ã –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –µ—Å–ª–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω—ã –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å–∏–≥–Ω–∞–ª—É
- ‚úÖ –í–æ–∑–º–æ–∂–Ω–∞ –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π —Å–∏–≥–Ω–∞–ª–∞ –∏ –æ—Ç–∫—Ä—ã—Ç–∏–µ–º –ø–æ–∑–∏—Ü–∏–∏ (—ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ)

### –†–∞—Å—á–µ—Ç PnL:
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç –¥–ª—è LONG –∏ SHORT –ø–æ–∑–∏—Ü–∏–π
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —É—á–µ—Ç –∫–æ–º–∏—Å—Å–∏–π
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —É—á–µ—Ç –ª–µ–≤–µ—Ä–∏–¥–∂–∞
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–æ –≤—Å–µ—Ö –º–æ–¥—É–ª—è—Ö

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
- ‚úÖ –õ–æ–≥–∏–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è, –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è
- ‚ö†Ô∏è –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –æ—Ç–∫—Ä—ã—Ç–∏–µ–º, –Ω–æ —ç—Ç–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –õ–û–ì–ò–ö–ê –ü–†–ê–í–ò–õ–¨–ù–ê–Ø, –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–• –ò–ó–ú–ï–ù–ï–ù–ò–ô –ù–ï –¢–†–ï–ë–£–ï–¢–°–Ø

