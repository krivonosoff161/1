# üìä –ü–û–õ–ù–´–ô –ê–ù–ê–õ–ò–ó –¢–û–†–ì–û–í–´–• –ü–û–ó–ò–¶–ò–ô - 30.12.2025

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** 30.12.2025  
**–ü–µ—Ä–∏–æ–¥ –∞–Ω–∞–ª–∏–∑–∞:** 00:00 - 05:56 UTC  
**–í—Å–µ–≥–æ –ø–æ–∑–∏—Ü–∏–π:** 28  
**–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö:** `logs/futures/archived/logs_2025-12-30_08-56-56/all_data_2025-12-29.csv`

---

## üìã –î–ê–ù–ù–´–ï –î–õ–Ø –ê–ù–ê–õ–ò–ó–ê

### 1. –¢–æ—Ä–≥–æ–≤—ã–µ –ø–æ–∑–∏—Ü–∏–∏ (30.12.2025)

| –ü–∞—Ä–∞ | –í—Ä–µ–º—è | –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ | Entry | Exit | –†–∞–∑–º–µ—Ä | Gross PnL | –ö–æ–º–∏—Å—Å–∏—è | Net PnL | –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å | –ü—Ä–∏—á–∏–Ω–∞ | Win Rate |
|------|------|-------------|-------|------|--------|-----------|----------|---------|--------------|---------|----------|
| BTC-USDT | 00:00:05 | SHORT | 87716.69 | 87846.90 | 0.0028 | -0.36 | 0.25 | -0.56 | 112 —Å–µ–∫ | sl_reached | 14.29% |
| BTC-USDT | 00:25:39 | LONG | 87729.80 | 87617.80 | 0.0028 | -0.31 | 0.25 | -0.56 | 148 —Å–µ–∫ | sl_reached | 12.50% |
| BTC-USDT | 00:29:03 | LONG | 87707.80 | 87610.20 | 0.0028 | -0.27 | 0.25 | -0.52 | 87 —Å–µ–∫ | sl_reached | 11.11% |
| BTC-USDT | 00:34:44 | LONG | 87447.50 | 87598.50 | 0.0028 | +0.42 | 0.25 | +0.18 | 263 —Å–µ–∫ | tp_reached | 20.00% |
| XRP-USDT | 00:33:57 | SHORT | 1.8301 | 1.8164 | 131 | +1.79 | 0.24 | +1.55 | 9806 —Å–µ–∫ | tp_reached | 27.27% |
| XRP-USDT | 02:44:50 | SHORT | 1.7631 | 1.7682 | 133 | -0.68 | 0.23 | -0.91 | 143 —Å–µ–∫ | emergency_loss_protection | 25.00% |
| SOL-USDT | 03:51:16 | SHORT | 123.98 | 124.38 | 2.1 | -0.84 | 0.26 | -1.10 | 63 —Å–µ–∫ | emergency_loss_protection | 23.08% |
| SOL-USDT | 04:00:44 | SHORT | 124.22 | 123.76 | 2.11 | +0.97 | 0.26 | +0.71 | 168 —Å–µ–∫ | tp_reached | 28.57% |
| ETH-USDT | 04:26:33 | SHORT | 2955.12 | 2977.18 | 0.084 | -1.85 | 0.25 | -2.10 | 32 —Å–µ–∫ | sl_reached | 26.67% |
| ETH-USDT | 04:28:51 | SHORT | 2956.55 | 2962.88 | 0.084 | -0.53 | 0.25 | -0.78 | 50 —Å–µ–∫ | sl_reached | 25.00% |
| ETH-USDT | 04:40:50 | SHORT | 2986.69 | 2958.06 | 0.084 | +2.41 | 0.25 | +2.16 | 31 —Å–µ–∫ | tp_reached | 29.41% |
| ETH-USDT | 04:42:37 | SHORT | 2955.30 | 2959.34 | 0.084 | -0.34 | 0.25 | -0.59 | 36 —Å–µ–∫ | sl_reached | 27.78% |
| ETH-USDT | 04:44:25 | SHORT | 2964.89 | 2970.45 | 0.084 | -0.47 | 0.25 | -0.72 | 42 —Å–µ–∫ | sl_reached | 26.32% |
| ETH-USDT | 04:54:07 | SHORT | 2971.00 | 2959.43 | 0.084 | +0.97 | 0.25 | +0.72 | 563 —Å–µ–∫ | tp_reached | 30.00% |
| ETH-USDT | 04:57:48 | SHORT | 2958.94 | 2964.14 | 0.084 | -0.44 | 0.25 | -0.69 | 46 —Å–µ–∫ | sl_reached | 28.57% |
| XRP-USDT | 05:01:28 | LONG | 1.8294 | 1.8153 | 131 | -1.85 | 0.24 | -2.08 | 493 —Å–µ–∫ | emergency_loss_protection | 27.27% |
| ETH-USDT | 05:05:05 | SHORT | 2949.99 | 2954.91 | 0.084 | -0.41 | 0.25 | -0.66 | 483 —Å–µ–∫ | sl_reached | 26.09% |
| ETH-USDT | 05:08:53 | SHORT | 2950.00 | 2979.70 | 0.084 | -2.49 | 0.25 | -2.74 | 36 —Å–µ–∫ | sl_reached | 25.00% |
| XRP-USDT | 05:12:49 | LONG | 1.8819 | 1.8607 | 131 | -2.78 | 0.25 | -3.02 | 29 —Å–µ–∫ | profit_harvest | 24.00% |
| XRP-USDT | 05:17:58 | LONG | 1.9007 | 1.8770 | 128 | -3.03 | 0.24 | -3.27 | 65 —Å–µ–∫ | emergency_loss_protection | 23.08% |
| XRP-USDT | 05:24:08 | LONG | 1.9414 | 1.9397 | 127 | -0.22 | 0.25 | -0.47 | 65 —Å–µ–∫ | emergency_loss_protection | 22.22% |
| XRP-USDT | 05:31:06 | SHORT | 1.8573 | 1.8674 | 126 | -1.27 | 0.23 | -1.51 | 67 —Å–µ–∫ | emergency_loss_protection | 21.43% |
| XRP-USDT | 05:33:35 | LONG | 1.9416 | 1.9439 | 126 | +0.29 | 0.24 | +0.05 | 16 —Å–µ–∫ | tp_reached | 24.14% |
| XRP-USDT | 05:35:33 | LONG | 1.8544 | 1.8582 | 124 | +0.47 | 0.23 | +0.24 | 4 —Å–µ–∫ | tp_reached | 26.67% |
| XRP-USDT | 05:43:49 | LONG | 1.7871 | 1.7941 | 126 | +0.88 | 0.23 | +0.66 | 6 —Å–µ–∫ | tp_reached | 29.03% |
| XRP-USDT | 05:44:25 | LONG | 1.7823 | 1.7641 | 125 | -2.28 | 0.22 | -2.50 | 66 —Å–µ–∫ | emergency_loss_protection | 28.12% |
| XRP-USDT | 05:55:29 | SHORT | 1.8090 | 1.8139 | 125 | -0.61 | 0.23 | -0.84 | 321 —Å–µ–∫ | emergency_loss_protection | 27.27% |
| ETH-USDT | 05:55:53 | LONG | 2955.60 | 2965.58 | 0.083 | +0.83 | 0.25 | +0.58 | 24 —Å–µ–∫ | tp_reached | 29.41% |

---

## üîç –ê–ù–ê–õ–ò–ó –ö–ê–ñ–î–û–ô –ü–û–ó–ò–¶–ò–ò

### –ü–û–ó–ò–¶–ò–Ø 1: XRPUSDT | 30.12.2025, 05:44:25 UTC

**–ë–ê–ó–û–í–´–ï –î–ê–ù–ù–´–ï:**

**–¶–ò–¢–ê–¢–ê –ò–ó CSV:**
```
trades,2025-12-30T05:45:31.647997+00:00,XRP-USDT,long,1.7823,1.7641,125.00000000,-2.2750,0.2217,-2.4966,65.655997,emergency_loss_protection,28.12,,,,,,,,,,,,,,
```

**–¶–ò–¢–ê–¢–ê –ò–ó –î–ê–ù–ù–´–• –ë–ò–†–ñ–ò:**
```
30.12.2025, 08:44:25 | XRPUSDT | LONG | –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è (10x)
–í—Ö–æ–¥–Ω–∞—è —Ü–µ–Ω–∞: 1,7823
–¶–µ–Ω–∞ –≤—ã—Ö–æ–¥–∞: 1,7637
–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ PnL: -2,49 USDT (-11,14 %)
–ó–∞–∫—Ä—ã—Ç—ã–µ PnL: -2,33 USDT
–ö–æ–º–∏—Å—Å–∏—è: -0,15 USDT
–ö–æ–º–∏—Å—Å–∏—è –∑–∞ —Ñ–∏–Ω–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–∏–µ: 0 USDT
–°—É–º–º–∞ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π: 125 XRP
–ó–∞–∫—Ä—ã—Ç–æ: 125 XRP
–í—Ä–µ–º—è –≤ –∑–∞–∫—Ä—ã—Ç–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏: 30.12.2025, 08:45:37
```

**–°–†–ê–í–ù–ï–ù–ò–ï –î–ê–ù–ù–´–•:**

| –ü–∞—Ä–∞–º–µ—Ç—Ä | CSV | –ë–∏—Ä–∂–∞ | –†–∞–∑–Ω–∏—Ü–∞ |
|----------|-----|-------|---------|
| –í—Ö–æ–¥–Ω–∞—è —Ü–µ–Ω–∞ | 1.7823 | 1.7823 | ‚úÖ –°–æ–≤–ø–∞–¥–∞–µ—Ç |
| –¶–µ–Ω–∞ –≤—ã—Ö–æ–¥–∞ | 1.7641 | 1.7637 | ‚ö†Ô∏è –†–∞–∑–Ω–∏—Ü–∞ 0.0004 (0.02%) |
| Gross PnL | -2.2750 | -2.49 (—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π) | ‚ö†Ô∏è –†–∞–∑–Ω–∏—Ü–∞ 0.215 |
| Net PnL | -2.4966 | -2.33 (–∑–∞–∫—Ä—ã—Ç—ã–π) | ‚ö†Ô∏è –†–∞–∑–Ω–∏—Ü–∞ 0.1666 |
| –ö–æ–º–∏—Å—Å–∏—è | 0.2217 | 0.15 | ‚ö†Ô∏è –†–∞–∑–Ω–∏—Ü–∞ 0.0717 |
| –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å | 65.66 —Å–µ–∫ | 72 —Å–µ–∫ (08:44:25 ‚Üí 08:45:37) | ‚ö†Ô∏è –†–∞–∑–Ω–∏—Ü–∞ 6.34 —Å–µ–∫ |
| –ü–ª–µ—á–æ | 10x | 10x (–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ –¥–∞–Ω–Ω—ã–º–∏ –±–∏—Ä–∂–∏) | ‚úÖ –°–æ–≤–ø–∞–¥–∞–µ—Ç |
| –†–∞–∑–º–µ—Ä | 125 XRP | 125 XRP | ‚úÖ –°–æ–≤–ø–∞–¥–∞–µ—Ç |

**–¢–û–ß–ù–´–ô –ê–ù–ê–õ–ò–ó:**

1. **–†–∞–∑–Ω–∏—Ü–∞ –≤ —Ü–µ–Ω–µ –≤—ã—Ö–æ–¥–∞:** CSV –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 1.7641, –±–∏—Ä–∂–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 1.7637. –†–∞–∑–Ω–∏—Ü–∞ 0.0004 (0.02%).

**–¶–ò–¢–ê–¢–ê –ò–ó –ö–û–î–ê (–†–∞—Å—á–µ—Ç slippage):**

```1775:1775:src/strategies/scalping/futures/signal_generator.py
def _adjust_price_for_slippage(self, price: float, side: str) -> float:
    slippage_percent = 0.001  # 0.1% slippage buffer
    if side.lower() == "buy":
        return price * (1 + slippage_percent)
    else:
        return price * (1 - slippage_percent)
```

**–¢–û–ß–ù–´–ô –†–ê–°–ß–ï–¢:**
- –¶–µ–Ω–∞ –∑–∞–∫—Ä—ã—Ç–∏—è –≤ CSV: 1.7641
- –¶–µ–Ω–∞ –∑–∞–∫—Ä—ã—Ç–∏—è –Ω–∞ –±–∏—Ä–∂–µ: 1.7637
- –†–∞–∑–Ω–∏—Ü–∞: 0.0004 = 0.02% –æ—Ç —Ü–µ–Ω—ã
- **–ü–†–ò–ß–ò–ù–ê:** Slippage –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –ø–æ–∑–∏—Ü–∏–∏ —á–µ—Ä–µ–∑ MARKET –æ—Ä–¥–µ—Ä (0.1% slippage buffer –≤ –∫–æ–¥–µ) + —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É —Ü–µ–Ω–æ–π –æ—Ä–¥–µ—Ä–∞ –∏ —Ü–µ–Ω–æ–π –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è

2. **–†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É Realized PnL –∏ Closed PnL:**
   - **Realized PnL** (-2.49 USDT) = Gross PnL –±–µ–∑ –∫–æ–º–∏—Å—Å–∏–π
   - **Closed PnL** (-2.33 USDT) = Realized PnL - –ö–æ–º–∏—Å—Å–∏—è = -2.49 - 0.15 = -2.34 USDT (–æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ)
   - –†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É Realized –∏ Closed: 0.16 USDT = –∫–æ–º–∏—Å—Å–∏—è

3. **–†–∞–∑–Ω–∏—Ü–∞ –≤ –∫–æ–º–∏—Å—Å–∏–∏:**
   - CSV: 0.2217 USDT
   - –ë–∏—Ä–∂–∞: 0.15 USDT
   - –†–∞–∑–Ω–∏—Ü–∞: 0.0717 USDT (32% –±–æ–ª—å—à–µ –≤ CSV)
   - **–ü–†–û–ë–õ–ï–ú–ê:** –ö–æ–º–∏—Å—Å–∏—è –≤ CSV —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏–ª–∏ –≤–∫–ª—é—á–∞–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã

4. **–†–∞–∑–Ω–∏—Ü–∞ –≤ Net PnL:**
   - CSV: -2.4966 USDT
   - –ë–∏—Ä–∂–∞ (Closed PnL): -2.33 USDT
   - –†–∞–∑–Ω–∏—Ü–∞: 0.1666 USDT
   - **–ü–†–û–ë–õ–ï–ú–ê:** Net PnL –≤ CSV –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç Closed PnL –Ω–∞ –±–∏—Ä–∂–µ

**1. –ì–ï–ù–ï–†–ê–¶–ò–Ø –°–ò–ì–ù–ê–õ–ê (signal_generator.py):**

```150:200:src/strategies/scalping/futures/signal_generator.py
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ SignalGenerator.generate_signal()
# –°–∏–≥–Ω–∞–ª –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤: RSI, MACD, ADX, Bollinger Bands
```

**–¶–ò–¢–ê–¢–ê –ò–ó –õ–û–ì–û–í (05:43:43):**
```
2025-12-30 05:43:43.703 | DEBUG | src.strategies.scalping.futures.signal_generator:_generate_base_signals:2103 | ‚úÖ ADX –¥–ª—è XRP-USDT –ø–æ–ª—É—á–µ–Ω –∏–∑ DataRegistry: ADX=74.52, +DI=25.75, -DI=74.25
2025-12-30 05:43:43.703 | DEBUG | src.strategies.scalping.futures.signal_generator:_generate_base_signals:2181 | üìä ADX —Ç—Ä–µ–Ω–¥ –¥–ª—è XRP-USDT: bearish, ADX=74.5, +DI=25.7, -DI=74.3 (–∏—Å—Ç–æ—á–Ω–∏–∫: DataRegistry)
2025-12-30 05:43:43.719 | DEBUG | src.strategies.scalping.futures.signal_generator:_generate_ma_signals:4778 | ‚úÖ MA BEARISH —Å–∏–≥–Ω–∞–ª –¥–ª—è XRP-USDT: EMA_12(1.80) < EMA_26(1.80), —Ü–µ–Ω–∞(1.79) < EMA_12, –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ=down, strength=1.0000
2025-12-30 05:43:43.719 | DEBUG | src.strategies.scalping.futures.signal_generator:_generate_base_signals:2290 | üìä XRP-USDT: –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω SHORT —Å–∏–≥–Ω–∞–ª –Ω–∞ –æ—Å–Ω–æ–≤–µ ADX bearish —Ç—Ä–µ–Ω–¥–∞ (ADX=74.5, -DI=74.3, +DI=25.7, strength=1.000)
2025-12-30 05:43:43.719 | DEBUG | src.strategies.scalping.futures.signal_generator:_generate_base_signals:2313 | üìä XRP-USDT: –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ 3 —Å–∏–≥–Ω–∞–ª–æ–≤ (MACD=1, MA=1, ADX=1)
```

**–¶–ò–¢–ê–¢–ê –ò–ó CSV:**
```
signals,2025-12-30T05:44:19.721879,XRP-USDT,buy,,,,,,,,,,ranging,,,1.90790600,1.0000,"ADX,MTF,Correlation,PivotPoints,VolumeProfile,Liquidity,OrderFlow,FundingRate",0,,,,,,,
```

**–ê–Ω–∞–ª–∏–∑:** 
- –í –ª–æ–≥–∞—Ö –≤–∏–¥–Ω–æ, —á—Ç–æ –≤ 05:43:43 –±—ã–ª —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω **SHORT** —Å–∏–≥–Ω–∞–ª —Å —Å–∏–ª–æ–π 1.0 –Ω–∞ –æ—Å–Ω–æ–≤–µ ADX bearish —Ç—Ä–µ–Ω–¥–∞ (ADX=74.5)
- –ù–æ –≤ CSV –ø–æ–∫–∞–∑–∞–Ω **BUY** —Å–∏–≥–Ω–∞–ª –≤ 05:44:19 –ø–æ —Ü–µ–Ω–µ 1.9079
- –ü–æ–∑–∏—Ü–∏—è –±—ã–ª–∞ –æ—Ç–∫—Ä—ã—Ç–∞ LONG –ø–æ —Ü–µ–Ω–µ 1.7823, —á—Ç–æ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –Ω–∏–∂–µ —Ü–µ–Ω—ã —Å–∏–≥–Ω–∞–ª–∞ 1.9079
- **–ü–†–û–ë–õ–ï–ú–ê:** –ü—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–µ –º–µ–∂–¥—É SHORT —Å–∏–≥–Ω–∞–ª–æ–º –≤ –ª–æ–≥–∞—Ö (05:43:43) –∏ LONG –ø–æ–∑–∏—Ü–∏–µ–π –≤ CSV (05:44:27). –í –ª–æ–≥–∞—Ö –≤–∏–¥–Ω–æ SHORT —Å–∏–≥–Ω–∞–ª —Å —Å–∏–ª–æ–π 1.0 –Ω–∞ –æ—Å–Ω–æ–≤–µ ADX bearish —Ç—Ä–µ–Ω–¥–∞, –Ω–æ –ø–æ–∑–∏—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç–∞ LONG. –≠—Ç–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –æ—à–∏–±–∫—É –≤ –ª–æ–≥–∏–∫–µ –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏ –∏–ª–∏ –≤ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–∏.

**2. –û–ü–†–ï–î–ï–õ–ï–ù–ò–ï –†–ï–ñ–ò–ú–ê –†–´–ù–ö–ê (regime_manager.py):**

–†–µ–∂–∏–º: `ranging` (–∏–∑ CSV)

```45:120:src/strategies/scalping/futures/adaptivity/regime_manager.py
# –†–µ–∂–∏–º –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ ADX, –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ –∏ —Å–∏–ª—ã —Ç—Ä–µ–Ω–¥–∞
# –í ranging —Ä–µ–∂–∏–º–µ ADX < 25, –Ω–∏–∑–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å
```

**–¶–ò–¢–ê–¢–ê –ò–ó –õ–û–ì–û–í (05:43:43):**
```
2025-12-30 05:43:43.703 | DEBUG | src.strategies.scalping.futures.signal_generator:_generate_base_signals:2103 | ‚úÖ ADX –¥–ª—è XRP-USDT –ø–æ–ª—É—á–µ–Ω –∏–∑ DataRegistry: ADX=74.52, +DI=25.75, -DI=74.25
2025-12-30 05:43:43.703 | DEBUG | src.strategies.scalping.futures.signal_generator:_generate_base_signals:2181 | üìä ADX —Ç—Ä–µ–Ω–¥ –¥–ª—è XRP-USDT: bearish, ADX=74.5, +DI=25.7, -DI=74.3 (–∏—Å—Ç–æ—á–Ω–∏–∫: DataRegistry)
```

**–¶–ò–¢–ê–¢–ê –ò–ó –õ–û–ì–û–í (05:44:44):**
```
2025-12-30 05:44:44.825 | INFO | src.strategies.scalping.futures.adaptivity.regime_manager:detect_regime:345 | üß† Regime scoring for XRP-USDT: CHOPPY=0.40, TRENDING=0.46, RANGING=0.33, selected=TRENDING (confidence=52.8%), ADX=23.7, volatility=10.49%, trend_deviation=127.87%, volume_ratio=1.00x
```

**–ê–Ω–∞–ª–∏–∑:** 
- –í 05:43:43 ADX=74.5 –ø–æ–∫–∞–∑—ã–≤–∞–ª **bearish** —Ç—Ä–µ–Ω–¥ (—Å–∏–ª—å–Ω—ã–π –Ω–∏—Å—Ö–æ–¥—è—â–∏–π —Ç—Ä–µ–Ω–¥)
- –í 05:44:44 —Ä–µ–∂–∏–º –±—ã–ª –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –∫–∞–∫ **TRENDING** (–Ω–µ ranging!), —Ö–æ—Ç—è –≤ CSV —É–∫–∞–∑–∞–Ω ranging
- **–ü–†–û–ë–õ–ï–ú–ê:** –†–µ–∂–∏–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ - ADX=74.5 —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —Å–∏–ª—å–Ω—ã–π —Ç—Ä–µ–Ω–¥, –Ω–æ —Å–∏—Å—Ç–µ–º–∞ –æ–ø—Ä–µ–¥–µ–ª–∏–ª–∞ –µ–≥–æ –∫–∞–∫ ranging. –°–∏–≥–Ω–∞–ª LONG –≤ –Ω–∏—Å—Ö–æ–¥—è—â–µ–º —Ç—Ä–µ–Ω–¥–µ –ø—Ä–∏–≤–µ–ª –∫ —É–±—ã—Ç–∫—É -11.14%.

**3. –ü–†–ò–ú–ï–ù–ï–ù–ò–ï –§–ò–õ–¨–¢–†–û–í:**

**–¶–ò–¢–ê–¢–ê –ò–ó –õ–û–ì–û–í (05:43:43):**
```
2025-12-30 05:43:43.703 | WARNING | src.strategies.scalping.futures.signal_generator:_generate_bollinger_signals:3906 | üö´ BB OVERSOLD —Å–∏–≥–Ω–∞–ª –ü–û–õ–ù–û–°–¢–¨–Æ –ó–ê–ë–õ–û–ö–ò–†–û–í–ê–ù –¥–ª—è XRP-USDT: ADX=74.5 >= 20 –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∏—Å—Ö–æ–¥—è—â–∏–π —Ç—Ä–µ–Ω–¥ (–ø—Ä–æ—Ç–∏–≤ —Ç—Ä–µ–Ω–¥–∞). –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: —Ü–µ–Ω–∞=1.79, lower=1.79, middle=1.80, upper=1.81, ADX=74.5 (bearish), EMA_12=1.80, EMA_26=1.80
2025-12-30 05:43:43.703 | DEBUG | src.strategies.scalping.futures.signals.rsi_signal_generator:generate_signals:251 | üö´ RSI OVERSOLD —Å–∏–≥–Ω–∞–ª –û–¢–ú–ï–ù–ï–ù –¥–ª—è XRP-USDT: ADX –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∏—Å—Ö–æ–¥—è—â–∏–π —Ç—Ä–µ–Ω–¥ (ADX=74.5, -DI –¥–æ–º–∏–Ω–∏—Ä—É–µ—Ç)
2025-12-30 05:43:43.735 | INFO | src.strategies.modules.correlation_filter:check_entry:272 | ‚úÖ Correlation Filter ALLOWED: XRP-USDT SHORT (no correlations)
```

**–¶–ò–¢–ê–¢–ê –ò–ó CSV:**
–í—Å–µ —Ñ–∏–ª—å—Ç—Ä—ã –ø—Ä–æ—à–ª–∏: `ADX,MTF,Correlation,PivotPoints,VolumeProfile,Liquidity,OrderFlow,FundingRate`

**–ê–Ω–∞–ª–∏–∑:**
- –í –ª–æ–≥–∞—Ö –≤–∏–¥–Ω–æ, —á—Ç–æ **BB OVERSOLD** –∏ **RSI OVERSOLD** —Å–∏–≥–Ω–∞–ª—ã –±—ã–ª–∏ **–ó–ê–ë–õ–û–ö–ò–†–û–í–ê–ù–´** –∏–∑-–∑–∞ ADX=74.5 (bearish —Ç—Ä–µ–Ω–¥)
- –ù–æ –≤ CSV –ø–æ–∫–∞–∑–∞–Ω–æ, —á—Ç–æ –≤—Å–µ —Ñ–∏–ª—å—Ç—Ä—ã –ø—Ä–æ—à–ª–∏ –¥–ª—è BUY —Å–∏–≥–Ω–∞–ª–∞
- **–ü–†–û–ë–õ–ï–ú–ê:** –ü—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–µ –º–µ–∂–¥—É –ª–æ–≥–∞–º–∏ –∏ CSV. –í –ª–æ–≥–∞—Ö –≤–∏–¥–Ω–æ SHORT —Å–∏–≥–Ω–∞–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω—ã —Ñ–∏–ª—å—Ç—Ä–∞–º–∏, –Ω–æ –≤ CSV –ø–æ–∫–∞–∑–∞–Ω BUY —Å–∏–≥–Ω–∞–ª, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ—à–µ–ª –≤—Å–µ —Ñ–∏–ª—å—Ç—Ä—ã.

**4. –†–ê–°–ß–ï–¢ –†–ê–ó–ú–ï–†–ê –ü–û–ó–ò–¶–ò–ò (position_sizer.py):**

```80:150:src/strategies/scalping/futures/calculations/position_sizer.py
def calculate_position_size(
    self,
    signal: Dict[str, Any],
    balance: float,
    price: float,
    regime: Optional[str] = None,
    leverage: int = 10,
) -> Optional[float]:
    # 1. –ë–∞–∑–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä (–ø—Ä–æ—Ü–µ–Ω—Ç –æ—Ç –±–∞–ª–∞–Ω—Å–∞)
    risk_per_trade = self._get_risk_per_trade(regime, regime_params)
    base_size_usd = balance * risk_per_trade
    
    # 2. –†–µ–∂–∏–º–Ω—ã–π –º–Ω–æ–∂–∏—Ç–µ–ª—å
    regime_multiplier = self._get_default_regime_multiplier(regime)
    # –î–ª—è ranging: 0.9
    
    adjusted_size_usd = base_size_usd * regime_multiplier
    
    # 3. Balance profile boost
    size_boost = balance_params.get("position_size_boost", 1.0)
    adjusted_size_usd = adjusted_size_usd * size_boost
    
    # 4. –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ –º–æ–Ω–µ—Ç—ã
    position_size_coins = adjusted_size_usd / price
    
    return position_size_coins
```

**–¶–ò–¢–ê–¢–ê –ò–ó –õ–û–ì–û–í (05:43:43):**
```
2025-12-30 05:43:43.250 | DEBUG | src.strategies.scalping.futures.config.config_manager:get_balance_profile:999 | üìä –ü—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è –¥–ª—è small: –±–∞–ª–∞–Ω—Å $810.93 ‚Üí —Ä–∞–∑–º–µ—Ä $131.09 (min_balance=$500.00, threshold=$1500.00, size_at_min=$100.00, size_at_max=$200.00)
2025-12-30 05:43:43.250 | DEBUG | src.strategies.scalping.futures.config.config_manager:get_adaptive_risk_params:1607 | üìä –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–∏—Å–∫–∞: —Ä–µ–∂–∏–º=ranging, –ø—Ä–æ—Ñ–∏–ª—å=small, max_loss=1.0%, max_margin=90.0%
```

**–†–∞–∑–º–µ—Ä:** 125 XRP = ~$222.79 USD (–ø—Ä–∏ —Ü–µ–Ω–µ 1.7823)

**–ê–Ω–∞–ª–∏–∑:**
- –ë–∞–ª–∞–Ω—Å: $810.93 (profile=small)
- –ü—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è: –±–∞–ª–∞–Ω—Å $810.93 ‚Üí —Ä–∞–∑–º–µ—Ä $131.09 USD
- –ü—Ä–∏ —Ü–µ–Ω–µ 1.7823: $131.09 / 1.7823 = ~73.5 XRP, –Ω–æ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞–∑–º–µ—Ä 125 XRP
- **–ü–†–û–ë–õ–ï–ú–ê:** –†–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏ (125 XRP = $222.79 USD –ø—Ä–∏ —Ü–µ–Ω–µ 1.7823) –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ä–∞—Å—á–µ—Ç–Ω–æ–º—É —Ä–∞–∑–º–µ—Ä—É ($131.09 USD –∏–∑ –ª–æ–≥–æ–≤). –†–∞–∑–Ω–∏—Ü–∞: $222.79 / $131.09 = 1.7x. –≠—Ç–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —Ç–æ, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–ª–µ—á–æ 10x, –Ω–æ —Ä–∞—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–∞ –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç –ø–ª–µ—á–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥—Ä—É–≥–æ–π –∞–ª–≥–æ—Ä–∏—Ç–º —Ä–∞—Å—á–µ—Ç–∞ —Ä–∞–∑–º–µ—Ä–∞.

**5. –ê–î–ê–ü–¢–ò–í–ù–û–ï –ü–õ–ï–ß–û (adaptive_leverage.py):**

```45:90:src/strategies/scalping/futures/risk/adaptive_leverage.py
async def calculate_leverage(
    self,
    signal: Dict[str, Any],
    regime: Optional[str] = None,
    volatility: Optional[float] = None,
) -> int:
    signal_strength = signal.get("strength", 0.5)  # 1.0 –¥–ª—è —ç—Ç–æ–π –ø–æ–∑–∏—Ü–∏–∏
    
    # –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∂–∏–º–∞ —Ä—ã–Ω–∫–∞
    regime_multiplier = 1.0
    if regime == "ranging":
        regime_multiplier = 0.8  # –í –±–æ–∫–æ–≤–∏–∫–µ –º–µ–Ω—å—à–µ –ª–µ–≤–µ—Ä–∏–¥–∂–∞
    
    # –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏
    volatility_multiplier = 1.0
    if volatility > 0.05:  # –í—ã—Å–æ–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å
        volatility_multiplier = 0.7
    
    adjusted_strength = signal_strength * regime_multiplier * volatility_multiplier
    
    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∫–∞—á–µ—Å—Ç–≤–∞ —Å–∏–≥–Ω–∞–ª–∞
    if adjusted_strength >= 0.9:
        category = "very_strong"
        leverage = 20  # –ù–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ –¥–æ 10x –¥–ª—è ranging
    elif adjusted_strength >= 0.7:
        category = "strong"
        leverage = 10
    ...
    
    # ‚úÖ –ü–†–ê–í–ö–ê #12: –°–Ω–∏–∂–∞–µ–º –ª–µ–≤–µ—Ä–∏–¥–∂ –¥–ª—è ranging (–º–∞–∫—Å–∏–º—É–º 10x)
    if regime == "ranging":
        leverage = min(leverage, 10)
    
    return leverage
```

**–ü—Ä–∏–º–µ–Ω–µ–Ω–Ω–æ–µ –ø–ª–µ—á–æ:** 10x (–º–∞–∫—Å–∏–º—É–º –¥–ª—è ranging —Ä–µ–∂–∏–º–∞)

**–¶–ò–¢–ê–¢–ê –ò–ó –ö–û–î–ê (–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–ª–µ—á–∞ –¥–ª—è ranging):**

```205:207:src/strategies/scalping/futures/risk/adaptive_leverage.py
# ‚úÖ –ü–†–ê–í–ö–ê #12: –°–Ω–∏–∂–∞–µ–º –ª–µ–≤–µ—Ä–∏–¥–∂ –¥–ª—è ranging (–º–∞–∫—Å–∏–º—É–º 10x)
if regime == "ranging":
    leverage = min(leverage, 10)
```

**–ê–Ω–∞–ª–∏–∑:** –ü–ª–µ—á–æ 10x –ø—Ä–∏–º–µ–Ω–µ–Ω–æ —Å–æ–≥–ª–∞—Å–Ω–æ –∫–æ–¥—É (–º–∞–∫—Å–∏–º—É–º –¥–ª—è ranging —Ä–µ–∂–∏–º–∞). –ù–æ –¥–ª—è —Å–∏–≥–Ω–∞–ª–∞ LONG –≤ bearish —Ç—Ä–µ–Ω–¥–µ (ADX=74.5) —ç—Ç–æ –±—ã–ª–æ —Å–ª–∏—à–∫–æ–º –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ, —á—Ç–æ –ø—Ä–∏–≤–µ–ª–æ –∫ —É–±—ã—Ç–∫—É -11.2%.

**6. –£–ü–†–ê–í–õ–ï–ù–ò–ï –ü–û–ó–ò–¶–ò–ï–ô (position_manager.py + exit_analyzer.py):**

**–ü—Ä–∏—á–∏–Ω–∞ –∑–∞–∫—Ä—ã—Ç–∏—è:** `emergency_loss_protection`

```759:1103:src/strategies/scalping/futures/position_manager.py
async def _check_position_safety(self, position: Dict[str, Any]):
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ margin_ratio
    margin_ratio = float(position.get("margin_ratio", "0") or 0)
    
    # ‚úÖ –ó–ê–©–ò–¢–ê #1: –ù–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏–∏, –æ—Ç–∫—Ä—ã—Ç—ã–µ –º–µ–Ω–µ–µ 30 —Å–µ–∫—É–Ω–¥ –Ω–∞–∑–∞–¥
    if time_since_open < 30.0:
        return
    
    # ‚úÖ –ó–ê–©–ò–¢–ê #2: –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —É–±—ã—Ç–æ–∫ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π (> 2% –æ—Ç –º–∞—Ä–∂–∏)
    pnl_percent_from_margin = abs(pnl) / margin * 100
    if pnl_percent_from_margin < 2.0:
        return
    
    # Emergency close –ø—Ä–∏ margin_ratio < 1.2
    if margin_ratio < 1.2:
        await self._emergency_close_position(position)
```

**–¶–ò–¢–ê–¢–ê –ò–ó –ö–û–î–ê (–ü—Ä–æ–≤–µ—Ä–∫–∞ TP/SL):**

```723:755:src/strategies/scalping/futures/position_manager.py
async def manage_position(self, position: Dict[str, Any]):
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ TP/SL
    await self._check_tp_sl(position)
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø–æ–∑–∏—Ü–∏–∏
    await self._check_position_safety(position)
```

**–¶–ò–¢–ê–¢–ê –ò–ó –ö–û–î–ê (–ü—Ä–æ–≤–µ—Ä–∫–∞ SL –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è TSL):**

```78:83:src/strategies/scalping/futures/positions/stop_loss_manager.py
# ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ TSL –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω
if self.orchestrator:
    tsl = self.orchestrator.trailing_sl_coordinator.get_tsl(symbol)
    if tsl:
        return False  # TSL –∞–∫—Ç–∏–≤–µ–Ω - –ø—Ä–æ–≤–µ—Ä–∫–∞ SL –Ω–µ –Ω—É–∂–Ω–∞
```

**–¢–û–ß–ù–´–ô –ê–ù–ê–õ–ò–ó:**

**–ü–æ—á–µ–º—É –ø–æ–∑–∏—Ü–∏—è –Ω–µ –∑–∞–∫—Ä—ã–ª–∞—Å—å –Ω–∞ +2%:**
- –ü–æ–∑–∏—Ü–∏—è –±—ã–ª–∞ –æ—Ç–∫—Ä—ã—Ç–∞ LONG –ø–æ 1.7823
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ –Ω–µ –¥–æ—Å—Ç–∏–≥–ª–∞ TP (–æ–±—ã—á–Ω–æ 2-3% –¥–ª—è ranging)
- –ü–æ–∑–∏—Ü–∏—è —Å—Ä–∞–∑—É –ø–æ—à–ª–∞ –≤ —É–±—ã—Ç–æ–∫ –∏ –¥–æ—Å—Ç–∏–≥–ª–∞ -11.2% –∑–∞ 65 —Å–µ–∫—É–Ω–¥

**–¶–ò–¢–ê–¢–ê –ò–ó –ö–û–î–ê (–ü—Ä–æ–≤–µ—Ä–∫–∞ SL –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è TSL):**

```1446:1452:src/strategies/scalping/futures/position_manager.py
# ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ TSL –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω
if hasattr(self, "orchestrator") and self.orchestrator:
    if hasattr(self.orchestrator, "trailing_sl_coordinator"):
        tsl = self.orchestrator.trailing_sl_coordinator.get_tsl(symbol)
        if tsl:
            # TSL –∞–∫—Ç–∏–≤–µ–Ω - –ø—Ä–æ–≤–µ—Ä–∫–∞ SL –Ω–µ –Ω—É–∂–Ω–∞ (TSL –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–µ–µ)
            return False
```

**–¶–ò–¢–ê–¢–ê –ò–ó –ö–û–î–ê (–ü—Ä–æ–≤–µ—Ä–∫–∞ SL –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è min_holding):**

```1511:1518:src/strategies/scalping/futures/position_manager.py
# ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ–º min_holding –∑–∞—â–∏—Ç—É
if minutes_in_position < min_holding_minutes:
    logger.debug(
        f"‚è±Ô∏è SL –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –¥–ª—è {symbol}: –ø–æ–∑–∏—Ü–∏—è –¥–µ—Ä–∂–∏—Ç—Å—è "
        f"{minutes_in_position:.2f} –º–∏–Ω < {min_holding_minutes:.2f} –º–∏–Ω "
        f"(min_holding –∑–∞—â–∏—Ç–∞ –∞–∫—Ç–∏–≤–Ω–∞, sl_percent={sl_percent:.2f}%)"
    )
    return False  # –ù–ï –∑–∞–∫—Ä—ã–≤–∞–µ–º - min_holding –∑–∞—â–∏—Ç–∞ –∞–∫—Ç–∏–≤–Ω–∞
```

**–¢–û–ß–ù–´–ô –ê–ù–ê–õ–ò–ó:**

**–ü–æ—á–µ–º—É SL –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª:**
1. **TSL –±—ã–ª –∞–∫—Ç–∏–≤–µ–Ω** –∏ –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫—É –æ–±—ã—á–Ω–æ–≥–æ SL (—Å—Ç—Ä–æ–∫–∞ 1450-1452)
2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ SL –±—ã–ª–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞ min_holding:**

**–¶–ò–¢–ê–¢–ê –ò–ó –ö–û–î–ê (min_holding –¥–ª—è ranging):**

```360:360:config/config_futures.yaml
min_holding_minutes: 1.5  # ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï (29.12.2025): –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è —É–¥–µ—Ä–∂–∞–Ω–∏—è –ø–µ—Ä–µ–¥ SL (1.5 –º–∏–Ω—É—Ç—ã = 90 —Å–µ–∫) - –∑–∞—â–∏—Ç–∞ –æ—Ç —à—É–º–∞ –≤ ranging
```

**–¶–ò–¢–ê–¢–ê –ò–ó –ö–û–î–ê (–ü—Ä–æ–≤–µ—Ä–∫–∞ min_holding –≤ stop_loss_manager.py):**

```110:120:src/strategies/scalping/futures/positions/stop_loss_manager.py
# –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è —É–¥–µ—Ä–∂–∞–Ω–∏—è –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º –ø–æ SL (30 —Å–µ–∫—É–Ω–¥)
min_hold_seconds_before_sl = 30.0
if (
    time_since_open is not None
    and time_since_open < min_hold_seconds_before_sl
):
    logger.debug(
        f"‚è±Ô∏è SL –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª—è {symbol}: –ø–æ–∑–∏—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç–∞ {time_since_open:.1f} —Å–µ–∫ –Ω–∞–∑–∞–¥ < {min_hold_seconds_before_sl} —Å–µ–∫, "
        f"–ø—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É SL (–∑–∞—â–∏—Ç–∞ –æ—Ç –ø—Ä–µ–∂–¥–µ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è)"
    )
    return False
```

**–¶–ò–¢–ê–¢–ê –ò–ó –ö–û–î–ê (–ü—Ä–æ–≤–µ—Ä–∫–∞ min_holding –≤ position_manager.py):**

```1511:1518:src/strategies/scalping/futures/position_manager.py
# ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ–º min_holding –∑–∞—â–∏—Ç—É
if minutes_in_position < min_holding_minutes:
    logger.debug(
        f"‚è±Ô∏è SL –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –¥–ª—è {symbol}: –ø–æ–∑–∏—Ü–∏—è –¥–µ—Ä–∂–∏—Ç—Å—è "
        f"{minutes_in_position:.2f} –º–∏–Ω < {min_holding_minutes:.2f} –º–∏–Ω "
        f"(min_holding –∑–∞—â–∏—Ç–∞ –∞–∫—Ç–∏–≤–Ω–∞, sl_percent={sl_percent:.2f}%)"
    )
    return False  # –ù–ï –∑–∞–∫—Ä—ã–≤–∞–µ–º - min_holding –∑–∞—â–∏—Ç–∞ –∞–∫—Ç–∏–≤–Ω–∞
```

**–¢–û–ß–ù–´–ô –†–ê–°–ß–ï–¢:**
- –ü–æ–∑–∏—Ü–∏—è –¥–µ—Ä–∂–∞–ª–∞—Å—å: 65.66 —Å–µ–∫—É–Ω–¥ = 1.09 –º–∏–Ω—É—Ç—ã
- min_holding_minutes –¥–ª—è ranging: 1.5 –º–∏–Ω—É—Ç—ã (90 —Å–µ–∫—É–Ω–¥) –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
- min_hold_seconds_before_sl –≤ stop_loss_manager.py: 30 —Å–µ–∫—É–Ω–¥
- **–í–´–í–û–î:** –ü–æ–∑–∏—Ü–∏—è –¥–µ—Ä–∂–∞–ª–∞—Å—å 65.66 —Å–µ–∫—É–Ω–¥ > 30 —Å–µ–∫—É–Ω–¥ (stop_loss_manager), –Ω–æ < 90 —Å–µ–∫—É–Ω–¥ (min_holding_minutes –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞). –ü—Ä–æ–≤–µ—Ä–∫–∞ SL –≤ stop_loss_manager.py –Ω–µ –±—ã–ª–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞, –Ω–æ –º–æ–≥–ª–∞ –±—ã—Ç—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞ –≤ position_manager.py –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ min_holding_minutes (1.5 –º–∏–Ω—É—Ç—ã).
3. **–ò–õ–ò** –ø—Ä–æ–≤–µ—Ä–∫–∞ SL –Ω–µ –≤—ã–ø–æ–ª–Ω—è–ª–∞—Å—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —á–∞—Å—Ç–æ (–ø–æ–∑–∏—Ü–∏—è –∑–∞–∫—Ä—ã–ª–∞—Å—å —á–µ—Ä–µ–∑ 65 —Å–µ–∫—É–Ω–¥, –∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–≥–ª–∞ –±—ã—Ç—å —Ä–µ–∂–µ)

**–î–∞–Ω–Ω—ã–µ –∏–∑ CSV:**
- –ü–æ–∑–∏—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç–∞: 05:44:27.456935
- –ü–æ–∑–∏—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∞: 05:45:31.647997
- –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 65.66 —Å–µ–∫—É–Ω–¥ = 1.09 –º–∏–Ω—É—Ç—ã

**–ü–æ—á–µ–º—É Emergency Loss Protection —Å—Ä–∞–±–æ—Ç–∞–ª:**
- –í—Ä–µ–º—è —É–¥–µ—Ä–∂–∞–Ω–∏—è: **65.66 —Å–µ–∫—É–Ω–¥** > –º–∏–Ω–∏–º—É–º 60 —Å–µ–∫—É–Ω–¥
- –£–±—ã—Ç–æ–∫: **-11.2%** –æ—Ç –º–∞—Ä–∂–∏ > –ø–æ—Ä–æ–≥ -2.5%
- margin_ratio < 1.2 (–ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ position_manager.py)

**7. –ó–ê–ö–†–´–¢–ò–ï –ü–û–ó–ò–¶–ò–ò (exit_analyzer.py + position_manager.py):**

**Emergency Loss Protection:**

```1299:1400:src/strategies/scalping/futures/position_manager.py
# ‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: –ù–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –µ—Å–ª–∏ margin_ratio –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π
if margin_ratio < 1.2 and margin_ratio > 0:
    # ‚úÖ –ó–ê–©–ò–¢–ê #1: –ù–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏–∏, –æ—Ç–∫—Ä—ã—Ç—ã–µ –º–µ–Ω–µ–µ 30 —Å–µ–∫—É–Ω–¥ –Ω–∞–∑–∞–¥
    if time_since_open < 30.0:
        logger.debug(
            f"‚ö†Ô∏è –ü–æ–∑–∏—Ü–∏—è {symbol} –æ—Ç–∫—Ä—ã—Ç–∞ {time_since_open:.1f} —Å–µ–∫ –Ω–∞–∑–∞–¥, "
            f"–ø—Ä–æ–ø—É—Å–∫–∞–µ–º emergency close (–∑–∞—â–∏—Ç–∞ –æ—Ç –ª–æ–∂–Ω—ã—Ö —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π, margin_ratio={margin_ratio:.2f}%)"
        )
        return
    
    # ‚úÖ –ó–ê–©–ò–¢–ê #2: –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —É–±—ã—Ç–æ–∫ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π (> 2% –æ—Ç –º–∞—Ä–∂–∏)
    pnl_percent_from_margin = abs(pnl) / margin * 100
    if pnl_percent_from_margin < 2.0:
        logger.debug(
            f"‚ö†Ô∏è –ü–æ–∑–∏—Ü–∏—è {symbol} margin_ratio={margin_ratio:.2f}%, –Ω–æ —É–±—ã—Ç–æ–∫ —Ç–æ–ª—å–∫–æ {pnl_percent_from_margin:.2f}% –æ—Ç –º–∞—Ä–∂–∏, "
            f"–ø—Ä–æ–ø—É—Å–∫–∞–µ–º emergency close (–∑–∞—â–∏—Ç–∞ –æ—Ç –ª–æ–∂–Ω—ã—Ö —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π)"
        )
        return
    
    logger.warning(
        f"‚ö†Ô∏è –ü–æ–∑–∏—Ü–∏—è {symbol} –∏–º–µ–µ—Ç –Ω–∏–∑–∫—É—é –º–∞—Ä–∂—É: {margin_ratio:.2f}%. –ó–∞–∫—Ä—ã—Ç–∏–µ... "
    )
    await self._emergency_close_position(position)
```

**Stop Loss –ø—Ä–æ–≤–µ—Ä–∫–∞:**

```46:189:src/strategies/scalping/futures/positions/stop_loss_manager.py
async def check_sl(
    self, position: Dict[str, Any], current_price: Optional[float] = None
) -> bool:
    # ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ó–∞—â–∏—Ç–∞ –æ—Ç –ø—Ä–µ–∂–¥–µ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è
    # –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è —É–¥–µ—Ä–∂–∞–Ω–∏—è –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º –ø–æ SL (30 —Å–µ–∫—É–Ω–¥)
    min_hold_seconds_before_sl = 30.0
    if (
        time_since_open is not None
        and time_since_open < min_hold_seconds_before_sl
    ):
        logger.debug(
            f"‚è±Ô∏è SL –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª—è {symbol}: –ø–æ–∑–∏—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç–∞ {time_since_open:.1f} —Å–µ–∫ –Ω–∞–∑–∞–¥ < {min_hold_seconds_before_sl} —Å–µ–∫, "
            f"–ø—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É SL (–∑–∞—â–∏—Ç–∞ –æ—Ç –ø—Ä–µ–∂–¥–µ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è)"
        )
        return False
    
    # –ü–æ–ª—É—á–∞–µ–º —Ä–µ–∂–∏–º –¥–ª—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–≥–æ SL
    regime = position.get("regime") or "ranging"
    sl_percent = self._get_sl_percent(symbol, regime)
    
    # –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º PnL% –æ—Ç –º–∞—Ä–∂–∏
    pnl_percent_from_margin = (unrealized_pnl / margin_used) * 100
    
    # ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ–º SL
    if pnl_percent_from_margin <= -sl_percent:
        logger.warning(
            f"üö® SL —Å—Ä–∞–±–æ—Ç–∞–ª –¥–ª—è {symbol}: "
            f"PnL={pnl_percent_from_margin:.2f}% <= -{sl_percent:.2f}%"
        )
        await self.close_position_callback(position, "sl")
        return True
```

**–¶–ò–¢–ê–¢–ê –ò–ó –õ–û–ì–û–í (05:43:44):**
```
2025-12-30 05:43:44.376 | DEBUG | src.strategies.scalping.futures.position_manager:_check_profit_drawdown:5086 | üîç [PROFIT_DRAWDOWN] –ù–∞—á–∞–ª–æ –¥–ª—è XRP-USDT | size=1.33, side=short, entry=1.7631, current=1.7664
2025-12-30 05:43:44.376 | DEBUG | src.strategies.scalping.futures.position_manager:_check_profit_drawdown:5110 | üîç [PROFIT_DRAWDOWN] XRP-USDT: –ù–µ—Ç peak_profit_time (peak_profit=$0.0000)
2025-12-30 05:43:44.376 | DEBUG | src.strategies.scalping.futures.position_manager:manage_position:715 | üîÑ [MANAGE_POSITION] XRP-USDT: Profit Drawdown –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º
2025-12-30 05:43:44.376 | DEBUG | src.strategies.scalping.futures.position_manager:manage_position:723 | üîÑ [MANAGE_POSITION] XRP-USDT: –ü—Ä–æ–≤–µ—Ä–∫–∞ TP/SL
```

**–¶–ò–¢–ê–¢–ê –ò–ó CSV:**
```
trades,2025-12-30T05:45:31.647997+00:00,XRP-USDT,long,1.7823,1.7641,125.00000000,-2.2750,0.2217,-2.4966,65.655997,emergency_loss_protection,28.12,,,,,,,,,,,,,,
```

**–¶–ò–¢–ê–¢–ê –ò–ó –õ–û–ì–û–í (05:45:34):**
```
2025-12-30 05:45:34.579 | DEBUG | src.strategies.scalping.futures.signal_generator:_adjust_price_for_slippage:1775 | üí∞ XRP-USDT: –¶–µ–Ω–∞ —Å–∏–≥–Ω–∞–ª–∞ —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∞ –Ω–∞ slippage 0.100% (SELL): 1.790600 ‚Üí 1.788809
```

**–¶–ò–¢–ê–¢–ê –ò–ó CSV (–¢–û–ß–ù–´–ï –î–ê–ù–ù–´–ï):**
```
orders,2025-12-30T05:44:26.198097,XRP-USDT,buy,,,125.00000000,,,,,,,,3173278402955780096,limit,1.85591000,,,,placed,,,,,,
positions_open,2025-12-30T05:44:27.456935,XRP-USDT,long,1.78230000,,125.00000000,,,,,,,ranging,3173278402955780096,limit,,,,,,,,,,,
trades,2025-12-30T05:45:31.647997+00:00,XRP-USDT,long,1.7823,1.7641,125.00000000,-2.2750,0.2217,-2.4966,65.655997,emergency_loss_protection,28.12,,,,,,,,,,,,,,
```

**–¶–ò–¢–ê–¢–ê –ò–ó –ö–û–î–ê (–¢–û–ß–ù–ê–Ø –õ–û–ì–ò–ö–ê emergency_loss_protection):**

```1299:1399:src/strategies/scalping/futures/position_manager.py
if margin_ratio < 1.2 and margin_ratio > 0:
    # ‚úÖ –ó–ê–©–ò–¢–ê #1: –ù–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏–∏, –æ—Ç–∫—Ä—ã—Ç—ã–µ –º–µ–Ω–µ–µ 30 —Å–µ–∫—É–Ω–¥ –Ω–∞–∑–∞–¥
    if time_since_open < 30.0:
        logger.debug(
            f"‚ö†Ô∏è –ü–æ–∑–∏—Ü–∏—è {symbol} –æ—Ç–∫—Ä—ã—Ç–∞ {time_since_open:.1f} —Å–µ–∫ –Ω–∞–∑–∞–¥, "
            f"–ø—Ä–æ–ø—É—Å–∫–∞–µ–º emergency close (–∑–∞—â–∏—Ç–∞ –æ—Ç –ª–æ–∂–Ω—ã—Ö —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π, margin_ratio={margin_ratio:.2f}%)"
        )
        return
    
    # ‚úÖ –ó–ê–©–ò–¢–ê #2: –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —É–±—ã—Ç–æ–∫ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π (> 2% –æ—Ç –º–∞—Ä–∂–∏)
    pnl_percent_from_margin = abs(pnl) / margin * 100
    if pnl_percent_from_margin < 2.0:
        logger.debug(
            f"‚ö†Ô∏è –ü–æ–∑–∏—Ü–∏—è {symbol} margin_ratio={margin_ratio:.2f}%, –Ω–æ —É–±—ã—Ç–æ–∫ —Ç–æ–ª—å–∫–æ {pnl_percent_from_margin:.2f}% –æ—Ç –º–∞—Ä–∂–∏, "
            f"–ø—Ä–æ–ø—É—Å–∫–∞–µ–º emergency close (–∑–∞—â–∏—Ç–∞ –æ—Ç –ª–æ–∂–Ω—ã—Ö —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π)"
        )
        return
    
    logger.warning(
        f"‚ö†Ô∏è –ü–æ–∑–∏—Ü–∏—è {symbol} –∏–º–µ–µ—Ç –Ω–∏–∑–∫—É—é –º–∞—Ä–∂—É: {margin_ratio:.2f}%. –ó–∞–∫—Ä—ã—Ç–∏–µ... "
        f"(–≤—Ä–µ–º—è —É–¥–µ—Ä–∂–∞–Ω–∏—è: {time_since_open:.1f} —Å–µ–∫)"
    )
    await self._emergency_close_position(position)
```

**–¶–ò–¢–ê–¢–ê –ò–ó –ö–û–î–ê (ExitAnalyzer emergency_loss_protection –¥–ª—è RANGING):**

```3768:3827:src/strategies/scalping/futures/positions/exit_analyzer.py
emergency_loss_threshold = -2.5  # –î–ª—è ranging —Ä–µ–∂–∏–º–∞ (–±—ã–ª–æ -1.5)
min_holding_seconds = 60.0  # RANGING: 60 —Å–µ–∫—É–Ω–¥ (1 –º–∏–Ω—É—Ç–∞)

if net_pnl_percent < adjusted_emergency_threshold:
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è —É–¥–µ—Ä–∂–∞–Ω–∏—è
    if holding_seconds < min_holding_seconds:
        logger.debug(
            f"‚è≥ ExitAnalyzer RANGING: Emergency close –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –¥–ª—è {symbol} - "
            f"–≤—Ä–µ–º—è —É–¥–µ—Ä–∂–∞–Ω–∏—è {holding_seconds:.1f}—Å < –º–∏–Ω–∏–º—É–º {min_holding_seconds:.1f}—Å "
            f"(PnL={net_pnl_percent:.2f}% < –ø–æ—Ä–æ–≥={emergency_loss_threshold:.1f}%)"
        )
        return None  # –ù–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º
    
    logger.warning(
        f"üö® ExitAnalyzer RANGING: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —É–±—ã—Ç–æ–∫ {net_pnl_percent:.2f}% –¥–ª—è {symbol} "
        f"(–ø–æ—Ä–æ–≥: {emergency_loss_threshold:.1f}%, —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω: {adjusted_emergency_threshold:.2f}%)"
    )
    return {"action": "close", "reason": "emergency_loss_protection", ...}
```

**–¢–û–ß–ù–´–ô –ê–ù–ê–õ–ò–ó:**

**–î–∞–Ω–Ω—ã–µ –∏–∑ CSV:**
- –ü–æ–∑–∏—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç–∞: 05:44:27.456935
- –ü–æ–∑–∏—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∞: 05:45:31.647997
- –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 65.66 —Å–µ–∫—É–Ω–¥
- Gross PnL: -2.2750 USDT
- Net PnL: -2.4966 USDT
- –ü—Ä–∏—á–∏–Ω–∞: `emergency_loss_protection`

**–†–∞—Å—á–µ—Ç PnL%:**
- Entry: 1.7823, Exit: 1.7641
- PnL% –æ—Ç —Ü–µ–Ω—ã: (1.7641 - 1.7823) / 1.7823 √ó 100 = **-1.02%**
- –ù–æ Net PnL = -2.4966 USDT –ø—Ä–∏ —Ä–∞–∑–º–µ—Ä–µ 125 XRP √ó 1.7823 = $222.79
- PnL% –æ—Ç –º–∞—Ä–∂–∏: -2.4966 / ($222.79 / 10 leverage) √ó 100 = **-11.2%** (–æ—Ç –º–∞—Ä–∂–∏)

**–ü–û–ß–ï–ú–£ SL –ù–ï –°–†–ê–ë–û–¢–ê–õ:**

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ SL –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è TSL** (—Å—Ç—Ä–æ–∫–∞ 83 –≤ stop_loss_manager.py):
   ```python
   if tsl:
       return False  # TSL –∞–∫—Ç–∏–≤–µ–Ω - –ø—Ä–æ–≤–µ—Ä–∫–∞ SL –Ω–µ –Ω—É–∂–Ω–∞
   ```
   –ï—Å–ª–∏ TSL –±—ã–ª –∞–∫—Ç–∏–≤–µ–Ω, –æ–±—ã—á–Ω—ã–π SL –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–ª—Å—è.

2. **Emergency Loss Protection —Å—Ä–∞–±–æ—Ç–∞–ª –≤–º–µ—Å—Ç–æ SL:**
   - –ü–æ—Ä–æ–≥ emergency_loss_protection –¥–ª—è RANGING: **-2.5%** (—Å—Ç—Ä–æ–∫–∞ 3752)
   - –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è —É–¥–µ—Ä–∂–∞–Ω–∏—è: **60 —Å–µ–∫—É–Ω–¥** (—Å—Ç—Ä–æ–∫–∞ 3767)
   - –ü–æ–∑–∏—Ü–∏—è –∑–∞–∫—Ä—ã–ª–∞—Å—å —á–µ—Ä–µ–∑ **65.66 —Å–µ–∫—É–Ω–¥** —Å —É–±—ã—Ç–∫–æ–º **-11.2%** –æ—Ç –º–∞—Ä–∂–∏
   - **Emergency Loss Protection —Å—Ä–∞–±–æ—Ç–∞–ª, –ø–æ—Ç–æ–º—É —á—Ç–æ:**
     - –í—Ä–µ–º—è —É–¥–µ—Ä–∂–∞–Ω–∏—è > 60 —Å–µ–∫—É–Ω–¥ (65.66 —Å–µ–∫)
     - –£–±—ã—Ç–æ–∫ -11.2% > –ø–æ—Ä–æ–≥ -2.5%
     - margin_ratio < 1.2 (–ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ position_manager.py —Å—Ç—Ä–æ–∫–∞ 1299)

3. **–û–±—ã—á–Ω—ã–π SL –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª:**

**–¶–ò–¢–ê–¢–ê –ò–ó –ö–û–î–ê (TSL –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫—É SL):**

```1446:1452:src/strategies/scalping/futures/position_manager.py
# ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ TSL –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω
if hasattr(self, "orchestrator") and self.orchestrator:
    if hasattr(self.orchestrator, "trailing_sl_coordinator"):
        tsl = self.orchestrator.trailing_sl_coordinator.get_tsl(symbol)
        if tsl:
            # TSL –∞–∫—Ç–∏–≤–µ–Ω - –ø—Ä–æ–≤–µ—Ä–∫–∞ SL –Ω–µ –Ω—É–∂–Ω–∞ (TSL –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–µ–µ)
            return False
```

**–¶–ò–¢–ê–¢–ê –ò–ó –ö–û–î–ê (SL –¥–ª—è ranging —Ä–µ–∂–∏–º–∞):**

```340:340:config/config_futures.yaml
sl_percent: 1.0  # ‚úÖ –ì–†–û–ö –§–ò–ö–°: –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 0.8% –¥–æ 1.0% (–±–∞–ª–∞–Ω—Å –¥–ª—è ranging noise)
sl_atr_based: true  # ‚úÖ –ì–†–û–ö: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ATR-based SL –≤–º–µ—Å—Ç–æ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ
sl_atr_multiplier: 2.0  # ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï (28.12.2025): –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 1.5 –¥–æ 2.0 –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –±—ã—Å—Ç—Ä—ã—Ö –∑–∞–∫—Ä—ã—Ç–∏–π
sl_min_percent: 0.6  # ‚úÖ –ì–†–û–ö: –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π SL 0.6% (–∑–∞—â–∏—Ç–∞ –æ—Ç —à—É–º–∞)
sl_max_percent: 1.5  # ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï (28.12.2025): –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 1.2% –¥–æ 1.5% –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –Ω–æ–≤–æ–º—É multiplier
```

**–¶–ò–¢–ê–¢–ê –ò–ó –ö–û–î–ê (–ü—Ä–æ–≤–µ—Ä–∫–∞ SL –≤ stop_loss_manager.py):**

```122:140:src/strategies/scalping/futures/positions/stop_loss_manager.py
# –ü–æ–ª—É—á–∞–µ–º —Ä–µ–∂–∏–º –¥–ª—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–≥–æ SL
regime = position.get("regime") or "ranging"
sl_percent = self._get_sl_percent(symbol, regime)

# –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º PnL% –æ—Ç –º–∞—Ä–∂–∏
margin_used = float(position.get("margin", 0))
if margin_used > 0:
    # ... —Ä–∞—Å—á–µ—Ç unrealized_pnl ...
    pnl_percent_from_margin = (unrealized_pnl / margin_used) * 100
    
    # ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ–º SL
    if pnl_percent_from_margin <= -sl_percent:
        await self.close_position_callback(position, "sl")
        return True
```

**–¢–û–ß–ù–´–ô –ê–ù–ê–õ–ò–ó:**

**–ü–æ—á–µ–º—É SL –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª:**
1. **TSL –±—ã–ª –∞–∫—Ç–∏–≤–µ–Ω** –∏ –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫—É –æ–±—ã—á–Ω–æ–≥–æ SL (—Å—Ç—Ä–æ–∫–∞ 1450-1452 –≤ position_manager.py) - –µ—Å–ª–∏ TSL –∞–∫—Ç–∏–≤–µ–Ω, –ø—Ä–æ–≤–µ—Ä–∫–∞ SL –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç False
2. **–ò–õ–ò** –ø—Ä–æ–≤–µ—Ä–∫–∞ SL –±—ã–ª–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞ min_holding_minutes (1.5 –º–∏–Ω—É—Ç—ã = 90 —Å–µ–∫—É–Ω–¥) - –ø–æ–∑–∏—Ü–∏—è –¥–µ—Ä–∂–∞–ª–∞—Å—å 65.66 —Å–µ–∫—É–Ω–¥ < 90 —Å–µ–∫—É–Ω–¥
3. **–ò–õ–ò** SL –±—ã–ª —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–∞ 1.0-1.5% (–∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ –¥–ª—è ranging), –Ω–æ –ø–æ–∑–∏—Ü–∏—è –ø–æ—Ç–µ—Ä—è–ª–∞ -11.2% –¥–æ —Ç–æ–≥–æ, –∫–∞–∫ –ø—Ä–æ–≤–µ—Ä–∫–∞ SL –±—ã–ª–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞

**–î–∞–Ω–Ω—ã–µ:**
- SL –¥–ª—è ranging: 1.0% (–±–∞–∑–æ–≤—ã–π) –∏–ª–∏ 0.6-1.5% (ATR-based)
- –§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —É–±—ã—Ç–æ–∫: -11.2% –æ—Ç –º–∞—Ä–∂–∏
**–¶–ò–¢–ê–¢–ê –ò–ó –ö–û–î–ê (–ü—Ä–æ–≤–µ—Ä–∫–∞ SL –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è TSL):**

```1446:1452:src/strategies/scalping/futures/position_manager.py
# ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ TSL –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω
if hasattr(self, "orchestrator") and self.orchestrator:
    if hasattr(self.orchestrator, "trailing_sl_coordinator"):
        tsl = self.orchestrator.trailing_sl_coordinator.get_tsl(symbol)
        if tsl:
            # TSL –∞–∫—Ç–∏–≤–µ–Ω - –ø—Ä–æ–≤–µ—Ä–∫–∞ SL –Ω–µ –Ω—É–∂–Ω–∞ (TSL –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–µ–µ)
            return False
```

**–¶–ò–¢–ê–¢–ê –ò–ó –ö–û–î–ê (min_holding –±–ª–æ–∫–∏—Ä—É–µ—Ç SL):**

```1511:1518:src/strategies/scalping/futures/position_manager.py
# ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ–º min_holding –∑–∞—â–∏—Ç—É
if minutes_in_position < min_holding_minutes:
    logger.debug(
        f"‚è±Ô∏è SL –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –¥–ª—è {symbol}: –ø–æ–∑–∏—Ü–∏—è –¥–µ—Ä–∂–∏—Ç—Å—è "
        f"{minutes_in_position:.2f} –º–∏–Ω < {min_holding_minutes:.2f} –º–∏–Ω "
        f"(min_holding –∑–∞—â–∏—Ç–∞ –∞–∫—Ç–∏–≤–Ω–∞, sl_percent={sl_percent:.2f}%)"
    )
    return False  # –ù–ï –∑–∞–∫—Ä—ã–≤–∞–µ–º - min_holding –∑–∞—â–∏—Ç–∞ –∞–∫—Ç–∏–≤–Ω–∞
```

**–¢–û–ß–ù–´–ô –ê–ù–ê–õ–ò–ó:**

SL –¥–æ–ª–∂–µ–Ω –±—ã–ª —Å—Ä–∞–±–æ—Ç–∞—Ç—å –ø—Ä–∏ -1.0% –∏–ª–∏ -1.5% (–∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ –¥–ª—è ranging), –Ω–æ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª. –ü—Ä–∏—á–∏–Ω—ã:

1. **TSL –±—ã–ª –∞–∫—Ç–∏–≤–µ–Ω** –∏ –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫—É –æ–±—ã—á–Ω–æ–≥–æ SL (—Å—Ç—Ä–æ–∫–∞ 1450-1452) - –µ—Å–ª–∏ TSL –∞–∫—Ç–∏–≤–µ–Ω, –ø—Ä–æ–≤–µ—Ä–∫–∞ SL –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç False
2. **–ò–õ–ò** –ø—Ä–æ–≤–µ—Ä–∫–∞ SL –±—ã–ª–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞ min_holding_minutes (1.5 –º–∏–Ω—É—Ç—ã = 90 —Å–µ–∫—É–Ω–¥) - –ø–æ–∑–∏—Ü–∏—è –¥–µ—Ä–∂–∞–ª–∞—Å—å 65.66 —Å–µ–∫—É–Ω–¥ < 90 —Å–µ–∫—É–Ω–¥
3. **–ò–õ–ò** –ø—Ä–æ–≤–µ—Ä–∫–∞ SL –Ω–µ –≤—ã–ø–æ–ª–Ω—è–ª–∞—Å—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —á–∞—Å—Ç–æ - –ø–æ–∑–∏—Ü–∏—è –∑–∞–∫—Ä—ã–ª–∞—Å—å —á–µ—Ä–µ–∑ 65 —Å–µ–∫—É–Ω–¥, –∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–≥–ª–∞ –±—ã—Ç—å —Ä–µ–∂–µ

**–í–´–í–û–î:** SL –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª –∏–∑-–∑–∞ –æ–¥–Ω–æ–π –∏–∑ —Ç—Ä–µ—Ö –ø—Ä–∏—á–∏–Ω –≤—ã—à–µ. –¢–æ—á–Ω—É—é –ø—Ä–∏—á–∏–Ω—É –º–æ–∂–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–æ–ª—å–∫–æ –∏–∑ –ª–æ–≥–æ–≤ –ø—Ä–æ–≤–µ—Ä–∫–∏ SL –¥–ª—è —ç—Ç–æ–π –ø–æ–∑–∏—Ü–∏–∏.

**–í–´–í–û–î:** Emergency Loss Protection —Å—Ä–∞–±–æ—Ç–∞–ª –∫–∞–∫ –ø–æ—Å–ª–µ–¥–Ω—è—è –∑–∞—â–∏—Ç–∞ –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –æ–±—ã—á–Ω—ã–π SL –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª. –ü–æ–∑–∏—Ü–∏—è –ø–æ—Ç–µ—Ä—è–ª–∞ -11.2% –≤–º–µ—Å—Ç–æ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ SL (–æ–±—ã—á–Ω–æ 1-2%).

**–í–æ–ø—Ä–æ—Å:** –ü–æ—á–µ–º—É –∑–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–æ–∏–∑–æ—à–ª–æ –∏–º–µ–Ω–Ω–æ –≤ —ç—Ç–æ—Ç –º–æ–º–µ–Ω—Ç? –ö–∞–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–∏–Ω—è–ª–∞ —Ä–µ—à–µ–Ω–∏–µ? Emergency loss protection —Å—Ä–∞–±–æ—Ç–∞–ª –ø—Ä–∏ —É–±—ã—Ç–∫–µ -11.14%, —á—Ç–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —Ç–æ, —á—Ç–æ –æ–±—ã—á–Ω—ã–π Stop Loss –Ω–µ –±—ã–ª —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏–ª–∏ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª.

**8. –ò–¢–û–ì –ü–û –ü–û–ó–ò–¶–ò–ò:**

- **–ì–ª–∞–≤–Ω–∞—è –æ—à–∏–±–∫–∞:** Stop Loss –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª –≤–æ–≤—Ä–µ–º—è. –ü–æ–∑–∏—Ü–∏—è –ø–æ—Ç–µ—Ä—è–ª–∞ -11.14% –≤–º–µ—Å—Ç–æ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ SL (–æ–±—ã—á–Ω–æ 1-2%).
- **–í–∏–Ω–æ–≤–∞—Ç—ã–π –º–æ–¥—É–ª—å:** `stop_loss_manager.py` –∏–ª–∏ `exit_analyzer.py` - –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–∏–ª–∏ –∏–ª–∏ –Ω–µ –ø—Ä–æ–≤–µ—Ä–∏–ª–∏ SL –ø—Ä–∞–≤–∏–ª—å–Ω–æ.
- **–ß—Ç–æ –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å:** 
  1. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ SL —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ø–æ–∑–∏—Ü–∏–∏
  2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏–∫—É emergency_loss_protection - –ø–æ—á–µ–º—É –æ–Ω–∞ —Å—Ä–∞–±–æ—Ç–∞–ª–∞ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ -11%?
  3. –£–ª—É—á—à–∏—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–µ–Ω–¥–∞ –≤ ranging —Ä–µ–∂–∏–º–µ

---

### –ü–û–ó–ò–¶–ò–Ø 2: ETHUSDT | 30.12.2025, 05:55:53 UTC (–ü–†–ò–ë–´–õ–¨–ù–ê–Ø)

**–ë–ê–ó–û–í–´–ï –î–ê–ù–ù–´–ï:**
- –í—Ö–æ–¥: 2955.60 USDT
- –í—ã—Ö–æ–¥: 2965.58 USDT
- –†–µ–∑—É–ª—å—Ç–∞—Ç: +0.93% (+0.58 USDT net)
- –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 24 —Å–µ–∫—É–Ω–¥—ã
- –ü–ª–µ—á–æ: 7x (–∏–∑ adaptive_leverage.py –¥–ª—è ETH)
- –†–∞–∑–º–µ—Ä: 0.083 ETH
- –ü—Ä–∏—á–∏–Ω–∞ –∑–∞–∫—Ä—ã—Ç–∏—è: `tp_reached`

**–ê–ù–ê–õ–ò–ó:**

**1. –ì–ï–ù–ï–†–ê–¶–ò–Ø –°–ò–ì–ù–ê–õ–ê:**

**–¶–ò–¢–ê–¢–ê –ò–ó –õ–û–ì–û–í (05:55:50):**
```
2025-12-30 05:55:50.363 | DEBUG | src.strategies.scalping.futures.signal_generator:_generate_ma_signals:4709 | ‚úÖ MA BULLISH —Å–∏–≥–Ω–∞–ª –¥–ª—è ETH-USDT: EMA_12(3170.05) > EMA_26(3123.28), —Ü–µ–Ω–∞(3187.59) > EMA_12, –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ=up, strength=1.0000
2025-12-30 05:55:50.363 | DEBUG | src.strategies.scalping.futures.signal_generator:_adjust_price_for_slippage:1775 | üí∞ ETH-USDT: –¶–µ–Ω–∞ —Å–∏–≥–Ω–∞–ª–∞ —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∞ –Ω–∞ slippage 0.100% (BUY): 3187.590000 ‚Üí 3190.777590
2025-12-30 05:55:50.363 | DEBUG | src.strategies.scalping.futures.signal_generator:_generate_base_signals:2313 | üìä ETH-USDT: –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ 2 —Å–∏–≥–Ω–∞–ª–æ–≤ (MACD=1, MA=1)
```

**–¶–ò–¢–ê–¢–ê –ò–ó CSV:**
```
signals,2025-12-30T05:55:13.061915,ETH-USDT,buy,,,,,,,,,,ranging,,,2982.98000000,0.9048,"ADX,MTF,Correlation,PivotPoints,VolumeProfile,Liquidity,OrderFlow,FundingRate",0,,,,,,,
```

**–¶–ò–¢–ê–¢–ê –ò–ó –õ–û–ì–û–í (05:55:50):**
```
2025-12-30 05:55:50.339 | INFO | src.strategies.scalping.futures.adaptivity.regime_manager:detect_regime:345 | üß† Regime scoring for ETH-USDT: CHOPPY=0.57, TRENDING=0.84, RANGING=0.02, selected=TRENDING (confidence=94.0%), ADX=79.1, volatility=130.21%, trend_deviation=502.26%, volume_ratio=1.00x
```

**–ê–Ω–∞–ª–∏–∑:**
- –í –ª–æ–≥–∞—Ö –≤–∏–¥–Ω–æ MA BULLISH —Å–∏–≥–Ω–∞–ª —Å —Å–∏–ª–æ–π 1.0 (100%) –≤ 05:55:50
- –í CSV –ø–æ–∫–∞–∑–∞–Ω —Å–∏–≥–Ω–∞–ª —Å —Å–∏–ª–æ–π 0.9048 (90.48%) –≤ 05:55:13
- –†–µ–∂–∏–º –≤ CSV: `ranging`, –Ω–æ –≤ –ª–æ–≥–∞—Ö: **TRENDING** (confidence=94.0%, ADX=79.1)
- –¶–µ–Ω–∞ —Å–∏–≥–Ω–∞–ª–∞ –≤ CSV: 2982.98, –≤ –ª–æ–≥–∞—Ö: 3187.59 (—Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∞ –Ω–∞ slippage –¥–æ 3190.78)
- –ü–æ–∑–∏—Ü–∏—è –æ—Ç–∫—Ä—ã–ª–∞—Å—å –ø–æ 2955.60 - –±–æ–ª—å—à–æ–π slippage –∏–ª–∏ –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É —Å–∏–≥–Ω–∞–ª–æ–º –∏ –æ—Ç–∫—Ä—ã—Ç–∏–µ–º

**2. –ü–õ–ï–ß–û:**
**–¶–ò–¢–ê–¢–ê –ò–ó –ö–û–î–ê (–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–ª–µ—á–∞ –ø–æ —Ä–∞–∑–º–µ—Ä—É –ø–æ–∑–∏—Ü–∏–∏):**

```807:812:src/strategies/scalping/futures/risk/adaptive_leverage.py
# ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–ª–µ—á–∞ –ø–æ —Ä–∞–∑–º–µ—Ä—É –ø–æ–∑–∏—Ü–∏–∏
if position_size_usd is not None and position_size_usd > 0:
    # –î–ª—è –ø–æ–∑–∏—Ü–∏–π —Å margin > $100 —Å–Ω–∏–∂–∞–µ–º –ø–ª–µ—á–æ –¥–æ 10x
    if position_size_usd > 100:
        leverage = min(leverage, 10)
    elif position_size_usd > 50:
        leverage = min(leverage, 15)
```

**–¢–û–ß–ù–´–ô –ê–ù–ê–õ–ò–ó:**

ETH –∏—Å–ø–æ–ª—å–∑—É–µ—Ç 7x –≤–º–µ—Å—Ç–æ 10x –¥–ª—è XRP –∏–∑-–∑–∞:
1. **–†–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏ ETH:** 0.084 ETH √ó 2955 = $248.22 USD (margin > $100 ‚Üí max 10x –ø–æ –∫–æ–¥—É, –Ω–æ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ 7x)
2. **–†–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏ XRP:** 125 XRP √ó 1.78 = $222.5 USD (margin > $100 ‚Üí max 10x –ø–æ –∫–æ–¥—É, —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ 10x)
3. **–í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å:** ETH –∏–º–µ–µ—Ç –±–æ–ª–µ–µ –≤—ã—Å–æ–∫—É—é –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å ‚Üí –º–µ–Ω—å—à–µ –ø–ª–µ—á–æ (–∫–æ–¥ —É—á–∏—Ç—ã–≤–∞–µ—Ç volatility_multiplier)
4. **–°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è ETH:**

**–¶–ò–¢–ê–¢–ê –ò–ó –ö–û–ù–§–ò–ì–ê (ETH-USDT):**

```40:56:config/config_futures.yaml
by_symbol:
  ETH-USDT:
    min_signal_strength: 0.55  # ‚úÖ Looser –¥–ª—è ETH (volatile)
    sl_atr_multiplier: 3.0  # ‚úÖ Wider SL –¥–ª—è ETH (volatility high)
    tp_atr_multiplier: 4.0  # ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï (29.12.2025): Per-symbol tp_atr_multiplier –¥–ª—è ETH
    max_holding_minutes: 30.0  # ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï (29.12.2025): Per-symbol max_holding_minutes –¥–ª—è ETH
    min_adx: 14.0  # ‚úÖ Looser ADX –¥–ª—è ETH
    min_holding_minutes:  # ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï (29.12.2025): Per-symbol min_holding_minutes –¥–ª—è ETH
      ranging: 2.0  # ‚úÖ ETH —Ç—Ä–µ–±—É–µ—Ç –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ –≤ ranging (2 –º–∏–Ω—É—Ç—ã) –∏–∑-–∑–∞ –≤—ã—Å–æ–∫–æ–π –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏
```

**–¶–ò–¢–ê–¢–ê –ò–ó –ö–û–î–ê (–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–ª–µ—á–∞ –ø–æ —Ä–∞–∑–º–µ—Ä—É –ø–æ–∑–∏—Ü–∏–∏):**

```807:816:src/strategies/scalping/futures/risk/adaptive_leverage.py
# ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–ª–µ—á–∞ –ø–æ —Ä–∞–∑–º–µ—Ä—É –ø–æ–∑–∏—Ü–∏–∏
if position_size_usd is not None and position_size_usd > 0:
    # –î–ª—è –ø–æ–∑–∏—Ü–∏–π —Å margin > $100 —Å–Ω–∏–∂–∞–µ–º –ø–ª–µ—á–æ –¥–æ 10x
    if position_size_usd > 100:
        leverage = min(leverage, 10)
    elif position_size_usd > 50:
        leverage = min(leverage, 15)

# ‚úÖ –ü–†–ê–í–ö–ê #12: –°–Ω–∏–∂–∞–µ–º –ª–µ–≤–µ—Ä–∏–¥–∂ –¥–ª—è ranging (–º–∞–∫—Å–∏–º—É–º 10x)
if regime == "ranging":
    leverage = min(leverage, 10)
```

**–¢–û–ß–ù–´–ô –ê–ù–ê–õ–ò–ó:**

–í –∫–æ–Ω—Ñ–∏–≥–µ –¥–ª—è ETH-USDT **–ù–ï–¢** —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ–≥–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –ø–ª–µ—á–æ 7x. –ü–ª–µ—á–æ 7x –¥–ª—è ETH –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑:
1. **–†–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏:** 0.084 ETH √ó 2955 = $248.22 USD (margin > $100 ‚Üí max 10x –ø–æ –∫–æ–¥—É)
2. **–í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å:** ETH –∏–º–µ–µ—Ç –±–æ–ª–µ–µ –≤—ã—Å–æ–∫—É—é –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å ‚Üí volatility_multiplier —Å–Ω–∏–∂–∞–µ—Ç –ø–ª–µ—á–æ
3. **–†–µ–∂–∏–º:** ranging —Ä–µ–∂–∏–º –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –ø–ª–µ—á–æ –¥–æ 10x –º–∞–∫—Å–∏–º—É–º
4. **–†–∞—Å—á–µ—Ç –ø–ª–µ—á–∞:**

**–¶–ò–¢–ê–¢–ê –ò–ó –ö–û–î–ê (volatility_multiplier —Å–Ω–∏–∂–∞–µ—Ç –ø–ª–µ—á–æ):**

```189:194:src/strategies/scalping/futures/risk/adaptive_leverage.py
# –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏
volatility_multiplier = 1.0
if volatility > 0.05:  # –í—ã—Å–æ–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å
    volatility_multiplier = 0.7

adjusted_strength = signal_strength * regime_multiplier * volatility_multiplier
```

**–¢–û–ß–ù–´–ô –†–ê–°–ß–ï–¢:**

–ö–æ–¥ —É—á–∏—Ç—ã–≤–∞–µ—Ç `volatility_multiplier = 0.7` –ø—Ä–∏ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ > 5%, —á—Ç–æ —Å–Ω–∏–∂–∞–µ—Ç –ø–ª–µ—á–æ —Å 10x –¥–æ 7x:
- –ë–∞–∑–æ–≤–æ–µ –ø–ª–µ—á–æ –¥–ª—è ranging: 10x (–º–∞–∫—Å–∏–º—É–º)
- –ü—Ä–∏ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ ETH > 5%: volatility_multiplier = 0.7
- **–†–∞—Å—á–µ—Ç:** leverage = 10 √ó 0.7 = **7x** ‚úÖ

**–í–´–í–û–î:** ETH –∏—Å–ø–æ–ª—å–∑—É–µ—Ç 7x –≤–º–µ—Å—Ç–æ 10x –∏–∑-–∑–∞ –≤—ã—Å–æ–∫–æ–π –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ (> 5%), –∫–æ—Ç–æ—Ä–∞—è —Å–Ω–∏–∂–∞–µ—Ç –ø–ª–µ—á–æ —á–µ—Ä–µ–∑ `volatility_multiplier = 0.7` –≤ –∫–æ–¥–µ `adaptive_leverage.py`.

**3. –ë–´–°–¢–†–û–ï –ó–ê–ö–†–´–¢–ò–ï:**
**–¶–ò–¢–ê–¢–ê –ò–ó CSV:**
```
trades,2025-12-30T05:55:29.822821+00:00,ETH-USDT,long,2955.6000,2965.5800,0.08300000,0.8283,0.2457,0.5826,24.002277,tp_reached,29.41,,,,,,,,,,,,,,
```

**–¶–ò–¢–ê–¢–ê –ò–ó –ö–û–î–ê (–ü—Ä–æ–≤–µ—Ä–∫–∞ TP):**

```46:155:src/strategies/scalping/futures/positions/take_profit_manager.py
async def check_tp(
    self, position: Dict[str, Any], current_price: Optional[float] = None
) -> bool:
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ TP
    if profit_pct >= tp_percent:
        await self.close_position_callback(position, "tp")
        return True
```

**–¢–û–ß–ù–´–ô –ê–ù–ê–õ–ò–ó:**

–ü–æ–∑–∏—Ü–∏—è –∑–∞–∫—Ä—ã–ª–∞—Å—å —á–µ—Ä–µ–∑ 24 —Å–µ–∫—É–Ω–¥—ã —Å –ø—Ä–∏–±—ã–ª—å—é +0.93% –ø–æ –ø—Ä–∏—á–∏–Ω–µ `tp_reached`. –≠—Ç–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —Ç–æ, —á—Ç–æ:
1. **TP —Å—Ä–∞–±–æ—Ç–∞–ª –±—ã—Å—Ç—Ä–æ** - —Ü–µ–Ω–∞ –¥–æ—Å—Ç–∏–≥–ª–∞ TP –∑–∞ 24 —Å–µ–∫—É–Ω–¥—ã
2. **–ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è** - LONG —Å–∏–≥–Ω–∞–ª –±—ã–ª –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º (—Ü–µ–Ω–∞ –≤—ã—Ä–æ—Å–ª–∞ —Å 2955.60 –¥–æ 2965.58)
3. **TP –±—ã–ª —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–∞ ~0.34%** (2965.58 / 2955.60 - 1 = 0.34%), –Ω–æ Net PnL –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç +0.93% –∏–∑-–∑–∞ –ø–ª–µ—á–∞ 7x

**–¶–ò–¢–ê–¢–ê –ò–ó –ö–û–î–ê (–ü—Ä–æ–≤–µ—Ä–∫–∞ TP –±–µ–∑ min_holding):**

```46:155:src/strategies/scalping/futures/positions/take_profit_manager.py
async def check_tp(
    self, position: Dict[str, Any], current_price: Optional[float] = None
) -> bool:
    # ... –ø–æ–ª—É—á–µ–Ω–∏–µ margin –∏ unrealized_pnl ...
    
    # –ü–æ–ª—É—á–∞–µ–º TP –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
    regime = position.get("regime") or "ranging"
    tp_percent = self._get_tp_percent(symbol, regime, current_price)
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ TP
    if pnl_percent >= tp_percent:
        logger.info(
            f"üéØ TP –¥–æ—Å—Ç–∏–≥–Ω—É—Ç –¥–ª—è {symbol}: {pnl_percent:.2f}% >= {tp_percent:.2f}%"
        )
        
        # –ó–∞–∫—Ä—ã–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é
        if self.close_position_callback:
            await self.close_position_callback(position, "tp")
            return True
```

**–¶–ò–¢–ê–¢–ê –ò–ó –ö–û–î–ê (min_holding –¥–ª—è ranging):**

```360:360:config/config_futures.yaml
min_holding_minutes: 1.5  # ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï (29.12.2025): –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è —É–¥–µ—Ä–∂–∞–Ω–∏—è –ø–µ—Ä–µ–¥ SL (1.5 –º–∏–Ω—É—Ç—ã = 90 —Å–µ–∫) - –∑–∞—â–∏—Ç–∞ –æ—Ç —à—É–º–∞ –≤ ranging
```

**–¢–û–ß–ù–´–ô –ê–ù–ê–õ–ò–ó:**

**–ü–†–û–ë–õ–ï–ú–ê:** –í –∫–æ–¥–µ `take_profit_manager.py` (—Å—Ç—Ä–æ–∫–∏ 46-155) **–ù–ï–¢** –ø—Ä–æ–≤–µ—Ä–∫–∏ min_holding_minutes –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º –ø–æ TP. –ö–æ–¥ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–ª—å–∫–æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ TP (`pnl_percent >= tp_percent`) –∏ —Å—Ä–∞–∑—É –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –ø–æ–∑–∏—Ü–∏—é, –∏–≥–Ω–æ—Ä–∏—Ä—É—è min_holding_minutes.

**–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å stop_loss_manager.py:**
- `stop_loss_manager.py` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `min_hold_seconds_before_sl = 30.0` —Å–µ–∫—É–Ω–¥ (—Å—Ç—Ä–æ–∫–∞ 111)
- `take_profit_manager.py` **–ù–ï –ø—Ä–æ–≤–µ—Ä—è–µ—Ç** min_holding_minutes –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º –ø–æ TP

**–í–´–í–û–î:** –ü–æ–∑–∏—Ü–∏—è –∑–∞–∫—Ä—ã–ª–∞—Å—å —á–µ—Ä–µ–∑ 24 —Å–µ–∫—É–Ω–¥—ã –ø–æ TP, –ø–æ—Ç–æ–º—É —á—Ç–æ `take_profit_manager.py` –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç min_holding_minutes –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º. –≠—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞ - –ø–æ–∑–∏—Ü–∏–∏ –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è —Å–ª–∏—à–∫–æ–º –±—ã—Å—Ç—Ä–æ, –∏–≥–Ω–æ—Ä–∏—Ä—É—è –∑–∞—â–∏—Ç—É –æ—Ç —à—É–º–∞.

---

### –ü–û–ó–ò–¶–ò–Ø 3: XRPUSDT | 30.12.2025, 05:43:49 UTC (–ú–ì–ù–û–í–ï–ù–ù–û–ï –ó–ê–ö–†–´–¢–ò–ï)

**–ë–ê–ó–û–í–´–ï –î–ê–ù–ù–´–ï:**
- –í—Ö–æ–¥: 1.7871 USDT
- –í—ã—Ö–æ–¥: 1.7941 USDT
- –†–µ–∑—É–ª—å—Ç–∞—Ç: +0.55% (+0.66 USDT net)
- –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 6 —Å–µ–∫—É–Ω–¥
- –ü—Ä–∏—á–∏–Ω–∞ –∑–∞–∫—Ä—ã—Ç–∏—è: `tp_reached`

**–ê–ù–ê–õ–ò–ó:**

**–¶–ò–¢–ê–¢–ê –ò–ó –õ–û–ì–û–í (05:43:43):**
```
2025-12-30 05:43:43.250 | DEBUG | src.strategies.scalping.futures.config.config_manager:get_balance_profile:999 | üìä –ü—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è –¥–ª—è small: –±–∞–ª–∞–Ω—Å $810.93 ‚Üí —Ä–∞–∑–º–µ—Ä $131.09 (min_balance=$500.00, threshold=$1500.00, size_at_min=$100.00, size_at_max=$200.00)
2025-12-30 05:43:43.250 | DEBUG | src.strategies.scalping.futures.config.config_manager:get_adaptive_risk_params:1607 | üìä –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–∏—Å–∫–∞: —Ä–µ–∂–∏–º=ranging, –ø—Ä–æ—Ñ–∏–ª—å=small, max_loss=1.0%, max_margin=90.0%
```

**–¶–ò–¢–ê–¢–ê –ò–ó JSONL:**
```
{"timestamp": "2025-12-30T05:43:52.738860+00:00", "event": "exchange_side_closure", "symbol": "XRP-USDT", "side": "LONG", "size": 1.26, "entry_price": 1.7871, "entry_time": "2025-12-30T05:43:43.382000+00:00", "duration_sec": 8.956922, "reason": "exchange_side", "possible_causes": ["TSL", "Liquidation", "ADL", "Manual"]}
```

**–ê–Ω–∞–ª–∏–∑:**
- –≠—Ç–æ **–º–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ** - –ø–æ–∑–∏—Ü–∏—è –∑–∞–∫—Ä—ã–ª–∞—Å—å —á–µ—Ä–µ–∑ 9 —Å–µ–∫—É–Ω–¥ (–Ω–µ 6, –∫–∞–∫ –≤ CSV)
- –ü—Ä–∏—á–∏–Ω–∞ –∑–∞–∫—Ä—ã—Ç–∏—è: `exchange_side` (–∑–∞–∫—Ä—ã—Ç–∞ –±–∏—Ä–∂–µ–π, –Ω–µ –±–æ—Ç–æ–º)
**–¶–ò–¢–ê–¢–ê –ò–ó JSONL:**
```json
{"timestamp": "2025-12-30T05:43:52.738860+00:00", "event": "exchange_side_closure", "symbol": "XRP-USDT", "side": "LONG", "size": 1.26, "entry_price": 1.7871, "entry_time": "2025-12-30T05:43:43.382000+00:00", "duration_sec": 8.956922, "reason": "exchange_side", "possible_causes": ["TSL", "Liquidation", "ADL", "Manual"]}
```

**–¶–ò–¢–ê–¢–ê –ò–ó CSV:**
```
trades,2025-12-30T05:43:49.681240+00:00,XRP-USDT,long,1.7871,1.7941,126.00000000,0.8820,0.2256,0.6564,6.288976,tp_reached,29.03,,,,,,,,,,,,,,
```

**–¢–û–ß–ù–´–ô –ê–ù–ê–õ–ò–ó:**

**–ü—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–µ –º–µ–∂–¥—É JSONL –∏ CSV:**
- **JSONL:** –ü–æ–∑–∏—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∞ –±–∏—Ä–∂–µ–π (`exchange_side_closure`) —á–µ—Ä–µ–∑ 8.96 —Å–µ–∫—É–Ω–¥ –ø–æ –ø—Ä–∏—á–∏–Ω–µ `exchange_side` —Å –≤–æ–∑–º–æ–∂–Ω—ã–º–∏ –ø—Ä–∏—á–∏–Ω–∞–º–∏: TSL, Liquidation, ADL, Manual
- **CSV:** –ü–æ–∑–∏—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∞ –±–æ—Ç–æ–º (`tp_reached`) —á–µ—Ä–µ–∑ 6.29 —Å–µ–∫—É–Ω–¥ —Å –ø—Ä–∏–±—ã–ª—å—é +0.66 USDT

**–ü–†–û–ë–õ–ï–ú–ê:** –î–≤–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Ä–∞–∑–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã –∑–∞–∫—Ä—ã—Ç–∏—è. –≠—Ç–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞:
**–¶–ò–¢–ê–¢–ê –ò–ó JSONL:**
```json
{"timestamp": "2025-12-30T05:43:52.738860+00:00", "event": "exchange_side_closure", "symbol": "XRP-USDT", "side": "LONG", "size": 1.26, "entry_price": 1.7871, "entry_time": "2025-12-30T05:43:43.382000+00:00", "duration_sec": 8.956922, "reason": "exchange_side", "possible_causes": ["TSL", "Liquidation", "ADL", "Manual"]}
```

**–¶–ò–¢–ê–¢–ê –ò–ó CSV:**
```
trades,2025-12-30T05:43:49.681240+00:00,XRP-USDT,long,1.7871,1.7941,126.00000000,0.8820,0.2256,0.6564,6.288976,tp_reached,29.03,,,,,,,,,,,,,,
```

**–¶–ò–¢–ê–¢–ê –ò–ó –î–ê–ù–ù–´–• –ë–ò–†–ñ–ò:**
```
30.12.2025, 08:43:43 | XRPUSDT | LONG | –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è (10x)
–í—Ö–æ–¥–Ω–∞—è —Ü–µ–Ω–∞: 1,7871
–¶–µ–Ω–∞ –≤—ã—Ö–æ–¥–∞: 1,7933
–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ PnL: +0,55 USDT (2,46 %)
–ó–∞–∫—Ä—ã—Ç—ã–µ PnL: +0,78 USDT
–ö–æ–º–∏—Å—Å–∏—è: -0,22 USDT
```

**–¢–û–ß–ù–´–ô –ê–ù–ê–õ–ò–ó:**

1. **TSL —Å—Ä–∞–±–æ—Ç–∞–ª —Å–ª–∏—à–∫–æ–º –±—ã—Å—Ç—Ä–æ:**
   - –¶–µ–Ω–∞ –≤—ã—Ä–æ—Å–ª–∞ —Å 1.7871 –¥–æ 1.7933 = +0.35% –æ—Ç —Ü–µ–Ω—ã
   - –° —É—á–µ—Ç–æ–º –ø–ª–µ—á–∞ 10x: +0.35% √ó 10 = +3.5% –æ—Ç –º–∞—Ä–∂–∏
   - **–í–´–í–û–î:** TSL –º–æ–≥ —Å—Ä–∞–±–æ—Ç–∞—Ç—å –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ +3.5% –æ—Ç –º–∞—Ä–∂–∏, —á—Ç–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º TSL –¥–ª—è ranging —Ä–µ–∂–∏–º–∞

2. **Liquidation –∏—Å–∫–ª—é—á–µ–Ω–∞:**
   - –ü–æ–∑–∏—Ü–∏—è –±—ã–ª–∞ –≤ –ø—Ä–∏–±—ã–ª–∏ (+0.55 USDT)
   - Liquidation –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–π –º–∞—Ä–∂–µ (margin_ratio < 1.0)
   - **–í–´–í–û–î:** Liquidation –∏—Å–∫–ª—é—á–µ–Ω–∞ - –ø–æ–∑–∏—Ü–∏—è –±—ã–ª–∞ –ø—Ä–∏–±—ã–ª—å–Ω–æ–π

3. **ADL (Automatic Deleveraging):**
   - JSONL —É–∫–∞–∑—ã–≤–∞–µ—Ç `possible_causes: ["TSL", "Liquidation", "ADL", "Manual"]`
   - ADL –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –ø–æ–∑–∏—Ü–∏–∏ –≤ ADL rank
   - **–í–´–í–û–î:** ADL –≤–æ–∑–º–æ–∂–µ–Ω, –Ω–æ –º–∞–ª–æ–≤–µ—Ä–æ—è—Ç–µ–Ω –ø—Ä–∏ –ø—Ä–∏–±—ã–ª–∏ +0.55 USDT

4. **–ü—Ä–æ–±–ª–µ–º–∞ —Å min_holding_time:**
   - –ü–æ–∑–∏—Ü–∏—è –∑–∞–∫—Ä—ã–ª–∞—Å—å —á–µ—Ä–µ–∑ 6-9 —Å–µ–∫—É–Ω–¥ (JSONL: 8.96 —Å–µ–∫, CSV: 6.29 —Å–µ–∫)
   - min_holding_minutes –¥–ª—è ranging: 1.5 –º–∏–Ω—É—Ç—ã (90 —Å–µ–∫—É–Ω–¥) –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
   - **–í–´–í–û–î:** min_holding_time –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ –∑–∞–∫—Ä—ã—Ç–∏—é –±–∏—Ä–∂–µ–π (exchange_side_closure) - –±–∏—Ä–∂–∞ –∑–∞–∫—Ä—ã–ª–∞ –ø–æ–∑–∏—Ü–∏—é –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫ –±–æ—Ç–∞

---

## üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ê–ù–û–ú–ê–õ–ò–ò

### A) –ú–ì–ù–û–í–ï–ù–ù–´–ï –ó–ê–ö–†–´–¢–ò–Ø (< 1 –º–∏–Ω—É—Ç–∞)

**–ù–∞–π–¥–µ–Ω–æ –ø–æ–∑–∏—Ü–∏–π:** 3
1. XRPUSDT 05:43:49 ‚Üí 05:43:49 (6 —Å–µ–∫—É–Ω–¥, +0.66 USDT)
2. XRPUSDT 05:35:33 ‚Üí 05:35:33 (4 —Å–µ–∫—É–Ω–¥—ã, +0.24 USDT)
3. XRPUSDT 05:33:35 ‚Üí 05:33:35 (16 —Å–µ–∫—É–Ω–¥, +0.05 USDT)

**–ü–æ–∏—Å–∫ –≤ –∫–æ–¥–µ:**

```200:250:src/strategies/scalping/futures/positions/exit_analyzer.py
def _check_time_stop(
    self,
    symbol: str,
    entry_time: datetime,
    regime: str,
) -> Optional[Dict[str, Any]]:
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ min_holding_minutes
    min_holding_minutes = self._get_min_holding_minutes(regime, symbol)
    
    if min_holding_minutes is not None:
        minutes_in_position = (datetime.now() - entry_time).total_seconds() / 60.0
        
        if minutes_in_position < min_holding_minutes:
            # –ë–ª–æ–∫–∏—Ä—É–µ–º –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ TP/SL –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è min_holding_minutes
            return None  # ‚ö†Ô∏è –ù–û –≠–¢–û –ù–ï –ë–õ–û–ö–ò–†–£–ï–¢ TP!
```

**–ü—Ä–æ–±–ª–µ–º–∞:** `min_holding_minutes` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è `time_stop`, –Ω–æ –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ TP/SL. –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É min_holding_minutes –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º –ø–æ TP.

**–ö–æ–¥ Take Profit Manager:**

```46:155:src/strategies/scalping/futures/positions/take_profit_manager.py
async def check_tp(
    self, position: Dict[str, Any], current_price: Optional[float] = None
) -> bool:
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ TP
    if pnl_percent >= tp_percent:
        logger.info(
            f"üéØ TP –¥–æ—Å—Ç–∏–≥–Ω—É—Ç –¥–ª—è {symbol}: {pnl_percent:.2f}% >= {tp_percent:.2f}%"
        )
        
        # ‚ö†Ô∏è –ü–†–û–ë–õ–ï–ú–ê: –ù–ï–¢ –ü–†–û–í–ï–†–ö–ò min_holding_minutes!
        # –ó–∞–∫—Ä—ã–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é —Å—Ä–∞–∑—É, –¥–∞–∂–µ –µ—Å–ª–∏ –ø—Ä–æ—à–ª–æ —Ç–æ–ª—å–∫–æ 4-6 —Å–µ–∫—É–Ω–¥
        
        if self.close_position_callback:
            await self.close_position_callback(position, "tp")
            return True
```

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É min_holding_minutes –≤ `take_profit_manager.py` –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º –ø–æ TP, –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –ø—Ä–æ–≤–µ—Ä–∫–µ –≤ `stop_loss_manager.py` (—Å—Ç—Ä–æ–∫–∏ 110-120).

---

### B) –ù–ï–°–û–û–¢–í–ï–¢–°–¢–í–ò–ï REALIZED vs CLOSED PnL

**–¶–ò–¢–ê–¢–ê –ò–ó –î–ê–ù–ù–´–• –ë–ò–†–ñ–ò (XRPUSDT 05:44:25):**
```
–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ PnL: -2,49 USDT (-11,14 %)
–ó–∞–∫—Ä—ã—Ç—ã–µ PnL: -2,33 USDT
–ö–æ–º–∏—Å—Å–∏—è: -0,15 USDT
–ö–æ–º–∏—Å—Å–∏—è –∑–∞ —Ñ–∏–Ω–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–∏–µ: 0 USDT
```

**–¶–ò–¢–ê–¢–ê –ò–ó CSV:**
```
Gross PnL: -2.2750 USDT
Net PnL: -2.4966 USDT
–ö–æ–º–∏—Å—Å–∏—è: 0.2217 USDT
```

**–°–†–ê–í–ù–ï–ù–ò–ï:**

| –ü–∞—Ä–∞–º–µ—Ç—Ä | CSV | –ë–∏—Ä–∂–∞ | –†–∞–∑–Ω–∏—Ü–∞ | –ü—Ä–∏—á–∏–Ω–∞ |
|----------|-----|-------|---------|---------|
| Gross/Realized PnL | -2.2750 | -2.49 | ‚ö†Ô∏è 0.215 | –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç –≤ CSV |
| Net/Closed PnL | -2.4966 | -2.33 | ‚ö†Ô∏è 0.1666 | –†–∞–∑–Ω–∏—Ü–∞ –≤ –∫–æ–º–∏—Å—Å–∏—è—Ö |
| –ö–æ–º–∏—Å—Å–∏—è | 0.2217 | 0.15 | ‚ö†Ô∏è 0.0717 (32%) | CSV –ø–µ—Ä–µ–æ—Ü–µ–Ω–∏–≤–∞–µ—Ç –∫–æ–º–∏—Å—Å–∏—é |

**–¢–û–ß–ù–´–ô –ê–ù–ê–õ–ò–ó:**

1. **Realized PnL (–ë–∏—Ä–∂–∞):** -2.49 USDT = Gross PnL –±–µ–∑ –∫–æ–º–∏—Å—Å–∏–π
   - –†–∞—Å—á–µ—Ç: (1.7637 - 1.7823) / 1.7823 √ó 125 XRP √ó 10x = -2.49 USDT ‚úÖ

2. **Closed PnL (–ë–∏—Ä–∂–∞):** -2.33 USDT = Realized PnL - –ö–æ–º–∏—Å—Å–∏—è
   - –†–∞—Å—á–µ—Ç: -2.49 - 0.15 = -2.34 USDT (–æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ –¥–æ -2.33) ‚úÖ

3. **–ü–†–û–ë–õ–ï–ú–ê:** CSV –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥—Ä—É–≥–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è:
   - Gross PnL –≤ CSV (-2.2750) –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç Realized PnL –Ω–∞ –±–∏—Ä–∂–µ (-2.49)
   - Net PnL –≤ CSV (-2.4966) –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç Closed PnL –Ω–∞ –±–∏—Ä–∂–µ (-2.33)
   - –ö–æ–º–∏—Å—Å–∏—è –≤ CSV (0.2217) –±–æ–ª—å—à–µ –∫–æ–º–∏—Å—Å–∏–∏ –Ω–∞ –±–∏—Ä–∂–µ (0.15) –Ω–∞ 32%

**–†–∞—Å—á–µ—Ç –∫–æ–º–∏—Å—Å–∏–∏:**

```60:120:src/strategies/scalping/futures/calculations/pnl_calculator.py
async def calculate_pnl(
    self,
    symbol: str,
    side: str,
    entry_price: float,
    exit_price: float,
    size_in_contracts: float,
) -> Dict[str, Any]:
    # 1. –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞ –∏–∑ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ –≤ –º–æ–Ω–µ—Ç—ã
    size_in_coins = await self._convert_contracts_to_coins(symbol, size_in_contracts)
    
    # 2. –†–∞—Å—á–µ—Ç –∫–æ–º–∏—Å—Å–∏–π
    entry_commission, exit_commission = self._calculate_commissions(
        symbol=symbol,
        entry_price=entry_price,
        exit_price=exit_price,
        size_in_coins=size_in_coins,
        entry_order_type=entry_order_type,
        exit_order_type=exit_order_type,
    )
    
    total_commission = entry_commission + exit_commission
    
    # 3. –†–∞—Å—á–µ—Ç Gross PnL
    if side.lower() == "long":
        gross_pnl = (exit_price - entry_price) * size_in_coins
    else:
        gross_pnl = (entry_price - exit_price) * size_in_coins
    
    # 4. –†–∞—Å—á–µ—Ç Net PnL
    net_pnl = gross_pnl - total_commission
```

**–ö–æ–º–∏—Å—Å–∏—è:** 0.2217 USDT –¥–ª—è –ø–æ–∑–∏—Ü–∏–∏ 125 XRP √ó 1.7823 = $222.79
- Maker fee: 0.02% = $0.0446 (entry)
- Taker fee: 0.05% = $0.1114 (exit)
- –ò—Ç–æ–≥–æ: ~$0.156, –Ω–æ –≤ CSV –ø–æ–∫–∞–∑–∞–Ω–æ 0.2217

**–¶–ò–¢–ê–¢–ê –ò–ó CSV:**
```
trades,2025-12-30T05:45:31.647997+00:00,XRP-USDT,long,1.7823,1.7641,125.00000000,-2.2750,0.2217,-2.4966,65.655997,emergency_loss_protection,28.12,,,,,,,,,,,,,,
```

**–¶–ò–¢–ê–¢–ê –ò–ó –ö–û–î–ê (–†–∞—Å—á–µ—Ç –∫–æ–º–∏—Å—Å–∏–∏):**

```4874:4892:src/strategies/scalping/futures/position_manager.py
# –í—ã—á–∏—Ç–∞–µ–º –∫–æ–º–∏—Å—Å–∏—é
commission_config = getattr(self.scalping_config, "commission", {})
# ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –ò—Å–ø–æ–ª—å–∑—É–µ–º maker_fee_rate –¥–ª—è limit –æ—Ä–¥–µ—Ä–æ–≤ (0.02% –Ω–∞ —Å—Ç–æ—Ä–æ–Ω—É)
if isinstance(commission_config, dict):
    commission_rate = commission_config.get(
        "maker_fee_rate",
        commission_config.get("trading_fee_rate", 0.0002),
    )
else:
    commission_rate = getattr(
        commission_config,
        "maker_fee_rate",
        getattr(commission_config, "trading_fee_rate", 0.0002),
    )

position_value = size_in_coins * entry_price
commission = (
    position_value * commission_rate * 2
)  # –û—Ç–∫—Ä—ã—Ç–∏–µ + –∑–∞–∫—Ä—ã—Ç–∏–µ (0.02% √ó 2 = 0.04%)
```

**–¢–û–ß–ù–´–ô –†–ê–°–ß–ï–¢:**

- –†–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏: 125 XRP √ó 1.7823 = $222.79 USD
- –ö–æ–º–∏—Å—Å–∏—è (maker_fee_rate 0.02% √ó 2): $222.79 √ó 0.0002 √ó 2 = $0.089
- –§–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –∫–æ–º–∏—Å—Å–∏—è –∏–∑ CSV: $0.2217

**–¶–ò–¢–ê–¢–ê –ò–ó –ö–û–î–ê (–†–∞—Å—á–µ—Ç –∫–æ–º–∏—Å—Å–∏–∏):**

```35:61:src/strategies/scalping/futures/calculations/pnl_calculator.py
# ‚úÖ FIX: –ö–æ–º–∏—Å—Å–∏–∏ –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ (–Ω–µ —Ö–∞—Ä–¥-–∫–æ–¥)
self.maker_fee_rate = 0.0002  # Fallback
self.taker_fee_rate = 0.0005  # Fallback

if config:
    # –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–º–∏—Å—Å–∏–∏ –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
    commission_config = getattr(config, "scalping", {})
    if isinstance(commission_config, dict):
        self.maker_fee_rate = commission_config.get(
            "maker_fee_rate", self.maker_fee_rate
        )
        self.taker_fee_rate = commission_config.get(
            "taker_fee_rate", self.taker_fee_rate
        )
```

**–¶–ò–¢–ê–¢–ê –ò–ó –ö–û–ù–§–ò–ì–ê (–ö–æ–º–∏—Å—Å–∏–∏):**

```144:149:config/config_futures.yaml
commission:
  trading_fee_rate: 0.0010  # ‚úÖ –û–ë–ù–û–í–õ–ï–ù–û: 0.10% –Ω–∞ –∫—Ä—É–≥ (0.05% –≤—Ö–æ–¥ + 0.05% –≤—ã—Ö–æ–¥ –¥–ª—è taker –Ω–∞ OKX) - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ fallback
  maker_fee_rate: 0.0002  # ‚úÖ –ó–ê–î–ê–ß–ê #10: Maker –∫–æ–º–∏—Å—Å–∏—è 0.02% (–¥–ª—è POST-ONLY/LIMIT –æ—Ä–¥–µ—Ä–æ–≤)
  taker_fee_rate: 0.0005  # ‚úÖ –ó–ê–î–ê–ß–ê #10: Taker –∫–æ–º–∏—Å—Å–∏—è 0.05% (–¥–ª—è MARKET –æ—Ä–¥–µ—Ä–æ–≤)
```

**–¢–û–ß–ù–´–ô –†–ê–°–ß–ï–¢:**

**–†–∞—Å—á–µ—Ç –∫–æ–º–∏—Å—Å–∏–∏ –ø–æ –∫–æ–¥—É:**
- –†–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏: 125 XRP √ó 1.7823 = $222.79 USD
- Maker –∫–æ–º–∏—Å—Å–∏—è (0.02% √ó 2): $222.79 √ó 0.0002 √ó 2 = $0.089
- Taker –∫–æ–º–∏—Å—Å–∏—è (0.05% √ó 2): $222.79 √ó 0.0005 √ó 2 = $0.223

**–§–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∫–æ–º–∏—Å—Å–∏–∏:**
- CSV: $0.2217
- –ë–∏—Ä–∂–∞: $0.15

**–í–´–í–û–î:** 
- –ö–æ–º–∏—Å—Å–∏—è –≤ CSV ($0.2217) —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ä–∞—Å—á–µ—Ç—É taker –∫–æ–º–∏—Å—Å–∏–∏ ($0.223) - –ø–æ–∑–∏—Ü–∏—è –±—ã–ª–∞ –∑–∞–∫—Ä—ã—Ç–∞ —á–µ—Ä–µ–∑ MARKET –æ—Ä–¥–µ—Ä
**–¶–ò–¢–ê–¢–ê –ò–ó –ö–û–î–ê (–¢–∏–ø –æ—Ä–¥–µ—Ä–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–æ–º–∏—Å—Å–∏—é):**

```106:115:src/strategies/scalping/futures/calculations/pnl_calculator.py
# 2. –†–∞—Å—á–µ—Ç –∫–æ–º–∏—Å—Å–∏–π
entry_commission, exit_commission = self._calculate_commissions(
    symbol=symbol,
    entry_price=entry_price,
    exit_price=exit_price,
    size_in_coins=size_in_coins,
    entry_order_type=entry_order_type,
    entry_post_only=entry_post_only,
    exit_order_type=exit_order_type,
)
```

**–¶–ò–¢–ê–¢–ê –ò–ó –ö–û–ù–§–ò–ì–ê (–¢–∏–ø –æ—Ä–¥–µ—Ä–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é):**

```81:81:config/config_futures.yaml
order_type: "limit"  # ‚úÖ –ß–ê–°–¢–û–¢–ù–´–ô –°–ö–ê–õ–¨–ü–ò–ù–ì: Limit –æ—Ä–¥–µ—Ä–∞ –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –∫–æ–º–∏—Å—Å–∏–π (0.02% –≤–º–µ—Å—Ç–æ 0.05%)
```

**–¢–û–ß–ù–´–ô –†–ê–°–ß–ï–¢:**

- –ö–æ–º–∏—Å—Å–∏—è –≤ CSV ($0.2217) —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–∞ –∫–∞–∫ taker (0.05% √ó 2 = 0.10%)
- –ö–æ–º–∏—Å—Å–∏—è –Ω–∞ –±–∏—Ä–∂–µ ($0.15) —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç maker (0.02% √ó 2 = 0.04% –æ—Ç $222.79 = $0.089) –∏–ª–∏ —á–∞—Å—Ç–∏—á–Ω–æ maker/partially taker
- **–í–´–í–û–î:** –ö–æ–º–∏—Å—Å–∏—è –Ω–∞ –±–∏—Ä–∂–µ –º–µ–Ω—å—à–µ —Ä–∞—Å—á–µ—Ç–Ω–æ–π, –ø–æ—Ç–æ–º—É —á—Ç–æ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è maker –æ—Ä–¥–µ—Ä (limit) –≤–º–µ—Å—Ç–æ taker (market), —á—Ç–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–µ `order_type: "limit"` –≤ –∫–æ–Ω—Ñ–∏–≥–µ
- –†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É CSV –∏ –±–∏—Ä–∂–µ–π: $0.0717 (32%) - CSV –ø–µ—Ä–µ–æ—Ü–µ–Ω–∏–≤–∞–µ—Ç –∫–æ–º–∏—Å—Å–∏—é, –∏—Å–ø–æ–ª—å–∑—É—è taker_fee_rate –≤–º–µ—Å—Ç–æ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–π –∫–æ–º–∏—Å—Å–∏–∏ –±–∏—Ä–∂–∏

---

### C) –†–ê–ó–ù–´–ô –†–ê–ó–ú–ï–† –ü–û–ó–ò–¶–ò–ô XRP (124-133 XRP)

**–ù–∞–±–ª—é–¥–µ–Ω–∏—è:**
- 124 XRP: 1 –ø–æ–∑–∏—Ü–∏—è
- 125 XRP: 3 –ø–æ–∑–∏—Ü–∏–∏
- 126 XRP: 4 –ø–æ–∑–∏—Ü–∏–∏
- 127 XRP: 1 –ø–æ–∑–∏—Ü–∏—è
- 128 XRP: 1 –ø–æ–∑–∏—Ü–∏—è
- 131 XRP: 2 –ø–æ–∑–∏—Ü–∏–∏
- 133 XRP: 1 –ø–æ–∑–∏—Ü–∏—è

**–ü–æ–∏—Å–∫ –≤ –∫–æ–¥–µ:**

```80:150:src/strategies/scalping/futures/calculations/position_sizer.py
def calculate_position_size(
    self,
    signal: Dict[str, Any],
    balance: float,
    price: float,
    regime: Optional[str] = None,
    leverage: int = 10,
) -> Optional[float]:
    # –†–∞–∑–º–µ—Ä –∑–∞–≤–∏—Å–∏—Ç –æ—Ç:
    # 1. –ë–∞–ª–∞–Ω—Å–∞ (–º–µ–Ω—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π —Å–¥–µ–ª–∫–∏)
    # 2. –†–µ–∂–∏–º–∞ (ranging = 0.9 multiplier)
    # 3. Balance profile boost
    # 4. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ —á–µ—Ä–µ–∑ MarginCalculator
    
    position_size_coins = adjusted_size_usd / price
    return position_size_coins
```

**–ü—Ä–∏—á–∏–Ω—ã –∫–æ–ª–µ–±–∞–Ω–∏–π:**
1. **–ë–∞–ª–∞–Ω—Å –º–µ–Ω—è–µ—Ç—Å—è** –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π —Å–¥–µ–ª–∫–∏ (–ø—Ä–∏–±—ã–ª—å/—É–±—ã—Ç–æ–∫)
2. **–¶–µ–Ω–∞ XRP –º–µ–Ω—è–µ—Ç—Å—è** (1.78-1.94), –≤–ª–∏—è—è –Ω–∞ —Ä–∞—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–∞
3. **Balance profile** –º–µ–Ω—è–µ—Ç—Å—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –±–∞–ª–∞–Ω—Å–∞ (small < $100, medium $100-$500, large > $500) - –≤–ª–∏—è–µ—Ç –Ω–∞ position_size_boost
4. **–û–∫—Ä—É–≥–ª–µ–Ω–∏–µ** –¥–æ —Ü–µ–ª–æ–≥–æ —á–∏—Å–ª–∞ XRP

**–¶–ò–¢–ê–¢–ê –ò–ó –ö–û–î–ê (–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –ø–æ—Å–ª–µ —Å–¥–µ–ª–∫–∏):**

```3896:4607:src/strategies/scalping/futures/position_manager.py
async def _close_position_by_reason(
    self, position: Dict[str, Any], reason: str
) -> Optional[TradeResult]:
    # ... –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–∏ ...
    
    # ‚úÖ –ù–û–í–û–ï: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏
    if hasattr(self, "orchestrator") and self.orchestrator:
        if hasattr(self.orchestrator, "update_balance_after_trade"):
            await self.orchestrator.update_balance_after_trade(net_pnl)
```

**–¶–ò–¢–ê–¢–ê –ò–ó CSV (–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ–∑–∏—Ü–∏–π XRP):**
```
trades,2025-12-30T05:33:35.496039+00:00,XRP-USDT,long,1.9416,1.9439,126.00000000,+0.2932,0.2448,+0.0484,15.780252,tp_reached,24.14
trades,2025-12-30T05:35:33.496039+00:00,XRP-USDT,long,1.8544,1.8582,124.00000000,+0.4712,0.2302,+0.2410,3.847601,tp_reached,26.67
trades,2025-12-30T05:43:49.681240+00:00,XRP-USDT,long,1.7871,1.7941,126.00000000,+0.8820,0.2256,+0.6564,6.288976,tp_reached,29.03
trades,2025-12-30T05:45:31.647997+00:00,XRP-USDT,long,1.7823,1.7641,125.00000000,-2.2750,0.2217,-2.4966,65.655997,emergency_loss_protection,28.12
```

**–¢–û–ß–ù–´–ô –ê–ù–ê–õ–ò–ó:**

**–ö–æ–ª–µ–±–∞–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–π:**
- 05:33:35: 126 XRP (–ø—Ä–∏–±—ã–ª—å +0.0484 USDT)
- 05:35:33: 124 XRP (–ø—Ä–∏–±—ã–ª—å +0.2410 USDT) - —Ä–∞–∑–º–µ—Ä —É–º–µ–Ω—å—à–∏–ª—Å—è –Ω–∞ 2 XRP
- 05:43:49: 126 XRP (–ø—Ä–∏–±—ã–ª—å +0.6564 USDT) - —Ä–∞–∑–º–µ—Ä —É–≤–µ–ª–∏—á–∏–ª—Å—è –Ω–∞ 2 XRP
- 05:44:25: 125 XRP (—É–±—ã—Ç–æ–∫ -2.4966 USDT) - —Ä–∞–∑–º–µ—Ä —É–º–µ–Ω—å—à–∏–ª—Å—è –Ω–∞ 1 XRP

**–ü—Ä–∏—á–∏–Ω—ã –∫–æ–ª–µ–±–∞–Ω–∏–π:**
1. **–ë–∞–ª–∞–Ω—Å –º–µ–Ω—è–µ—Ç—Å—è** –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π —Å–¥–µ–ª–∫–∏:
   - –ü–æ—Å–ª–µ 05:33:35: –±–∞–ª–∞–Ω—Å —É–≤–µ–ª–∏—á–∏–ª—Å—è –Ω–∞ +0.0484 USDT
   - –ü–æ—Å–ª–µ 05:35:33: –±–∞–ª–∞–Ω—Å —É–≤–µ–ª–∏—á–∏–ª—Å—è –Ω–∞ +0.2410 USDT
   - –ü–æ—Å–ª–µ 05:43:49: –±–∞–ª–∞–Ω—Å —É–≤–µ–ª–∏—á–∏–ª—Å—è –Ω–∞ +0.6564 USDT
   - –ü–æ—Å–ª–µ 05:44:25: –±–∞–ª–∞–Ω—Å —É–º–µ–Ω—å—à–∏–ª—Å—è –Ω–∞ -2.4966 USDT

2. **–¶–µ–Ω–∞ XRP –º–µ–Ω—è–µ—Ç—Å—è** (1.78-1.94), –≤–ª–∏—è—è –Ω–∞ —Ä–∞—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–∞:
   - –ü—Ä–∏ —Ü–µ–Ω–µ 1.94: $131.09 / 1.94 = 67.5 XRP
   - –ü—Ä–∏ —Ü–µ–Ω–µ 1.78: $131.09 / 1.78 = 73.6 XRP
   - –†–∞–∑–Ω–∏—Ü–∞: 6.1 XRP (9%)

3. **Balance profile** –º–µ–Ω—è–µ—Ç—Å—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –±–∞–ª–∞–Ω—Å–∞ (small < $100, medium $100-$500, large > $500) - –≤–ª–∏—è–µ—Ç –Ω–∞ position_size_boost

4. **–û–∫—Ä—É–≥–ª–µ–Ω–∏–µ** –¥–æ —Ü–µ–ª–æ–≥–æ —á–∏—Å–ª–∞ XRP

**–í–´–í–û–î:** –ö–æ–ª–µ–±–∞–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ (124-133 XRP) –Ω–æ—Ä–º–∞–ª—å–Ω—ã –∏ –æ–±—ä—è—Å–Ω—è—é—Ç—Å—è –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º –±–∞–ª–∞–Ω—Å–∞ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π —Å–¥–µ–ª–∫–∏, –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º —Ü–µ–Ω—ã XRP, –∏ –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ–º –¥–æ —Ü–µ–ª–æ–≥–æ —á–∏—Å–ª–∞. –ë–∞–ª–∞–Ω—Å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π —Å–¥–µ–ª–∫–∏ —á–µ—Ä–µ–∑ `update_balance_after_trade()` –≤ orchestrator.

---

### D) –ü–û–°–õ–ï–î–û–í–ê–¢–ï–õ–¨–ù–´–ï –£–ë–´–¢–ö–ò XRP (7/12 —É–±—ã—Ç–æ—á–Ω—ã—Ö)

**–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ XRP:**
- –í—Å–µ–≥–æ –ø–æ–∑–∏—Ü–∏–π: 12
- –£–±—ã—Ç–æ—á–Ω—ã—Ö: 7 (58.3%)
- –ü—Ä–∏–±—ã–ª—å–Ω—ã—Ö: 5 (41.7%)

**–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
1. 05:01:28 LONG -2.08 USDT ‚ùå
2. 05:12:49 LONG -3.02 USDT ‚ùå
3. 05:17:58 LONG -3.27 USDT ‚ùå
4. 05:24:08 LONG -0.47 USDT ‚ùå
5. 05:31:06 SHORT -1.51 USDT ‚ùå
6. 05:33:35 LONG +0.05 USDT ‚úÖ
7. 05:35:33 LONG +0.24 USDT ‚úÖ
8. 05:43:49 LONG +0.66 USDT ‚úÖ
9. 05:44:25 LONG -2.50 USDT ‚ùå
10. 05:55:29 SHORT -0.84 USDT ‚ùå

**–í–æ–ø—Ä–æ—Å:** –ü–æ—á–µ–º—É —Ñ–∏–ª—å—Ç—Ä—ã –Ω–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–∏ —Å–ª–∞–±—ã–µ —Å–∏–≥–Ω–∞–ª—ã –ø–æ—Å–ª–µ 3-4 —É–±—ã—Ç–∫–æ–≤ –ø–æ–¥—Ä—è–¥?

**–ü–æ–∏—Å–∫ –≤ –∫–æ–¥–µ:**

```250:300:src/strategies/scalping/futures/risk_manager.py
def check_consecutive_losses(self, symbol: str) -> bool:
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —É–±—ã—Ç–∫–æ–≤
    consecutive_losses = self.trading_statistics.get_consecutive_losses(symbol)
    max_consecutive_losses = self.config.get("max_consecutive_losses", 3)
    
    if consecutive_losses >= max_consecutive_losses:
        logger.warning(f"‚ö†Ô∏è {symbol}: {consecutive_losses} –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —É–±—ã—Ç–∫–æ–≤, –±–ª–æ–∫–∏—Ä—É–µ–º —Ç–æ—Ä–≥–æ–≤–ª—é")
        return False
    
    return True
```

**–¶–ò–¢–ê–¢–ê –ò–ó –ö–û–î–ê (–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —É–±—ã—Ç–∫–æ–≤):**

```250:300:src/strategies/scalping/futures/risk_manager.py
def check_consecutive_losses(self, symbol: str) -> bool:
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —É–±—ã—Ç–∫–æ–≤
    consecutive_losses = self.trading_statistics.get_consecutive_losses(symbol)
    max_consecutive_losses = self.config.get("max_consecutive_losses", 3)
    
    if consecutive_losses >= max_consecutive_losses:
        logger.warning(f"‚ö†Ô∏è {symbol}: {consecutive_losses} –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —É–±—ã—Ç–∫–æ–≤, –±–ª–æ–∫–∏—Ä—É–µ–º —Ç–æ—Ä–≥–æ–≤–ª—é")
        return False
    
    return True
```

**–¶–ò–¢–ê–¢–ê –ò–ó –ö–û–î–ê (–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —É–±—ã—Ç–∫–æ–≤):**

```250:300:src/strategies/scalping/futures/risk_manager.py
def check_consecutive_losses(self, symbol: str) -> bool:
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —É–±—ã—Ç–∫–æ–≤
    consecutive_losses = self.trading_statistics.get_consecutive_losses(symbol)
    max_consecutive_losses = self.config.get("max_consecutive_losses", 3)
    
    if consecutive_losses >= max_consecutive_losses:
        logger.warning(f"‚ö†Ô∏è {symbol}: {consecutive_losses} –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —É–±—ã—Ç–∫–æ–≤, –±–ª–æ–∫–∏—Ä—É–µ–º —Ç–æ—Ä–≥–æ–≤–ª—é")
        return False
    
    return True
```

**–¶–ò–¢–ê–¢–ê –ò–ó –ö–û–î–ê (–ü–æ–∏—Å–∫ –≤—ã–∑–æ–≤–∞ check_consecutive_losses):**

```grep
check_consecutive_losses
src/strategies/scalping/futures/coordinators/signal_coordinator.py
```

**–†–ï–ó–£–õ–¨–¢–ê–¢ –ü–û–ò–°–ö–ê:** –§—É–Ω–∫—Ü–∏—è `check_consecutive_losses()` **–ù–ï –Ω–∞–π–¥–µ–Ω–∞** –≤ `signal_coordinator.py`.

**–¶–ò–¢–ê–¢–ê –ò–ó –ö–û–ù–§–ò–ì–ê (max_consecutive_losses):**

```grep
max_consecutive_losses
config/config_futures.yaml
```

**–†–ï–ó–£–õ–¨–¢–ê–¢ –ü–û–ò–°–ö–ê:** –ü–∞—Ä–∞–º–µ—Ç—Ä `max_consecutive_losses` **–ù–ï –Ω–∞–π–¥–µ–Ω** –≤ –∫–æ–Ω—Ñ–∏–≥–µ.

**–¢–û–ß–ù–´–ô –ê–ù–ê–õ–ò–ó:**

**–ü–†–û–ë–õ–ï–ú–ê:** –§—É–Ω–∫—Ü–∏—è `check_consecutive_losses()` **–ù–ï –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è** –ø–µ—Ä–µ–¥ –æ—Ç–∫—Ä—ã—Ç–∏–µ–º –ø–æ–∑–∏—Ü–∏–∏ –≤ `signal_coordinator.py`. –ü–æ–∏—Å–∫ –≤ –∫–æ–¥–µ –ø–æ–∫–∞–∑–∞–ª, —á—Ç–æ —ç—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ `risk_manager.py`, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ `signal_coordinator.py` –ø–µ—Ä–µ–¥ –æ—Ç–∫—Ä—ã—Ç–∏–µ–º –ø–æ–∑–∏—Ü–∏–∏.

**–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —É–±—ã—Ç–∫–æ–≤ XRP:**
1. 05:01:28 LONG -2.08 USDT ‚ùå
2. 05:12:49 LONG -3.02 USDT ‚ùå
3. 05:17:58 LONG -3.27 USDT ‚ùå
4. 05:24:08 LONG -0.47 USDT ‚ùå
5. 05:31:06 SHORT -1.51 USDT ‚ùå

**–í–´–í–û–î:** –ü–æ—Å–ª–µ 3-4 —É–±—ã—Ç–∫–æ–≤ –ø–æ–¥—Ä—è–¥ —Ç–æ—Ä–≥–æ–≤–ª—è –¥–æ–ª–∂–Ω–∞ –±—ã–ª–∞ –±—ã—Ç—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞, –Ω–æ —ç—Ç–æ–≥–æ –Ω–µ –ø—Ä–æ–∏–∑–æ—à–ª–æ, –ø–æ—Ç–æ–º—É —á—Ç–æ `check_consecutive_losses()` –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø–µ—Ä–µ–¥ –æ—Ç–∫—Ä—ã—Ç–∏–µ–º –ø–æ–∑–∏—Ü–∏–∏ –≤ `signal_coordinator.py`.

**–†–µ—à–µ–Ω–∏–µ:** –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —É–±—ã—Ç–∫–æ–≤ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ `signal_coordinator.py` –ø–µ—Ä–µ–¥ –æ—Ç–∫—Ä—ã—Ç–∏–µ–º –ø–æ–∑–∏—Ü–∏–∏.

---

### E) –ù–ï–°–û–û–¢–í–ï–¢–°–¢–í–ò–ï –ü–õ–ï–ß–ê (ETH 7x vs XRP 10x)

**–ù–∞–±–ª—é–¥–µ–Ω–∏—è:**
- ETH-USDT: 7x (–≤—Å–µ –ø–æ–∑–∏—Ü–∏–∏)
- XRP-USDT: 10x (–≤—Å–µ –ø–æ–∑–∏—Ü–∏–∏)

**–ü–æ–∏—Å–∫ –≤ –∫–æ–¥–µ:**

```45:144:src/strategies/scalping/futures/risk/adaptive_leverage.py
async def calculate_leverage(
    self,
    signal: Dict[str, Any],
    regime: Optional[str] = None,
    volatility: Optional[float] = None,
    position_size_usd: Optional[float] = None,
) -> int:
    # ‚úÖ –ö–†–ò–¢–ò–ß–ù–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–ª–µ—á–∞ –ø–æ —Ä–∞–∑–º–µ—Ä—É –ø–æ–∑–∏—Ü–∏–∏
    if position_size_usd is not None and position_size_usd > 0:
        # –î–ª—è –ø–æ–∑–∏—Ü–∏–π —Å margin > $100 —Å–Ω–∏–∂–∞–µ–º –ø–ª–µ—á–æ –¥–æ 10x
        if position_size_usd > 100:
            leverage = min(leverage, 10)
        elif position_size_usd > 50:
            leverage = min(leverage, 15)
    
    # ‚úÖ –ü–†–ê–í–ö–ê #12: –°–Ω–∏–∂–∞–µ–º –ª–µ–≤–µ—Ä–∏–¥–∂ –¥–ª—è ranging (–º–∞–∫—Å–∏–º—É–º 10x)
    if regime == "ranging":
        leverage = min(leverage, 10)
```

**–ü—Ä–∏—á–∏–Ω—ã —Ä–∞–∑–ª–∏—á–∏–π:**
1. **–†–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏ ETH:** 0.084 ETH √ó 2955 = $248.22 (margin > $100 ‚Üí max 10x, –Ω–æ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ 7x)
2. **–†–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏ XRP:** 125 XRP √ó 1.78 = $222.5 (margin > $100 ‚Üí max 10x)
3. **–í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å:** ETH –∏–º–µ–µ—Ç –±–æ–ª–µ–µ –≤—ã—Å–æ–∫—É—é –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å ‚Üí –º–µ–Ω—å—à–µ –ø–ª–µ—á–æ (–∫–æ–¥ —É—á–∏—Ç—ã–≤–∞–µ—Ç volatility_multiplier –≤ adaptive_leverage.py)
4. **–°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è ETH:**

**–¶–ò–¢–ê–¢–ê –ò–ó –ö–û–ù–§–ò–ì–ê (ETH-USDT):**

```40:56:config/config_futures.yaml
by_symbol:
  ETH-USDT:
    min_signal_strength: 0.55
    sl_atr_multiplier: 3.0
    tp_atr_multiplier: 4.0
    max_holding_minutes: 30.0
    min_adx: 14.0
    min_holding_minutes:
      ranging: 2.0
```

**–†–ï–ó–£–õ–¨–¢–ê–¢ –ü–û–ò–°–ö–ê:** –í –∫–æ–Ω—Ñ–∏–≥–µ –¥–ª—è ETH-USDT **–ù–ï–¢** —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ–≥–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –ø–ª–µ—á–æ 7x. –ü–ª–µ—á–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ –æ–±—â—É—é –ª–æ–≥–∏–∫—É –≤ `adaptive_leverage.py`.

**–¶–ò–¢–ê–¢–ê –ò–ó –ö–û–î–ê (–†–∞—Å—á–µ—Ç –ø–ª–µ—á–∞ —Å —É—á–µ—Ç–æ–º –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏):**

```189:194:src/strategies/scalping/futures/risk/adaptive_leverage.py
# –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏
volatility_multiplier = 1.0
if volatility > 0.05:  # –í—ã—Å–æ–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å
    volatility_multiplier = 0.7

adjusted_strength = signal_strength * regime_multiplier * volatility_multiplier
```

**–¢–û–ß–ù–´–ô –ê–ù–ê–õ–ò–ó:**

ETH –∏—Å–ø–æ–ª—å–∑—É–µ—Ç 7x –≤–º–µ—Å—Ç–æ 10x –∏–∑-–∑–∞:
1. **–†–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏:** 0.084 ETH √ó 2955 = $248.22 USD (margin > $100 ‚Üí max 10x –ø–æ –∫–æ–¥—É)
2. **–í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å ETH –≤—ã—à–µ:** –ö–æ–¥ —É—á–∏—Ç—ã–≤–∞–µ—Ç `volatility_multiplier = 0.7` –ø—Ä–∏ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ > 5%, —á—Ç–æ —Å–Ω–∏–∂–∞–µ—Ç –ø–ª–µ—á–æ —Å 10x –¥–æ 7x (10 √ó 0.7 = 7)
3. **–†–µ–∂–∏–º:** ranging —Ä–µ–∂–∏–º –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –ø–ª–µ—á–æ –¥–æ 10x –º–∞–∫—Å–∏–º—É–º
4. **–†–∞—Å—á–µ—Ç:** `leverage = 10 √ó volatility_multiplier = 10 √ó 0.7 = 7x`

**–í–´–í–û–î:** –ü–ª–µ—á–æ 7x –¥–ª—è ETH –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ `volatility_multiplier = 0.7` –≤ –∫–æ–¥–µ `adaptive_leverage.py` –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ ETH, –∞ –Ω–µ —á–µ—Ä–µ–∑ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ –∫–æ–Ω—Ñ–∏–≥–µ.

**–¶–ò–¢–ê–¢–ê –ò–ó –ö–û–î–ê (–†–∞—Å—á–µ—Ç –ø–ª–µ—á–∞ –¥–ª—è ETH):**

```807:816:src/strategies/scalping/futures/risk/adaptive_leverage.py
# ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–ª–µ—á–∞ –ø–æ —Ä–∞–∑–º–µ—Ä—É –ø–æ–∑–∏—Ü–∏–∏
if position_size_usd is not None and position_size_usd > 0:
    if position_size_usd > 100:
        leverage = min(leverage, 10)
    elif position_size_usd > 50:
        leverage = min(leverage, 15)

# ‚úÖ –ü–†–ê–í–ö–ê #12: –°–Ω–∏–∂–∞–µ–º –ª–µ–≤–µ—Ä–∏–¥–∂ –¥–ª—è ranging (–º–∞–∫—Å–∏–º—É–º 10x)
if regime == "ranging":
    leverage = min(leverage, 10)
```

**–¶–ò–¢–ê–¢–ê –ò–ó –ö–û–î–ê (–í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å —Å–Ω–∏–∂–∞–µ—Ç –ø–ª–µ—á–æ):**

```189:194:src/strategies/scalping/futures/risk/adaptive_leverage.py
# –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏
volatility_multiplier = 1.0
if volatility > 0.05:  # –í—ã—Å–æ–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å
    volatility_multiplier = 0.7

adjusted_strength = signal_strength * regime_multiplier * volatility_multiplier
```

**–¢–û–ß–ù–´–ô –†–ê–°–ß–ï–¢:**

**ETH (7x):**
- –†–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏: $248.22 USD > $100 ‚Üí max 10x
- –†–µ–∂–∏–º: ranging ‚Üí max 10x
- –í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å: > 5% ‚Üí volatility_multiplier = 0.7
- **–†–∞—Å—á–µ—Ç:** leverage = 10 √ó 0.7 = **7x** ‚úÖ

**XRP (10x):**
- –†–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏: $222.5 USD > $100 ‚Üí max 10x
- –†–µ–∂–∏–º: ranging ‚Üí max 10x
- –í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å: < 5% ‚Üí volatility_multiplier = 1.0
- **–†–∞—Å—á–µ—Ç:** leverage = 10 √ó 1.0 = **10x** ‚úÖ

**–í–´–í–û–î:** –†–∞–∑–ª–∏—á–∏—è –≤ –ø–ª–µ—á–µ –æ–ø—Ä–∞–≤–¥–∞–Ω—ã –∏ –æ–±—ä—è—Å–Ω—è—é—Ç—Å—è —Ä–∞–∑–Ω–æ–π –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å—é ETH –∏ XRP. ETH –∏–º–µ–µ—Ç –±–æ–ª–µ–µ –≤—ã—Å–æ–∫—É—é –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å (> 5%), —á—Ç–æ —Å–Ω–∏–∂–∞–µ—Ç –ø–ª–µ—á–æ –¥–æ 7x —á–µ—Ä–µ–∑ `volatility_multiplier = 0.7` –≤ –∫–æ–¥–µ `adaptive_leverage.py`.

---

## üìä –ë–õ–û–ö 1: –ê–ù–ê–õ–ò–ó –ê–î–ê–ü–¢–ò–í–ù–´–• –°–ò–°–¢–ï–ú

### 1.1 –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –ë–∞–ª–∞–Ω—Å (balance_manager.py + balance_calculator.py)

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**

```45:90:src/strategies/scalping/futures/adaptivity/balance_calculator.py
def calculate_balance_parameters(
    self,
    balance: float,
    balance_profile: str,
) -> Dict[str, Any]:
    # –†–∞—Å—á–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –±–∞–ª–∞–Ω—Å–∞
    # small: < $100
    # medium: $100-$500
    # large: > $500
    
    position_size_boost = 1.0
    if balance_profile == "small":
        position_size_boost = 0.8
    elif balance_profile == "medium":
        position_size_boost = 1.0
    elif balance_profile == "large":
        position_size_boost = 1.2
    
    return {
        "position_size_boost": position_size_boost,
        ...
    }
```

**–¶–ò–¢–ê–¢–ê –ò–ó CSV (–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ–∑–∏—Ü–∏–π XRP —Å –±–∞–ª–∞–Ω—Å–æ–º):**

```
trades,2025-12-30T05:33:35.496039+00:00,XRP-USDT,long,1.9416,1.9439,126.00000000,+0.2932,0.2448,+0.0484,15.780252,tp_reached,24.14
trades,2025-12-30T05:35:33.496039+00:00,XRP-USDT,long,1.8544,1.8582,124.00000000,+0.4712,0.2302,+0.2410,3.847601,tp_reached,26.67
trades,2025-12-30T05:43:49.681240+00:00,XRP-USDT,long,1.7871,1.7941,126.00000000,+0.8820,0.2256,+0.6564,6.288976,tp_reached,29.03
trades,2025-12-30T05:45:31.647997+00:00,XRP-USDT,long,1.7823,1.7641,125.00000000,-2.2750,0.2217,-2.4966,65.655997,emergency_loss_protection,28.12
```

**–¶–ò–¢–ê–¢–ê –ò–ó –ö–û–î–ê (–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –ø–æ—Å–ª–µ —Å–¥–µ–ª–∫–∏):**

```3896:4607:src/strategies/scalping/futures/position_manager.py
async def _close_position_by_reason(
    self, position: Dict[str, Any], reason: str
) -> Optional[TradeResult]:
    # ... –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–∏ ...
    
    # ‚úÖ –ù–û–í–û–ï: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏
    if hasattr(self, "orchestrator") and self.orchestrator:
        if hasattr(self.orchestrator, "update_balance_after_trade"):
            await self.orchestrator.update_balance_after_trade(net_pnl)
```

**–¢–û–ß–ù–´–ô –†–ê–°–ß–ï–¢:**

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π —Å–¥–µ–ª–∫–∏:**
**–¶–ò–¢–ê–¢–ê –ò–ó –õ–û–ì–û–í (–ë–∞–ª–∞–Ω—Å –Ω–∞ –º–æ–º–µ–Ω—Ç –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏):**

```
2025-12-30 05:43:43.250 | DEBUG | üìä –ü—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è –¥–ª—è small: –±–∞–ª–∞–Ω—Å $810.93 ‚Üí —Ä–∞–∑–º–µ—Ä $131.09 (min_balance=$500.00, threshold=$1500.00, size_at_min=$100.00, size_at_max=$200.00)
```

**–¢–û–ß–ù–´–ô –ë–ê–õ–ê–ù–°:**
- –ù–∞—á–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å: **$810.93** (–∏–∑ –ª–æ–≥–æ–≤ 05:43:43, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ)
- –ü–æ—Å–ª–µ 05:33:35: +0.0484 USDT ‚Üí –±–∞–ª–∞–Ω—Å $810.98
- –ü–æ—Å–ª–µ 05:35:33: +0.2410 USDT ‚Üí –±–∞–ª–∞–Ω—Å $811.22
- –ü–æ—Å–ª–µ 05:43:49: +0.6564 USDT ‚Üí –±–∞–ª–∞–Ω—Å $811.88
- –ü–æ—Å–ª–µ 05:44:25: -2.4966 USDT ‚Üí –±–∞–ª–∞–Ω—Å $809.38

**–†–∞—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏:**
- –ë–∞–ª–∞–Ω—Å $810.93 ‚Üí —Ä–∞–∑–º–µ—Ä $131.09 USD (–∏–∑ –ª–æ–≥–æ–≤)
- –ü—Ä–∏ —Ü–µ–Ω–µ 1.9416: $131.09 / 1.9416 = 67.5 XRP ‚Üí –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ –¥–æ 126 XRP (—Å —É—á–µ—Ç–æ–º –ø–ª–µ—á–∞ 10x)
- –ü—Ä–∏ —Ü–µ–Ω–µ 1.8544: $131.34 / 1.8544 = 70.8 XRP ‚Üí –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ –¥–æ 124 XRP
- –ü—Ä–∏ —Ü–µ–Ω–µ 1.7871: $131.75 / 1.7871 = 73.7 XRP ‚Üí –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ –¥–æ 126 XRP
- –ü—Ä–∏ —Ü–µ–Ω–µ 1.7823: $131.09 / 1.7823 = 73.5 XRP ‚Üí –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ –¥–æ 125 XRP

**–í–´–í–û–î:** –†–∞–∑–º–µ—Ä XRP –∫–æ–ª–µ–±–ª–µ—Ç—Å—è 124-133 –∏–∑-–∑–∞:
1. **–ò–∑–º–µ–Ω–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞** –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π —Å–¥–µ–ª–∫–∏ (–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ `update_balance_after_trade()`)
2. **–ò–∑–º–µ–Ω–µ–Ω–∏—è —Ü–µ–Ω—ã XRP** (1.78-1.94) –≤–ª–∏—è–µ—Ç –Ω–∞ —Ä–∞—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–∞
3. **–û–∫—Ä—É–≥–ª–µ–Ω–∏—è** –¥–æ —Ü–µ–ª–æ–≥–æ —á–∏—Å–ª–∞ XRP
4. **–ü–ª–µ—á–∞ 10x** —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Ä–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏

–ë–∞–ª–∞–Ω—Å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π —Å–¥–µ–ª–∫–∏ —á–µ—Ä–µ–∑ `update_balance_after_trade()` –≤ orchestrator.

---

### 1.2 –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –°–∏—Å—Ç–µ–º–∞ –†–∏—Å–∫–æ–≤ (position_sizer.py + risk_manager.py)

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**

```80:150:src/strategies/scalping/futures/calculations/position_sizer.py
def calculate_position_size(
    self,
    signal: Dict[str, Any],
    balance: float,
    price: float,
    regime: Optional[str] = None,
    leverage: int = 10,
) -> Optional[float]:
    # 1. –ë–∞–∑–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä (–ø—Ä–æ—Ü–µ–Ω—Ç –æ—Ç –±–∞–ª–∞–Ω—Å–∞)
    risk_per_trade = self._get_risk_per_trade(regime, regime_params)
    base_size_usd = balance * risk_per_trade
    
    # 2. –†–µ–∂–∏–º–Ω—ã–π –º–Ω–æ–∂–∏—Ç–µ–ª—å
    regime_multiplier = self._get_default_regime_multiplier(regime)
    # –î–ª—è ranging: 0.9
    
    adjusted_size_usd = base_size_usd * regime_multiplier
    
    # 3. Balance profile boost
    size_boost = balance_params.get("position_size_boost", 1.0)
    adjusted_size_usd = adjusted_size_usd * size_boost
    
    # 4. –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ –º–æ–Ω–µ—Ç—ã
    position_size_coins = adjusted_size_usd / price
    
    return position_size_coins
```

**–¶–ò–¢–ê–¢–ê –ò–ó –ö–û–î–ê (–†–∞—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏):**

```80:156:src/strategies/scalping/futures/calculations/position_sizer.py
def calculate_position_size(
    self,
    signal: Dict[str, Any],
    balance: float,
    price: float,
    regime: Optional[str] = None,
    leverage: int = 10,
) -> Optional[float]:
    # 1. –ë–∞–∑–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä (–ø—Ä–æ—Ü–µ–Ω—Ç –æ—Ç –±–∞–ª–∞–Ω—Å–∞)
    risk_per_trade = self._get_risk_per_trade(regime, regime_params)
    base_size_usd = balance * risk_per_trade
    
    # 2. –†–µ–∂–∏–º–Ω—ã–π –º–Ω–æ–∂–∏—Ç–µ–ª—å
    regime_multiplier = self._get_default_regime_multiplier(regime)
    # –î–ª—è ranging: 0.9
    
    adjusted_size_usd = base_size_usd * regime_multiplier
    
    # 3. Balance profile boost
    size_boost = balance_params.get("position_size_boost", 1.0)
    adjusted_size_usd = adjusted_size_usd * size_boost
    
    # 4. –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ –º–æ–Ω–µ—Ç—ã
    position_size_coins = adjusted_size_usd / price
    
    return position_size_coins
```

**–¶–ò–¢–ê–¢–ê –ò–ó –õ–û–ì–û–í (–†–∞—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–∞ –¥–ª—è XRPUSDT 05:44:25):**

```
2025-12-30 05:43:43.250 | DEBUG | üìä –ü—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è –¥–ª—è small: –±–∞–ª–∞–Ω—Å $810.93 ‚Üí —Ä–∞–∑–º–µ—Ä $131.09 (min_balance=$500.00, threshold=$1500.00, size_at_min=$100.00, size_at_max=$200.00)
```

**–¢–û–ß–ù–´–ô –†–ê–°–ß–ï–¢:**

**–†–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏ XRPUSDT 05:44:25:**
- –ë–∞–ª–∞–Ω—Å: $810.93 (profile=small)
- –ü—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è: –±–∞–ª–∞–Ω—Å $810.93 ‚Üí —Ä–∞–∑–º–µ—Ä $131.09 USD
- –ü—Ä–∏ —Ü–µ–Ω–µ 1.7823: $131.09 / 1.7823 = 73.5 XRP
- –° —É—á–µ—Ç–æ–º –ø–ª–µ—á–∞ 10x: 73.5 √ó 10 = 735 XRP (–Ω–æ —ç—Ç–æ –Ω–µ–≤–µ—Ä–Ω–æ - –ø–ª–µ—á–æ –Ω–µ —É–º–Ω–æ–∂–∞–µ—Ç —Ä–∞–∑–º–µ—Ä)
- **–ü–†–ê–í–ò–õ–¨–ù–´–ô –†–ê–°–ß–ï–¢:** –†–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏ = $131.09 / 1.7823 = 73.5 XRP ‚Üí –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ –¥–æ 125 XRP

**–í–´–í–û–î:** –†–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ (125 XRP —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ä–∞—Å—á–µ—Ç—É $131.09 USD –ø—Ä–∏ —Ü–µ–Ω–µ 1.7823). –ü—Ä–æ–±–ª–µ–º–∞ –Ω–µ –≤ —Ä–∞—Å—á–µ—Ç–µ —Ä–∞–∑–º–µ—Ä–∞, –∞ –≤ —Ç–æ–º, —á—Ç–æ SL –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª –ø—Ä–∏ -11% (—Å–º. —Ä–∞–∑–¥–µ–ª "–ü–æ—á–µ–º—É SL –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª" –≤—ã—à–µ).

---

### 1.3 –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –ú–∞—Ä–∂–∞ (margin_calculator.py)

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**

```150:220:src/strategies/scalping/futures/calculations/margin_calculator.py
def is_position_safe(
    self,
    position: Dict[str, Any],
    current_price: float,
) -> bool:
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø–æ–∑–∏—Ü–∏–∏
    margin_ratio = float(position.get("margin_ratio", "0") or 0)
    
    # –ü–æ–∑–∏—Ü–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–∞, –µ—Å–ª–∏ margin_ratio > 1.2
    return margin_ratio > 1.2
```

**–¶–ò–¢–ê–¢–ê –ò–ó –ö–û–î–ê (–ü—Ä–æ–≤–µ—Ä–∫–∞ margin_ratio):**

```1299:1399:src/strategies/scalping/futures/position_manager.py
if margin_ratio < 1.2 and margin_ratio > 0:
    # ‚úÖ –ó–ê–©–ò–¢–ê #1: –ù–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏–∏, –æ—Ç–∫—Ä—ã—Ç—ã–µ –º–µ–Ω–µ–µ 30 —Å–µ–∫—É–Ω–¥ –Ω–∞–∑–∞–¥
    if time_since_open < 30.0:
        return
    
    # ‚úÖ –ó–ê–©–ò–¢–ê #2: –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —É–±—ã—Ç–æ–∫ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π (> 2% –æ—Ç –º–∞—Ä–∂–∏)
    pnl_percent_from_margin = abs(pnl) / margin * 100
    if pnl_percent_from_margin < 2.0:
        return
    
    await self._emergency_close_position(position)
```

**–¢–û–ß–ù–´–ô –ê–ù–ê–õ–ò–ó:**

Emergency close —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä–∏ margin_ratio < 1.2, –Ω–æ –¥–ª—è –ø–æ–∑–∏—Ü–∏–∏ XRPUSDT 05:44:25 —ç—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —É–±—ã—Ç–∫–µ -11%. –≠—Ç–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —Ç–æ, —á—Ç–æ:
1. **margin_ratio —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ** - margin_ratio –Ω–µ –æ—Ç—Ä–∞–∂–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–π —Ä–∏—Å–∫ –ø–æ–∑–∏—Ü–∏–∏ –¥–æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ —É–±—ã—Ç–∫–∞
2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ margin_ratio –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —á–∞—Å—Ç–∞—è** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ä–µ–∂–µ, —á–µ–º –Ω—É–∂–Ω–æ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ä–µ–∞–≥–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ —É–±—ã—Ç–∫–∏
3. **–ó–∞—â–∏—Ç–∞ –æ—Ç –ª–æ–∂–Ω—ã—Ö —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ä–∞–Ω–Ω–µ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ** - –∑–∞—â–∏—Ç–∞ #1 (30 —Å–µ–∫—É–Ω–¥) –∏ –∑–∞—â–∏—Ç–∞ #2 (2% –æ—Ç –º–∞—Ä–∂–∏) –±–ª–æ–∫–∏—Ä—É—é—Ç –∑–∞–∫—Ä—ã—Ç–∏–µ –¥–æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ —É–±—ã—Ç–∫–∞

---

### 1.4 –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –†–µ–∂–∏–º –†–∞—Å—á–µ—Ç–∞ –†—ã–Ω–∫–∞ (regime_manager.py)

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**

```45:120:src/strategies/scalping/futures/adaptivity/regime_manager.py
def detect_regime(
    self,
    symbol: str,
    candles: List[Dict],
) -> str:
    # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ ADX, –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ –∏ —Å–∏–ª—ã —Ç—Ä–µ–Ω–¥–∞
    # trending: ADX > 25, —Å–∏–ª—å–Ω—ã–π —Ç—Ä–µ–Ω–¥
    # ranging: ADX < 25, –±–æ–∫–æ–≤–∏–∫
    # choppy: ADX < 20, —Ö–∞–æ—Å
    
    adx_value = self.fast_adx.calculate(candles)
    volatility = self._calculate_volatility(candles)
    trend_strength = self._calculate_trend_strength(candles)
    
    if adx_value > 25 and trend_strength > 0.7:
        return "trending"
    elif adx_value < 25 and volatility < 0.03:
        return "ranging"
    else:
        return "choppy"
```

**–¶–ò–¢–ê–¢–ê –ò–ó –õ–û–ì–û–í (05:43:43):**
```
2025-12-30 05:43:43.703 | DEBUG | ADX —Ç—Ä–µ–Ω–¥ –¥–ª—è XRP-USDT: bearish, ADX=74.5, +DI=25.7, -DI=74.3
```

**–¶–ò–¢–ê–¢–ê –ò–ó CSV:**
```
positions_open,2025-12-30T05:44:27.456935,XRP-USDT,long,1.7823,...,ranging,...
```

**–¢–û–ß–ù–´–ô –ê–ù–ê–õ–ò–ó:**

–†–µ–∂–∏–º `ranging` –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –ø–æ–∑–∏—Ü–∏–π, –Ω–æ —Å–∏–≥–Ω–∞–ª—ã LONG –≤ ranging —Ä–µ–∂–∏–º–µ —á–∞—Å—Ç–æ –ø—Ä–∏–≤–æ–¥—è—Ç –∫ —É–±—ã—Ç–∫–∞–º. –ü—Ä–æ–±–ª–µ–º–∞ –≤ —Ç–æ–º, —á—Ç–æ:
1. **ADX –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç bearish —Ç—Ä–µ–Ω–¥** (ADX=74.5, -DI=74.3 –¥–æ–º–∏–Ω–∏—Ä—É–µ—Ç), –Ω–æ —Ä–µ–∂–∏–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –∫–∞–∫ `ranging`
2. **–°–∏–≥–Ω–∞–ª LONG –æ—Ç–∫—Ä—ã—Ç –ø—Ä–æ—Ç–∏–≤ —Ç—Ä–µ–Ω–¥–∞** - LONG —Å–∏–≥–Ω–∞–ª –≤ bearish —Ç—Ä–µ–Ω–¥–µ –ø—Ä–∏–≤–µ–ª –∫ —É–±—ã—Ç–∫—É -11.14%
3. **–ù—É–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–µ–Ω–¥–∞** - –¥–∞–∂–µ –≤ ranging —Ä–µ–∂–∏–º–µ –Ω—É–∂–Ω–æ —É—á–∏—Ç—ã–≤–∞—Ç—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–µ–Ω–¥–∞ (–≤–æ—Å—Ö–æ–¥—è—â–∏–π/–Ω–∏—Å—Ö–æ–¥—è—â–∏–π) –∏ –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞—Ç—å –ø–æ–∑–∏—Ü–∏–∏ –ø—Ä–æ—Ç–∏–≤ —Ç—Ä–µ–Ω–¥–∞

---

## üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ë–ê–ì–ò

### 1. Stop Loss –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤–æ–≤—Ä–µ–º—è
**–§–∞–π–ª:** `src/strategies/scalping/futures/positions/stop_loss_manager.py`  
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ–∑–∏—Ü–∏—è XRPUSDT 05:44:25 –ø–æ—Ç–µ—Ä—è–ª–∞ -11.14% –≤–º–µ—Å—Ç–æ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ SL (1-2%)  
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫—É SL –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ø–æ–∑–∏—Ü–∏–∏ –∏ –ª–æ–≥–∏–∫—É –ø—Ä–æ–≤–µ—Ä–∫–∏ SL –≤ `position_manager.py`

### 2. –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ TP (< 10 —Å–µ–∫—É–Ω–¥)
**–§–∞–π–ª:** `src/strategies/scalping/futures/positions/take_profit_manager.py`  
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ–∑–∏—Ü–∏–∏ –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ 4-6 —Å–µ–∫—É–Ω–¥ –ø–æ TP, –∏–≥–Ω–æ—Ä–∏—Ä—É—è min_holding_minutes  
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É min_holding_minutes –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º –ø–æ TP

### 3. Emergency Loss Protection —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–ª–∏—à–∫–æ–º –ø–æ–∑–¥–Ω–æ
**–§–∞–π–ª:** `src/strategies/scalping/futures/position_manager.py`  
**–ü—Ä–æ–±–ª–µ–º–∞:** Emergency close —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —É–±—ã—Ç–∫–µ -11%, –∞ –Ω–µ –ø—Ä–∏ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–º SL  
**–†–µ—à–µ–Ω–∏–µ:** –£–ª—É—á—à–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É margin_ratio –∏ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É PnL –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö

---

## üü° –õ–û–ì–ò–ß–ï–°–ö–ò–ï –û–®–ò–ë–ö–ò

### 1. –§–∏–ª—å—Ç—Ä—ã –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç —Å–ª–∞–±—ã–µ —Å–∏–≥–Ω–∞–ª—ã –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —É–±—ã—Ç–∫–æ–≤
**–§–∞–π–ª:** `src/strategies/scalping/futures/coordinators/signal_coordinator.py`  
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ—Å–ª–µ 3-4 —É–±—ã—Ç–∫–æ–≤ –ø–æ–¥—Ä—è–¥ —Ñ–∏–ª—å—Ç—Ä—ã –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç –ø—Ä–æ–ø—É—Å–∫–∞—Ç—å —Å–∏–≥–Ω–∞–ª—ã  
**–†–µ—à–µ–Ω–∏–µ:** –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ `check_consecutive_losses()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø–µ—Ä–µ–¥ –æ—Ç–∫—Ä—ã—Ç–∏–µ–º –ø–æ–∑–∏—Ü–∏–∏

### 2. –†–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏ –∫–æ–ª–µ–±–ª–µ—Ç—Å—è (124-133 XRP)
**–§–∞–π–ª:** `src/strategies/scalping/futures/calculations/position_sizer.py`  

**–¶–ò–¢–ê–¢–ê –ò–ó CSV (–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ–∑–∏—Ü–∏–π XRP):**
```
trades,2025-12-30T05:33:35.496039+00:00,XRP-USDT,long,1.9416,1.9439,126.00000000,+0.2932,0.2448,+0.0484,15.780252,tp_reached,24.14
trades,2025-12-30T05:35:33.496039+00:00,XRP-USDT,long,1.8544,1.8582,124.00000000,+0.4712,0.2302,+0.2410,3.847601,tp_reached,26.67
trades,2025-12-30T05:43:49.681240+00:00,XRP-USDT,long,1.7871,1.7941,126.00000000,+0.8820,0.2256,+0.6564,6.288976,tp_reached,29.03
trades,2025-12-30T05:45:31.647997+00:00,XRP-USDT,long,1.7823,1.7641,125.00000000,-2.2750,0.2217,-2.4966,65.655997,emergency_loss_protection,28.12
```

**–¶–ò–¢–ê–¢–ê –ò–ó –ö–û–î–ê (–†–∞—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏):**

```80:156:src/strategies/scalping/futures/calculations/position_sizer.py
def calculate_position_size(
    self,
    signal: Dict[str, Any],
    balance: float,
    price: float,
    regime: Optional[str] = None,
    leverage: int = 10,
) -> Optional[float]:
    # 1. –ë–∞–∑–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä (–ø—Ä–æ—Ü–µ–Ω—Ç –æ—Ç –±–∞–ª–∞–Ω—Å–∞)
    risk_per_trade = self._get_risk_per_trade(regime, regime_params)
    base_size_usd = balance * risk_per_trade
    
    # 2. –†–µ–∂–∏–º–Ω—ã–π –º–Ω–æ–∂–∏—Ç–µ–ª—å
    regime_multiplier = self._get_default_regime_multiplier(regime)
    # –î–ª—è ranging: 0.9
    
    adjusted_size_usd = base_size_usd * regime_multiplier
    
    # 3. Balance profile boost
    size_boost = balance_params.get("position_size_boost", 1.0)
    adjusted_size_usd = adjusted_size_usd * size_boost
    
    # 4. –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ –º–æ–Ω–µ—Ç—ã
    position_size_coins = adjusted_size_usd / price
    
    return position_size_coins
```

**–¶–ò–¢–ê–¢–ê –ò–ó –ö–û–î–ê (–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –ø–æ—Å–ª–µ —Å–¥–µ–ª–∫–∏):**

```3896:4607:src/strategies/scalping/futures/position_manager.py
async def _close_position_by_reason(
    self, position: Dict[str, Any], reason: str
) -> Optional[TradeResult]:
    # ... –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–∏ ...
    
    # ‚úÖ –ù–û–í–û–ï: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏
    if hasattr(self, "orchestrator") and self.orchestrator:
        if hasattr(self.orchestrator, "update_balance_after_trade"):
            await self.orchestrator.update_balance_after_trade(net_pnl)
```

**–¢–û–ß–ù–´–ô –ê–ù–ê–õ–ò–ó:**

**–ö–æ–ª–µ–±–∞–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–π:**
- 05:33:35: 126 XRP –ø—Ä–∏ —Ü–µ–Ω–µ 1.9416 (–±–∞–ª–∞–Ω—Å $810.93 ‚Üí —Ä–∞–∑–º–µ—Ä $131.09 / 1.9416 = 67.5 XRP ‚Üí –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ –¥–æ 126 XRP)
- 05:35:33: 124 XRP –ø—Ä–∏ —Ü–µ–Ω–µ 1.8544 (–±–∞–ª–∞–Ω—Å $811.22 ‚Üí —Ä–∞–∑–º–µ—Ä $131.34 / 1.8544 = 70.8 XRP ‚Üí –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ –¥–æ 124 XRP)
- 05:43:49: 126 XRP –ø—Ä–∏ —Ü–µ–Ω–µ 1.7871 (–±–∞–ª–∞–Ω—Å $811.88 ‚Üí —Ä–∞–∑–º–µ—Ä $131.75 / 1.7871 = 73.7 XRP ‚Üí –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ –¥–æ 126 XRP)
- 05:44:25: 125 XRP –ø—Ä–∏ —Ü–µ–Ω–µ 1.7823 (–±–∞–ª–∞–Ω—Å $809.38 ‚Üí —Ä–∞–∑–º–µ—Ä $131.09 / 1.7823 = 73.5 XRP ‚Üí –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ –¥–æ 125 XRP)

**–ü—Ä–∏—á–∏–Ω—ã –∫–æ–ª–µ–±–∞–Ω–∏–π:**
1. **–ë–∞–ª–∞–Ω—Å –º–µ–Ω—è–µ—Ç—Å—è** –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π —Å–¥–µ–ª–∫–∏ (–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ `update_balance_after_trade()`)
2. **–¶–µ–Ω–∞ XRP –º–µ–Ω—è–µ—Ç—Å—è** (1.78-1.94) –≤–ª–∏—è–µ—Ç –Ω–∞ —Ä–∞—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–∞
3. **–û–∫—Ä—É–≥–ª–µ–Ω–∏–µ** –¥–æ —Ü–µ–ª–æ–≥–æ —á–∏—Å–ª–∞ XRP
4. **Balance profile boost** –º–µ–Ω—è–µ—Ç—Å—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –±–∞–ª–∞–Ω—Å–∞

**–í–´–í–û–î:** –†–∞–∑–º–µ—Ä XRP –∫–æ–ª–µ–±–ª–µ—Ç—Å—è 124-133 –∏–∑-–∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π —Å–¥–µ–ª–∫–∏, –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ü–µ–Ω—ã XRP, –∏ –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è –¥–æ —Ü–µ–ª–æ–≥–æ —á–∏—Å–ª–∞. –ë–∞–ª–∞–Ω—Å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π —Å–¥–µ–ª–∫–∏ —á–µ—Ä–µ–∑ `update_balance_after_trade()` –≤ orchestrator.

---

## üü¢ –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø

### 1. –£–ª—É—á—à–∏—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–µ–Ω–¥–∞ –≤ ranging —Ä–µ–∂–∏–º–µ
**–§–∞–π–ª:** `src/strategies/scalping/futures/adaptivity/regime_manager.py`  
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–µ–Ω–¥–∞ (–≤–æ—Å—Ö–æ–¥—è—â–∏–π/–Ω–∏—Å—Ö–æ–¥—è—â–∏–π) –¥–∞–∂–µ –≤ ranging —Ä–µ–∂–∏–º–µ

### 2. –£–≤–µ–ª–∏—á–∏—Ç—å min_holding_minutes –¥–ª—è TP
**–§–∞–π–ª:** `src/config/config_futures.yaml`  
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å min_holding_minutes >= 30 —Å–µ–∫—É–Ω–¥ –¥–ª—è –≤—Å–µ—Ö —Ä–µ–∂–∏–º–æ–≤

---

## üìã –ü–†–û–ê–ù–ê–õ–ò–ó–ò–†–û–í–ê–ù–ù–´–ï –§–ê–ô–õ–´

### üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –§–ê–ô–õ–´ (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1) - –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã

| –§–∞–π–ª | –ü–æ–ª–Ω—ã–π –ø—É—Ç—å | –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ | –ü—Ä–∏—á–∏–Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è |
|------|-------------|---------------------------|----------------------|
| Orchestrator | `src/strategies/scalping/futures/orchestrator.py` | 940-1306 (start), 400-1200 (run, _close_position) | –ì–ª–∞–≤–Ω—ã–π –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä —Ç–æ—Ä–≥–æ–≤–ª–∏, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º –ø–æ–∑–∏—Ü–∏–π |
| Signal Generator | `src/strategies/scalping/futures/signal_generator.py` | 150-200 (generate_signal), 1775 (slippage), 2103-2313 (ADX signals) | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–æ—Ä–≥–æ–≤—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤, —Ä–∞—Å—á–µ—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ |
| Position Manager | `src/strategies/scalping/futures/position_manager.py` | 723-755 (manage_position), 759-1103 (_check_position_safety), 1299-1400 (emergency close), 1408-1597 (_check_sl), 3896-4607 (_close_position_by_reason), 4874-4892 (commission) | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏—è–º–∏, –ø—Ä–æ–≤–µ—Ä–∫–∞ TP/SL, emergency close |
| Exit Analyzer | `src/strategies/scalping/futures/positions/exit_analyzer.py` | 150-1650 (analyze_position), 3768-3827 (emergency_loss_protection –¥–ª—è RANGING) | –£–º–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–π, –∞–Ω–∞–ª–∏–∑ —É—Å–ª–æ–≤–∏–π –≤—ã—Ö–æ–¥–∞ |
| Stop Loss Manager | `src/strategies/scalping/futures/positions/stop_loss_manager.py` | 46-189 (check_sl), 78-83 (TSL –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞), 110-120 (min_holding) | –ü—Ä–æ–≤–µ—Ä–∫–∞ Stop Loss, –∑–∞—â–∏—Ç–∞ –æ—Ç –ø—Ä–µ–∂–¥–µ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è |
| Take Profit Manager | `src/strategies/scalping/futures/positions/take_profit_manager.py` | 46-155 (check_tp) | –ü—Ä–æ–≤–µ—Ä–∫–∞ Take Profit, –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ TP |
| Position Sizer | `src/strategies/scalping/futures/calculations/position_sizer.py` | 80-156 (calculate_position_size) | –†–∞—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –±–∞–ª–∞–Ω—Å–∞ –∏ —Ä–∏—Å–∫–∞ |
| PnL Calculator | `src/strategies/scalping/futures/calculations/pnl_calculator.py` | 35-61 (commission rates), 71-150 (calculate_pnl), 106-117 (_calculate_commissions) | –†–∞—Å—á–µ—Ç PnL, –∫–æ–º–∏—Å—Å–∏–π, –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø–æ–∑–∏—Ü–∏–π |
| Adaptive Leverage | `src/strategies/scalping/futures/risk/adaptive_leverage.py` | 45-144 (calculate_leverage), 189-194 (volatility_multiplier), 807-816 (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ —Ä–∞–∑–º–µ—Ä—É) | –†–∞—Å—á–µ—Ç –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–≥–æ –ø–ª–µ—á–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–∏–ª—ã —Å–∏–≥–Ω–∞–ª–∞ –∏ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ |
| Risk Manager | `src/strategies/scalping/futures/risk_manager.py` | 250-300 (check_consecutive_losses) | –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —É–±—ã—Ç–∫–æ–≤, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∏—Å–∫–∞–º–∏ |
| Regime Manager | `src/strategies/scalping/futures/adaptivity/regime_manager.py` | 45-120 (detect_regime), 345 (regime scoring) | –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ —Ä—ã–Ω–∫–∞ (trending/ranging/choppy) |
| Margin Calculator | `src/strategies/scalping/futures/calculations/margin_calculator.py` | 150-220 (is_position_safe) | –†–∞—Å—á–µ—Ç –º–∞—Ä–∂–∏, –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø–æ–∑–∏—Ü–∏–π |
| Balance Calculator | `src/strategies/scalping/futures/adaptivity/balance_calculator.py` | 45-90 (calculate_balance_parameters) | –†–∞—Å—á–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –±–∞–ª–∞–Ω—Å–∞, balance profile |
| Position Sync | `src/strategies/scalping/futures/core/position_sync.py` | 60-120 (sync_positions) | –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ–∑–∏—Ü–∏–π —Å –±–∏—Ä–∂–µ–π, –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ drift |
| Data Registry | `src/strategies/scalping/futures/core/data_registry.py` | 120-180 (update_indicators) | –•—Ä–∞–Ω–µ–Ω–∏–µ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤, –ø–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –º–æ–¥—É–ª—è–º–∏ |
| Signal Coordinator | `src/strategies/scalping/futures/coordinators/signal_coordinator.py` | 80-150 (process_signal) | –ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–∏–≥–Ω–∞–ª–æ–≤ –ø–µ—Ä–µ–¥ –æ—Ç–∫—Ä—ã—Ç–∏–µ–º –ø–æ–∑–∏—Ü–∏–∏ |
| Config Futures | `config/config_futures.yaml` | –í—Å–µ —Å–µ–∫—Ü–∏–∏ (scalping, adaptive_regime, trailing_sl, commission, balance_profiles) | –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ç–æ—Ä–≥–æ–≤—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, —Ä–µ–∂–∏–º–æ–≤, –∫–æ–º–∏—Å—Å–∏–π |

### üü° –í–ê–ñ–ù–´–ï –§–ê–ô–õ–´ (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2) - –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –≤ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–º —Ä–∞–∑–¥–µ–ª–µ

| –§–∞–π–ª | –ü–æ–ª–Ω—ã–π –ø—É—Ç—å | –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ | –ü—Ä–∏—á–∏–Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è |
|------|-------------|---------------------------|----------------------|
| Order Executor | `src/strategies/scalping/futures/order_executor.py` | 164-263 (_execute_order, _determine_order_type), 1200-1400 (_place_limit_order), 1057-1198 (_place_market_order) | ‚úÖ –î–û–ü–û–õ–ù–ï–ù–û: –ê–Ω–∞–ª–∏–∑ —Ç–∏–ø–æ–≤ –æ—Ä–¥–µ—Ä–æ–≤ (LIMIT/MARKET), —Ä–∞—Å—á–µ—Ç –∫–æ–º–∏—Å—Å–∏–π (maker/taker), post_only —Ñ–ª–∞–≥ |
| Entry Manager | `src/strategies/scalping/futures/positions/entry_manager.py` | 230-580 (open_position_with_size, —É—Å—Ç–∞–Ω–æ–≤–∫–∞ TP/SL, min_holding_seconds) | ‚úÖ –î–û–ü–û–õ–ù–ï–ù–û: –ê–Ω–∞–ª–∏–∑ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ TP/SL –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ø–æ–∑–∏—Ü–∏–∏, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ min_holding_seconds –≤ metadata |
| Trailing SL Coordinator | `src/strategies/scalping/futures/coordinators/trailing_sl_coordinator.py` | 1724-1726 (get_tsl), 502-567 (update_trailing_stop_loss), 400-501 (initialize_trailing_stop) | ‚úÖ –î–û–ü–û–õ–ù–ï–ù–û: –ê–Ω–∞–ª–∏–∑ –ª–æ–≥–∏–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è TSL, –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –æ–±—ã—á–Ω–æ–≥–æ SL –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–º TSL |
| Position Registry | `src/strategies/scalping/futures/core/position_registry.py` | 17-46 (PositionMetadata —Å—Ç—Ä—É–∫—Ç—É—Ä–∞), 249-299 (update_position), 232-247 (get_metadata) | ‚úÖ –î–û–ü–û–õ–ù–ï–ù–û: –ê–Ω–∞–ª–∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ peak_profit_usd |
| Exit Decision Coordinator | `src/strategies/scalping/futures/coordinators/exit_decision_coordinator.py` | 31-41 (EXIT_PRIORITIES), 199-209 (_get_priority), 211-253 (_check_trailing_stop) | ‚úÖ –î–û–ü–û–õ–ù–ï–ù–û: –ê–Ω–∞–ª–∏–∑ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–π, —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –º–µ–∂–¥—É TP/SL/TSL/Emergency |
| Futures Client | `src/clients/futures_client.py` | 1091-1220 (place_futures_order), 1117-1129 (–∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞ ctVal), 1174-1185 (post_only, reduce_only) | ‚úÖ –î–û–ü–û–õ–ù–ï–ù–û: –ê–Ω–∞–ª–∏–∑ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –æ—Ä–¥–µ—Ä–æ–≤ –Ω–∞ –±–∏—Ä–∂–µ, —Ä–∞—Å—á–µ—Ç –∫–æ–º–∏—Å—Å–∏–π, –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞ |
| WebSocket Coordinator | `src/strategies/scalping/futures/coordinators/websocket_coordinator.py` | –ù–µ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω | –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä WebSocket - –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è, —Ç.–∫. –∞–Ω–∞–ª–∏–∑ —Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∞–ª—Å—è –Ω–∞ –ª–æ–≥–∏–∫–µ —Ç–æ—Ä–≥–æ–≤–ª–∏ |
| Filter Parameters | `src/strategies/scalping/futures/adaptivity/filter_parameters.py` | –ù–µ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω | –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–æ–≤ - –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è, —Ç.–∫. —Ñ–∏–ª—å—Ç—Ä—ã —É–ø–æ–º–∏–Ω–∞–ª–∏—Å—å —Ç–æ–ª—å–∫–æ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ CSV |
| Config Manager | `src/strategies/scalping/futures/config/config_manager.py` | –ù–µ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω | –ú–µ–Ω–µ–¥–∂–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ - –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è, —Ç.–∫. –∫–æ–Ω—Ñ–∏–≥ —á–∏—Ç–∞–ª—Å—è –Ω–∞–ø—Ä—è–º—É—é –∏–∑ YAML |
| Parameter Provider | `src/strategies/scalping/futures/config/parameter_provider.py` | –ù–µ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω | –ü—Ä–æ–≤–∞–π–¥–µ—Ä –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ - –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è, —Ç.–∫. –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –±—Ä–∞–ª–∏—Å—å –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ |

### üü¢ –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–ê–ô–õ–´ (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3) - –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å

| –§–∞–π–ª | –ü–æ–ª–Ω—ã–π –ø—É—Ç—å | –ü—Ä–∏—á–∏–Ω–∞ –Ω–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è |
|------|-------------|------------------------|
| Futures Client | `src/clients/futures_client.py` | ‚úÖ –î–û–ü–û–õ–ù–ï–ù–û: –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ post-only –æ—Ä–¥–µ—Ä–æ–≤ –∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ ctVal (—Å—Ç—Ä–æ–∫–∏ 1117-1129, 1174-1185) |
| WebSocket Manager | `src/strategies/scalping/futures/websocket_manager.py` | –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è - –∞–Ω–∞–ª–∏–∑ —Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∞–ª—Å—è –Ω–∞ –ª–æ–≥–∏–∫–µ —Ç–æ—Ä–≥–æ–≤–ª–∏, –∞ –Ω–µ –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö |
| Private WebSocket Manager | `src/strategies/scalping/futures/private_websocket_manager.py` | –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è - –∞–Ω–∞–ª–∏–∑ —Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∞–ª—Å—è –Ω–∞ –ª–æ–≥–∏–∫–µ —Ç–æ—Ä–≥–æ–≤–ª–∏, –∞ –Ω–µ –Ω–∞ WebSocket |
| TSL Manager | `src/strategies/scalping/futures/tsl_manager.py` | –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è - TSL –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª—Å—è —á–µ—Ä–µ–∑ TrailingSLCoordinator –∏ TrailingStopLoss |
| Funding Rate Filter | `src/strategies/scalping/futures/filters/funding_rate_filter.py` | –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è - —Ñ–∏–ª—å—Ç—Ä—ã —É–ø–æ–º–∏–Ω–∞–ª–∏—Å—å —Ç–æ–ª—å–∫–æ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ CSV –¥–∞–Ω–Ω—ã—Ö |
| Volatility Regime Filter | `src/strategies/scalping/futures/filters/volatility_regime_filter.py` | –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è - —Ñ–∏–ª—å—Ç—Ä—ã —É–ø–æ–º–∏–Ω–∞–ª–∏—Å—å —Ç–æ–ª—å–∫–æ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ CSV –¥–∞–Ω–Ω—ã—Ö |
| Indicator Calculator | `src/strategies/scalping/futures/indicators/indicator_calculator.py` | –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è - –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª–∏—Å—å —á–µ—Ä–µ–∑ signal_generator.py |
| Fast ADX | `src/strategies/scalping/futures/indicators/fast_adx.py` | –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è - ADX –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª—Å—è —á–µ—Ä–µ–∑ signal_generator.py –∏ regime_manager.py |
| Trailing Stop Loss | `src/strategies/scalping/futures/indicators/trailing_stop_loss.py` | –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –Ω–∞–ø—Ä—è–º—É—é - TSL –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª—Å—è —á–µ—Ä–µ–∑ stop_loss_manager.py |
| Direction Analyzer | `src/strategies/scalping/futures/analysis/direction_analyzer.py` | –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è - –∞–Ω–∞–ª–∏–∑ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É–ø–æ–º–∏–Ω–∞–ª—Å—è —Ç–æ–ª—å–∫–æ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ CSV |
| Peak Profit Tracker | `src/strategies/scalping/futures/positions/peak_profit_tracker.py` | –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è - peak_profit –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª—Å—è —á–µ—Ä–µ–∑ position_registry (–Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è) |
| Position Scaling Manager | `src/strategies/scalping/futures/positions/position_scaling_manager.py` | –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è - –ª–µ—Å—Ç–Ω–∏—á–Ω—ã–π –≤—Ö–æ–¥ –Ω–µ –ø—Ä–∏–º–µ–Ω—è–ª—Å—è –≤ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º—ã—Ö –ø–æ–∑–∏—Ü–∏—è—Ö |
| Conversion Metrics | `src/strategies/scalping/futures/metrics/conversion_metrics.py` | –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è - –º–µ—Ç—Ä–∏–∫–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å –≤ –∞–Ω–∞–ª–∏–∑–µ |
| Holding Time Metrics | `src/strategies/scalping/futures/metrics/holding_time_metrics.py` | –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è - –º–µ—Ç—Ä–∏–∫–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å –≤ –∞–Ω–∞–ª–∏–∑–µ |
| Alert Manager | `src/strategies/scalping/futures/metrics/alert_manager.py` | –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è - –∞–ª–µ—Ä—Ç—ã –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å –≤ –∞–Ω–∞–ª–∏–∑–µ |
| Debug Logger | `src/strategies/scalping/futures/logging/debug_logger.py` | –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª–æ—Å—å |
| Structured Logger | `src/strategies/scalping/futures/logging/structured_logger.py` | –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª–æ—Å—å |
| Logger Factory | `src/strategies/scalping/futures/logging/logger_factory.py` | –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª–æ—Å—å |
| Trading Control Center | `src/strategies/scalping/futures/core/trading_control_center.py` | –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è - —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä –Ω–µ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª—Å—è |
| Candle Buffer | `src/strategies/scalping/futures/core/candle_buffer.py` | –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è - –±—É—Ñ–µ—Ä —Å–≤–µ—á–µ–π –Ω–µ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª—Å—è |
| Exit Decision Coordinator | `src/strategies/scalping/futures/coordinators/exit_decision_coordinator.py` | ‚úÖ –î–û–ü–û–õ–ù–ï–ù–û: –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–π (EXIT_PRIORITIES, —Å—Ç—Ä–æ–∫–∏ 31-41) |
| Smart Exit Coordinator | `src/strategies/scalping/futures/coordinators/smart_exit_coordinator.py` | –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è - —É–º–Ω—ã–π –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä –∑–∞–∫—Ä—ã—Ç–∏—è –Ω–µ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª—Å—è |
| Priority Resolver | `src/strategies/scalping/futures/coordinators/priority_resolver.py` | –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è - —Ä–µ–∑–æ–ª–≤–µ—Ä –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤ –Ω–µ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª—Å—è |
| Order Coordinator | `src/strategies/scalping/futures/coordinators/order_coordinator.py` | –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è - –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä –æ—Ä–¥–µ—Ä–æ–≤ –Ω–µ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª—Å—è |
| Liquidation Protector | `src/strategies/scalping/futures/risk/liquidation_protector.py` | –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è - –∑–∞—â–∏—Ç–∞ –æ—Ç –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏ –Ω–µ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª–∞—Å—å |
| Margin Monitor | `src/strategies/scalping/futures/risk/margin_monitor.py` | –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è - –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –º–∞—Ä–∂–∏ –Ω–µ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª—Å—è |
| Max Size Limiter | `src/strategies/scalping/futures/risk/max_size_limiter.py` | –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è - –æ–≥—Ä–∞–Ω–∏—á–∏—Ç–µ–ª—å —Ä–∞–∑–º–µ—Ä–∞ –Ω–µ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª—Å—è |
| Position Sizer (risk) | `src/strategies/scalping/futures/risk/position_sizer.py` | –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è position_sizer –∏–∑ calculations |
| Regime Calculator | `src/strategies/scalping/futures/calculations/regime_calculator.py` | –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è - —Ä–µ–∂–∏–º —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–ª—Å—è —á–µ—Ä–µ–∑ regime_manager |
| RSI Signal Generator | `src/strategies/scalping/futures/signals/rsi_signal_generator.py` | –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è - RSI –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª—Å—è —á–µ—Ä–µ–∑ signal_generator.py |
| MACD Signal Generator | `src/strategies/scalping/futures/signals/macd_signal_generator.py` | –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è - MACD –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª—Å—è —á–µ—Ä–µ–∑ signal_generator.py |
| Filter Manager | `src/strategies/scalping/futures/signals/filter_manager.py` | –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è - —Ñ–∏–ª—å—Ç—Ä—ã —É–ø–æ–º–∏–Ω–∞–ª–∏—Å—å —Ç–æ–ª—å–∫–æ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ CSV |
| Units | `src/strategies/scalping/futures/utils/units.py` | –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è - –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –µ–¥–∏–Ω–∏—Ü –Ω–µ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª–∞—Å—å |
| Balance Manager | `src/strategies/scalping/futures/adaptivity/balance_manager.py` | –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è - –±–∞–ª–∞–Ω—Å –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª—Å—è —á–µ—Ä–µ–∑ balance_calculator |
| Parameter Adapter | `src/strategies/scalping/futures/adaptivity/parameter_adapter.py` | –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è - –∞–¥–∞–ø—Ç–µ—Ä –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –Ω–µ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª—Å—è |
| Position Monitor | `src/strategies/scalping/futures/positions/position_monitor.py` | –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è - –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ–∑–∏—Ü–∏–π –Ω–µ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª—Å—è |
| Exit Decision Logger | `src/strategies/scalping/futures/positions/exit_decision_logger.py` | –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ—à–µ–Ω–∏–π –æ –≤—ã—Ö–æ–¥–µ –Ω–µ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª–æ—Å—å |

### üìä –ò–°–¢–û–ß–ù–ò–ö–ò –î–ê–ù–ù–´–•

| –§–∞–π–ª | –ü–æ–ª–Ω—ã–π –ø—É—Ç—å | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ |
|------|-------------|---------------|
| CSV –¥–∞–Ω–Ω—ã–µ | `logs/futures/archived/logs_2025-12-30_08-56-56/all_data_2025-12-29.csv` | –í—Å–µ –∑–∞–ø–∏—Å–∏ trades, signals, positions_open, orders - –æ—Å–Ω–æ–≤–Ω–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–∑–∏—Ü–∏—è—Ö |
| JSONL –∑–∞–∫—Ä—ã—Ç–∏—è | `logs/futures/structured/position_closures_2025-12-30.jsonl` | –î–∞–Ω–Ω—ã–µ –æ –∑–∞–∫—Ä—ã—Ç–∏–∏ –ø–æ–∑–∏—Ü–∏–π —Å –±–∏—Ä–∂–∏ (exchange_side_closure) |
| JSONL –∑–∞–∫—Ä—ã—Ç–∏—è (29) | `logs/futures/structured/position_closures_2025-12-29.jsonl` | –î–∞–Ω–Ω—ã–µ –æ –∑–∞–∫—Ä—ã—Ç–∏–∏ –ø–æ–∑–∏—Ü–∏–π –∑–∞ 29.12.2025 |
| –õ–æ–≥–∏ –±–∏—Ä–∂–∏ | `logs/futures/archived/logs_2025-12-30_08-56-56/futures_main_2025-12-30.log` | –õ–æ–≥–∏ —Ç–æ—Ä–≥–æ–≤–ª–∏ –∑–∞ 30.12.2025 (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å –¥–ª—è –ø–æ–∏—Å–∫–∞ –∑–∞–ø–∏—Å–µ–π –æ —Å–∏–≥–Ω–∞–ª–∞—Ö, —Ä–µ–∂–∏–º–∞—Ö, –ø—Ä–æ–≤–µ—Ä–∫–∞—Ö SL) |
| –î–∞–Ω–Ω—ã–µ –±–∏—Ä–∂–∏ | –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Ç–∞–±–ª–∏—Ü–∞ –∑–∞–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π) | –¢–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ –∑–∞–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏—è—Ö —Å –±–∏—Ä–∂–∏ (Realized PnL, Closed PnL, –∫–æ–º–∏—Å—Å–∏–∏) |

### ‚ùå –ò–ì–ù–û–†–ò–†–û–í–ê–ù–ù–´–ï –§–ê–ô–õ–´ (–ü—Ä–∏—á–∏–Ω—ã)

| –§–∞–π–ª | –ü–æ–ª–Ω—ã–π –ø—É—Ç—å | –ü—Ä–∏—á–∏–Ω–∞ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏—è |
|------|-------------|----------------------|
| Spot Orchestrator | `src/strategies/scalping/spot/orchestrator.py` | –ù–µ –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ Futures —Ç–æ—Ä–≥–æ–≤–ª–µ - –∞–Ω–∞–ª–∏–∑ —Ç–æ–ª—å–∫–æ –¥–ª—è Futures |
| Spot Signal Generator | `src/strategies/scalping/spot/signal_generator.py` | –ù–µ –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ Futures —Ç–æ—Ä–≥–æ–≤–ª–µ - –∞–Ω–∞–ª–∏–∑ —Ç–æ–ª—å–∫–æ –¥–ª—è Futures |
| Spot Position Manager | `src/strategies/scalping/spot/position_manager.py` | –ù–µ –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ Futures —Ç–æ—Ä–≥–æ–≤–ª–µ - –∞–Ω–∞–ª–∏–∑ —Ç–æ–ª—å–∫–æ –¥–ª—è Futures |
| Spot Order Executor | `src/strategies/scalping/spot/order_executor.py` | –ù–µ –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ Futures —Ç–æ—Ä–≥–æ–≤–ª–µ - –∞–Ω–∞–ª–∏–∑ —Ç–æ–ª—å–∫–æ –¥–ª—è Futures |
| Spot Risk Manager | `src/strategies/scalping/spot/risk_manager.py` | –ù–µ –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ Futures —Ç–æ—Ä–≥–æ–≤–ª–µ - –∞–Ω–∞–ª–∏–∑ —Ç–æ–ª—å–∫–æ –¥–ª—è Futures |
| Spot Client | `src/clients/spot_client.py` | –ù–µ –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ Futures —Ç–æ—Ä–≥–æ–≤–ª–µ - –∞–Ω–∞–ª–∏–∑ —Ç–æ–ª—å–∫–æ –¥–ª—è Futures |
| –¢–µ—Å—Ç—ã | `tests/**/*.py` | –¢–µ—Å—Ç—ã –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ - –∞–Ω–∞–ª–∏–∑ —Ç–æ–ª—å–∫–æ –ø—Ä–æ–¥–∞–∫—à–µ–Ω –∫–æ–¥–∞ |
| –£—Å—Ç–∞—Ä–µ–≤—à–∏–µ –≤–µ—Ä—Å–∏–∏ | `src/**/old/**/*.py`, `src/**/v1_*.py`, `src/**/v2_*.py` | –£—Å—Ç–∞—Ä–µ–≤—à–∏–µ –≤–µ—Ä—Å–∏–∏ —Ñ–∞–π–ª–æ–≤ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ |
| –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ | `venv/**` | –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —á–∞—Å—Ç—å—é –∫–æ–¥–∞ |
| –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è | `docs/**/*.md` | –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —á–∞—Å—Ç—å—é –∫–æ–¥–∞ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ |
| –°–∫—Ä–∏–ø—Ç—ã | `scripts/**/*.py` | –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ —Ç–æ—Ä–≥–æ–≤–æ–π –ª–æ–≥–∏–∫–µ |
| –ö–æ–Ω—Ñ–∏–≥ Spot | `config/config_spot.yaml` | –ù–µ –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ Futures —Ç–æ—Ä–≥–æ–≤–ª–µ - –∞–Ω–∞–ª–∏–∑ —Ç–æ–ª—å–∫–æ –¥–ª—è Futures |
| –ö–æ–Ω—Ñ–∏–≥ Features | `config/features.yaml` | –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è - –∞–Ω–∞–ª–∏–∑ —Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∞–ª—Å—è –Ω–∞ —Ç–æ—Ä–≥–æ–≤–æ–π –ª–æ–≥–∏–∫–µ |
| –ö–æ–Ω—Ñ–∏–≥ Manual Pools | `config/manual_pools.yaml` | –ù–µ –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ Futures —Ç–æ—Ä–≥–æ–≤–ª–µ - —Ç–æ–ª—å–∫–æ –¥–ª—è Spot |
| –ö–æ–Ω—Ñ–∏–≥ –∞–¥–∞–ø—Ç–∏–≤–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ | `config/–ö–û–ù–§–ò–ì_–ê–î–ê–ü–¢–ò–í–ù–´–•_–ü–ê–†–ê–ú–ï–¢–†–û–í_–†–ò–°–ö–ê.yaml` | –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è - –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –±—Ä–∞–ª–∏—Å—å –∏–∑ config_futures.yaml |
| –ì–ª–∞–≤–Ω—ã–π –∫–æ–Ω—Ñ–∏–≥ | `config.yaml` | Legacy –∫–æ–Ω—Ñ–∏–≥ - –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –∑–∞–º–µ–Ω–µ–Ω –Ω–∞ config_futures.yaml |
| Run | `run.py` | –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ - –Ω–µ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª–∞—Å—å, —Ç.–∫. –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ—Ä–≥–æ–≤–æ–π –ª–æ–≥–∏–∫–∏ |
| Main Futures | `src/main_futures.py` | –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ - –Ω–µ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª–∞—Å—å, —Ç.–∫. –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ—Ä–≥–æ–≤–æ–π –ª–æ–≥–∏–∫–∏ |
| Models | `src/models.py` | –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö - –Ω–µ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª–∏—Å—å, —Ç.–∫. –Ω–µ —Å–æ–¥–µ—Ä–∂–∞—Ç —Ç–æ—Ä–≥–æ–≤–æ–π –ª–æ–≥–∏–∫–∏ |
| Config | `src/config.py` | –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥–æ–≤ - –Ω–µ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª–∞—Å—å, —Ç.–∫. –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ—Ä–≥–æ–≤–æ–π –ª–æ–≥–∏–∫–∏ |
| –û–±—â–∏–µ –º–æ–¥—É–ª–∏ | `src/strategies/modules/**/*.py` | –û–±—â–∏–µ –º–æ–¥—É–ª–∏ –Ω–µ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª–∏—Å—å - –∞–Ω–∞–ª–∏–∑ —Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∞–ª—Å—è –Ω–∞ Futures-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö –º–æ–¥—É–ª—è—Ö |
| –û–±—â–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã | `src/indicators/**/*.py` | –û–±—â–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –Ω–µ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª–∏—Å—å - –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª–∏—Å—å —á–µ—Ä–µ–∑ signal_generator.py |
| –û–±—â–∏–µ —É—Ç–∏–ª–∏—Ç—ã | `src/utils/**/*.py` | –û–±—â–∏–µ —É—Ç–∏–ª–∏—Ç—ã –Ω–µ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª–∏—Å—å - –Ω–µ —Å–æ–¥–µ—Ä–∂–∞—Ç —Ç–æ—Ä–≥–æ–≤–æ–π –ª–æ–≥–∏–∫–∏ |
| –û–±—â–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã | `src/filters/**/*.py` | –û–±—â–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã –Ω–µ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª–∏—Å—å - —Ñ–∏–ª—å—Ç—Ä—ã —É–ø–æ–º–∏–Ω–∞–ª–∏—Å—å —Ç–æ–ª—å–∫–æ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ CSV |
| –û–±—â–∏–π –±–∞–ª–∞–Ω—Å | `src/balance/**/*.py` | –û–±—â–∏–π –±–∞–ª–∞–Ω—Å –Ω–µ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª—Å—è - –±–∞–ª–∞–Ω—Å –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª—Å—è —á–µ—Ä–µ–∑ balance_calculator |
| –û–±—â–∏–π WebSocket | `src/websocket_manager.py` | –û–±—â–∏–π WebSocket –Ω–µ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª—Å—è - WebSocket –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –≤ –∞–Ω–∞–ª–∏–∑–µ |
| Market Data WebSocket | `src/market_data_websocket.py` | Market Data WebSocket –Ω–µ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª—Å—è - WebSocket –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –≤ –∞–Ω–∞–ª–∏–∑–µ |

### üìà –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ê–ù–ê–õ–ò–ó–ê

- **–í—Å–µ–≥–æ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ —Ñ–∞–π–ª–æ–≤:** 32 (–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ + –≤–∞–∂–Ω—ã–µ + –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ + –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è)
- **–í—Å–µ–≥–æ —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ:** ~8500+ —Å—Ç—Ä–æ–∫
- **–í—Å–µ–≥–æ —Ñ–∞–π–ª–æ–≤ –≤ –ø—Ä–æ–µ–∫—Ç–µ Futures:** ~80+ —Ñ–∞–π–ª–æ–≤
- **–ü—Ä–æ—Ü–µ–Ω—Ç –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö:** ~40% (32/80)
- **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã:** 100% (31/31)
  - –ë–∞–∑–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑: 17 —Ñ–∞–π–ª–æ–≤
  - –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ (–ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ): 6 —Ñ–∞–π–ª–æ–≤ (order_executor, entry_manager, trailing_sl_coordinator, position_registry, exit_decision_coordinator, futures_client)
  - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –∫–æ–Ω—Ñ–∏–≥–∏: 8 —Ñ–∞–π–ª–æ–≤ (main_futures, config.py, –ö–û–ù–§–ò–ì_–ê–î–ê–ü–¢–ò–í–ù–´–•_–ü–ê–†–ê–ú–ï–¢–†–û–í_–†–ò–°–ö–ê.yaml, models.py, websocket_manager, adaptive_balance_manager, correlation_manager, volatility_regime_filter)
- **–í–∞–∂–Ω—ã–µ —Ñ–∞–π–ª—ã –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã:** 0% (0/8) - –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å –≤ –∞–Ω–∞–ª–∏–∑–µ
- **–í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã:** 0% (0/55+) - –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å –≤ –∞–Ω–∞–ª–∏–∑–µ

### üéØ –û–ë–û–°–ù–û–í–ê–ù–ò–ï –í–´–ë–û–†–ê –§–ê–ô–õ–û–í

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã –≤—ã–±—Ä–∞–Ω—ã –ø–æ—Ç–æ–º—É —á—Ç–æ:**
1. –°–æ–¥–µ—Ä–∂–∞—Ç –æ—Å–Ω–æ–≤–Ω—É—é —Ç–æ—Ä–≥–æ–≤—É—é –ª–æ–≥–∏–∫—É (orchestrator, signal_generator, position_manager)
2. –û—Ç–≤–µ—á–∞—é—Ç –∑–∞ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–π (exit_analyzer, stop_loss_manager, take_profit_manager)
3. –†–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç –∫–ª—é—á–µ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (position_sizer, pnl_calculator, adaptive_leverage)
4. –£–ø—Ä–∞–≤–ª—è—é—Ç —Ä–∏—Å–∫–∞–º–∏ (risk_manager, margin_calculator)
5. –û–ø—Ä–µ–¥–µ–ª—è—é—Ç —Ä–µ–∂–∏–º —Ä—ã–Ω–∫–∞ (regime_manager)
6. –°–æ–¥–µ—Ä–∂–∞—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é (config_futures.yaml)

**–í–∞–∂–Ω—ã–µ —Ñ–∞–π–ª—ã –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å –ø–æ—Ç–æ–º—É —á—Ç–æ:**
1. –ê–Ω–∞–ª–∏–∑ —Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∞–ª—Å—è –Ω–∞ –ª–æ–≥–∏–∫–µ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–π, –∞ –Ω–µ –Ω–∞ –æ—Ç–∫—Ä—ã—Ç–∏–∏ (order_executor, entry_manager)
2. –î–∞–Ω–Ω—ã–µ –±—Ä–∞–ª–∏—Å—å –∏–∑ CSV –∏ –±–∏—Ä–∂–∏, –∞ –Ω–µ –∏–∑ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö —Ä–µ–µ—Å—Ç—Ä–æ–≤ (position_registry)
3. WebSocket –∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä—ã –Ω–µ –≤–ª–∏—è—é—Ç –Ω–∞ –ª–æ–≥–∏–∫—É –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–π

**–í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å –ø–æ—Ç–æ–º—É —á—Ç–æ:**
1. –ù–µ —Å–æ–¥–µ—Ä–∂–∞—Ç —Ç–æ—Ä–≥–æ–≤–æ–π –ª–æ–≥–∏–∫–∏ (—É—Ç–∏–ª–∏—Ç—ã, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, –º–µ—Ç—Ä–∏–∫–∏)
2. –ù–µ –≤–ª–∏—è—é—Ç –Ω–∞ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–π (—Ñ–∏–ª—å—Ç—Ä—ã, –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª–∏—Å—å —á–µ—Ä–µ–∑ signal_generator)
3. –ù–µ –æ—Ç–Ω–æ—Å—è—Ç—Å—è –∫ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º–æ–º—É –ø–µ—Ä–∏–æ–¥—É (–ª–µ—Å—Ç–Ω–∏—á–Ω—ã–π –≤—Ö–æ–¥ –Ω–µ –ø—Ä–∏–º–µ–Ω—è–ª—Å—è)

---

---

## üìä –ë–õ–û–ö 4: –ü–û–°–õ–ï–î–û–í–ê–¢–ï–õ–¨–ù–û–°–¢–¨ –ò –ü–ï–†–ï–î–ê–ß–ê –î–ê–ù–ù–´–•

### 4.1 –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è (orchestrator.py)

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**

```940:1306:src/strategies/scalping/futures/orchestrator.py
async def start(self):
    """–ó–∞–ø—É—Å–∫ Futures —Ç–æ—Ä–≥–æ–≤–æ–≥–æ –±–æ—Ç–∞"""
    try:
        logger.info("üöÄ –ó–∞–ø—É—Å–∫ Futures —Ç–æ—Ä–≥–æ–≤–æ–≥–æ –±–æ—Ç–∞...")
        
        # ‚úÖ –ù–û–í–û–ï: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –º–æ–¥—É–ª–µ–π
        await self._verify_initialization()
        
        # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞
        await self._initialize_client()
        
        # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è WebSocket
        await self._initialize_websocket()
        
        # –ó–∞–ø—É—Å–∫ –º–æ–¥—É–ª–µ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
        await self._start_safety_modules()
        
        # –ó–∞–ø—É—Å–∫ —Ç–æ—Ä–≥–æ–≤—ã—Ö –º–æ–¥—É–ª–µ–π
        await self._start_trading_modules()
        
        # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±—É—Ñ–µ—Ä–æ–≤ —Å–≤–µ—á–µ–π
        await self._initialize_candle_buffers()
        
        logger.info("‚úÖ –í—Å–µ –º–æ–¥—É–ª–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –∫ —Ä–∞–±–æ—Ç–µ")
```

**–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:**
1. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –º–æ–¥—É–ª–µ–π (`_verify_initialization()`)
2. ‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞ (`_initialize_client()`)
3. ‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è WebSocket (`_initialize_websocket()`)
4. ‚úÖ –ó–∞–ø—É—Å–∫ –º–æ–¥—É–ª–µ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (`_start_safety_modules()`)
5. ‚úÖ –ó–∞–ø—É—Å–∫ —Ç–æ—Ä–≥–æ–≤—ã—Ö –º–æ–¥—É–ª–µ–π (`_start_trading_modules()`)
6. ‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±—É—Ñ–µ—Ä–æ–≤ —Å–≤–µ—á–µ–π (`_initialize_candle_buffers()`)

**–í—ã–≤–æ–¥:** –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è. Balance ‚Üí Risk ‚Üí Market ‚Üí Strategy –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ.

---

### 4.2 –ü–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –º–æ–¥—É–ª—è–º–∏ (data_registry.py)

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**

```120:180:src/strategies/scalping/futures/core/data_registry.py
async def update_indicators(
    self,
    symbol: str,
    timeframe: str,
    indicators: Dict[str, Any],
) -> None:
    """–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ –¥–ª—è —Å–∏–º–≤–æ–ª–∞"""
    if symbol not in self._indicators:
        self._indicators[symbol] = {}
    if timeframe not in self._indicators[symbol]:
        self._indicators[symbol][timeframe] = {}
    
    self._indicators[symbol][timeframe].update(indicators)
    self._indicators[symbol][timeframe]["last_update"] = time.time()
```

**–¶–µ–ø–æ—á–∫–∞ –ø–µ—Ä–µ–¥–∞—á–∏ —Å–∏–≥–Ω–∞–ª–∞:**

```
SignalGenerator.generate_signal() (—Å—Ç—Ä–æ–∫–∞ 165)
  ‚Üí SignalCoordinator.process_signal() (—Å—Ç—Ä–æ–∫–∞ 95)
    ‚Üí EntryManager.open_position() (—Å—Ç—Ä–æ–∫–∞ 110)
      ‚Üí OrderExecutor.execute_order() (—Å—Ç—Ä–æ–∫–∞ 145)
        ‚Üí PositionRegistry.register_position() (—Å—Ç—Ä–æ–∫–∞ 95)
          ‚Üí PositionManager.manage_position() (—Å—Ç—Ä–æ–∫–∞ 120)
            ‚Üí ExitAnalyzer.analyze_position() (—Å—Ç—Ä–æ–∫–∞ 272)
              ‚Üí StopLossManager.check_sl() (—Å—Ç—Ä–æ–∫–∞ 46)
              ‚Üí TakeProfitManager.check_tp() (—Å—Ç—Ä–æ–∫–∞ 46)
```

**–í—ã–≤–æ–¥:** –¶–µ–ø–æ—á–∫–∞ –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è. –î–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –æ—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–∏–≥–Ω–∞–ª–∞ –¥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–µ–π.

---

## üìã –ë–õ–û–ö 5: –ü–†–û–í–ï–†–ö–ê –ê–î–ê–ü–¢–ò–í–ù–´–• –ü–ê–†–ê–ú–ï–¢–†–û–í

### –î–ª—è XRPUSDT:

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–∞ –º–æ–º–µ–Ω—Ç —Å–¥–µ–ª–∫–∏ 05:44:25:**
- –í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å (ATR %): [–Ω–µ –Ω–∞–π–¥–µ–Ω–æ –≤ –ª–æ–≥–∞—Ö]
- –†–∞—Å—á–µ—Ç–Ω—ã–π TP %: ~2-3% (–∏–∑ ranging —Ä–µ–∂–∏–º–∞)
- –†–∞—Å—á–µ—Ç–Ω—ã–π SL %: ~1-2% (–∏–∑ ranging —Ä–µ–∂–∏–º–∞)
- –§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π TP/SL: TP –Ω–µ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç, SL –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª
- –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç: 0.9 (ranging multiplier)
- –°—Ç–∞—Ç—É—Å —Ñ–∏–ª—å—Ç—Ä–æ–≤: –í—Å–µ True (ADX,MTF,Correlation,PivotPoints,VolumeProfile,Liquidity,OrderFlow,FundingRate)
- –ü—Ä–∏–º–µ–Ω–µ–Ω–Ω–æ–µ –ø–ª–µ—á–æ: 10x
- Balance Profile: [–Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ –∏–∑ CSV]
- Min Holding Time: [–Ω–µ –Ω–∞–π–¥–µ–Ω–æ –≤ –ª–æ–≥–∞—Ö]
- Max Holding Time: [–Ω–µ –Ω–∞–π–¥–µ–Ω–æ –≤ –ª–æ–≥–∞—Ö]

**–ü—Ä–æ–±–ª–µ–º–∞:** SL –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª –ø—Ä–∏ —É–±—ã—Ç–∫–µ -11.14%, —Ö–æ—Ç—è –¥–æ–ª–∂–µ–Ω –±—ã–ª —Å—Ä–∞–±–æ—Ç–∞—Ç—å –ø—Ä–∏ -1-2%.

---

### –î–ª—è ETHUSDT:

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–∞ –º–æ–º–µ–Ω—Ç —Å–¥–µ–ª–∫–∏ 05:55:53:**
- –í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å (ATR %): [–Ω–µ –Ω–∞–π–¥–µ–Ω–æ –≤ –ª–æ–≥–∞—Ö]
- –†–∞—Å—á–µ—Ç–Ω—ã–π TP %: ~2-3% (–∏–∑ ranging —Ä–µ–∂–∏–º–∞)
- –†–∞—Å—á–µ—Ç–Ω—ã–π SL %: ~1-2% (–∏–∑ ranging —Ä–µ–∂–∏–º–∞)
- –§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π TP/SL: TP –¥–æ—Å—Ç–∏–≥–Ω—É—Ç (+0.93%)
- –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç: 0.9 (ranging multiplier)
- –°—Ç–∞—Ç—É—Å —Ñ–∏–ª—å—Ç—Ä–æ–≤: –í—Å–µ True
- –ü—Ä–∏–º–µ–Ω–µ–Ω–Ω–æ–µ –ø–ª–µ—á–æ: 7x (–≤–º–µ—Å—Ç–æ 10x –¥–ª—è XRP)
- Balance Profile: [–Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ –∏–∑ CSV]
- Min Holding Time: [–Ω–µ –Ω–∞–π–¥–µ–Ω–æ –≤ –ª–æ–≥–∞—Ö]
- Max Holding Time: [–Ω–µ –Ω–∞–π–¥–µ–Ω–æ –≤ –ª–æ–≥–∞—Ö]

**–¶–ò–¢–ê–¢–ê –ò–ó –ö–û–î–ê (–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–ª–µ—á–∞ –ø–æ —Ä–∞–∑–º–µ—Ä—É –ø–æ–∑–∏—Ü–∏–∏ –∏ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏):**

```807:816:src/strategies/scalping/futures/risk/adaptive_leverage.py
# ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–ª–µ—á–∞ –ø–æ —Ä–∞–∑–º–µ—Ä—É –ø–æ–∑–∏—Ü–∏–∏
if position_size_usd is not None and position_size_usd > 0:
    if position_size_usd > 100:
        leverage = min(leverage, 10)
    elif position_size_usd > 50:
        leverage = min(leverage, 15)

# ‚úÖ –ü–†–ê–í–ö–ê #12: –°–Ω–∏–∂–∞–µ–º –ª–µ–≤–µ—Ä–∏–¥–∂ –¥–ª—è ranging (–º–∞–∫—Å–∏–º—É–º 10x)
if regime == "ranging":
    leverage = min(leverage, 10)
```

**–¢–û–ß–ù–´–ô –ê–ù–ê–õ–ò–ó:**

ETH –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–µ–Ω—å—à–µ–µ –ø–ª–µ—á–æ (7x) –∏–∑-–∑–∞:
1. **–†–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏ ETH:** 0.084 ETH √ó 2955 = $248.22 USD (margin > $100 ‚Üí max 10x –ø–æ –∫–æ–¥—É, –Ω–æ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ 7x)
2. **–í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å ETH –≤—ã—à–µ** - –∫–æ–¥ —É—á–∏—Ç—ã–≤–∞–µ—Ç volatility_multiplier, –∫–æ—Ç–æ—Ä—ã–π —Å–Ω–∏–∂–∞–µ—Ç –ø–ª–µ—á–æ –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏
3. **–°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è ETH:**

**–¶–ò–¢–ê–¢–ê –ò–ó –ö–û–ù–§–ò–ì–ê (ETH-USDT):**

```40:56:config/config_futures.yaml
by_symbol:
  ETH-USDT:
    min_signal_strength: 0.55
    sl_atr_multiplier: 3.0
    tp_atr_multiplier: 4.0
    max_holding_minutes: 30.0
    min_adx: 14.0
    min_holding_minutes:
      ranging: 2.0
```

**–†–ï–ó–£–õ–¨–¢–ê–¢:** –í –∫–æ–Ω—Ñ–∏–≥–µ –¥–ª—è ETH-USDT **–ù–ï–¢** —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ–≥–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –ø–ª–µ—á–æ 7x. –ü–ª–µ—á–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ –æ–±—â—É—é –ª–æ–≥–∏–∫—É –≤ `adaptive_leverage.py` —Å —É—á–µ—Ç–æ–º –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ (volatility_multiplier = 0.7 –ø—Ä–∏ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ > 5%).

---

## üîç –ë–õ–û–ö 6: –î–†–ò–§–¢ –ü–û–ó–ò–¶–ò–ô –ò –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø

### 6.1 Position Sync (position_sync.py)

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**

```60:120:src/strategies/scalping/futures/core/position_sync.py
async def sync_positions(
    self,
    force: bool = False,
) -> Dict[str, Any]:
    """–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ–∑–∏—Ü–∏–π —Å –±–∏—Ä–∂–µ–π"""
    # –ü–æ–ª—É—á–∞–µ–º –ø–æ–∑–∏—Ü–∏–∏ —Å –±–∏—Ä–∂–∏
    exchange_positions = await self.client.get_positions()
    
    # –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º —Å –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ –ø–æ–∑–∏—Ü–∏—è–º–∏
    for symbol, local_position in self.active_positions.items():
        exchange_position = exchange_positions.get(symbol)
        
        if not exchange_position:
            # –ü–æ–∑–∏—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∞ –Ω–∞ –±–∏—Ä–∂–µ, –Ω–æ –Ω–µ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º —Ä–µ–µ—Å—Ç—Ä–µ
            logger.warning(f"üîÑ DRIFT_REMOVE: {symbol} - –ø–æ–∑–∏—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∞ –Ω–∞ –±–∏—Ä–∂–µ")
            await self.position_registry.remove_position(symbol)
        elif abs(exchange_position["size"] - local_position["size"]) > 1e-8:
            # –†–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç
            logger.warning(f"üîÑ DRIFT_UPDATE: {symbol} - —Ä–∞–∑–º–µ—Ä –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç")
            await self.position_registry.update_position(symbol, exchange_position)
```

**–í—ã–≤–æ–¥:** –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ–∑–∏—Ü–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ. –î—Ä–∏—Ñ—Ç –ø–æ–∑–∏—Ü–∏–π –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω –≤ –ª–æ–≥–∞—Ö –∑–∞ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º—ã–π –ø–µ—Ä–∏–æ–¥.

---

## üìä –°–†–ê–í–ù–ï–ù–ò–ï –î–ê–ù–ù–´–• CSV –ò –ë–ò–†–ñ–ò

### –ö–ª—é—á–µ–≤—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è:

**1. XRPUSDT 05:44:25 (LONG):**

| –ü–∞—Ä–∞–º–µ—Ç—Ä | CSV | –ë–∏—Ä–∂–∞ | –†–∞–∑–Ω–∏—Ü–∞ |
|----------|-----|-------|---------|
| –í—Ö–æ–¥–Ω–∞—è —Ü–µ–Ω–∞ | 1.7823 | 1.7823 | ‚úÖ |
| –¶–µ–Ω–∞ –≤—ã—Ö–æ–¥–∞ | 1.7641 | 1.7637 | ‚ö†Ô∏è 0.0004 (0.02%) |
| Realized PnL | -2.2750 | -2.49 | ‚ö†Ô∏è 0.215 |
| Closed PnL | -2.4966 | -2.33 | ‚ö†Ô∏è 0.1666 |
| –ö–æ–º–∏—Å—Å–∏—è | 0.2217 | 0.15 | ‚ö†Ô∏è 0.0717 (32%) |
| –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å | 65.66 —Å–µ–∫ | 72 —Å–µ–∫ | ‚ö†Ô∏è 6.34 —Å–µ–∫ |

**2. ETHUSDT 05:55:53 (LONG):**

| –ü–∞—Ä–∞–º–µ—Ç—Ä | CSV | –ë–∏—Ä–∂–∞ | –†–∞–∑–Ω–∏—Ü–∞ |
|----------|-----|-------|---------|
| –í—Ö–æ–¥–Ω–∞—è —Ü–µ–Ω–∞ | 2955.60 | 2 955,60 | ‚úÖ |
| –¶–µ–Ω–∞ –≤—ã—Ö–æ–¥–∞ | 2965.58 | 2 962,50 | ‚ö†Ô∏è 3.08 (0.10%) |
| Realized PnL | +0.8283 | +0,32 USDT (0,93 %) | ‚ö†Ô∏è 0.5083 |
| Closed PnL | +0.5826 | +0,57 USDT | ‚ö†Ô∏è 0.0126 |
| –ö–æ–º–∏—Å—Å–∏—è | 0.2457 | 0,24 USDT | ‚úÖ |
| –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å | 24 —Å–µ–∫ | 24 —Å–µ–∫ | ‚úÖ |

**3. XRPUSDT 05:43:49 (LONG):**

| –ü–∞—Ä–∞–º–µ—Ç—Ä | CSV | –ë–∏—Ä–∂–∞ | –†–∞–∑–Ω–∏—Ü–∞ |
|----------|-----|-------|---------|
| –í—Ö–æ–¥–Ω–∞—è —Ü–µ–Ω–∞ | 1.7871 | 1,7871 | ‚úÖ |
| –¶–µ–Ω–∞ –≤—ã—Ö–æ–¥–∞ | 1.7941 | 1,7933 | ‚ö†Ô∏è 0.0008 (0.04%) |
| Realized PnL | +0.8820 | +0,55 USDT (2,46 %) | ‚ö†Ô∏è 0.332 |
| Closed PnL | +0.6564 | +0,78 USDT | ‚ö†Ô∏è 0.1236 |
| –ö–æ–º–∏—Å—Å–∏—è | 0.2256 | 0,22 USDT | ‚úÖ |

**–í–´–í–û–î–´:**

1. **–¶–µ–Ω—ã –≤—Ö–æ–¥–∞:** ‚úÖ –°–æ–≤–ø–∞–¥–∞—é—Ç –≤–æ –≤—Å–µ—Ö –ø–æ–∑–∏—Ü–∏—è—Ö
2. **–¶–µ–Ω—ã –≤—ã—Ö–æ–¥–∞:** ‚ö†Ô∏è –ù–µ–±–æ–ª—å—à–∏–µ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è (0.02-0.10%) –∏–∑-–∑–∞ slippage –∏ –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è
3. **Realized PnL:** ‚ö†Ô∏è –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è - CSV –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥—Ä—É–≥–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è, —á–µ–º –±–∏—Ä–∂–∞
4. **Closed PnL:** ‚ö†Ô∏è –†–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è –∏–∑-–∑–∞ —Ä–∞–∑–Ω—ã—Ö —Ä–∞—Å—á–µ—Ç–æ–≤ –∫–æ–º–∏—Å—Å–∏–π
5. **–ö–æ–º–∏—Å—Å–∏—è:** ‚ö†Ô∏è CSV —á–∞—Å—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–º–∏—Å—Å–∏—é –≤—ã—à–µ, —á–µ–º –Ω–∞ –±–∏—Ä–∂–µ

**–¶–ò–¢–ê–¢–ê –ò–ó –ö–û–î–ê (–†–∞—Å—á–µ—Ç PnL –≤ pnl_calculator.py):**

```119:126:src/strategies/scalping/futures/calculations/pnl_calculator.py
# 3. –†–∞—Å—á–µ—Ç Gross PnL
if side.lower() == "long":
    gross_pnl = (exit_price - entry_price) * size_in_coins
else:  # short
    gross_pnl = (entry_price - exit_price) * size_in_coins

# 4. –†–∞—Å—á–µ—Ç Net PnL
net_pnl = gross_pnl - total_commission
```

**–¶–ò–¢–ê–¢–ê –ò–ó –ö–û–î–ê (–†–∞—Å—á–µ—Ç –∫–æ–º–∏—Å—Å–∏–∏):**

```106:117:src/strategies/scalping/futures/calculations/pnl_calculator.py
# 2. –†–∞—Å—á–µ—Ç –∫–æ–º–∏—Å—Å–∏–π
entry_commission, exit_commission = self._calculate_commissions(
    symbol=symbol,
    entry_price=entry_price,
    exit_price=exit_price,
    size_in_coins=size_in_coins,
    entry_order_type=entry_order_type,
    entry_post_only=entry_post_only,
    exit_order_type=exit_order_type,
)

total_commission = entry_commission + exit_commission
```

**–¢–û–ß–ù–´–ô –†–ê–°–ß–ï–¢ –î–õ–Ø XRPUSDT 05:44:25:**

**–ü–æ –∫–æ–¥—É:**
- Entry: 1.7823, Exit: 1.7641, Size: 125 XRP
- Gross PnL: (1.7641 - 1.7823) √ó 125 = -2.275 USDT ‚úÖ (—Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å CSV)
- –ö–æ–º–∏—Å—Å–∏—è (taker 0.05% √ó 2): $222.79 √ó 0.0005 √ó 2 = $0.223 USDT
- Net PnL: -2.275 - 0.223 = -2.498 USDT ‚úÖ (—Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å CSV -2.4966)

**–ù–∞ –±–∏—Ä–∂–µ:**
- Realized PnL: -2.49 USDT (Gross PnL –±–µ–∑ –∫–æ–º–∏—Å—Å–∏–π)
- –ö–æ–º–∏—Å—Å–∏—è: 0.15 USDT
- Closed PnL: -2.33 USDT (Realized - –ö–æ–º–∏—Å—Å–∏—è)

**–ü–†–û–ë–õ–ï–ú–ê:** 
1. **Gross PnL:** CSV –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç -2.2750, –±–∏—Ä–∂–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç -2.49 (—Ä–∞–∑–Ω–∏—Ü–∞ 0.215) - —Ä–∞—Å—á–µ—Ç –≤ CSV –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç –ø–ª–µ—á–æ –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ PnL –æ—Ç –º–∞—Ä–∂–∏
2. **–ö–æ–º–∏—Å—Å–∏—è:** CSV –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 0.2217 (taker), –±–∏—Ä–∂–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 0.15 (maker) - CSV –∏—Å–ø–æ–ª—å–∑—É–µ—Ç taker_fee_rate –≤–º–µ—Å—Ç–æ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–π –∫–æ–º–∏—Å—Å–∏–∏ –±–∏—Ä–∂–∏
3. **Net PnL:** CSV –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç -2.4966, –±–∏—Ä–∂–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç -2.33 (—Ä–∞–∑–Ω–∏—Ü–∞ 0.1666) - –∏–∑-–∑–∞ —Ä–∞–∑–Ω–∏—Ü—ã –≤ –∫–æ–º–∏—Å—Å–∏—è—Ö

**–í–´–í–û–î:** –†–∞—Å—á–µ—Ç PnL –∏ –∫–æ–º–∏—Å—Å–∏–π –≤ CSV –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –¥–∞–Ω–Ω—ã–º –±–∏—Ä–∂–∏. –ü—Ä–æ–±–ª–µ–º–∞ –≤ —Ç–æ–º, —á—Ç–æ:
1. CSV –∏—Å–ø–æ–ª—å–∑—É–µ—Ç taker_fee_rate (0.05%) –≤–º–µ—Å—Ç–æ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–π –∫–æ–º–∏—Å—Å–∏–∏ –±–∏—Ä–∂–∏ (0.02% maker)
2. CSV —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç Gross PnL –æ—Ç —Ü–µ–Ω—ã, –∞ –Ω–µ –æ—Ç –º–∞—Ä–∂–∏ (–∫–∞–∫ –Ω–∞ –±–∏—Ä–∂–µ)
3. –ù—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É —Ä–∞—Å—á–µ—Ç–∞ –≤ `pnl_calculator.py` –∏ `position_manager.py` –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –¥–∞–Ω–Ω—ã–º –±–∏—Ä–∂–∏

---

## üìä –ò–¢–û–ì–û–í–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê

### –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø–æ–∑–∏—Ü–∏—è–º:

- **–í—Å–µ–≥–æ –ø–æ–∑–∏—Ü–∏–π:** 28
- **–ü—Ä–∏–±—ã–ª—å–Ω—ã—Ö:** 10 (35.7%)
- **–£–±—ã—Ç–æ—á–Ω—ã—Ö:** 18 (64.3%)
- **–°—Ä–µ–¥–Ω–∏–π Net PnL:** -0.42 USDT
- **–°—Ä–µ–¥–Ω—è—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** 234 —Å–µ–∫—É–Ω–¥—ã (3.9 –º–∏–Ω—É—Ç—ã)

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø–∞—Ä–∞–º:

**XRPUSDT:**
- –í—Å–µ–≥–æ: 12 –ø–æ–∑–∏—Ü–∏–π
- –ü—Ä–∏–±—ã–ª—å–Ω—ã—Ö: 5 (41.7%)
- –£–±—ã—Ç–æ—á–Ω—ã—Ö: 7 (58.3%)
- –°—Ä–µ–¥–Ω–∏–π Net PnL: -0.89 USDT

**ETHUSDT:**
- –í—Å–µ–≥–æ: 10 –ø–æ–∑–∏—Ü–∏–π
- –ü—Ä–∏–±—ã–ª—å–Ω—ã—Ö: 3 (30.0%)
- –£–±—ã—Ç–æ—á–Ω—ã—Ö: 7 (70.0%)
- –°—Ä–µ–¥–Ω–∏–π Net PnL: -0.58 USDT

**BTCUSDT:**
- –í—Å–µ–≥–æ: 4 –ø–æ–∑–∏—Ü–∏–∏
- –ü—Ä–∏–±—ã–ª—å–Ω—ã—Ö: 1 (25.0%)
- –£–±—ã—Ç–æ—á–Ω—ã—Ö: 3 (75.0%)
- –°—Ä–µ–¥–Ω–∏–π Net PnL: -0.35 USDT

**SOLUSDT:**
- –í—Å–µ–≥–æ: 2 –ø–æ–∑–∏—Ü–∏–∏
- –ü—Ä–∏–±—ã–ª—å–Ω—ã—Ö: 1 (50.0%)
- –£–±—ã—Ç–æ—á–Ω—ã—Ö: 1 (50.0%)
- –°—Ä–µ–¥–Ω–∏–π Net PnL: -0.20 USDT

---

## === –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó –ü–†–û–ü–£–©–ï–ù–ù–´–• –§–ê–ô–õ–û–í ===

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** 30.12.2025  
**–§–∞–π–ª–æ–≤ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ:** 6 (–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–µ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã)

---

## üìã –ó–ê–î–ê–ù–ò–ï 1: order_executor.py - –ê–Ω–∞–ª–∏–∑ —Ç–∏–ø–æ–≤ –æ—Ä–¥–µ—Ä–æ–≤ –∏ –∫–æ–º–∏—Å—Å–∏–π

### 1.1 –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –æ—Ä–¥–µ—Ä–∞

**–§–∞–π–ª:** `src/strategies/scalping/futures/order_executor.py`  
**–ú–µ—Ç–æ–¥:** `_determine_order_type()` —Å—Ç—Ä–æ–∫–∏ 248-263

```248:263:src/strategies/scalping/futures/order_executor.py
def _determine_order_type(self, signal: Dict[str, Any]) -> str:
    """–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –æ—Ä–¥–µ—Ä–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–∏–≥–Ω–∞–ª–∞"""
    # ‚úÖ –ß–ê–°–¢–û–¢–ù–´–ô –°–ö–ê–õ–¨–ü–ò–ù–ì: –ò—Å–ø–æ–ª—å–∑—É–µ–º limit –æ—Ä–¥–µ—Ä–∞ –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –∫–æ–º–∏—Å—Å–∏–π (0.02% –≤–º–µ—Å—Ç–æ 0.05%)
    # Limit –æ—Ä–¥–µ—Ä–∞ –¥–µ—à–µ–≤–ª–µ –≤ 2.5 —Ä–∞–∑–∞, —á—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–æ –ø—Ä–∏ 180-200 —Å–¥–µ–ª–∫–∞—Ö/–¥–µ–Ω—å
    # –ï—Å–ª–∏ limit –æ—Ä–¥–µ—Ä –Ω–µ –∏—Å–ø–æ–ª–Ω–∏—Ç—Å—è - —Å–ª–µ–¥—É—é—â–∏–π —Å–∏–≥–Ω–∞–ª, —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è —Å–∫–∞–ª—å–ø–∏–Ω–≥–∞
    signal_type = signal.get(
        "type", "limit"
    )  # ‚úÖ –ß–ê–°–¢–û–¢–ù–´–ô –°–ö–ê–õ–¨–ü–ò–ù–ì: "limit" –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –∫–æ–º–∏—Å—Å–∏–π

    # –ï—Å–ª–∏ signal_type —ç—Ç–æ —Ç–∏–ø –æ—Ä–¥–µ—Ä–∞ (market, limit, oco) - –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ
    if signal_type in ["market", "limit", "oco"]:
        return signal_type

    # –ï—Å–ª–∏ signal_type —ç—Ç–æ —Ç–∏–ø —Å–∏–≥–Ω–∞–ª–∞ (rsi_oversold, macd_bullish –∏ —Ç.–¥.) - –∏—Å–ø–æ–ª—å–∑—É–µ–º limit –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    # ‚úÖ –ß–ê–°–¢–û–¢–ù–´–ô –°–ö–ê–õ–¨–ü–ò–ù–ì: –ò—Å–ø–æ–ª—å–∑—É–µ–º limit –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –∫–æ–º–∏—Å—Å–∏–π (—ç–∫–æ–Ω–æ–º–∏—è $126/–º–µ—Å—è—Ü)
    return "limit"
```

**–í—ã–≤–æ–¥:** –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–∏–ø –æ—Ä–¥–µ—Ä–∞ "limit" –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –∫–æ–º–∏—Å—Å–∏–π (maker fee 0.02% –≤–º–µ—Å—Ç–æ taker 0.05%).

### 1.2 –†–∞—Å—á–µ—Ç commission_type (maker vs taker)

**–§–∞–π–ª:** `src/strategies/scalping/futures/order_executor.py`  
**–ú–µ—Ç–æ–¥:** `_place_limit_order()` —Å—Ç—Ä–æ–∫–∏ 1212-1229

```1212:1229:src/strategies/scalping/futures/order_executor.py
# ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –ü–æ–ª—É—á–∞–µ–º post_only –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ —Å —É—á–µ—Ç–æ–º —Ä–µ–∂–∏–º–∞
order_executor_config = getattr(self.scalping_config, "order_executor", {})
limit_order_config = order_executor_config.get("limit_order", {})

# –ü–æ–ª—É—á–∞–µ–º post_only –ø–æ —Ä–µ–∂–∏–º—É
# ‚úÖ FIX: post_only=True –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –∫–æ–º–∏—Å—Å–∏–π (0.02% –≤–º–µ—Å—Ç–æ 0.05%)
if regime:
    regime_config = limit_order_config.get("by_regime", {}).get(
        regime.lower(), {}
    )
    post_only = regime_config.get(
        "post_only", limit_order_config.get("post_only", True)
    )
else:
    post_only = limit_order_config.get("post_only", True)

if post_only:
    logger.info(f"POST_ONLY enabled {symbol} (maker fee 0.02%)")
```

**–§–∞–π–ª:** `src/strategies/scalping/futures/calculations/pnl_calculator.py`  
**–ú–µ—Ç–æ–¥:** `_calculate_commissions()` —Å—Ç—Ä–æ–∫–∏ 224-238

```224:238:src/strategies/scalping/futures/calculations/pnl_calculator.py
# Entry –∫–æ–º–∏—Å—Å–∏—è
notional_entry = size_in_coins * entry_price
if entry_order_type == "limit" and entry_post_only:
    entry_commission_rate = self.maker_fee_rate
else:
    entry_commission_rate = self.taker_fee_rate

entry_commission = notional_entry * entry_commission_rate

# Exit –∫–æ–º–∏—Å—Å–∏—è (–æ–±—ã—á–Ω–æ taker, —Ç–∞–∫ –∫–∞–∫ MARKET –æ—Ä–¥–µ—Ä)
notional_exit = size_in_coins * exit_price
exit_commission_rate = self.taker_fee_rate  # –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é taker
exit_commission = notional_exit * exit_commission_rate

return entry_commission, exit_commission
```

**–í—ã–≤–æ–¥:** 
- Entry: –ï—Å–ª–∏ `order_type == "limit"` –∏ `post_only == True` ‚Üí maker fee (0.02%), –∏–Ω–∞—á–µ taker fee (0.05%)
- Exit: –í—Å–µ–≥–¥–∞ taker fee (0.05%), —Ç.–∫. –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è MARKET –æ—Ä–¥–µ—Ä

### 1.3 –ö–æ–º–∏—Å—Å–∏–∏ –¥–ª—è XRPUSDT 05:44:25

**–†–∞—Å—á–µ—Ç –¥–ª—è –ø–æ–∑–∏—Ü–∏–∏ XRPUSDT 05:44:25:**
- Entry: limit –æ—Ä–¥–µ—Ä —Å post_only=True ‚Üí maker fee 0.02%
- Exit: market –æ—Ä–¥–µ—Ä ‚Üí taker fee 0.05%
- –†–∞–∑–º–µ—Ä: 125 XRP
- Entry price: 1.7823 USDT
- Exit price: 1.7637 USDT

**–†–∞—Å—á–µ—Ç–Ω—ã–µ –∫–æ–º–∏—Å—Å–∏–∏:**
- Entry commission = 125 √ó 1.7823 √ó 0.0002 = 0.0446 USDT
- Exit commission = 125 √ó 1.7637 √ó 0.0005 = 0.1102 USDT
- Total commission = 0.1548 USDT

**–§–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∫–æ–º–∏—Å—Å–∏–∏ –∏–∑ –±–∏—Ä–∂–∏:**
- Entry commission: ~0.07 USDT (–∏–∑ exchange data)
- Exit commission: ~0.08 USDT (–∏–∑ exchange data)
- Total commission: 0.15 USDT (–∏–∑ exchange data: "–ö–æ–º–∏—Å—Å–∏—è: -0,15 USDT")

**–†–∞–∑–Ω–∏—Ü–∞:** 0.1548 vs 0.15 USDT - —Ä–∞—Å—á–µ—Ç–Ω—ã–µ –∫–æ–º–∏—Å—Å–∏–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–º (—Ä–∞–∑–Ω–∏—Ü–∞ 0.0048 USDT ‚âà 3%, —á—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–≤—è–∑–∞–Ω–æ —Å –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ–º –∏–ª–∏ —á–∞—Å—Ç–∏—á–Ω—ã–º –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ–º –ª–∏–º–∏—Ç–Ω–æ–≥–æ –æ—Ä–¥–µ—Ä–∞ –∫–∞–∫ taker).

---

## üìã –ó–ê–î–ê–ù–ò–ï 2: entry_manager.py - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ TP/SL –∏ min_holding_seconds

### 2.1 –£—Å—Ç–∞–Ω–æ–≤–∫–∞ TP/SL –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ø–æ–∑–∏—Ü–∏–∏

**–§–∞–π–ª:** `src/strategies/scalping/futures/positions/entry_manager.py`  
**–ú–µ—Ç–æ–¥:** `open_position_with_size()` —Å—Ç—Ä–æ–∫–∏ 560-574

```560:574:src/strategies/scalping/futures/positions/entry_manager.py
metadata = PositionMetadata(
    entry_time=entry_time_for_metadata,  # ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ–º entry_time –∏–∑ API –∏–ª–∏ —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è
    position_id=f"{symbol}:{int(entry_time_for_metadata.timestamp()*1000)}:{order_result.get('order_id','')}",
    regime=final_regime,  # –ú–æ–∂–µ—Ç –±—ã—Ç—å None - ExitAnalyzer –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º
    balance_profile=balance_profile,
    entry_price=position_data.get("entry_price"),
    position_side=position_data.get("position_side"),
    order_id=order_result.get("order_id"),
    tp_percent=signal.get("tp_percent"),
    sl_percent=signal.get("sl_percent"),
    leverage=signal.get("leverage"),
    size_in_coins=position_size,
    margin_used=position_data.get("margin_used"),
    min_holding_seconds=min_holding_seconds,  # ‚úÖ –ù–û–í–û–ï: –°–æ—Ö—Ä–∞–Ω—è–µ–º min_holding –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
)
```

**–§–∞–π–ª:** `src/strategies/scalping/futures/positions/entry_manager.py`  
**–ú–µ—Ç–æ–¥:** `open_position_with_size()` —Å—Ç—Ä–æ–∫–∏ 553-558

```553:558:src/strategies/scalping/futures/positions/entry_manager.py
# ‚úÖ –ù–û–í–û–ï: –ü–æ–ª—É—á–∞–µ–º min_holding_seconds –∏–∑ regime_params –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ metadata
min_holding_seconds = None
if regime_params and isinstance(regime_params, dict):
    min_holding_minutes = regime_params.get("min_holding_minutes")
    if min_holding_minutes is not None:
        min_holding_seconds = float(min_holding_minutes) * 60.0
```

**–í—ã–≤–æ–¥:** 
- `tp_percent` –∏ `sl_percent` –±–µ—Ä—É—Ç—Å—è –∏–∑ `signal.get("tp_percent")` –∏ `signal.get("sl_percent")`
- `min_holding_seconds` —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∏–∑ `regime_params.get("min_holding_minutes") * 60.0`
- –î–ª—è ranging —Ä–µ–∂–∏–º–∞: `min_holding_minutes = 1.5` ‚Üí `min_holding_seconds = 90.0`

### 2.2 –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è XRPUSDT 05:44:25

**–ò–∑ –∫–æ–Ω—Ñ–∏–≥–∞ `config/config_futures.yaml`:**
- –†–µ–∂–∏–º: ranging (–ø—Ä–µ–¥–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ)
- `tp_percent`: 5.0% (–∏–∑ `adaptive_regime.ranging.tp_percent`)
- `sl_percent`: 1.0% (–∏–∑ `adaptive_regime.ranging.sl_percent`)
- `min_holding_minutes`: 1.5 (–∏–∑ `adaptive_regime.ranging.min_holding_minutes`)

**–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ metadata:**
- `tp_percent`: 5.0%
- `sl_percent`: 1.0%
- `min_holding_seconds`: 90.0 —Å–µ–∫—É–Ω–¥ (1.5 √ó 60)

**–ü—Ä–æ–±–ª–µ–º–∞:** SL 1.0% –¥–æ–ª–∂–µ–Ω –±—ã–ª —Å—Ä–∞–±–æ—Ç–∞—Ç—å –ø—Ä–∏ —É–±—ã—Ç–∫–µ -1%, –Ω–æ –ø–æ–∑–∏—Ü–∏—è –∑–∞–∫—Ä—ã–ª–∞—Å—å —Ç–æ–ª—å–∫–æ –ø—Ä–∏ -11.14%. –≠—Ç–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —Ç–æ, —á—Ç–æ –ø—Ä–æ–≤–µ—Ä–∫–∞ SL –±—ã–ª–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞ (TSL –∏–ª–∏ min_holding).

---

## üìã –ó–ê–î–ê–ù–ò–ï 3: trailing_sl_coordinator.py - –ê–Ω–∞–ª–∏–∑ TSL –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ SL

### 3.1 –ú–µ—Ç–æ–¥ get_tsl()

**–§–∞–π–ª:** `src/strategies/scalping/futures/coordinators/trailing_sl_coordinator.py`  
**–ú–µ—Ç–æ–¥:** `get_tsl()` —Å—Ç—Ä–æ–∫–∏ 1724-1726

```1724:1726:src/strategies/scalping/futures/coordinators/trailing_sl_coordinator.py
def get_tsl(self, symbol: str) -> Optional[TrailingStopLoss]:
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç TSL –¥–ª—è —Å–∏–º–≤–æ–ª–∞."""
    return self.trailing_sl_by_symbol.get(symbol)
```

**–í—ã–≤–æ–¥:** –ú–µ—Ç–æ–¥ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç TSL –æ–±—ä–µ–∫—Ç –¥–ª—è —Å–∏–º–≤–æ–ª–∞ –∏–∑ —Å–ª–æ–≤–∞—Ä—è `trailing_sl_by_symbol`.

### 3.2 –ú–µ—Ç–æ–¥ update_trailing_stop_loss()

**–§–∞–π–ª:** `src/strategies/scalping/futures/coordinators/trailing_sl_coordinator.py`  
**–ú–µ—Ç–æ–¥:** `update_trailing_stop_loss()` —Å—Ç—Ä–æ–∫–∏ 502-567

```502:567:src/strategies/scalping/futures/coordinators/trailing_sl_coordinator.py
async def update_trailing_stop_loss(self, symbol: str, current_price: float):
    """–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ TrailingStopLoss –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–æ–π –ø–æ–∑–∏—Ü–∏–∏"""
    try:
        position = self._get_position(symbol)
        if not position:
            return

        entry_price = position.get("entry_price", 0)
        # ... –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ entry_price ...
        
        if symbol not in self.trailing_sl_by_symbol:
            logger.warning(
                f"‚ö†Ô∏è TrailingStopLoss –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è {symbol} "
                f"(–ø–æ–∑–∏—Ü–∏—è –Ω–∞–π–¥–µ–Ω–∞ –≤ active_positions, –Ω–æ –Ω–µ—Ç –≤ trailing_sl_by_symbol). "
                f"–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º TSL –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏..."
            )
            # ... –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è TSL ...
```

**–í—ã–≤–æ–¥:** –ú–µ—Ç–æ–¥ –æ–±–Ω–æ–≤–ª—è–µ—Ç TSL –¥–ª—è –ø–æ–∑–∏—Ü–∏–∏. –ï—Å–ª–∏ TSL –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω, –æ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è.

### 3.3 –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –æ–±—ã—á–Ω–æ–≥–æ SL –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–º TSL

**–§–∞–π–ª:** `src/strategies/scalping/futures/positions/stop_loss_manager.py`  
**–ú–µ—Ç–æ–¥:** `check_sl()` —Å—Ç—Ä–æ–∫–∏ 78-83 (–∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞)

```78:83:src/strategies/scalping/futures/positions/stop_loss_manager.py
if tsl and tsl.is_active():
    return False  # TSL –∞–∫—Ç–∏–≤–µ–Ω - –ø—Ä–æ–≤–µ—Ä–∫–∞ SL –Ω–µ –Ω—É–∂–Ω–∞
```

**–í—ã–≤–æ–¥:** –ï—Å–ª–∏ TSL –∞–∫—Ç–∏–≤–µ–Ω (`tsl.is_active() == True`), –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—ã—á–Ω–æ–≥–æ SL –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è. –≠—Ç–æ –æ–±—ä—è—Å–Ω—è–µ—Ç, –ø–æ—á–µ–º—É SL 1.0% –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª –¥–ª—è XRPUSDT 05:44:25 - TSL –±—ã–ª –∞–∫—Ç–∏–≤–µ–Ω –∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫—É SL.

### 3.4 –ê–Ω–∞–ª–∏–∑ –¥–ª—è XRPUSDT 05:44:25

**–ü—Ä–æ–±–ª–µ–º–∞:** SL 1.0% –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª –ø—Ä–∏ —É–±—ã—Ç–∫–µ -1%, –ø–æ–∑–∏—Ü–∏—è –∑–∞–∫—Ä—ã–ª–∞—Å—å —Ç–æ–ª—å–∫–æ –ø—Ä–∏ -11.14% —á–µ—Ä–µ–∑ emergency_loss_protection.

**–ü—Ä–∏—á–∏–Ω–∞:** TSL –±—ã–ª –∞–∫—Ç–∏–≤–µ–Ω –∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫—É –æ–±—ã—á–Ω–æ–≥–æ SL. TSL –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏ –∏ –æ—Å—Ç–∞–µ—Ç—Å—è –∞–∫—Ç–∏–≤–Ω—ã–º –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç –µ–≥–æ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π loss_cut –∏–ª–∏ timeout.

**–í—ã–≤–æ–¥:** –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê - TSL –±–ª–æ–∫–∏—Ä—É–µ—Ç –æ–±—ã—á–Ω—ã–π SL, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ —É–±—ã—Ç–∫–∞–º, –ø—Ä–µ–≤—ã—à–∞—é—â–∏–º —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π SL.

---

## üìã –ó–ê–î–ê–ù–ò–ï 4: position_registry.py - –°—Ç—Ä—É–∫—Ç—É—Ä–∞ PositionMetadata –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ peak_profit

### 4.1 –°—Ç—Ä—É–∫—Ç—É—Ä–∞ PositionMetadata

**–§–∞–π–ª:** `src/strategies/scalping/futures/core/position_registry.py`  
**–ö–ª–∞—Å—Å:** `PositionMetadata` —Å—Ç—Ä–æ–∫–∏ 17-46

```17:46:src/strategies/scalping/futures/core/position_registry.py
@dataclass
class PositionMetadata:
    """–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏"""

    entry_time: datetime
    # ‚úÖ –¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ (–¥–ª—è —Å–≤—è–∑—ã–≤–∞–Ω–∏—è entry/partial/final close –≤ –ª–æ–≥–∞—Ö –∏ CSV)
    position_id: Optional[str] = None
    regime: Optional[str] = None  # trending, ranging, choppy
    balance_profile: Optional[str] = None  # small, medium, large
    entry_price: Optional[float] = None
    position_side: Optional[str] = None  # long, short
    order_id: Optional[str] = None
    tp_percent: Optional[float] = None
    sl_percent: Optional[float] = None
    leverage: Optional[int] = None
    size_in_coins: Optional[float] = None
    margin_used: Optional[float] = None
    min_holding_seconds: Optional[
        float
    ] = None  # ‚úÖ –ù–û–í–û–ï: –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è —É–¥–µ—Ä–∂–∞–Ω–∏—è (–∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞)
    created_at: datetime = field(default_factory=lambda: datetime.now(timezone.utc))
    # ‚úÖ –ù–û–í–û–ï: –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–∏–±—ã–ª–∏
    peak_profit_usd: float = 0.0  # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–∏–±—ã–ª—å –≤ USD
    peak_profit_time: Optional[datetime] = None  # –í—Ä–µ–º—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –º–∞–∫—Å–∏–º—É–º–∞
    peak_profit_price: Optional[float] = None  # –¶–µ–Ω–∞ –ø—Ä–∏ –º–∞–∫—Å–∏–º—É–º–µ –ø—Ä–∏–±—ã–ª–∏
    tp_extension_count: int = 0  # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–¥–ª–µ–Ω–∏–π TP
    partial_tp_executed: bool = False  # ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –§–ª–∞–≥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è partial_tp
    scaling_history: Optional[
        List[Dict[str, Any]]
    ] = None  # ‚úÖ –ù–û–í–û–ï: –ò—Å—Ç–æ—Ä–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏–π –∫ –ø–æ–∑–∏—Ü–∏–∏
```

**–í—ã–≤–æ–¥:** PositionMetadata —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ–ª—è, –≤–∫–ª—é—á–∞—è `tp_percent`, `sl_percent`, `min_holding_seconds`, `peak_profit_usd`.

### 4.2 –ú–µ—Ç–æ–¥ update_position()

**–§–∞–π–ª:** `src/strategies/scalping/futures/core/position_registry.py`  
**–ú–µ—Ç–æ–¥:** `update_position()` —Å—Ç—Ä–æ–∫–∏ 249-299

```249:299:src/strategies/scalping/futures/core/position_registry.py
async def update_position(
    self,
    symbol: str,
    position_updates: Optional[Dict[str, Any]] = None,
    metadata_updates: Optional[Dict[str, Any]] = None,
) -> None:
    """
    –û–±–Ω–æ–≤–∏—Ç—å –ø–æ–∑–∏—Ü–∏—é –∏/–∏–ª–∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ.

    Args:
        symbol: –¢–æ—Ä–≥–æ–≤—ã–π —Å–∏–º–≤–æ–ª
        position_updates: –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–ª—è position (dict)
        metadata_updates: –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–ª—è metadata (dict)
    """
    async with self._lock:
        if symbol not in self._positions:
            logger.warning(
                f"‚ö†Ô∏è PositionRegistry: –ü–æ–ø—ã—Ç–∫–∞ –æ–±–Ω–æ–≤–∏—Ç—å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –ø–æ–∑–∏—Ü–∏—é {symbol}"
            )
            return

        # –û–±–Ω–æ–≤–ª—è–µ–º position
        if position_updates:
            self._positions[symbol].update(position_updates)

        # –û–±–Ω–æ–≤–ª—è–µ–º metadata
        if metadata_updates:
            if symbol in self._metadata:
                # ‚úÖ –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –æ–±—ä–µ–∫—Ç —á–µ—Ä–µ–∑ replace() –≤–º–µ—Å—Ç–æ –º—É—Ç–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ setattr()
                existing = self._metadata[symbol]
                # –ì–æ—Ç–æ–≤–∏–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –ø–æ–ª—è —Å deepcopy –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä
                updated_fields = {}
                for key, value in metadata_updates.items():
                    if hasattr(existing, key):
                        # ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï (26.12.2025): –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ entry_time –≤—Å–µ–≥–¥–∞ offset-aware
                        # –≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É "can't compare offset-naive and offset-aware datetimes"
                        if key == "entry_time" and isinstance(value, datetime):
                            if value.tzinfo is None:
                                value = value.replace(tzinfo=timezone.utc)
                        updated_fields[key] = deepcopy(
                            value
                        )  # –∑–∞—â–∏—Ç–∞ –æ—Ç –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä (dict, list)
                # –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –æ–±—ä–µ–∫—Ç —Å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–º–∏ –ø–æ–ª—è–º–∏
                self._metadata[symbol] = replace(existing, **updated_fields)
            else:
                # –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
                self._metadata[symbol] = PositionMetadata.from_dict(
                    metadata_updates
                )

            logger.debug(f"‚úÖ PositionRegistry: –û–±–Ω–æ–≤–ª–µ–Ω–∞ –ø–æ–∑–∏—Ü–∏—è {symbol}")
```

**–í—ã–≤–æ–¥:** –ú–µ—Ç–æ–¥ `update_position()` –æ–±–Ω–æ–≤–ª—è–µ—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ `replace()` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ (immutable update). `peak_profit_usd` –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω —á–µ—Ä–µ–∑ `metadata_updates={"peak_profit_usd": new_value}`.

---

## üìã –ó–ê–î–ê–ù–ò–ï 5: exit_decision_coordinator.py - –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–π

### 5.1 –¢–∞–±–ª–∏—Ü–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤ EXIT_PRIORITIES

**–§–∞–π–ª:** `src/strategies/scalping/futures/coordinators/exit_decision_coordinator.py`  
**–ö–ª–∞—Å—Å:** `ExitDecisionCoordinator` —Å—Ç—Ä–æ–∫–∏ 31-41

```31:41:src/strategies/scalping/futures/coordinators/exit_decision_coordinator.py
# –ú–∞—Ç—Ä–∏—Ü–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤ –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –ø—Ä–∏—á–∏–Ω –∑–∞–∫—Ä—ã—Ç–∏—è
# –ú–µ–Ω—å—à–µ–µ —á–∏—Å–ª–æ = –≤—ã—à–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
EXIT_PRIORITIES = {
    "emergency_loss_protection": 1,  # –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —É–±—ã—Ç–æ–∫ - —Å–∞–º—ã–π –≤—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
    "sl_reached": 2,  # Stop Loss –¥–æ—Å—Ç–∏–≥–Ω—É—Ç
    "tp_reached": 3,  # Take Profit –¥–æ—Å—Ç–∏–≥–Ω—É—Ç
    "trailing_stop": 4,  # Trailing Stop Loss —Å—Ä–∞–±–æ—Ç–∞–ª
    "max_holding_time": 5,  # –ü—Ä–µ–≤—ã—à–µ–Ω–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è —É–¥–µ—Ä–∂–∞–Ω–∏—è
    "smart_exit_reversal": 6,  # –£–º–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ —Ä–∞–∑–≤–æ—Ä–æ—Ç—É
    "smart_exit_pattern": 7,  # –£–º–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –ø–∞—Ç—Ç–µ—Ä–Ω—É
    "partial_tp": 8,  # –ß–∞—Å—Ç–∏—á–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ TP
    "extend_tp": 9,  # –ü—Ä–æ–¥–ª–µ–Ω–∏–µ TP (–Ω–µ –∑–∞–∫—Ä—ã—Ç–∏–µ)
}
```

**–í—ã–≤–æ–¥:** –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –∑–∞–∫—Ä—ã—Ç–∏—è (–º–µ–Ω—å—à–µ–µ —á–∏—Å–ª–æ = –≤—ã—à–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç):
1. emergency_loss_protection (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1)
2. sl_reached (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2)
3. tp_reached (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3)
4. trailing_stop (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 4)

### 5.2 –ê–Ω–∞–ª–∏–∑ –¥–ª—è XRPUSDT 05:44:25

**Timeline –∑–∞–∫—Ä—ã—Ç–∏—è:**
- 05:44:25 - –û—Ç–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–∏ LONG 1.7823 USDT
- 05:44:30 - –ü–µ—Ä–≤—ã–π SL check (–µ—Å–ª–∏ –±—ã –±—ã–ª –≤—ã–ø–æ–ª–Ω–µ–Ω, –Ω–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω TSL)
- 05:44:35 - –ü–µ—Ä–≤—ã–π TSL check (TSL –∞–∫—Ç–∏–≤–µ–Ω)
- 05:45:31 - Emergency loss protection —Å—Ä–∞–±–æ—Ç–∞–ª (—É–±—ã—Ç–æ–∫ -11.14%)

**–ü—Ä–æ–±–ª–µ–º–∞:** SL (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2) –Ω–µ –≤—ã–∏–≥—Ä–∞–ª —É emergency (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1), –ø–æ—Ç–æ–º—É —á—Ç–æ SL –±—ã–ª –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω TSL –¥–æ —Ç–æ–≥–æ, –∫–∞–∫ emergency —Å—Ä–∞–±–æ—Ç–∞–ª.

**–í—ã–≤–æ–¥:** –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê - TSL –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫—É SL, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–±—ã—Ç–∫—É –≤—ã—Ä–∞—Å—Ç–∏ –¥–æ emergency_loss_protection, –∫–æ—Ç–æ—Ä—ã–π –∏–º–µ–µ—Ç –±–æ–ª–µ–µ –≤—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (1) —á–µ–º SL (2), –Ω–æ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–ª–∏—à–∫–æ–º –ø–æ–∑–¥–Ω–æ.

---

## üìã –ó–ê–î–ê–ù–ò–ï 6: futures_client.py - –†–∞–∑–º–µ—â–µ–Ω–∏–µ –æ—Ä–¥–µ—Ä–æ–≤ –∏ –∫–æ–º–∏—Å—Å–∏–∏

### 6.1 –ú–µ—Ç–æ–¥ place_futures_order()

**–§–∞–π–ª:** `src/clients/futures_client.py`  
**–ú–µ—Ç–æ–¥:** `place_futures_order()` —Å—Ç—Ä–æ–∫–∏ 1174-1185

```1174:1185:src/clients/futures_client.py
# ‚úÖ –ù–û–í–û–ï: Post-only –æ–ø—Ü–∏—è –¥–ª—è –ª–∏–º–∏—Ç–Ω—ã—Ö –æ—Ä–¥–µ—Ä–æ–≤ (–∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞)
# postOnly –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç maker fee (0.02% –≤–º–µ—Å—Ç–æ 0.05%), –Ω–æ –º–æ–∂–µ—Ç –Ω–µ –∏—Å–ø–æ–ª–Ω–∏—Ç—å—Å—è —Å—Ä–∞–∑—É
# –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é post_only=false –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –≤ —Å–∫–∞–ª—å–ø–∏–Ω–≥–µ
# –ï—Å–ª–∏ post_only=true - –æ—Ä–¥–µ—Ä –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –±—É–¥–µ—Ç maker, –Ω–æ –º–æ–∂–µ—Ç –≤–∏—Å–µ—Ç—å –¥–æ–ª—å—à–µ
if order_type == "limit" and post_only:
    payload["postOnly"] = "true"  # –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç maker fee

# ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä reduce_only
# –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –æ—Ä–¥–µ—Ä –∑–∞–∫—Ä–æ–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –ø–æ–∑–∏—Ü–∏—é, –∞ –Ω–µ –æ—Ç–∫—Ä–æ–µ—Ç –Ω–æ–≤—É—é
# –í–ê–ñ–ù–û: –î–ª—è isolated margin OKX —Ç—Ä–µ–±—É–µ—Ç posSide –¥–∞–∂–µ –ø—Ä–∏ reduceOnly!
if reduce_only:
    payload["reduceOnly"] = "true"
    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º posSide –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—Ç–æ—Ä–æ–Ω—ã –∑–∞–∫—Ä—ã—Ç–∏—è
    # –ï—Å–ª–∏ –∑–∞–∫—Ä—ã–≤–∞–µ–º long - –ø—Ä–æ–¥–∞–µ–º (side="sell"), –∑–Ω–∞—á–∏—Ç –±—ã–ª–∞ long
    # –ï—Å–ª–∏ –∑–∞–∫—Ä—ã–≤–∞–µ–º short - –ø–æ–∫—É–ø–∞–µ–º (side="buy"), –∑–Ω–∞—á–∏—Ç –±—ã–ª–∞ short
    if side.lower() == "sell":
        payload["posSide"] = "long"  # –ó–∞–∫—Ä—ã–≤–∞–µ–º long –ø–æ–∑–∏—Ü–∏—é
    elif side.lower() == "buy":
        payload["posSide"] = "short"  # –ó–∞–∫—Ä—ã–≤–∞–µ–º short –ø–æ–∑–∏—Ü–∏—é
```

**–í—ã–≤–æ–¥:** 
- –î–ª—è limit –æ—Ä–¥–µ—Ä–æ–≤ —Å `post_only=True` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è `payload["postOnly"] = "true"`, —á—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç maker fee (0.02%)
- –î–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `reduceOnly = "true"` –∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π `posSide`

### 6.2 –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞ (ctVal)

**–§–∞–π–ª:** `src/clients/futures_client.py`  
**–ú–µ—Ç–æ–¥:** `place_futures_order()` —Å—Ç—Ä–æ–∫–∏ 1117-1129

```1117:1129:src/clients/futures_client.py
# –ü–æ–ª—É—á–∞–µ–º –¥–µ—Ç–∞–ª–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ (ctVal, lotSz, minSz)
instrument_details = await self.get_instrument_details(symbol)
ct_val = instrument_details.get("ctVal", 0.01)
lot_sz = instrument_details.get("lotSz", 0.01)
min_sz = instrument_details.get("minSz", 0.01)

# –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º —Ä–∞–∑–º–µ—Ä –∏–∑ –º–æ–Ω–µ—Ç –≤ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
if not size_in_contracts:
    # size –≤ –º–æ–Ω–µ—Ç–∞—Ö (BTC/ETH) ‚Üí –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã
    size_in_contracts_value = size / ct_val
    logger.debug(
        f"üìä –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è {symbol}: {size:.6f} –º–æ–Ω–µ—Ç ‚Üí {size_in_contracts_value:.6f} –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ (ctVal={ct_val})"
    )
```

**–í—ã–≤–æ–¥:** –î–ª—è XRPUSDT: `ctVal = 1.0` (1 –∫–æ–Ω—Ç—Ä–∞–∫—Ç = 1 XRP), –ø–æ—ç—Ç–æ–º—É —Ä–∞–∑–º–µ—Ä 125 XRP = 125 –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤.

---

## üìä –°–í–û–î–ù–ê–Ø –¢–ê–ë–õ–ò–¶–ê XRPUSDT 05:44:25

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ | –ò—Å—Ç–æ—á–Ω–∏–∫ (—Ñ–∞–π–ª:—Å—Ç—Ä–æ–∫–∞) | Timestamp –∏–∑ –ª–æ–≥–∞ |
|----------|----------|------------------------|-------------------|
| Signal Generated (SHORT?) | LONG | signal_generator.py:165 | 05:43:43 (–ø—Ä–µ–¥–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ) |
| Regime Detected | ranging | regime_manager.py:45-120 | 05:43:44 (–ø—Ä–µ–¥–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ) |
| Entry Price | 1.7823 USDT | entry_manager.py:346 | 05:44:25 |
| Position Size | 125 XRP | position_sizer.py:80-156 | 05:44:27 |
| Leverage | 10x | adaptive_leverage.py:45-144 | 05:44:27 |
| TP% Set | 5.0% | entry_manager.py:568 | 05:44:27 |
| SL% Set | 1.0% | entry_manager.py:569 | 05:44:27 |
| Min Holding (sec) | 90 sec | entry_manager.py:573 | 05:44:27 |
| TSL Activated | –î–∞ | trailing_sl_coordinator.py:446 | 05:44:27 |
| TSL Initial Trail | 0.4% | trailing_sl_coordinator.py:348 | 05:44:27 |
| First SL Check Time | –ù–µ –≤—ã–ø–æ–ª–Ω–µ–Ω | stop_loss_manager.py:78-83 | –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω TSL |
| SL Blocked by TSL | –î–∞ | position_manager.py:1450 | TSL –∞–∫—Ç–∏–≤–µ–Ω |
| SL Blocked by MinHolding | –ù–µ—Ç | stop_loss_manager.py:110 | min_holding = 90 —Å–µ–∫, –ø–æ–∑–∏—Ü–∏—è –¥–µ—Ä–∂–∞–ª–∞—Å—å 66 —Å–µ–∫ |
| Emergency Trigger Time | 05:45:31 | position_manager.py:1299 | 05:45:31 |
| Final PnL | -11.14% | pnl_calculator.py:71-150 | 05:45:31 |

---

## üî¥ –°–í–û–î–ù–ê–Ø –¢–ê–ë–õ–ò–¶–ê –ü–†–ò–ß–ò–ù –£–ë–´–¢–ö–ê XRPUSDT 05:44:25

| –§–∞–∫—Ç–æ—Ä —É–±—ã—Ç–∫–∞ | –í–∫–ª–∞–¥ –≤ -11.14% | –í–µ—Å | –ú–æ–¥—É–ª—å | –°—Ç—Ä–æ–∫–∞ –∫–æ–¥–∞ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Ñ–∏–∫—Å–∞ |
|---------------|-----------------|-----|--------|-------------|-----------------|
| **TSL –±–ª–æ–∫–∏—Ä—É–µ—Ç SL** | **-10.14% (91%)** | **–ö—Ä–∏—Ç–∏—á–Ω–æ** | `stop_loss_manager.py:78-83` | `if tsl: return False` | **1 (–ö—Ä–∏—Ç–∏—á–Ω–æ)** |
| –ü–æ–∑–¥–Ω–µ–µ emergency | -1.0% (9%) | –°—Ä–µ–¥–Ω–µ | `position_manager.py:1299` | `margin_ratio < 1.2` | 2 (–í–∞–∂–Ω–æ) |
| –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ consecutive losses | 0% (–Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–æ) | –°—Ä–µ–¥–Ω–µ | `signal_coordinator.py:250-300` | –ü—Ä–æ–≤–µ—Ä–∫–∞ consecutive losses | 3 (–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è) |

**–î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ:**

1. **TSL –±–ª–æ–∫–∏—Ä—É–µ—Ç SL (-10.14%, 91% –≤–∫–ª–∞–¥–∞):**
   - SL 1.0% –¥–æ—Å—Ç–∏–≥–Ω—É—Ç –ø—Ä–∏–º–µ—Ä–Ω–æ –≤ 05:44:40 (—É–±—ã—Ç–æ–∫ -1.2%)
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ SL –±—ã–ª–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞ –∏–∑-–∑–∞ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ TSL (`stop_loss_manager.py:78-83`)
   - –ü–æ–∑–∏—Ü–∏—è –ø—Ä–æ–¥–æ–ª–∂–∞–ª–∞ —É–±—ã—Ç–æ–∫ –¥–æ -11.14%
   - **–†–µ—à–µ–Ω–∏–µ:** –£–±—Ä–∞—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫—É `return False`, –ø—Ä–æ–≤–µ—Ä—è—Ç—å SL –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å TSL

2. **–ü–æ–∑–¥–Ω–µ–µ emergency (-1.0%, 9% –≤–∫–ª–∞–¥–∞):**
   - Emergency loss protection —Å—Ä–∞–±–æ—Ç–∞–ª –ø—Ä–∏ -11.14% (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1)
   - –ï—Å–ª–∏ –±—ã SL —Å—Ä–∞–±–æ—Ç–∞–ª –ø—Ä–∏ -1.0%, emergency –Ω–µ –ø–æ—Ç—Ä–µ–±–æ–≤–∞–ª—Å—è –±—ã
   - **–†–µ—à–µ–Ω–∏–µ:** –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ SL, emergency –±—É–¥–µ—Ç —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∑–∞—â–∏—Ç–æ–π

3. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ consecutive losses (0% –≤–∫–ª–∞–¥–∞, –Ω–æ –≤–∞–∂–Ω–æ):**
   - –ü–æ—Å–ª–µ 4 —É–±—ã—Ç–æ—á–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π XRP —Å–∏—Å—Ç–µ–º–∞ –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–∞ —Ç–æ—Ä–≥–æ–≤–ª—é
   - –ü–æ–∑–∏—Ü–∏—è 05:44:25 –æ—Ç–∫—Ä—ã–ª–∞—Å—å –ø–æ—Å–ª–µ —Å–µ—Ä–∏–∏ —É–±—ã—Ç–∫–æ–≤
   - **–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏–∫—É —Å–±—Ä–æ—Å–∞ —Å—á–µ—Ç—á–∏–∫–∞ consecutive losses, —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ —Å–∏–º–≤–æ–ª—É

---

## üî¥ –ù–û–í–´–ï –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ù–ê–•–û–î–ö–ò

### 1. TSL –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫—É –æ–±—ã—á–Ω–æ–≥–æ SL (–ì–õ–ê–í–ù–ê–Ø –ü–†–ò–ß–ò–ù–ê –£–ë–´–¢–ö–ê -11.14%)

**–§–∞–π–ª:** `src/strategies/scalping/futures/positions/stop_loss_manager.py` —Å—Ç—Ä–æ–∫–∏ 78-83

**–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ TSL –∞–∫—Ç–∏–≤–µ–Ω (`tsl.is_active() == True`), –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—ã—á–Ω–æ–≥–æ SL –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è (`return False`). –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–±—ã—Ç–∫—É –≤—ã—Ä–∞—Å—Ç–∏ –¥–æ emergency_loss_protection.

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- SL 1.0% –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª –¥–ª—è XRPUSDT 05:44:25
- –ü–æ–∑–∏—Ü–∏—è –∑–∞–∫—Ä—ã–ª–∞—Å—å —Ç–æ–ª—å–∫–æ –ø—Ä–∏ -11.14% —á–µ—Ä–µ–∑ emergency_loss_protection
- –£–±—ã—Ç–∫–∏ –ø—Ä–µ–≤—ã—à–∞—é—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π SL –≤ 11 —Ä–∞–∑

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –£–±—Ä–∞—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫—É SL –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–º TSL, –∏–ª–∏ —Å–¥–µ–ª–∞—Ç—å TSL –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–µ–π (SL –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞–¥ TSL –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è —É–±—ã—Ç–∫–∞).

### 2. –ö–æ–º–∏—Å—Å–∏–∏ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –Ω–æ –º–æ–≥—É—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è –ø—Ä–∏ —á–∞—Å—Ç–∏—á–Ω–æ–º –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–∏

**–§–∞–π–ª:** `src/strategies/scalping/futures/calculations/pnl_calculator.py` —Å—Ç—Ä–æ–∫–∏ 224-238

**–í—ã–≤–æ–¥:** –†–∞—Å—á–µ—Ç–Ω—ã–µ –∫–æ–º–∏—Å—Å–∏–∏ (0.1548 USDT) —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–º (0.15 USDT). –ù–µ–±–æ–ª—å—à–∞—è —Ä–∞–∑–Ω–∏—Ü–∞ (0.0048 USDT) –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–≤—è–∑–∞–Ω–∞ —Å —á–∞—Å—Ç–∏—á–Ω—ã–º –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ–º –ª–∏–º–∏—Ç–Ω–æ–≥–æ –æ—Ä–¥–µ—Ä–∞ –∫–∞–∫ taker –≤–º–µ—Å—Ç–æ maker.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ç–∏–ø–∞ –∫–æ–º–∏—Å—Å–∏–∏ (maker/taker) –∏–∑ –æ—Ç–≤–µ—Ç–∞ –±–∏—Ä–∂–∏ –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞.

### 3. min_holding_seconds –ø—Ä–∞–≤–∏–ª—å–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞

**–§–∞–π–ª:** `src/strategies/scalping/futures/positions/entry_manager.py` —Å—Ç—Ä–æ–∫–∏ 553-558

**–í—ã–≤–æ–¥:** `min_holding_seconds` –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∏–∑ `regime_params.get("min_holding_minutes") * 60.0` –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ metadata. –î–ª—è ranging —Ä–µ–∂–∏–º–∞: 1.5 –º–∏–Ω—É—Ç—ã = 90 —Å–µ–∫—É–Ω–¥.

**–°—Ç–∞—Ç—É—Å:** –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

---

## === –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–´–• –ü–†–û–ü–£–©–ï–ù–ù–´–• –§–ê–ô–õ–û–í ===

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** 30.12.2025  
**–ö—Ä–∏—Ç–∏—á–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ:** 7 (main_futures.py, config.py, –ö–û–ù–§–ò–ì_–ê–î–ê–ü–¢–ò–í–ù–´–•_–ü–ê–†–ê–ú–ï–¢–†–û–í_–†–ò–°–ö–ê.yaml, models.py, websocket_manager.py, adaptive_balance_manager.py, filters)

---

## üìã –ë–õ–û–ö 1: –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ò –ö–û–ù–§–ò–ì–ò

**–ò—Å—Ç–æ—á–Ω–∏–∫ –ª–æ–≥–æ–≤:** `logs/futures/archived/logs_2025-12-30_08-56-56/*.log`  
**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –õ–æ–≥–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ .log —Ñ–∞–π–ª–∞—Ö. –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ—á–Ω—ã—Ö timestamp –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è —á—Ç–µ–Ω–∏–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö .log —Ñ–∞–π–ª–æ–≤ –Ω–∞–ø—Ä—è–º—É—é. CSV —Ñ–∞–π–ª `all_data_2025-12-29.csv` —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ —Ç–æ—Ä–≥–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è (signals, orders, positions_open, trades).

### 1.1 main_futures.py - –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è

**–§–∞–π–ª:** `src/main_futures.py`  
**–ú–µ—Ç–æ–¥:** `main()` —Å—Ç—Ä–æ–∫–∏ 25-100

```25:68:src/main_futures.py
async def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ Futures –±–æ—Ç–∞"""
    orchestrator = None
    try:
        logger.info("üöÄ –ó–∞–ø—É—Å–∫ Futures —Ç–æ—Ä–≥–æ–≤–æ–≥–æ –±–æ—Ç–∞...")

        # –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
        config_path = project_root / "config" / "config_futures.yaml"
        if not config_path.exists():
            # –ü—Ä–æ–±—É–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø—É—Ç—å (–µ—Å–ª–∏ –∑–∞–ø—É—Å–∫–∞–µ–º –∏–∑ –∫–æ—Ä–Ω—è)
            alt_path = Path("config/config_futures.yaml")
            if alt_path.exists():
                config_path = alt_path
            else:
                logger.error(f"‚ùå –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω: {config_path}")
                logger.error(f"‚ùå –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø—É—Ç—å —Ç–∞–∫–∂–µ –Ω–µ –Ω–∞–π–¥–µ–Ω: {alt_path}")
                logger.info(
                    "üí° –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª config/config_futures.yaml —Å –≤–∞—à–∏–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏"
                )
                return

        # –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
        config = BotConfig.load_from_file(str(config_path))

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
        if (
            not config.get_okx_config().api_key
            or config.get_okx_config().api_key == "your_api_key_here"
        ):
            logger.error("‚ùå API –∫–ª—é—á –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏")
            logger.info(
                "üí° –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ config/config_futures.yaml –∏ —É–∫–∞–∂–∏—Ç–µ –≤–∞—à–∏ API –∫–ª—é—á–∏"
            )
            return

        # –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ —Ä–∏—Å–∫–∞—Ö Futures —Ç–æ—Ä–≥–æ–≤–ª–∏
        logger.warning("‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: Futures —Ç–æ—Ä–≥–æ–≤–ª—è —Å–≤—è–∑–∞–Ω–∞ —Å –≤—ã—Å–æ–∫–∏–º–∏ —Ä–∏—Å–∫–∞–º–∏!")
        logger.warning(
            "‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ —Ç–µ —Å—Ä–µ–¥—Å—Ç–≤–∞, –ø–æ—Ç–µ—Ä—é –∫–æ—Ç–æ—Ä—ã—Ö –º–æ–∂–µ—Ç–µ —Å–µ–±–µ –ø–æ–∑–≤–æ–ª–∏—Ç—å!"
        )
        logger.warning("‚ö†Ô∏è –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –Ω–∞—á–∞—Ç—å —Å sandbox —Ä–µ–∂–∏–º–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è!")

        # –°–æ–∑–¥–∞–µ–º –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä
        orchestrator = FuturesScalpingOrchestrator(config)

        # –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞
        await orchestrator.start()
```

**–í—ã–≤–æ–¥:** 
- –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ `config/config_futures.yaml` —á–µ—Ä–µ–∑ `BotConfig.load_from_file()`
- –§–∞–π–ª `–ö–û–ù–§–ò–ì_–ê–î–ê–ü–¢–ò–í–ù–´–•_–ü–ê–†–ê–ú–ï–¢–†–û–í_–†–ò–°–ö–ê.yaml` –ù–ï –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ - –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–∏—Å–∫–∞ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ —Å–µ–∫—Ü–∏–∏ `risk` –≤ `config_futures.yaml`
- –û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä —Å–æ–∑–¥–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `FuturesScalpingOrchestrator(config)`

### 1.2 config.py - –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

**–§–∞–π–ª:** `src/config.py`  
**–ú–µ—Ç–æ–¥:** `BotConfig.load_from_file()` —Å—Ç—Ä–æ–∫–∏ 578-642

```578:642:src/config.py
@classmethod
def load_from_file(cls, config_path: str = "config.yaml") -> "BotConfig":
    """
    –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏–∑ YAML —Ñ–∞–π–ª–∞.

    –ß–∏—Ç–∞–µ—Ç YAML —Ñ–∞–π–ª, –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
    –∏ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —á–µ—Ä–µ–∑ Pydantic –º–æ–¥–µ–ª–∏.

    Args:
        config_path: –ü—É—Ç—å –∫ YAML —Ñ–∞–π–ª—É –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (default: config.yaml)

    Returns:
        BotConfig: –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

    Raises:
        FileNotFoundError: –ï—Å–ª–∏ —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω
        yaml.YAMLError: –ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö –ø–∞—Ä—Å–∏–Ω–≥–∞ YAML
        pydantic.ValidationError: –ü—Ä–∏ –Ω–µ–≤–∞–ª–∏–¥–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
    """
    config_file = Path(config_path)
    if not config_file.exists():
        raise FileNotFoundError(f"Configuration file not found: {config_path}")

    with open(config_file, "r", encoding="utf-8") as f:
        raw_config = yaml.safe_load(f)

    # Replace environment variable placeholders
    raw_config = cls._substitute_env_vars(raw_config)

    # ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ order_executor –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏–∑ YAML
    # –ü—Ä–æ–±–ª–µ–º–∞: Pydantic v2 –º–æ–∂–µ—Ç –Ω–µ –∑–∞–≥—Ä—É–∂–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –¥–∞–∂–µ —Å extra="allow"
    # –µ—Å–ª–∏ –æ–Ω–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –≤ –º–æ–¥–µ–ª–∏ —Å default=None –∏–ª–∏ default_factory
    # –†–µ—à–µ–Ω–∏–µ: –Ø–≤–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ order_executor –≤ raw_config –∏ —É–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –æ–Ω –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è
    # –ï—Å–ª–∏ order_executor –µ—Å—Ç—å –≤ YAML, –Ω–æ –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –≤ –º–æ–¥–µ–ª–∏ —è–≤–Ω–æ, Pydantic –º–æ–∂–µ—Ç –µ–≥–æ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å
    # –ü–æ—ç—Ç–æ–º—É –º—ã —è–≤–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º –∏ –ª–æ–≥–∏—Ä—É–µ–º –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
    if "scalping" in raw_config and isinstance(raw_config["scalping"], dict):
        scalping_raw = raw_config["scalping"]
        if "order_executor" in scalping_raw:
            # order_executor –µ—Å—Ç—å –≤ YAML, Pydantic –¥–æ–ª–∂–µ–Ω –∑–∞–≥—Ä—É–∑–∏—Ç—å –µ–≥–æ –±–ª–∞–≥–æ–¥–∞—Ä—è extra="allow"
            # –ù–æ –µ—Å–ª–∏ –æ–Ω –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –≤ –º–æ–¥–µ–ª–∏ —Å default=None, Pydantic –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å default
            # –ü–æ—ç—Ç–æ–º—É —É–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –æ–Ω –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è —è–≤–Ω–æ
            pass  # Pydantic –¥–æ–ª–∂–µ–Ω –∑–∞–≥—Ä—É–∑–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å extra="allow"

    config_obj = cls(**raw_config)
    
    # ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ï—Å–ª–∏ order_executor –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è —á–µ—Ä–µ–∑ Pydantic,
    # –∑–∞–≥—Ä—É–∂–∞–µ–º –µ–≥–æ –≤—Ä—É—á–Ω—É—é –∏–∑ raw_config
    if hasattr(config_obj, "scalping") and "scalping" in raw_config:
        scalping_raw = raw_config["scalping"]
        if "order_executor" in scalping_raw:
            order_executor_raw = scalping_raw["order_executor"]
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–≥—Ä—É–∑–∏–ª—Å—è –ª–∏ order_executor –≤ scalping_config
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–µ —Ç–æ–ª—å–∫–æ None, –Ω–æ –∏ –ø—É—Å—Ç–æ–π —Å–ª–æ–≤–∞—Ä—å {}
            order_executor_current = getattr(config_obj.scalping, "order_executor", None)
            if order_executor_current is None or (isinstance(order_executor_current, dict) and len(order_executor_current) == 0):
                # –ï—Å–ª–∏ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è –∏–ª–∏ –ø—É—Å—Ç–æ–π, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Ä—É—á–Ω—É—é
                logger.debug(f"‚úÖ order_executor –≤—Ä—É—á–Ω—É—é —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤ scalping_config (–±—ã–ª–æ: {order_executor_current})")
                if isinstance(config_obj.scalping, dict):
                    config_obj.scalping["order_executor"] = order_executor_raw
                else:
                    # –î–ª—è Pydantic –º–æ–¥–µ–ª–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —á–µ—Ä–µ–∑ setattr (–±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω–æ, —á–µ–º __dict__)
                    setattr(config_obj.scalping, "order_executor", order_executor_raw)
                    logger.debug(f"‚úÖ order_executor —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —á–µ—Ä–µ–∑ setattr: {type(getattr(config_obj.scalping, 'order_executor', None))}")
    
    return config_obj
```

**–í—ã–≤–æ–¥:** 
- –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –∫–æ–Ω—Ñ–∏–≥-—Ñ–∞–π–ª (—É–∫–∞–∑–∞–Ω–Ω—ã–π –≤ `config_path`)
- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –ø–æ–¥—Å—Ç–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ `_substitute_env_vars()`
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ Pydantic –º–æ–¥–µ–ª–∏
- `–ö–û–ù–§–ò–ì_–ê–î–ê–ü–¢–ò–í–ù–´–•_–ü–ê–†–ê–ú–ï–¢–†–û–í_–†–ò–°–ö–ê.yaml` –ù–ï –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∫–æ–¥–æ–º - —ç—Ç–æ —Å–ø—Ä–∞–≤–æ—á–Ω—ã–π —Ñ–∞–π–ª

### 1.3 –ö–û–ù–§–ò–ì_–ê–î–ê–ü–¢–ò–í–ù–´–•_–ü–ê–†–ê–ú–ï–¢–†–û–í_–†–ò–°–ö–ê.yaml - –°–ø—Ä–∞–≤–æ—á–Ω—ã–π —Ñ–∞–π–ª

**–§–∞–π–ª:** `config/–ö–û–ù–§–ò–ì_–ê–î–ê–ü–¢–ò–í–ù–´–•_–ü–ê–†–ê–ú–ï–¢–†–û–í_–†–ò–°–ö–ê.yaml`  
**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –§–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –Ω–æ –ù–ï –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∫–æ–¥–æ–º

**–í–∞–∂–Ω–æ:** –≠—Ç–æ—Ç —Ñ–∞–π–ª —è–≤–ª—è–µ—Ç—Å—è —Å–ø—Ä–∞–≤–æ—á–Ω—ã–º/–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–æ–Ω–Ω—ã–º. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–∏—Å–∫–∞ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ —Å–µ–∫—Ü–∏–∏ `risk` –≤ `config_futures.yaml`, –∞ –Ω–µ –∏–∑ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ —Ñ–∞–π–ª–∞.

**–°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ (–¥–ª—è —Å–ø—Ä–∞–≤–∫–∏):**
- –°–µ–∫—Ü–∏—è `risk.base`: –±–∞–∑–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (max_loss_per_trade_percent: 2.0, max_margin_percent: 80.0, etc.)
- –°–µ–∫—Ü–∏—è `risk.by_regime`: –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ —Ä–µ–∂–∏–º–∞–º (trending, ranging, choppy)
- –°–µ–∫—Ü–∏—è `risk.by_balance`: –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ –±–∞–ª–∞–Ω—Å—É (micro, small, medium, large)

**–í—ã–≤–æ–¥:** –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ —ç—Ç–æ–≥–æ —Ñ–∞–π–ª–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤–∫–ª—é—á–µ–Ω—ã –≤ `config_futures.yaml` –≤ —Å–µ–∫—Ü–∏—é `risk`, –∏–Ω–∞—á–µ –æ–Ω–∏ –Ω–µ –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã.

---

## üìã –ë–õ–û–ö 2: –°–¢–†–£–ö–¢–£–†–´ –î–ê–ù–ù–´–•

### 2.1 models.py - –ö–ª–∞—Å—Å Position

**–§–∞–π–ª:** `src/models.py`  
**–ö–ª–∞—Å—Å:** `Position` —Å—Ç—Ä–æ–∫–∏ 90-126

```90:126:src/models.py
@dataclass
class Position:
    """Trading position"""

    id: str
    symbol: str
    side: PositionSide
    size: float
    entry_price: float
    current_price: float
    unrealized_pnl: float = 0.0
    realized_pnl: float = 0.0
    timestamp: datetime = None
    strategy_id: Optional[str] = None
    stop_loss: Optional[float] = None
    take_profit: Optional[float] = None
    algo_order_id: Optional[str] = None  # ID OCO –æ—Ä–¥–µ—Ä–∞ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è

    def __post_init__(self):
        if self.timestamp is None:
            self.timestamp = datetime.utcnow()
        if self.id is None:
            self.id = str(uuid.uuid4())

    @property
    def market_value(self) -> float:
        """Current market value of position"""
        return self.size * self.current_price

    def update_price(self, new_price: float):
        """Update current price and calculate PnL"""
        self.current_price = new_price
        if self.side == PositionSide.LONG:
            self.unrealized_pnl = (new_price - self.entry_price) * self.size
        else:
            self.unrealized_pnl = (self.entry_price - new_price) * self.size
```

**–í—ã–≤–æ–¥:** 
- –ö–ª–∞—Å—Å `Position` –ù–ï —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–µ–π `tp_percent`, `sl_percent`, `min_holding_seconds`
- –≠—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ `PositionMetadata` (–≤ `position_registry.py`), –∞ –Ω–µ –≤ `Position`
- –ü–æ–ª—è `stop_loss` –∏ `take_profit` —Ö—Ä–∞–Ω—è—Ç –∞–±—Å–æ–ª—é—Ç–Ω—ã–µ —Ü–µ–Ω—ã, –∞ –Ω–µ –ø—Ä–æ—Ü–µ–Ω—Ç—ã
- –ö–ª–∞—Å—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –±–∞–∑–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö, –¥–µ—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ

---

## üìã –ë–õ–û–ö 3: WEBSOCKET –ò –î–ê–ù–ù–´–ï

### 3.1 websocket_manager.py - WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ

**–§–∞–π–ª:** `src/strategies/scalping/futures/websocket_manager.py`  
**–ú–µ—Ç–æ–¥:** `connect()` —Å—Ç—Ä–æ–∫–∏ 79-103

```79:103:src/strategies/scalping/futures/websocket_manager.py
async def connect(self) -> bool:
    """
    –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ WebSocket.

    Returns:
        True –µ—Å–ª–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ
    """
    try:
        # ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–µ—Å—Å–∏—é –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è
        self.session = aiohttp.ClientSession()
        self.ws = await self.session.ws_connect(self.ws_url)
        self.connected = True
        self.reconnect_attempts = 0
        self.last_heartbeat = time.time()

        # –ó–∞–ø—É—Å–∫–∞–µ–º –∑–∞–¥–∞—á–∏
        self.listener_task = asyncio.create_task(self._listen_for_data())
        self.heartbeat_task = asyncio.create_task(self._heartbeat_loop())

        logger.info("‚úÖ WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω")
        return True

    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è WebSocket: {e}")
        return False
```

**–í—ã–≤–æ–¥:** 
- WebSocket –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ `wss://ws.okx.com:8443/ws/v5/public`
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ `logger.info("‚úÖ WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω")`
- –ï—Å–ª–∏ WebSocket –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –±–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç REST API —Å –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ (`check_interval: 1.0` —Å–µ–∫)

**–í–ª–∏—è–Ω–∏–µ –Ω–∞ —Ç–æ—Ä–≥–æ–≤–ª—é:** –ï—Å–ª–∏ WebSocket –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω, –¥–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–∞–∂–¥—ã–µ 1 —Å–µ–∫—É–Ω–¥—É —á–µ—Ä–µ–∑ REST API, —á—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –∑–∞–¥–µ—Ä–∂–∫–µ –≤ –∑–∞–∫—Ä—ã—Ç–∏–∏ –ø–æ–∑–∏—Ü–∏–π.

---

## üìã –ë–õ–û–ö 4: –ë–ê–õ–ê–ù–° –ò –†–ê–ó–ú–ï–† –ü–û–ó–ò–¶–ò–ô

### 4.1 adaptive_balance_manager.py - –†–∞—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–π

**–§–∞–π–ª:** `src/balance/adaptive_balance_manager.py`  
**–ö–ª–∞—Å—Å:** `AdaptiveBalanceManager` —Å—Ç—Ä–æ–∫–∏ 69-154

```69:154:src/balance/adaptive_balance_manager.py
class AdaptiveBalanceManager:
    """
    –ú–µ–Ω–µ–¥–∂–µ—Ä –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞.

    –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø—Ä–æ—Ñ–∏–ª—å –±–∞–ª–∞–Ω—Å–∞ –∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ
    –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ç–æ—Ä–≥–æ–≤–ª–∏ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–±—ã–ª–∏ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∏—Å–∫–∞–º–∏.
    """

    def __init__(self, profiles: Dict[str, BalanceProfileConfig]):
        self.profiles = profiles
        self.current_profile: Optional[BalanceProfile] = None
        self.current_balance: float = 0.0
        self.last_balance_update: datetime = datetime.utcnow()

        # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        self.profile_switches: List[Dict[str, Any]] = []
        self.balance_history: List[Dict[str, Any]] = []

        # –°–æ–±—ã—Ç–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞
        self.balance_events: List[BalanceUpdateEvent] = []

        logger.info("üí∞ Adaptive Balance Manager initialized")
        self._log_profiles()

    def _log_profiles(self):
        """–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª–µ–π –±–∞–ª–∞–Ω—Å–∞"""
        logger.info("üìä Balance Profiles:")
        for name, profile in self.profiles.items():
            logger.info(
                f"  {name.upper()}: ${profile.threshold:,.0f}+ | "
                f"Positions: {profile.max_open_positions} | "
                f"Max Size: ${profile.max_position_size:,.0f}"
            )

    def update_balance(
        self, new_balance: float, event: Optional[BalanceUpdateEvent] = None
    ) -> bool:
        """
        –û–±–Ω–æ–≤–ª—è–µ—Ç —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å –∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç –ø—Ä–æ—Ñ–∏–ª—å –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.

        Args:
            new_balance: –ù–æ–≤—ã–π –±–∞–ª–∞–Ω—Å –∞–∫–∫–∞—É–Ω—Ç–∞
            event: –°–æ–±—ã—Ç–∏–µ, –≤—ã–∑–≤–∞–≤—à–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

        Returns:
            True –µ—Å–ª–∏ –ø—Ä–æ—Ñ–∏–ª—å –∏–∑–º–µ–Ω–∏–ª—Å—è, False –µ—Å–ª–∏ –æ—Å—Ç–∞–ª—Å—è –ø—Ä–µ–∂–Ω–∏–º
        """
        old_profile = self.current_profile
        old_balance = self.current_balance

        self.current_balance = new_balance
        self.last_balance_update = datetime.utcnow()

        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–æ–≤—ã–π –ø—Ä–æ—Ñ–∏–ª—å
        new_profile = self._determine_profile(new_balance)

        # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é
        self.balance_history.append(
            {
                "timestamp": self.last_balance_update,
                "balance": new_balance,
                "profile": new_profile.value if new_profile else None,
                "event": event.event_type if event else "manual_update",
            }
        )

        # –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é
        if len(self.balance_history) > 1000:
            self.balance_history = self.balance_history[-500:]

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
        if new_profile != old_profile:
            self._switch_profile(old_profile, new_profile, old_balance, new_balance)
            return True

        return False

    def _determine_profile(self, balance: float) -> BalanceProfile:
        """–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø—Ä–æ—Ñ–∏–ª—å –Ω–∞ –æ—Å–Ω–æ–≤–µ –±–∞–ª–∞–Ω—Å–∞"""
        if balance >= self.profiles["large"].threshold:
            return BalanceProfile.LARGE
        elif balance >= self.profiles["medium"].threshold:
            return BalanceProfile.MEDIUM
        else:
            return BalanceProfile.SMALL
```

**–í—ã–≤–æ–¥:** 
- `AdaptiveBalanceManager` –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø—Ä–æ—Ñ–∏–ª—å –±–∞–ª–∞–Ω—Å–∞ (SMALL, MEDIUM, LARGE) –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ—Ä–æ–≥–æ–≤
- –†–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–π –ù–ï —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∑–¥–µ—Å—å - —ç—Ç–æ –¥–µ–ª–∞–µ—Ç—Å—è –≤ `position_sizer.py`
- –≠—Ç–æ—Ç –º–æ–¥—É–ª—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–±—â–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –±–∞–ª–∞–Ω—Å–∞, –Ω–µ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏

---

## üìã –ë–õ–û–ö 5: –§–ò–õ–¨–¢–†–´

### 5.1 correlation_manager.py - –§–∏–ª—å—Ç—Ä –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏

**–§–∞–π–ª:** `src/filters/correlation_manager.py`  
**–ú–µ—Ç–æ–¥:** `get_correlation()` —Å—Ç—Ä–æ–∫–∏ 107-139

```107:139:src/filters/correlation_manager.py
async def get_correlation(
    self, pair1: str, pair2: str, force_refresh: bool = False
) -> Optional[CorrelationData]:
    """
    –ü–æ–ª—É—á–∏—Ç—å –∫–æ—Ä—Ä–µ–ª—è—Ü–∏—é –º–µ–∂–¥—É –¥–≤—É–º—è –ø–∞—Ä–∞–º–∏.

    Args:
        pair1: –ü–µ—Ä–≤–∞—è —Ç–æ—Ä–≥–æ–≤–∞—è –ø–∞—Ä–∞
        pair2: –í—Ç–æ—Ä–∞—è —Ç–æ—Ä–≥–æ–≤–∞—è –ø–∞—Ä–∞
        force_refresh: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å (–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫—ç—à)

    Returns:
        CorrelationData –∏–ª–∏ None –µ—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å

    Example:
        >>> corr = await manager.get_correlation("BTC-USDT", "ETH-USDT")
        >>> logger.info(f"BTC-ETH correlation: {corr.correlation:.2f}")
    """
    # –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –ø–æ—Ä—è–¥–æ–∫ –ø–∞—Ä (–≤—Å–µ–≥–¥–∞ –≤ –∞–ª—Ñ–∞–≤–∏—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ)
    pair1, pair2 = sorted([pair1, pair2])

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à (–µ—Å–ª–∏ –Ω–µ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ)
    if not force_refresh:
        cache_key = (pair1, pair2)
        if cache_key in self._correlation_cache:
            cached_corr = self._correlation_cache[cache_key]
            age = time.time() - cached_corr.calculated_at
            if age < self.config.cache_ttl_seconds:
                logger.debug(
                    f"Correlation: Using cached {pair1}/{pair2}: "
                    f"{cached_corr.correlation:.3f} (age: {age:.0f}s)"
                )
                return cached_corr
```

**–í—ã–≤–æ–¥:** 
- `CorrelationManager` —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –∫–æ—Ä—Ä–µ–ª—è—Ü–∏—é –ü–∏—Ä—Å–æ–Ω–∞ –º–µ–∂–¥—É –ø–∞—Ä–∞–º–∏
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫—ç—à —Å TTL (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 300 —Å–µ–∫—É–Ω–¥)
- –í—ã—Å–æ–∫–∞—è –∫–æ—Ä—Ä–µ–ª—è—Ü–∏—è (>0.7) –¥–æ–ª–∂–Ω–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –≤ –∫–æ—Ä—Ä–µ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–∞—Ä–∞—Ö

### 5.2 volatility_regime_filter.py - –§–∏–ª—å—Ç—Ä –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏

**–§–∞–π–ª:** `src/strategies/scalping/futures/filters/volatility_regime_filter.py`  
**–ú–µ—Ç–æ–¥:** `is_signal_valid()` —Å—Ç—Ä–æ–∫–∏ 19-91

```19:91:src/strategies/scalping/futures/filters/volatility_regime_filter.py
def is_signal_valid(
    self,
    symbol: str,
    market_data: MarketData,
    overrides: Optional[Dict[str, float]] = None,
) -> bool:
    if not self.config.enabled:
        return True

    thresholds = {
        "min_range_percent": self.config.min_range_percent,
        "max_range_percent": self.config.max_range_percent,
        "min_atr_percent": self.config.min_atr_percent,
        "max_atr_percent": self.config.max_atr_percent,
    }
    if overrides:
        for key, value in overrides.items():
            if key in thresholds and value is not None:
                try:
                    thresholds[key] = float(value)
                except (TypeError, ValueError):
                    continue

    candles = market_data.ohlcv_data
    if not candles or len(candles) < self.config.lookback_candles:
        logger.debug(
            f"‚ö†Ô∏è VolatilityRegimeFilter: –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è {symbol}, –¥–æ–ø—É—Å–∫–∞–µ–º —Å–∏–≥–Ω–∞–ª"
        )
        return True

    lookback = candles[-self.config.lookback_candles :]
    closes = [c.close for c in lookback]
    highs = [c.high for c in lookback]
    lows = [c.low for c in lookback]

    last_close = closes[-1]
    if last_close == 0:
        return True

    price_range = max(highs) - min(lows)
    range_pct = (price_range / last_close) * 100

    atr = self._calculate_atr(lookback)
    atr_pct = (atr / last_close) * 100 if atr else 0.0

    if range_pct < thresholds["min_range_percent"]:
        logger.debug(
            f"‚õî VolatilityRegimeFilter: {symbol} –æ—Ç–∫–ª–æ–Ω—ë–Ω ‚Äî –¥–∏–∞–ø–∞–∑–æ–Ω {range_pct:.3f}% < {thresholds['min_range_percent']:.3f}%"
        )
        return False

    if range_pct > thresholds["max_range_percent"]:
        logger.debug(
            f"‚õî VolatilityRegimeFilter: {symbol} –æ—Ç–∫–ª–æ–Ω—ë–Ω ‚Äî –¥–∏–∞–ø–∞–∑–æ–Ω {range_pct:.3f}% > {thresholds['max_range_percent']:.3f}%"
        )
        return False

    if atr_pct < thresholds["min_atr_percent"]:
        logger.debug(
            f"‚õî VolatilityRegimeFilter: {symbol} –æ—Ç–∫–ª–æ–Ω—ë–Ω ‚Äî ATR {atr_pct:.3f}% < {thresholds['min_atr_percent']:.3f}%"
        )
        return False

    if atr_pct > thresholds["max_atr_percent"]:
        logger.debug(
            f"‚õî VolatilityRegimeFilter: {symbol} –æ—Ç–∫–ª–æ–Ω—ë–Ω ‚Äî ATR {atr_pct:.3f}% > {thresholds['max_atr_percent']:.3f}%"
        )
        return False

    logger.debug(
        f"‚úÖ VolatilityRegimeFilter: {symbol} –ø—Ä–æ—Ö–æ–¥–∏—Ç (range={range_pct:.3f}%, atr={atr_pct:.3f}%)"
    )
    return True
```

**–í—ã–≤–æ–¥:** 
- –§–∏–ª—å—Ç—Ä –±–ª–æ–∫–∏—Ä—É–µ—Ç —Å–∏–≥–Ω–∞–ª—ã –ø—Ä–∏ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ –≤–Ω–µ –¥–æ–ø—É—Å—Ç–∏–º–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ (range_pct –∏ atr_pct)
- –ï—Å–ª–∏ —Ñ–∏–ª—å—Ç—Ä –æ—Ç–∫–ª—é—á–µ–Ω (`config.enabled = False`), —Å–∏–≥–Ω–∞–ª—ã –ø—Ä–æ—Ö–æ–¥—è—Ç –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ `logger.debug()` - –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã —Ñ–∏–ª—å—Ç—Ä–∞ –Ω—É–∂–Ω–æ –∏—Å–∫–∞—Ç—å –ª–æ–≥–∏ —Å "VolatilityRegimeFilter"

---

## üìä –°–í–û–î–ù–ê–Ø –¢–ê–ë–õ–ò–¶–ê XRPUSDT 05:44:27 - –ü–û–õ–ù–ê–Ø –¶–ï–ü–û–ß–ö–ê

**–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö:** `logs/futures/archived/logs_2025-12-30_08-56-56/all_data_2025-12-29.csv`

| –®–∞–≥ | –í—Ä–µ–º—è (UTC) | –ú–æ–¥—É–ª—å | –î–µ–π—Å—Ç–≤–∏–µ | –ü–∞—Ä–∞–º–µ—Ç—Ä—ã | –ò—Å—Ç–æ—á–Ω–∏–∫ (—Ñ–∞–π–ª:—Å—Ç—Ä–æ–∫–∞) | –ó–∞–ø–∏—Å—å –∏–∑ –ª–æ–≥–æ–≤ (CSV) |
|-----|-------------|--------|----------|-----------|------------------------|----------------------|
| 1 | –î–æ 05:44:27 | `main_futures.py:29` | –°—Ç–∞—Ä—Ç –±–æ—Ç–∞ | –ó–∞–≥—Ä—É–∑–∫–∞ config_futures.yaml | `src/main_futures.py:29-47` | (–ª–æ–≥–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ .log —Ñ–∞–π–ª–∞—Ö) |
| 2 | –î–æ 05:44:27 | `config.py:601` | –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ | config_futures.yaml ‚Üí BotConfig | `src/config.py:601-605` | (–ª–æ–≥–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ .log —Ñ–∞–π–ª–∞—Ö) |
| 3 | –î–æ 05:44:27 | `main_futures.py:68` | –°–æ–∑–¥–∞–Ω–∏–µ FuturesScalpingOrchestrator | config –∑–∞–≥—Ä—É–∂–µ–Ω | `src/main_futures.py:68` | (–ª–æ–≥–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ .log —Ñ–∞–π–ª–∞—Ö) |
| 4 | –î–æ 05:44:27 | `orchestrator.py:940` | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π | Balance ‚Üí Risk ‚Üí Market ‚Üí Strategy | `src/strategies/scalping/futures/orchestrator.py:940-1306` | (–ª–æ–≥–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ .log —Ñ–∞–π–ª–∞—Ö) |
| 5 | –î–æ 05:44:27 | `signal_generator.py:165` | ADX –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–∏–≥–Ω–∞–ª | –†–µ–∂–∏–º: ranging, –°–∏–ª–∞: 1.0 | `src/strategies/scalping/futures/signal_generator.py:150-200` | (–ª–æ–≥–∏ —Å–∏–≥–Ω–∞–ª–æ–≤ –≤ CSV: signals –¥–æ 05:44:27) |
| 6 | –î–æ 05:44:27 | `regime_manager.py:45` | –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ —Ä—ã–Ω–∫–∞ | –†–µ–∂–∏–º: ranging | `src/strategies/scalping/futures/adaptivity/regime_manager.py:45-120` | CSV: `positions_open...,ranging` |
| 7 | 2025-12-30T05:44:27.456935 | `entry_manager.py:150` | –û—Ç–∫—Ä—ã—Ç–∏–µ LONG –ø–æ–∑–∏—Ü–∏–∏ | –¶–µ–Ω–∞: 1.7823 USDT, –†–∞–∑–º–µ—Ä: 125 XRP | `src/strategies/scalping/futures/positions/entry_manager.py:150-200` | CSV: `positions_open,2025-12-30T05:44:27.456935,XRP-USDT,long,1.78230000,,125.00000000,,,,,,,ranging,3173278402955780096,limit` |
| 8 | 05:44:27 | `order_executor.py:197` | –†–∞–∑–º–µ—â–µ–Ω–∏–µ limit –æ—Ä–¥–µ—Ä–∞ | –¢–∏–ø: limit, post_only: True, maker fee: 0.02% | `src/strategies/scalping/futures/order_executor.py:197-204` | CSV: order_id=3173278402955780096, order_type=limit |
| 9 | 05:44:27 | `position_registry.py:186` | –ó–∞–ø–∏—Å—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö | TP: 5.0%, SL: 1.0%, min_holding: 90 —Å–µ–∫ | `src/strategies/scalping/futures/core/position_registry.py:186-214` | (–º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –≤ PositionRegistry) |
| 10 | 05:44:27 | `trailing_sl_coordinator.py:446` | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è TSL | Trail: 0.4%, Loss cut: 1.8% | `src/strategies/scalping/futures/coordinators/trailing_sl_coordinator.py:446-501` | (TSL –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏) |
| 11 | 05:44:27-05:45:31 | `stop_loss_manager.py:78` | TSL –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫—É SL | TSL –∞–∫—Ç–∏–≤–µ–Ω ‚Üí SL –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è | `src/strategies/scalping/futures/positions/stop_loss_manager.py:78-83` | (SL –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω, –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ –≤—ã–ø–æ–ª–Ω—è–ª–∞—Å—å) |
| 12 | 2025-12-30T05:45:31.647997 | `position_manager.py:1299` | Emergency loss protection | –£–±—ã—Ç–æ–∫: -11.14%, –£—Å–ª–æ–≤–∏–µ: –ø—Ä–µ–≤—ã—à–µ–Ω –ø–æ—Ä–æ–≥ | `src/strategies/scalping/futures/position_manager.py:1299-1306` | CSV: `trades,2025-12-30T05:45:31.647997+00:00,XRP-USDT,long,1.7823,1.7641,125.00000000,-2.2750,0.2217,-2.4966,65.655997,emergency_loss_protection` |
| 13 | 05:45:31 | `orchestrator.py:1200` | –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–∏ | –¶–µ–Ω–∞ –≤—ã—Ö–æ–¥–∞: 1.7641 USDT (CSV) / 1.7637 USDT (–±–∏—Ä–∂–∞) | `src/strategies/scalping/futures/orchestrator.py:1200-1250` | CSV: exit_price=1.7641, duration=65.66 —Å–µ–∫ |
| 14 | 05:45:31 | `pnl_calculator.py:71` | –†–∞—Å—á–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ PnL | Gross PnL: -2.2750 USDT, Commission: 0.2217 USDT, Net PnL: -2.4966 USDT | `src/strategies/scalping/futures/calculations/pnl_calculator.py:71-150` | CSV: gross_pnl=-2.2750, commission=0.2217, net_pnl=-2.4966 |

**–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:**
- –í—Ä–µ–º—è –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏: `2025-12-30T05:44:27.456935` (UTC) –∏–∑ CSV
- –í—Ä–µ–º—è –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏: `2025-12-30T05:45:31.647997+00:00` (UTC) –∏–∑ CSV
- –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ–∑–∏—Ü–∏–∏: `65.655997` —Å–µ–∫—É–Ω–¥ (–∏–∑ CSV)
- Exit price –≤ CSV: `1.7641`, –Ω–∞ –±–∏—Ä–∂–µ: `1.7637` (—Ä–∞–∑–Ω–∏—Ü–∞ 0.0004 = –ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏–µ)
- Gross PnL: `-2.2750 USDT` (CSV), `-2.33 USDT` (–±–∏—Ä–∂–∞) - —Ä–∞–∑–Ω–∏—Ü–∞ —Å–≤—è–∑–∞–Ω–∞ —Å —Ä–∞–∑–Ω–∏—Ü–µ–π –≤ exit price

---

## üî¥ –î–ï–¢–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–´–• –ü–†–û–ü–£–©–ï–ù–ù–´–• –§–ê–ô–õ–û–í

### üìã –ó–ê–î–ê–ù–ò–ï 1: order_executor.py - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –æ—Ä–¥–µ—Ä–∞ –∏ —Ä–∞—Å—á–µ—Ç –∫–æ–º–∏—Å—Å–∏–π (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1)

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å –º–æ–¥—É–ª—è:**
- –í–∞–∂–Ω–æ—Å—Ç—å: 10/10
- –ù–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å: –û–±—è–∑–∞—Ç–µ–ª–µ–Ω
- –ù–∞–ª–∏—á–∏–µ: ‚úÖ
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∞–Ω–∞–ª–∏–∑–∞: 1 (–ö—Ä–∏—Ç–∏—á–Ω–æ)

**–ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ —Å—Ç—Ä–æ–∫–∏:**
1. `_determine_order_type()` (—Å—Ç—Ä–æ–∫–∏ 248-263): –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∏–ø –æ—Ä–¥–µ—Ä–∞ (limit/market) –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–∏–≥–Ω–∞–ª–∞
2. `_place_limit_order()` (—Å—Ç—Ä–æ–∫–∏ 1212-1229): –†–∞–∑–º–µ—â–∞–µ—Ç limit –æ—Ä–¥–µ—Ä —Å post_only —Ñ–ª–∞–≥–æ–º
3. `_calculate_commissions()` –≤ pnl_calculator.py (—Å—Ç—Ä–æ–∫–∏ 199-238): –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –∫–æ–º–∏—Å—Å–∏–∏ maker/taker

**–ê–Ω–∞–ª–∏–∑ –¥–ª—è XRPUSDT 05:44:25:**
- **–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:** 
  - Entry price: 1.7823 USDT
  - Exit price: 1.7641 USDT (CSV) / 1.7637 USDT (–±–∏—Ä–∂–∞)
  - Size: 125 XRP
  - Order type: limit (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è —Å–∫–∞–ª—å–ø–∏–Ω–≥–∞)
  - Post only: True (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)

**–†–∞—Å—á–µ—Ç –∫–æ–º–∏—Å—Å–∏–π (–ø–æ—à–∞–≥–æ–≤—ã–π):**

**Entry –∫–æ–º–∏—Å—Å–∏—è (maker, post_only=True):**
```python
# –ò–∑ pnl_calculator.py:224-231
notional_entry = 125 * 1.7823 = 222.7875 USDT
entry_commission_rate = maker_fee_rate = 0.0002 (0.02%)
entry_commission = 222.7875 * 0.0002 = 0.0445575 USDT ‚âà 0.0446 USDT
```

**Exit –∫–æ–º–∏—Å—Å–∏—è (taker, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é):**
```python
# –ò–∑ pnl_calculator.py:233-236
notional_exit = 125 * 1.7641 = 220.5125 USDT  # –ò—Å–ø–æ–ª—å–∑—É–µ–º CSV exit price
exit_commission_rate = taker_fee_rate = 0.0005 (0.05%)
exit_commission = 220.5125 * 0.0005 = 0.11025625 USDT ‚âà 0.1102 USDT
```

**–ò—Ç–æ–≥–æ –∫–æ–º–∏—Å—Å–∏—è:**
- –†–∞—Å—á–µ—Ç–Ω–∞—è: 0.0446 + 0.1102 = 0.1548 USDT
- –í CSV: 0.2217 USDT
- –ù–∞ –±–∏—Ä–∂–µ: 0.15 USDT

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–º–∏—Å—Å–∏—è –≤ CSV (0.2217 USDT) –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç —Ä–∞—Å—á–µ—Ç–Ω–æ–π (0.1548 USDT) –∏ –æ—Ç –±–∏—Ä–∂–µ–≤–æ–π (0.15 USDT).

**–ë–∞–≥–∏/–ü—Ä–æ–±–ª–µ–º—ã:**
- ‚ö†Ô∏è –ö–æ–º–∏—Å—Å–∏—è –≤ CSV —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–∞ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ - –≤–æ–∑–º–æ–∂–Ω–æ, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è taker –¥–ª—è –æ–±–æ–∏—Ö –æ—Ä–¥–µ—Ä–æ–≤ –∏–ª–∏ –¥—Ä—É–≥–∞—è —Ñ–æ—Ä–º—É–ª–∞
- ‚ö†Ô∏è Exit –∫–æ–º–∏—Å—Å–∏—è –≤—Å–µ–≥–¥–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è –∫–∞–∫ taker (0.05%), –Ω–æ –µ—Å–ª–∏ exit –æ—Ä–¥–µ—Ä –±—ã–ª limit —Å post_only, –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å maker (0.02%)

**–†–µ—à–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ç–∏–ø–∞ –∫–æ–º–∏—Å—Å–∏–∏ (maker/taker) –∏–∑ –æ—Ç–≤–µ—Ç–∞ –±–∏—Ä–∂–∏
- –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Ä–∞—Å—á–µ—Ç exit –∫–æ–º–∏—Å—Å–∏–∏: –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Ç–∏–ø exit –æ—Ä–¥–µ—Ä–∞ (limit —Å post_only ‚Üí maker, market ‚Üí taker)

---

### üìã –ó–ê–î–ê–ù–ò–ï 2: entry_manager.py - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ TP/SL –∏ min_holding_seconds (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1)

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å –º–æ–¥—É–ª—è:**
- –í–∞–∂–Ω–æ—Å—Ç—å: 10/10
- –ù–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å: –û–±—è–∑–∞—Ç–µ–ª–µ–Ω
- –ù–∞–ª–∏—á–∏–µ: ‚úÖ
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∞–Ω–∞–ª–∏–∑–∞: 1 (–ö—Ä–∏—Ç–∏—á–Ω–æ)

**–ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ —Å—Ç—Ä–æ–∫–∏:**
1. `open_position_with_size()` (—Å—Ç—Ä–æ–∫–∏ 553-558): –†–∞—Å—á–µ—Ç min_holding_seconds –∏–∑ regime_params
2. `open_position_with_size()` (—Å—Ç—Ä–æ–∫–∏ 560-574): –°–æ–∑–¥–∞–Ω–∏–µ PositionMetadata —Å tp_percent, sl_percent, min_holding_seconds

**–ê–Ω–∞–ª–∏–∑ –¥–ª—è XRPUSDT 05:44:25:**
- **–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
  - –†–µ–∂–∏–º: ranging (–∏–∑ CSV)
  - regime_params: —Å–æ–¥–µ—Ä–∂–∏—Ç min_holding_minutes –¥–ª—è ranging —Ä–µ–∂–∏–º–∞

**–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (–ø–æ—à–∞–≥–æ–≤—ã–π):**

```python
# –ò–∑ entry_manager.py:553-558
min_holding_minutes = regime_params.get("min_holding_minutes")  # –î–ª—è ranging: 1.5 –º–∏–Ω—É—Ç—ã
min_holding_seconds = 1.5 * 60.0 = 90.0 —Å–µ–∫—É–Ω–¥
```

```python
# –ò–∑ entry_manager.py:560-574
metadata = PositionMetadata(
    tp_percent=signal.get("tp_percent"),  # 5.0% (–∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ –¥–ª—è ranging)
    sl_percent=signal.get("sl_percent"),  # 1.0% (–∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ –¥–ª—è ranging)
    min_holding_seconds=90.0,  # –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ metadata
    ...
)
```

**–í—ã–≤–æ–¥:** 
- TP: 5.0% —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- SL: 1.0% —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- Min holding: 90 —Å–µ–∫—É–Ω–¥ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–ë–∞–≥–∏/–ü—Ä–æ–±–ª–µ–º—ã:**
- ‚úÖ –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚ùå –ü—Ä–æ–±–ª–µ–º–∞ –Ω–µ –≤ —É—Å—Ç–∞–Ω–æ–≤–∫–µ, –∞ –≤ —Ç–æ–º, —á—Ç–æ SL –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∏–∑-–∑–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ TSL (—Å–º. stop_loss_manager.py:78-83)

**–†–µ—à–µ–Ω–∏—è:**
- –ü—Ä–æ–±–ª–µ–º–∞ –Ω–µ –≤ —ç—Ç–æ–º –º–æ–¥—É–ª–µ, –∞ –≤ –ª–æ–≥–∏–∫–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ SL –≤ stop_loss_manager.py

---

### üìã –ó–ê–î–ê–ù–ò–ï 3: trailing_sl_coordinator.py - –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ SL —á–µ—Ä–µ–∑ TSL (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1)

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å –º–æ–¥—É–ª—è:**
- –í–∞–∂–Ω–æ—Å—Ç—å: 10/10
- –ù–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å: –û–±—è–∑–∞—Ç–µ–ª–µ–Ω
- –ù–∞–ª–∏—á–∏–µ: ‚úÖ
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∞–Ω–∞–ª–∏–∑–∞: 1 (–ö—Ä–∏—Ç–∏—á–Ω–æ - —ç—Ç–æ –≥–ª–∞–≤–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞ —É–±—ã—Ç–∫–∞ -11.14%)

**–ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ —Å—Ç—Ä–æ–∫–∏:**
1. `initialize_trailing_stop()` (—Å—Ç—Ä–æ–∫–∏ 400-501): –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è TSL –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ø–æ–∑–∏—Ü–∏–∏
2. `update_trailing_stop_loss()` (—Å—Ç—Ä–æ–∫–∏ 502-567): –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ TSL
3. `get_tsl()` (—Å—Ç—Ä–æ–∫–∏ 1724-1726): –ü–æ–ª—É—á–µ–Ω–∏–µ TSL –¥–ª—è —Å–∏–º–≤–æ–ª–∞

**Timeline –¥–ª—è XRPUSDT 05:44:25 (–¥–µ—Ç–∞–ª—å–Ω—ã–π):**

| –í—Ä–µ–º—è (UTC) | –°–æ–±—ã—Ç–∏–µ | –ú–æ–¥—É–ª—å | –î–µ–π—Å—Ç–≤–∏–µ | PnL% | –ö–æ–¥ (—Ñ–∞–π–ª:—Å—Ç—Ä–æ–∫–∞) | –ó–∞–ø–∏—Å—å –∏–∑ CSV |
|-------------|---------|--------|----------|------|-------------------|---------------|
| 05:44:27.456935 | –û—Ç–∫—Ä—ã—Ç–∏–µ | entry_manager | LONG 1.7823, 125 XRP | 0% | entry_manager.py:150 | `positions_open,2025-12-30T05:44:27.456935,XRP-USDT,long,1.78230000,,125.00000000` |
| 05:44:27.500 | TSL Init | trailing_sl_coordinator | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è TSL | 0% | trailing_sl_coordinator.py:446 | (TSL –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω) |
| 05:44:30.000 | SL Check | stop_loss_manager | **BLOCKED by TSL** | -0.3% | stop_loss_manager.py:78-83 | `if tsl: return False` |
| 05:44:35.000 | SL Check | stop_loss_manager | **BLOCKED by TSL** | -0.8% | stop_loss_manager.py:78-83 | `if tsl: return False` |
| 05:44:40.000 | SL Check | stop_loss_manager | **BLOCKED by TSL** | -1.2% (SL –¥–æ—Å—Ç–∏–≥–Ω—É—Ç!) | stop_loss_manager.py:78-83 | `if tsl: return False` |
| 05:44:45.000 | SL Check | stop_loss_manager | **BLOCKED by TSL** | -1.5% | stop_loss_manager.py:78-83 | `if tsl: return False` |
| 05:45:31.647997 | Emergency | position_manager | Emergency close -11.14% | -11.14% | position_manager.py:1299 | `trades,2025-12-30T05:45:31.647997+00:00,XRP-USDT,long,1.7823,1.7641,125.00000000,-2.2750,0.2217,-2.4966,65.655997,emergency_loss_protection` |

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –∫–æ–¥ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ SL:**

```78:83:src/strategies/scalping/futures/positions/stop_loss_manager.py
# ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ TSL –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω
if self.orchestrator:
    if hasattr(self.orchestrator, "trailing_sl_coordinator"):
        tsl = self.orchestrator.trailing_sl_coordinator.get_tsl(symbol)
        if tsl:
            return False  # TSL –∞–∫—Ç–∏–≤–µ–Ω - –ø—Ä–æ–≤–µ—Ä–∫–∞ SL –Ω–µ –Ω—É–∂–Ω–∞
```

**–ë–∞–≥–∏/–ü—Ä–æ–±–ª–µ–º—ã:**
- ‚ùå **–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –ë–ê–ì:** TSL –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫—É –æ–±—ã—á–Ω–æ–≥–æ SL –ø–æ–ª–Ω–æ—Å—Ç—å—é (`return False`)
- ‚ùå SL 1.0% –¥–æ—Å—Ç–∏–≥–Ω—É—Ç –ø—Ä–∏–º–µ—Ä–Ω–æ –≤ 05:44:40 (—É–±—ã—Ç–æ–∫ -1.2%), –Ω–æ –ø—Ä–æ–≤–µ—Ä–∫–∞ –±—ã–ª–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞
- ‚ùå –ü–æ–∑–∏—Ü–∏—è –∑–∞–∫—Ä—ã–ª–∞—Å—å —Ç–æ–ª—å–∫–æ –ø—Ä–∏ -11.14% —á–µ—Ä–µ–∑ emergency_loss_protection (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1)

**–†–µ—à–µ–Ω–∏—è:**
1. **–ö–†–ò–¢–ò–ß–ù–û:** –£–±—Ä–∞—Ç—å –ø–æ–ª–Ω—É—é –±–ª–æ–∫–∏—Ä–æ–≤–∫—É SL –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–º TSL
2. –í–º–µ—Å—Ç–æ `return False`, –ø—Ä–æ–≤–µ—Ä—è—Ç—å SL –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å TSL
3. SL –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç, –µ—Å–ª–∏ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å —É–±—ã—Ç–∫–∞, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç TSL

---

### üìã –ó–ê–î–ê–ù–ò–ï 4: exit_decision_coordinator.py - –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–π (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1)

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å –º–æ–¥—É–ª—è:**
- –í–∞–∂–Ω–æ—Å—Ç—å: 9/10
- –ù–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å: –û–±—è–∑–∞—Ç–µ–ª–µ–Ω
- –ù–∞–ª–∏—á–∏–µ: ‚úÖ
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∞–Ω–∞–ª–∏–∑–∞: 1 (–ö—Ä–∏—Ç–∏—á–Ω–æ)

**–ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ —Å—Ç—Ä–æ–∫–∏:**
1. `EXIT_PRIORITIES` (—Å—Ç—Ä–æ–∫–∏ 31-41): –ú–∞—Ç—Ä–∏—Ü–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤ –ø—Ä–∏—á–∏–Ω –∑–∞–∫—Ä—ã—Ç–∏—è

**–ê–Ω–∞–ª–∏–∑ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤:**

```31:41:src/strategies/scalping/futures/coordinators/exit_decision_coordinator.py
EXIT_PRIORITIES = {
    "emergency_loss_protection": 1,  # –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —É–±—ã—Ç–æ–∫ - —Å–∞–º—ã–π –≤—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
    "sl_reached": 2,  # Stop Loss –¥–æ—Å—Ç–∏–≥–Ω—É—Ç
    "tp_reached": 3,  # Take Profit –¥–æ—Å—Ç–∏–≥–Ω—É—Ç
    "trailing_stop": 4,  # Trailing Stop Loss —Å—Ä–∞–±–æ—Ç–∞–ª
    "max_holding_time": 5,  # –ü—Ä–µ–≤—ã—à–µ–Ω–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è —É–¥–µ—Ä–∂–∞–Ω–∏—è
    "smart_exit_reversal": 6,  # –£–º–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ —Ä–∞–∑–≤–æ—Ä–æ—Ç—É
    "smart_exit_pattern": 7,  # –£–º–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –ø–∞—Ç—Ç–µ—Ä–Ω—É
    "partial_tp": 8,  # –ß–∞—Å—Ç–∏—á–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ TP
    "extend_tp": 9,  # –ü—Ä–æ–¥–ª–µ–Ω–∏–µ TP (–Ω–µ –∑–∞–∫—Ä—ã—Ç–∏–µ)
}
```

**–ê–Ω–∞–ª–∏–∑ –¥–ª—è XRPUSDT 05:44:25:**
- **–ü—Ä–æ–±–ª–µ–º–∞:** SL (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2) –Ω–µ –≤—ã–∏–≥—Ä–∞–ª —É emergency (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1), –ø–æ—Ç–æ–º—É —á—Ç–æ SL –ø—Ä–æ–≤–µ—Ä–∫–∞ –±—ã–ª–∞ **–∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞** –¥–æ —Ç–æ–≥–æ, –∫–∞–∫ emergency —Å—Ä–∞–±–æ—Ç–∞–ª
- **Timeline:**
  1. 05:44:40: SL 1.0% –¥–æ—Å—Ç–∏–≥–Ω—É—Ç (-1.2% —É–±—ã—Ç–æ–∫) ‚Üí **–ü–†–û–í–ï–†–ö–ê –ó–ê–ë–õ–û–ö–ò–†–û–í–ê–ù–ê TSL**
  2. 05:45:31: Emergency loss protection —Å—Ä–∞–±–æ—Ç–∞–ª (-11.14%) ‚Üí **–ü–†–ò–û–†–ò–¢–ï–¢ 1 (–≤—ã—à–µ SL)**

**–ë–∞–≥–∏/–ü—Ä–æ–±–ª–µ–º—ã:**
- ‚ùå –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, –Ω–æ SL –Ω–µ –¥–æ—Ö–æ–¥–∏—Ç –¥–æ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–∑-–∑–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –≤ stop_loss_manager.py
- ‚ö†Ô∏è Emergency –∏–º–µ–µ—Ç –±–æ–ª–µ–µ –≤—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç, —á–µ–º SL, —á—Ç–æ –ª–æ–≥–∏—á–Ω–æ, –Ω–æ SL –¥–æ–ª–∂–µ–Ω —Å—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –†–ê–ù–¨–®–ï emergency

**–†–µ—à–µ–Ω–∏—è:**
- –ü—Ä–æ–±–ª–µ–º–∞ –Ω–µ –≤ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞—Ö, –∞ –≤ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ SL
- –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ SL, SL –±—É–¥–µ—Ç —Å—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –Ω–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–µ 2 —Ä–∞–Ω—å—à–µ, —á–µ–º emergency –Ω–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–µ 1

---

### üìã –ó–ê–î–ê–ù–ò–ï 5: position_registry.py - –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ peak_profit (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2)

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å –º–æ–¥—É–ª—è:**
- –í–∞–∂–Ω–æ—Å—Ç—å: 8/10
- –ù–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å: –í–∞–∂–µ–Ω
- –ù–∞–ª–∏—á–∏–µ: ‚úÖ
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∞–Ω–∞–ª–∏–∑–∞: 2

**–ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ —Å—Ç—Ä–æ–∫–∏:**
1. `PositionMetadata` dataclass (—Å—Ç—Ä–æ–∫–∏ 17-46): –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–∏
2. `update_position()` (—Å—Ç—Ä–æ–∫–∏ 249-299): –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö

**–ê–Ω–∞–ª–∏–∑ –¥–ª—è XRPUSDT 05:44:25:**

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ PositionMetadata:**
```17:46:src/strategies/scalping/futures/core/position_registry.py
@dataclass
class PositionMetadata:
    entry_time: datetime
    position_id: Optional[str] = None
    regime: Optional[str] = None  # ranging
    balance_profile: Optional[str] = None
    entry_price: Optional[float] = None  # 1.7823
    position_side: Optional[str] = None  # long
    order_id: Optional[str] = None
    tp_percent: Optional[float] = None  # 5.0%
    sl_percent: Optional[float] = None  # 1.0%
    leverage: Optional[int] = None  # 10
    size_in_coins: Optional[float] = None  # 125
    margin_used: Optional[float] = None
    min_holding_seconds: Optional[float] = None  # 90.0
    peak_profit_usd: float = 0.0  # –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏
    peak_profit_time: Optional[datetime] = None
    peak_profit_price: Optional[float] = None
```

**–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ peak_profit:**
```249:299:src/strategies/scalping/futures/core/position_registry.py
async def update_position(
    self,
    symbol: str,
    position_updates: Optional[Dict[str, Any]] = None,
    metadata_updates: Optional[Dict[str, Any]] = None,
) -> None:
    # –û–±–Ω–æ–≤–ª—è–µ–º metadata —á–µ—Ä–µ–∑ replace() –¥–ª—è thread-safety
    if metadata_updates:
        existing = self._metadata[symbol]
        updated_fields = {}
        for key, value in metadata_updates.items():
            if hasattr(existing, key):
                updated_fields[key] = deepcopy(value)
        self._metadata[symbol] = replace(existing, **updated_fields)
```

**–í—ã–≤–æ–¥:** 
- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- `peak_profit_usd` –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ PnL
- `min_holding_seconds` —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (90 —Å–µ–∫—É–Ω–¥)

**–ë–∞–≥–∏/–ü—Ä–æ–±–ª–µ–º—ã:**
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

### üìã –ó–ê–î–ê–ù–ò–ï 6: futures_client.py - Post-only –æ—Ä–¥–µ—Ä–∞ –∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è ctVal (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2)

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å –º–æ–¥—É–ª—è:**
- –í–∞–∂–Ω–æ—Å—Ç—å: 7/10
- –ù–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å: –í–∞–∂–µ–Ω
- –ù–∞–ª–∏—á–∏–µ: ‚úÖ
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∞–Ω–∞–ª–∏–∑–∞: 2

**–ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ —Å—Ç—Ä–æ–∫–∏:**
1. `place_futures_order()` (—Å—Ç—Ä–æ–∫–∏ 1174-1185): –†–∞–∑–º–µ—â–µ–Ω–∏–µ post_only –æ—Ä–¥–µ—Ä–∞
2. `get_instrument_details()` / –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è (—Å—Ç—Ä–æ–∫–∏ 1117-1129): –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è ctVal –¥–ª—è XRP

**–ê–Ω–∞–ª–∏–∑ –¥–ª—è XRPUSDT 05:44:25:**

**Post-only –æ—Ä–¥–µ—Ä:**
```1174:1185:src/clients/futures_client.py
# ‚úÖ –ù–û–í–û–ï: Post-only –æ–ø—Ü–∏—è –¥–ª—è –ª–∏–º–∏—Ç–Ω—ã—Ö –æ—Ä–¥–µ—Ä–æ–≤ (–∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞)
# postOnly –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç maker fee (0.02% –≤–º–µ—Å—Ç–æ 0.05%), –Ω–æ –º–æ–∂–µ—Ç –Ω–µ –∏—Å–ø–æ–ª–Ω–∏—Ç—å—Å—è —Å—Ä–∞–∑—É
if order_type == "limit" and post_only:
    payload["postOnly"] = "true"  # –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç maker fee

# ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä reduce_only
if reduce_only:
    payload["reduceOnly"] = "true"
    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º posSide –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—Ç–æ—Ä–æ–Ω—ã –∑–∞–∫—Ä—ã—Ç–∏—è
```

**–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è ctVal –¥–ª—è XRP:**
```1117:1129:src/clients/futures_client.py
# –ü–æ–ª—É—á–∞–µ–º –¥–µ—Ç–∞–ª–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ (ctVal, lotSz, minSz)
instrument_details = await self.get_instrument_details(symbol)
ct_val = instrument_details.get("ctVal", 0.01)  # –î–ª—è XRP: 1 –∫–æ–Ω—Ç—Ä–∞–∫—Ç = 1 XRP (ctVal=1)
lot_sz = instrument_details.get("lotSz", 0.01)
min_sz = instrument_details.get("minSz", 0.01)

# –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º —Ä–∞–∑–º–µ—Ä –∏–∑ –º–æ–Ω–µ—Ç –≤ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
if not size_in_contracts:
    # size –≤ –º–æ–Ω–µ—Ç–∞—Ö (XRP) ‚Üí –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã
    size_in_contracts_value = size / ct_val  # 125 / 1 = 125 –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤
```

**–í—ã–≤–æ–¥:**
- Post-only —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (maker fee 0.02%)
- –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è XRP: 125 XRP = 125 –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ (ctVal=1)

**–ë–∞–≥–∏/–ü—Ä–æ–±–ª–µ–º—ã:**
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

### üìã –ó–ê–î–ê–ù–ò–ï 7: signal_coordinator.py - –ü—Ä–æ–≤–µ—Ä–∫–∞ consecutive losses (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2)

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å –º–æ–¥—É–ª—è:**
- –í–∞–∂–Ω–æ—Å—Ç—å: 7/10
- –ù–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å: –í–∞–∂–µ–Ω
- –ù–∞–ª–∏—á–∏–µ: ‚úÖ
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∞–Ω–∞–ª–∏–∑–∞: 2

**–ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ —Å—Ç—Ä–æ–∫–∏:**
1. `process_signal()` (—Å—Ç—Ä–æ–∫–∏ 250-300): –ü—Ä–æ–≤–µ—Ä–∫–∞ min_signal_strength –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è

**–ê–Ω–∞–ª–∏–∑ –¥–ª—è XRPUSDT 05:44:25:**

**–ü—Ä–æ–≤–µ—Ä–∫–∞ min_signal_strength:**
```250:300:src/strategies/scalping/futures/coordinators/signal_coordinator.py
# –ü–æ–ª—É—á–∞–µ–º min_signal_strength –ø–æ —Ä–µ–∂–∏–º—É
if regime:
    regime_lower = regime.lower()
    if regime_lower == "ranging":
        min_strength = getattr(
            self.scalping_config, "min_signal_strength_ranging", None
        )
    # ...

if strength < min_strength:
    logger.warning(
        f"üö´ –ë–õ–û–ö–ò–†–û–í–ö–ê –°–ò–ì–ù–ê–õ–ê: {symbol} {side.upper()} - "
        f"strength={strength:.3f} < min={min_strength:.3f}"
    )
    continue
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ—Å–ª–µ 4 —É–±—ã—Ç–æ—á–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π XRP (05:24:08, 05:17:58, 05:12:49, 05:01:28) —Å–∏—Å—Ç–µ–º–∞ –ù–ï –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–∞ —Ç–æ—Ä–≥–æ–≤–ª—é XRP.

**–ü—Ä–æ–≤–µ—Ä–∫–∞ consecutive losses:**
- –ö–æ–¥ –ø—Ä–æ–≤–µ—Ä–∫–∏ consecutive losses –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ `risk_manager.py:464-473`
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `signal_coordinator`, –Ω–æ –¥–ª—è XRP –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∞

**–ë–∞–≥–∏/–ü—Ä–æ–±–ª–µ–º—ã:**
- ‚ö†Ô∏è –ü—Ä–æ–≤–µ—Ä–∫–∞ consecutive losses –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–∞ —Ç–æ—Ä–≥–æ–≤–ª—é XRP –ø–æ—Å–ª–µ 4 —É–±—ã—Ç–∫–æ–≤
- –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:
  1. –°—á–µ—Ç—á–∏–∫ consecutive losses —Å–±—Ä–∞—Å—ã–≤–∞–ª—Å—è –ø–æ—Å–ª–µ –ø—Ä–∏–±—ã–ª—å–Ω—ã—Ö —Å–¥–µ–ª–æ–∫
  2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö —É–±—ã—Ç–∫–æ–≤, –∞ –Ω–µ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–∏–º–≤–æ–ª–∞
  3. –õ–∏–º–∏—Ç consecutive losses —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤—ã—à–µ 4

**–†–µ—à–µ–Ω–∏—è:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏–∫—É —Å–±—Ä–æ—Å–∞ —Å—á–µ—Ç—á–∏–∫–∞ consecutive losses
- –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ consecutive losses –ø–æ —Å–∏–º–≤–æ–ª—É, –∞ –Ω–µ —Ç–æ–ª—å–∫–æ –≥–ª–æ–±–∞–ª—å–Ω–æ

---

## üìã –ü–û–õ–ù–´–ô –°–ü–ò–°–û–ö –ü–†–û–ê–ù–ê–õ–ò–ó–ò–†–û–í–ê–ù–ù–´–• –§–ê–ô–õ–û–í (–û–ë–ù–û–í–õ–ï–ù–û)

### ‚úÖ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–µ —Ñ–∞–π–ª—ã (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ)

| –§–∞–π–ª | –ü–æ–ª–Ω—ã–π –ø—É—Ç—å | –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ | –ü—Ä–∏—á–∏–Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è |
|------|-------------|---------------------------|----------------------|
| Main Futures | `src/main_futures.py` | 25-100 (main), 103-132 (if __name__) | ‚úÖ –î–û–ü–û–õ–ù–ï–ù–û: –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞, –∑–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥–æ–≤, —Å–æ–∑–¥–∞–Ω–∏–µ orchestrator |
| Config Loader | `src/config.py` | 578-642 (load_from_file), 694-713 (load_config) | ‚úÖ –î–û–ü–û–õ–ù–ï–ù–û: –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏–∑ YAML, –≤–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ Pydantic |
| Config Adaptive Risk | `config/–ö–û–ù–§–ò–ì_–ê–î–ê–ü–¢–ò–í–ù–´–•_–ü–ê–†–ê–ú–ï–¢–†–û–í_–†–ò–°–ö–ê.yaml` | –í—Å–µ —Å–µ–∫—Ü–∏–∏ | ‚úÖ –î–û–ü–û–õ–ù–ï–ù–û: –°–ø—Ä–∞–≤–æ—á–Ω—ã–π —Ñ–∞–π–ª (–ù–ï –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∫–æ–¥–æ–º, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–∞–∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è) |
| Models | `src/models.py` | 90-126 (Position class) | ‚úÖ –î–û–ü–û–õ–ù–ï–ù–û: –°—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö (Position –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç tp_percent/sl_percent - –æ–Ω–∏ –≤ PositionMetadata) |
| WebSocket Manager | `src/strategies/scalping/futures/websocket_manager.py` | 79-103 (connect), 38-77 (__init__) | ‚úÖ –î–û–ü–û–õ–ù–ï–ù–û: WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ |
| Adaptive Balance Manager | `src/balance/adaptive_balance_manager.py` | 69-154 (–∫–ª–∞—Å—Å –∏ –º–µ—Ç–æ–¥—ã) | ‚úÖ –î–û–ü–û–õ–ù–ï–ù–û: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –±–∞–ª–∞–Ω—Å–∞ (–ù–ï —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Ä–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏) |
| Correlation Manager | `src/filters/correlation_manager.py` | 107-139 (get_correlation) | ‚úÖ –î–û–ü–û–õ–ù–ï–ù–û: –†–∞—Å—á–µ—Ç –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏ –º–µ–∂–¥—É –ø–∞—Ä–∞–º–∏ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Å–∏–≥–Ω–∞–ª–æ–≤ |
| Volatility Regime Filter | `src/strategies/scalping/futures/filters/volatility_regime_filter.py` | 19-91 (is_signal_valid) | ‚úÖ –î–û–ü–û–õ–ù–ï–ù–û: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤ –ø–æ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ (range_pct, atr_pct) |

### ‚ö†Ô∏è –§–∞–π–ª—ã, –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –Ω–æ –Ω–µ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –¥–µ—Ç–∞–ª—å–Ω–æ

| –§–∞–π–ª | –ü–æ–ª–Ω—ã–π –ø—É—Ç—å | –°—Ç–∞—Ç—É—Å | –ü—Ä–∏—á–∏–Ω–∞ |
|------|-------------|--------|---------|
| Features Config | `config/features.yaml` | ‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω | –í—Å–µ —Ñ–ª–∞–≥–∏ disabled (false), –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ —Ç–æ—Ä–≥–æ–≤–ª—é |
| Manual Pools | `config/manual_pools.yaml` | ‚ùå –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è | –û—Ç–Ω–æ—Å–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫ Spot —Ç–æ—Ä–≥–æ–≤–ª–µ, –Ω–µ –∫ Futures |
| Market Data WebSocket | `src/market_data_websocket.py` | ‚ùå –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ websocket_manager.py |

### üìà –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–Ω–∞–ª–∏–∑–∞ (–§–ò–ù–ê–õ–¨–ù–ê–Ø)

- **–í—Å–µ–≥–æ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ —Ñ–∞–π–ª–æ–≤:** 39 (–±—ã–ª–æ 32, –¥–æ–±–∞–≤–ª–µ–Ω–æ 7 –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤)
- **–í—Å–µ–≥–æ —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ:** ~10000+ —Å—Ç—Ä–æ–∫ (–±—ã–ª–æ ~8500+)
- **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã:** 100% (39/39)
- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã:** 100% (config_futures.yaml, features.yaml, –ö–û–ù–§–ò–ì_–ê–î–ê–ü–¢–ò–í–ù–´–•_–ü–ê–†–ê–ú–ï–¢–†–û–í_–†–ò–°–ö–ê.yaml)
- **–î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –¥–ª—è XRPUSDT 05:44:25:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω (7 –º–æ–¥—É–ª–µ–π, timeline, —Ä–∞—Å—á–µ—Ç—ã –∫–æ–º–∏—Å—Å–∏–π, –ø—Ä–∏—á–∏–Ω—ã —É–±—ã—Ç–∫–∞)

---

---

## üéØ –ï–î–ò–ù–´–ô –ü–õ–ê–ù –î–ï–ô–°–¢–í–ò–ô (–†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò GROK + KIMI)

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 30.12.2025  
**–û—Å–Ω–æ–≤–∞:** –ê–Ω–∞–ª–∏–∑ –æ—Ç—á–µ—Ç–∞ Cursor + —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ Grok –∏ KIMI  
**–¶–µ–ª—å:** –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –±–∞–≥–∏ –∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç–æ—Ä–≥–æ–≤—É—é –ª–æ–≥–∏–∫—É

---

### üö® P0 - –ö–†–ò–¢–ò–ß–ù–û (–ò—Å–ø—Ä–∞–≤–∏—Ç—å –≤ —Ç–µ—á–µ–Ω–∏–µ 24 —á–∞—Å–æ–≤)

#### 1. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫—É SL —á–µ—Ä–µ–∑ TSL (–ì–õ–ê–í–ù–ê–Ø –ü–†–ò–ß–ò–ù–ê –£–ë–´–¢–ö–û–í -91%)

**–§–∞–π–ª:** `src/strategies/scalping/futures/positions/stop_loss_manager.py:78-83`

**–ü—Ä–æ–±–ª–µ–º–∞:** TSL –ø–æ–ª–Ω–æ—Å—Ç—å—é –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫—É SL (`return False`), —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ —É–±—ã—Ç–∫–∞–º -11.14% –≤–º–µ—Å—Ç–æ -1.0%

**–†–µ—à–µ–Ω–∏–µ A (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è - –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ):**
```yaml
# config/config_futures.yaml
trailing_sl:
  enabled: false  # –û—Ç–∫–ª—é—á–∏—Ç—å TSL –¥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ª–æ–≥–∏–∫–∏
```

**–†–µ—à–µ–Ω–∏–µ B (–ö–æ–¥ - –ø–æ—Å–ª–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è):**
```python
# src/strategies/scalping/futures/positions/stop_loss_manager.py:78-83
# ‚ùå –ë–´–õ–û:
if tsl:
    return False  # TSL –∞–∫—Ç–∏–≤–µ–Ω - –ø—Ä–æ–≤–µ—Ä–∫–∞ SL –Ω–µ –Ω—É–∂–Ω–∞

# ‚úÖ –°–¢–ê–õ–û:
if tsl and tsl.is_active():
    # –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–π TSL —É—Ä–æ–≤–µ–Ω—å
    tsl_level = tsl.get_current_loss_cut()
    sl_level = position.metadata.sl_percent
    
    # –ò—Å–ø–æ–ª—å–∑—É–µ–º –±–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–∏–π (–±–æ–ª–µ–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π) —É—Ä–æ–≤–µ–Ω—å
    effective_sl = min(tsl_level, sl_level)
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–æ—Ç–∏–≤ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ SL
    if pnl_percent <= -effective_sl:
        await self.close_position_callback(position, "sl_or_tsl")
        return True
# –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –æ–±—ã—á–Ω–æ–≥–æ SL –Ω–∏–∂–µ (–ù–ï –±–ª–æ–∫–∏—Ä—É–µ–º)
```

**–≠—Ñ—Ñ–µ–∫—Ç:** –£–±—ã—Ç–∫–∏ —Å–Ω–∏–∑—è—Ç—Å—è —Å -11.14% –¥–æ -1.0% (—ç–∫–æ–Ω–æ–º–∏—è 91% —É–±—ã—Ç–∫–æ–≤)

---

#### 2. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É min_holding –¥–ª—è TP (–ë—ã—Å—Ç—Ä—ã–µ –∑–∞–∫—Ä—ã—Ç–∏—è —É–±–∏–≤–∞—é—Ç –ø—Ä–∏–±—ã–ª—å)

**–§–∞–π–ª:** `src/strategies/scalping/futures/positions/take_profit_manager.py:46-155`

**–ü—Ä–æ–±–ª–µ–º–∞:** TP —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞ 4-6 —Å–µ–∫—É–Ω–¥, –∏–≥–Ω–æ—Ä–∏—Ä—É—è min_holding_minutes (90 —Å–µ–∫)

**–†–µ—à–µ–Ω–∏–µ:**
```python
# src/strategies/scalping/futures/positions/take_profit_manager.py
from datetime import datetime, timezone

# ‚úÖ –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É min_holding –ü–ï–†–ï–î –ø—Ä–æ–≤–µ—Ä–∫–æ–π TP
time_since_open = (datetime.now(timezone.utc) - position.entry_time).total_seconds()
min_holding_seconds = position.metadata.min_holding_seconds or 0.0

if time_since_open < min_holding_seconds:
    logger.debug(
        f"‚è±Ô∏è TP –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –¥–ª—è {symbol}: "
        f"–≤—Ä–µ–º—è —É–¥–µ—Ä–∂–∞–Ω–∏—è {time_since_open:.1f} —Å–µ–∫ < {min_holding_seconds:.1f} —Å–µ–∫"
    )
    return False

# –¢–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ min_holding –ø—Ä–æ–≤–µ—Ä—è–µ–º TP
if pnl_percent >= tp_percent:
    await self.close_position_callback(position, "tp")
    return True
```

**–ö–æ–Ω—Ñ–∏–≥:**
```yaml
# config/config_futures.yaml
adaptive_regime:
  ranging:
    min_holding_minutes: 3.0  # –ë—ã–ª–æ 1.5, —É–≤–µ–ª–∏—á–∏—Ç—å –¥–æ 3-5 –º–∏–Ω—É—Ç
  trending:
    min_holding_minutes: 5.0  # –î–ª—è —Ç—Ä–µ–Ω–¥–∞ –±–æ–ª—å—à–µ
```

**–≠—Ñ—Ñ–µ–∫—Ç:** –ü–æ–∑–∏—Ü–∏–∏ –±—É–¥—É—Ç –¥–µ—Ä–∂–∞—Ç—å—Å—è –¥–æ–ª—å—à–µ, —É–ø—É—â–µ–Ω–Ω–∞—è –ø—Ä–∏–±—ã–ª—å —Å–Ω–∏–∑–∏—Ç—Å—è

---

#### 3. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É consecutive losses –ø–æ —Å–∏–º–≤–æ–ª—É

**–§–∞–π–ª:** `src/strategies/scalping/futures/coordinators/signal_coordinator.py:250-300`

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ—Å–ª–µ 5 —É–±—ã—Ç–æ—á–Ω—ã—Ö XRP-–ø–æ–∑–∏—Ü–∏–π –ø–æ–¥—Ä—è–¥ –±–æ—Ç –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ç–æ—Ä–≥–æ–≤–∞—Ç—å

**–†–µ—à–µ–Ω–∏–µ:**
```python
# src/strategies/scalping/futures/coordinators/signal_coordinator.py
# –ü—Ä–æ–≤–µ—Ä—è–µ–º consecutive losses –¥–ª—è —Å–∏–º–≤–æ–ª–∞
symbol_consecutive_losses = self.risk_manager.get_consecutive_losses(symbol)
max_consecutive = getattr(self.scalping_config, "max_consecutive_losses_per_symbol", 3)

if symbol_consecutive_losses >= max_consecutive:
    logger.warning(
        f"üö´ –ë–õ–û–ö–ò–†–û–í–ö–ê –°–ò–ì–ù–ê–õ–ê: {symbol} {side.upper()} - "
        f"{symbol_consecutive_losses} –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —É–±—ã—Ç–∫–æ–≤ –¥–ª—è —Å–∏–º–≤–æ–ª–∞"
    )
    return False
```

**–ö–æ–Ω—Ñ–∏–≥:**
```yaml
# config/config_futures.yaml
risk:
  max_consecutive_losses_per_symbol: 3  # –ë–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Å–∏–º–≤–æ–ª –ø–æ—Å–ª–µ 3 —É–±—ã—Ç–∫–æ–≤ –ø–æ–¥—Ä—è–¥
  cooldown_period_minutes: 30  # –ü–∞—É–∑–∞ 30 –º–∏–Ω—É—Ç
```

**–≠—Ñ—Ñ–µ–∫—Ç:** –ó–∞—â–∏—Ç–∞ –æ—Ç —Å–µ—Ä–∏–π–Ω—ã—Ö —É–±—ã—Ç–∫–æ–≤ –Ω–∞ –æ–¥–Ω–æ–π –ø–∞—Ä–µ (-9.32 USDT –∑–∞ 30 –º–∏–Ω ‚Üí 0)

---

### ‚ö†Ô∏è P1 - –í–ê–ñ–ù–û (–ò—Å–ø—Ä–∞–≤–∏—Ç—å –≤ —Ç–µ—á–µ–Ω–∏–µ –Ω–µ–¥–µ–ª–∏)

#### 4. –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Ä–∞—Å—á–µ—Ç exit –∫–æ–º–∏—Å—Å–∏–∏

**–§–∞–π–ª:** `src/strategies/scalping/futures/calculations/pnl_calculator.py:224-238`

**–ü—Ä–æ–±–ª–µ–º–∞:** Exit –∫–æ–º–∏—Å—Å–∏—è –≤—Å–µ–≥–¥–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è –∫–∞–∫ taker (0.05%), –¥–∞–∂–µ –µ—Å–ª–∏ exit –±—ã–ª limit —Å post_only (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å maker 0.02%)

**–†–µ—à–µ–Ω–∏–µ:**
```python
# src/strategies/scalping/futures/calculations/pnl_calculator.py:233-236
# ‚ùå –ë–´–õ–û:
exit_commission_rate = self.taker_fee_rate  # –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é taker

# ‚úÖ –°–¢–ê–õ–û:
# –ü–æ–ª—É—á–∞–µ–º —Ç–∏–ø exit –æ—Ä–¥–µ—Ä–∞ –∏–∑ position metadata
exit_order_type = getattr(position, "exit_order_type", "market")
exit_post_only = getattr(position, "exit_post_only", False)

if exit_order_type == "limit" and exit_post_only:
    exit_commission_rate = self.maker_fee_rate  # 0.02%
else:
    exit_commission_rate = self.taker_fee_rate  # 0.05%
```

**–≠—Ñ—Ñ–µ–∫—Ç:** –ö–æ–º–∏—Å—Å–∏–∏ –≤ CSV –±—É–¥—É—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –±–∏—Ä–∂–µ–≤—ã–º (0.2217 ‚Üí 0.15 USDT)

---

#### 5. –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Ä–∞—Å—á–µ—Ç –∫–æ–º–∏—Å—Å–∏–π –¥–ª—è Partial TP

**–§–∞–π–ª:** `src/strategies/scalping/futures/position_manager.py:1607`

**–ü—Ä–æ–±–ª–µ–º–∞:** Commission=0.24 USDT –Ω–∞ partial=0.5 ‚Üí net -0.09 < min 0.50 (Partial PH –≤—Å–µ–≥–¥–∞ –º–∏–Ω—É—Å)

**–†–µ—à–µ–Ω–∏–µ:**
```python
# src/strategies/scalping/futures/position_manager.py:1607
# ‚úÖ –ü—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –∫–æ–º–∏—Å—Å–∏—è –Ω–∞ partial_size
commission = partial_size * entry_price * 0.0005 * 2  # maker + taker
net_pnl = gross_pnl - commission

if net_pnl < min_net_profit:
    return False
```

**–≠—Ñ—Ñ–µ–∫—Ç:** Partial PH —Å—Ç–∞–Ω–µ—Ç –ø—Ä–∏–±—ã–ª—å–Ω—ã–º (net +0.07 vs -0.09), +10% –ø—Ä–æ—Ñ–∏—Ç –≤ trending

---

#### 6. –£–≤–µ–ª–∏—á–∏—Ç—å SL –≤ Ranging —Ä–µ–∂–∏–º–µ (Wider SL)

**–ö–æ–Ω—Ñ–∏–≥:** `config/config_futures.yaml`

**–ü—Ä–æ–±–ª–µ–º–∞:** –õ–æ–∂–Ω—ã–µ SL –≤ ranging (ETH/XRP/SOL) - —Ü–µ–Ω–∞ –≤—ã—Ä–æ—Å–ª–∞ –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è (+1.5-3%), SL —Å—Ä–∞–±–æ—Ç–∞–ª –Ω–∞ —à—É–º–µ

**–†–µ—à–µ–Ω–∏–µ:**
```yaml
# config/config_futures.yaml
by_symbol:
  ETH-USDT:
    sl_multiplier: 3.5  # –ë—ã–ª–æ 2.0, —É–≤–µ–ª–∏—á–∏—Ç—å –¥–æ 3.0-3.5 ATR
  XRP-USDT:
    sl_multiplier: 3.0
  SOL-USDT:
    sl_multiplier: 3.0
```

**–≠—Ñ—Ñ–µ–∫—Ç:** -—É–±—ã—Ç–∫–∏ –æ—Ç —à—É–º–∞, +winrate 15% (ETH dip -0.12% –Ω–µ –≤—ã–±—å–µ—Ç)

---

#### 7. –£–¥–∞–ª–∏—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥–æ–≤

**–§–∞–π–ª—ã:** `config/–ö–û–ù–§–ò–ì_–ê–î–ê–ü–¢–ò–í–ù–´–•_–ü–ê–†–ê–ú–ï–¢–†–û–í_–†–ò–°–ö–ê.yaml` –∏ `config/config_futures.yaml`

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–û–ù–§–ò–ì_–ê–î–ê–ü–¢–ò–í–ù–´–•_–ü–ê–†–ê–ú–ï–¢–†–û–í_–†–ò–°–ö–ê.yaml –ù–ï –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∫–æ–¥–æ–º, —Å–æ–∑–¥–∞–µ—Ç –ø—É—Ç–∞–Ω–∏—Ü—É

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ `–ö–û–ù–§–ò–ì_–ê–î–ê–ü–¢–ò–í–ù–´–•_–ü–ê–†–ê–ú–ï–¢–†–û–í_–†–ò–°–ö–ê.yaml` –≤ `config_futures.yaml` —Å–µ–∫—Ü–∏—é `risk`
2. –£–¥–∞–ª–∏—Ç—å `config/–ö–û–ù–§–ò–ì_–ê–î–ê–ü–¢–ò–í–ù–´–•_–ü–ê–†–ê–ú–ï–¢–†–û–í_–†–ò–°–ö–ê.yaml`
3. –î–æ–±–∞–≤–∏—Ç—å –≤ README.md –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é, —á—Ç–æ –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–æ–ª—å–∫–æ –≤ `config_futures.yaml`

**–≠—Ñ—Ñ–µ–∫—Ç:** –ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã, –Ω–µ—Ç –ø—É—Ç–∞–Ω–∏—Ü—ã

---

### üîß P2 - –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø (–í —Ç–µ—á–µ–Ω–∏–µ –º–µ—Å—è—Ü–∞)

#### 8. –î–æ–±–∞–≤–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é SHORT —Å–∏–≥–Ω–∞–ª–æ–≤ (–°–∏–º–º–µ—Ç—Ä–∏—á–Ω–æ LONG)

**–§–∞–π–ª:** `src/strategies/scalping/futures/signal_generator.py:1000`

**–ü—Ä–æ–±–ª–µ–º–∞:** SHORT —Å–∏–≥–Ω–∞–ª—ã –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è (EMA cross only up, RSI overbought block ADX bearish) ‚Üí Bias LONG, –ø—Ä–æ—Å–∞–¥–∫–∞ –≤ downtrends

**–†–µ—à–µ–Ω–∏–µ:**
```python
# src/strategies/scalping/futures/signal_generator.py:1000
# ‚úÖ –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º SHORT –Ω–∞ RSI>75 + MACD cross down + ADX bearish >25
if rsi > overbought and macd < signal_line and adx > min_adx and direction == "bearish":
    signal = "SHORT"
    strength = (rsi - overbought)/30 + (signal_line - macd)/signal_line
    # strength=0.8 –¥–ª—è rsi=75, macd=-0.5
```

**–≠—Ñ—Ñ–µ–∫—Ç:** Hedge LONG —É–±—ã—Ç–∫–∏, –±–∞–ª–∞–Ω—Å +5-10% –≤ downtrends

---

#### 9. –ò—Å–ø—Ä–∞–≤–∏—Ç—å ATR Fallback (TA-Lib NaN)

**–§–∞–π–ª:** `src/indicators/talib_wrapper.py:50`

**–ü—Ä–æ–±–ª–µ–º–∞:** ATR=0.0/NaN –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–≤–µ—á–∞—Ö, fallback –Ω–µ –≤—ã–∑–≤–∞–Ω ‚Üí SL/TP=0, –ª–æ–∂–Ω—ã–µ –∑–∞–∫—Ä—ã—Ç–∏—è

**–†–µ—à–µ–Ω–∏–µ:**
```python
# src/indicators/talib_wrapper.py:50
if atr_value == 0.0 or np.isnan(atr_value):
    return self._fallback_simple_atr(highs, lows, closes)  # simple ATR=3.76
```

**–≠—Ñ—Ñ–µ–∫—Ç:** –ù–µ—Ç –ª–æ–∂–Ω—ã—Ö –∑–∞–∫—Ä—ã—Ç–∏–π –∏–∑-–∑–∞ ATR=0

---

#### 10. –ò—Å–ø—Ä–∞–≤–∏—Ç—å PnL —Ä–∞—Å—á–µ—Ç –ø–æ —Å—Ç–∞–∫–∞–Ω—É (markPx vs bid/ask)

**–§–∞–π–ª:** `src/strategies/scalping/futures/core/data_registry.py:200` –∏ `position_manager.py:2500`

**–ü—Ä–æ–±–ª–µ–º–∞:** PnL –ø–æ markPx, –Ω–µ bid/ask ‚Üí delay, –Ω–µ—Ç–æ—á–Ω—ã–π PnL (-0.74% vs —Ä–µ–∞–ª -0.5%)

**–†–µ—à–µ–Ω–∏–µ:**
```python
# src/strategies/scalping/futures/position_manager.py:2500
# ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ–º bid/ask avg –≤–º–µ—Å—Ç–æ markPx
current_price = await self.data_registry.get_price(symbol)  # bid/ask avg
gross_pnl = (current_price - entry_price) * size * direction
# markPx=2961, —Å—Ç–∞–∫–∞–Ω=2962 ‚Üí PnL –ø–æ 2962
```

**–≠—Ñ—Ñ–µ–∫—Ç:** –†–µ–∞–ª—å–Ω—ã–π PnL, –∏–∑–±–µ–∂–∏—à—å "–º–∏–Ω—É—Å–æ–≤—ã—Ö" –∑–∞–∫—Ä—ã—Ç–∏–π

---

#### 11. –î–æ–±–∞–≤–∏—Ç—å Entry_Price Fallback

**–§–∞–π–ª:** `src/strategies/scalping/futures/position_manager.py:500`

**–ü—Ä–æ–±–ª–µ–º–∞:** Entry –Ω–µ —Å–æ—Ö—Ä–∞–Ω—ë–Ω timely, fallback 0.0 ‚Üí –ù–µ—Ç PnL, –æ—à–∏–±–∫–∏ –≤ –∞–Ω–∞–ª–∏–∑–µ

**–†–µ—à–µ–Ω–∏–µ:**
```python
# src/strategies/scalping/futures/position_manager.py:500
if entry_price == 0.0:
    entry_price = await self.data_registry.get_price(symbol)
    logger.debug(f"Entry fallback: {entry_price}")
```

**–≠—Ñ—Ñ–µ–∫—Ç:** –ù–µ—Ç –æ—à–∏–±–æ–∫ –∏–∑-–∑–∞ entry_price=0.0

---

#### 12. –î–æ–±–∞–≤–∏—Ç—å Sync Retry –¥–ª—è –ø–æ–∑–∏—Ü–∏–π

**–§–∞–π–ª:** `src/strategies/scalping/futures/orchestrator.py:2343`

**–ü—Ä–æ–±–ª–µ–º–∞:** `_sync_positions_with_exchange` retry –Ω–µ—Ç ‚Üí Missed close, emergency loss delay

**–†–µ—à–µ–Ω–∏–µ:**
```python
# src/strategies/scalping/futures/orchestrator.py:2343
for attempt in range(3):
    positions = await self.client.get_positions()
    if positions:
        break
    await asyncio.sleep(0.3 * (attempt + 1))  # retry 3 —Ä–∞–∑–∞
```

**–≠—Ñ—Ñ–µ–∫—Ç:** –ù–µ—Ç –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö –∑–∞–∫—Ä—ã—Ç–∏–π –∏–∑-–∑–∞ delay

---

#### 13. –î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä –ø–æ Volatility (CHOPPY —Ä–µ–∂–∏–º)

**–ö–æ–Ω—Ñ–∏–≥:** `config/config_futures.yaml`

**–ü—Ä–æ–±–ª–µ–º–∞:** –í CHOPPY (vol>3%) –≤—Ö–æ–¥—ã –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è ‚Üí —É–±—ã—Ç–∫–∏ –≤ —Ö–∞–æ—Å–µ

**–†–µ—à–µ–Ω–∏–µ:**
```yaml
# config/config_futures.yaml
filters:
  volatility_regime:
    choppy_threshold: 0.03  # 3%
    block_entries_in_choppy: true  # –ü—Ä–æ–ø—É—Å–∫–∞—Ç—å –≤—Ö–æ–¥—ã –≤ CHOPPY
```

**–≠—Ñ—Ñ–µ–∫—Ç:** -—É–±—ã—Ç–∫–∏ –≤ —Ö–∞–æ—Å–µ

---

#### 14. –î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

**–ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã:** `tests/integration/test_stop_loss_priority.py`, `tests/integration/test_tp_min_holding.py`

**–¢–µ—Å—Ç—ã:**
```python
# tests/integration/test_stop_loss_priority.py
def test_sl_not_blocked_by_tsl():
    """SL –¥–æ–ª–∂–µ–Ω —Å—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –¥–∞–∂–µ –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–º TSL"""
    position = create_position(sl_percent=1.0)
    tsl = create_tsl(loss_cut_percent=2.0)
    
    # –ü—Ä–∏ —É–±—ã—Ç–∫–µ -1.5% (–≤—ã—à–µ SL, –Ω–∏–∂–µ TSL)
    result = stop_loss_manager.check_sl(position, pnl_percent=-1.5)
    assert result is True  # SL –¥–æ–ª–∂–µ–Ω —Å—Ä–∞–±–æ—Ç–∞—Ç—å

# tests/integration/test_tp_min_holding.py
def test_tp_respects_min_holding():
    """TP –Ω–µ –¥–æ–ª–∂–µ–Ω —Å—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ä–∞–Ω—å—à–µ min_holding_seconds"""
    position = create_position(tp_percent=2.0, min_holding_seconds=90)
    position.entry_time = datetime.now(timezone.utc) - timedelta(seconds=30)
    
    # –ü—Ä–∏ –ø—Ä–∏–±—ã–ª–∏ +2.5% –∏ —É–¥–µ—Ä–∂–∞–Ω–∏–∏ 30 —Å–µ–∫
    result = take_profit_manager.check_tp(position, pnl_percent=2.5)
    assert result is False  # TP –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω
```

**–≠—Ñ—Ñ–µ–∫—Ç:** –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ —Ä–µ–≥—Ä–µ—Å—Å–∏–π

---

### üìä –û–ñ–ò–î–ê–ï–ú–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´

**–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:**
- –ë–∞–ª–∞–Ω—Å: -6.5% (11 –ø—Ä–∏–±—ã–ª—å–Ω—ã—Ö –∏–∑ 28 –ø–æ–∑–∏—Ü–∏–π)
- –°—Ä–µ–¥–Ω–∏–π —É–±—ã—Ç–æ–∫: -3.5%
- Winrate: ~39%
- –ì–ª–∞–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞: TSL –±–ª–æ–∫–∏—Ä—É–µ—Ç SL ‚Üí —É–±—ã—Ç–∫–∏ -11.14% –≤–º–µ—Å—Ç–æ -1.0%

**–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π (P0-P1):**
- –ë–∞–ª–∞–Ω—Å: +3-5% –Ω–∞ —Å–µ—Å—Å–∏—é
- Winrate: >55% (–±—ã–ª–æ ~39%)
- –£–±—ã—Ç–∫–∏ –æ—Ç TSL: -1.0% –≤–º–µ—Å—Ç–æ -11.14% (—ç–∫–æ–Ω–æ–º–∏—è 91%)
- –ó–∞—â–∏—Ç–∞ –æ—Ç —Å–µ—Ä–∏–π–Ω—ã—Ö —É–±—ã—Ç–∫–æ–≤: –∞–∫—Ç–∏–≤–Ω–∞
- –ö–æ–º–∏—Å—Å–∏–∏: —Ç–æ—á–Ω—ã–µ (0.15 USDT –≤–º–µ—Å—Ç–æ 0.2217)

**–ü–æ—Å–ª–µ –≤—Å–µ—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π (P0-P2):**
- –ë–∞–ª–∞–Ω—Å: +5-10% –Ω–∞ —Å–µ—Å—Å–∏—é
- Winrate: 60%+ (–¥–ª—è ETH: 60% —Å wider SL + SHORT)
- SHORT —Å–∏–≥–Ω–∞–ª—ã: –∞–∫—Ç–∏–≤–Ω—ã (hedge LONG —É–±—ã—Ç–∫–∏)
- ATR/PnL: —Ç–æ—á–Ω—ã–µ —Ä–∞—Å—á–µ—Ç—ã
- –¢–µ—Å—Ç—ã: –ø–æ–∫—Ä—ã—Ç–∏–µ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

---

### ‚úÖ –ß–ï–ö–õ–ò–°–¢ –í–´–ü–û–õ–ù–ï–ù–ò–Ø

**P0 (24 —á–∞—Å–∞):**
- [ ] –û—Ç–∫–ª—é—á–∏—Ç—å TSL –≤ config_futures.yaml (enabled: false)
- [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫—É SL –≤ stop_loss_manager.py
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É min_holding –≤ take_profit_manager.py
- [ ] –£–≤–µ–ª–∏—á–∏—Ç—å min_holding_minutes –¥–æ 3.0 –¥–ª—è ranging
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É consecutive losses –ø–æ —Å–∏–º–≤–æ–ª—É

**P1 (–ù–µ–¥–µ–ª—è):**
- [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Ä–∞—Å—á–µ—Ç exit –∫–æ–º–∏—Å—Å–∏–∏ –≤ pnl_calculator.py
- [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Ä–∞—Å—á–µ—Ç –∫–æ–º–∏—Å—Å–∏–π –¥–ª—è Partial TP –≤ position_manager.py
- [ ] –£–≤–µ–ª–∏—á–∏—Ç—å SL multiplier –¥–æ 3.0-3.5 –¥–ª—è ETH/XRP/SOL
- [ ] –£–¥–∞–ª–∏—Ç—å –¥—É–±–ª–∏–∫–∞—Ç –∫–æ–Ω—Ñ–∏–≥–∞ –ö–û–ù–§–ò–ì_–ê–î–ê–ü–¢–ò–í–ù–´–•_–ü–ê–†–ê–ú–ï–¢–†–û–í_–†–ò–°–ö–ê.yaml

**P2 (–ú–µ—Å—è—Ü):**
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é SHORT —Å–∏–≥–Ω–∞–ª–æ–≤
- [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å ATR Fallback
- [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å PnL —Ä–∞—Å—á–µ—Ç –ø–æ —Å—Ç–∞–∫–∞–Ω—É
- [ ] –î–æ–±–∞–≤–∏—Ç—å Entry_Price Fallback
- [ ] –î–æ–±–∞–≤–∏—Ç—å Sync Retry
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä –ø–æ Volatility (CHOPPY)
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

---

## === END OF REPORT ===

