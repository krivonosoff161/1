# ‚úÖ –ò–¢–û–ì–ò –°–ï–°–°–ò–ò 7 –Ø–ù–í–ê–†–Ø 2026

## üìã –†–µ—à–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. **WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ (–†–ï–®–ï–ù–û)** ‚úÖ
**–ü—Ä–æ–±–ª–µ–º–∞:** –ë–æ—Ç –Ω–µ –º–æ–≥ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ `wss://wspap.okx.com:8443`
```
‚ùå Cannot connect to host wspap.okx.com:8443 ssl:default [–£–∫–∞–∑–∞–Ω–Ω–æ–µ —Å–µ—Ç–µ–≤–æ–µ –∏–º—è –±–æ–ª–µ–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ]
```

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
- REST API: ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç (`www.okx.com:443`)
- WebSocket –Ω–∞ 8443: ‚ùå –ù–µ –¥–æ—Å—Ç—É–ø–µ–Ω (—Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞)
- TCP –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ: ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç
- DNS: ‚úÖ –†–∞–∑—Ä–µ—à–∞–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:** –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ WebSocket —Ö–æ—Å—Ç—ã
- **–î–ª—è Sandbox:** `wss://wspap.okx.com:443` –≤–º–µ—Å—Ç–æ `wss://wspap.okx.com:8443` 
- **–î–ª—è Production:** `wss://ws.okx.com:8443` (–Ω–µ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å)

**–§–∞–π–ª—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã:**
- [src/strategies/scalping/futures/private_websocket_manager.py](src/strategies/scalping/futures/private_websocket_manager.py#L52)
- [src/strategies/scalping/futures/orchestrator.py](src/strategies/scalping/futures/orchestrator.py#L664)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** Private WebSocket —É—Å–ø–µ—à–Ω–æ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç—Å—è ‚úÖ

---

### 2. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ—à–µ–Ω–∏–π –æ–± –≤—ã—Ö–æ–¥–µ (–î–û–ë–ê–í–õ–ï–ù–û)** ‚úÖ

#### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã 4 —Ç–∏–ø–∞ –ª–æ–≥–æ–≤:

**A) EXIT_GUARD** ‚Äî –ë–ª–æ–∫–∏—Ä—É–µ—Ç —Ä–∞–Ω–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–∏—è
```
üõ°Ô∏è [EXIT_GUARD] SYMBOL: –±–ª–æ–∫–∏—Ä—É–µ–º –∑–∞–∫—Ä—ã—Ç–∏–µ (reason=analyzer) 0.05–º–∏–Ω < 0.50–º–∏–Ω (regime=RANGING)
```
**–ì–¥–µ:** `position_manager.py` –≤ –º–µ—Ç–æ–¥–µ `_close_position_by_reason()`

**–õ–æ–≥–∏–∫–∞:**
- –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –∑–∞–∫—Ä—ã—Ç–∏—è (SL, TSL, TP, liquidation, margin_call) ‚Üí –ø—Ä–æ—Ö–æ–¥—è—Ç —Å—Ä–∞–∑—É
- –ù–ï–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï (analyzer, drawdown_check, reversal) ‚Üí –∂–¥—É—Ç `min_holding_minutes` –¥–ª—è —Ä–µ–∂–∏–º–∞

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞:**
```yaml
exit_params:
  RANGING:
    max_holding_minutes: 15
  TRENDING:
    max_holding_minutes: 45
  CHOPPY:
    max_holding_minutes: 10
```

---

**B) Dynamic TSL (Trailing Stop Loss)** ‚Äî 3 —Ä–µ–∂–∏–º–∞ –ø–æ ADX
```
üîµ [TSL_MODE] SYMBOL: FREEZE —Ä–µ–∂–∏–º | ADX=42.5 > 35 | distance_mult=1.4x
üü¢ [TSL_MODE] SYMBOL: NORMAL —Ä–µ–∂–∏–º | ADX=28.0 (25-35) | distance_mult=1.0x
üü° [TSL_MODE] SYMBOL: TIGHT —Ä–µ–∂–∏–º | ADX=15.3 < 25 | distance_mult=0.75x

üîÑ [TSL_UPDATE] SYMBOL: sl=45230.50, mode=FREEZE, ADX=42.5, distance=2.1%, regime=TRENDING
```

**–ì–¥–µ:** `coordinators/trailing_sl_coordinator.py` –≤ –º–µ—Ç–æ–¥–µ `update_trailing_stop_loss()`

**–†–µ–∂–∏–º—ã:**
| –†–µ–∂–∏–º | –£—Å–ª–æ–≤–∏–µ | –ú–Ω–æ–∂–∏—Ç–µ–ª—å | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-------|---------|-----------|-----------|
| üîµ FREEZE | ADX > 35 | √ó 1.4 | –ü–æ–∑–≤–æ–ª–∏—Ç—å pullback –Ω–∞ —Å–∏–ª—å–Ω–æ–º —Ç—Ä–µ–Ω–¥–µ |
| üü¢ NORMAL | ADX 25-35 | √ó 1.0 | –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π SL |
| üü° TIGHT | ADX < 25 | √ó 0.75 | –ë—ã—Å—Ç—Ä–∞—è —Ñ–∏–∫—Å–∞—Ü–∏—è –ø—Ä–∏–±—ã–ª–∏ –≤ ranging |

---

**C) PH_DECISION** ‚Äî –†–µ—à–µ–Ω–∏—è –æ profit harvesting
```
üéØ [PH_DECISION] SYMBOL: action=close, reason=profit_harvest | gross_pnl=2.8%, net_pnl=1.9% | time=180s | regime=RANGING
üéØ [PH_DECISION] SYMBOL: action=hold, reason=profit_harvest | gross_pnl=0.5%, net_pnl=-0.1% | time=30s | regime=TRENDING
```

**–ì–¥–µ:** `position_manager.py` –≤ –º–µ—Ç–æ–¥–µ `_check_profit_harvesting()`

---

**D) SL_CHECK** ‚Äî –ö–æ–Ω—Ç—Ä–æ–ª—å –ø—Ä–∏ —Å—Ç–æ–ø-–ª–æ—Å—Å–µ
```
üîç [SL_CHECK] SYMBOL: gross_pnl=-0.8% vs threshold=-1.0% | ADX=18.5, MTF=HOLD, regime=RANGING
```

**–ì–¥–µ:** `positions/exit_analyzer.py` –≤ –º–µ—Ç–æ–¥–µ `_generate_exit_for_trending()`

---

## üî¨ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

**–°—Ç–∞—Ç—É—Å –∫–æ–¥–∞:**
- ‚úÖ –°–∏–Ω—Ç–∞–∫—Å–∏—Å: –≤—Å–µ —Ñ–∞–π–ª—ã –≤–∞–ª–∏–¥–Ω—ã
- ‚úÖ –ò–º–ø–æ—Ä—Ç—ã: –≤—Å–µ –º–æ–¥—É–ª–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è
- ‚úÖ WebSocket: –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ: —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–æ —Å emoji –º–∞—Ä–∫–µ—Ä–∞–º–∏

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- ‚úÖ –ë–æ—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
- ‚úÖ –í—Å–µ –º–æ–¥—É–ª–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è
- ‚úÖ Private WebSocket –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç—Å—è
- ‚úÖ –†—ã–Ω–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è (—Å–≤–µ—á–∏ 1m, 5m, 1H, 1D)

**–ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–ø—É—Å–∫–µ:**
- [ ] EXIT_GUARD –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ä–∞–Ω–Ω–∏–µ analyzer –∑–∞–∫—Ä—ã—Ç–∏—è
- [ ] TSL_MODE –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –ø–æ ADX (FREEZE‚ÜíNORMAL‚ÜíTIGHT)
- [ ] PH_DECISION –ª–æ–≥–∏—Ä—É–µ—Ç —Ä–µ—à–µ–Ω–∏—è –æ –ø—Ä–∏–±—ã–ª–∏
- [ ] SL_CHECK –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å—Ç–æ–ø-–ª–æ—Å—Å–∞

---

## üìä –ò–∑–º–µ—Ä–µ–Ω–∏—è –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏

–ö–æ–≥–¥–∞ –±–æ—Ç —Ç–æ—Ä–≥—É–µ—Ç, –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –ª–æ–≥–∏ –≤—Ä–æ–¥–µ:

```
logs/futures/futures_YYYY-MM-DD.log:
  üõ°Ô∏è [EXIT_GUARD] ETH-USDT: –±–ª–æ–∫–∏—Ä—É–µ–º –∑–∞–∫—Ä—ã—Ç–∏–µ (reason=analyzer) 0.2–º–∏–Ω < 1.0–º–∏–Ω (regime=TRENDING)
  üîµ [TSL_MODE] ETH-USDT: FREEZE —Ä–µ–∂–∏–º | ADX=38.2 > 35 | distance_mult=1.4x
  üîÑ [TSL_UPDATE] ETH-USDT: sl=2500.80, mode=FREEZE, ADX=38.2, distance=1.9%, regime=TRENDING
  üéØ [PH_DECISION] ETH-USDT: action=close, reason=profit_harvest | gross_pnl=1.8%, net_pnl=1.2% | time=240s | regime=TRENDING
  üîç [SL_CHECK] ETH-USDT: gross_pnl=-0.9% vs threshold=-1.0% | ADX=16.0, MTF=BLOCK, regime=RANGING
```

–ü–æ–ø—Ä–æ–±—É–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç—å –¥–ª–∏—Ç–µ–ª—å–Ω–µ–µ, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã –∏ —Ç–æ—Ä–≥–æ–≤–ª—é.

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–î–∞—Ç—å –±–æ—Ç—É –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏** —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã–ª–∏—Å—å –ø–æ–∑–∏—Ü–∏–∏ –∏ –º—ã —É–≤–∏–¥–µ–ª–∏ –ª–æ–≥–∏ EXIT_GUARD/TSL/PH
2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏** –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –Ω–∞—à–∏—Ö –Ω–æ–≤—ã—Ö —Å—Ç—Ä–æ–∫ (üõ°Ô∏è, üîµ/üü¢/üü°, üîÑ, üéØ, üîç)
3. **–ê–Ω–∞–ª–∏–∑ –ø–æ–≤–µ–¥–µ–Ω–∏—è:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ:
   - EXIT_GUARD –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–∫—Ä—ã—Ç–∏—è –¥–æ min_holding
   - Dynamic TSL –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –ø–æ ADX
   - –†–µ—à–µ–Ω–∏—è –ø—Ä–∏–±—ã–ª–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å –ø–æ–ª–Ω—ã–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
4. **–°—Ä–∞–≤–Ω–∏—Ç—å —Å Jan 7 staging:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É–ª—É—á—à–∏–ª–∏—Å—å –ª–∏ –º–µ—Ç—Ä–∏–∫–∏ (% TP, % SL, —Å—Ä–µ–¥–Ω–∏–π P&L)

---

## üìù –ö–æ–¥ –∏–∑–º–µ–Ω–µ–Ω

### –§–∞–π–ª 1: private_websocket_manager.py
```python
# –î–û
self.ws_url = "wss://wspap.okx.com:8443/ws/v5/private"  # –í–µ–∑–¥–µ 8443

# –ü–û–°–õ–ï
if sandbox:
    self.ws_url = "wss://wspap.okx.com:443/ws/v5/private"  # –ü–æ—Ä—Ç 443
else:
    self.ws_url = "wss://ws.okx.com:8443/ws/v5/private"  # Production
```

### –§–∞–π–ª 2: orchestrator.py
```python
# –î–û
ws_url = "wss://wspap.okx.com:8443/ws/v5/public"  # –í–µ–∑–¥–µ 8443

# –ü–û–°–õ–ï
if okx_config.sandbox:
    ws_url = "wss://wspap.okx.com:443/ws/v5/public"  # –ü–æ—Ä—Ç 443
else:
    ws_url = "wss://ws.okx.com:8443/ws/v5/public"  # Production
```

### –§–∞–π–ª 3: position_manager.py
- –î–æ–±–∞–≤–ª–µ–Ω—ã EXIT_GUARD –ª–æ–≥–∏ (üõ°Ô∏è)
- –î–æ–±–∞–≤–ª–µ–Ω—ã PH_DECISION –ª–æ–≥–∏ (üéØ)

### –§–∞–π–ª 4: trailing_sl_coordinator.py
- –î–æ–±–∞–≤–ª–µ–Ω–∞ dynamic TSL —Å 3 —Ä–µ–∂–∏–º–∞–º–∏
- –î–æ–±–∞–≤–ª–µ–Ω—ã TSL_MODE –ª–æ–≥–∏ (üîµüü¢üü°)
- –î–æ–±–∞–≤–ª–µ–Ω—ã TSL_UPDATE –ª–æ–≥–∏ (üîÑ)

### –§–∞–π–ª 5: exit_analyzer.py
- –î–æ–±–∞–≤–ª–µ–Ω—ã SL_CHECK –ª–æ–≥–∏ (üîç)

---

## üíæ –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ —Å–∫—Ä–∏–ø—Ç—ã —Å–æ–∑–¥–∞–Ω—ã

- `test_ssl_connection.py` ‚Äî –¢–µ—Å—Ç HTTP/TCP/SSL –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- `test_websocket_hosts.py` ‚Äî –¢–µ—Å—Ç —Ä–∞–∑–ª–∏—á–Ω—ã—Ö WebSocket —Ö–æ—Å—Ç–æ–≤ OKX

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
```
‚úÖ OK - –û–±—ã—á–Ω–æ–µ SSL (REST API)
‚úÖ OK - TCP —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ  
‚úÖ OK - SSL (–±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏)
‚ùå FAIL - WebSocket wspap.okx.com:8443
‚úÖ PASS - WebSocket wspap.okx.com:443  ‚Üê –†–ê–ë–û–¢–ê–ï–¢!
‚úÖ PASS - WebSocket ws.okx.com:8443    ‚Üê –†–ê–ë–û–¢–ê–ï–¢!
```

---

**–°—Ç–∞—Ç—É—Å:** üü¢ –ì–û–¢–û–í –ö –¢–û–†–ì–û–í–õ–ï

–í—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã. WebSocket –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ. –ù—É–∂–Ω–æ –¥–∞—Ç—å –±–æ—Ç—É –≤—Ä–µ–º—è –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–π –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–æ–≤—ã—Ö –ª–æ–≥–æ–≤ –≤ –¥–µ–π—Å—Ç–≤–∏–∏.

