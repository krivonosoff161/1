# –ê–Ω–∞–ª–∏–∑ —á–∞—Å—Ç–æ—Ç—ã —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞

**–î–∞—Ç–∞:** 2025-11-30  
**–¶–µ–ª—å:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –∫–∞–∫ —á–∞—Å—Ç–æ –±–æ—Ç –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø–æ–∑–∏—Ü–∏–∏ –∏ –≥–æ—Ç–æ–≤ –ª–∏ –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Ä–µ—à–µ–Ω–∏—è –≤–æ–≤—Ä–µ–º—è

---

## üîÑ –ß–ê–°–¢–û–¢–ê –ê–ù–ê–õ–ò–ó–ê

### 1. –ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª (TradingControlCenter)

**–§–∞–π–ª:** `src/strategies/scalping/futures/core/trading_control_center.py`

**–ò–Ω—Ç–µ—Ä–≤–∞–ª:** `check_interval` –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ (–Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ)

**–®–∞–≥–∏ —Ü–∏–∫–ª–∞:**
1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è (update_state)
2. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤
3. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤
4. **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏—è–º–∏ (manage_positions)** ‚Üê –∑–¥–µ—Å—å –∞–Ω–∞–ª–∏–∑
5. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—Ä–¥–µ—Ä–æ–≤
6. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

**–í—ã–∑–æ–≤—ã:**
- `manage_positions()` ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ –∫–∞–∂–¥–æ–º —Ü–∏–∫–ª–µ
- `manage_position(position)` ‚Üí –¥–ª—è –∫–∞–∂–¥–æ–π –ø–æ–∑–∏—Ü–∏–∏
- `ExitAnalyzer.analyze_position(symbol)` ‚Üí –¥–ª—è –∫–∞–∂–¥–æ–π –ø–æ–∑–∏—Ü–∏–∏

---

## üìä –î–ê–ù–ù–´–ï –î–õ–Ø –ê–ù–ê–õ–ò–ó–ê

### ExitAnalyzer –ø–æ–ª—É—á–∞–µ—Ç:

1. **Position** (–∏–∑ PositionRegistry):
   - –î–∞–Ω–Ω—ã–µ —Å –±–∏—Ä–∂–∏ (size, entry_price, current_price)
   - –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (entry_time, regime, position_side)

2. **Metadata** (–∏–∑ PositionRegistry):
   - entry_time
   - regime (—Å—Ç–∞—Ä—ã–π, –Ω–∞ –º–æ–º–µ–Ω—Ç –æ—Ç–∫—Ä—ã—Ç–∏—è)
   - position_side
   - entry_price

3. **Current Price** (–∏–∑ DataRegistry):
   - –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ WebSocket –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
   - –ò—Å—Ç–æ—á–Ω–∏–∫: `data_registry.get_price(symbol)`

4. **Regime** (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π):
   - –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: `signal_generator.regime_managers[symbol]` ‚Üí `signal_generator.regime_manager`
   - Fallback: DataRegistry ‚Üí metadata ‚Üí "ranging"

5. **Market Data** (–∏–∑ DataRegistry):
   - OHLCV –¥–∞–Ω–Ω—ã–µ
   - –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã

---

## ‚è±Ô∏è –í–†–ï–ú–Ø –†–ï–ê–ö–¶–ò–ò

### –ò–∑ –ª–æ–≥–æ–≤ –≤–∏–¥–Ω–æ:

**–ü–æ—Å–ª–µ–¥–Ω–∏–µ –≤—ã–∑–æ–≤—ã ExitAnalyzer –¥–ª—è XRP-USDT:**
```
21:31:03
21:31:08 (–Ω–µ—Å–∫–æ–ª—å–∫–æ –≤—ã–∑–æ–≤–æ–≤ –ø–æ–¥—Ä—è–¥)
```

**–ò–Ω—Ç–µ—Ä–≤–∞–ª:** ~5 —Å–µ–∫—É–Ω–¥ –º–µ–∂–¥—É –≤—ã–∑–æ–≤–∞–º–∏

### –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏:

1. **WebSocket –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω—ã:**
   - –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
   - –ù–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–æ 1-2 —Å–µ–∫—É–Ω–¥

2. **–ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª:**
   - –ó–∞–≤–∏—Å–∏—Ç –æ—Ç `check_interval`
   - –ï—Å–ª–∏ `check_interval = 5 —Å–µ–∫` ‚Üí –∞–Ω–∞–ª–∏–∑ —Ä–∞–∑ –≤ 5 —Å–µ–∫—É–Ω–¥

3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö:**
   - –ü–æ–ª—É—á–µ–Ω–∏–µ position –∏–∑ registry: ~0.001 —Å–µ–∫
   - –ü–æ–ª—É—á–µ–Ω–∏–µ metadata: ~0.001 —Å–µ–∫
   - –ü–æ–ª—É—á–µ–Ω–∏–µ current_price: ~0.001 —Å–µ–∫
   - –ü–æ–ª—É—á–µ–Ω–∏–µ regime: ~0.01 —Å–µ–∫ (–µ—Å–ª–∏ –∏–∑ signal_generator)
   - –†–∞—Å—á–µ—Ç PnL%: ~0.001 —Å–µ–∫
   - **–û–±—â–µ–µ –≤—Ä–µ–º—è –∞–Ω–∞–ª–∏–∑–∞: ~0.02 —Å–µ–∫**

---

## ‚úÖ –ì–û–¢–û–í–ù–û–°–¢–¨ –ö –†–ï–®–ï–ù–ò–Ø–ú

### –ë–æ—Ç –≤–∏–¥–∏—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ:

1. ‚úÖ **–¶–µ–Ω–∞** - –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ WebSocket –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
2. ‚úÖ **Entry price** - –∏–∑ metadata (—Å–æ—Ö—Ä–∞–Ω–µ–Ω –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏)
3. ‚úÖ **Position side** - –∏–∑ metadata –∏–ª–∏ position
4. ‚úÖ **Regime** - –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∏–∑ signal_generator
5. ‚úÖ **Entry time** - –∏–∑ metadata (–¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –∫–æ–º–∏—Å—Å–∏–∏)
6. ‚úÖ **Market data** - –∏–∑ DataRegistry (–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ WebSocket)

### –ë–æ—Ç –≥–æ—Ç–æ–≤ –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Ä–µ—à–µ–Ω–∏—è:

1. ‚úÖ **TP –¥–æ—Å—Ç–∏–≥–Ω—É—Ç** - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–π —Ü–∏–∫–ª
2. ‚úÖ **Partial TP** - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–π —Ü–∏–∫–ª
3. ‚úÖ **Big Profit Exit** - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–π —Ü–∏–∫–ª
4. ‚úÖ **Profit Harvesting** - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –≤ position_manager
5. ‚úÖ **Profit Drawdown** - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –≤ position_manager
6. ‚úÖ **Max Holding** - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –≤ position_manager

---

## ‚ö†Ô∏è –ü–û–¢–ï–ù–¶–ò–ê–õ–¨–ù–´–ï –ü–†–û–ë–õ–ï–ú–´

### 1. –ó–∞–¥–µ—Ä–∂–∫–∞ –≤ –≥–ª–∞–≤–Ω–æ–º —Ü–∏–∫–ª–µ

**–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ `check_interval = 5 —Å–µ–∫`, —Ç–æ –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ä–∞–∑ –≤ 5 —Å–µ–∫—É–Ω–¥

**–†–µ—à–µ–Ω–∏–µ:** 
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ `check_interval` –≤ –∫–æ–Ω—Ñ–∏–≥–µ
- –ï—Å–ª–∏ > 3 —Å–µ–∫ ‚Üí —Å–Ω–∏–∑–∏—Ç—å –¥–æ 1-2 —Å–µ–∫ –¥–ª—è —Å–∫–∞–ª—å–ø–∏–Ω–≥–∞

### 2. –ó–∞–¥–µ—Ä–∂–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ü–µ–Ω—ã

**–ü—Ä–æ–±–ª–µ–º–∞:** WebSocket –º–æ–∂–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å —Ü–µ–Ω—É —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π 1-2 —Å–µ–∫—É–Ω–¥—ã

**–†–µ—à–µ–Ω–∏–µ:**
- WebSocket –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ü–µ–Ω—É –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- –ù–æ –µ—Å–ª–∏ WebSocket –æ—Ç–∫–ª—é—á–µ–Ω ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è REST (–∑–∞–¥–µ—Ä–∂–∫–∞ 5+ —Å–µ–∫)

### 3. –ó–∞–¥–µ—Ä–∂–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞

**–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ regime –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è fallback "ranging"

**–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: —Ä–µ–∂–∏–º –±–µ—Ä–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∏–∑ signal_generator
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω WARNING, –µ—Å–ª–∏ —Ä–µ–∂–∏–º –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω

---

## üìã –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å check_interval:**
   - –î–æ–ª–∂–µ–Ω –±—ã—Ç—å ‚â§ 2 —Å–µ–∫ –¥–ª—è —Å–∫–∞–ª—å–ø–∏–Ω–≥–∞
   - –ï—Å–ª–∏ > 5 —Å–µ–∫ ‚Üí —Å–Ω–∏–∑–∏—Ç—å –¥–æ 1-2 —Å–µ–∫

2. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ WebSocket:**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á–∞—Å—Ç–æ—Ç—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ü–µ–Ω—ã

3. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   - –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –∞–Ω–∞–ª–∏–∑–∞
   - –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–¥–µ—Ä–∂–µ–∫

---

## üéØ –í–´–í–û–î

**–ë–æ—Ç –≤–∏–¥–∏—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–∑–∏—Ü–∏–∏:**
- ‚úÖ –¶–µ–Ω–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ (WebSocket)
- ‚úÖ –í—Å–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –¥–æ—Å—Ç—É–ø–Ω—ã (entry_time, position_side, regime)
- ‚úÖ –†–µ–∂–∏–º –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏

**–ë–æ—Ç –≥–æ—Ç–æ–≤ –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Ä–µ—à–µ–Ω–∏—è:**
- ‚úÖ –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∫–∞–∂–¥—ã–π —Ü–∏–∫–ª (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç check_interval)
- ‚úÖ –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è (TP, partial_tp, big_profit, PH, drawdown)
- ‚úÖ –í—Ä–µ–º—è –∞–Ω–∞–ª–∏–∑–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ (~0.02 —Å–µ–∫)

**–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:**
- ‚ö†Ô∏è –ó–∞–¥–µ—Ä–∂–∫–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç check_interval (–Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ)
- ‚ö†Ô∏è –ï—Å–ª–∏ WebSocket –æ—Ç–∫–ª—é—á–µ–Ω ‚Üí –∑–∞–¥–µ—Ä–∂–∫–∞ 5+ —Å–µ–∫


