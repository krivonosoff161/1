# üîç –ü–û–õ–ù–´–ô –°–ü–ò–°–û–ö –ó–ê–•–ê–†–î–ö–û–ñ–ï–ù–ù–´–• –ü–ê–†–ê–ú–ï–¢–†–û–í

**–î–∞—Ç–∞:** 2025-11-12  
**–¶–µ–ª—å:** –ù–∞–π—Ç–∏ –í–°–ï –∂–µ—Å—Ç–∫–æ –∑–∞–¥–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ –∫–æ–Ω—Ñ–∏–≥–µ

---

## ‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï: Fallback –∑–Ω–∞—á–µ–Ω–∏—è –≤ Trailing Stop Loss

### 1. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã Trailing Stop Loss (orchestrator.py:730-742)

**–ü—Ä–æ–±–ª–µ–º–∞:**
```python
params: Dict[str, Any] = {
    "trading_fee_rate": 0.0009,  # ‚úÖ –ï—Å—Ç—å –≤ –∫–æ–Ω—Ñ–∏–≥–µ
    "initial_trail": 0.05,  # ‚ùå 5% - –≤ –∫–æ–Ω—Ñ–∏–≥–µ 0.005 (0.5%)
    "max_trail": 0.2,  # ‚ùå 20% - –≤ –∫–æ–Ω—Ñ–∏–≥–µ 0.01 (1%)
    "min_trail": 0.02,  # ‚ùå 2% - –≤ –∫–æ–Ω—Ñ–∏–≥–µ 0.003 (0.3%)
    ...
}
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –ï—Å–ª–∏ –∫–æ–Ω—Ñ–∏–≥ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ù–ï–ü–†–ê–í–ò–õ–¨–ù–´–ï –∑–Ω–∞—á–µ–Ω–∏—è (5% –≤–º–µ—Å—Ç–æ 0.5%!)
- –≠—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –∑–∞–∫—Ä—ã—Ç–∏—é –ø–æ–∑–∏—Ü–∏–π —Å–ª–∏—à–∫–æ–º —Ä–∞–Ω–æ –∏–ª–∏ —Å–ª–∏—à–∫–æ–º –ø–æ–∑–¥–Ω–æ

**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ –∫–∞–∫ –û–°–ù–û–í–£
- Fallback –∑–Ω–∞—á–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ç–∞–∫–∏–º–∏ –∂–µ, –∫–∞–∫ –≤ –∫–æ–Ω—Ñ–∏–≥–µ (0.005, 0.01, 0.003)

---

## ‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï: –ñ–µ—Å—Ç–∫–æ –∑–∞–¥–∞–Ω–Ω—ã–µ –º–Ω–æ–∂–∏—Ç–µ–ª–∏ —Ä–µ–∂–∏–º–æ–≤

### 2. –ú–Ω–æ–∂–∏—Ç–µ–ª–∏ —Ä–µ–∂–∏–º–æ–≤ –≤ should_close_position (trailing_stop_loss.py:458-467)

**–ü—Ä–æ–±–ª–µ–º–∞:**
```python
regime_multiplier = 1.0
if market_regime == "trending":
    regime_multiplier = 1.5  # ‚ùå –ñ–µ—Å—Ç–∫–æ –∑–∞–¥–∞–Ω–æ
elif market_regime == "ranging":
    regime_multiplier = 1.0  # ‚ùå –ñ–µ—Å—Ç–∫–æ –∑–∞–¥–∞–Ω–æ
elif market_regime == "choppy":
    regime_multiplier = 0.8  # ‚ùå –ñ–µ—Å—Ç–∫–æ –∑–∞–¥–∞–Ω–æ
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –ú–Ω–æ–∂–∏—Ç–µ–ª–∏ –Ω–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ä–µ–∂–∏–º–æ–≤

**–†–µ—à–µ–Ω–∏–µ:**
- –í—ã–Ω–µ—Å—Ç–∏ –º–Ω–æ–∂–∏—Ç–µ–ª–∏ –≤ –∫–æ–Ω—Ñ–∏–≥
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞

---

## ‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï: –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–∏—Å–∫–∞ (orchestrator.py:67-69)

### 3. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–∏—Å–∫–∞ (fallback)

**–ü—Ä–æ–±–ª–µ–º–∞:**
```python
self.max_loss_per_trade = 0.02  # Fallback: 2%
self.max_margin_percent = 0.80  # Fallback: 80%
self.max_drawdown_percent = 0.05  # Fallback: 5%
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
- –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏
- ‚úÖ –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, –Ω–æ –ª—É—á—à–µ —É–±—Ä–∞—Ç—å fallback –∑–Ω–∞—á–µ–Ω–∏—è

---

## ‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï: –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–π

### 4. Loss Cut –∏ Timeout (–∫–æ–Ω—Ñ–∏–≥ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π, –Ω–æ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏–∫—É)

**–ö–æ–Ω—Ñ–∏–≥:**
```yaml
trailing_sl:
  loss_cut_percent: 1.5  # ‚úÖ –ñ—ë—Å—Ç–∫–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏ —É–±—ã—Ç–∫–µ -1.5%
  timeout_loss_percent: 0.5  # ‚úÖ –ó–∞–∫—Ä—ã–≤–∞—Ç—å –ø—Ä–∏ —É–±—ã—Ç–∫–µ -0.5% –ø–æ—Å–ª–µ —Ç–∞–π–º–∞—É—Ç–∞
  timeout_minutes: 3  # ‚úÖ –¢–∞–π–º–∞—É—Ç 3 –º–∏–Ω—É—Ç—ã
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ï—Å–ª–∏ –ø–æ–∑–∏—Ü–∏—è —Å—Ä–∞–∑—É —É—Ö–æ–¥–∏—Ç –≤ –º–∏–Ω—É—Å –ø–æ—Å–ª–µ –æ—Ç–∫—Ä—ã—Ç–∏—è, –æ–Ω–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–∫—Ä—ã—Ç–∞ —á–µ—Ä–µ–∑ 3 –º–∏–Ω—É—Ç—ã –ø—Ä–∏ —É–±—ã—Ç–∫–µ -0.5%!
- –≠—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –∑–∞–∫—Ä—ã—Ç–∏—é –ø–æ–∑–∏—Ü–∏–π —Å–ª–∏—à–∫–æ–º —Ä–∞–Ω–æ

**–†–µ—à–µ–Ω–∏–µ:**
- –£–≤–µ–ª–∏—á–∏—Ç—å `timeout_minutes` –¥–ª—è —É–±—ã—Ç–æ—á–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π
- –ò–ª–∏ —É–≤–µ–ª–∏—á–∏—Ç—å `timeout_loss_percent` –¥–æ -1.0% –∏–ª–∏ -1.5%

---

## ‚ö†Ô∏è –ü–†–û–ë–õ–ï–ú–ê: –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–π —Å –º–∏–Ω—É—Å–æ–º

### –ü–æ—á–µ–º—É –ø–æ–∑–∏—Ü–∏–∏ –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è —Å –º–∏–Ω—É—Å–æ–º?

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**

1. **Loss Cut (loss_cut_percent: 1.5%)**
   - –ï—Å–ª–∏ –ø–æ–∑–∏—Ü–∏—è —Å—Ä–∞–∑—É —É—Ö–æ–¥–∏—Ç –≤ –º–∏–Ω—É—Å -1.5%, –æ–Ω–∞ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è
   - –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, –Ω–æ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –ø–æ—á–µ–º—É –ø–æ–∑–∏—Ü–∏—è —Å—Ä–∞–∑—É —É—Ö–æ–¥–∏—Ç –≤ –º–∏–Ω—É—Å

2. **Timeout Loss (timeout_loss_percent: 0.5%, timeout_minutes: 3)**
   - –ï—Å–ª–∏ –ø–æ–∑–∏—Ü–∏—è –≤ —É–±—ã—Ç–∫–µ -0.5% —á–µ—Ä–µ–∑ 3 –º–∏–Ω—É—Ç—ã, –æ–Ω–∞ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è
   - **–ü–†–û–ë–õ–ï–ú–ê:** 3 –º–∏–Ω—É—Ç—ã - —ç—Ç–æ —Å–ª–∏—à–∫–æ–º –º–∞–ª–æ!
   - –ü–æ–∑–∏—Ü–∏—è –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–∫—Ä—ã—Ç–∞ —Å–ª–∏—à–∫–æ–º —Ä–∞–Ω–æ

3. **Trailing Stop Loss –¥–ª—è SHORT**
   - –î–ª—è SHORT –ø–æ–∑–∏—Ü–∏–π —Å—Ç–æ–ø-–ª–æ—Å—Å –º–æ–∂–µ—Ç –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
   - –ï—Å–ª–∏ —Å—Ç–æ–ø —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤—ã—à–µ entry_price, –ø–æ–∑–∏—Ü–∏—è –º–æ–∂–µ—Ç –∑–∞–∫—Ä—ã—Ç—å—Å—è —Å—Ä–∞–∑—É

4. **–ö–æ–º–∏—Å—Å–∏—è**
   - –ö–æ–º–∏—Å—Å–∏—è —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –≤ —Ä–∞—Å—á–µ—Ç–µ –ø—Ä–∏–±—ã–ª–∏
   - –ï—Å–ª–∏ –ø–æ–∑–∏—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç–∞ —Å –Ω–µ–±–æ–ª—å—à–æ–π –ø—Ä–∏–±—ã–ª—å—é, –∫–æ–º–∏—Å—Å–∏—è –º–æ–∂–µ—Ç —Å–¥–µ–ª–∞—Ç—å –µ–µ —É–±—ã—Ç–æ—á–Ω–æ–π

---

## ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### 1. –ò—Å–ø—Ä–∞–≤–∏—Ç—å fallback –∑–Ω–∞—á–µ–Ω–∏—è Trailing Stop Loss

**–î–æ:**
```python
params: Dict[str, Any] = {
    "initial_trail": 0.05,  # 5%
    "max_trail": 0.2,  # 20%
    "min_trail": 0.02,  # 2%
}
```

**–ü–æ—Å–ª–µ:**
```python
params: Dict[str, Any] = {
    "initial_trail": 0.005,  # 0.5% (–∫–∞–∫ –≤ –∫–æ–Ω—Ñ–∏–≥–µ)
    "max_trail": 0.01,  # 1% (–∫–∞–∫ –≤ –∫–æ–Ω—Ñ–∏–≥–µ)
    "min_trail": 0.003,  # 0.3% (–∫–∞–∫ –≤ –∫–æ–Ω—Ñ–∏–≥–µ)
}
```

### 2. –í—ã–Ω–µ—Å—Ç–∏ –º–Ω–æ–∂–∏—Ç–µ–ª–∏ —Ä–µ–∂–∏–º–æ–≤ –≤ –∫–æ–Ω—Ñ–∏–≥

**–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ–Ω—Ñ–∏–≥:**
```yaml
trailing_sl:
  by_regime:
    trending:
      regime_multiplier: 1.5  # ‚úÖ –ò–∑ –∫–æ–Ω—Ñ–∏–≥–∞
    ranging:
      regime_multiplier: 1.0  # ‚úÖ –ò–∑ –∫–æ–Ω—Ñ–∏–≥–∞
    choppy:
      regime_multiplier: 0.8  # ‚úÖ –ò–∑ –∫–æ–Ω—Ñ–∏–≥–∞
```

### 3. –£–≤–µ–ª–∏—á–∏—Ç—å timeout –¥–ª—è —É–±—ã—Ç–æ—á–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π

**–ö–æ–Ω—Ñ–∏–≥:**
```yaml
trailing_sl:
  timeout_loss_percent: 1.0  # ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 0.5% –¥–æ 1.0%
  timeout_minutes: 5  # ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 3 –¥–æ 5 –º–∏–Ω—É—Ç
```

### 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏–∫—É –∑–∞–∫—Ä—ã—Ç–∏—è SHORT –ø–æ–∑–∏—Ü–∏–π

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –î–ª—è SHORT –ø–æ–∑–∏—Ü–∏–π —Å—Ç–æ–ø-–ª–æ—Å—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –í–´–®–ï entry_price
- –ù–æ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å—Ç–æ–ø –º–æ–∂–µ—Ç –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏–∫—É `get_stop_loss()` –¥–ª—è SHORT
- –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Å—Ç–æ–ø –≤—Å–µ–≥–¥–∞ –≤—ã—à–µ entry_price –¥–ª—è SHORT

---

## üìã –ò–¢–û–ì–û–í–´–ô –°–ü–ò–°–û–ö –ü–†–û–ë–õ–ï–ú

1. ‚úÖ **Fallback –∑–Ω–∞—á–µ–Ω–∏—è Trailing Stop Loss** - –∏—Å–ø—Ä–∞–≤–∏—Ç—å
2. ‚úÖ **–ñ–µ—Å—Ç–∫–æ –∑–∞–¥–∞–Ω–Ω—ã–µ –º–Ω–æ–∂–∏—Ç–µ–ª–∏ —Ä–µ–∂–∏–º–æ–≤** - –≤—ã–Ω–µ—Å—Ç–∏ –≤ –∫–æ–Ω—Ñ–∏–≥
3. ‚úÖ **Timeout –¥–ª—è —É–±—ã—Ç–æ—á–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π** - —É–≤–µ–ª–∏—á–∏—Ç—å
4. ‚úÖ **–õ–æ–≥–∏–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è SHORT –ø–æ–∑–∏—Ü–∏–π** - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å
5. ‚úÖ **–ö–æ–º–∏—Å—Å–∏—è –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ –ø—Ä–∏–±—ã–ª–∏** - —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ

---

## üîß –ü–†–ò–û–†–ò–¢–ï–¢ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô

1. **–ö–†–ò–¢–ò–ß–ï–°–ö–û–ï:** –ò—Å–ø—Ä–∞–≤–∏—Ç—å fallback –∑–Ω–∞—á–µ–Ω–∏—è Trailing Stop Loss
2. **–ö–†–ò–¢–ò–ß–ï–°–ö–û–ï:** –£–≤–µ–ª–∏—á–∏—Ç—å timeout –¥–ª—è —É–±—ã—Ç–æ—á–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π
3. **–í–ê–ñ–ù–û:** –í—ã–Ω–µ—Å—Ç–∏ –º–Ω–æ–∂–∏—Ç–µ–ª–∏ —Ä–µ–∂–∏–º–æ–≤ –≤ –∫–æ–Ω—Ñ–∏–≥
4. **–í–ê–ñ–ù–û:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏–∫—É –∑–∞–∫—Ä—ã—Ç–∏—è SHORT –ø–æ–∑–∏—Ü–∏–π

