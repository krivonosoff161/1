# –ê–ù–ê–õ–ò–ó: –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å TP –∏ Trailing Stop Loss

## ‚úÖ –ö–†–ê–¢–ö–ò–ô –û–¢–í–ï–¢

**–î–ê, –æ–±–∞ –º–µ—Ö–∞–Ω–∏–∑–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–¥–∞–ø—Ç–∏–≤–Ω—ã –∫ –Ω–æ–≤—ã–º —Ä–∞–∑–º–µ—Ä–∞–º –ø–æ–∑–∏—Ü–∏–π!**

–û–±–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç **–ø—Ä–æ—Ü–µ–Ω—Ç—ã**, –∫–æ—Ç–æ—Ä—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É—é—Ç—Å—è —Å —Ä–∞–∑–º–µ—Ä–æ–º –ø–æ–∑–∏—Ü–∏–∏ –∏ leverage.

---

## üìä Take Profit (TP)

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **–ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–æ—Ü–µ–Ω—Ç –æ—Ç –º–∞—Ä–∂–∏** (–Ω–µ –æ—Ç —Ü–µ–Ω—ã –≤—Ö–æ–¥–∞):
   ```python
   pnl_percent = (unrealized_pnl / margin_used) * 100
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ TP**:
   ```python
   tp_percent = self.scalping_config.tp_percent  # 1.0% –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
   if pnl_percent >= tp_percent:
       # –ó–∞–∫—Ä—ã–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é
   ```

3. **–ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å**:
   - ‚úÖ **–ú–∞—Ä–∂–∞** = `notional / leverage` = `(position_size * price) / leverage`
   - ‚úÖ –ï—Å–ª–∏ —Ä–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –≤ 2 —Ä–∞–∑–∞:
     - Notional —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –≤ 2 —Ä–∞–∑–∞
     - –ú–∞—Ä–∂–∞ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –≤ 2 —Ä–∞–∑–∞
     - PnL (–≤ USD) —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –≤ 2 —Ä–∞–∑–∞
     - **PnL% –æ—Å—Ç–∞–µ—Ç—Å—è —Ç–µ–º –∂–µ** (–ø—Ä–æ—Ü–µ–Ω—Ç –æ—Ç –º–∞—Ä–∂–∏)
   - ‚úÖ **TP –∞–¥–∞–ø—Ç–∏–≤–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!**

### –ü—Ä–∏–º–µ—Ä:

**–°—Ç–∞—Ä–∞—è –ø–æ–∑–∏—Ü–∏—è (leverage 3x, notional $52.80)**:
- –ú–∞—Ä–∂–∞ = $52.80 / 3 = $17.60
- TP = 1.0% –æ—Ç –º–∞—Ä–∂–∏ = $0.176
- –ó–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏ PnL = $0.176

**–ù–æ–≤–∞—è –ø–æ–∑–∏—Ü–∏—è (leverage 5x, notional $122.28)**:
- –ú–∞—Ä–∂–∞ = $122.28 / 5 = $24.46
- TP = 1.0% –æ—Ç –º–∞—Ä–∂–∏ = $0.2446
- –ó–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏ PnL = $0.2446

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: TP –∞–¥–∞–ø—Ç–∏–≤–µ–Ω! –ü—Ä–∏ —É–≤–µ–ª–∏—á–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏ –≤ 2.3 —Ä–∞–∑–∞, TP —Ç–∞–∫–∂–µ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –≤ 2.3 —Ä–∞–∑–∞.

---

## üìä Trailing Stop Loss

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **–ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–æ—Ü–µ–Ω—Ç—ã –æ—Ç —Ü–µ–Ω—ã**:
   ```python
   # –î–ª—è –ª–æ–Ω–≥–∞
   stop_loss = highest_price * (1 - current_trail)
   
   # –î–ª—è —à–æ—Ä—Ç–∞
   stop_loss = lowest_price * (1 + current_trail)
   ```

2. **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞**:
   - `initial_trail`: 0.5% (0.005)
   - `max_trail`: 1.0% (0.01)
   - `min_trail`: 0.3% (0.003)

3. **–ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å**:
   - ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç **–ø—Ä–æ—Ü–µ–Ω—Ç—ã –æ—Ç —Ü–µ–Ω—ã**, –∞ –Ω–µ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
   - ‚úÖ –ï—Å–ª–∏ —Ü–µ–Ω–∞ BTC = $105,000:
     - Stop Loss (0.5%) = $105,000 * (1 - 0.005) = $104,475
     - –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ = $525
   - ‚úÖ –ï—Å–ª–∏ —Ü–µ–Ω–∞ BTC = $110,000:
     - Stop Loss (0.5%) = $110,000 * (1 - 0.005) = $109,450
     - –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ = $550
   - ‚úÖ **Trailing Stop Loss –∞–¥–∞–ø—Ç–∏–≤–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!**

### –ü—Ä–∏–º–µ—Ä:

**–°—Ç–∞—Ä–∞—è –ø–æ–∑–∏—Ü–∏—è (BTC $105,000, —Ä–∞–∑–º–µ—Ä 0.0005 BTC, notional $52.50)**:
- Trailing Stop = 0.5% –æ—Ç —Ü–µ–Ω—ã
- Stop Loss = $105,000 * (1 - 0.005) = $104,475
- –ó–∞—â–∏—Ç–∞ = $525 (0.5% –æ—Ç —Ü–µ–Ω—ã)

**–ù–æ–≤–∞—è –ø–æ–∑–∏—Ü–∏—è (BTC $105,000, —Ä–∞–∑–º–µ—Ä 0.00116 BTC, notional $122.28)**:
- Trailing Stop = 0.5% –æ—Ç —Ü–µ–Ω—ã (—Ç–∞–∫–æ–π –∂–µ –ø—Ä–æ—Ü–µ–Ω—Ç!)
- Stop Loss = $105,000 * (1 - 0.005) = $104,475 (—Ç–∞ –∂–µ —Ü–µ–Ω–∞!)
- –ó–∞—â–∏—Ç–∞ = $525 (0.5% –æ—Ç —Ü–µ–Ω—ã, –Ω–æ –¥–ª—è –±–æ–ª—å—à–µ–π –ø–æ–∑–∏—Ü–∏–∏!)

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: Trailing Stop Loss –∞–¥–∞–ø—Ç–∏–≤–µ–Ω! –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–æ—Ü–µ–Ω—Ç—ã –æ—Ç —Ü–µ–Ω—ã, –ø–æ—ç—Ç–æ–º—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è —Å —Ä–∞–∑–º–µ—Ä–æ–º –ø–æ–∑–∏—Ü–∏–∏.

---

## üîç –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∫–æ–¥–∞

### Take Profit (position_manager.py):

```python
# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–´–ô –†–ê–°–ß–ï–¢: PnL% –æ—Ç –º–∞—Ä–∂–∏ (–∫–∞–∫ –Ω–∞ –±–∏—Ä–∂–µ!)
pnl_percent = (unrealized_pnl / margin_used) * 100

# –ü—Ä–æ–≤–µ—Ä–∫–∞ Take Profit
tp_percent = self.scalping_config.tp_percent  # 1.0%
if pnl_percent >= tp_percent:
    # –ó–∞–∫—Ä—ã–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é
```

**–ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å**: 
- –ú–∞—Ä–∂–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏: `margin = (position_size * price) / leverage`
- PnL% —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –æ—Ç –º–∞—Ä–∂–∏, –ø–æ—ç—Ç–æ–º—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–¥–∞–ø—Ç–∏–≤–µ–Ω

### Trailing Stop Loss (trailing_stop_loss.py):

```python
# –î–ª—è –ª–æ–Ω–≥–∞
effective_highest = max(self.highest_price, self.entry_price)
return effective_highest * (1 - self.current_trail)

# –î–ª—è —à–æ—Ä—Ç–∞
effective_lowest = min(self.lowest_price, self.entry_price)
return effective_lowest * (1 + self.current_trail)
```

**–ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å**: 
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–æ—Ü–µ–Ω—Ç—ã –æ—Ç —Ü–µ–Ω—ã (`current_trail` –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö)
- –ù–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏, –ø–æ—ç—Ç–æ–º—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–¥–∞–ø—Ç–∏–≤–µ–Ω

---

## ‚úÖ –í–´–í–û–î–´

### 1. Take Profit:
- ‚úÖ **–ê–¥–∞–ø—Ç–∏–≤–µ–Ω**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–æ—Ü–µ–Ω—Ç –æ—Ç –º–∞—Ä–∂–∏ (1.0%)
- ‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è**: –ü—Ä–∏ —É–≤–µ–ª–∏—á–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏, TP —Ç–∞–∫–∂–µ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è
- ‚úÖ **–ù–µ —Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π**: –ü—Ä–æ—Ü–µ–Ω—Ç –æ—Å—Ç–∞–µ—Ç—Å—è —Ç–µ–º –∂–µ (1.0%), –Ω–æ –∞–±—Å–æ–ª—é—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è

### 2. Trailing Stop Loss:
- ‚úÖ **–ê–¥–∞–ø—Ç–∏–≤–µ–Ω**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–æ—Ü–µ–Ω—Ç—ã –æ—Ç —Ü–µ–Ω—ã (0.5% - 1.0%)
- ‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è**: –ü—Ä–∏ —É–≤–µ–ª–∏—á–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏, –∑–∞—â–∏—Ç–∞ –æ—Å—Ç–∞–µ—Ç—Å—è –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö
- ‚úÖ **–ù–µ —Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π**: –ü—Ä–æ—Ü–µ–Ω—Ç—ã –æ—Å—Ç–∞—é—Ç—Å—è —Ç–µ–º–∏ –∂–µ, –Ω–æ –∞–±—Å–æ–ª—é—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è

### 3. –û–±–∞ –º–µ—Ö–∞–Ω–∏–∑–º–∞:
- ‚úÖ **–ü–æ–ª–Ω–æ—Å—Ç—å—é –∞–¥–∞–ø—Ç–∏–≤–Ω—ã** –∫ –Ω–æ–≤—ã–º —Ä–∞–∑–º–µ—Ä–∞–º –ø–æ–∑–∏—Ü–∏–π
- ‚úÖ **–ò—Å–ø–æ–ª—å–∑—É—é—Ç –ø—Ä–æ—Ü–µ–Ω—Ç—ã**, –∫–æ—Ç–æ—Ä—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É—é—Ç—Å—è
- ‚úÖ **–ù–µ —Ç—Ä–µ–±—É—é—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∫–æ–¥–µ –∏–ª–∏ –∫–æ–Ω—Ñ–∏–≥–µ**
- ‚úÖ **–†–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ** —Å –ª—é–±—ã–º —Ä–∞–∑–º–µ—Ä–æ–º –ø–æ–∑–∏—Ü–∏–∏ –∏ leverage

---

## üìã –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞

### Take Profit:
```yaml
tp_percent: 1.0  # 1.0% –æ—Ç –º–∞—Ä–∂–∏
```

### Trailing Stop Loss:
```yaml
trailing_sl:
  initial_trail: 0.005  # 0.5% –æ—Ç —Ü–µ–Ω—ã
  max_trail: 0.01       # 1.0% –æ—Ç —Ü–µ–Ω—ã
  min_trail: 0.003      # 0.3% –æ—Ç —Ü–µ–Ω—ã
  loss_cut_percent: 1.5  # -1.5% –æ—Ç –º–∞—Ä–∂–∏ (–∂–µ—Å—Ç–∫–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ)
  timeout_loss_percent: 0.5  # -0.5% –æ—Ç –º–∞—Ä–∂–∏ (—Ç–∞–π–º–∞—É—Ç)
  timeout_minutes: 3
```

---

## üéØ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### ‚úÖ –í—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ!

1. **TP –∏ Trailing Stop Loss –∞–¥–∞–ø—Ç–∏–≤–Ω—ã** –∫ –Ω–æ–≤—ã–º —Ä–∞–∑–º–µ—Ä–∞–º –ø–æ–∑–∏—Ü–∏–π
2. **–ù–µ —Ç—Ä–µ–±—É—é—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π** –≤ –∫–æ–¥–µ –∏–ª–∏ –∫–æ–Ω—Ñ–∏–≥–µ
3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É—é—Ç—Å—è** —Å —Ä–∞–∑–º–µ—Ä–æ–º –ø–æ–∑–∏—Ü–∏–∏ –∏ leverage

### ‚ö†Ô∏è –í–∞–∂–Ω–æ:

- **TP** —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –æ—Ç –º–∞—Ä–∂–∏, –ø–æ—ç—Ç–æ–º—É –ø—Ä–∏ —É–≤–µ–ª–∏—á–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏, TP —Ç–∞–∫–∂–µ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è
- **Trailing Stop Loss** —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –æ—Ç —Ü–µ–Ω—ã, –ø–æ—ç—Ç–æ–º—É –ø—Ä–∏ —É–≤–µ–ª–∏—á–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏, –∑–∞—â–∏—Ç–∞ –æ—Å—Ç–∞–µ—Ç—Å—è –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö
- **–û–±–∞ –º–µ—Ö–∞–Ω–∏–∑–º–∞** —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å –ª—é–±—ã–º —Ä–∞–∑–º–µ—Ä–æ–º –ø–æ–∑–∏—Ü–∏–∏ –∏ leverage

---

## üìä –ü—Ä–∏–º–µ—Ä—ã —Ä–∞—Å—á–µ—Ç–æ–≤

### –°—Ç–∞—Ä–∞—è –ø–æ–∑–∏—Ü–∏—è (leverage 3x):
- Notional: $52.80
- –ú–∞—Ä–∂–∞: $17.60
- TP (1.0%): $0.176
- Trailing Stop (0.5%): $525 –æ—Ç —Ü–µ–Ω—ã

### –ù–æ–≤–∞—è –ø–æ–∑–∏—Ü–∏—è (leverage 5x):
- Notional: $122.28 (—É–≤–µ–ª–∏—á–µ–Ω–∏–µ –≤ 2.3 —Ä–∞–∑–∞)
- –ú–∞—Ä–∂–∞: $24.46 (—É–≤–µ–ª–∏—á–µ–Ω–∏–µ –≤ 1.4 —Ä–∞–∑–∞)
- TP (1.0%): $0.2446 (—É–≤–µ–ª–∏—á–µ–Ω–∏–µ –≤ 1.4 —Ä–∞–∑–∞)
- Trailing Stop (0.5%): $525 –æ—Ç —Ü–µ–Ω—ã (—Ç–∞ –∂–µ –∑–∞—â–∏—Ç–∞ –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö!)

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –û–±–∞ –º–µ—Ö–∞–Ω–∏–∑–º–∞ –∞–¥–∞–ø—Ç–∏–≤–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ! ‚úÖ

