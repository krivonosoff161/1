# –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã –Ω–µ–∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏ –ø–æ TP

## üìä –°–∏—Ç—É–∞—Ü–∏—è:
- **PnL –¥–æ—Ö–æ–¥–∏—Ç –¥–æ +0.40** (—ç—Ç–æ –ø—Ä–∏–º–µ—Ä–Ω–æ **0.4%** –æ—Ç –ø–æ–∑–∏—Ü–∏–∏ $100)
- **–°–¥–µ–ª–∫–∞ –ù–ï –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è**
- **TP —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω:** 0.4% (–ø–æ—Å–ª–µ –Ω–∞—à–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π)

---

## üîç –ê–Ω–∞–ª–∏–∑ –ª–æ–≥–∏–∫–∏ –∑–∞–∫—Ä—ã—Ç–∏—è:

### 1. **TrailingSL –ª–æ–≥–∏–∫–∞:**

**TrailingSL –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –ø–æ–∑–∏—Ü–∏—é –¢–û–õ–¨–ö–û –∫–æ–≥–¥–∞:**
```
current_price <= stop_loss (–¥–ª—è LONG)
current_price >= stop_loss (–¥–ª—è SHORT)
```

**TrailingSL –ù–ï –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –ø–æ–∑–∏—Ü–∏—é –∫–æ–≥–¥–∞:**
- ‚úÖ –ü–æ–∑–∏—Ü–∏—è –≤ –ø—Ä–∏–±—ã–ª–∏ (profit_pct > 0)
- ‚úÖ –ò–¥–µ—Ç —Ç—Ä–µ–Ω–¥ (trend_strength > 0.7)
- ‚úÖ –†–µ–∂–∏–º —Ä—ã–Ω–∫–∞ = "trending"
- ‚úÖ –¶–µ–Ω–∞ –≤—ã—à–µ adjusted_stop (—Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Å—Ç–æ–ø–∞)

**–ü—Ä–æ–±–ª–µ–º–∞:** TrailingSL –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç —É–±—ã—Ç–∫–∞, –Ω–æ **–ù–ï –ó–ê–ö–†–´–í–ê–ï–¢ –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ TP!**

---

### 2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ TP (`_check_tp_only`):**

**–í `position_manager.py`:**
```python
# –ü—Ä–æ–≤–µ—Ä–∫–∞ Take Profit
if pnl_percent >= tp_percent:
    logger.info(f"üéØ TP –¥–æ—Å—Ç–∏–≥–Ω—É—Ç –¥–ª—è {symbol}: {pnl_percent:.2f}%")
    await self._close_position_by_reason(position, "tp")
```

**–ù–û!** –≠—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑ `_check_tp_sl`, –∞ `_check_tp_sl` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑ `manage_position`.

**–í–æ–ø—Ä–æ—Å:** –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ª–∏ `manage_position` –¥–ª—è –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π?

---

### 3. **–õ–æ–≥–∏–∫–∞ –≤ orchestrator:**

**–í `_main_trading_loop`:**
```python
# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ TrailingSL
await self._update_trailing_stop_loss(symbol, price)

# –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏—è–º–∏
await self._manage_positions()  # <-- –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ª–∏?
```

**–í `_manage_positions`:**
```python
for symbol, position in self.active_positions.items():
    await self.position_manager.manage_position(position)
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ `_manage_positions` –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–ª–∏ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ä–µ–¥–∫–æ, —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π TP –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è!

---

## üêõ –í–´–Ø–í–õ–ï–ù–ù–ê–Ø –ü–†–û–ë–õ–ï–ú–ê:

### **TrailingSL –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π TP!**

**–õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã:**
1. ‚úÖ TrailingSL —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω–æ (–≤ `_update_trailing_stop_loss`)
2. ‚ùì –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π TP –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ `position_manager.manage_position`
3. ‚ùì `manage_position` –º–æ–∂–µ—Ç –Ω–µ –≤—ã–∑—ã–≤–∞—Ç—å—Å—è —Ä–µ–≥—É–ª—è—Ä–Ω–æ –∏–ª–∏ –≤–æ–æ–±—â–µ –æ—Ç–∫–ª—é—á–µ–Ω

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- TrailingSL –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç —É–±—ã—Ç–∫–∞ ‚úÖ
- **–ù–û TrailingSL –ù–ï –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ TP!** ‚ùå
- –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π TP –º–æ–∂–µ—Ç –Ω–µ –ø—Ä–æ–≤–µ—Ä—è—Ç—å—Å—è —Ä–µ–≥—É–ª—è—Ä–Ω–æ ‚ùå

---

## üí° –ü–û–ß–ï–ú–£ –ù–ï –ó–ê–ö–†–´–í–ê–ï–¢–°–Ø:

### –°—Ü–µ–Ω–∞—Ä–∏–π:
1. –ü–æ–∑–∏—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç–∞ –Ω–∞ ETH, entry = $3,900
2. –¶–µ–Ω–∞ —Ä–∞—Å—Ç–µ—Ç –¥–æ $3,915.6 ‚Üí PnL = +0.40% (‚âà TP 0.4%)
3. TrailingSL —É—Å—Ç–∞–Ω–æ–≤–∏–ª trailing stop –Ω–∞ $3,910 (–Ω–∞–ø—Ä–∏–º–µ—Ä)
4. –¶–µ–Ω–∞ = $3,915.6 > trailing stop = $3,910 ‚úÖ
5. **TrailingSL –ù–ï –∑–∞–∫—Ä—ã–≤–∞–µ—Ç** (—Ü–µ–Ω–∞ –≤—ã—à–µ —Å—Ç–æ–ø–∞)
6. **–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π TP –ù–ï –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è** (–µ—Å–ª–∏ `manage_position` –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–∑–∏—Ü–∏—è –æ—Å—Ç–∞–µ—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç–æ–π, –ø–æ–∫–∞ —Ü–µ–Ω–∞ –Ω–µ —É–ø–∞–¥–µ—Ç –¥–æ trailing stop!

---

## ‚úÖ –†–ï–®–ï–ù–ò–ï (—Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏—è, –±–µ–∑ –∫–æ–¥–∏–Ω–≥–∞):

### **–í–∞—Ä–∏–∞–Ω—Ç 1: –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É TP –≤ TrailingSL**
- –í `should_close_position` –ø—Ä–æ–≤–µ—Ä—è—Ç—å: `if profit_pct >= tp_percent: return True`
- –ù–û —ç—Ç–æ –º–æ–∂–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å —Å trailing –ª–æ–≥–∏–∫–æ–π

### **–í–∞—Ä–∏–∞–Ω—Ç 2: –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ `_check_tp_only` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ä–µ–≥—É–ª—è—Ä–Ω–æ**
- –í `orchestrator._manage_positions` –¥–æ–ª–∂–µ–Ω –≤—ã–∑—ã–≤–∞—Ç—å—Å—è `position_manager.manage_position`
- `manage_position` –¥–æ–ª–∂–µ–Ω –≤—ã–∑—ã–≤–∞—Ç—å `_check_tp_only`
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ª–∏ `_manage_positions` –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Ü–∏–∫–ª–µ

### **–í–∞—Ä–∏–∞–Ω—Ç 3: –ü—Ä–æ–≤–µ—Ä—è—Ç—å TP –≤ `_update_trailing_stop_loss`**
- –ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è TrailingSL –ø—Ä–æ–≤–µ—Ä—è—Ç—å: –¥–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏ TP
- –ï—Å–ª–∏ –¥–∞ ‚Üí –∑–∞–∫—Ä—ã–≤–∞—Ç—å –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç TrailingSL

---

## üîç –ß–¢–û –ù–£–ñ–ù–û –ü–†–û–í–ï–†–ò–¢–¨ –í –õ–û–ì–ê–•:

1. **–í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ª–∏ `_manage_positions`?**
   - –ò—â–∏: `"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏—è–º–∏"` –∏–ª–∏ `"manage_position"`

2. **–í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ª–∏ `_check_tp_only`?**
   - –ò—â–∏: `"TP –¥–æ—Å—Ç–∏–≥–Ω—É—Ç"` –∏–ª–∏ `"Take Profit"`

3. **–ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç TrailingSL?**
   - –ò—â–∏: `"TrailingSL ETH"` - —Ç–∞–º –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `profit_pct` –∏ `stop`

4. **–ö–∞–∫–æ–π PnL —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è?**
   - –í –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å: `"PnL = X.XX USDT"` –∏–ª–∏ `"profit_pct"`

---

## ‚ö†Ô∏è –í–´–í–û–î:

**–ü—Ä–æ–±–ª–µ–º–∞:** TrailingSL –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç —É–±—ã—Ç–∫–∞, –Ω–æ **–ù–ï –ó–ê–ö–†–´–í–ê–ï–¢ –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ TP 0.4%!**

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
1. –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π TP –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Ä–µ–≥—É–ª—è—Ä–Ω–æ
2. TrailingSL –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ª–æ–≥–∏–∫—É –∑–∞–∫—Ä—ã—Ç–∏—è
3. TP –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö

**–ù—É–∂–Ω–æ:** –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π TP –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è **–ù–ï–ó–ê–í–ò–°–ò–ú–û** –æ—Ç TrailingSL!

