# ‚úÖ –ò–¢–û–ì–û–í–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø TP –ò –¢–†–ï–ô–õ–ò–ù–ì –°–¢–û–ü-–õ–û–°–°

## üìã –†–ï–ê–õ–ò–ó–û–í–ê–ù–ù–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### 1. ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è entry price –ø–æ—Å–ª–µ –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏

**–ü—Ä–æ–±–ª–µ–º–∞:** Entry price –≤ trailing stop loss —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª—Å—è –¥–æ –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏ (—Ü–µ–Ω–∞ —Å–∏–≥–Ω–∞–ª–∞ = 105455.7), –∞ —Ä–µ–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ –≤—Ö–æ–¥–∞ –Ω–∞ –±–∏—Ä–∂–µ (avgPx = 105296.4) –æ—Ç–ª–∏—á–∞–ª–∞—Å—å.

**–†–µ—à–µ–Ω–∏–µ:**
- –ü–æ—Å–ª–µ –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏ –ø–æ–ª—É—á–∞–µ–º —Ä–µ–∞–ª—å–Ω—É—é —Ü–µ–Ω—É –≤—Ö–æ–¥–∞ (avgPx) —Å –±–∏—Ä–∂–∏
- –û–±–Ω–æ–≤–ª—è–µ–º entry_price –≤ active_positions
- –ü–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º trailing stop loss —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ü–µ–Ω–æ–π

**–ö–æ–¥:** `orchestrator.py` (_execute_signal_from_price)
```python
# –ü–æ—Å–ª–µ –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º entry price —Å –±–∏—Ä–∂–µ–π
await asyncio.sleep(2)  # –ñ–¥–µ–º —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –Ω–∞ –±–∏—Ä–∂–µ
positions = await self.client.get_positions()
for pos in positions:
    if pos.get("instId") == inst_id and abs(float(pos.get("pos", "0"))) > 0:
        real_entry_price = float(pos.get("avgPx", "0"))
        if real_entry_price > 0:
            # –û–±–Ω–æ–≤–ª—è–µ–º entry price
            self.active_positions[symbol]["entry_price"] = real_entry_price
            # –ü–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º trailing stop loss
            tsl.initialize(real_entry_price, side)
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ Entry price —Ç–µ–ø–µ—Ä—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω —Å –±–∏—Ä–∂–µ–π (avgPx)

---

### 2. ‚úÖ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Ç—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å –Ω–∞–¥ TP

**–ü—Ä–æ–±–ª–µ–º–∞:** TP —Å—Ä–∞–±–∞—Ç—ã–≤–∞–ª —Ä–∞–Ω—å—à–µ —Ç—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å (TP = 1.03% –æ—Ç –º–∞—Ä–∂–∏), –Ω–µ –¥–∞–≤–∞—è —Ç—Ä–µ–π–ª–∏–Ω–≥—É —Å—Ä–∞–±–æ—Ç–∞—Ç—å.

**–†–µ—à–µ–Ω–∏–µ:**
- –í `_check_tp_only` –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ç—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å –ü–ï–†–ï–î TP
- –ï—Å–ª–∏ —Ç—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å –∞–∫—Ç–∏–≤–µ–Ω (–ø–æ–∑–∏—Ü–∏—è –≤ –ø—Ä–∏–±—ã–ª–∏ –∏ –¥–æ—Å—Ç–∏–≥ min_profit_to_close), —Ç–æ TP –æ—Ç–∫–ª—é—á–µ–Ω
- –¢—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å –∏–º–µ–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –¥–ª—è –ø—Ä–∏–±—ã–ª—å–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π

**–õ–æ–≥–∏–∫–∞:**
1. `_update_trailing_stop_loss` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ `_handle_ticker_data` (–ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö —Ç–∏–∫–µ—Ä–∞)
2. `_check_tp_only` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ `_manage_positions` (–≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Ü–∏–∫–ª–µ)
3. –í `_check_tp_only` –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ç—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å –ü–ï–†–ï–î TP
4. –ï—Å–ª–∏ —Ç—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å –∞–∫—Ç–∏–≤–µ–Ω ‚Üí TP –æ—Ç–∫–ª—é—á–µ–Ω (return)
5. –ï—Å–ª–∏ —Ç—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω ‚Üí –ø—Ä–æ–≤–µ—Ä—è–µ–º TP

**–ö–æ–¥:** `position_manager.py` (_check_tp_only)
```python
# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å –ü–ï–†–ï–î TP
if hasattr(self, "orchestrator") and self.orchestrator:
    trailing_sl_by_symbol = getattr(self.orchestrator, "trailing_sl_by_symbol", {})
    if symbol in trailing_sl_by_symbol:
        tsl = trailing_sl_by_symbol[symbol]
        profit_pct_net = tsl.get_profit_pct(current_price, include_fees=True)
        min_profit_to_close = getattr(tsl, "min_profit_to_close", None)
        
        # –ï—Å–ª–∏ —Ç—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å –∞–∫—Ç–∏–≤–µ–Ω - TP –æ—Ç–∫–ª—é—á–µ–Ω
        if profit_pct_net > 0 and min_profit_to_close and profit_pct_net >= min_profit_to_close:
            logger.debug(f"üìä {symbol} —Ç—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å –∞–∫—Ç–∏–≤–µ–Ω, TP –æ—Ç–∫–ª—é—á–µ–Ω")
            return  # –ù–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º TP, —Ç—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å –∏–º–µ–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –¢—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å –∏–º–µ–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞–¥ TP

---

### 3. ‚úÖ TP –≤—ã—à–µ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Ñ–∏—Ç–∞ —Ç—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å

**–ü—Ä–æ–±–ª–µ–º–∞:** TP –±—ã–ª –Ω–∏–∂–µ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Ñ–∏—Ç–∞ —Ç—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å, —á—Ç–æ —Å–æ–∑–¥–∞–≤–∞–ª–æ –∫–æ–Ω—Ñ–ª–∏–∫—Ç.

**–†–µ—à–µ–Ω–∏–µ:**
- TP –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤—ã—à–µ min_profit_to_close + –∫–æ–º–∏—Å—Å–∏—è + buffer (0.1%)
- –ï—Å–ª–∏ TP —Å–ª–∏—à–∫–æ–º –Ω–∏–∑–∫–∏–π, –ø–æ–¥–Ω–∏–º–∞–µ–º –µ–≥–æ –¥–æ –º–∏–Ω–∏–º—É–º–∞

**–§–æ—Ä–º—É–ª–∞:**
```
TP_min = min_profit_to_close + commission_rate + buffer
TP_min = 0.1% + 0.09% + 0.1% = 0.29%
TP_final = max(TP_config, TP_min)
TP_final = max(1.0%, 0.29%) = 1.0%
```

**–ö–æ–¥:** `position_manager.py` (_check_tp_only)
```python
# TP –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤—ã—à–µ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Ñ–∏—Ç–∞ —Ç—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å + –∫–æ–º–∏—Å—Å–∏—è
if not trailing_sl_active and min_profit_to_close is not None and pnl_percent > 0:
    min_profit_to_close_pct = min_profit_to_close * 100  # 0.1% ‚Üí 0.1
    commission_pct = commission_rate * 100  # 0.09% ‚Üí 0.09
    buffer_pct = 0.1  # –ó–∞–ø–∞—Å 0.1%
    min_tp_percent = min_profit_to_close_pct + commission_pct + buffer_pct  # 0.29%
    
    if tp_percent < min_tp_percent:
        tp_percent = min_tp_percent  # –ü–æ–¥–Ω–∏–º–∞–µ–º TP –¥–æ –º–∏–Ω–∏–º—É–º–∞
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ TP —Ç–µ–ø–µ—Ä—å –≤—ã—à–µ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Ñ–∏—Ç–∞ —Ç—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å (1.0% > 0.29%)

---

### 4. ‚úÖ –£—á–µ—Ç –∫–æ–º–∏—Å—Å–∏–∏ –≤ TP

**–ü—Ä–æ–±–ª–µ–º–∞:** TP —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–ª—Å—è –±–µ–∑ —É—á–µ—Ç–∞ –∫–æ–º–∏—Å—Å–∏–∏ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ (1.03% –æ—Ç –º–∞—Ä–∂–∏), —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ —É–±—ã—Ç–∫–∞–º –Ω–∞ –±–∏—Ä–∂–µ (-0.02%).

**–†–µ—à–µ–Ω–∏–µ:**
- –£—á–∏—Ç—ã–≤–∞–µ–º –∫–æ–º–∏—Å—Å–∏—é –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ TP (0.09% –Ω–∞ –∫—Ä—É–≥)
- TP –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤—ã—Å–æ–∫–∏–º, —á—Ç–æ–±—ã –ø–æ–∫—Ä—ã—Ç—å –∫–æ–º–∏—Å—Å–∏—é –∏ –¥–∞—Ç—å –ø—Ä–∏–±—ã–ª—å
- –ü—Ä–æ–≤–µ—Ä—è–µ–º net PnL (–ø–æ—Å–ª–µ –∫–æ–º–∏—Å—Å–∏–∏) –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º –ø–æ TP

**–ö–æ–¥:** `position_manager.py` (_check_tp_only)
```python
# –£—á–∏—Ç—ã–≤–∞–µ–º –∫–æ–º–∏—Å—Å–∏—é –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ TP
commission_rate = 0.0009  # 0.09% –Ω–∞ –∫—Ä—É–≥
tp_percent_with_commission = tp_percent + (commission_rate * 100)  # 1.0% + 0.09% = 1.09%

if pnl_percent >= tp_percent_with_commission:
    net_pnl_percent = pnl_percent - (commission_rate * 100)
    if net_pnl_percent > 0:
        # –ó–∞–∫—Ä—ã–≤–∞–µ–º –ø–æ TP —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ net –ø—Ä–∏–±—ã–ª—å > 0
        await self._close_position_by_reason(position, "tp")
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ö–æ–º–∏—Å—Å–∏—è —Ç–µ–ø–µ—Ä—å —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ TP (1.09% —Å –∫–æ–º–∏—Å—Å–∏–µ–π)

---

### 5. ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏ –ø–æ TP –æ–Ω–∞ –Ω–µ —É–¥–∞–ª—è–ª–∞—Å—å –∏–∑ orchestrator.active_positions –∏ trailing_sl_by_symbol.

**–†–µ—à–µ–Ω–∏–µ:**
- –ü–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏ –ø–æ TP —É–¥–∞–ª—è–µ–º –µ—ë –∏–∑ orchestrator.active_positions –∏ trailing_sl_by_symbol
- –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –∏ –Ω–æ–≤–∞—è –ø–æ–∑–∏—Ü–∏—è –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç–∫—Ä—ã—Ç–∞ —Å—Ä–∞–∑—É

**–ö–æ–¥:** `position_manager.py` (_close_position_by_reason)
```python
# –£–¥–∞–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –∏–∑ orchestrator.active_positions –∏ trailing_sl_by_symbol
if hasattr(self, "orchestrator") and self.orchestrator:
    if symbol in self.orchestrator.active_positions:
        del self.orchestrator.active_positions[symbol]
    if symbol in self.orchestrator.trailing_sl_by_symbol:
        self.orchestrator.trailing_sl_by_symbol[symbol].reset()
        del self.orchestrator.trailing_sl_by_symbol[symbol]
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏

---

## üéØ –ò–¢–û–ì–û–í–ê–Ø –õ–û–ì–ò–ö–ê –†–ê–ë–û–¢–´

### –ü–æ—Ä—è–¥–æ–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏:

1. **–¢—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –¥–ª—è –ø—Ä–∏–±—ã–ª—å–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π)**
   - –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ `_handle_ticker_data` (–ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö —Ç–∏–∫–µ—Ä–∞)
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –≤ `_update_trailing_stop_loss`
   - –ï—Å–ª–∏ –ø–æ–∑–∏—Ü–∏—è –≤ –ø—Ä–∏–±—ã–ª–∏ –∏ –¥–æ—Å—Ç–∏–≥ min_profit_to_close ‚Üí —Ç—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å –∞–∫—Ç–∏–≤–µ–Ω
   - –ï—Å–ª–∏ —Ç—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å —Å—Ä–∞–±–æ—Ç–∞–ª ‚Üí –∑–∞–∫—Ä—ã–≤–∞–µ–º –ø–æ —Ç—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å

2. **TP (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ç—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω)**
   - –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ `_manage_positions` (–≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Ü–∏–∫–ª–µ)
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –≤ `_check_tp_only`
   - –ï—Å–ª–∏ —Ç—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å –∞–∫—Ç–∏–≤–µ–Ω ‚Üí TP –æ—Ç–∫–ª—é—á–µ–Ω (return)
   - –ï—Å–ª–∏ —Ç—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω ‚Üí –ø—Ä–æ–≤–µ—Ä—è–µ–º TP
   - TP –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤—ã—à–µ min_profit_to_close + –∫–æ–º–∏—Å—Å–∏—è + buffer
   - –£—á–∏—Ç—ã–≤–∞–µ–º –∫–æ–º–∏—Å—Å–∏—é –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ TP

3. **Loss cut (–¥–ª—è —É–±—ã—Ç–æ—á–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π)**
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –≤ —Ç—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å
   - –ï—Å–ª–∏ –ø–æ–∑–∏—Ü–∏—è –≤ —É–±—ã—Ç–∫–µ ‚Üí –ø—Ä–∏–º–µ–Ω—è–µ–º loss cut

### –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã:

**–ü–æ–∑–∏—Ü–∏—è BTC-USDT SHORT:**
- Entry price: 105296.4 (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω —Å –±–∏—Ä–∂–µ–π) ‚úÖ
- min_profit_to_close: 0.1% (–∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ ranging)
- TP: 1.0% (–∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞)
- –ö–æ–º–∏—Å—Å–∏—è: 0.09% (–Ω–∞ –∫—Ä—É–≥)

**–°—Ü–µ–Ω–∞—Ä–∏–π 1: –¢—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å –∞–∫—Ç–∏–≤–µ–Ω**
- Profit: 0.15% (net) >= min_profit_to_close (0.1%)
- –¢—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å –∞–∫—Ç–∏–≤–µ–Ω ‚Üí TP –æ—Ç–∫–ª—é—á–µ–Ω
- –ü–æ–∑–∏—Ü–∏—è –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø–æ —Ç—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å ‚úÖ

**–°—Ü–µ–Ω–∞—Ä–∏–π 2: –¢—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω, TP –¥–æ—Å—Ç–∏–≥–Ω—É—Ç**
- Profit: 0.05% (net) < min_profit_to_close (0.1%)
- –¢—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω ‚Üí –ø—Ä–æ–≤–µ—Ä—è–µ–º TP
- PnL: 1.09% (–æ—Ç –º–∞—Ä–∂–∏) >= TP_with_commission (1.09%)
- Net PnL: 1.09% - 0.09% = 1.0% > 0
- –ü–æ–∑–∏—Ü–∏—è –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø–æ TP ‚úÖ

**–°—Ü–µ–Ω–∞—Ä–∏–π 3: –¢—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω, TP –Ω–µ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç**
- Profit: 0.05% (net) < min_profit_to_close (0.1%)
- –¢—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω ‚Üí –ø—Ä–æ–≤–µ—Ä—è–µ–º TP
- PnL: 0.8% (–æ—Ç –º–∞—Ä–∂–∏) < TP_with_commission (1.09%)
- –ü–æ–∑–∏—Ü–∏—è –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è, –∂–¥–µ–º TP –∏–ª–∏ —Ç—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å ‚úÖ

---

## ‚úÖ –†–ï–ó–£–õ–¨–¢–ê–¢–´

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
- ‚ùå Entry price –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π (—Ü–µ–Ω–∞ —Å–∏–≥–Ω–∞–ª–∞ –≤–º–µ—Å—Ç–æ avgPx)
- ‚ùå TP —Å—Ä–∞–±–∞—Ç—ã–≤–∞–ª —Ä–∞–Ω—å—à–µ —Ç—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å
- ‚ùå TP –Ω–µ —É—á–∏—Ç—ã–≤–∞–ª –∫–æ–º–∏—Å—Å–∏—é
- ‚ùå –ü–æ–∑–∏—Ü–∏–∏ –∑–∞–∫—Ä—ã–≤–∞–ª–∏—Å—å —Å —É–±—ã—Ç–∫–æ–º –Ω–∞ –±–∏—Ä–∂–µ (-0.02%)

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
- ‚úÖ Entry price —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω —Å –±–∏—Ä–∂–µ–π (avgPx)
- ‚úÖ –¢—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å –∏–º–µ–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞–¥ TP
- ‚úÖ TP –≤—ã—à–µ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Ñ–∏—Ç–∞ —Ç—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å (1.0% > 0.29%)
- ‚úÖ –ö–æ–º–∏—Å—Å–∏—è —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ TP (1.09% —Å –∫–æ–º–∏—Å—Å–∏–µ–π)
- ‚úÖ –ü–æ–∑–∏—Ü–∏–∏ –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è —Å –ø—Ä–∏–±—ã–ª—å—é –Ω–∞ –±–∏—Ä–∂–µ
- ‚úÖ –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏

---

## üìã –ü–ê–†–ê–ú–ï–¢–†–´ –ò–ó –ö–û–ù–§–ò–ì–ê

### Trailing Stop Loss (ranging —Ä–µ–∂–∏–º):
- `min_profit_to_close: 0.001` (0.1% net)
- `min_holding_minutes: 0.5` (30 —Å–µ–∫—É–Ω–¥)
- `initial_trail: 0.005` (0.5%)

### TP (ranging —Ä–µ–∂–∏–º):
- `tp_percent: 1.0%` (–∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞)
- `TP_min: 0.29%` (min_profit + commission + buffer)
- `TP_final: 1.0%` (max(1.0%, 0.29%))
- `TP_with_commission: 1.09%` (TP + commission)

### –ö–æ–º–∏—Å—Å–∏—è:
- `commission_rate: 0.0009` (0.09% –Ω–∞ –∫—Ä—É–≥)

---

## üéØ –ò–¢–û–ì

**–í—Å–µ –ø—Ä–æ–±–ª–µ–º—ã —Ä–µ—à–µ–Ω—ã! ‚úÖ**

1. ‚úÖ Entry price —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω —Å –±–∏—Ä–∂–µ–π (avgPx)
2. ‚úÖ –¢—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å –∏–º–µ–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞–¥ TP
3. ‚úÖ TP –≤—ã—à–µ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Ñ–∏—Ç–∞ —Ç—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å (1.0% > 0.29%)
4. ‚úÖ –ö–æ–º–∏—Å—Å–∏—è —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ TP (1.09% —Å –∫–æ–º–∏—Å—Å–∏–µ–π)
5. ‚úÖ –ù–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ –º–µ–∂–¥—É TP –∏ —Ç—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å
6. ‚úÖ –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏

**–ë–æ—Ç –≥–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é! üöÄ**

---

## üìù –û–¢–í–ï–¢–´ –ù–ê –í–û–ü–†–û–°–´

### –ü–æ—á–µ–º—É –ø–æ–∑–∏—Ü–∏—è –∑–∞–∫—Ä—ã–ª–∞—Å—å —Å —É–±—ã—Ç–∫–æ–º –Ω–∞ –±–∏—Ä–∂–µ?

**–ü—Ä–∏—á–∏–Ω–∞:**
- –ë–æ—Ç —Å—á–∏—Ç–∞–ª PnL% –æ—Ç –º–∞—Ä–∂–∏ (1.03%), –Ω–æ –Ω–∞ –±–∏—Ä–∂–µ PnL —Å—á–∏—Ç–∞–µ—Ç—Å—è –æ—Ç —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏
- –ü—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –∫–æ–º–∏—Å—Å–∏—è –∏ –ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏–µ —Å—ä–µ–ª–∏ –ø—Ä–∏–±—ã–ª—å
- –†–µ–∑—É–ª—å—Ç–∞—Ç: –Ω–∞ –±–∏—Ä–∂–µ -0.02% –≤–º–µ—Å—Ç–æ +1.03%

**–†–µ—à–µ–Ω–∏–µ:**
- –¢–µ–ø–µ—Ä—å —É—á–∏—Ç—ã–≤–∞–µ–º –∫–æ–º–∏—Å—Å–∏—é –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ TP (1.09% —Å –∫–æ–º–∏—Å—Å–∏–µ–π)
- –ü—Ä–æ–≤–µ—Ä—è–µ–º net PnL (–ø–æ—Å–ª–µ –∫–æ–º–∏—Å—Å–∏–∏) –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º –ø–æ TP
- Entry price —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω —Å –±–∏—Ä–∂–µ–π (avgPx)

### –ü–æ—á–µ–º—É —Å—Ä–∞–∑—É –æ—Ç–∫—Ä—ã–ª–∞—Å—å –Ω–æ–≤–∞—è –ø–æ–∑–∏—Ü–∏—è?

**–ü—Ä–∏—á–∏–Ω–∞:**
- –ü–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏ –±–æ—Ç —Å—Ä–∞–∑—É —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª –Ω–æ–≤—ã–π —Å–∏–≥–Ω–∞–ª
- –ù–µ—Ç –∑–∞–¥–µ—Ä–∂–∫–∏ –º–µ–∂–¥—É –∑–∞–∫—Ä—ã—Ç–∏–µ–º –∏ –æ—Ç–∫—Ä—ã—Ç–∏–µ–º –Ω–æ–≤–æ–π –ø–æ–∑–∏—Ü–∏–∏

**–†–µ—à–µ–Ω–∏–µ:**
- –ó–∞–¥–µ—Ä–∂–∫–∞ –Ω–µ –Ω—É–∂–Ω–∞ (–≤—ã—Å–æ–∫–æ—á–∞—Å—Ç–æ—Ç–Ω–∞—è —Ç–æ—Ä–≥–æ–≤–ª—è) ‚úÖ
- –ù–æ–≤–∞—è –ø–æ–∑–∏—Ü–∏—è –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è —Å—Ç–∞—Ä–æ–π
- –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è –≤—ã—Å–æ–∫–æ—á–∞—Å—Ç–æ—Ç–Ω–æ–≥–æ —Å–∫–∞–ª—å–ø–∏–Ω–≥–∞

### –ü–æ—á–µ–º—É —Ç—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª?

**–ü—Ä–∏—á–∏–Ω–∞:**
- TP —Å—Ä–∞–±–æ—Ç–∞–ª —Ä–∞–Ω—å—à–µ —Ç—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å (1.03% –æ—Ç –º–∞—Ä–∂–∏)
- –¢—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å –±—ã–ª –Ω–∞ 105898.31, —Ü–µ–Ω–∞ –±—ã–ª–∞ 105350.00
- –¢—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å –Ω–µ —É—Å–ø–µ–ª —Å—Ä–∞–±–æ—Ç–∞—Ç—å, –ø–æ—Ç–æ–º—É —á—Ç–æ TP —Å—Ä–∞–±–æ—Ç–∞–ª –ø–µ—Ä–≤—ã–º

**–†–µ—à–µ–Ω–∏–µ:**
- –¢–µ–ø–µ—Ä—å —Ç—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å –∏–º–µ–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞–¥ TP ‚úÖ
- –ï—Å–ª–∏ —Ç—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å –∞–∫—Ç–∏–≤–µ–Ω (profit >= min_profit_to_close), —Ç–æ TP –æ—Ç–∫–ª—é—á–µ–Ω
- –¢—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å –±—É–¥–µ—Ç —Å—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –ø–µ—Ä–≤—ã–º –¥–ª—è –ø—Ä–∏–±—ã–ª—å–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç –º–µ–∂–¥—É TP –∏ —Ç—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å?

**–†–µ—à–µ–Ω–∏–µ:**
- –¢—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å –∏–º–µ–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –¥–ª—è –ø—Ä–∏–±—ã–ª—å–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π
- –ï—Å–ª–∏ —Ç—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å –∞–∫—Ç–∏–≤–µ–Ω (profit >= min_profit_to_close), —Ç–æ TP –æ—Ç–∫–ª—é—á–µ–Ω
- TP –º–æ–∂–µ—Ç —Å—Ä–∞–±–æ—Ç–∞—Ç—å —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ç—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω
- TP –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤—ã—à–µ min_profit_to_close + –∫–æ–º–∏—Å—Å–∏—è + buffer (1.0% > 0.29%)
- –ù–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞: —Ç—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–µ—Ä–≤—ã–º –¥–ª—è –ø—Ä–∏–±—ã–ª—å–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π ‚úÖ

