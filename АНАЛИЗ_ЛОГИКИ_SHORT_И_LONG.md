# üîç –ê–ù–ê–õ–ò–ó –õ–û–ì–ò–ö–ò SHORT –ò LONG –ü–û–ó–ò–¶–ò–ô

**–î–∞—Ç–∞:** 2025-11-12  
**–¶–µ–ª—å:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏–∫—É –∑–∞–∫—Ä—ã—Ç–∏—è SHORT –∏ LONG –ø–æ–∑–∏—Ü–∏–π

---

## üìä –¢–ï–ö–£–©–ê–Ø –õ–û–ì–ò–ö–ê

### 1. LONG –ø–æ–∑–∏—Ü–∏—è

**–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:**
- `entry_price = 100000`
- `highest_price = entry_price = 100000`
- `lowest_price = float("inf")`

**get_stop_loss():**
```python
effective_highest = max(self.highest_price, self.entry_price)  # 100000
stop_loss = effective_highest * (1 - self.current_trail)  # 100000 * (1 - 0.005) = 99500
```

**–ï—Å–ª–∏ —Ü–µ–Ω–∞ –∏–¥–µ—Ç –í–í–ï–†–• (–≤ –ø—Ä–∏–±—ã–ª—å):**
- `current_price = 101000`
- `update()`: `highest_price = 101000`
- `get_stop_loss()`: `stop_loss = 101000 * (1 - 0.005) = 100495`
- –°—Ç–æ–ø –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è –≤–º–µ—Å—Ç–µ —Å —Ü–µ–Ω–æ–π ‚úÖ

**–ï—Å–ª–∏ —Ü–µ–Ω–∞ –∏–¥–µ—Ç –í–ù–ò–ó (–≤ —É–±—ã—Ç–æ–∫):**
- `current_price = 99000`
- `update()`: `highest_price` –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è (–æ—Å—Ç–∞–µ—Ç—Å—è 100000)
- `get_stop_loss()`: `stop_loss = 100000 * (1 - 0.005) = 99500`
- –°—Ç–æ–ø –æ—Å—Ç–∞–µ—Ç—Å—è –Ω–∞ –º–µ—Å—Ç–µ ‚úÖ

**should_close_position():**
```python
price_hit_sl = current_price <= stop_loss  # 99000 <= 99500 ‚Üí TRUE
```
- –ü–æ–∑–∏—Ü–∏—è –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ —Å—Ç–æ–ø–∞ ‚úÖ

**–í–´–í–û–î:** –õ–æ–≥–∏–∫–∞ –¥–ª—è LONG –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è! ‚úÖ

---

### 2. SHORT –ø–æ–∑–∏—Ü–∏—è

**–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:**
- `entry_price = 100000`
- `lowest_price = entry_price = 100000`
- `highest_price = 0.0`

**get_stop_loss():**
```python
if self.lowest_price < float("inf") and self.lowest_price < self.entry_price:
    # –≠—Ç–æ —É—Å–ª–æ–≤–∏–µ FALSE –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ (lowest_price == entry_price)
    stop_loss = self.lowest_price * (1 + self.current_trail)
else:
    # –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —ç—Ç–∞ –≤–µ—Ç–∫–∞
    stop_loss = entry_price * (1 - self.current_trail)  # 100000 * (1 - 0.005) = 99500
```

**–ü–†–û–ë–õ–ï–ú–ê:**
- –°—Ç–æ–ø —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ù–ò–ñ–ï entry_price (99500 < 100000)
- –î–ª—è SHORT —Å—Ç–æ–ø –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –í–´–®–ï entry_price –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç —Ä–æ—Å—Ç–∞!
- –ï—Å–ª–∏ —Ü–µ–Ω–∞ –∏–¥–µ—Ç –í–í–ï–†–• (–ø—Ä–æ—Ç–∏–≤ SHORT), –ø–æ–∑–∏—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –∑–∞–∫—Ä—ã—Ç—å—Å—è, –∫–æ–≥–¥–∞ —Ü–µ–Ω–∞ –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è –≤—ã—à–µ —Å—Ç–æ–ø–∞

**–ï—Å–ª–∏ —Ü–µ–Ω–∞ –∏–¥–µ—Ç –í–í–ï–†–• (–ø—Ä–æ—Ç–∏–≤ SHORT, –≤ —É–±—ã—Ç–æ–∫):**
- `current_price = 101000`
- `update()`: `lowest_price` –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è (–æ—Å—Ç–∞–µ—Ç—Å—è 100000, –ø–æ—Ç–æ–º—É —á—Ç–æ `101000 > 100000`)
- `get_stop_loss()`: `stop_loss = 100000 * (1 - 0.005) = 99500`
- `should_close_position()`: `price_hit_sl = current_price >= stop_loss` ‚Üí `101000 >= 99500` ‚Üí TRUE ‚úÖ
- –ü–æ–∑–∏—Ü–∏—è –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ —Å—Ç–æ–ø–∞ ‚úÖ

**–ù–û! –ï—Å—Ç—å –ø—Ä–æ–±–ª–µ–º–∞:**
- –°—Ç–æ–ø —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–∞ 99500, —á—Ç–æ –ù–ò–ñ–ï entry_price (100000)
- –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —Å—Ç–æ–ø –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –ø—Ä–∏–±—ã–ª—å–Ω–æ–π –∑–æ–Ω–µ –¥–ª—è SHORT!
- –ï—Å–ª–∏ —Ü–µ–Ω–∞ –ø–∞–¥–∞–µ—Ç –¥–æ 99500, —ç—Ç–æ –ü–†–ò–ë–´–õ–¨ –¥–ª—è SHORT, –∞ –Ω–µ —É–±—ã—Ç–æ–∫!
- –°—Ç–æ–ø –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –í–´–®–ï entry_price –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç —Ä–æ—Å—Ç–∞!

**–ï—Å–ª–∏ —Ü–µ–Ω–∞ –∏–¥–µ—Ç –í–ù–ò–ó (–≤ –ø—Ä–∏–±—ã–ª—å –¥–ª—è SHORT):**
- `current_price = 99000`
- `update()`: `lowest_price = 99000` (–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è, –ø–æ—Ç–æ–º—É —á—Ç–æ `99000 < 100000`)
- `get_stop_loss()`:
  - –ü—Ä–æ–≤–µ—Ä–∫–∞: `if self.lowest_price < float("inf") and self.lowest_price < self.entry_price:` ‚Üí TRUE
  - `stop_loss = self.lowest_price * (1 + self.current_trail) = 99000 * (1 + 0.005) = 99495`
  - `max_stop = entry_price * (1 - self.initial_trail) = 100000 * (1 - 0.005) = 99500`
  - `stop_loss = min(stop_loss, max_stop) = min(99495, 99500) = 99495`
- –°—Ç–æ–ø –æ–ø—É—Å–∫–∞–µ—Ç—Å—è –≤–º–µ—Å—Ç–µ —Å —Ü–µ–Ω–æ–π ‚úÖ
- –ù–æ —Å—Ç–æ–ø –≤—Å–µ –µ—â–µ –ù–ò–ñ–ï entry_price! –≠—Ç–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ!

---

## ‚ùå –ù–ê–ô–î–ï–ù–ù–´–ï –ü–†–û–ë–õ–ï–ú–´

### 1. ‚ùå –°—Ç–æ–ø –¥–ª—è SHORT —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ù–ò–ñ–ï entry_price

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –î–ª—è SHORT —Å—Ç–æ–ø –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –í–´–®–ï entry_price –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç —Ä–æ—Å—Ç–∞
- –¢–µ–∫—É—â–∞—è –ª–æ–≥–∏–∫–∞ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å—Ç–æ–ø –ù–ò–ñ–ï entry_price
- –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —Å—Ç–æ–ø –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –ø—Ä–∏–±—ã–ª—å–Ω–æ–π –∑–æ–Ω–µ, –∞ –Ω–µ –≤ —É–±—ã—Ç–æ—á–Ω–æ–π!

**–ü—Ä–∏–º–µ—Ä:**
- Entry: 100000
- –°—Ç–æ–ø: 99500 (–Ω–∏–∂–µ entry)
- –ï—Å–ª–∏ —Ü–µ–Ω–∞ = 99500, —ç—Ç–æ –ü–†–ò–ë–´–õ–¨ –¥–ª—è SHORT (100000 - 99500 = 500)
- –°—Ç–æ–ø –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞ 100500 (–≤—ã—à–µ entry) –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç —Ä–æ—Å—Ç–∞!

---

### 2. ‚ùå –õ–æ–≥–∏–∫–∞ get_stop_loss() –¥–ª—è SHORT –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è

**–¢–µ–∫—É—â–∞—è –ª–æ–≥–∏–∫–∞:**
```python
if self.lowest_price < float("inf") and self.lowest_price < self.entry_price:
    stop_loss = self.lowest_price * (1 + self.current_trail)
    max_stop = self.entry_price * (1 - self.initial_trail)  # ‚ùå –ù–ò–ñ–ï entry!
    stop_loss = min(stop_loss, max_stop)
else:
    stop_loss = self.entry_price * (1 - self.current_trail)  # ‚ùå –ù–ò–ñ–ï entry!
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –û–±–µ –≤–µ—Ç–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç —Å—Ç–æ–ø –ù–ò–ñ–ï entry_price
- –î–ª—è SHORT —Å—Ç–æ–ø –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –í–´–®–ï entry_price!

---

## ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–ê–Ø –õ–û–ì–ò–ö–ê –î–õ–Ø SHORT

### –î–ª—è SHORT –ø–æ–∑–∏—Ü–∏–∏:

1. **–ü—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:**
   - –°—Ç–æ–ø –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –í–´–®–ï entry_price –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç —Ä–æ—Å—Ç–∞
   - `stop_loss = entry_price * (1 + initial_trail)`
   - –ü—Ä–∏–º–µ—Ä: `100000 * (1 + 0.005) = 100500`

2. **–ï—Å–ª–∏ —Ü–µ–Ω–∞ –∏–¥–µ—Ç –í–ù–ò–ó (–≤ –ø—Ä–∏–±—ã–ª—å):**
   - –°—Ç–æ–ø –¥–æ–ª–∂–µ–Ω –æ–ø—É—Å–∫–∞—Ç—å—Å—è –≤–º–µ—Å—Ç–µ —Å —Ü–µ–Ω–æ–π
   - –ù–æ —Å—Ç–æ–ø –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∏–∂–µ entry_price
   - `stop_loss = max(lowest_price * (1 + trail), entry_price * (1 + initial_trail))`

3. **–ï—Å–ª–∏ —Ü–µ–Ω–∞ –∏–¥–µ—Ç –í–í–ï–†–• (–ø—Ä–æ—Ç–∏–≤ –ø–æ–∑–∏—Ü–∏–∏):**
   - –°—Ç–æ–ø –Ω–µ –¥–æ–ª–∂–µ–Ω –ø–æ–¥–Ω–∏–º–∞—Ç—å—Å—è (–æ—Å—Ç–∞–µ—Ç—Å—è –Ω–∞ –º–µ—Å—Ç–µ)
   - –ü–æ–∑–∏—Ü–∏—è –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è, –∫–æ–≥–¥–∞ —Ü–µ–Ω–∞ –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è –≤—ã—à–µ —Å—Ç–æ–ø–∞

---

## üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï

### –ù—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –ª–æ–≥–∏–∫—É get_stop_loss() –¥–ª—è SHORT:

```python
else:  # short
    # ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–ê–Ø –õ–û–ì–ò–ö–ê: –°—Ç–æ–ø –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –í–´–®–ï entry_price
    # –ü—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: —Å—Ç–æ–ø = entry_price * (1 + trail%) (–≤—ã—à–µ entry)
    # –ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è: –µ—Å–ª–∏ —Ü–µ–Ω–∞ —É–ø–∞–ª–∞ (lowest_price < entry_price), —Å—Ç–æ–ø —Å–ª–µ–¥—É–µ—Ç –∑–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π —Ü–µ–Ω–æ–π (–æ–ø—É—Å–∫–∞–µ—Ç—Å—è)
    # –ù–æ —Å—Ç–æ–ø –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∏–∂–µ entry_price * (1 + initial_trail)
    
    if self.lowest_price < float("inf") and self.lowest_price < self.entry_price:
        # –¶–µ–Ω–∞ —É–ø–∞–ª–∞ –Ω–∏–∂–µ entry - —Å—Ç–æ–ø —Å–ª–µ–¥—É–µ—Ç –∑–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π —Ü–µ–Ω–æ–π (–æ–ø—É—Å–∫–∞–µ—Ç—Å—è)
        # –°—Ç–æ–ø = lowest_price * (1 + trail%) (–∑–∞—â–∏—Ç–∞ –æ—Ç –æ—Ç—Å–∫–æ–∫–∞)
        stop_loss = self.lowest_price * (1 + self.current_trail)
        # ‚úÖ –ó–ê–©–ò–¢–ê: —Å—Ç–æ–ø –Ω–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∏–∂–µ entry * (1 + initial_trail)
        # –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ —Å—Ç–æ–ø –≤—Å–µ–≥–¥–∞ –≤—ã—à–µ entry –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
        min_stop = self.entry_price * (1 + self.initial_trail)
        stop_loss = max(stop_loss, min_stop)
    else:
        # –¶–µ–Ω–∞ –µ—â–µ –Ω–µ —É–ø–∞–ª–∞ –Ω–∏–∂–µ entry –∏–ª–∏ —ç—Ç–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è - —Å—Ç–æ–ø –≤—ã—à–µ entry
        # –°—Ç–æ–ø = entry_price * (1 + trail%) (–∑–∞—â–∏—Ç–∞ –æ—Ç —Ä–æ—Å—Ç–∞)
        stop_loss = self.entry_price * (1 + self.current_trail)
    
    return stop_loss
```

---

## üìã –ò–¢–û–ì–û–í–´–ô –í–´–í–û–î

1. ‚úÖ **LONG –ø–æ–∑–∏—Ü–∏—è:** –õ–æ–≥–∏–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è
2. ‚ùå **SHORT –ø–æ–∑–∏—Ü–∏—è:** –õ–æ–≥–∏–∫–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è - —Å—Ç–æ–ø —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ù–ò–ñ–ï entry_price –≤–º–µ—Å—Ç–æ –í–´–®–ï
3. ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –ò–∑–º–µ–Ω–∏—Ç—å –ª–æ–≥–∏–∫—É get_stop_loss() –¥–ª—è SHORT, —á—Ç–æ–±—ã —Å—Ç–æ–ø –±—ã–ª –í–´–®–ï entry_price

---

## üîß –ü–†–ò–û–†–ò–¢–ï–¢ –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

**–ö–†–ò–¢–ò–ß–ï–°–ö–û–ï:** –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É get_stop_loss() –¥–ª—è SHORT –ø–æ–∑–∏—Ü–∏–π

