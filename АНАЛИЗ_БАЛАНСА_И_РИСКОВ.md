# –ê–Ω–∞–ª–∏–∑: Balance & Risk Management –≤ Futures

## üéØ –ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ:

### 1. ‚úÖ Balance Profiles (3 –ø—Ä–æ—Ñ–∏–ª—è)
```yaml
balance_profiles:
  small:  # $100 - $1500
    base_position_usd: 50.0
    min_position_usd: 10.0
    max_position_usd: 100.0
  
  medium:  # $1500 - $3000
    base_position_usd: 200.0
    min_position_usd: 30.0
    max_position_usd: 250.0
  
  large:  # $3000+
    base_position_usd: 500.0
    min_position_usd: 50.0
    max_position_usd: 500.0
```

---

## üìä –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:

### –®–∞–≥ 1: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –±–∞–ª–∞–Ω—Å–∞
```python
def _get_balance_profile(self, balance):
    if balance <= 1500:
        return "small"  # $50 base
    elif balance <= 3000:
        return "medium"  # $200 base
    else:
        return "large"  # $500 base
```

**–ü—Ä–∏–º–µ—Ä—ã:**
- $500 ‚Üí small ‚Üí $50 –±–∞–∑–æ–≤–∞—è –ø–æ–∑–∏—Ü–∏—è
- $2000 ‚Üí medium ‚Üí $200 –±–∞–∑–æ–≤–∞—è –ø–æ–∑–∏—Ü–∏—è
- $5000 ‚Üí large ‚Üí $500 –±–∞–∑–æ–≤–∞—è –ø–æ–∑–∏—Ü–∏—è

---

### –®–∞–≥ 2: –†–µ–∂–∏–º —Ä—ã–Ω–∫–∞ (ARM)
```python
# –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–µ–∂–∏–º
regime = ARM.get_current_regime()  # trending/ranging/choppy

# –ü–æ–ª—É—á–∞–µ–º –º–Ω–æ–∂–∏—Ç–µ–ª—å —Ä–µ–∂–∏–º–∞
if regime == "trending":
    multiplier = 1.2  # +20% –≤ —Ç—Ä–µ–Ω–¥–µ
elif regime == "ranging":
    multiplier = 1.0  # –°—Ç–∞–Ω–¥–∞—Ä—Ç –≤–æ —Ñ–ª—ç—Ç–µ
else:  # choppy
    multiplier = 0.7  # -30% –≤ —Ö–∞–æ—Å–µ

base_usd *= multiplier
```

---

### –®–∞–≥ 3: –°–∏–ª–∞ —Å–∏–≥–Ω–∞–ª–∞
```python
signal_strength = signal.get("strength", 0.5)

if strength > 0.8:
    multiplier = 1.5  # –û—á–µ–Ω—å —Å–∏–ª—å–Ω—ã–π
elif strength > 0.6:
    multiplier = 1.2  # –•–æ—Ä–æ—à–∏–π
elif strength > 0.4:
    multiplier = 1.0  # –°—Ä–µ–¥–Ω–∏–π
else:
    multiplier = 0.8  # –°–ª–∞–±—ã–π

base_usd *= multiplier
```

---

## üßÆ –ü–†–ò–ú–ï–†–´ –†–ê–°–ß–ï–¢–û–í:

### –ü—Ä–∏–º–µ—Ä 1: –ú–∞–ª–µ–Ω—å–∫–∏–π –±–∞–ª–∞–Ω—Å + —Ç—Ä–µ–Ω–¥ + —Å–∏–ª—å–Ω—ã–π —Å–∏–≥–Ω–∞–ª
```
–ë–∞–ª–∞–Ω—Å: $500
–†–µ–∂–∏–º: trending
–°–∏–≥–Ω–∞–ª: strength=0.9

1. –ü—Ä–æ—Ñ–∏–ª—å: small ‚Üí $50 –±–∞–∑–æ–≤–∞—è
2. –†–µ–∂–∏–º: trending ‚Üí √ó1.2 ‚Üí $60
3. –°–∏–≥–Ω–∞–ª: —Å–∏–ª—å–Ω—ã–π ‚Üí √ó1.5 ‚Üí $90
4. –ü—Ä–∏–º–µ–Ω—è–µ–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è: min=$10, max=$100
5. –ò—Ç–æ–≥: $90 (–≤ –ø—Ä–µ–¥–µ–ª–∞—Ö)

ETH @ $4000: $90 / $4000 = 0.0225 ETH
```

### –ü—Ä–∏–º–µ—Ä 2: –°—Ä–µ–¥–Ω–∏–π –±–∞–ª–∞–Ω—Å + —Ñ–ª—ç—Ç + —Å–ª–∞–±—ã–π —Å–∏–≥–Ω–∞–ª
```
–ë–∞–ª–∞–Ω—Å: $2000
–†–µ–∂–∏–º: ranging
–°–∏–≥–Ω–∞–ª: strength=0.3

1. –ü—Ä–æ—Ñ–∏–ª—å: medium ‚Üí $200 –±–∞–∑–æ–≤–∞—è
2. –†–µ–∂–∏–º: ranging ‚Üí √ó1.0 ‚Üí $200
3. –°–∏–≥–Ω–∞–ª: —Å–ª–∞–±—ã–π ‚Üí √ó0.8 ‚Üí $160
4. –ü—Ä–∏–º–µ–Ω—è–µ–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è: min=$30, max=$250
5. –ò—Ç–æ–≥: $160 (–≤ –ø—Ä–µ–¥–µ–ª–∞—Ö)

ETH @ $4000: $160 / $4000 = 0.04 ETH
```

### –ü—Ä–∏–º–µ—Ä 3: –ë–æ–ª—å—à–æ–π –±–∞–ª–∞–Ω—Å + —Ö–∞–æ—Å + —Å–ª–∞–±—ã–π —Å–∏–≥–Ω–∞–ª
```
–ë–∞–ª–∞–Ω—Å: $5000
–†–µ–∂–∏–º: choppy
–°–∏–≥–Ω–∞–ª: strength=0.2

1. –ü—Ä–æ—Ñ–∏–ª—å: large ‚Üí $500 –±–∞–∑–æ–≤–∞—è
2. –†–µ–∂–∏–º: choppy ‚Üí √ó0.7 ‚Üí $350
3. –°–∏–≥–Ω–∞–ª: –æ—á–µ–Ω—å —Å–ª–∞–±—ã–π ‚Üí √ó0.8 ‚Üí $280
4. –ü—Ä–∏–º–µ–Ω—è–µ–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è: min=$50, max=$500
5. –ò—Ç–æ–≥: $280 (–≤ –ø—Ä–µ–¥–µ–ª–∞—Ö)

BTC @ $100000: $280 / $100000 = 0.0028 BTC
```

---

## ‚ö†Ô∏è –ü–†–û–ë–õ–ï–ú–ê: –ù–ï–¢ –£–ß–ï–¢–ê –õ–ï–í–ï–†–ò–î–ñ–ê!

### –¢–µ–∫—É—â–∏–π —Ä–∞—Å—á–µ—Ç:
```python
position_size = usd_size / price  # –ü—Ä–æ—Å—Ç–æ–π —Ä–∞—Å—á–µ—Ç
```

### –ü–†–ê–í–ò–õ–¨–ù–û –¥–ª—è Futures:
```python
# Futures —Å –ª–µ–≤–µ—Ä–∏–¥–∂–µ–º 3x
notional_value = usd_size * leverage  # –ù–æ–º–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å
position_size = notional_value / price

# –ù–æ –Ω—É–∂–Ω–æ —É—á–µ—Å—Ç—å:
margin_required = usd_size / leverage  # –†–µ–∞–ª—å–Ω–∞—è –º–∞—Ä–∂–∞
max_notional = balance * leverage * 5  # 5x –∫–µ—Ñ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
```

---

## üîß –ß—Ç–æ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:

### 1. –£—á–µ—Ç –ª–µ–≤–µ—Ä–∏–¥–∂–∞ –≤ —Ä–∞—Å—á–µ—Ç–µ —Ä–∞–∑–º–µ—Ä–∞
```python
def _calculate_position_size(self, balance, price, signal):
    # 1. Balance Profile
    balance_profile = self._get_balance_profile(balance)
    base_usd = balance_profile["base_position_usd"]
    
    # 2. –†–µ–∂–∏–º —Ä—ã–Ω–∫–∞
    regime_multiplier = self._get_regime_multiplier()
    base_usd *= regime_multiplier
    
    # 3. –°–∏–ª–∞ —Å–∏–≥–Ω–∞–ª–∞
    strength_multiplier = self._get_strength_multiplier(signal)
    base_usd *= strength_multiplier
    
    # 4. –ù–û–í–û–ï: –£—á–µ—Ç –ª–µ–≤–µ—Ä–∏–¥–∂–∞
    leverage = 3  # Futures leverage
    notional_usd = base_usd * leverage  # –ù–æ–º–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å
    margin_required = base_usd  # –ú–∞—Ä–∂–∞
    
    # 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∞—Ä–∂–∏
    if margin_required > balance * 0.9:  # 90% –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
        logger.warning("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–∞—Ä–∂–∏!")
        return 0.0
    
    # 6. –ü–µ—Ä–µ–≤–æ–¥–∏–º –≤ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
    position_size = notional_usd / price
    
    return position_size
```

### 2. –†–∏—Å–∫-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç
```python
# Max loss per trade
max_loss_usd = balance * 0.02  # 2% –º–∞–∫—Å –ø–æ—Ç–µ—Ä—è –Ω–∞ —Å–¥–µ–ª–∫—É

# –†–∞—Å—á–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞
if side == "buy":
    sl_distance = entry_price - sl_price  # –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ SL
    max_position_size = max_loss_usd / sl_distance

# –ü—Ä–æ–≤–µ—Ä–∫–∞
if position_size > max_position_size:
    logger.warning("–†–∞–∑–º–µ—Ä —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π!")
    position_size = max_position_size
```

---

## üéØ –ò–¢–û–ì: –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç vs –ß—Ç–æ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å

### ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç:
1. ‚úÖ Balance Profiles (small/medium/large)
2. ‚úÖ Regime multiplier (trending/ranging/choppy)
3. ‚úÖ Strength multiplier (—Å–∏–ª—å–Ω—ã–π/—Å–ª–∞–±—ã–π —Å–∏–≥–Ω–∞–ª)
4. ‚úÖ Min/Max –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### ‚ùå –ù–ï –†–ê–ë–û–¢–ê–ï–¢:
1. ‚ùå –£—á–µ—Ç –ª–µ–≤–µ—Ä–∏–¥–∂–∞ –≤ —Ä–∞—Å—á–µ—Ç–µ
2. ‚ùå –†–∞—Å—á–µ—Ç –º–∞—Ä–∂–∏
3. ‚ùå Max loss per trade
4. ‚ùå –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∞—Ä–∂–∏ –Ω–∞ —Å—á–µ—Ç—É

---

## üö® –ö–†–ò–¢–ò–ß–ù–û!

**–ë–µ–∑ —É—á–µ—Ç–∞ –ª–µ–≤–µ—Ä–∏–¥–∂–∞:**
- –ë–æ—Ç –º–æ–∂–µ—Ç –æ—Ç–∫—Ä—ã—Ç—å –ø–æ–∑–∏—Ü–∏—é > –¥–æ—Å—Ç—É–ø–Ω–æ–π –º–∞—Ä–∂–∏
- –†–∏—Å–∫ –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏!
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–∞!

**–ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:**
```python
# –í _calculate_position_size:
leverage = 3
notional_usd = base_usd * leverage
margin_required = base_usd
max_notional = balance * leverage * 0.5  # –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
```

**–î–æ–±–∞–≤–ª—è–µ–º?** ü§î


