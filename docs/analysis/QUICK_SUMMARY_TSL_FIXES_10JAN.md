# üéØ –ò–¢–û–ì–û–í–´–ô –û–¢–ß–ï–¢: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è TSL price=0 - 10 —è–Ω–≤–∞—Ä—è 2026

## üìå –†–ï–®–ï–ù–ò–ï –í –û–î–ù–û–ô –§–†–ê–ó–ï

**–î–æ–±–∞–≤–ª–µ–Ω–∞ –∏–µ—Ä–∞—Ä—Ö–∏—è fallback –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö —Å —Ñ–∏–Ω–∞–ª—å–Ω—ã–º fallback –Ω–∞ `entry_price`, —á—Ç–æ–±—ã –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–∞–ª–∏–¥–Ω—É—é —Ü–µ–Ω—É –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ PnL –∏ loss_cut.**

---

## üî¥ –ü–†–û–ë–õ–ï–ú–ê (–ë—ã–ª–∞)

```
üîç TSL_CHECK: XRP-USDT | profit=4.0000 | price=0.0000 | close=False ‚ùå
üîç TSL_CHECK: SOL-USDT | profit=4.0000 | price=0.0000 | close=False ‚ùå

–†–µ–∞–ª—å–Ω—ã–π —É–±—ã—Ç–æ–∫: XRP -1.39%, SOL -4.57%
Loss_cut –ø–æ—Ä–æ–≥: -0.4%
Loss_cut –ø—Ä–æ–≤–µ—Ä–∫–∞: 4.0% > -0.4% ‚Üí ‚ùå –ù–ï –∑–∞–∫—Ä—ã–≤–∞–µ—Ç

–†–ï–ó–£–õ–¨–¢–ê–¢: –ü–æ–∑–∏—Ü–∏–∏ –ù–ï –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ —É–±—ã—Ç–æ–∫ > –ø–æ—Ä–æ–≥–∞!
```

### –ü—Ä–∏—á–∏–Ω–∞:
- `_get_current_price()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `0.0` –∫–æ–≥–¥–∞ –≤—Å–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã
- `get_profit_pct()` –ø—Ä–∏ `price=0` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç fallback `4.0%` (–Ω–µ —Ä–µ–∞–ª—å–Ω—ã–π PnL)
- Loss_cut –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `4.0% > -0.4%` –≤–º–µ—Å—Ç–æ —Ä–µ–∞–ª—å–Ω–æ–≥–æ `-1.39% < -0.4%`

---

## ‚úÖ –†–ï–®–ï–ù–ò–ï (–¢–µ–ø–µ—Ä—å)

### 1Ô∏è‚É£ –ò–µ—Ä–∞—Ä—Ö–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ü–µ–Ω—ã (5 —É—Ä–æ–≤–Ω–µ–π):

```
–ü–†–ò–û–†–ò–¢–ï–¢ 1: WebSocket (DataRegistry.current_tick) - <100ms
    ‚Üì (–µ—Å–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞)
–ü–†–ò–û–†–ò–¢–ï–¢ 2: Last Candle (DataRegistry.ohlcv_data) - <1s
    ‚Üì (–µ—Å–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞)
–ü–†–ò–û–†–ò–¢–ï–¢ 3: REST API callback (get_current_price_callback) - <2s
    ‚Üì (–µ—Å–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞)
–ü–†–ò–û–†–ò–¢–ï–¢ 4: REST API client (_fetch_price_via_client) - <3s
    ‚Üì (–µ—Å–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞)
–ü–†–ò–û–†–ò–¢–ï–¢ 5: Entry Price (position.entry_price) - <1ms ‚úÖ –ù–û–í–û–ï!
    ‚Üì (–µ—Å–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞)
‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê (–≤–µ—Ä–Ω—É—Ç—å None)
```

### 2Ô∏è‚É£ –ó–∞—â–∏—Ç–∞ –≤ get_profit_pct():

```python
if current_price <= 0:
    current_price = self.entry_price  # Fallback
    # –¢–µ–ø–µ—Ä—å profit_pct —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
```

### 3Ô∏è‚É£ –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–µ—Ä–µ–¥ should_close_position():

```python
if current_price <= 0:
    current_price = entry_price  # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
    if current_price <= 0:
        return  # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É
```

---

## üìä –†–ï–ó–£–õ–¨–¢–ê–¢

```
üî¥ –ë–´–õ–û:
  profit=4.0000% | price=0.0000 ‚Üí Loss_cut: 4.0% > -0.4% ‚Üí ‚ùå –ù–µ –∑–∞–∫—Ä—ã—Ç—å

‚úÖ –°–¢–ê–õ–û:
  profit=-1.3900% | price=2.0887 ‚Üí Loss_cut: -1.39% < -0.4% ‚Üí ‚úÖ –ó–ê–ö–†–´–¢–¨!
  profit=-4.5700% | price=135.73 ‚Üí Loss_cut: -4.57% < -0.4% ‚Üí ‚úÖ –ó–ê–ö–†–´–¢–¨!
```

---

## üìù –§–ê–ô–õ–´ –ò–ó–ú–ï–ù–ï–ù–´

| –§–∞–π–ª | –ò–∑–º–µ–Ω–µ–Ω–∏–µ | –°—Ç—Ä–æ–∫–∞ |
|------|-----------|--------|
| `trailing_sl_coordinator.py` | –î–æ–±–∞–≤–ª–µ–Ω fallback –Ω–∞ entry_price | ~1820 |
| `trailing_stop_loss.py` | –ó–∞—â–∏—Ç–∞ –æ—Ç price=0 | ~445 |
| `trailing_sl_coordinator.py` | –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–µ—Ä–µ–¥ should_close | ~1264 |

**–°–∏–Ω—Ç–∞–∫—Å–∏—Å:** ‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω (–æ—à–∏–±–æ–∫ –Ω–µ—Ç)

---

## üöÄ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

### ‚úÖ –ù–∞ —á—Ç–æ —Å–º–æ—Ç—Ä–µ—Ç—å –≤ –ª–æ–≥–∞—Ö:

```
–ù–û–†–ú–ê–õ–¨–ù–û:
  "‚úÖ TSL: WebSocket real-time price for BTC-USDT: 91955.00"
  "‚ö†Ô∏è TSL: Using REST API callback for XRP-USDT: 2.0955"

FALLBACK –Ω–∞ entry_price (–∑–Ω–∞—á–∏—Ç —Å–µ—Ä—å–µ–∑–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞!):
  "üî¥ TSL: –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô FALLBACK - –∏—Å–ø–æ–ª—å–∑—É–µ–º entry_price=2.0887 –¥–ª—è XRP-USDT"
  
–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô FALLBACK (–≤—Å–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã):
  "üî¥ TSL: –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê - –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Ü–µ–Ω—É..."
```

### üß™ –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç:

1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ–±—ã loss_cut **–∑–∞–∫—Ä—ã–≤–∞–ª —É–±—ã—Ç–æ—á–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏**
3. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –ª–æ–≥–∏ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç `price=0.0000`

---

## üí° –ü–û–ß–ï–ú–£ –≠–¢–û –†–ê–ë–û–¢–ê–ï–¢

| –ü—Ä–æ–±–ª–µ–º–∞ | –†–µ—à–µ–Ω–∏–µ | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|----------|---------|-----------|
| price=0 –ø—Ä–∏ WebSocket –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ–º | Fallback –Ω–∞ REST API | –ü–æ–ª—É—á–∞–µ–º —Ü–µ–Ω—É < 1s |
| price=0 –ø—Ä–∏ –≤—Å–µ—Ö API –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã—Ö | Fallback –Ω–∞ entry_price | –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –µ—Å—Ç—å —Ü–µ–Ω–∞ |
| profit=4.0% fallback | –ó–∞—â–∏—Ç–∞ –≤ get_profit_pct() | –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∞–ª—å–Ω—ã–π PnL |
| Loss_cut –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç | –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–µ—Ä–µ–¥ should_close | –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π |

---

## üìã –ß–ï–ö–õ–ò–°–¢

- ‚úÖ –°–∏–Ω—Ç–∞–∫—Å–∏—Å –ø—Ä–æ–≤–µ—Ä–µ–Ω
- ‚úÖ –õ–æ–≥–∏–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞
- ‚úÖ Fallbacks –¥–æ–±–∞–≤–ª–µ–Ω—ã
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ
- ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ó–ê–í–ï–†–®–ï–ù–û –ò –ì–û–¢–û–í–û**  
**–í—Ä–µ–º—è –Ω–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** ~15 –º–∏–Ω—É—Ç  
**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** üî¥ **–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø** (–≤–ª–∏—è–µ—Ç –Ω–∞ risk management)

