# ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è Profit Harvesting (29.11.2025)

## üéØ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ `_check_profit_harvesting`:

#### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ #1: –ù–∞—á–∞–ª–æ –ø—Ä–æ–≤–µ—Ä–∫–∏
```python
logger.debug(
    f"üîç PH –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª—è {symbol}: –Ω–∞—á–∞–ª–æ | "
    f"size={size}, side={side}, entry={entry_price:.4f}, current={current_price:.4f}"
)
```

#### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ #2: –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
```python
logger.debug(
    f"üîç PH –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è {symbol} (regime={market_regime or 'ranging'}): "
    f"enabled={ph_enabled}, threshold=${ph_threshold:.2f}, "
    f"time_limit={ph_time_limit}—Å, min_holding={config_min_holding}"
)
```

#### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ #3: –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–∫—Ä—ã—Ç–∏—è
```python
logger.debug(
    f"üîç PH –¥–ª—è {symbol}: entry_time –∏–∑ –ø–æ–∑–∏—Ü–∏–∏: {entry_time_str}"
)
# –ò–ª–∏ –∏–∑ active_positions
logger.debug(
    f"üîç PH –¥–ª—è {symbol}: entry_time –∏–∑ active_positions: {entry_time_str}"
)
```

#### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ #4: –í—Ä–µ–º—è –≤ –ø–æ–∑–∏—Ü–∏–∏
```python
logger.debug(
    f"üîç PH –¥–ª—è {symbol}: –≤—Ä–µ–º—è –≤ –ø–æ–∑–∏—Ü–∏–∏ {time_since_open:.1f}—Å "
    f"({time_since_open/60:.1f} –º–∏–Ω), entry_timestamp={entry_timestamp}"
)
```

#### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ #5: –†–∞—Å—á–µ—Ç PnL
```python
logger.debug(
    f"üîç PH –¥–ª—è {symbol}: PnL —Ä–∞—Å—á–µ—Ç | "
    f"gross=${pnl_usd:.4f}, commission=${commission:.4f}, "
    f"net=${net_pnl_usd:.4f}, threshold=${ph_threshold:.2f}"
)
```

#### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ #6: –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π
```python
logger.debug(
    f"‚úÖ PH –¥–ª—è {symbol}: –£—Å–ª–æ–≤–∏–µ —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–æ–π –ø—Ä–∏–±—ã–ª–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ"
)
# –ò–ª–∏
logger.debug(
    f"‚ùå PH –¥–ª—è {symbol}: –ü—Ä–∏–±—ã–ª—å –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞ –∏–ª–∏ –ø—Ä–µ–≤—ã—à–µ–Ω time_limit"
)
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ —Ç–æ—á–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –Ω–∞ –∫–∞–∫–æ–º —ç—Ç–∞–ø–µ –º–µ—Ç–æ–¥ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `False`.

### 2. ‚úÖ –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

#### –ß—Ç–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥–∞:
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ, –µ—Å–ª–∏ `regime_config` –Ω–µ –Ω–∞–π–¥–µ–Ω
- –£–ª—É—á—à–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ —Å `exc_info=True`

#### –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–∫—Ä—ã—Ç–∏—è:
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–ø—ã—Ç–æ–∫ –ø–æ–ª—É—á–µ–Ω–∏—è `entry_time`
- –£–ª—É—á—à–µ–Ω–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–∫—Ä—ã—Ç–∏—è

#### –†–∞—Å—á–µ—Ç PnL:
- –£–ª—É—á—à–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ —Å `exc_info=True`

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –û—à–∏–±–∫–∏ —Ç–µ–ø–µ—Ä—å –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å –ø–æ–ª–Ω—ã–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º.

### 3. ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

#### –ü–æ—Ä–æ–≥ —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–æ–π –ø—Ä–∏–±—ã–ª–∏:
- **–ë—ã–ª–æ:** 2x –ø–æ—Ä–æ–≥–∞ (0.30 USDT –¥–ª—è ranging)
- **–°—Ç–∞–ª–æ:** 1.5x –ø–æ—Ä–æ–≥–∞ (0.225 USDT –¥–ª—è ranging)
- **–≠—Ñ—Ñ–µ–∫—Ç:** –ë–æ–ª—å—à–µ –ø–æ–∑–∏—Ü–∏–π –±—É–¥—É—Ç —Å—á–∏—Ç–∞—Ç—å—Å—è —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã–º–∏ –∏ –∑–∞–∫—Ä—ã–≤–∞—Ç—å—Å—è –±—ã—Å—Ç—Ä–µ–µ

#### ph_time_limit –¥–ª—è ranging:
- **–ë—ã–ª–æ:** 120 —Å–µ–∫—É–Ω–¥ (2 –º–∏–Ω—É—Ç—ã)
- **–°—Ç–∞–ª–æ:** 300 —Å–µ–∫—É–Ω–¥ (5 –º–∏–Ω—É—Ç)
- **–≠—Ñ—Ñ–µ–∫—Ç:** –ë–æ–ª—å—à–µ –ø–æ–∑–∏—Ü–∏–π –±—É–¥—É—Ç –∑–∞–∫—Ä—ã–≤–∞—Ç—å—Å—è –ø–æ –æ–±—ã—á–Ω–æ–π –ø—Ä–∏–±—ã–ª–∏

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ë–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏–±—ã–ª—å–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π.

## üìä –û–∂–∏–¥–∞–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
- –£–ø—É—â–µ–Ω–Ω–∞—è –ø—Ä–∏–±—ã–ª—å: **9.79 USDT**
- –ó–∞–∫—Ä—ã—Ç–∏–π –ø–æ PH: **0**
- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: **0%**

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π (–ø—Ä–æ–≥–Ω–æ–∑):
- –£–ø—É—â–µ–Ω–Ω–∞—è –ø—Ä–∏–±—ã–ª—å: **1-2 USDT** (—Å–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞ 80-90%)
- –ó–∞–∫—Ä—ã—Ç–∏–π –ø–æ PH: **20-40 –∑–∞ –¥–µ–Ω—å**
- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: **70-90%**
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–∏–±—ã–ª—å: **7-8 USDT –≤ –¥–µ–Ω—å**

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

–¢–µ–ø–µ—Ä—å –≤ –ª–æ–≥–∞—Ö –±—É–¥–µ—Ç –≤–∏–¥–Ω–æ:
1. –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ª–∏ –º–µ—Ç–æ–¥ `_check_profit_harvesting`
2. –ö–∞–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —á–∏—Ç–∞—é—Ç—Å—è –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
3. –£–¥–∞–µ—Ç—Å—è –ª–∏ –ø–æ–ª—É—á–∏—Ç—å –≤—Ä–µ–º—è –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏
4. –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ª–∏ PnL –ø—Ä–∞–≤–∏–ª—å–Ω–æ
5. –ö–∞–∫–∏–µ —É—Å–ª–æ–≤–∏—è –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –∏ –ø–æ—á–µ–º—É –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç

## üìù –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

1. **src/strategies/scalping/futures/position_manager.py**
   - –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (6 —Ç–æ—á–µ–∫)
   - –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
   - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –ø–æ—Ä–æ–≥ —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–æ–π –ø—Ä–∏–±—ã–ª–∏ (1.5x –≤–º–µ—Å—Ç–æ 2x)

2. **config/config_futures.yaml**
   - –£–≤–µ–ª–∏—á–µ–Ω `ph_time_limit` –¥–ª—è ranging: 120 ‚Üí 300 —Å–µ–∫

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞ —Å –Ω–æ–≤—ã–º–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏
2. –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π "üîç PH –ø—Ä–æ–≤–µ—Ä–∫–∞"
3. –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å, –Ω–∞ –∫–∞–∫–æ–º —ç—Ç–∞–ø–µ –º–µ—Ç–æ–¥ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `False` (–µ—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è)
4. –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

## ‚ö†Ô∏è –í–∞–∂–Ω–æ

–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é. –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–º–æ–∂–µ—Ç –±—ã—Å—Ç—Ä–æ –Ω–∞–π—Ç–∏ –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –ø—Ä–æ–±–ª–µ–º—ã, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å.

