# –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã: –ø–æ–∑–∏—Ü–∏—è –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ PnL +0.40

## üîç –ü—Ä–æ–±–ª–µ–º–∞:

**–°–∏—Ç—É–∞—Ü–∏—è:**
- PnL –¥–æ—Ö–æ–¥–∏—Ç –¥–æ **+0.40** (—ç—Ç–æ –ø—Ä–∏–º–µ—Ä–Ω–æ **0.4%** –æ—Ç –ø–æ–∑–∏—Ü–∏–∏ $100)
- **TP —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω:** 0.4% (0.4 –≤ –∫–æ–Ω—Ñ–∏–≥–µ)
- **–°–¥–µ–ª–∫–∞ –ù–ï –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è**

---

## üêõ –ù–ê–ô–î–ï–ù–ù–ê–Ø –ü–†–û–ë–õ–ï–ú–ê:

### **–ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –µ–¥–∏–Ω–∏—Ü –∏–∑–º–µ—Ä–µ–Ω–∏—è!**

**–í `_check_tp_only` (position_manager.py, —Å—Ç—Ä–æ–∫–∞ 284):**
```python
pnl_percent = (current_price - entry_price) / entry_price * 100
# –ü—Ä–∏–º–µ—Ä: ($3915.6 - $3900) / $3900 * 100 = 15.6 / 3900 * 100 = 0.4 (—ç—Ç–æ 0.4%)
```

**–í –∫–æ–Ω—Ñ–∏–≥–µ:**
```yaml
tp_percent: 0.4  # –≠—Ç–æ 0.4% (–≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö)
```

**–°—Ä–∞–≤–Ω–µ–Ω–∏–µ:**
```python
if pnl_percent >= tp_percent:  # 0.4 >= 0.4 ‚úÖ –î–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å!
```

**–ù–û!** –ï—Å–ª–∏ `tp_percent` –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ **40%** (0.4 = 40% –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö), —Ç–æ:
- `pnl_percent = 0.4` (0.4%)
- `tp_percent = 0.4` (–∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ 40%)
- `0.4 >= 0.4` ‚úÖ (–Ω–æ `0.4% >= 40%` ‚ùå - –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç!)

---

## üí° –†–ï–ê–õ–¨–ù–ê–Ø –ü–†–û–ë–õ–ï–ú–ê:

### **TrailingSL –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∑–∞–∫—Ä—ã—Ç–∏–µ!**

**–õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã:**

1. **TrailingSL –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ** –≤ `_update_trailing_stop_loss`
2. **TrailingSL –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –¢–û–õ–¨–ö–û –∫–æ–≥–¥–∞ —Ü–µ–Ω–∞ <= stop_loss**
3. **–ù–û TrailingSL –ù–ï –ó–ê–ö–†–´–í–ê–ï–¢ –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ TP!**
4. **–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π TP –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è** –≤ `_check_tp_only` –∏–∑ `manage_position`

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ï—Å–ª–∏ –ø–æ–∑–∏—Ü–∏—è –≤ –ø—Ä–∏–±—ã–ª–∏ (profit_pct > 0)
- –ò —Ü–µ–Ω–∞ –≤—ã—à–µ trailing stop
- TrailingSL –ù–ï –∑–∞–∫—Ä—ã–≤–∞–µ—Ç
- **–ù–û —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π TP —Ç–æ–∂–µ –º–æ–∂–µ—Ç –Ω–µ —Å—Ä–∞–±–æ—Ç–∞—Ç—å**, –µ—Å–ª–∏:
  - `manage_position` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ä–µ–¥–∫–æ
  - –ò–ª–∏ `pnl_percent` –Ω–µ –¥–æ—Å—Ç–∏–≥–∞–µ—Ç `tp_percent` –∏–∑-–∑–∞ –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è
  - –ò–ª–∏ `tp_percent` –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ—Ç—Å—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ

---

## üîç –ß–¢–û –ù–£–ñ–ù–û –ü–†–û–í–ï–†–ò–¢–¨:

### 1. **–ü—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å —Ä–∞—Å—á–µ—Ç–∞ pnl_percent:**

**–ü—Ä–∏–º–µ—Ä:**
- Entry: $3,900
- Current: $3,915.6
- PnL: $15.6
- pnl_percent = (3915.6 - 3900) / 3900 * 100 = **0.4** (0.4%)

### 2. **–ó–Ω–∞—á–µ–Ω–∏–µ tp_percent:**

**–ò–∑ –∫–æ–Ω—Ñ–∏–≥–∞:**
- `tp_percent: 0.4` - —ç—Ç–æ **0.4%** –∏–ª–∏ **40%**?

**–ï—Å–ª–∏ 0.4 = 0.4%:**
- `0.4 >= 0.4` ‚úÖ –î–æ–ª–∂–Ω–æ –∑–∞–∫—Ä—ã–≤–∞—Ç—å

**–ï—Å–ª–∏ 0.4 = 40%:**
- `0.4 >= 40` ‚ùå –ù–ï –∑–∞–∫—Ä—ã–≤–∞–µ—Ç (0.4% < 40%)

### 3. **–í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ª–∏ `_check_tp_only`:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ª–æ–≥–∞—Ö: `"TP –¥–æ—Å—Ç–∏–≥–Ω—É—Ç"` –∏–ª–∏ `"Take Profit"`
- –ï—Å–ª–∏ –Ω–µ—Ç –≤ –ª–æ–≥–∞—Ö ‚Üí `_check_tp_only` –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–ª–∏ –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç

---

## ‚úÖ –í–û–ó–ú–û–ñ–ù–û–ï –†–ï–®–ï–ù–ò–ï:

### **–ü—Ä–æ–±–ª–µ–º–∞ 1: –ï–¥–∏–Ω–∏—Ü—ã –∏–∑–º–µ—Ä–µ–Ω–∏—è**

**–ï—Å–ª–∏ tp_percent –≤ –∫–æ–Ω—Ñ–∏–≥–µ = 0.4 (0.4%):**
- –ê pnl_percent = 0.4 (0.4%)
- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å

**–ù–û!** –í–æ–∑–º–æ–∂–Ω–æ –ø—Ä–æ–±–ª–µ–º–∞ –≤ —Ç–æ–º, —á—Ç–æ:
- `tp_percent` —Ö—Ä–∞–Ω–∏—Ç—Å—è –∫–∞–∫ `0.4` (0.4%)
- –ù–æ –≥–¥–µ-—Ç–æ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ `0.4 = 40%`

### **–ü—Ä–æ–±–ª–µ–º–∞ 2: TrailingSL –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –ø–æ TP**

**TrailingSL –∑–∞–∫—Ä—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ:**
- –ö–æ–≥–¥–∞ —Ü–µ–Ω–∞ <= stop_loss (–¥–ª—è LONG)
- –ò–õ–ò –∫–æ–≥–¥–∞ —Ü–µ–Ω–∞ >= stop_loss (–¥–ª—è SHORT)

**TrailingSL –ù–ï –∑–∞–∫—Ä—ã–≤–∞–µ—Ç:**
- –ü—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ TP!

**–†–µ—à–µ–Ω–∏–µ:** –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É TP –≤ `should_close_position` –∏–ª–∏ –≤ `_update_trailing_stop_loss` –ü–ï–†–ï–î –ø—Ä–æ–≤–µ—Ä–∫–æ–π TrailingSL.

---

## üéØ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–Ø:

### **–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ TP –≤ `_update_trailing_stop_loss`:**

**–ü–µ—Ä–µ–¥ –ø—Ä–æ–≤–µ—Ä–∫–æ–π TrailingSL:**
```python
# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π TP
tp_percent_config = self.scalping_config.tp_percent  # 0.4 (0.4%)
profit_pct_from_entry = ((current_price - entry_price) / entry_price) * 100  # 0.4 (0.4%)

if profit_pct_from_entry >= tp_percent_config:
    logger.info(f"üéØ TP –¥–æ—Å—Ç–∏–≥–Ω—É—Ç: {profit_pct_from_entry:.2f}% >= {tp_percent_config:.2f}%")
    await self._close_position(symbol, "tp")
    return  # –ó–∞–∫—Ä—ã–≤–∞–µ–º –ø–æ TP, –Ω–µ –ø—Ä–æ–≤–µ—Ä—è—è TrailingSL
```

**–ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ:**
- TP –¥–æ–ª–∂–µ–Ω —Å—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å **–ù–ï–ó–ê–í–ò–°–ò–ú–û** –æ—Ç TrailingSL
- TrailingSL –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç —É–±—ã—Ç–∫–∞ –∏ –¥–∞–µ—Ç –±–æ–ª—å—à–µ –º–µ—Å—Ç–∞ –ø—Ä–∏ —Ç—Ä–µ–Ω–¥–µ
- –ù–æ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π TP –¥–æ–ª–∂–µ–Ω –∑–∞–∫—Ä—ã–≤–∞—Ç—å –ø–æ–∑–∏—Ü–∏—é –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ —Ü–µ–ª–µ–≤–æ–π –ø—Ä–∏–±—ã–ª–∏

---

## üìä –ò–¢–û–ì:

**–ü—Ä–æ–±–ª–µ–º–∞:** –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π TP (0.4%) –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç, –ø–æ—Ç–æ–º—É —á—Ç–æ:
1. –í–æ–∑–º–æ–∂–Ω–æ, –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –µ–¥–∏–Ω–∏—Ü –∏–∑–º–µ—Ä–µ–Ω–∏—è (0.4% vs 40%)
2. TrailingSL –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ª–æ–≥–∏–∫—É –∑–∞–∫—Ä—ã—Ç–∏—è
3. –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π TP –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ `_check_tp_only`, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –Ω–µ –≤—ã–∑—ã–≤–∞—Ç—å—Å—è –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —á–∞—Å—Ç–æ

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ TP –≤ `_update_trailing_stop_loss` –ü–ï–†–ï–î –ø—Ä–æ–≤–µ—Ä–∫–æ–π TrailingSL.

