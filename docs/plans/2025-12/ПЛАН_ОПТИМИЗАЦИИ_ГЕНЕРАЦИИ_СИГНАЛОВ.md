# üöÄ –ü–ª–∞–Ω –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–∏–≥–Ω–∞–ª–æ–≤

## üìä –¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è

**–ü—Ä–æ–±–ª–µ–º–∞:** –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤ –∑–∞–Ω–∏–º–∞–µ—Ç **22.3 —Å–µ–∫—É–Ω–¥—ã** (90% –≤—Ä–µ–º–µ–Ω–∏ —Ü–∏–∫–ª–∞ TCC)

**–¶–µ–ª—å:** –°–Ω–∏–∑–∏—Ç—å –¥–æ **< 2 —Å–µ–∫—É–Ω–¥**

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ 1: –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ü–µ–Ω –∏–∑ DataRegistry (–ö–†–ò–¢–ò–ß–ù–û)

### –ü—Ä–æ–±–ª–µ–º–∞

–ö–∞–∂–¥—ã–π –º–µ—Ç–æ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–∏–≥–Ω–∞–ª–æ–≤ –≤—ã–∑—ã–≤–∞–µ—Ç:
```python
current_price = await self._get_current_market_price(symbol, candle_close_price)
```

–≠—Ç–æ –¥–µ–ª–∞–µ—Ç **API –∑–∞–ø—Ä–æ—Å** —á–µ—Ä–µ–∑ `client.get_price_limits()`, —á—Ç–æ –∑–∞–Ω–∏–º–∞–µ—Ç **200-500ms** –Ω–∞ –∑–∞–ø—Ä–æ—Å.

**–î–ª—è 5 —Å–∏–º–≤–æ–ª–æ–≤ √ó 4 –º–µ—Ç–æ–¥–∞ = 20 –∑–∞–ø—Ä–æ—Å–æ–≤ = 4-10 —Å–µ–∫—É–Ω–¥!**

### –†–µ—à–µ–Ω–∏–µ

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ü–µ–Ω—É –∏–∑ DataRegistry (–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ WebSocket):

```python
async def _get_current_market_price(
    self, symbol: str, fallback_price: float = 0.0
) -> float:
    """–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π —Ü–µ–Ω—ã —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º DataRegistry"""
    try:
        # ‚úÖ –ü–†–ò–û–†–ò–¢–ï–¢ 1: –¶–µ–Ω–∞ –∏–∑ DataRegistry (–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ WebSocket)
        if self.data_registry:
            price = await self.data_registry.get_price(symbol)
            if price and price > 0:
                return price
        
        # ‚úÖ –ü–†–ò–û–†–ò–¢–ï–¢ 2: –¶–µ–Ω–∞ –∏–∑ —Å–≤–µ—á–∏ (–±—ã—Å—Ç—Ä–æ, –Ω–æ –º–æ–∂–µ—Ç –±—ã—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–µ–π)
        if fallback_price > 0:
            return fallback_price
        
        # ‚úÖ –ü–†–ò–û–†–ò–¢–ï–¢ 3: API –∑–∞–ø—Ä–æ—Å (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ—Ç –¥—Ä—É–≥–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤)
        if self.client and hasattr(self.client, "get_price_limits"):
            price_limits = await self.client.get_price_limits(symbol)
            if price_limits:
                current_price = price_limits.get("current_price", 0)
                if current_price > 0:
                    return current_price
    except Exception as e:
        logger.debug(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ü–µ–Ω—ã –¥–ª—è {symbol}: {e}")
    
    return fallback_price
```

**–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç:** -15-20 —Å–µ–∫—É–Ω–¥

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ 2: –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–∏–º–≤–æ–ª–æ–≤ (–ö–†–ò–¢–ò–ß–ù–û)

### –ü—Ä–æ–±–ª–µ–º–∞

–°–∏–º–≤–æ–ª—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ:
```python
for symbol in symbols:  # 5 —Å–∏–º–≤–æ–ª–æ–≤
    signals.extend(await self._generate_symbol_signals(symbol))
```

–ï—Å–ª–∏ –∫–∞–∂–¥—ã–π —Å–∏–º–≤–æ–ª –∑–∞–Ω–∏–º–∞–µ—Ç 4-5 —Å–µ–∫—É–Ω–¥, —Ç–æ **5 —Å–∏–º–≤–æ–ª–æ–≤ = 20-25 —Å–µ–∫—É–Ω–¥**.

### –†–µ—à–µ–Ω–∏–µ

–û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Å–∏–º–≤–æ–ª—ã –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ:

```python
async def generate_signals(
    self, current_positions: Dict = None
) -> List[Dict[str, Any]]:
    """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–æ—Ä–≥–æ–≤—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤ —Å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π"""
    if not self.is_initialized:
        return []
    
    try:
        symbols = self.scalping_config.symbols
        
        # ‚úÖ –ü–ê–†–ê–õ–õ–ï–õ–¨–ù–ê–Ø –û–ë–†–ê–ë–û–¢–ö–ê: –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤—Å–µ —Å–∏–º–≤–æ–ª—ã –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
        tasks = [
            self._generate_symbol_signals(symbol, current_positions=current_positions)
            for symbol in symbols
        ]
        
        # –ñ–¥–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö –∑–∞–¥–∞—á –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
        results = await asyncio.gather(*tasks, return_exceptions=True)
        
        # –°–æ–±–∏—Ä–∞–µ–º —Å–∏–≥–Ω–∞–ª—ã –∏–∑ –≤—Å–µ—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        signals = []
        for i, result in enumerate(results):
            if isinstance(result, Exception):
                logger.error(f"‚ùå –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–∏–≥–Ω–∞–ª–æ–≤ –¥–ª—è {symbols[i]}: {result}")
            elif isinstance(result, list):
                signals.extend(result)
        
        return signals
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–∏–≥–Ω–∞–ª–æ–≤: {e}")
        return []
```

**–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç:** -15-20 —Å–µ–∫—É–Ω–¥ (–≤—Ä–µ–º—è = max –≤–º–µ—Å—Ç–æ sum)

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ 3: –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∂–∏–º–∞ —Ä—ã–Ω–∫–∞

### –ü—Ä–æ–±–ª–µ–º–∞

–†–µ–∂–∏–º –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –º–Ω–æ–∂–µ—Å—Ç–≤–æ —Ä–∞–∑ –¥–ª—è –æ–¥–Ω–æ–≥–æ —Å–∏–º–≤–æ–ª–∞:
```python
# –í –∫–∞–∂–¥–æ–º –º–µ—Ç–æ–¥–µ:
if hasattr(self, "regime_manager") and self.regime_manager:
    regime_obj = self.regime_manager.get_current_regime()
```

### –†–µ—à–µ–Ω–∏–µ

–û–ø—Ä–µ–¥–µ–ª—è—Ç—å —Ä–µ–∂–∏–º –æ–¥–∏–Ω —Ä–∞–∑ –∏ –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å:

```python
async def _generate_symbol_signals(
    self,
    symbol: str,
    market_data: Optional[MarketData] = None,
    current_positions: Dict = None,
) -> List[Dict[str, Any]]:
    """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ç–æ—Ä–≥–æ–≤–æ–π –ø–∞—Ä—ã"""
    try:
        # –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä—ã–Ω–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        if not market_data:
            market_data = await self._get_market_data(symbol)
        if not market_data:
            return []
        
        # ‚úÖ –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø: –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–µ–∂–∏–º –æ–¥–∏–Ω —Ä–∞–∑ –∏ –ø–µ—Ä–µ–¥–∞–µ–º –≤–æ –≤—Å–µ –º–µ—Ç–æ–¥—ã
        regime = "ranging"  # Fallback
        if hasattr(self, "regime_manager") and self.regime_manager:
            regime_obj = self.regime_manager.get_current_regime()
            if regime_obj:
                regime = regime_obj.lower() if isinstance(regime_obj, str) else str(regime_obj).lower()
        
        # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –±–∞–∑–æ–≤—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤ —Å –ø–µ—Ä–µ–¥–∞—á–µ–π —Ä–µ–∂–∏–º–∞
        base_signals = await self._generate_base_signals(symbol, market_data, regime=regime)
        
        # ...
```

**–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç:** -0.5-1 —Å–µ–∫—É–Ω–¥–∞

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ 4: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ AdaptiveFilterParameters –≤–µ–∑–¥–µ

### –ü—Ä–æ–±–ª–µ–º–∞

–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–Ω—Ñ–∏–≥–∞ —Å –≥–ª—É–±–æ–∫–∏–º –≤–ª–æ–∂–µ–Ω–∏–µ–º:
```python
# –°–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ —á—Ç–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥–∞ (—Å—Ç—Ä–æ–∫–∏ 2920-3052)
symbol_profiles[symbol][regime]
adaptive_regime[regime]
reversal_detection
v_reversal_threshold
```

### –†–µ—à–µ–Ω–∏–µ

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `AdaptiveFilterParameters` (—É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ!):

```python
# –í–º–µ—Å—Ç–æ —Å–ª–æ–∂–Ω–æ–π –ª–æ–≥–∏–∫–∏:
if self.adaptive_filter_params:
    reversal_threshold = self.adaptive_filter_params.get_reversal_threshold(
        symbol=symbol,
        regime=regime_name_ma,
    )
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –£–∂–µ —á–∞—Å—Ç–∏—á–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ, –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–µ–∑–¥–µ

**–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç:** -1-2 —Å–µ–∫—É–Ω–¥—ã

---

## üìä –ò—Ç–æ–≥–æ–≤—ã–π —ç—Ñ—Ñ–µ–∫—Ç

**–¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è:** 22.3 —Å–µ–∫—É–Ω–¥—ã

**–ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π:**
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ü–µ–Ω: -15-20 —Å–µ–∫
- –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞: -15-20 —Å–µ–∫ (–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º)
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∂–∏–º–∞: -0.5-1 —Å–µ–∫
- AdaptiveFilterParameters: -1-2 —Å–µ–∫

**–û–∂–∏–¥–∞–µ–º–æ–µ –≤—Ä–µ–º—è:** **2-4 —Å–µ–∫—É–Ω–¥—ã** ‚úÖ

---

## üöÄ –ü–æ—Ä—è–¥–æ–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

1. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ü–µ–Ω** (—Å–∞–º—ã–π –±–æ–ª—å—à–æ–π —ç—Ñ—Ñ–µ–∫—Ç, –ª–µ–≥–∫–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å)
2. **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** (–±–æ–ª—å—à–æ–π —ç—Ñ—Ñ–µ–∫—Ç, –ª–µ–≥–∫–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å)
3. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∂–∏–º–∞** (—Å—Ä–µ–¥–Ω–∏–π —ç—Ñ—Ñ–µ–∫—Ç, –ª–µ–≥–∫–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å)
4. **AdaptiveFilterParameters** (—É–∂–µ –µ—Å—Ç—å, –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–µ–∑–¥–µ)

---

**–î–∞—Ç–∞:** 23 –¥–µ–∫–∞–±—Ä—è 2025  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ö–†–ò–¢–ò–ß–ù–û





