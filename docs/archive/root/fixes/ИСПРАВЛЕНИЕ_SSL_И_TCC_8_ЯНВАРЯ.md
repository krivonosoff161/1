# üîí –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: SSL –û–®–ò–ë–ö–ê –ò TCC CRASH - 8 –Ø–ù–í–ê–†–Ø 2026

## ‚ùå –ü–†–û–ë–õ–ï–ú–´

### –ü—Ä–æ–±–ª–µ–º–∞ 1: SSL Connection Error
```
ERROR | liquidation_guard:get_margin_status
‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞: [Errno 1] [SSL: APPLICATION_DATA_AFTER_CLOSE_NOTIFY]
```

**–ü—Ä–∏—á–∏–Ω–∞:** WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –ø–æ—Ä–≤–∞–ª–æ—Å—å –∏–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –∑–∞–∫—Ä—ã–ª–æ—Å—å

### –ü—Ä–æ–±–ª–µ–º–∞ 2: TCC Crash
```
ERROR | trading_control_center:update_state
‚ùå TCC: –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è: 'str' object has no attribute 'get'
```

**–ü—Ä–∏—á–∏–Ω–∞:** –ü—Ä–∏ SSL –æ—à–∏–±–∫–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–π –ø—Ä–∏—Ö–æ–¥—è—Ç –∫–∞–∫ `string` –∏–ª–∏ `None` –≤–º–µ—Å—Ç–æ `dict`, –∏ –∫–æ–¥ –ø—ã—Ç–∞–µ—Ç—Å—è –≤—ã–∑–≤–∞—Ç—å `.get()` –Ω–∞ —Å—Ç—Ä–æ–∫–µ

---

## ‚úÖ –†–ï–®–ï–ù–ò–ï

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 1: TCC - –°—Ç—Ä–æ–≥–∞—è –∑–∞—â–∏—Ç–∞ –≤ update_state()

**–§–∞–π–ª:** [src/strategies/scalping/futures/core/trading_control_center.py](src/strategies/scalping/futures/core/trading_control_center.py#L576-L595)

–î–æ–±–∞–≤–ª–µ–Ω–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø–æ–∑–∏—Ü–∏–π:

```python
# ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï 8.1.2026: –ó–∞—â–∏—Ç–∞ –æ—Ç SSL –æ—à–∏–±–æ–∫
for position in positions:
    # 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ position —ç—Ç–æ dict
    if not isinstance(position, dict):
        logger.warning(f"‚ö†Ô∏è TCC: –ü—Ä–æ–ø—É—Å–∫ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –∑–∞–ø–∏—Å–∏ (type={type(position).__name__})")
        continue
    
    # 2. –ó–∞—â–∏—â–∞–µ–º –∫–∞–∂–¥—ã–π .get() call –≤ try/except
    try:
        symbol = position.get("instId", "").replace("-SWAP", "")
        size = float(position.get("pos", "0"))
    except (AttributeError, TypeError, ValueError) as e:
        logger.error(f"‚ùå TCC: –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ position (type={type(position).__name__}): {e}")
        continue
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 
- ‚úÖ –ù–µ —É–ø–∞–¥–µ—Ç –µ—Å–ª–∏ position —ç—Ç–æ —Å—Ç—Ä–æ–∫–∞ –∏–ª–∏ None
- ‚úÖ –ü—Ä–æ–ø—É—Å—Ç–∏—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤–º–µ—Å—Ç–æ crash
- ‚úÖ –ü—Ä–æ–¥–æ–ª–∂–∏—Ç —Ä–∞–±–æ—Ç—É —Å –æ—Å—Ç–∞–ª—å–Ω—ã–º–∏ –ø–æ–∑–∏—Ü–∏—è–º–∏

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 2: LiquidationGuard - –ó–∞—â–∏—Ç–∞ –≤ get_margin_status()

**–§–∞–π–ª:** [src/strategies/modules/liquidation_guard.py](src/strategies/modules/liquidation_guard.py#L431-L456)

–î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞—â–∏—Ç–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –ø–æ–∑–∏—Ü–∏–π:

```python
for position in positions:
    # 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–æ—Ä–º–∞—Ç position
    if not isinstance(position, dict):
        logger.warning(f"‚ö†Ô∏è LiquidationGuard: –ü—Ä–æ–ø—É—Å–∫ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏ (type={type(position).__name__})")
        continue
    
    # 2. –ó–∞—â–∏—â–∞–µ–º –∫–æ–Ω–≤–µ—Ä—Å–∏—é size
    try:
        size = float(position.get("pos", "0"))
    except (ValueError, TypeError):
        logger.warning(f"‚ö†Ô∏è LiquidationGuard: –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ —Ä–∞–∑–º–µ—Ä–∞: {position.get('pos')}")
        continue
    
    if size == 0:
        continue
    
    # ... –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –Ω–æ—Ä–º–∞–ª—å–Ω–æ
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ SSL –æ—à–∏–±–∫–∞ –Ω–µ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ crash
- ‚úÖ –ü–æ–∑–∏—Ü–∏–∏ —Å –æ—à–∏–±–∫–∞–º–∏ –±—É–¥—É—Ç –ø—Ä–æ–ø—É—â–µ–Ω—ã
- ‚úÖ –ú–µ—Ç–æ–¥—ã –≤–µ—Ä–Ω—É—Ç fallback –∑–Ω–∞—á–µ–Ω–∏—è –≤–º–µ—Å—Ç–æ exception

---

## üîç –ß–¢–û –ü–†–û–ò–°–•–û–î–ò–¢ –ü–†–ò SSL –û–®–ò–ë–ö–ï

### –î–û –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø:
```
1. WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–∞–∑—Ä—ã–≤–∞–µ—Ç—Å—è
2. API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç string –∏–ª–∏ None –≤–º–µ—Å—Ç–æ list[dict]
3. TCC.update_state() –ø–æ–ª—É—á–∞–µ—Ç string
4. –í—ã–∑—ã–≤–∞–µ—Ç position.get() –Ω–∞ —Å—Ç—Ä–æ–∫–µ
5. ‚ùå CRASH: AttributeError: 'str' object has no attribute 'get'
6. ‚ùå –í—Å—è —Ç–æ—Ä–≥–æ–≤–ª—è –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è
```

### –ü–û–°–õ–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø:
```
1. WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–∞–∑—Ä—ã–≤–∞–µ—Ç—Å—è
2. API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç string –∏–ª–∏ None –≤–º–µ—Å—Ç–æ list[dict]
3. TCC.update_state() –ø–æ–ª—É—á–∞–µ—Ç string
4. ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç isinstance(position, dict)
5. ‚úÖ –ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
6. ‚úÖ –ü—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π
7. ‚úÖ –¢–æ—Ä–≥–æ–≤–ª—è –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è –Ω–æ—Ä–º–∞–ª—å–Ω–æ
```

---

## üìã –§–ê–ô–õ–´ –ò–ó–ú–ï–ù–ï–ù–ò–Ø

| –§–∞–π–ª | –°—Ç—Ä–æ–∫–∏ | –ò–∑–º–µ–Ω–µ–Ω–∏–µ |
|------|--------|-----------|
| trading_control_center.py | 576-595 | –ó–∞—â–∏—Ç–∞ –≤ loop –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–π |
| liquidation_guard.py | 431-456 | –ó–∞—â–∏—Ç–∞ –≤ loop –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–π |

---

## üõ°Ô∏è –ó–ê–©–ò–¢–ê –û–¢ SSL –û–®–ò–ë–û–ö

### –ß—Ç–æ –∑–∞—â–∏—â–∞–µ—Ç –∫–æ–¥ —Ç–µ–ø–µ—Ä—å:

1. ‚úÖ `isinstance(position, dict)` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ –¥–∞–Ω–Ω—ã—Ö
2. ‚úÖ `try/except (AttributeError, TypeError, ValueError)` - –ª–æ–≤–∏—Ç –æ—à–∏–±–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞
3. ‚úÖ `continue` –≤–º–µ—Å—Ç–æ crash - –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
4. ‚úÖ Fallback –∑–Ω–∞—á–µ–Ω–∏—è - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ defaults

### –ü—Ä–∏–º–µ—Ä—ã –∑–∞—â–∏—Ç—ã:

```python
# ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç string
if not isinstance(position, dict):  # False –µ—Å–ª–∏ position = "error"
    continue

# ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç None
if not isinstance(position, dict):  # False –µ—Å–ª–∏ position = None
    continue

# ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç —á–∏—Å–ª–æ (–µ—Å–ª–∏ API –≤–µ—Ä–Ω–µ—Ç —á—Ç–æ-—Ç–æ —Å—Ç—Ä–∞–Ω–Ω–æ–µ)
if not isinstance(position, dict):  # False –µ—Å–ª–∏ position = 123
    continue

# ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –∫–æ–Ω–≤–µ—Ä—Å–∏–∏
try:
    size = float(position.get("pos", "0"))
except (ValueError, TypeError):  # –õ–æ–≤–∏—Ç –µ—Å–ª–∏ "pos" = "invalid"
    continue
```

---

## üìà –û–ñ–ò–î–ê–ï–ú–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢

### –õ–æ–≥–∏ –ü–û–°–õ–ï –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏ SSL –æ—à–∏–±–∫–µ:

```
ERROR | liquidation_guard:get_margin_status
‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞: [SSL: APPLICATION_DATA_AFTER_CLOSE_NOTIFY]

WARNING | trading_control_center:update_state
‚ö†Ô∏è TCC: –ü—Ä–æ–ø—É—Å–∫ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –∑–∞–ø–∏—Å–∏ –ø–æ–∑–∏—Ü–∏–∏ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏: type=str = "error message"

WARNING | trading_control_center:update_state
‚ö†Ô∏è TCC: –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ position –¥–∞–Ω–Ω—ã—Ö (type=str): 'str' object has no attribute 'get'

‚úÖ –¢–æ—Ä–≥–æ–≤–ª—è –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è –Ω–æ—Ä–º–∞–ª—å–Ω–æ (–ø–æ–∑–∏—Ü–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö)
```

---

## üîó –°–í–Ø–ó–ê–ù–ù–´–ï –ü–†–û–ë–õ–ï–ú–´

–≠—Ç–∞ –æ—à–∏–±–∫–∞ –±—ã–ª–∞ –ø—Ä–∏—á–∏–Ω–æ–π:
1. ‚ùå –û—Ä–¥–µ—Ä—ã –æ—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è –ø–æ—Ç–æ–º –æ—Ç–º–µ–Ω—è—é—Ç—Å—è (TCC –Ω–µ –º–æ–∂–µ—Ç –æ–±–Ω–æ–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ)
2. ‚ùå "–í—Å—è —Ç–æ—Ä–≥–æ–≤–ª—è —Ç–µ–ø–µ—Ä—å" - –ø–æ—Ç–æ–º—É —á—Ç–æ crash –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ü–∏–∫–ª
3. ‚ùå –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ–∑–∏—Ü–∏–∏ –ø—Ä–∏ SSL –æ—à–∏–±–∫–µ

---

**–î–∞—Ç–∞:** 8 —è–Ω–≤–∞—Ä—è 2026, ~11:21 UTC  
**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø (–±–ª–æ–∫–∏—Ä—É–µ—Ç —Ç–æ—Ä–≥–æ–≤–ª—é)  
**–°—Ç–∞—Ç—É—Å:** –ò–°–ü–†–ê–í–õ–ï–ù–û ‚úÖ

