# üîß –ü–†–ê–ö–¢–ò–ß–ï–°–ö–ò–ô –ü–õ–ê–ù –û–¢–õ–ê–î–ö–ò: –î–û–ë–ê–í–õ–ï–ù–ò–ï –õ–û–ì–ò–†–û–í–ê–ù–ò–Ø

**–¶–µ–ª—å:** –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏–µ —Ç–æ—á–∫–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å –ì–î–ï –õ–û–ú–ê–ï–¢–°–Ø —Å–∏—Å—Ç–µ–º–∞  
**–í—Ä–µ–º—è:** ~1 —á–∞—Å  
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –î–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞

---

## üéØ –°–¢–†–ê–¢–ï–ì–ò–Ø –õ–û–ì–ò–†–û–í–ê–ù–ò–Ø

–í–º–µ—Å—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ª–æ–≥–∏–∫–∏, –º—ã –ø—Ä–æ—Å—Ç–æ **–¥–æ–±–∞–≤–ª—è–µ–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç.

```
Signal Generation Flow:
  1. Generate raw signals from indicators
  2. Apply filters (MTF, Correlation, Volume, etc.)
  3. Create final signal object

Order Execution Flow:
  1. Receive signal
  2. Calculate ATR
  3. Calculate TP/SL
  4. Check risk
  5. Execute order

Position Management:
  1. Track open positions
  2. Monitor P&L
  3. Close on TP/SL
```

---

## üìç –¢–û–ß–ö–ê –õ–û–ì–ò–†–û–í–ê–ù–ò–Ø #1: Signal Generation (Raw)

**–§–∞–π–ª:** `src/strategies/scalping/futures/signal_generator.py`

**–ù–∞–π—Ç–∏:** –§—É–Ω–∫—Ü–∏—è `_generate_symbol_signals()` –∏–ª–∏ –≥–¥–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `_apply_filters()`

**–î–æ–±–∞–≤–∏—Ç—å –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è raw signals:**

```python
# ‚úÖ –õ–û–ì–ò–†–û–í–ê–ù–ò–ï: Raw signals –ø–µ—Ä–µ–¥ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
raw_signal_count = len(raw_signals)  # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ raw —Å–∏–≥–Ω–∞–ª–æ–≤
logger.info(f"[SIGNAL_GEN] {symbol}: Generated {raw_signal_count} RAW signals before filters")

for i, sig in enumerate(raw_signals):
    logger.debug(f"[RAW_SIG #{i+1}] {symbol}: {sig.get('direction')} @ {sig.get('price')} "
                f"(strength={sig.get('strength')}, reason={sig.get('reason')})")
```

---

## üìç –¢–û–ß–ö–ê –õ–û–ì–ò–†–û–í–ê–ù–ò–Ø #2: Filter Application (By Filter)

**–§–∞–π–ª:** `src/strategies/scalping/futures/signals/filter_manager.py` –∏–ª–∏ —É –∫–∞–∂–¥–æ–≥–æ —Ñ–∏–ª—å—Ç—Ä–∞

**–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–∞–∂–¥—ã–π —Ñ–∏–ª—å—Ç—Ä:**

```python
class SomeFilter:
    def apply(self, signals):
        input_count = len(signals)
        
        # ... —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ª–æ–≥–∏–∫–∏ ...
        
        output_count = len(output_signals)
        rejected_count = input_count - output_count
        
        logger.info(f"[FILTER] {self.__class__.__name__}: "
                   f"In={input_count} ‚Üí Out={output_count} (Rejected={rejected_count})")
        
        # ‚úÖ –õ–æ–≥–∏—Ä—É–µ–º –ø—Ä–∏—á–∏–Ω—ã –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è
        for rejected_signal in rejected_signals:
            logger.debug(f"[REJECTED] {self.__class__.__name__}: "
                        f"{rejected_signal.get('symbol')} {rejected_signal.get('direction')} "
                        f"@ {rejected_signal.get('price')} - Reason: {reason}")
        
        return output_signals
```

---

## üìç –¢–û–ß–ö–ê –õ–û–ì–ò–†–û–í–ê–ù–ò–Ø #3: Final Signals (Before Execution)

**–§–∞–π–ª:** `src/strategies/scalping/futures/signal_generator.py`

**–ù–∞–π—Ç–∏:** –ö–æ–Ω–µ—Ü —Ñ—É–Ω–∫—Ü–∏–∏ `generate_signals()` –ø–µ—Ä–µ–¥ return

**–î–æ–±–∞–≤–∏—Ç—å:**

```python
# ‚úÖ –õ–û–ì–ò–†–û–í–ê–ù–ò–ï: Final signals –≥–æ—Ç–æ–≤—ã–µ –∫ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—é
final_signal_count = len(signals)
logger.info(f"[FINAL_SIGNALS] Total {final_signal_count} signals ready for execution")
logger.info(f"  Filter Acceptance Rate: {final_signal_count}/{raw_signal_count} = "
           f"{final_signal_count/raw_signal_count*100:.1f}% (if raw_signal_count > 0)")

for sig in signals:
    logger.info(f"[FINAL_SIG] {sig['symbol']}: {sig['direction']} @ {sig['price']} "
               f"(strength={sig['strength']}, regime={sig['regime']})")
```

---

## üìç –¢–û–ß–ö–ê –õ–û–ì–ò–†–û–í–ê–ù–ò–Ø #4: ATR Calculation (Order Executor)

**–§–∞–π–ª:** `src/strategies/scalping/futures/order_executor.py`

**–§—É–Ω–∫—Ü–∏—è:** `_get_current_atr()` (—Å—Ç—Ä–æ–∫–∞ ~2182)

**–ó–∞–º–µ–Ω–∏—Ç—å:**

```python
async def _get_current_atr(self, symbol: str, price: float) -> float:
    """–ü–æ–ª—É—á–∞–µ—Ç —Ç–µ–∫—É—â–∏–π ATR –¥–ª—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º"""
    try:
        import aiohttp

        inst_id = f"{symbol}-SWAP"
        url = f"https://www.okx.com/api/v5/market/candles?instId={inst_id}&bar=5m&limit=20"
        
        logger.debug(f"[ATR] {symbol}: Fetching ATR from OKX API...")
        
        async with aiohttp.ClientSession() as session:
            async with session.get(url) as resp:
                logger.debug(f"[ATR] {symbol}: API response status: {resp.status}")
                
                if resp.status == 200:
                    data = await resp.json()
                    
                    if data.get("code") == "0" and data.get("data"):
                        candles = data["data"]
                        logger.debug(f"[ATR] {symbol}: Got {len(candles)} candles from API")
                        
                        if len(candles) >= 15:
                            # ... —Ä–∞—Å—á–µ—Ç ATR ...
                            
                            atr = sum(true_ranges) / len(true_ranges)
                            atr_percent = atr / price * 100 if price > 0 else 0
                            
                            logger.info(f"[ATR] {symbol}: Calculated ATR = {atr:.6f} "
                                       f"({atr_percent:.4f}% of price {price:.2f})")
                            
                            return atr
                        else:
                            logger.warning(f"[ATR] {symbol}: Not enough candles ({len(candles)} < 15)")
                    else:
                        logger.warning(f"[ATR] {symbol}: Invalid API response: {data}")
                else:
                    logger.warning(f"[ATR] {symbol}: API error {resp.status}")
        
        # Fallback
        fallback_atr = price * 0.01
        logger.warning(f"[ATR] {symbol}: Using FALLBACK ATR = {fallback_atr:.6f} "
                      f"({fallback_atr/price*100:.4f}% of price)")
        
        return fallback_atr

    except Exception as e:
        logger.error(f"[ATR] {symbol}: Exception: {e}")
        fallback_atr = price * 0.01
        logger.warning(f"[ATR] {symbol}: Using fallback ATR due to exception")
        return fallback_atr
```

---

## üìç –¢–û–ß–ö–ê –õ–û–ì–ò–†–û–í–ê–ù–ò–Ø #5: SL/TP Calculation

**–§–∞–π–ª:** `src/strategies/scalping/futures/order_executor.py`

**–§—É–Ω–∫—Ü–∏—è:** `_calculate_tp_sl_prices()` (—Å—Ç—Ä–æ–∫–∞ ~2026)

**–î–æ–±–∞–≤–∏—Ç—å –≤ –Ω–∞—á–∞–ª–æ –∏ –ø–µ—Ä–µ–¥ return:**

```python
async def _calculate_tp_sl_prices(self, signal: dict) -> Tuple[float, float]:
    """–†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç TP –∏ SL —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º"""
    
    symbol = signal.get("symbol")
    entry_price = signal.get("price", 0.0)
    side = signal.get("direction", "").upper()
    
    logger.info(f"[TP_SL_CALC] START {symbol}: Entry={entry_price}, Side={side}")
    
    try:
        # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –ª–æ–≥–∏–∫–∞ ...
        
        # ‚úÖ –ü–ï–†–ï–î –†–ê–°–ß–Å–¢–û–ú ATR
        logger.debug(f"[TP_SL] {symbol}: Fetching ATR...")
        atr = await self._get_current_atr(symbol, entry_price)
        
        # ‚úÖ –ü–û–°–õ–ï –ü–û–õ–£–ß–ï–ù–ò–Ø –†–ï–ñ–ò–ú–ê
        regime = await self._get_current_regime(signal)
        regime_params = self._get_regime_params(regime)
        logger.info(f"[TP_SL] {symbol}: Regime={regime}, Regime Params={regime_params}")
        
        # ‚úÖ –õ–û–ì–ò–†–£–ï–ú sl_multiplier
        if regime_params:
            sl_multiplier = regime_params.get("sl_multiplier", 2.0)
            logger.debug(f"[TP_SL] {symbol}: sl_multiplier FROM REGIME = {sl_multiplier}")
        else:
            sl_multiplier = float(self.scalping_config.get("sl_percent", 0.2))
            logger.debug(f"[TP_SL] {symbol}: sl_multiplier FROM GLOBAL = {sl_multiplier}")
        
        # ‚úÖ –õ–û–ì–ò–†–£–ï–ú –†–ê–°–ß–Å–¢ DISTANCE
        tp_distance = atr * tp_multiplier
        sl_distance = atr * sl_multiplier
        logger.debug(f"[TP_SL] {symbol}: ATR={atr:.6f}, TP Distance={tp_distance:.6f}, SL Distance={sl_distance:.6f}")
        
        # ‚úÖ –õ–û–ì–ò–†–£–ï–ú FALLBACK
        sl_percent_abs = entry_price * (sl_percent_value / 100.0)
        logger.debug(f"[TP_SL] {symbol}: Percent-based SL={sl_percent_abs:.6f} ({sl_percent_value}%)")
        
        if sl_distance < sl_percent_abs:
            logger.warning(f"[TP_SL] {symbol}: ATR-based SL ({sl_distance:.6f}) < Percent-based ({sl_percent_abs:.6f}), using percent")
            sl_distance = sl_percent_abs
        
        # ‚úÖ –§–ò–ù–ê–õ–¨–ù–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢
        if side == "BUY":
            tp_price = entry_price + tp_distance
            sl_price = entry_price - sl_distance
        else:
            tp_price = entry_price - tp_distance
            sl_price = entry_price + sl_distance
        
        logger.info(f"[TP_SL_CALC] RESULT {symbol}:")
        logger.info(f"  Entry:     {entry_price:.6f}")
        logger.info(f"  TP:        {tp_price:.6f} ({abs(tp_price - entry_price):.6f} / {abs(tp_price - entry_price)/entry_price*100:.4f}%)")
        logger.info(f"  SL:        {sl_price:.6f} ({abs(sl_price - entry_price):.6f} / {abs(sl_price - entry_price)/entry_price*100:.4f}%)")
        logger.info(f"  Distance:  SL/TP ratio = {abs(sl_price - entry_price) / abs(tp_price - entry_price):.2f}x")
        
        return tp_price, sl_price

    except Exception as e:
        logger.error(f"[TP_SL_CALC] ERROR {symbol}: {e}")
        raise
```

---

## üìç –¢–û–ß–ö–ê –õ–û–ì–ò–†–û–í–ê–ù–ò–Ø #6: Order Placement (Before API Call)

**–§–∞–π–ª:** `src/strategies/scalping/futures/order_executor.py`

**–§—É–Ω–∫—Ü–∏—è:** `execute_signal()` –∏–ª–∏ `_place_market_order_with_ooco()`

**–î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–¥ API call:**

```python
# ‚úÖ –õ–û–ì–ò–†–û–í–ê–ù–ò–ï: –û—Ä–¥–µ—Ä –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
logger.info(f"[ORDER_PLACE] {symbol}: Placing order")
logger.info(f"  Symbol:    {symbol}")
logger.info(f"  Side:      {side}")
logger.info(f"  Quantity:  {quantity}")
logger.info(f"  Entry:     {entry_price:.6f}")
logger.info(f"  TP:        {tp_price:.6f}")
logger.info(f"  SL:        {sl_price:.6f}")
logger.info(f"  Risk Ratio: {abs(sl_price - entry_price) / abs(tp_price - entry_price):.2f}x")
logger.info(f"  Signal ID: {signal.get('id')}")

# –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ä–¥–µ—Ä...

logger.info(f"[ORDER_PLACE] {symbol}: Order placed successfully")
logger.info(f"  Order ID:  {order_id}")
```

---

## üìç –¢–û–ß–ö–ê –õ–û–ì–ò–†–û–í–ê–ù–ò–Ø #7: Order Execution (After Trade Close)

**–§–∞–π–ª:** `src/strategies/scalping/futures/position_manager.py`

**–§—É–Ω–∫—Ü–∏—è:** `_monitor_position()` –∏–ª–∏ –≥–¥–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø–æ–∑–∏—Ü–∏—è

**–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏:**

```python
# ‚úÖ –õ–û–ì–ò–†–û–í–ê–ù–ò–ï: –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–∏
logger.info(f"[POSITION_CLOSE] {symbol}: Position closed")
logger.info(f"  Entry:     {position.entry_price:.6f}")
logger.info(f"  Exit:      {exit_price:.6f}")
logger.info(f"  Reason:    {close_reason}")  # "tp_reached", "sl_reached", etc.
logger.info(f"  P&L:       {pnl:.6f} USD")
logger.info(f"  P&L %:     {pnl/position.size/position.entry_price*100:.4f}%")
logger.info(f"  Duration:  {duration_seconds} seconds")
logger.info(f"  Signal:    {signal}")
```

---

## üöÄ –ö–ê–ö –ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨ –õ–û–ì–ò–†–û–í–ê–ù–ò–ï

### –®–∞–≥ 1: –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (30 –º–∏–Ω—É—Ç)

–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –±–ª–æ–∫–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –º–µ—Å—Ç–∞ –≤ –∫–æ–¥–µ.

### –®–∞–≥ 2: –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º (–≤–∞—Ä—å–∏—Ä—É–µ—Ç—Å—è)

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞ –∫–∞–∫ –æ–±—ã—á–Ω–æ
python run.py --mode futures

# –õ–æ–≥–∏ –±—É–¥—É—Ç –≤: logs/futures/...
```

### –®–∞–≥ 3: –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –õ–æ–≥–∏

–ü–æ—Å–ª–µ 30 –º–∏–Ω—É—Ç —Ç–æ—Ä–≥–æ–≤–ª–∏ (–∏–ª–∏ –ø–æ—Å–ª–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–¥–µ–ª–æ–∫), —Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏:

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä RAW —Å–∏–≥–Ω–∞–ª–æ–≤
grep "\[RAW_SIG" logs/futures/*.log

# –ü—Ä–æ—Å–º–æ—Ç—Ä –æ—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤
grep "\[REJECTED\]" logs/futures/*.log | head -50

# –ü—Ä–æ—Å–º–æ—Ç—Ä —Ñ–∏–ª—å—Ç—Ä–æ–≤
grep "\[FILTER\]" logs/futures/*.log

# –ü—Ä–æ—Å–º–æ—Ç—Ä ATR —Ä–∞—Å—á—ë—Ç–æ–≤
grep "\[ATR\]" logs/futures/*.log

# –ü—Ä–æ—Å–º–æ—Ç—Ä SL/TP —Ä–∞—Å—á—ë—Ç–æ–≤
grep "\[TP_SL\]" logs/futures/*.log

# –ü—Ä–æ—Å–º–æ—Ç—Ä –æ—Ä–¥–µ—Ä–æ–≤
grep "\[ORDER_PLACE\]" logs/futures/*.log

# –ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–∫—Ä—ã—Ç–∏–π –ø–æ–∑–∏—Ü–∏–π
grep "\[POSITION_CLOSE\]" logs/futures/*.log
```

### –®–∞–≥ 4: –û—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –í–æ–ø—Ä–æ—Å—ã

–ü–æ—Å–ª–µ –∞–Ω–∞–ª–∏–∑–∞ –ª–æ–≥–æ–≤, –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ —ç—Ç–∏ –≤–æ–ø—Ä–æ—Å—ã:

```
1. –ö–∞–∫ –º–Ω–æ–≥–æ RAW —Å–∏–≥–Ω–∞–ª–æ–≤ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è? ___
   ‚Üí –ò—â–µ–º —Å—Ç—Ä–æ–∫–∏ [RAW_SIG]

2. –ù–∞ –∫–∞–∫–æ–º —Ñ–∏–ª—å—Ç—Ä–µ –æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ? ___
   ‚Üí –ò—â–µ–º [FILTER] —Å –Ω–∞–∏–±–æ–ª—å—à–∏–º rejection rate

3. –ö–∞–∫–æ–π –ø—Ä–æ—Ü–µ–Ω—Ç —Å–∏–≥–Ω–∞–ª–æ–≤ –¥–æ—Ö–æ–¥–∏—Ç –¥–æ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è? ___
   ‚Üí (Final signals) / (Raw signals)

4. –ö–∞–∫–æ–π –ø—Ä–æ—Ü–µ–Ω—Ç RAW —Å–∏–≥–Ω–∞–ª–æ–≤ –æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–º —Ñ–∏–ª—å—Ç—Ä–æ–º?
   ‚îú‚îÄ MTF Filter:         ____%
   ‚îú‚îÄ Correlation Filter: ____%
   ‚îú‚îÄ Volume Filter:      ____%
   ‚îî‚îÄ etc.

5. ATR —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ?
   ‚îú‚îÄ Fallback –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —á–∞—Å—Ç–æ? ___ times
   ‚îî‚îÄ ATR –≤ % –æ—Ç —Ü–µ–Ω—ã: ___ % (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 0.5-5%)

6. SL —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ?
   ‚îú‚îÄ SL —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –≤ %: ___ % (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 0.5-2%)
   ‚îú‚îÄ Fallback –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è: ___ times
   ‚îî‚îÄ –ï—Å—Ç—å entry ‚âà stop: YES/NO

7. –ö–∞–∫–æ–π ratio SL/TP?
   ‚Üí log –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç: "SL/TP ratio = X.XXx"
   ‚Üí –î–æ–ª–∂–Ω–æ –±—ã—Ç—å ‚âà 1.0x (1:1 risk/reward)

8. –ö–∞–∫ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è fallback –Ω–∞ sl_percent?
   ‚Üí –ò—â–µ–º "Using percent"

9. –ï—Å—Ç—å –ª–∏ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –º–µ–∂–¥—É Signal ATR –∏ Execution ATR?
   ‚Üí –°—Ä–∞–≤–Ω–∏—Ç—å ATR value –≤ —Ä–∞–∑–Ω—ã—Ö –ª–æ–≥–∞—Ö
```

---

## üéØ –ß–¢–û –ú–´ –ù–ê–ô–î–ï–ú

### –°—Ü–µ–Ω–∞—Ä–∏–π A: Fallback ATR —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è (>50%)

**–≠—Ç–æ –æ–±—ä—è—Å–Ω—è–µ—Ç:**
- ‚ùå –ú–∏–∫—Ä–æ—Å–∫–æ–ø–∏—á–µ—Å–∫–∏–µ SL –¥–ª—è DOGE/XRP
- ‚ùå 81.5% SL hit rate
- ‚ùå entry ‚âà stop bug

**–†–µ—à–µ–Ω–∏–µ:**
- –£–ª—É—á—à–∏—Ç—å `_get_current_atr()` —á—Ç–æ–±—ã —Ä–µ–∂–µ fallback
- –ò–õ–ò –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å DataRegistry ATR –≤–º–µ—Å—Ç–æ HTTP
- –ò–õ–ò —É–≤–µ–ª–∏—á–∏—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π SL

### –°—Ü–µ–Ω–∞—Ä–∏–π B: –û–¥–∏–Ω —Ñ–∏–ª—å—Ç—Ä –æ—Ç–∫–ª–æ–Ω—è–µ—Ç 80%+ —Å–∏–≥–Ω–∞–ª–æ–≤

**–≠—Ç–æ –æ–±—ä—è—Å–Ω—è–µ—Ç:**
- ‚ùå 273 —Å–∏–≥–Ω–∞–ª–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —ç—Ç–æ–≥–æ —Ñ–∏–ª—å—Ç—Ä–∞
- –ú–æ–∂–µ—Ç –±—ã—Ç—å –æ–Ω –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- –ú–æ–∂–µ—Ç –±—ã—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω—É–∂–Ω–æ —Å–º—è–≥—á–∏—Ç—å

### –°—Ü–µ–Ω–∞—Ä–∏–π C: ATR –≤ signal_generator ‚â† ATR –≤ order_executor

**–≠—Ç–æ –æ–±—ä—è—Å–Ω—è–µ—Ç:**
- ‚ùå –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –º–µ–∂–¥—É —Å–∏–≥–Ω–∞–ª–æ–º –∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ–º

**–†–µ—à–µ–Ω–∏–µ:**
- –°–æ—Ö—Ä–∞–Ω—è—Ç—å ATR –≤ —Å–∏–≥–Ω–∞–ª–µ
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ—Ç –∂–µ ATR –ø—Ä–∏ —Ä–∞—Å—á—ë—Ç–µ SL

### –°—Ü–µ–Ω–∞—Ä–∏–π D: Per-symbol –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è

**–≠—Ç–æ –æ–±—ä—è—Å–Ω—è–µ—Ç:**
- ‚ùå –ü–æ—á–µ–º—É DOGE/XRP –Ω–µ —É–ª—É—á—à–∏–ª–∏—Å—å –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–¥ –∫–∞–∫ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- –ú–æ–∂–µ—Ç –±—ã—Ç—å –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –≤ signal_generator

---

## üìä –ü–†–ò–ú–ï–† –ê–ù–ê–õ–ò–ó–ê –õ–û–ì–û–í

```
Raw signals generated: 350
‚îú‚îÄ MTF Filter rejected: 80 ‚Üí 270 passed
‚îú‚îÄ Correlation Filter rejected: 100 ‚Üí 170 passed
‚îú‚îÄ Volume Filter rejected: 50 ‚Üí 120 passed
‚îú‚îÄ Other filters rejected: 93 ‚Üí 27 passed
‚îî‚îÄ FINAL: 27 signals executed

Acceptance rate: 27/350 = 7.7%

ATR Statistics:
‚îú‚îÄ Fallback used: 15 times out of 350 (4.3%) - OK
‚îú‚îÄ ATR avg: 0.8% of price - GOOD
‚îî‚îÄ ATR range: 0.1% - 5% - REASONABLE

SL Statistics:
‚îú‚îÄ SL avg: 0.15% of price - ‚ö†Ô∏è VERY SMALL!
‚îú‚îÄ SL min: 0.01% - ‚ùå TOO SMALL!
‚îú‚îÄ SL max: 2% - OK
‚îî‚îÄ Fallback on percent: 200 times - ‚ùå VERY OFTEN!

Issue Found:
- Fallback on percent triggered in 200/350 signals (57%)
- This means ATR-based SL is too small
- So sl_percent fallback is used instead
- But sl_percent_abs might be tiny for micro-pairs
- Result: entry ‚âà stop
```

---

## üîÑ –ò–¢–ï–†–ê–¢–ò–í–ù–´–ô –ü–†–û–¶–ï–°–°

```
1. –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
   ‚Üì
2. –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞ —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º (30 –º–∏–Ω - 2 —á–∞—Å–∞)
   ‚Üì
3. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏
   ‚Üì
4. –ù–∞–π—Ç–∏ –∫–æ—Ä–Ω–µ–≤—É—é –ø—Ä–∏—á–∏–Ω—É
   ‚Üì
5. –°–¥–µ–ª–∞—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
   ‚Üì
6. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–Ω–æ–≤–∞
   ‚Üì
7. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É–ª—É—á—à–µ–Ω–∏–µ
   ‚Üì
8. –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–π –ø—Ä–æ–±–ª–µ–º—ã
```

**–ù–ï –¢–û–†–û–ü–ò–¢–ï–°–¨** - —ç—Ç–æ –ø—É—Ç—å –∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É —Ä–µ—à–µ–Ω–∏—é.

