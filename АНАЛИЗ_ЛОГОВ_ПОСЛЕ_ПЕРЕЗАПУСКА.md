# üìä –ê–ù–ê–õ–ò–ó –õ–û–ì–û–í –ü–û–°–õ–ï –ü–ï–†–ï–ó–ê–ü–£–°–ö–ê

## ‚úÖ –°–¢–ê–¢–£–° –ë–û–¢–ê

**–í—Ä–µ–º—è –∑–∞–ø—É—Å–∫–∞:** 2025-12-21 13:49:57  
**–¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è:** 2025-12-21 13:50:55  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ

---

## üìã –ß–¢–û –ü–†–û–í–ï–†–Ø–ï–ú

–ü–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –≤—Å–µ—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:

1. ‚úÖ **Exchange-side closure detection** (DRIFT_REMOVE)
2. ‚úÖ **Race condition –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** (size=0)
3. ‚úÖ **Leverage –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** (–¥–µ—Ç–∞–ª—å–Ω–æ–µ)
4. ‚úÖ **Margin ratio –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** (–¥–µ—Ç–∞–ª—å–Ω–æ–µ)
5. ‚úÖ **Pre-close state logging**
6. ‚úÖ **Partial TP logging**

---

## üîç –¢–ï–ö–£–©–ï–ï –°–û–°–¢–û–Ø–ù–ò–ï

### ‚úÖ –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç:
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ
- SignalGenerator —Ä–∞–±–æ—Ç–∞–µ—Ç
- PositionManager –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
- AdaptiveLeverage –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
- MarginCalculator –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
- ExitAnalyzer –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω

### ‚è≥ –û–∂–∏–¥–∞–µ–º —Å–æ–±—ã—Ç–∏—è:
- **–ü–æ–∫–∞ –Ω–µ—Ç –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π** ‚Üí –Ω–µ—Ç –ª–æ–≥–æ–≤ leverage, margin_ratio, –∑–∞–∫—Ä—ã—Ç–∏–π
- –ë–æ—Ç –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–∏–≥–Ω–∞–ª—ã, –Ω–æ –ø–æ–∑–∏—Ü–∏–∏ –µ—â–µ –Ω–µ –æ—Ç–∫—Ä—ã—Ç—ã
- –†–µ–∂–∏–º —Ä—ã–Ω–∫–∞: RANGING –¥–ª—è –≤—Å–µ—Ö —Å–∏–º–≤–æ–ª–æ–≤

---

## üéØ –ö–û–ì–î–ê –ü–†–û–í–ï–†–ò–¢–¨ –°–ù–û–í–ê

–ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫:

1. **–û—Ç–∫—Ä–æ–µ—Ç—Å—è –ø–æ–∑–∏—Ü–∏—è** ‚Üí –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –ª–æ–≥–∏:
   - `üìä [ADAPTIVE_LEVERAGE] {symbol}: –†–∞—Å—á–µ—Ç leverage | ...`
   - `‚úÖ [ADAPTIVE_LEVERAGE] {symbol}: –§–ò–ù–ê–õ–¨–ù–´–ô leverage={leverage}x | ...`

2. **–ü–æ–∑–∏—Ü–∏—è –±—É–¥–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å—Å—è** ‚Üí –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –ª–æ–≥–∏:
   - `üìä [MARGIN_RATIO] –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø–æ–∑–∏—Ü–∏–∏: safe={is_safe} | ...`

3. **–ü–æ–∑–∏—Ü–∏—è –∑–∞–∫—Ä–æ–µ—Ç—Å—è** ‚Üí –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –ª–æ–≥–∏:
   - `üìä [PRE_CLOSE] {symbol}: –ü—Ä–∏–Ω—è—Ç–æ —Ä–µ—à–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç—å`
   - `üö® –û–ë–ù–ê–†–£–ñ–ï–ù–û –ó–ê–ö–†–´–¢–ò–ï –ù–ê –ë–ò–†–ñ–ï: {symbol}` (–µ—Å–ª–∏ –∑–∞–∫—Ä—ã—Ç–∏–µ –Ω–∞ –±–∏—Ä–∂–µ)
   - `‚ö†Ô∏è [RACE_CONDITION] {symbol}: –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–∫—Ä—ã—Ç—å –ø–æ–∑–∏—Ü–∏—é —Å size=0!` (–µ—Å–ª–∏ race condition)

4. **–°—Ä–∞–±–æ—Ç–∞–µ—Ç Partial TP** ‚Üí –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –ª–æ–≥–∏:
   - `üìä PARTIAL TP: {symbol} {side.upper()}`

---

## üìù –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

1. **–ü–æ–¥–æ–∂–¥–∞—Ç—å –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏** (–æ–±—ã—á–Ω–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ —Ç–µ—á–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–∏–Ω—É—Ç)
2. **–ü–æ—Å–ª–µ –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏** –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ:
   - Leverage –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
   - Margin ratio –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
3. **–ü–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏** –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ:
   - Pre-close state logging
   - Exchange-side closure detection (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ)
   - Race condition –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ)

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç, –æ–∂–∏–¥–∞–µ–º —Å–æ–±—ã—Ç–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–æ–≤—ã—Ö –ª–æ–≥–æ–≤

