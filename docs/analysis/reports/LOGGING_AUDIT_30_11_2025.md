# üìä –ê–£–î–ò–¢ –õ–û–ì–ò–†–û–í–ê–ù–ò–Ø - Trading Bot OKX

**–î–∞—Ç–∞:** 30.11.2025  
**–°—Ç–∞—Ç—É—Å:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–∫—Ä—ã—Ç–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

---

## ‚úÖ **–ß–¢–û –õ–û–ì–ò–†–£–ï–¢–°–Ø**

### üî¥ **–ö—Ä–∏—Ç–∏—á–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã (–ª–æ–≥–∏—Ä—É—é—Ç—Å—è):**

| –ú–æ–º–µ–Ω—Ç | –ì–¥–µ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è | –£—Ä–æ–≤–µ–Ω—å | –°—Ç–∞—Ç—É—Å |
|--------|----------------|---------|--------|
| **ExitAnalyzer —Ä–µ—à–µ–Ω–∏—è** | `exit_analyzer.py:194-197` | `INFO` | ‚úÖ –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è |
| **PnL –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏** | `exit_analyzer.py:194-197` | `INFO` | ‚úÖ –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è |
| **TrailingSL –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è** | `trailing_stop_loss.py:260-266, 297-303` | `DEBUG` | ‚úÖ –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è |
| **–û—Ç–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–π** | `entry_manager.py:131` | `INFO` | ‚úÖ –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è |
| **–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–æ–≤** | `order_executor.py:108-117` | `INFO` | ‚úÖ –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è |
| **TP/SL —Ä–∞—Å—á—ë—Ç—ã** | `order_executor.py:1345-1350` | `DEBUG` | ‚úÖ –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è |
| **ATR-based fallback** | `order_executor.py:1332-1336` | `DEBUG` | ‚úÖ –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è |
| **TCC –æ—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª** | `trading_control_center.py:113, 132-136` | `INFO` | ‚úÖ –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è |
| **PositionRegistry —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è** | `position_registry.py:165-166` | `DEBUG` | ‚úÖ –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è |
| **PositionRegistry –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ** | `position_registry.py:248` | `DEBUG` | ‚úÖ –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è |
| **PositionRegistry —É–¥–∞–ª–µ–Ω–∏–µ** | `position_registry.py:263` | `DEBUG` | ‚úÖ –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è |

---

### ‚ö†Ô∏è **–í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã (—á–∞—Å—Ç–∏—á–Ω–æ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è):**

| –ú–æ–º–µ–Ω—Ç | –ì–¥–µ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è | –£—Ä–æ–≤–µ–Ω—å | –°—Ç–∞—Ç—É—Å |
|--------|----------------|---------|--------|
| **–í—ã—Å–æ–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å** | `order_executor.py:1345-1350` | `DEBUG` | ‚ö†Ô∏è –¢–æ–ª—å–∫–æ ATR, –Ω–µ—Ç –ø–æ—Ä–æ–≥–∞ |
| **Memory usage** | –ù–µ—Ç | - | ‚ùå –ù–µ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è |
| **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—ä–µ–∫—Ç–æ–≤ –≤ Registry** | –ù–µ—Ç | - | ‚ùå –ù–µ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è |
| **asyncio –∑–∞–¥–∞—á–∏** | –ù–µ—Ç | - | ‚ùå –ù–µ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è |
| **–ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ TP** | `exit_analyzer.py:194-197` | `INFO` | ‚úÖ –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è (reason) |
| **–ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ SL** | `exit_analyzer.py:194-197` | `INFO` | ‚úÖ –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è (reason) |
| **–ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ timeout** | `exit_analyzer.py:194-197` | `INFO` | ‚úÖ –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è (reason) |
| **–ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ loss_cut** | `exit_analyzer.py:194-197` | `INFO` | ‚úÖ –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è (reason) |

---

## ‚ùå **–ß–¢–û –ù–ï –õ–û–ì–ò–†–£–ï–¢–°–Ø (–Ω–æ –Ω—É–∂–Ω–æ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏)**

### 1. **Memory Leak –ø—Ä–æ–≤–µ—Ä–∫–∞**

**–ß—Ç–æ –Ω—É–∂–Ω–æ:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏ (MB)
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—ä–µ–∫—Ç–æ–≤ –≤ `PositionRegistry`
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–¥–∞—á –≤ `asyncio`
- –†–∞–∑–º–µ—Ä –∫–µ—à–∞ –≤ `DataRegistry`

**–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å:** ‚ùå –ù–µ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (—Ä–∞–∑ –≤ 5-10 –º–∏–Ω—É—Ç)

---

### 2. **–í—ã—Å–æ–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å (>5% –∑–∞ 5 –º–∏–Ω)**

**–ß—Ç–æ –Ω—É–∂–Ω–æ:**
- –î–µ—Ç–µ–∫—Ü–∏—è –≤—ã—Å–æ–∫–æ–π –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ø–æ—Ä–æ–≥–∞
- –†–µ–∞–∫—Ü–∏—è `ExitAnalyzer` –Ω–∞ –≤—ã—Å–æ–∫—É—é –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å

**–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ (—Ç–æ–ª—å–∫–æ ATR –≤ `DEBUG`)

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å `INFO`-–ª–æ–≥ –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏

---

### 3. **–î–µ—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**

**–ß—Ç–æ –Ω—É–∂–Ω–æ:**
- –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ü–∏–∫–ª–∞ TCC
- –í—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–∏–≥–Ω–∞–ª–æ–≤
- –í—Ä–µ–º—è –∞–Ω–∞–ª–∏–∑–∞ –ø–æ–∑–∏—Ü–∏–π
- –í—Ä–µ–º—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è

**–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å:** ‚ùå –ù–µ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

---

## üìã **–¢–ï–ö–£–©–ï–ï –ü–û–ö–†–´–¢–ò–ï –õ–û–ì–ò–†–û–í–ê–ù–ò–Ø**

### ‚úÖ **–•–æ—Ä–æ—à–æ –ø–æ–∫—Ä—ã—Ç–æ:**

1. **ExitAnalyzer** ‚Äî –≤—Å–µ —Ä–µ—à–µ–Ω–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –Ω–∞ `INFO`
2. **TrailingSL** ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –Ω–∞ `DEBUG`
3. **OrderExecutor** ‚Äî –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –∏ TP/SL –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
4. **PositionRegistry** ‚Äî —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
5. **TradingControlCenter** ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è

### ‚ö†Ô∏è **–ß–∞—Å—Ç–∏—á–Ω–æ –ø–æ–∫—Ä—ã—Ç–æ:**

1. **–í—ã—Å–æ–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å** ‚Äî —Ç–æ–ª—å–∫–æ ATR –≤ `DEBUG`
2. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** ‚Äî –Ω–µ—Ç –º–µ—Ç—Ä–∏–∫ –≤—Ä–µ–º–µ–Ω–∏

### ‚ùå **–ù–µ –ø–æ–∫—Ä—ã—Ç–æ:**

1. **Memory usage** ‚Äî –Ω–µ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è
2. **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—ä–µ–∫—Ç–æ–≤** ‚Äî –Ω–µ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è
3. **asyncio –∑–∞–¥–∞—á–∏** ‚Äî –Ω–µ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è

---

## üîß **–†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò**

### 1. **–î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ Memory Usage**

**–ì–¥–µ:** `trading_control_center.py` –≤ `run_main_loop()`

**–ß—Ç–æ –¥–æ–±–∞–≤–∏—Ç—å:**
```python
import psutil
import os

# –†–∞–∑ –≤ 10 –º–∏–Ω—É—Ç
if time.time() - last_memory_log > 600:
    process = psutil.Process(os.getpid())
    memory_mb = process.memory_info().rss / 1024 / 1024
    registry_size = len(await self.position_registry.get_all_positions())
    logger.info(
        f"üìä Memory: {memory_mb:.1f} MB, "
        f"Positions: {registry_size}, "
        f"Tasks: {len(asyncio.all_tasks())}"
    )
    last_memory_log = time.time()
```

---

### 2. **–î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã—Å–æ–∫–æ–π –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏**

**–ì–¥–µ:** `order_executor.py` –≤ `_calculate_tp_sl_prices()`

**–ß—Ç–æ –¥–æ–±–∞–≤–∏—Ç—å:**
```python
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã—Å–æ–∫–æ–π –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏
atr_percent = (atr / entry_price) * 100
if atr_percent > 5.0:  # > 5% –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å
    logger.warning(
        f"‚ö†Ô∏è –í—ã—Å–æ–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å –¥–ª—è {symbol}: "
        f"ATR={atr_percent:.2f}%, regime={regime}"
    )
```

---

### 3. **–î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**

**–ì–¥–µ:** `trading_control_center.py` –≤ `run_main_loop()`

**–ß—Ç–æ –¥–æ–±–∞–≤–∏—Ç—å:**
```python
import time

start_time = time.perf_counter()
signals = await self.signal_coordinator.generate_signals()
signal_time = time.perf_counter() - start_time

start_time = time.perf_counter()
await self.manage_positions()
manage_time = time.perf_counter() - start_time

logger.debug(
    f"‚è±Ô∏è Performance: signals={signal_time*1000:.1f}ms, "
    f"manage={manage_time*1000:.1f}ms"
)
```

---

## üìä **–ò–¢–û–ì–û–í–ê–Ø –¢–ê–ë–õ–ò–¶–ê**

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –ü–æ–∫—Ä—ã—Ç–∏–µ | –°—Ç–∞—Ç—É—Å |
|-----------|----------|--------|
| **ExitAnalyzer —Ä–µ—à–µ–Ω–∏—è** | 100% | ‚úÖ –û—Ç–ª–∏—á–Ω–æ |
| **TrailingSL –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è** | 100% | ‚úÖ –û—Ç–ª–∏—á–Ω–æ |
| **OrderExecutor –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ** | 100% | ‚úÖ –û—Ç–ª–∏—á–Ω–æ |
| **PositionRegistry –æ–ø–µ—Ä–∞—Ü–∏–∏** | 100% | ‚úÖ –û—Ç–ª–∏—á–Ω–æ |
| **TCC –æ—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª** | 100% | ‚úÖ –û—Ç–ª–∏—á–Ω–æ |
| **–í—ã—Å–æ–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å** | 30% | ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ |
| **Memory usage** | 0% | ‚ùå –ù–µ—Ç |
| **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** | 0% | ‚ùå –ù–µ—Ç |

---

## üéØ **–í–´–í–û–î**

### ‚úÖ **–ß—Ç–æ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è —Ö–æ—Ä–æ—à–æ:**

- –í—Å–µ —Ä–µ—à–µ–Ω–∏—è `ExitAnalyzer` (INFO)
- –í—Å–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è `TrailingSL` (DEBUG)
- –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ `PositionRegistry` (DEBUG)
- –í—Å–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –æ—Ä–¥–µ—Ä–æ–≤ (INFO)
- –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª TCC (INFO)

### ‚ö†Ô∏è **–ß—Ç–æ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:**

1. **Memory usage** ‚Äî –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ memory leak
2. **–í—ã—Å–æ–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å** ‚Äî –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–µ–∞–∫—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã
3. **–ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏** ‚Äî –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

---

## üì¶ **–ß–¢–û –ú–û–ñ–ù–û –ü–†–û–í–ï–†–ò–¢–¨ –°–ï–ô–ß–ê–°**

### ‚úÖ **–ú–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ –ª–æ–≥–∞–º:**

1. ‚úÖ –í—Å–µ —Ä–µ—à–µ–Ω–∏—è `ExitAnalyzer` (action, reason, PnL)
2. ‚úÖ –í—Å–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è `TrailingSL` (—Ç—Ä–µ–π–ª, –ø—Ä–æ—Ñ–∏—Ç, multiplier)
3. ‚úÖ –í—Å–µ –æ—Ç–∫—Ä—ã—Ç–∏—è/–∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–π
4. ‚úÖ –í—Å–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –æ—Ä–¥–µ—Ä–æ–≤
5. ‚úÖ –í—Å–µ TP/SL —Ä–∞—Å—á—ë—Ç—ã (–≤–∫–ª—é—á–∞—è fallback)

### ‚ùå **–ù–µ–ª—å–∑—è –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ –ª–æ–≥–∞–º:**

1. ‚ùå Memory leak (–Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ)
2. ‚ùå –í—ã—Å–æ–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å (–Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –¥–µ—Ç–µ–∫—Ü–∏—é)
3. ‚ùå –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏)

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 30.11.2025  
**–í–µ—Ä—Å–∏—è:** 1.0



