# ‚úÖ –§–ò–ù–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó: Balance & Risk Management

## üéØ –ß—Ç–æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û:

### 1. ‚úÖ Balance Profiles (3 –ø—Ä–æ—Ñ–∏–ª—è)
```python
small:   $50  base, $10-$100 range
medium:  $200 base, $30-$250 range
large:   $500 base, $50-$500 range
```

### 2. ‚úÖ Regime Multiplier
```python
trending: 1.2x (–±–æ–ª—å—à–µ –≤ —Ç—Ä–µ–Ω–¥–µ)
ranging:  1.0x (—Å—Ç–∞–Ω–¥–∞—Ä—Ç)
choppy:   0.7x (–º–µ–Ω—å—à–µ –≤ —Ö–∞–æ—Å–µ)
```

### 3. ‚úÖ Strength Multiplier
```python
strength > 0.8:  1.5x (+50%)
strength > 0.6:  1.2x (+20%)
strength > 0.4:  1.0x (—Å—Ç–∞–Ω–¥–∞—Ä—Ç)
strength < 0.4:  0.8x (-20%)
```

### 4. ‚úÖ LEVERAGE & MARGIN (–î–û–ë–ê–í–õ–ï–ù–û!)
```python
leverage = 3x
notional_usd = margin * 3
position_size = notional_usd / price

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∞—Ä–∂–∏:
if margin > balance * 0.9:  # 90% –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
    margin = balance * 0.9
```

---

## üìä –ü–†–ò–ú–ï–†–´ –†–ê–°–ß–ï–¢–û–í:

### –ü—Ä–∏–º–µ—Ä 1: $500 + Trending + –°–∏–ª—å–Ω—ã–π —Å–∏–≥–Ω–∞–ª
```
–ë–∞–ª–∞–Ω—Å: $500
–ü—Ä–æ—Ñ–∏–ª—å: small ‚Üí $50
–†–µ–∂–∏–º: trending (1.2x) ‚Üí $60
–°–∏–≥–Ω–∞–ª: strong (1.5x) ‚Üí $90
–õ–µ–≤–µ—Ä–∏–¥–∂: 3x

Margin: $90
Notional: $270
Position: $270 / $4000 = 0.0675 ETH
```

### –ü—Ä–∏–º–µ—Ä 2: $2000 + Ranging + –°–ª–∞–±—ã–π —Å–∏–≥–Ω–∞–ª
```
–ë–∞–ª–∞–Ω—Å: $2000
–ü—Ä–æ—Ñ–∏–ª—å: medium ‚Üí $200
–†–µ–∂–∏–º: ranging (1.0x) ‚Üí $200
–°–∏–≥–Ω–∞–ª: weak (0.8x) ‚Üí $160
–õ–µ–≤–µ—Ä–∏–¥–∂: 3x

Margin: $160
Notional: $480
Position: $480 / $4000 = 0.12 ETH
```

---

## ‚ö†Ô∏è –†–ò–°–ö-–ú–ï–ù–ï–î–ñ–ú–ï–ù–¢:

### 1. Max Loss per Trade
**–ù–ï —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ!** –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:
```python
max_loss_usd = balance * 0.02  # 2% –º–∞–∫—Å–∏–º—É–º
sl_distance = entry - sl_price
max_position = max_loss_usd / sl_distance
```

### 2. Margin Call Protection
**–ù–ï —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ!** –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:
```python
total_margin_used = sum(all_positions.margin)
if total_margin_used > balance * 0.8:  # 80% –ª–∏–º–∏—Ç
    –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ –ø–æ–∑–∏—Ü–∏–∏
```

### 3. Position Size Limits
**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ —á–∞—Å—Ç–∏—á–Ω–æ** - –µ—Å—Ç—å min/max –ø–æ –ø—Ä–æ—Ñ–∏–ª—é, –Ω–æ –Ω–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –µ–¥–∏–Ω–∏—á–Ω—É—é –ø–æ–∑–∏—Ü–∏—é > –±–∞–ª–∞–Ω—Å–∞.

---

## üéØ –ò–¢–û–ì:

### ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:
1. ‚úÖ Balance Profiles
2. ‚úÖ Regime Multiplier
3. ‚úÖ Strength Multiplier
4. ‚úÖ Leverage —É—á–µ—Ç
5. ‚úÖ Margin –ø—Ä–æ–≤–µ—Ä–∫–∞ (90%)

### ‚ùå –ß—Ç–æ –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç:
1. ‚ùå Max Loss per Trade (2% –ª–∏–º–∏—Ç)
2. ‚ùå Max Margin Used (80% –ª–∏–º–∏—Ç)
3. ‚ùå Position Size Limits (–Ω–µ–ø–æ–ª–Ω–∞—è)
4. ‚ùå Drawdown Protection
5. ‚ùå Emergency Stop

---

## üö® –ö–†–ò–¢–ò–ß–ù–û: –ß—Ç–æ –¥–æ–±–∞–≤–∏—Ç—å?

### 1. Max Loss Per Trade
```python
# –í _calculate_position_size –¥–æ–±–∞–≤–∏—Ç—å:
max_loss_usd = balance * 0.02  # 2% –º–∞–∫—Å
sl_distance_pct = signal.get("sl_percent", 0.2)
max_position_usd = max_loss_usd / (sl_distance_pct / 100)

if usd_size > max_position_usd:
    usd_size = max_position_usd
    logger.warning(f"‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω max loss: {max_position_usd:.2f}")
```

### 2. Total Margin Used
```python
# –í orchestrator.py –¥–æ–±–∞–≤–∏—Ç—å:
async def can_open_position(self, new_margin):
    total_margin = sum(p["margin"] for p in self.active_positions.values())
    if total_margin + new_margin > self.balance * 0.8:
        return False
    return True
```

---

## ‚úÖ –î–æ–±–∞–≤–ª—è–µ–º –¥–∞–ª—å—à–µ?

**–•–æ—á–µ—à—å, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏–ª:**
1. Max Loss per Trade (2% –∑–∞—â–∏—Ç—ã)
2. Max Margin Used (80% –ª–∏–º–∏—Ç)
3. Drawdown Protection (—Å—Ç–æ–ø –ø—Ä–∏ -5%)
4. Emergency Stop (–ø—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–º –±–∞–ª–∞–Ω—Å–µ)

**–ò–ª–∏ —Ç–µ—Å—Ç–∏—Ä—É–µ–º —Ç–µ–∫—É—â—É—é –≤–µ—Ä—Å–∏—é?** ü§î


