# üîç –ê–ù–ê–õ–ò–ó –í–ò–°–Ø–©–ò–• –û–¢–†–ò–¶–ê–¢–ï–õ–¨–ù–´–• –ü–û–ó–ò–¶–ò–ô

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** 2025-12-07  
**–ó–∞–ø—Ä–æ—à–µ–Ω–æ:** –ö–∏–º–æ–π  
**–ü—Ä–æ–±–ª–µ–º–∞:** 2 –ø–æ–∑–∏—Ü–∏–∏ –∑–∞–∫—Ä—ã–ª–∏—Å—å, 4 –ø–æ–∑–∏—Ü–∏–∏ –≤–∏—Å—è—Ç —Å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º PnL –∏ –±–ª–æ–∫–∏—Ä—É—é—Ç —Ç–æ—Ä–≥–æ–≤–ª—é

---

## üìã –ß–¢–û –ù–£–ñ–ù–û –î–õ–Ø –ê–ù–ê–õ–ò–ó–ê

### 1. –í–∏—Å—è—â–∏–µ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏

**–§–∞–π–ª:** `positions_open.csv` (–∏–ª–∏ `logs/positions_open_YYYY-MM-DD.csv`)

**–ó–∞–ø—Ä–æ—Å:** –í—Å–µ —Å—Ç—Ä–æ–∫–∏, –≥–¥–µ `net_pnl < 0` –∏–ª–∏ `unrealized_pnl < 0`

**–¶–µ–ª—å:** –£–≤–∏–¥–µ—Ç—å, –∫–∞–∫–∏–µ –∏–º–µ–Ω–Ω–æ –ø–æ–∑–∏—Ü–∏–∏ –≤–∏—Å—è—Ç, —Å–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏, –ø–æ –∫–∞–∫–æ–º—É —Ä–µ–∂–∏–º—É, –ø–æ –∫–∞–∫–æ–º—É SL/TP.

---

### 2. –ü—Ä–∏—á–∏–Ω–∞ –∑–∞–∫—Ä—ã—Ç–∏—è (–µ—Å–ª–∏ –±—ã–ª–∞)

**–§–∞–π–ª:** `trades.csv` (–∏–ª–∏ `logs/trades_YYYY-MM-DD.csv`) ‚Äî –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 —Å—Ç—Ä–æ–∫

**–ó–∞–ø—Ä–æ—Å:** –° –∫–æ–ª–æ–Ω–∫–æ–π `reason`, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å, –ø–æ –∫–∞–∫–æ–º—É —Ñ–∏–ª—å—Ç—Ä—É/–ø–∞—Ä–∞–º–µ—Ç—Ä—É –∑–∞–∫—Ä—ã–ª–∏—Å—å –ø—Ä–∏–±—ã–ª—å–Ω—ã–µ, –∞ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ ‚Äî –Ω–µ—Ç.

---

### 3. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≤—ã—Ö–æ–¥–∞ –¥–ª—è –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö

**–§–∞–π–ª:** `config/config_futures.yaml`

**–ö–ª—é—á–µ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:**

#### Stop Loss (SL):
```yaml
scalping:
  sl_percent: 1.2  # –ë–∞–∑–æ–≤—ã–π SL 1.2%
  
  adaptive_regime:
    trending:
      sl_percent: 1.5  # SL –¥–ª—è trending
    ranging:
      sl_percent: 2.0  # SL –¥–ª—è ranging
    choppy:
      sl_percent: 1.0  # SL –¥–ª—è choppy
```

#### –ü—Ä–æ–¥–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è –ø—Ä–∏–±—ã–ª—å–Ω—ã—Ö:
```yaml
scalping:
  adaptive_regime:
    trending:
      extend_time_if_profitable: true
      min_profit_for_extension: 0.5  # –ú–∏–Ω–∏–º—É–º 0.5% –ø—Ä–∏–±—ã–ª–∏ –¥–ª—è –ø—Ä–æ–¥–ª–µ–Ω–∏—è
      extension_percent: 100  # –ü—Ä–æ–¥–ª–µ–≤–∞—Ç—å –Ω–∞ 100% –≤—Ä–µ–º–µ–Ω–∏
    ranging:
      extend_time_if_profitable: true
      min_profit_for_extension: 0.5
      extension_percent: 100
    choppy:
      extend_time_if_profitable: false  # –í —Ö–∞–æ—Å–µ –ù–ï –ø—Ä–æ–¥–ª–µ–≤–∞–µ–º
```

#### Profit Drawdown Protection:
```yaml
scalping:
  profit_drawdown:
    enabled: true
    drawdown_percent: 0.35  # 35% –æ—Ç–∫–∞—Ç –æ—Ç –º–∞–∫—Å–∏–º—É–º–∞ –ø—Ä–∏–±—ã–ª–∏
    min_profit_to_activate_usd: 0.5
```

#### –õ–∏–º–∏—Ç—ã –ø–æ–∑–∏—Ü–∏–π:
```yaml
scalping:
  max_open_positions: 5  # –ú–∞–∫—Å–∏–º—É–º 5 –ø–æ–∑–∏—Ü–∏–π
  max_positions_per_symbol: 1  # –ü–æ –æ–¥–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏ –Ω–∞ —Å–∏–º–≤–æ–ª
  allow_concurrent_positions: false  # –ù–µ –Ω–∞–∫–∞–ø–ª–∏–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏–∏
```

#### –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å:
```yaml
risk:
  base:
    min_balance_usd: 20.0  # –ú–∏–Ω–∏–º—É–º $20 –±–∞–ª–∞–Ω—Å–∞
  by_balance:
    small:  # $500 - $1500
      min_balance_usd: 20.0
```

---

### 4. –ö–æ–¥ –≤—ã—Ö–æ–¥–∞ –¥–ª—è –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π

**–§–∞–π–ª:** `src/strategies/scalping/futures/positions/exit_analyzer.py`

#### –ö–ª—é—á–µ–≤–æ–π –∫–æ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π:

**–°—Ç—Ä–æ–∫–∏ 1294-1307 (TRENDING —Ä–µ–∂–∏–º):**
```python
# ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –ù–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º —É–±—ã—Ç–æ—á–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –ø–æ max_holding
# –ü–æ–∑–≤–æ–ª—è–µ–º –∏–º –¥–æ–π—Ç–∏ –¥–æ SL –∏–ª–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è
if pnl_percent < 0:
    logger.info(
        f"‚è∞ ExitAnalyzer TRENDING: –í—Ä–µ–º—è {minutes_in_position:.1f} –º–∏–Ω >= {max_holding_minutes:.1f} –º–∏–Ω, "
        f"–Ω–æ –ø–æ–∑–∏—Ü–∏—è –≤ —É–±—ã—Ç–∫–µ ({pnl_percent:.2f}%) - –ù–ï –∑–∞–∫—Ä—ã–≤–∞–µ–º, –∂–¥–µ–º SL –∏–ª–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è"
    )
    return {
        "action": "hold",
        "reason": "max_holding_exceeded_but_loss_trending",
        "pnl_pct": pnl_percent,
        "trend_strength": trend_strength,
        "minutes_in_position": minutes_in_position,
    }
```

**–°—Ç—Ä–æ–∫–∏ 1592-1605 (RANGING —Ä–µ–∂–∏–º):**
```python
# ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –ù–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º —É–±—ã—Ç–æ—á–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –ø–æ max_holding
# –ü–æ–∑–≤–æ–ª—è–µ–º –∏–º –¥–æ–π—Ç–∏ –¥–æ SL –∏–ª–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è
if pnl_percent < 0:
    logger.info(
        f"‚è∞ ExitAnalyzer RANGING: –í—Ä–µ–º—è {minutes_in_position:.1f} –º–∏–Ω >= {actual_max_holding:.1f} –º–∏–Ω, "
        f"–Ω–æ –ø–æ–∑–∏—Ü–∏—è –≤ —É–±—ã—Ç–∫–µ ({pnl_percent:.2f}%) - –ù–ï –∑–∞–∫—Ä—ã–≤–∞–µ–º, –∂–¥–µ–º SL –∏–ª–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è"
    )
    return {
        "action": "hold",
        "reason": "max_holding_exceeded_but_loss",
        "pnl_pct": pnl_percent,
        "minutes_in_position": minutes_in_position,
        "max_holding_minutes": actual_max_holding,
    }
```

**–°—Ç—Ä–æ–∫–∏ 1821-1834 (CHOPPY —Ä–µ–∂–∏–º):**
```python
# ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –ù–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º —É–±—ã—Ç–æ—á–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –ø–æ max_holding –¥–∞–∂–µ –≤ choppy
# –ü–æ–∑–≤–æ–ª—è–µ–º –∏–º –¥–æ–π—Ç–∏ –¥–æ SL –∏–ª–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è
if pnl_percent < 0:
    logger.info(
        f"‚è∞ ExitAnalyzer CHOPPY: –í—Ä–µ–º—è {minutes_in_position:.1f} –º–∏–Ω >= {max_holding_minutes:.1f} –º–∏–Ω, "
        f"–Ω–æ –ø–æ–∑–∏—Ü–∏—è –≤ —É–±—ã—Ç–∫–µ ({pnl_percent:.2f}%) - –ù–ï –∑–∞–∫—Ä—ã–≤–∞–µ–º, –∂–¥–µ–º SL –∏–ª–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è"
    )
    return {
        "action": "hold",
        "reason": "max_holding_exceeded_but_loss_choppy",
        "pnl_pct": pnl_percent,
        "minutes_in_position": minutes_in_position,
        "max_holding_minutes": max_holding_minutes,
    }
```

#### –õ–æ–≥–∏–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ PnL (—Å—Ç—Ä–æ–∫–∏ 279-457):

**–ö–ª—é—á–µ–≤–æ–π –º–æ–º–µ–Ω—Ç:** PnL% —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –æ—Ç –º–∞—Ä–∂–∏ (–∫–∞–∫ –Ω–∞ –±–∏—Ä–∂–µ), –∞ –Ω–µ –æ—Ç —Ü–µ–Ω—ã:

```python
def _calculate_pnl_percent(
    self,
    entry_price: float,
    current_price: float,
    position_side: str,
    include_fees: bool = True,
    entry_time: Optional[datetime] = None,
    position: Optional[Any] = None,
    metadata: Optional[Any] = None,
) -> float:
    """
    ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –î–ª—è —Ñ—å—é—á–µ—Ä—Å–æ–≤ —Å—á–∏—Ç–∞–µ–º PnL% –æ—Ç –ú–ê–†–ñ–ò, –∞ –Ω–µ –æ—Ç —Ü–µ–Ω—ã!
    –ë–∏—Ä–∂–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç PnL% –æ—Ç –º–∞—Ä–∂–∏ (—Å —É—á–µ—Ç–æ–º –ø–ª–µ—á–∞), –ø–æ—ç—Ç–æ–º—É –Ω–∞—à —Ä–∞—Å—á–µ—Ç –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å.
    """
    # –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å margin –∏ unrealizedPnl –∏–∑ position –∏–ª–∏ metadata
    # –ï—Å–ª–∏ –ø–æ–ª—É—á–∏–ª–∏ - —Å—á–∏—Ç–∞–µ–º –æ—Ç –º–∞—Ä–∂–∏ (–∫–∞–∫ –Ω–∞ –±–∏—Ä–∂–µ)
    if margin_used and margin_used > 0 and unrealized_pnl is not None:
        gross_pnl_pct = (unrealized_pnl / margin_used) * 100
        # –£—á–∏—Ç—ã–≤–∞–µ–º –∫–æ–º–∏—Å—Å–∏—é –µ—Å–ª–∏ –ø—Ä–æ—à–ª–æ >10 —Å–µ–∫—É–Ω–¥
        if include_fees and seconds_since_open >= 10.0:
            commission_pct = trading_fee_rate * 100  # 0.1% = 0.1
            net_pnl_pct = gross_pnl_pct - commission_pct
            return net_pnl_pct
```

---

## üìÅ –í–°–ï –§–ê–ô–õ–´, –ó–ê–î–ï–ô–°–¢–í–û–í–ê–ù–ù–´–ï –í –¢–û–†–ì–û–í–õ–ï

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã —Ç–æ—Ä–≥–æ–≤–ª–∏:

1. **`src/strategies/scalping/futures/orchestrator.py`**
   - –ì–ª–∞–≤–Ω—ã–π –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä —Ç–æ—Ä–≥–æ–≤–ª–∏
   - –£–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ç–∫—Ä—ã—Ç–∏–µ–º/–∑–∞–∫—Ä—ã—Ç–∏–µ–º –ø–æ–∑–∏—Ü–∏–π
   - –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç –≤—Å–µ –º–æ–¥—É–ª–∏

2. **`src/strategies/scalping/futures/position_manager.py`**
   - –ú–µ–Ω–µ–¥–∂–µ—Ä –ø–æ–∑–∏—Ü–∏–π
   - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç—ã–º–∏ –ø–æ–∑–∏—Ü–∏—è–º–∏
   - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –º–∞—Ä–∂–∏ –∏ —Ä–∏—Å–∫–æ–≤

3. **`src/strategies/scalping/futures/positions/exit_analyzer.py`**
   - **–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –§–ê–ô–õ** - –∞–Ω–∞–ª–∏–∑ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–π
   - –ü—Ä–∏–Ω–∏–º–∞–µ—Ç —Ä–µ—à–µ–Ω–∏—è –æ –∑–∞–∫—Ä—ã—Ç–∏–∏/—É–¥–µ—Ä–∂–∞–Ω–∏–∏
   - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏

4. **`src/strategies/scalping/futures/positions/position_monitor.py`**
   - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ–∑–∏—Ü–∏–π
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ TP/SL
   - Trailing Stop Loss

5. **`src/strategies/scalping/futures/positions/entry_manager.py`**
   - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Ö–æ–¥–æ–º –≤ –ø–æ–∑–∏—Ü–∏–∏
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π –æ—Ç–∫—Ä—ã—Ç–∏—è

6. **`config/config_futures.yaml`**
   - **–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –§–ê–ô–õ** - –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ç–æ—Ä–≥–æ–≤–ª–∏
   - SL/TP –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
   - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—Ä–æ–¥–ª–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏
   - –õ–∏–º–∏—Ç—ã –ø–æ–∑–∏—Ü–∏–π

### –§–∞–π–ª—ã –¥–∞–Ω–Ω—ã—Ö:

7. **`logs/trades_YYYY-MM-DD.csv`** (–∏–ª–∏ `data/exports/trades_*.csv`)
   - –ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫—Ä—ã—Ç—ã—Ö —Å–¥–µ–ª–æ–∫
   - –ö–æ–ª–æ–Ω–∫–∞ `reason` —Å –ø—Ä–∏—á–∏–Ω–æ–π –∑–∞–∫—Ä—ã—Ç–∏—è

8. **`logs/positions_open_YYYY-MM-DD.csv`**
   - –¢–µ–∫—É—â–∏–µ –æ—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ–∑–∏—Ü–∏–∏
   - –ö–æ–ª–æ–Ω–∫–∏: `symbol`, `side`, `entry_price`, `current_price`, `net_pnl`, `unrealized_pnl`, `regime`, `entry_time`

9. **`logs/futures/archived/logs_2025-12-07_19-42-03/`**
   - –ê—Ä—Ö–∏–≤ –ª–æ–≥–æ–≤ –∑–∞ 07.12.2025
   - –°–æ–¥–µ—Ä–∂–∏—Ç –¥–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ —Ç–æ—Ä–≥–æ–≤–ª–∏

### –§–∞–π–ª—ã –ª–æ–≥–∏–∫–∏ –≤—ã—Ö–æ–¥–∞:

10. **`src/strategies/scalping/futures/calculations/margin_calculator.py`**
    - –†–∞—Å—á–µ—Ç –º–∞—Ä–∂–∏
    - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤

11. **`src/strategies/scalping/futures/core/position_registry.py`**
    - –†–µ–µ—Å—Ç—Ä –ø–æ–∑–∏—Ü–∏–π
    - –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–π

12. **`src/strategies/scalping/futures/core/data_registry.py`**
    - –†–µ–µ—Å—Ç—Ä —Ä—ã–Ω–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    - –¶–µ–Ω—ã, —Ä–µ–∂–∏–º—ã —Ä—ã–Ω–∫–∞

---

## üîç –ö–õ–Æ–ß–ï–í–´–ï –ú–û–ú–ï–ù–¢–´ –î–õ–Ø –ê–ù–ê–õ–ò–ó–ê

### 1. –ü–æ—á–µ–º—É –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –Ω–µ –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è?

**–ö–æ–¥ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:**
- –ü—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ `max_holding_minutes` –∏ `pnl_percent < 0` ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è `action: "hold"`
- –ü–æ–∑–∏—Ü–∏–∏ –ù–ï –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è –ø–æ –≤—Ä–µ–º–µ–Ω–∏, –µ—Å–ª–∏ –æ–Ω–∏ –≤ —É–±—ã—Ç–∫–µ
- –û–∂–∏–¥–∞–µ—Ç—Å—è –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ SL –∏–ª–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ

**–í–æ–ø—Ä–æ—Å—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:**
- –°—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ª–∏ SL –¥–ª—è –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π?
- –ö–∞–∫–æ–π —Ç–µ–∫—É—â–∏–π `pnl_percent` —É –≤–∏—Å—è—â–∏—Ö –ø–æ–∑–∏—Ü–∏–π?
- –ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏ `max_holding_minutes`?
- –ö–∞–∫–æ–π —Ä–µ–∂–∏–º —Ä—ã–Ω–∫–∞ (trending/ranging/choppy) —É –≤–∏—Å—è—â–∏—Ö –ø–æ–∑–∏—Ü–∏–π?

### 2. –ì–¥–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –Ω–æ–≤–∞—è —Ç–æ—Ä–≥–æ–≤–ª—è?

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏:**

#### A. –õ–∏–º–∏—Ç –ø–æ–∑–∏—Ü–∏–π:
```yaml
scalping:
  max_open_positions: 5  # –ú–∞–∫—Å–∏–º—É–º 5 –ø–æ–∑–∏—Ü–∏–π
  max_positions_per_symbol: 1  # –ü–æ –æ–¥–Ω–æ–π –Ω–∞ —Å–∏–º–≤–æ–ª
```

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- –°–∫–æ–ª—å–∫–æ –ø–æ–∑–∏—Ü–∏–π –æ—Ç–∫—Ä—ã—Ç–æ —Å–µ–π—á–∞—Å?
- –ï—Å—Ç—å –ª–∏ —Å–≤–æ–±–æ–¥–Ω—ã–µ —Å–ª–æ—Ç—ã –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–∑–∏—Ü–∏–π?

#### B. –ë–∞–ª–∞–Ω—Å:
```yaml
risk:
  base:
    min_balance_usd: 20.0
```

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- –¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å
- –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ª–∏ –º–∞—Ä–∂–∏ –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–∑–∏—Ü–∏–π?

#### C. Cooldown:
```yaml
scalping:
  signal_cooldown_seconds: 60.0  # 60 —Å–µ–∫ cooldown
```

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- –ö–æ–≥–¥–∞ –±—ã–ª–∞ –ø–æ—Å–ª–µ–¥–Ω—è—è —Å–¥–µ–ª–∫–∞?
- –ü—Ä–æ—à–µ–ª –ª–∏ cooldown?

#### D. –§–∏–ª—å—Ç—Ä—ã:
- Liquidity Filter
- Order Flow Filter
- Funding Filter
- Volatility Filter

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –ª–æ–≥–∞—Ö:**
- –ï—Å—Ç—å –ª–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –æ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ —Å–∏–≥–Ω–∞–ª–æ–≤?
- –ö–∞–∫–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã –±–ª–æ–∫–∏—Ä—É—é—Ç –Ω–æ–≤—ã–µ –≤—Ö–æ–¥—ã?

### 3. –ü–æ—á–µ–º—É –∑–∞–∫—Ä—ã–ª–∏—Å—å 2 –ø–æ–∑–∏—Ü–∏–∏, –∞ 4 –≤–∏—Å—è—Ç?

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
- –ó–∞–∫—Ä—ã—Ç—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –±—ã–ª–∏ –≤ –ø—Ä–∏–±—ã–ª–∏ ‚Üí –∑–∞–∫—Ä—ã–ª–∏—Å—å –ø–æ TP/big_profit_exit
- –í–∏—Å—è—â–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –≤ —É–±—ã—Ç–∫–µ ‚Üí –Ω–µ –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è –ø–æ –≤—Ä–µ–º–µ–Ω–∏, –∂–¥—É—Ç SL –∏–ª–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ `trades.csv`:**
- –ö–∞–∫–∞—è –±—ã–ª–∞ –ø—Ä–∏—á–∏–Ω–∞ –∑–∞–∫—Ä—ã—Ç–∏—è (`reason`) –¥–ª—è –∑–∞–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π?
- –ö–∞–∫–æ–π –±—ã–ª `net_pnl` —É –∑–∞–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π?

---

## üìä –ß–¢–û –ü–†–ò–°–õ–ê–¢–¨ –ö–ò–ú–ï (1 –∑–∞–ø—Ä–æ—Å)

### 1. –í—Å–µ —Å—Ç—Ä–æ–∫–∏ –∏–∑ `positions_open.csv` –≥–¥–µ `net_pnl < 0`

**–ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è:**
```powershell
Import-Csv "logs\positions_open_2025-12-07.csv" | Where-Object { [float]$_.net_pnl -lt 0 } | Format-Table
```

**–ò–ª–∏ —á–µ—Ä–µ–∑ Python:**
```python
import pandas as pd
df = pd.read_csv("logs/positions_open_2025-12-07.csv")
negative = df[df['net_pnl'] < 0]
print(negative.to_string())
```

### 2. –ü–æ—Å–ª–µ–¥–Ω–∏–µ 10 —Å—Ç—Ä–æ–∫ `trades.csv` —Å –∫–æ–ª–æ–Ω–∫–æ–π `reason`

**–ö–æ–º–∞–Ω–¥–∞:**
```powershell
Import-Csv "logs\trades_2025-12-07.csv" | Select-Object -Last 10 | Format-Table
```

### 3. –ó–Ω–∞—á–µ–Ω–∏—è SL/–≤—ã—Ö–æ–¥–∞ –∏–∑ `config_futures.yaml`

**–£–∂–µ —É–∫–∞–∑–∞–Ω—ã –≤—ã—à–µ –≤ —Ä–∞–∑–¥–µ–ª–µ "3. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≤—ã—Ö–æ–¥–∞ –¥–ª—è –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö"**

### 4. 30 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞ –∏–∑ `exit_analyzer.py` –≥–¥–µ —Ä–µ—à–∞–µ—Ç—Å—è, –∑–∞–∫—Ä—ã–≤–∞—Ç—å —É–±—ã—Ç–æ—á–Ω—É—é –∏–ª–∏ –Ω–µ—Ç

**–£–∂–µ —É–∫–∞–∑–∞–Ω—ã –≤—ã—à–µ –≤ —Ä–∞–∑–¥–µ–ª–µ "4. –ö–æ–¥ –≤—ã—Ö–æ–¥–∞ –¥–ª—è –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π"**

**–ö–ª—é—á–µ–≤—ã–µ —Å—Ç—Ä–æ–∫–∏:**
- **1294-1307** (TRENDING —Ä–µ–∂–∏–º)
- **1592-1605** (RANGING —Ä–µ–∂–∏–º)
- **1821-1834** (CHOPPY —Ä–µ–∂–∏–º)

---

## üéØ –í–´–í–û–î–´ –ò –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### –¢–µ–∫—É—â–∞—è –ª–æ–≥–∏–∫–∞:
1. ‚úÖ –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –ù–ï –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è –ø–æ `max_holding` - —ç—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ
2. ‚úÖ –û–∂–∏–¥–∞–µ—Ç—Å—è –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ SL –∏–ª–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
3. ‚ö†Ô∏è **–ü–†–û–ë–õ–ï–ú–ê:** –ï—Å–ª–∏ SL –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç, –ø–æ–∑–∏—Ü–∏–∏ –≤–∏—Å—è—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ

### –í–æ–ø—Ä–æ—Å—ã –¥–ª—è –ö–∏–º—ã:
1. –ü–æ—á–µ–º—É SL –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–ª—è –≤–∏—Å—è—â–∏—Ö –ø–æ–∑–∏—Ü–∏–π?
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏–∫—É Trailing Stop Loss
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è PnL%
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –¥–æ—Å—Ç–∏–≥–∞—é—Ç –ª–∏ –ø–æ–∑–∏—Ü–∏–∏ —É—Ä–æ–≤–Ω—è SL

2. –ì–¥–µ –∏–º–µ–Ω–Ω–æ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –Ω–æ–≤–∞—è —Ç–æ—Ä–≥–æ–≤–ª—è?
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–∏–º–∏—Ç –ø–æ–∑–∏—Ü–∏–π (`max_open_positions`)
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–ª–∞–Ω—Å –∏ –º–∞—Ä–∂—É
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –∏ cooldown

3. –ü–æ—á–µ–º—É –∑–∞–∫—Ä—ã–ª–∏—Å—å 2 –ø–æ–∑–∏—Ü–∏–∏, –∞ 4 –≤–∏—Å—è—Ç?
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `reason` –∑–∞–∫—Ä—ã—Ç–∏—è –≤ `trades.csv`
   - –°—Ä–∞–≤–Ω–∏—Ç—å PnL –∑–∞–∫—Ä—ã—Ç—ã—Ö –∏ –≤–∏—Å—è—â–∏—Ö –ø–æ–∑–∏—Ü–∏–π

---

## üìù –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø

### –õ–æ–≥–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞:
- **–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è:** `logs/futures/archived/logs_2025-12-07_19-42-03/`
- **–§–∞–π–ª—ã:**
  - `futures_main_2025-12-07.*.log.zip` - –æ—Å–Ω–æ–≤–Ω—ã–µ –ª–æ–≥–∏
  - `errors_2025-12-07.log` - –æ—à–∏–±–∫–∏
  - `debug_20251207_*.csv` - –æ—Ç–ª–∞–¥–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

### –ö–ª—é—á–µ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –ª–æ–≥–∞—Ö –¥–ª—è –ø–æ–∏—Å–∫–∞:
- `"‚è∞ ExitAnalyzer ... –ø–æ–∑–∏—Ü–∏—è –≤ —É–±—ã—Ç–∫–µ ... –ù–ï –∑–∞–∫—Ä—ã–≤–∞–µ–º"`
- `"max_holding_exceeded_but_loss"`
- `"action": "hold"`
- `"reason": "max_holding_exceeded_but_loss_*"`

---

**–°–æ–∑–¥–∞–Ω–æ:** 2025-12-07  
**–î–ª—è:** –ö–∏–º—ã  
**–¶–µ–ª—å:** –ù–∞–π—Ç–∏ —Ç–æ—á–∫—É –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Ç–æ—Ä–≥–æ–≤–ª–∏ –∏ –ø—Ä–∏—á–∏–Ω—É –≤–∏—Å—è—â–∏—Ö –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π

