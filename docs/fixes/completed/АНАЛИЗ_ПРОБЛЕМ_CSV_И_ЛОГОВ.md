# üìä –ê–ù–ê–õ–ò–ó –ü–†–û–ë–õ–ï–ú CSV –ò –õ–û–ì–û–í

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** 2025-11-28  
**–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–∞–ø–∫–∏:**
- `logs/futures/` (–≤—Å–µ —Ñ–∞–π–ª—ã –∫—Ä–æ–º–µ –∞—Ä—Ö–∏–≤–∞)
- `logs/` (CSV —Ñ–∞–π–ª—ã —Ç–µ–∫—É—â–µ–π —Å–µ—Å—Å–∏–∏)

---

## üîç –û–ë–ù–ê–†–£–ñ–ï–ù–ù–´–ï –ü–†–û–ë–õ–ï–ú–´

### ‚ùå –ü–†–û–ë–õ–ï–ú–ê #1: CSV —Ñ–∞–π–ª –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è –¥–ª—è —Ç–µ–∫—É—â–µ–π –¥–∞—Ç—ã

**–°—Ç–∞—Ç—É—Å:** üî¥ –ö–†–ò–¢–ò–ß–ù–û

**–î–µ—Ç–∞–ª–∏:**
- –§–∞–π–ª `logs/trades_2025-11-28.csv` **–ù–ï –°–£–©–ï–°–¢–í–£–ï–¢**
- –§–∞–π–ª `logs/trades_2025-11-27.csv` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –Ω–æ **–ü–£–°–¢–û–ô** (—Ç–æ–ª—å–∫–æ –∑–∞–≥–æ–ª–æ–≤–æ–∫, 109 –±–∞–π—Ç)
- –ü–æ–∑–∏—Ü–∏—è **BTC-USDT –±—ã–ª–∞ –∑–∞–∫—Ä—ã—Ç–∞** 28.11.2025 –≤ 05:13:38 –ø–æ –ø—Ä–∏—á–∏–Ω–µ `tp` (take profit)
- –ó–∞–∫—Ä—ã—Ç–∏–µ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –≤ `logs/futures/info_2025-11-28.log`, –Ω–æ **–ù–ï –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ CSV**

**–õ–æ–≥–∏ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏:**
```
2025-11-28 05:13:38.049 | INFO | –ü–û–ó–ò–¶–ò–Ø –ó–ê–ö–†–´–¢–ê: BTC-USDT SHORT
   Entry price: $91480.000000
   Exit price: $90579.200000
   Gross PnL: $+2.1619 USDT
   Net PnL: $+1.9434 USDT
   –ü—Ä–∏—á–∏–Ω–∞ –∑–∞–∫—Ä—ã—Ç–∏—è: tp
```

**–¶–µ–ø–æ—á–∫–∞ –≤—ã–∑–æ–≤–æ–≤ (–æ–∂–∏–¥–∞–µ–º–∞—è):**
1. `orchestrator._close_position()` ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç
2. `position_manager.close_position_manually()` ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `TradeResult` ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç
3. `performance_tracker.record_trade(trade_result)` ‚Üí –¥–æ–ª–∂–µ–Ω –∑–∞–ø–∏—Å–∞—Ç—å –≤ CSV

**–ü—Ä–æ–±–ª–µ–º—ã –≤ —Ü–µ–ø–æ—á–∫–µ:**

#### üî¥ –ü–æ–¥–ø—Ä–æ–±–ª–µ–º–∞ #1.1: –ù–µ—Ç –∑–∞–ø–∏—Å–µ–π –æ–± –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ PerformanceTracker

**–ß—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ –ª–æ–≥–∞—Ö:**
```
‚úÖ PerformanceTracker initialized
üìä Created new trades CSV: logs/trades_2025-11-28.csv
```
–∏–ª–∏
```
‚úÖ PerformanceTracker initialized
üìä Using existing trades CSV: logs/trades_2025-11-28.csv
```

**–ß—Ç–æ –Ω–∞–π–¥–µ–Ω–æ:** ‚ùå **–ù–ï–¢ —Ç–∞–∫–∏—Ö –∑–∞–ø–∏—Å–µ–π –≤ –ª–æ–≥–∞—Ö**

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
1. PerformanceTracker –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è (–º–∞–ª–æ–≤–µ—Ä–æ—è—Ç–Ω–æ, –∫–æ–¥ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–∞ —Å—Ç—Ä–æ–∫–µ 301 `orchestrator.py`)
2. –õ–æ–≥–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–¥—É—Ç –≤ –¥—Ä—É–≥–æ–π —Ñ–∞–π–ª (–Ω–∞–ø—Ä–∏–º–µ—Ä, `futures_main_2025-11-28.log`), –∞ –Ω–µ –≤ `info_2025-11-28.log`
3. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –Ω–∞ —É—Ä–æ–≤–µ–Ω—å –≤—ã—à–µ INFO, –∏ —ç—Ç–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è

#### üî¥ –ü–æ–¥–ø—Ä–æ–±–ª–µ–º–∞ #1.2: –ù–µ—Ç –∑–∞–ø–∏—Å–µ–π –æ record_trade

**–ß—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ –ª–æ–≥–∞—Ö:**
```
‚úÖ –°–¥–µ–ª–∫–∞ BTC-USDT –∑–∞–ø–∏—Å–∞–Ω–∞ –≤ CSV
üìä TRADE RECORDED | Total: 1 | Win Rate: 100.0% | Daily PnL: $1.94
```

**–ß—Ç–æ –Ω–∞–π–¥–µ–Ω–æ:** ‚ùå **–ù–ï–¢ —Ç–∞–∫–∏—Ö –∑–∞–ø–∏—Å–µ–π –≤ –ª–æ–≥–∞—Ö**

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
1. `record_trade()` –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è (–ø—Ä–æ–≤–µ—Ä–∫–∞ `hasattr(self, "performance_tracker")` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç False)
2. `trade_result` —Ä–∞–≤–µ–Ω `None` (–ø—Ä–æ–≤–µ—Ä–∫–∞ `if trade_result` –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç)
3. –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –≤ `record_trade()` –∏–ª–∏ `_export_trade_to_csv()` –∫–æ—Ç–æ—Ä–æ–µ –Ω–µ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –¥–æ–ª–∂–Ω—ã–º –æ–±—Ä–∞–∑–æ–º
4. –õ–æ–≥–∏ –∏–¥—É—Ç –Ω–∞ —É—Ä–æ–≤–µ–Ω—å DEBUG, –∞ –≤ `info_*.log` —Ç–æ–ª—å–∫–æ INFO

#### üî¥ –ü–æ–¥–ø—Ä–æ–±–ª–µ–º–∞ #1.3: –ü—Ä–æ–±–ª–µ–º–∞ —Å —á–∞—Å–æ–≤—ã–º –ø–æ—è—Å–æ–º (datetime.utcnow)

**–ö–æ–¥ –≤ `performance_tracker.py:50`:**
```python
today = datetime.utcnow().strftime("%Y-%m-%d")
self.csv_path = f"logs/trades_{today}.csv"
```

**–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞:**
- –ï—Å–ª–∏ —Ç–µ–∫—É—â–µ–µ –ª–æ–∫–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è 05:13 (28.11.2025), –Ω–æ UTC –≤—Ä–µ–º—è –µ—â–µ 27.11.2025 22:13 (—Ä–∞–∑–Ω–∏—Ü–∞ ~3 —á–∞—Å–∞ –¥–ª—è –ú–æ—Å–∫–≤—ã), —Ç–æ:
  - –§–∞–π–ª –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å—Å—è –∫–∞–∫ `trades_2025-11-27.csv` –≤–º–µ—Å—Ç–æ `trades_2025-11-28.csv`
  - –ó–∞–ø–∏—Å–∏ –±—É–¥—É—Ç –∏–¥—Ç–∏ –≤ —Ñ–∞–π–ª –ø—Ä–µ–¥—ã–¥—É—â–µ–π –¥–∞—Ç—ã
  - –ù–æ —Ñ–∞–π–ª `trades_2025-11-27.csv` –ø—É—Å—Ç–æ–π, –∑–Ω–∞—á–∏—Ç –∑–∞–ø–∏—Å–∏ –≤–æ–æ–±—â–µ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- –í—Ä–µ–º—è –≤ –ª–æ–≥–∞—Ö: `2025-11-28 05:13:38` (–ª–æ–∫–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è)
- –ï—Å–ª–∏ UTC = –ª–æ–∫–∞–ª—å–Ω–æ–µ - 3 —á–∞—Å–∞, —Ç–æ UTC –≤—Ä–µ–º—è = `2025-11-28 02:13:38` (–µ—â–µ 28.11)
- –ó–Ω–∞—á–∏—Ç, —Ñ–∞–π–ª –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `trades_2025-11-28.csv` ‚úÖ

**–í—ã–≤–æ–¥:** –ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å **–ù–ï —è–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏—á–∏–Ω–æ–π** –ø—Ä–æ–±–ª–µ–º—ã (–≤ –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ).

---

### ‚ùå –ü–†–û–ë–õ–ï–ú–ê #2: –ê—Ä—Ö–∏–≤–∞—Ü–∏—è –ª–æ–≥–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–ª–∏—à–∫–æ–º –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ

**–°—Ç–∞—Ç—É—Å:** üü° –°–†–ï–î–ù–ï–ô –ü–†–ò–û–†–ò–¢–ï–¢

**–î–µ—Ç–∞–ª–∏:**
- –í `logs/futures/` –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ **111 zip-—Ñ–∞–π–ª–æ–≤** —Å –∞—Ä—Ö–∏–≤–∞–º–∏ –ª–æ–≥–æ–≤
- –†–æ—Ç–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∫–∞–∂–¥—ã–µ 10-15 –º–∏–Ω—É—Ç (—Å—É–¥—è –ø–æ –∏–º–µ–Ω–∞–º —Ñ–∞–π–ª–æ–≤)
- –ü—Ä–∏–º–µ—Ä—ã:
  - `futures_main_2025-11-28.2025-11-28_00-05-07_046547.log.zip`
  - `futures_main_2025-11-28.2025-11-28_00-17-33_039647.log.zip`
  - `futures_main_2025-11-28.2025-11-28_00-28-56_884048.log.zip`

**–ü—Ä–æ–±–ª–µ–º—ã:**
1. –°–ª–∏—à–∫–æ–º —á–∞—Å—Ç—ã–µ —Ä–æ—Ç–∞—Ü–∏–∏ –º–æ–≥—É—Ç –º–µ—à–∞—Ç—å –∞–Ω–∞–ª–∏–∑—É —Ç–µ–∫—É—â–∏—Ö –ª–æ–≥–æ–≤
2. –ú–Ω–æ–≥–æ –º–∞–ª–µ–Ω—å–∫–∏—Ö –∞—Ä—Ö–∏–≤–æ–≤ –≤–º–µ—Å—Ç–æ –æ–¥–Ω–æ–≥–æ –±–æ–ª—å—à–æ–≥–æ —Ñ–∞–π–ª–∞
3. –ú–æ–∂–µ—Ç –±—ã—Ç—å —Å–≤—è–∑–∞–Ω–∞ —Å –ø—Ä–æ–±–ª–µ–º–æ–π –∑–∞–ø–∏—Å–∏ CSV (–µ—Å–ª–∏ —Ñ–∞–π–ª –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Å–ª–∏—à–∫–æ–º —á–∞—Å—Ç–æ)

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–æ—Ç–∞—Ü–∏–∏ –≤ `LoggerFactory` –∏–ª–∏ `logging_setup.py`

---

### ‚ùå –ü–†–û–ë–õ–ï–ú–ê #3: Debug CSV —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–ê–ë–û–¢–ê–ï–¢ (—ç—Ç–æ —Ö–æ—Ä–æ—à–æ!)

**–î–µ—Ç–∞–ª–∏:**
- –§–∞–π–ª `logs/futures/debug/debug_20251127_225221.csv` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è
- –°–æ–¥–µ—Ä–∂–∏—Ç –∑–∞–ø–∏—Å–∏ –æ —Å–æ–∑–¥–∞–Ω–∏–∏ TSL, –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è—Ö, –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ø–æ–∑–∏—Ü–∏–π
- –§–æ—Ä–º–∞—Ç: `timestamp,event_type,symbol,data`

**–í—ã–≤–æ–¥:** –°–∏—Å—Ç–µ–º–∞ –∑–∞–ø–∏—Å–∏ –≤ CSV —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ü–µ–ª–æ–º, –ø—Ä–æ–±–ª–µ–º–∞ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–∞ –¥–ª—è `PerformanceTracker`.

---

## üîó –í–ó–ê–ò–ú–û–°–í–Ø–ó–ò –ü–†–û–ë–õ–ï–ú

### –¶–µ–ø–æ—á–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:

```
1. Orchestrator.__init__() 
   ‚Üì
2. PerformanceTracker.__init__() 
   ‚Üì
3. PerformanceTracker._init_csv() 
   ‚Üì
   [–î–û–õ–ñ–ï–ù –°–û–ó–î–ê–¢–¨ –§–ê–ô–õ –ò –ó–ê–õ–û–ì–ò–†–û–í–ê–¢–¨]
   ‚Üì
4. orchestrator._close_position() 
   ‚Üì
5. position_manager.close_position_manually() 
   ‚Üì [–í–û–ó–í–†–ê–©–ê–ï–¢ TradeResult]
6. performance_tracker.record_trade(trade_result) 
   ‚Üì
7. performance_tracker._export_trade_to_csv() 
   ‚Üì
   [–î–û–õ–ñ–ï–ù –ó–ê–ü–ò–°–ê–¢–¨ –í CSV –ò –ó–ê–õ–û–ì–ò–†–û–í–ê–¢–¨]
```

### –¢–æ—á–∫–∏ –æ—Ç–∫–∞–∑–∞:

1. **–¢–æ—á–∫–∞ A:** `PerformanceTracker.__init__()` –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–ª–∏ –ø–∞–¥–∞–µ—Ç —Å –æ—à–∏–±–∫–æ–π
2. **–¢–æ—á–∫–∞ B:** `_init_csv()` –Ω–µ —Å–æ–∑–¥–∞–µ—Ç —Ñ–∞–π–ª –∏–ª–∏ —Å–æ–∑–¥–∞–µ—Ç —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –¥–∞—Ç–æ–π
3. **–¢–æ—á–∫–∞ C:** `orchestrator._close_position()` –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç `record_trade()`
4. **–¢–æ—á–∫–∞ D:** `trade_result` —Ä–∞–≤–µ–Ω `None` –∏–ª–∏ –∏–º–µ–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
5. **–¢–æ—á–∫–∞ E:** `_export_trade_to_csv()` –ø–∞–¥–∞–µ—Ç —Å –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º, –∫–æ—Ç–æ—Ä–æ–µ –Ω–µ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è

---

## üîç –ì–ò–ü–û–¢–ï–ó–´

### –ì–∏–ø–æ—Ç–µ–∑–∞ #1: PerformanceTracker –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è, –Ω–æ –ª–æ–≥–∏ –Ω–µ –ø–æ–ø–∞–¥–∞—é—Ç –≤ info_*.log

**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å:** üî¥ –í–´–°–û–ö–ê–Ø

**–î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞:**
- –í `info_2025-11-28.log` –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π –æ–± –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
- –ù–æ –±–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç, –∑–Ω–∞—á–∏—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞
- –í–æ–∑–º–æ–∂–Ω–æ, –ª–æ–≥–∏ –∏–¥—É—Ç –≤ `futures_main_2025-11-28.log` –∏–ª–∏ –Ω–∞ —É—Ä–æ–≤–µ–Ω—å DEBUG

**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å `futures_main_2025-11-28.log` –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –∑–∞–ø–∏—Å–µ–π –æ–± –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏

---

### –ì–∏–ø–æ—Ç–µ–∑–∞ #2: trade_result —Ä–∞–≤–µ–Ω None –∏–ª–∏ –∏–º–µ–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç

**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å:** üü° –°–†–ï–î–ù–Ø–Ø

**–î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞:**
- –ö–æ–¥ –≤ `orchestrator.py:3474`:
  ```python
  if trade_result and hasattr(self, "performance_tracker"):
  ```
- –ï—Å–ª–∏ `trade_result` —Ä–∞–≤–µ–Ω `None`, –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ –ø—Ä–æ–π–¥–µ—Ç
- –í –ª–æ–≥–∞—Ö –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π "–û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏ —Å–¥–µ–ª–∫–∏ –≤ CSV", –∑–Ω–∞—á–∏—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –Ω–µ –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è

**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–¥ –ø—Ä–æ–≤–µ—Ä–∫–æ–π:
```python
logger.debug(f"DEBUG: trade_result={trade_result}, hasattr={hasattr(self, 'performance_tracker')}")
```

---

### –ì–∏–ø–æ—Ç–µ–∑–∞ #3: –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –≤ _export_trade_to_csv() –ø–æ–≥–ª–æ—â–∞–µ—Ç—Å—è

**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å:** üü° –°–†–ï–î–ù–Ø–Ø

**–î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞:**
- –ö–æ–¥ –≤ `performance_tracker.py:159`:
  ```python
  except Exception as e:
      logger.error(f"‚ùå Failed to export trade to CSV: {e}")
  ```
- –ï—Å–ª–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç, –æ–Ω–æ –¥–æ–ª–∂–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å—Å—è
- –ù–æ –≤ –ª–æ–≥–∞—Ö –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π "Failed to export trade to CSV"

**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è `performance_tracker` (–º–æ–∂–µ—Ç –±—ã—Ç—å –≤—ã—à–µ ERROR)

---

### –ì–∏–ø–æ—Ç–µ–∑–∞ #4: –§–∞–π–ª —Å–æ–∑–¥–∞–µ—Ç—Å—è, –Ω–æ –≤ –¥—Ä—É–≥–æ–º –º–µ—Å—Ç–µ

**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å:** üü¢ –ù–ò–ó–ö–ê–Ø

**–î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞:**
- –ö–æ–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å: `f"logs/trades_{today}.csv"`
- –†–∞–±–æ—á–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –º–æ–∂–µ—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è –æ—Ç –æ–∂–∏–¥–∞–µ–º–æ–π
- –ù–æ —Ñ–∞–π–ª `trades_2025-11-27.csv` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –º–µ—Å—Ç–µ

**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –≤ –∫–∞–∫–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –±–æ—Ç

---

## üìã –ü–õ–ê–ù –î–ï–ô–°–¢–í–ò–ô –î–õ–Ø –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏

**–î–µ–π—Å—Ç–≤–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `logs/futures/futures_main_2025-11-28.log` –Ω–∞ –Ω–∞–ª–∏—á–∏–µ:
  - `PerformanceTracker initialized`
  - `Created new trades CSV` –∏–ª–∏ `Using existing trades CSV`

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ù–∞–π—Ç–∏ –∑–∞–ø–∏—Å–∏ –æ–± –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
- –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å, —Å–æ–∑–¥–∞–µ—Ç—Å—è –ª–∏ —Ñ–∞–π–ª –∏ —Å –∫–∞–∫–æ–π –¥–∞—Ç–æ–π

---

### –®–∞–≥ 2: –î–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**–î–µ–π—Å—Ç–≤–∏–µ:**
–î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –∫–ª—é—á–µ–≤—ã—Ö —Ç–æ—á–∫–∞—Ö:

1. –í `orchestrator.py:3474`:
   ```python
   logger.debug(f"üîç DEBUG: –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–∏ {symbol}, trade_result={trade_result}, "
                f"hasattr performance_tracker={hasattr(self, 'performance_tracker')}")
   if trade_result and hasattr(self, "performance_tracker"):
       logger.debug(f"üîç DEBUG: –í—ã–∑—ã–≤–∞—é record_trade –¥–ª—è {symbol}")
       try:
           self.performance_tracker.record_trade(trade_result)
           logger.info(f"‚úÖ –°–¥–µ–ª–∫–∞ {symbol} –∑–∞–ø–∏—Å–∞–Ω–∞ –≤ CSV")
       except Exception as e:
           logger.error(f"‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏ —Å–¥–µ–ª–∫–∏ –≤ CSV: {e}", exc_info=True)
   else:
       logger.warning(f"‚ö†Ô∏è –ü—Ä–æ–ø—É—Å–∫ –∑–∞–ø–∏—Å–∏ –≤ CSV: trade_result={trade_result}, "
                     f"hasattr={hasattr(self, 'performance_tracker')}")
   ```

2. –í `performance_tracker.py:_export_trade_to_csv()`:
   ```python
   def _export_trade_to_csv(self, trade: TradeResult):
       try:
           logger.debug(f"üîç DEBUG: –ù–∞—á–∏–Ω–∞—é –∑–∞–ø–∏—Å—å –≤ CSV: path={self.csv_path}, symbol={trade.symbol}")
           # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ...
           logger.debug(f"üîç DEBUG: –ó–∞–ø–∏—Å—å –≤ CSV —É—Å–ø–µ—à–Ω–∞")
       except Exception as e:
           logger.error(f"‚ùå Failed to export trade to CSV: {e}", exc_info=True)
   ```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –£–≤–∏–¥–µ—Ç—å, –Ω–∞ –∫–∞–∫–æ–º —ç—Ç–∞–ø–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å–±–æ–π
- –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ—à–∏–±–∫–∞—Ö

---

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ close_position_manually

**–î–µ–π—Å—Ç–≤–∏–µ:**
- –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ `close_position_manually()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `TradeResult`, –∞ –Ω–µ `None` –∏–ª–∏ —Å–ª–æ–≤–∞—Ä—å
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è "‚úÖ –ü–æ–∑–∏—Ü–∏—è BTC-USDT —É—Å–ø–µ—à–Ω–æ –∑–∞–∫—Ä—ã—Ç–∞ –ø–æ tp"

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ `TradeResult` —Å–æ–∑–¥–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤—Å–µ –ø–æ–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ

---

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

**–î–µ–π—Å—Ç–≤–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è `src.strategies.scalping.spot.performance_tracker`
- –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ DEBUG/INFO –ª–æ–≥–∏ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ —Ñ–∞–π–ª

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ù–∞–π—Ç–∏ –ø—Ä–∏—á–∏–Ω—É, –ø–æ—á–µ–º—É –ª–æ–≥–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–µ –ø–æ–ø–∞–¥–∞—é—Ç –≤ —Ñ–∞–π–ª

---

## üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê

- **–í—Å–µ–≥–æ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ —Ñ–∞–π–ª–æ–≤:** 135+ (–≤–∫–ª—é—á–∞—è –∞—Ä—Ö–∏–≤—ã)
- **CSV —Ñ–∞–π–ª–æ–≤ –Ω–∞–π–¥–µ–Ω–æ:** 1 (`trades_2025-11-27.csv`, –ø—É—Å—Ç–æ–π)
- **–ó–∞–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π –∑–∞ —Ç–µ–∫—É—â—É—é —Å–µ—Å—Å–∏—é:** 1 (BTC-USDT)
- **–ó–∞–ø–∏—Å–µ–π –≤ CSV:** 0 ‚ùå
- **–û—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö:** 0 (—á—Ç–æ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ)

---

## ‚úÖ –í–´–í–û–î–´

1. **–û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞:** CSV —Ñ–∞–π–ª –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è –∏ –∑–∞–ø–∏—Å–∏ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç, –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ —Ç–æ —á—Ç–æ –ø–æ–∑–∏—Ü–∏–∏ –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è —É—Å–ø–µ—à–Ω–æ
2. **–ù–∞–∏–±–æ–ª–µ–µ –≤–µ—Ä–æ—è—Ç–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞:** –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –¥–æ–ª–∂–Ω—ã–º –æ–±—Ä–∞–∑–æ–º, –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ –∫–æ–¥–µ –Ω–µ –ø—Ä–æ—Ö–æ–¥—è—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, `trade_result is None`)
3. **–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –î–æ–±–∞–≤–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞ –¥–ª—è —Å–±–æ—Ä–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏

---

---

## ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ü–†–ò–ú–ï–ù–ï–ù–û

**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** 2025-11-28

### –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:

1. **–î–æ–±–∞–≤–ª–µ–Ω –≤—ã–∑–æ–≤ `record_trade()` –≤ `_close_position_by_reason()`**

   **–§–∞–π–ª:** `src/strategies/scalping/futures/position_manager.py`
   
   **–ò–∑–º–µ–Ω–µ–Ω–∏–µ:** –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è `TradeResult` –¥–æ–±–∞–≤–ª–µ–Ω –≤—ã–∑–æ–≤ `orchestrator.performance_tracker.record_trade()` –¥–ª—è –∑–∞–ø–∏—Å–∏ —Å–¥–µ–ª–∫–∏ –≤ CSV.

   **–ö–æ–¥:**
   ```python
   # ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ó–∞–ø–∏—Å—ã–≤–∞–µ–º —Å–¥–µ–ª–∫—É –≤ CSV —á–µ—Ä–µ–∑ performance_tracker
   if hasattr(self, "orchestrator") and self.orchestrator:
       if hasattr(self.orchestrator, "performance_tracker"):
           try:
               self.orchestrator.performance_tracker.record_trade(trade_result)
               logger.debug(f"‚úÖ –°–¥–µ–ª–∫–∞ {symbol} –∑–∞–ø–∏—Å–∞–Ω–∞ –≤ CSV")
           except Exception as e:
               logger.error(f"‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏ —Å–¥–µ–ª–∫–∏ {symbol} –≤ CSV: {e}", exc_info=True)
   ```

   **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –¢–µ–ø–µ—Ä—å –≤—Å–µ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–π (—á–µ—Ä–µ–∑ TP, SL, profit_harvest –∏ —Ç.–¥.) –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å—Å—è –≤ CSV —Ñ–∞–π–ª.

### –ü–æ—á–µ–º—É —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

- `_close_position_by_reason()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –º–µ—Å—Ç (TP, SL, profit_harvest, emergency)
- –ú–µ—Ç–æ–¥ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `TradeResult` —Å –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Å–¥–µ–ª–∫–µ
- `position_manager` –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ `orchestrator` —á–µ—Ä–µ–∑ `self.orchestrator`
- `orchestrator` —Å–æ–¥–µ—Ä–∂–∏—Ç `performance_tracker` –∫–æ—Ç–æ—Ä—ã–π –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤ CSV

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:

–ü–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞ –≤—Å–µ –Ω–æ–≤—ã–µ –∑–∞–∫—Ä—ã—Ç—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å—Å—è –≤ `logs/trades_YYYY-MM-DD.csv`.

---

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–æ. –¢—Ä–µ–±—É–µ—Ç—Å—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞ –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π.

