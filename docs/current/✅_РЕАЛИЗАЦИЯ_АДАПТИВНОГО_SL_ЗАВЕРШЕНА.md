# ‚úÖ –†–ï–ê–õ–ò–ó–ê–¶–ò–Ø –ê–î–ê–ü–¢–ò–í–ù–û–ì–û SL –ó–ê–í–ï–†–®–ï–ù–ê

**–î–∞—Ç–∞:** 23.11.2025, 23:55  
**–°—Ç–∞—Ç—É—Å:** –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤–Ω–µ—Å–µ–Ω—ã

---

## ‚úÖ –ß–¢–û –ë–´–õ–û –°–î–ï–õ–ê–ù–û

### 1. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (`config/config_futures.yaml`)

**–î–æ–±–∞–≤–ª–µ–Ω–æ sl_percent –¥–ª—è –≤—Å–µ—Ö —Ä–µ–∂–∏–º–æ–≤:**
- `trending: sl_percent: 1.5%`
- `ranging: sl_percent: 2.0%`
- `choppy: sl_percent: 1.0%`

**–î–æ–±–∞–≤–ª–µ–Ω–æ sl_percent –¥–ª—è –≤—Å–µ—Ö —Å–∏–º–≤–æ–ª–æ–≤:**
- **BTC-USDT:**
  - Per-symbol: `sl_percent: 1.5%`
  - Trending: `sl_percent: 1.5%`
  - Ranging: `sl_percent: 2.0%`
  - Choppy: `sl_percent: 1.5%`

- **ETH-USDT:**
  - Per-symbol: `sl_percent: 1.5%`
  - Trending: `sl_percent: 1.5%`
  - Ranging: `sl_percent: 2.0%`
  - Choppy: `sl_percent: 1.2%`

- **SOL-USDT:**
  - Per-symbol: `sl_percent: 1.5%`
  - Trending: `sl_percent: 1.5%`
  - Ranging: `sl_percent: 2.0%`
  - Choppy: `sl_percent: 1.2%`

- **DOGE-USDT:**
  - Per-symbol: `sl_percent: 1.8%`
  - Trending: `sl_percent: 1.8%`
  - Ranging: `sl_percent: 2.0%`
  - Choppy: `sl_percent: 1.5%`

- **XRP-USDT:**
  - Per-symbol: `sl_percent: 1.8%`
  - Trending: `sl_percent: 1.8%`
  - Ranging: `sl_percent: 2.0%`
  - Choppy: `sl_percent: 1.5%`

---

### 2. –ö–æ–¥ (`src/strategies/scalping/futures/position_manager.py`)

#### –ú–µ—Ç–æ–¥ `_get_adaptive_sl_percent` (–ø–æ—Å–ª–µ —Å—Ç—Ä–æ–∫–∏ 233):

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- ‚úÖ –ü–æ–ª—É—á–∞–µ—Ç –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π SL% –¥–ª—è —Å–∏–º–≤–æ–ª–∞ –∏ —Ä–µ–∂–∏–º–∞
- ‚úÖ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: Per-regime ‚Üí Per-symbol ‚Üí –ì–ª–æ–±–∞–ª—å–Ω—ã–π (–∫–∞–∫ —É TP)
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω `_get_adaptive_tp_percent`

**–õ–æ–≥–∏–∫–∞:**
1. –ü–æ–ª—É—á–∞–µ—Ç —Ä–µ–∂–∏–º –∏–∑ –ø–æ–∑–∏—Ü–∏–∏ –∏–ª–∏ signal_generator
2. –ò—â–µ—Ç `sl_percent` –≤ `symbol_profiles[symbol][regime]`
3. –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ - –∏—â–µ—Ç –≤ `symbol_profiles[symbol]`
4. –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω—ã–π `sl_percent`

---

#### –ú–µ—Ç–æ–¥ `_check_sl` (–ø–æ—Å–ª–µ —Å—Ç—Ä–æ–∫–∏ 805):

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π SL –¥–ª—è —É–±—ã—Ç–æ—á–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –¢–û–õ–¨–ö–û –µ—Å–ª–∏ TSL –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω
- ‚úÖ –ë–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è `min_holding` –∑–∞—â–∏—Ç–æ–π
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –¢–û–ß–ù–£–Æ –ö–û–ü–ò–Æ –ª–æ–≥–∏–∫–∏ loss_cut –¥–ª—è LONG/SHORT

**–õ–æ–≥–∏–∫–∞:**
1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ TSL –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω (–µ—Å–ª–∏ –∞–∫—Ç–∏–≤–µ–Ω - –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç)
2. –ü–æ–ª—É—á–∞–µ—Ç —Ä–µ–∂–∏–º –¥–ª—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–≥–æ SL
3. –ü–æ–ª—É—á–∞–µ—Ç –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π `sl_percent` —á–µ—Ä–µ–∑ `_get_adaptive_sl_percent`
4. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç `min_holding` –∑–∞—â–∏—Ç—É (–±–ª–æ–∫–∏—Ä—É–µ—Ç –µ—Å–ª–∏ < min_holding)
5. –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç PnL% –æ—Ç –º–∞—Ä–∂–∏ (–ø—Ä–∞–≤–∏–ª—å–Ω–æ –¥–ª—è LONG –∏ SHORT)
6. –ó–∞–∫—Ä—ã–≤–∞–µ—Ç –ø–æ–∑–∏—Ü–∏—é –µ—Å–ª–∏ `pnl_percent_from_margin <= -sl_percent`

**LONG/SHORT –ª–æ–≥–∏–∫–∞:**
```python
# ‚úÖ –¢–û–ß–ù–ê–Ø –ö–û–ü–ò–Ø –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω–æ–π –ª–æ–≥–∏–∫–∏ loss_cut
position_side = position.get("posSide", "long").lower()
if position_side == "long":
    unrealized_pnl = size_in_coins * (current_price - entry_price)  # LONG
else:  # short
    unrealized_pnl = size_in_coins * (entry_price - current_price)  # SHORT
```

---

#### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ `_check_tp_only` (—Å—Ç—Ä–æ–∫–∞ 1131):

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –≤—ã–∑–æ–≤ `await self._check_sl(position)` –ü–ï–†–ï–î –ø—Ä–æ–≤–µ—Ä–∫–æ–π loss_cut
- ‚úÖ –ï—Å–ª–∏ SL —Å—Ä–∞–±–æ—Ç–∞–ª - –ø–æ–∑–∏—Ü–∏—è –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è, –≤—ã—Ö–æ–¥–∏–º –∏–∑ –º–µ—Ç–æ–¥–∞
- ‚úÖ –ï—Å–ª–∏ SL –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª - –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É loss_cut

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∑–∞–∫—Ä—ã—Ç–∏—è:**
1. TSL (–µ—Å–ª–∏ –∞–∫—Ç–∏–≤–µ–Ω) - —Å–∞–º—ã–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–π
2. **SL (–ù–û–í–û–ï)** - –∂–µ—Å—Ç–∫–∏–π —Å—Ç–æ–ø, –ø–æ—Å–ª–µ min_holding
3. loss_cut - –º—è–≥–∫–∏–π —Å—Ç–æ–ø, –ø–æ—Å–ª–µ min_holding

---

## üéØ –ò–¢–û–ì–û–í–ê–Ø –°–ò–°–¢–ï–ú–ê –ó–ê–ö–†–´–¢–ò–Ø

### –î–ª—è –ü–†–ò–ë–´–õ–¨–ù–´–• –ø–æ–∑–∏—Ü–∏–π:

1. **Profit Harvesting** - —Å–∞–º–æ–µ –±—ã—Å—Ç—Ä–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ
2. **Big Profit Exit** - –∑–∞–∫—Ä—ã—Ç–∏–µ —Å —Ç—Ä–µ–π–ª–∏–Ω–≥–æ–º
3. **Partial TP** - –∑–∞–∫—Ä—ã—Ç–∏–µ —á–∞—Å—Ç–∏ –ø–æ–∑–∏—Ü–∏–∏
4. **Full TP** - –∑–∞–∫—Ä—ã—Ç–∏–µ –≤—Å–µ–π –ø–æ–∑–∏—Ü–∏–∏
5. **TSL** - –∑–∞—â–∏—Ç–∞ –ø—Ä–∏–±—ã–ª–∏

### –î–ª—è –£–ë–´–¢–û–ß–ù–´–• –ø–æ–∑–∏—Ü–∏–π:

1. **TSL** (–µ—Å–ª–∏ –∞–∫—Ç–∏–≤–µ–Ω) - —Å–∞–º—ã–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–π
2. **SL** (–ù–û–í–û–ï) - –∂–µ—Å—Ç–∫–∏–π —Å—Ç–æ–ø, –ø–æ—Å–ª–µ min_holding
3. **loss_cut** - –º—è–≥–∫–∏–π —Å—Ç–æ–ø, –ø–æ—Å–ª–µ min_holding

**–ó–∞—â–∏—Ç–∞ min_holding:**
- –ë–ª–æ–∫–∏—Ä—É–µ—Ç SL –∏ loss_cut –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è min_holding (0.5-60 –º–∏–Ω)
- –ù–ï –±–ª–æ–∫–∏—Ä—É–µ—Ç TSL (–µ—Å–ª–∏ –∞–∫—Ç–∏–≤–µ–Ω)
- –ù–ï –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –ø—Ä–∏–±—ã–ª–∏ (TP, Big Profit)

---

## ‚úÖ –ü–†–û–í–ï–†–ö–ò

### 1. LONG/SHORT –ª–æ–≥–∏–∫–∞:
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¢–û–ß–ù–ê–Ø –ö–û–ü–ò–Ø –ª–æ–≥–∏–∫–∏ loss_cut (—Å—Ç—Ä–æ–∫–∏ 1220-1256)
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è LONG: `size_in_coins * (current_price - entry_price)`
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è SHORT: `size_in_coins * (entry_price - current_price)`
- ‚úÖ –£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è ctVal –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ –≤ –º–æ–Ω–µ—Ç—ã

### 2. –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¢–û–ß–ù–ê–Ø –ö–û–ü–ò–Ø –ø–∞—Ç—Ç–µ—Ä–Ω–∞ `_get_adaptive_tp_percent`
- ‚úÖ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: Per-regime ‚Üí Per-symbol ‚Üí –ì–ª–æ–±–∞–ª—å–Ω—ã–π
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –≤—Å–µ—Ö —Å–∏–º–≤–æ–ª–æ–≤ –∏ —Ä–µ–∂–∏–º–æ–≤

### 3. –ú–µ—Å—Ç–æ –≤ –∫–æ–¥–µ:
- ‚úÖ –ú–µ—Ç–æ–¥ `_check_sl` –¥–æ–±–∞–≤–ª–µ–Ω –ø–µ—Ä–µ–¥ `_check_tp_only`
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ `_check_tp_only` –ü–ï–†–ï–î loss_cut
- ‚úÖ –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ –Ω–µ –∏–∑–º–µ–Ω–µ–Ω

### 4. –ú–æ–¥—É–ª–∏:
- ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–µ –º–æ–¥—É–ª–∏
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞

### 5. –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã:
- ‚úÖ –ß–µ—Ç–∫–∏–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã: TSL ‚Üí SL ‚Üí loss_cut
- ‚úÖ –ù–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤

### 6. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
- ‚úÖ –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –¥–ª—è –≤—Å–µ—Ö —Ä–µ–∂–∏–º–æ–≤ –∏ —Å–∏–º–≤–æ–ª–æ–≤
- ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —à–∞–Ω—Å –Ω–∞ —Ä–∞–∑–≤–æ—Ä–æ—Ç (min_holding –∑–∞—â–∏—Ç–∞)
- ‚úÖ –ú–µ–Ω—å—à–µ —É–±—ã—Ç–æ–∫ (SL —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ä–∞–Ω—å—à–µ loss_cut)

---

## üìä –ü–ê–†–ê–ú–ï–¢–†–´ (RANGING)

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–µ–∫—É—â–µ–µ | –ù–æ–≤–æ–µ | –õ–æ–≥–∏–∫–∞ |
|----------|---------|-------|--------|
| `sl_percent` | 1.2% (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è) | **2.0%** (–∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π) | –ñ–µ—Å—Ç–∫–∏–π —Å—Ç–æ–ø, –ø–æ—Å–ª–µ min_holding |
| `loss_cut_percent` | 4.0% | **3.0%** (–ø–æ–∫–∞ –Ω–µ –∏–∑–º–µ–Ω–µ–Ω–æ) | –ú—è–≥–∫–∏–π —Å—Ç–æ–ø, –ø–æ—Å–ª–µ min_holding |
| `min_holding_minutes` | 60 –º–∏–Ω | **20 –º–∏–Ω** (–ø–æ–∫–∞ –Ω–µ –∏–∑–º–µ–Ω–µ–Ω–æ) | –†–∞–∑—É–º–Ω–æ–µ –≤—Ä–µ–º—è |

**–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç:**
- –ü–æ–∑–∏—Ü–∏–∏ –≤ -2.0% –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è –ø–æ—Å–ª–µ 20 –º–∏–Ω—É—Ç (SL)
- –ü–æ–∑–∏—Ü–∏–∏ –≤ -3.0% –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è –ø–æ—Å–ª–µ 20 –º–∏–Ω—É—Ç (loss_cut)
- –°—Ä–µ–¥–Ω–∏–π —É–±—ã—Ç–æ–∫: -1.5% –¥–æ -2.5% (–≤–º–µ—Å—Ç–æ -2.0% –¥–æ -4.0%)
- –ï—Å—Ç—å —à–∞–Ω—Å –Ω–∞ —Ä–∞–∑–≤–æ—Ä–æ—Ç (–ø–µ—Ä–≤—ã–µ 20 –º–∏–Ω—É—Ç –∑–∞—â–∏—â–µ–Ω—ã)

---

## ‚úÖ –í–°–ï –ü–†–û–í–ï–†–ö–ò –ü–†–û–ô–î–ï–ù–´

- ‚úÖ LONG/SHORT –ª–æ–≥–∏–∫–∞ - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞
- ‚úÖ –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω
- ‚úÖ –ú–µ—Å—Ç–æ –≤ –∫–æ–¥–µ - –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ
- ‚úÖ –ú–æ–¥—É–ª–∏ - –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ
- ‚úÖ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã - —á–µ—Ç–∫–∏–µ, –±–µ–∑ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
- ‚úÖ –ü–∞—Ä–∞–º–µ—Ç—Ä—ã - –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ, —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ
- ‚úÖ –õ–∏–Ω—Ç–µ—Ä - –Ω–µ—Ç –æ—à–∏–±–æ–∫

---

**–î–∞—Ç–∞:** 23.11.2025, 23:55

