# –ü–†–û–ë–õ–ï–ú–ê –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–û–ì–û –ó–ê–ö–†–´–¢–ò–Ø DOGE-USDT

**–î–∞—Ç–∞:** 23 –Ω–æ—è–±—Ä—è 2025  
**–í—Ä–µ–º—è –∑–∞–∫—Ä—ã—Ç–∏—è:** 14:38:50  
**–£–±—ã—Ç–æ–∫:** -0.34 USDT (-0.88%)  
**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è **–ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–û–ï –ó–ê–ö–†–´–¢–ò–ï –ë–û–¢–û–ú**

---

## üîç –ê–ù–ê–õ–ò–ó –ü–†–û–ë–õ–ï–ú–´

### –ò–∑ –ª–æ–≥–æ–≤:
```
14:38:50 | INFO | üîÑ –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–∏ DOGE-USDT short —Ä–∞–∑–º–µ—Ä=1.31 –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤, PnL=-0.22 USDT
14:38:50 | INFO | ‚úÖ –ü–æ–∑–∏—Ü–∏—è DOGE-USDT —É—Å–ø–µ—à–Ω–æ –∑–∞–∫—Ä—ã—Ç–∞ —á–µ—Ä–µ–∑ API
14:38:50 | INFO | ‚ùå CLOSE: DOGE-USDT exit=0.1437 | reason=ws_unknown
14:38:50 | INFO | üìä Private WS: –ü–æ–∑–∏—Ü–∏—è DOGE-USDT –∑–∞–∫—Ä—ã—Ç–∞ (–ø—Ä–∏—á–∏–Ω–∞: unknown, side=short, size=1.31, entry=0.1448, time=20.02 –º–∏–Ω)
```

---

## ‚ö†Ô∏è –ü–†–û–ë–õ–ï–ú–ê

### –ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:

1. **WebSocket —Å–æ–±—ã—Ç–∏–µ:** –ë–∏—Ä–∂–∞ –æ—Ç–ø—Ä–∞–≤–∏–ª–∞ WebSocket —Å–æ–±—ã—Ç–∏–µ –æ —Ç–æ–º, —á—Ç–æ –ø–æ–∑–∏—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∞ (`pos_size = 0`)
2. **–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏—è:** –ë–æ—Ç –ø–æ–ª—É—á–∏–ª —Å–æ–±—ã—Ç–∏–µ –≤ `handle_private_ws_positions`
3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ:** –ë–æ—Ç –≤—ã–∑–≤–∞–ª `handle_position_closed_via_ws`, –∫–æ—Ç–æ—Ä—ã–π –∑–∞—Ç–µ–º –≤—ã–∑–≤–∞–ª `close_position_manually`
4. **–ü—Ä–∏—á–∏–Ω–∞:** `unknown` - –±–∏—Ä–∂–∞ –Ω–µ —É–∫–∞–∑–∞–ª–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –ø—Ä–∏—á–∏–Ω—É –∑–∞–∫—Ä—ã—Ç–∏—è

---

## ü§î –í–û–ó–ú–û–ñ–ù–´–ï –ü–†–ò–ß–ò–ù–´

### 1. –ë–∏—Ä–∂–∞ –∑–∞–∫—Ä—ã–ª–∞ –ø–æ–∑–∏—Ü–∏—é –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- **–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –º–∞—Ä–∂–∞:** –ù–æ –≤ –ª–æ–≥–∞—Ö –≤–∏–¥–Ω–æ, —á—Ç–æ –º–∞—Ä–∂–∞ –±—ã–ª–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–π
- **–õ–∏–º–∏—Ç —É–±—ã—Ç–∫–æ–≤ –±–∏—Ä–∂–∏:** –í–æ–∑–º–æ–∂–Ω–æ, –±–∏—Ä–∂–∞ –∏–º–µ–µ—Ç —Å–≤–æ–π –ª–∏–º–∏—Ç —É–±—ã—Ç–∫–æ–≤
- **–î—Ä—É–≥–∏–µ –ø—Ä–∏—á–∏–Ω—ã –±–∏—Ä–∂–∏:** –ë–∏—Ä–∂–∞ –º–æ–∂–µ—Ç –∑–∞–∫—Ä—ã–≤–∞—Ç—å –ø–æ–∑–∏—Ü–∏–∏ –ø–æ —Å–≤–æ–∏–º –ø—Ä–∞–≤–∏–ª–∞–º

### 2. –ë–æ—Ç –∑–∞–∫—Ä—ã–ª –ø–æ–∑–∏—Ü–∏—é –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- **Loss cut:** –ù–æ —É–±—ã—Ç–æ–∫ -0.88% < 4.0% (loss_cut –Ω–µ –¥–æ–ª–∂–µ–Ω –±—ã–ª —Å—Ä–∞–±–æ—Ç–∞—Ç—å)
- **Timeout:** –ù–æ –ø–æ–∑–∏—Ü–∏—è –¥–µ—Ä–∂–∞–ª–∞—Å—å 20 –º–∏–Ω—É—Ç < 120 –º–∏–Ω—É—Ç (timeout –Ω–µ –¥–æ–ª–∂–µ–Ω –±—ã–ª —Å—Ä–∞–±–æ—Ç–∞—Ç—å)
- **TSL:** –ù–æ min_holding –∑–∞—â–∏—Ç–∞ –±—ã–ª–∞ –∞–∫—Ç–∏–≤–Ω–∞
- **–î—Ä—É–≥–∞—è –ª–æ–≥–∏–∫–∞:** –í–æ–∑–º–æ–∂–Ω–æ, –µ—Å—Ç—å –¥—Ä—É–≥–∞—è –ª–æ–≥–∏–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è

### 3. –û—à–∏–±–∫–∞ –≤ –ª–æ–≥–∏–∫–µ
- **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ WebSocket —Å–æ–±—ã—Ç–∏–π:** –í–æ–∑–º–æ–∂–Ω–æ, –±–æ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ—Ç WebSocket —Å–æ–±—ã—Ç–∏—è
- **Race condition:** –í–æ–∑–º–æ–∂–Ω–æ, –ø—Ä–æ–∏–∑–æ—à–ª–∞ –≥–æ–Ω–∫–∞ —É—Å–ª–æ–≤–∏–π

---

## üîç –ß–¢–û –ù–£–ñ–ù–û –ü–†–û–í–ï–†–ò–¢–¨

### 1. –õ–æ–≥–∏–∫–∞ `handle_private_ws_positions`:
```python
if abs(pos_size) < 1e-8:
    # –ü–æ–∑–∏—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∞ - —É–¥–∞–ª—è–µ–º –∏–∑ active_positions
    if symbol in self.active_positions_ref:
        await self.handle_position_closed_via_ws(symbol)
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –ø–æ–∑–∏—Ü–∏—é, –µ—Å–ª–∏ –±–∏—Ä–∂–∞ —Å–æ–æ–±—â–∞–µ—Ç, —á—Ç–æ `pos_size = 0`, –Ω–æ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –±—ã–ª–∞ –ª–∏ –ø–æ–∑–∏—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∞ –±–æ—Ç–æ–º –∏–ª–∏ –±–∏—Ä–∂–µ–π.

### 2. –õ–æ–≥–∏–∫–∞ `handle_position_closed_via_ws`:
```python
reason = "unknown"  # ‚ö†Ô∏è –í—Å–µ–≥–¥–∞ "unknown"!
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ë–æ—Ç –Ω–µ –ø—ã—Ç–∞–µ—Ç—Å—è –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—Ä–∏—á–∏–Ω—É –∑–∞–∫—Ä—ã—Ç–∏—è –∏–∑ WebSocket —Å–æ–±—ã—Ç–∏—è.

### 3. –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:
- –ü–æ—á–µ–º—É –±–∏—Ä–∂–∞ –∑–∞–∫—Ä—ã–ª–∞ –ø–æ–∑–∏—Ü–∏—é?
- –ë—ã–ª–∞ –ª–∏ –ø–æ–∑–∏—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∞ –±–æ—Ç–æ–º –∏–ª–∏ –±–∏—Ä–∂–µ–π?
- –ö–∞–∫–∏–µ —É—Å–ª–æ–≤–∏—è –º–æ–≥–ª–∏ –≤—ã–∑–≤–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ?

---

## ‚úÖ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### 1. –£–ª—É—á—à–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ WebSocket —Å–æ–±—ã—Ç–∏—è –æ –∑–∞–∫—Ä—ã—Ç–∏–∏ –ø–æ–∑–∏—Ü–∏–π
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏—á–∏–Ω—É –∑–∞–∫—Ä—ã—Ç–∏—è –∏–∑ WebSocket —Å–æ–±—ã—Ç–∏—è
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å, –±—ã–ª–∞ –ª–∏ –ø–æ–∑–∏—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∞ –±–æ—Ç–æ–º –∏–ª–∏ –±–∏—Ä–∂–µ–π

### 2. –£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É WebSocket —Å–æ–±—ã—Ç–∏–π:
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å, –±—ã–ª–∞ –ª–∏ –ø–æ–∑–∏—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∞ –±–æ—Ç–æ–º –ø–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π WebSocket —Å–æ–±—ã—Ç–∏—è
- –û–ø—Ä–µ–¥–µ–ª—è—Ç—å –ø—Ä–∏—á–∏–Ω—É –∑–∞–∫—Ä—ã—Ç–∏—è –∏–∑ WebSocket —Å–æ–±—ã—Ç–∏—è
- –ù–µ –≤—ã–∑—ã–≤–∞—Ç—å `close_position_manually` –µ—Å–ª–∏ –ø–æ–∑–∏—Ü–∏—è —É–∂–µ –±—ã–ª–∞ –∑–∞–∫—Ä—ã—Ç–∞ –±–æ—Ç–æ–º

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏–∫—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è:
- –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ loss_cut, timeout, TSL —Ä–∞–±–æ—Ç–∞—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω–µ—Ç –ª–∏ –¥—Ä—É–≥–∏—Ö —É—Å–ª–æ–≤–∏–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è
- –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ø–æ–∑–∏—Ü–∏—è –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø—Ä–µ–∂–¥–µ–≤—Ä–µ–º–µ–Ω–Ω–æ

---

## ‚ö†Ô∏è –í–´–í–û–î

**–ü–æ–∑–∏—Ü–∏—è –±—ã–ª–∞ –∑–∞–∫—Ä—ã—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ WebSocket —Å–æ–±—ã—Ç–∏–µ, –Ω–æ –ø—Ä–∏—á–∏–Ω–∞ –∑–∞–∫—Ä—ã—Ç–∏—è –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞.**

**–ü—Ä–æ–±–ª–µ–º—ã:**
1. ‚ö†Ô∏è –ë–æ—Ç –Ω–µ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø—Ä–∏—á–∏–Ω—É –∑–∞–∫—Ä—ã—Ç–∏—è –∏–∑ WebSocket —Å–æ–±—ã—Ç–∏—è
2. ‚ö†Ô∏è –ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–∑—ã–≤–∞–µ—Ç `close_position_manually` –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ WebSocket —Å–æ–±—ã—Ç–∏—è –æ –∑–∞–∫—Ä—ã—Ç–∏–∏
3. ‚ö†Ô∏è –ù–µ–ø–æ–Ω—è—Ç–Ω–æ, –±—ã–ª–∞ –ª–∏ –ø–æ–∑–∏—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∞ –±–æ—Ç–æ–º –∏–ª–∏ –±–∏—Ä–∂–µ–π

**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –¢–†–ï–ë–£–ï–¢–°–Ø –ò–°–°–õ–ï–î–û–í–ê–ù–ò–ï –ò –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï

