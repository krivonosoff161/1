# АНАЛИЗ КОНСИСТЕНТНОСТИ ИНДИКАТОРОВ

**Дата:** 2026-01-06 01:55:01

## ПРОБЛЕМЫ С MACD

### signal_generator.py:2005

**Проблема:** MACD читается как dict с histogram, но может быть сохранен как отдельные значения

**Серьезность:** HIGH

```python
                        indicators["macd"] = {
                            "macd": metadata.get("macd_line", result.value),
                            "signal": metadata.get("signal_line", result.value),
                            "histogram": metadata.get("macd_line", result.value)
```

### signal_generator.py:2007

**Проблема:** MACD читается как dict с histogram, но может быть сохранен как отдельные значения

**Серьезность:** HIGH

```python
                            "signal": metadata.get("signal_line", result.value),
                            "histogram": metadata.get("macd_line", result.value)
                            - metadata.get("signal_line", result.value),
                        }
```

### signal_generator.py:2110

**Проблема:** MACD читается как dict, но может быть сохранен как scalar

**Серьезность:** HIGH

```python
                    if "macd" in indicators:
                        macd_data = indicators["macd"]
                        if isinstance(macd_data, dict):
                            # Сохраняем весь dict - это основной формат
```

### signal_generator.py:2151

**Проблема:** MACD читается как dict, но может быть сохранен как scalar

**Серьезность:** HIGH

```python
            rsi_val = indicators.get("rsi", "N/A")
            macd_val = indicators.get("macd", {})
            if isinstance(macd_val, dict):
                macd_line = macd_val.get("macd", 0)
```

### signal_generator.py:2153

**Проблема:** MACD читается как dict, но может быть сохранен как scalar

**Серьезность:** HIGH

```python
            if isinstance(macd_val, dict):
                macd_line = macd_val.get("macd", 0)
                signal_line = macd_val.get("signal", 0)
                histogram = macd_line - signal_line
```

### signal_generator.py:2487

**Проблема:** MACD читается как dict, но может быть сохранен как scalar

**Серьезность:** HIGH

```python
            rsi_value = indicators.get("rsi", 0) if indicators else 0
            macd_data = indicators.get("macd", {}) if indicators else {}
            macd_line = macd_data.get("macd", 0) if isinstance(macd_data, dict) else 0
            signal_line = (
```

### signal_generator.py:2488

**Проблема:** MACD читается как dict, но может быть сохранен как scalar

**Серьезность:** HIGH

```python
            macd_data = indicators.get("macd", {}) if indicators else {}
            macd_line = macd_data.get("macd", 0) if isinstance(macd_data, dict) else 0
            signal_line = (
                macd_data.get("signal", 0) if isinstance(macd_data, dict) else 0
```

### signal_generator.py:2626

**Проблема:** MACD читается как dict, но может быть сохранен как scalar

**Серьезность:** HIGH

```python
                rsi_value = indicators.get("rsi")
                macd_dict = indicators.get("macd", {})
                macd_hist = (
                    macd_dict.get("histogram") if isinstance(macd_dict, dict) else None
```

### signal_generator.py:2720

**Проблема:** MACD читается как dict, но может быть сохранен как scalar

**Серьезность:** HIGH

```python
                    f"RSI={indicators.get('rsi', 'N/A')}, "
                    f"MACD={indicators.get('macd', {}).get('histogram', 'N/A') if isinstance(indicators.get('macd'), dict) else 'N/A'}"
                )
            else:
```

### signal_generator.py:3850

**Проблема:** MACD читается как dict с histogram, но может быть сохранен как отдельные значения

**Серьезность:** HIGH

```python
                if macd_calculated:
                    macd_line = macd_calculated.get("macd", 0)
                    signal_line = macd_calculated.get("signal", 0)
                    histogram = macd_calculated.get("histogram", 0)
```

### signal_generator.py:3856

**Проблема:** MACD читается как dict с histogram, но может быть сохранен как отдельные значения

**Серьезность:** HIGH

```python
                    macd = indicators.get("macd", {})
                    macd_line = macd.get("macd", 0)
                    signal_line = macd.get("signal", 0)
                    histogram = macd.get("histogram", macd_line - signal_line)
```

### signal_generator.py:3862

**Проблема:** MACD читается как dict с histogram, но может быть сохранен как отдельные значения

**Серьезность:** HIGH

```python
                macd = indicators.get("macd", {})
                macd_line = macd.get("macd", 0)
                signal_line = macd.get("signal", 0)
                histogram = macd.get("histogram", macd_line - signal_line)
```

### signal_coordinator.py:1679

**Проблема:** MACD читается как dict, но может быть сохранен как scalar

**Серьезность:** HIGH

```python
                                            # MACD всегда сохраняется как dict в DataRegistry
                                            macd_dict = indicators_from_registry.get("macd")
                                            if macd_dict and isinstance(macd_dict, dict):
                       
```

### signal_coordinator.py:1688

**Проблема:** MACD читается как dict с histogram, но может быть сохранен как отдельные значения

**Серьезность:** HIGH

```python
                                                # Fallback: пытаемся получить отдельные значения (для backward compatibility со старыми данными)
                                                macd_hist = indicators_from_registry.get("macd_histogram")
                                                
```

### signal_coordinator.py:1693

**Проблема:** MACD читается как dict с histogram, но может быть сохранен как отдельные значения

**Серьезность:** HIGH

```python
                                                        f"macd_dict={type(macd_dict).__name__ if macd_dict else None}, "
                                                        f"macd_histogram={indicators_from_registry.get('macd_histogram')}"
                                                    )

```

### smart_exit_coordinator.py:159

**Проблема:** MACD читается как dict, но может быть сохранен как scalar

**Серьезность:** HIGH

```python
            # ✅ ИСПРАВЛЕНО (06.01.2026): MACD всегда сохраняется как dict в DataRegistry
            macd = indicators.get("MACD") or indicators.get("macd")
            if macd:
                if isinstance(macd, dict):
```

### smart_exit_coordinator.py:162

**Проблема:** MACD читается как dict, но может быть сохранен как scalar

**Серьезность:** HIGH

```python
                if isinstance(macd, dict):
                    macd_line = macd.get("macd", 0)
                    signal_line = macd.get("signal", 0)
                else:
```

### macd_signal_generator.py:119

**Проблема:** MACD читается как dict, но может быть сохранен как scalar

**Серьезность:** HIGH

```python
            # Обрабатываем как dict (основной формат) и fallback на scalar (для backward compatibility)
            macd = indicators.get("macd", {})
            macd_line = macd.get("macd", 0) if isinstance(macd, dict) else macd
            signal_line = macd.get("signal", 0) if isinstance(macd, di
```

### macd_signal_generator.py:120

**Проблема:** MACD читается как dict, но может быть сохранен как scalar

**Серьезность:** HIGH

```python
            macd = indicators.get("macd", {})
            macd_line = macd.get("macd", 0) if isinstance(macd, dict) else macd
            signal_line = macd.get("signal", 0) if isinstance(macd, dict) else 0
            # Правильно вычисляем histogram
```

## ПРОБЛЕМЫ С ADX

Проблем не найдено.

## СТАТИСТИКА

- Операций сохранения: 3
- Операций чтения: 20
- Прямых обращений: 156
