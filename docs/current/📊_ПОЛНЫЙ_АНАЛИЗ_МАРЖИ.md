# üìä –ü–û–õ–ù–´–ô –ê–ù–ê–õ–ò–ó –°–ò–°–¢–ï–ú–´ –ú–ê–†–ñ–ò

**–î–∞—Ç–∞:** 23.11.2025, 22:15  
**–í–µ—Ä—Å–∏—è:** 1.0

---

## üìã –°–û–î–ï–†–ñ–ê–ù–ò–ï

1. [–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–æ—Ä–º—É–ª—ã —Ä–∞—Å—á–µ—Ç–∞ –º–∞—Ä–∂–∏](#–æ—Å–Ω–æ–≤–Ω—ã–µ-—Ñ–æ—Ä–º—É–ª—ã)
2. [–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è](#–º–∏–Ω-–º–∞–∫—Å-–∑–Ω–∞—á–µ–Ω–∏—è)
3. [–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ —Ä–µ–∂–∏–º–∞–º](#–∞–¥–∞–ø—Ç–∏–≤–Ω—ã–µ-–ø–∞—Ä–∞–º–µ—Ç—Ä—ã)
4. [–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ –±–∞–ª–∞–Ω—Å—É](#–∞–¥–∞–ø—Ç–∞—Ü–∏—è-–ø–æ-–±–∞–ª–∞–Ω—Å—É)
5. [–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –º–∞—Ä–∂–∏](#–ø—Ä–æ–≤–µ—Ä–∫–∞-–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)
6. [–ü–æ—Ç–æ–∫ —Ä–∞—Å—á–µ—Ç–∞ –º–∞—Ä–∂–∏](#–ø–æ—Ç–æ–∫-—Ä–∞—Å—á–µ—Ç–∞)
7. [–ü—Ä–æ–±–ª–µ–º—ã –∏ –∑–∞—â–∏—Ç–∞](#–ø—Ä–æ–±–ª–µ–º—ã-–∏-–∑–∞—â–∏—Ç–∞)

---

## üî¢ –û–°–ù–û–í–ù–´–ï –§–û–†–ú–£–õ–´

### 1. –ë–∞–∑–æ–≤–∞—è —Ñ–æ—Ä–º—É–ª–∞ –º–∞—Ä–∂–∏

```
margin_used = position_value / leverage
```

–ì–¥–µ:
- `position_value` = `position_size * price` (–Ω–æ–º–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ–∑–∏—Ü–∏–∏ –≤ USD)
- `leverage` = –ø–ª–µ—á–æ (–æ–±—ã—á–Ω–æ 5x –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞)
- `margin_used` = –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω–∞—è –º–∞—Ä–∂–∞ –≤ USD

### 2. –†–∞—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏ –∏–∑ –º–∞—Ä–∂–∏

```
position_size = (margin_usd * leverage) / price
```

–û–±—Ä–∞—Ç–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞: —Å–∫–æ–ª—å–∫–æ –º–æ–Ω–µ—Ç –º–æ–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏ –∑–∞–¥–∞–Ω–Ω–æ–π –º–∞—Ä–∂–µ.

### 3. –†–∞—Å—á–µ—Ç –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞ –º–∞—Ä–∂–∏ (Margin Ratio)

```
margin_ratio = equity / margin_used
```

–ì–¥–µ:
- `equity` = –¥–æ—Å—Ç—É–ø–Ω—ã–π –±–∞–ª–∞–Ω—Å (–¥–ª—è –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –º–∞—Ä–∂–∏ = –≤—ã–¥–µ–ª–µ–Ω–Ω–∞—è –º–∞—Ä–∂–∞ + PnL)
- `margin_ratio` > 1.0 = –±–µ–∑–æ–ø–∞—Å–Ω–æ (—á–µ–º –≤—ã—à–µ, —Ç–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–µ–µ)

### 4. –¶–µ–Ω–∞ –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏

**–î–ª—è LONG:**
```
liquidation_price = entry_price * (1 - (1/leverage) + maintenance_margin
```

**–î–ª—è SHORT:**
```
liquidation_price = entry_price * (1 + (1/leverage)) - maintenance_margin
```

–ì–¥–µ:
- `maintenance_margin_ratio` = 0.01 (1% –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞)
- `initial_margin_ratio` = 0.1 (10% –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞)

---

## üìà –ú–ò–ù/–ú–ê–ö–° –ó–ù–ê–ß–ï–ù–ò–Ø

### A. Balance Profiles (–ü—Ä–æ—Ñ–∏–ª–∏ –±–∞–ª–∞–Ω—Å–∞)

| –ü—Ä–æ—Ñ–∏–ª—å | –ë–∞–ª–∞–Ω—Å | min_position_usd | max_position_usd | base_position_usd |
|---------|--------|------------------|------------------|-------------------|
| **micro** | $100-$500 | $18.0 | $500.0 | $30-$50 (–ø—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω–æ) |
| **small** | $500-$1500 | $18.0 | $500.0 | $50-$100 (–ø—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω–æ) |
| **medium** | $1500-$3000 | $50.0 | $250.0 | $100-$200 (–ø—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω–æ) |
| **large** | $3000+ | $100.0 | $500.0 | $200-$250 (–ø—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω–æ) |

### B. –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –º–∞—Ä–∂–∏ –ø–æ —Ä–µ–∂–∏–º–∞–º

#### 1. TRENDING (–¢—Ä–µ–Ω–¥)

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------|----------|
| `max_margin_percent` | **90.0%** | ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 85% (+6%) |
| `max_margin_safety_percent` | 90.0% | –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ |
| `max_loss_per_trade_percent` | 1.5% | –ú–µ–Ω—å—à–µ —Ä–∏—Å–∫ –≤ —Ç—Ä–µ–Ω–¥–µ |
| `max_drawdown_percent` | 6.0% | ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 4% (+50%) |
| `safety_threshold` | 1.5 | –ü–æ—Ä–æ–≥ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ margin_ratio |

#### 2. RANGING (–§–ª—ç—Ç)

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------|----------|
| `max_margin_percent` | **90.0%** | ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 85% (+6%) |
| `max_margin_safety_percent` | 90.0% | –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ |
| `max_loss_per_trade_percent` | 2.0% | –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ä–∏—Å–∫ |
| `max_drawdown_percent` | 7.0% | ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 5% (+40%) |
| `safety_threshold` | 1.5 | –ü–æ—Ä–æ–≥ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ margin_ratio |

#### 3. CHOPPY (–•–∞–æ—Å)

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------|----------|
| `max_margin_percent` | **85.0%** | ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 80% (+6%) |
| `max_margin_safety_percent` | 85.0% | –°—Ç—Ä–æ–∂–µ –≤ —Ö–∞–æ—Å–µ |
| `max_loss_per_trade_percent` | 2.5% | –ë–æ–ª—å—à–µ —Ä–∏—Å–∫ –≤ —Ö–∞–æ—Å–µ |
| `max_drawdown_percent` | 8.0% | ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 6% (+33%) |
| `safety_threshold` | 1.5 | –ü–æ—Ä–æ–≥ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ margin_ratio |

### C. –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ –±–∞–ª–∞–Ω—Å—É

| –ü—Ä–æ—Ñ–∏–ª—å | max_margin_percent | max_margin_safety_percent | max_loss_per_trade_percent |
|---------|-------------------|---------------------------|---------------------------|
| **micro** ($100-$500) | 85.0% | 90.0% | 2.5% |
| **small** ($500-$1500) | **85.0%** ‚úÖ | 90.0% | 2.0% |
| **medium** ($1500-$3000) | 75.0% | 85.0% | 1.8% |
| **large** ($3000+) | 70.0% | 80.0% | 1.5% |

---

## üîÑ –ê–î–ê–ü–¢–ò–í–ù–´–ï –ü–ê–†–ê–ú–ï–¢–†–´

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:

1. **–ü–†–ò–û–†–ò–¢–ï–¢ 1:** –†–µ–∂–∏–º —Ä—ã–Ω–∫–∞ (trending/ranging/choppy)
2. **–ü–†–ò–û–†–ò–¢–ï–¢ 2:** –ü—Ä–æ—Ñ–∏–ª—å –±–∞–ª–∞–Ω—Å–∞ (micro/small/medium/large)
3. **–ü–†–ò–û–†–ò–¢–ï–¢ 3:** –ë–∞–∑–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (fallback)

### –ü—Ä–∏–º–µ—Ä —Ä–∞—Å—á–µ—Ç–∞:

–î–ª—è –±–∞–ª–∞–Ω—Å–∞ $800 (small) –≤ —Ä–µ–∂–∏–º–µ ranging:
- `max_margin_percent` = **90.0%** (–∏–∑ ranging, –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –≤—ã—à–µ)
- `max_margin_safety_percent` = **90.0%** (–∏–∑ ranging)
- `max_loss_per_trade_percent` = **2.0%** (–∏–∑ ranging)
- `min_position_usd` = $18.0 (–∏–∑ balance_profile)
- `max_position_usd` = $500.0 (–∏–∑ balance_profile)

---

## üõ°Ô∏è –ü–†–û–í–ï–†–ö–ê –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò

### 1. Safety Threshold (–ü–æ—Ä–æ–≥ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)

**–§–æ—Ä–º—É–ª–∞:**
```
is_safe = margin_ratio >= safety_threshold
```

–ì–¥–µ:
- `safety_threshold` = **1.5** (–∞–¥–∞–ø—Ç–∏–≤–Ω–æ –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ –ø–æ —Ä–µ–∂–∏–º—É)
- `margin_ratio` = `equity / margin_used`

**–ó–Ω–∞—á–µ–Ω–∏—è:**
- `margin_ratio >= 1.5` = ‚úÖ **–ë–ï–ó–û–ü–ê–°–ù–û**
- `margin_ratio < 1.5` = ‚ö†Ô∏è **–û–ü–ê–°–ù–û** (–Ω–æ –∑–∞—â–∏—Ç–∞ –æ—Ç –ª–æ–∂–Ω—ã—Ö —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π)

### 2. –ó–∞—â–∏—Ç–∞ –æ—Ç –ª–æ–∂–Ω—ã—Ö —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π

**–£—Å–ª–æ–≤–∏—è –ø—Ä–æ–ø—É—Å–∫–∞ –∞–≤—Ç–æ–∑–∞–∫—Ä—ã—Ç–∏—è:**

1. **–ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ #1:**
   - `margin_ratio <= 1.5` –ò `abs(pnl) < 10 USDT`
   - ‚Üí –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ–∑–∞–∫—Ä—ã—Ç–∏–µ (–≤–æ–∑–º–æ–∂–Ω–æ, –ø–æ–∑–∏—Ü–∏—è —Ç–æ–ª—å–∫–æ —á—Ç–æ –æ—Ç–∫—Ä—ã—Ç–∞)

2. **–ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ #2:**
   - `margin_ratio <= 0.5` –ò `equity > 0`
   - ‚Üí –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ–∑–∞–∫—Ä—ã—Ç–∏–µ (–æ—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞)

3. **–ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ #3:**
   - `available_margin < -1000` –ò `abs(pnl) < 100 USDT`
   - ‚Üí –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ–∑–∞–∫—Ä—ã—Ç–∏–µ (–æ—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞)

4. **–ó–∞–¥–µ—Ä–∂–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏:**
   - –ü–æ–∑–∏—Ü–∏–∏, –æ—Ç–∫—Ä—ã—Ç—ã–µ **< 10 —Å–µ–∫—É–Ω–¥** –Ω–∞–∑–∞–¥, –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç –ø—Ä–æ–≤–µ—Ä–∫—É –º–∞—Ä–∂–∏

### 3. –õ–∏–º–∏—Ç—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –º–∞—Ä–∂–∏

**–§–æ—Ä–º—É–ª–∞:**
```
max_margin_allowed = balance * max_margin_percent
available_margin = balance - used_margin
```

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**

1. **Max Margin Used:**
   ```
   if used_margin + margin_required > max_margin_allowed:
       margin_required = max(0, max_margin_allowed - used_margin)
   ```

2. **Available Margin:**
   ```
   if margin_required > available_margin:
       margin_required = max(0, available_margin)
   ```

3. **Max Loss per Trade:**
   ```
   max_safe_margin = max_loss_usd / sl_percent
   if margin_required > max_safe_margin:
       margin_required = max_safe_margin
   ```

4. **Max Margin Safety (—Ñ–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞):**
   ```
   max_margin_safety = balance * max_margin_safety_percent
   if margin_required > max_margin_safety:
       margin_required = max_margin_safety
   ```

5. **–§–∏–Ω–∞–ª—å–Ω—ã–µ –ª–∏–º–∏—Ç—ã:**
   ```
   margin_usd = max(min_margin_usd, min(margin_required, max_margin_usd))
   ```

---

## üîÑ –ü–û–¢–û–ö –†–ê–°–ß–ï–¢–ê –ú–ê–†–ñ–ò

### –®–∞–≥ 1: –†–∞—Å—á–µ—Ç –±–∞–∑–æ–≤–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞

```
base_position_usd = balance_profile["base_position_usd"]
```

### –®–∞–≥ 2: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ per-symbol multiplier

```
base_position_usd *= symbol_multiplier (–µ—Å–ª–∏ –µ—Å—Ç—å –≤ –∫–æ–Ω—Ñ–∏–≥–µ)
```

### –®–∞–≥ 3: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ strength multiplier

```
base_position_usd *= strength_multiplier (–ø–æ —Å–∏–ª–µ —Å–∏–≥–Ω–∞–ª–∞)
base_position_usd = min(base_position_usd, max_position_usd)
```

### –®–∞–≥ 4: –†–∞—Å—á–µ—Ç –º–∞—Ä–∂–∏

```
notional_usd = base_position_usd
margin_required_initial = notional_usd / leverage
```

### –®–∞–≥ 5: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π (–ø–æ –ø–æ—Ä—è–¥–∫—É)

1. **Min/Max Position USD:**
   ```
   position_usd = max(min_position_usd, min(base_position_usd, max_position_usd))
   margin_required = position_usd / leverage
   ```

2. **Max Margin Used:**
   ```
   if used_margin + margin_required > max_margin_allowed:
       margin_required = max(0, max_margin_allowed - used_margin)
   ```

3. **Available Margin:**
   ```
   if margin_required > available_margin:
       margin_required = max(0, available_margin)
   ```

4. **Max Loss per Trade:**
   ```
   max_safe_margin = max_loss_usd / sl_percent
   if margin_required > max_safe_margin:
       margin_required = max_safe_margin
   ```

5. **Max Margin Safety:**
   ```
   max_margin_safety = balance * max_margin_safety_percent
   if margin_required > max_margin_safety:
       margin_required = max_margin_safety
   ```

6. **–§–∏–Ω–∞–ª—å–Ω—ã–µ –ª–∏–º–∏—Ç—ã:**
   ```
   min_margin_usd = min_position_usd / leverage
   max_margin_usd = max_position_usd / leverage
   margin_usd = max(min_margin_usd, min(margin_required, max_margin_usd))
   ```

### –®–∞–≥ 6: –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ —Ä–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏

```
position_size = (margin_usd * leverage) / price
```

### –®–∞–≥ 7: –û–∫—Ä—É–≥–ª–µ–Ω–∏–µ –¥–æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤

```
size_in_contracts = position_size / ct_val
rounded_size = round_to_step(size_in_contracts, lot_sz)
```

### –®–∞–≥ 8: –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–Ω–∏–º—É–º–∞ –±–∏—Ä–∂–∏

```
if rounded_size < min_sz:
    rounded_size = min_sz
    # –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º margin_usd –æ–±—Ä–∞—Ç–Ω–æ
```

### –®–∞–≥ 9: –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –º–∞—Ä–∂–∏

```
real_margin_usd = (rounded_size * ct_val * price) / leverage
if real_margin_usd < min_margin_usd:
    real_margin_usd = min_margin_usd
    # –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä –æ–±—Ä–∞—Ç–Ω–æ
```

---

## üêõ –ü–†–û–ë–õ–ï–ú–´ –ò –ó–ê–©–ò–¢–ê

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –º–∞—Ä–∂–∏

**–°–∏–º–ø—Ç–æ–º—ã:**
- `margin_ratio <= 1.5` –Ω–æ `abs(pnl) < 10 USDT`
- `margin_ratio <= 0.5` –Ω–æ `equity > 0`
- `available_margin < -1000` –Ω–æ `abs(pnl) < 100 USDT`

**–ó–∞—â–∏—Ç–∞:**
- ‚úÖ –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ–∑–∞–∫—Ä—ã—Ç–∏–µ (–≤–æ–∑–º–æ–∂–Ω–æ, –ø–æ–∑–∏—Ü–∏—è —Ç–æ–ª—å–∫–æ —á—Ç–æ –æ—Ç–∫—Ä—ã—Ç–∞)
- ‚úÖ –ó–∞–¥–µ—Ä–∂–∫–∞ 10 —Å–µ–∫—É–Ω–¥ –ø–µ—Ä–µ–¥ –ø—Ä–æ–≤–µ—Ä–∫–æ–π –º–∞—Ä–∂–∏ –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–∑–∏—Ü–∏–π
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞—Å—á–µ—Ç–æ–≤ –¥–ª—è –º–∞–ª—ã—Ö –ø–æ–∑–∏—Ü–∏–π (< 5 USDT margin)

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –û—à–∏–±–∫–∏ –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è

**–°–∏–º–ø—Ç–æ–º—ã:**
- –†–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä –º–µ–Ω—å—à–µ –º–∏–Ω–∏–º—É–º–∞ –±–∏—Ä–∂–∏
- –ü–æ—Å–ª–µ –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è margin < min_margin_usd

**–ó–∞—â–∏—Ç–∞:**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ –±–∏—Ä–∂–∏ (`min_sz`)
- ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –¥–æ –º–∏–Ω–∏–º—É–º–∞, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
- ‚úÖ –ü–µ—Ä–µ—Å—á–µ—Ç –º–∞—Ä–∂–∏ –ø–æ—Å–ª–µ –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –ö–æ–Ω—Ñ–ª–∏–∫—Ç –ª–∏–º–∏—Ç–æ–≤

**–°–∏–º–ø—Ç–æ–º—ã:**
- `min_position_usd` > `max_position_usd`
- `min_notional_usd` > `max_notional_usd`

**–ó–∞—â–∏—Ç–∞:**
- ‚úÖ –û—à–∏–±–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (raise ValueError)
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

---

## üìä –ü–†–ò–ú–ï–†–´ –†–ê–°–ß–ï–¢–ê

### –ü—Ä–∏–º–µ—Ä 1: –ë–∞–ª–∞–Ω—Å $800, —Ä–µ–∂–∏–º ranging, BTC-USDT

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- –ë–∞–ª–∞–Ω—Å: $800
- –ü—Ä–æ—Ñ–∏–ª—å: `small` ($500-$1500)
- –†–µ–∂–∏–º: `ranging`
- –¶–µ–Ω–∞: $60,000
- Leverage: 5x
- –°–∏–ª–∞ —Å–∏–≥–Ω–∞–ª–∞: `strong` (1.1x multiplier)

**–†–∞—Å—á–µ—Ç:**

1. –ë–∞–∑–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä (progressive –¥–ª—è small):
   - `min_balance` = $500
   - `threshold` = $1500
   - `size_at_min` = $50
   - `size_at_max` = $100
   - `progress` = ($800 - $500) / ($1500 - $500) = 0.3
   - `base_position_usd` = $50 + ($100 - $50) * 0.3 = **$65**

2. Strength multiplier:
   - `base_position_usd` = $65 * 1.1 = **$71.5**

3. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤:
   - `min_position_usd` = $18.0
   - `max_position_usd` = $500.0
   - `position_usd` = max($18, min($71.5, $500)) = **$71.5**

4. –†–∞—Å—á–µ—Ç –º–∞—Ä–∂–∏:
   - `margin_required` = $71.5 / 5 = **$14.3**

5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤ –º–∞—Ä–∂–∏:
   - `max_margin_percent` = 90.0% (ranging)
   - `max_margin_allowed` = $800 * 0.90 = **$720**
   - `used_margin` = 0 (–ø—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º)
   - `available_margin` = $800 - $0 = **$800**
   - `margin_required` < `max_margin_allowed` ‚úÖ
   - `margin_required` < `available_margin` ‚úÖ

6. –§–∏–Ω–∞–ª—å–Ω–∞—è –º–∞—Ä–∂–∞:
   - `min_margin_usd` = $18 / 5 = **$3.6**
   - `max_margin_usd` = $500 / 5 = **$100**
   - `margin_usd` = max($3.6, min($14.3, $100)) = **$14.3**

7. –†–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏:
   - `position_size` = ($14.3 * 5) / $60,000 = **0.00119 BTC**

---

## üéØ –ò–¢–û–ì–û–í–ê–Ø –¢–ê–ë–õ–ò–¶–ê –ü–ê–†–ê–ú–ï–¢–†–û–í

### –û—Å–Ω–æ–≤–Ω—ã–µ –ª–∏–º–∏—Ç—ã –º–∞—Ä–∂–∏:

| –ü–∞—Ä–∞–º–µ—Ç—Ä | Trending | Ranging | Choppy | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------|---------|--------|----------|
| `max_margin_percent` | **90%** | **90%** | **85%** | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ |
| `max_margin_safety_percent` | 90% | 90% | 85% | –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ |
| `safety_threshold` | 1.5 | 1.5 | 1.5 | –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π margin_ratio |
| `max_loss_per_trade_percent` | 1.5% | 2.0% | 2.5% | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∏—Å–∫ –Ω–∞ —Å–¥–µ–ª–∫—É |

### –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:

| –ü–∞—Ä–∞–º–µ—Ç—Ä | micro | small | medium | large |
|----------|-------|-------|--------|-------|
| `min_position_usd` | $18.0 | $18.0 | $50.0 | $100.0 |
| `min_margin_usd` (–ø—Ä–∏ 5x) | $3.6 | $3.6 | $10.0 | $20.0 |
| `min_balance_usd` | $10.0 | $20.0 | $30.0 | $50.0 |

### –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:

| –ü–∞—Ä–∞–º–µ—Ç—Ä | micro | small | medium | large |
|----------|-------|-------|--------|-------|
| `max_position_usd` | $500.0 | $500.0 | $250.0 | $500.0 |
| `max_margin_usd` (–ø—Ä–∏ 5x) | $100.0 | $100.0 | $50.0 | $100.0 |

---

## ‚úÖ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

1. ‚úÖ **–í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–µ** - —á–∏—Ç–∞—é—Ç—Å—è –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ –ø–æ —Ä–µ–∂–∏–º—É –∏ –±–∞–ª–∞–Ω—Å—É
2. ‚úÖ **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏** - 9 —à–∞–≥–æ–≤ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø–µ—Ä–µ–¥ –æ—Ç–∫—Ä—ã—Ç–∏–µ–º –ø–æ–∑–∏—Ü–∏–∏
3. ‚úÖ **–ó–∞—â–∏—Ç–∞ –æ—Ç –æ—à–∏–±–æ–∫** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π –∏ –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–∑–∏—Ü–∏–π
4. ‚úÖ **–û–∫—Ä—É–≥–ª–µ–Ω–∏–µ** - —É—á–µ—Ç –º–∏–Ω–∏–º—É–º–∞ –±–∏—Ä–∂–∏ –∏ –ø–µ—Ä–µ—Å—á–µ—Ç –º–∞—Ä–∂–∏ –ø–æ—Å–ª–µ –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è

---

**–î–∞—Ç–∞:** 23.11.2025, 22:15

