# üìä –ü–û–õ–ù–´–ô –ê–ù–ê–õ–ò–ó –î–õ–Ø –ö–ò–ú–ò

**–î–∞—Ç–∞:** 2025-12-21  
**–í–µ—Ä—Å–∏—è –±–æ—Ç–∞:** –° –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–º –ª–µ–≤–µ—Ä–∏–¥–∂–µ–º + –ª–µ—Å—Ç–Ω–∏—á–Ω—ã–º –≤—Ö–æ–¥–æ–º

---

## ‚úÖ 1. –ê–î–ê–ü–¢–ò–í–ù–´–ô –õ–ï–í–ï–†–ò–î–ñ (`adaptive_leverage.py`)

### üìç –§–∞–π–ª: `src/strategies/scalping/futures/risk/adaptive_leverage.py`

### üî¢ –§–æ—Ä–º—É–ª–∞ —Ä–∞—Å—á–µ—Ç–∞:

```python
# –®–∞–≥ 1: –ë–∞–∑–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è –ø–æ —Å–∏–ª–µ —Å–∏–≥–Ω–∞–ª–∞
signal_strength (0.0-1.0) ‚Üí –∫–∞—Ç–µ–≥–æ—Ä–∏—è:
  - very_weak (0.0-0.3) ‚Üí 3x
  - weak (0.3-0.5) ‚Üí 5x
  - medium (0.5-0.7) ‚Üí 10x
  - strong (0.7-0.9) ‚Üí 20x
  - very_strong (0.9-1.0) ‚Üí 30x

# –®–∞–≥ 2: –ú–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã
regime_multiplier:
  - trending: 1.2x
  - ranging: 1.0x
  - choppy: 0.8x

volatility_multiplier:
  - volatility > 5%: 0.7x (—É–º–µ–Ω—å—à–∞–µ–º)
  - volatility < 1%: 1.3x (—É–≤–µ–ª–∏—á–∏–≤–∞–µ–º)
  - –∏–Ω–∞—á–µ: 1.0x

# –®–∞–≥ 3: –§–∏–Ω–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç
adjusted_strength = signal_strength * regime_multiplier * volatility_multiplier
leverage = leverage_map[category]  # 3, 5, 10, 20, 30
leverage = max(3, min(30, leverage))  # –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–∏–∞–ø–∞–∑–æ–Ω–∞

# –®–∞–≥ 4: –û–∫—Ä—É–≥–ª–µ–Ω–∏–µ –¥–æ –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –Ω–∞ –±–∏—Ä–∂–µ
leverage = await client.round_leverage_to_available(symbol, leverage)
```

### üìä –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:
- `signal["strength"]` (0.0-1.0) - —Å–∏–ª–∞ —Å–∏–≥–Ω–∞–ª–∞
- `regime` (trending/ranging/choppy) - —Ä–µ–∂–∏–º —Ä—ã–Ω–∫–∞
- `volatility` (ATR % –æ—Ç —Ü–µ–Ω—ã) - –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å

### üì§ –í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:
- `leverage` (3, 5, 10, 20, 30) - –æ–∫—Ä—É–≥–ª–µ–Ω–Ω—ã–π –¥–æ –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –Ω–∞ –±–∏—Ä–∂–µ

---

## ‚úÖ 2. –õ–ï–°–¢–ù–ò–ß–ù–´–ô –í–•–û–î (`position_scaling_manager.py`)

### üìç –§–∞–π–ª: `src/strategies/scalping/futures/positions/position_scaling_manager.py`

### üî¢ –õ–µ—Å—Ç–Ω–∏—Ü–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é):
```python
ladder = [1.0, 0.8, 0.6, 0.4, 0.3, 0.2, 0.15]
# 7 —à–∞–≥–æ–≤:
# 1. 100% –±–∞–∑–æ–≤–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞
# 2. 80% –±–∞–∑–æ–≤–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞
# 3. 60% –±–∞–∑–æ–≤–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞
# 4. 40% –±–∞–∑–æ–≤–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞
# 5. 30% –±–∞–∑–æ–≤–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞
# 6. 20% –±–∞–∑–æ–≤–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞
# 7. 15% –±–∞–∑–æ–≤–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞
```

### üìä –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
- **max_additions**: 7 (–º–∞–∫—Å–∏–º—É–º –¥–æ–±–∞–≤–ª–µ–Ω–∏–π)
- **min_interval_seconds**: 30 (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–∂–¥—É –¥–æ–±–∞–≤–ª–µ–Ω–∏—è–º–∏)
- **max_loss_for_addition**: -3.0% (–º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —É–±—ã—Ç–æ–∫ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è)

### üîÑ –õ–æ–≥–∏–∫–∞:
```python
# –†–∞—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–∞ —Å–ª–µ–¥—É—é—â–µ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
addition_count = len(scaling_history)  # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–Ω—ã—Ö –¥–æ–±–∞–≤–ª–µ–Ω–∏–π
ladder_coefficient = ladder[addition_count]  # –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –∏–∑ –ª–µ—Å—Ç–Ω–∏—Ü—ã
addition_size_usd = base_size_usd * ladder_coefficient

# –ö–†–ò–¢–ò–ß–ù–û: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è leverage —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –ø–æ–∑–∏—Ü–∏–∏!
existing_leverage = await _get_existing_position_leverage(symbol)
signal["leverage"] = existing_leverage  # –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º leverage
```

### ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º:
1. –ü–æ–∑–∏—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ —Ä–µ–µ—Å—Ç—Ä–µ
2. –ù–µ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç –º–∞–∫—Å–∏–º—É–º –¥–æ–±–∞–≤–ª–µ–Ω–∏–π (7)
3. –ü—Ä–æ—à–µ–ª –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª (30 —Å–µ–∫)
4. –£–±—ã—Ç–æ–∫ –Ω–µ –ø—Ä–µ–≤—ã—à–∞–µ—Ç -3.0%
5. –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–∞—Ä–∂–∏ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è

---

## ‚úÖ 3. –•–†–ê–ù–ï–ù–ò–ï –ü–û–ó–ò–¶–ò–ô (`position_registry.py`)

### üìç –§–∞–π–ª: `src/strategies/scalping/futures/core/position_registry.py`

### üîÑ –ö–∞–∫ —Ö—Ä–∞–Ω—è—Ç—Å—è "—Å–ª–æ–∂–µ–Ω–Ω—ã–µ" –ø–æ–∑–∏—Ü–∏–∏:

**–û–¢–í–ï–¢: –û–¥–Ω–∞ –ø–æ–∑–∏—Ü–∏—è –Ω–∞ –±–∏—Ä–∂–µ, –Ω–æ —Å –∏—Å—Ç–æ—Ä–∏–µ–π –¥–æ–±–∞–≤–ª–µ–Ω–∏–π –≤ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö**

```python
# –ù–∞ –±–∏—Ä–∂–µ:
- –û–¥–Ω–∞ –ø–æ–∑–∏—Ü–∏—è —Å —É—Å—Ä–µ–¥–Ω–µ–Ω–Ω–æ–π —Ü–µ–Ω–æ–π –≤—Ö–æ–¥–∞ (avgPx)
- –ë–∏—Ä–∂–∞ —Å–∞–º–∞ —É—Å—Ä–µ–¥–Ω—è–µ—Ç —Ü–µ–Ω—É –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è—Ö

# –í –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö (PositionMetadata):
- entry_price: float  # –¢–µ–∫—É—â–∞—è —É—Å—Ä–µ–¥–Ω–µ–Ω–Ω–∞—è —Ü–µ–Ω–∞ –≤—Ö–æ–¥–∞
- scaling_history: List[Dict]  # –ò—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö –¥–æ–±–∞–≤–ª–µ–Ω–∏–π:
  [
    {"timestamp": 1234567890, "size_usd": 100.0, "leverage": 10},
    {"timestamp": 1234567920, "size_usd": 80.0, "leverage": 10},
    {"timestamp": 1234567950, "size_usd": 60.0, "leverage": 10},
    ...
  ]
```

### üìä –£—Å—Ä–µ–¥–Ω–µ–Ω–∏–µ —Ü–µ–Ω—ã:
- **–ë–∏—Ä–∂–∞ –¥–µ–ª–∞–µ—Ç —Å–∞–º–∞** - –ø—Ä–∏ –∫–∞–∂–¥–æ–º –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –±–∏—Ä–∂–∞ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç `avgPx` (—Å—Ä–µ–¥–Ω–µ–≤–∑–≤–µ—à–µ–Ω–Ω–∞—è —Ü–µ–Ω–∞)
- –ë–æ—Ç –Ω–µ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —É—Å—Ä–µ–¥–Ω–µ–Ω–∏–µ –≤—Ä—É—á–Ω—É—é, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `avgPx` —Å –±–∏—Ä–∂–∏

---

## ‚úÖ 4. –ó–ê–ö–†–´–¢–ò–ï –ü–û–ó–ò–¶–ò–ô (`position_manager.py`, `exit_analyzer.py`)

### üìç –§–∞–π–ª—ã:
- `src/strategies/scalping/futures/position_manager.py` (–º–µ—Ç–æ–¥ `close_position_partially`)
- `src/strategies/scalping/futures/positions/exit_analyzer.py` (–ª–æ–≥–∏–∫–∞ –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π)

### üîÑ –ö–∞–∫ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è "—Å–ª–æ–∂–µ–Ω–Ω–∞—è" –ø–æ–∑–∏—Ü–∏—è:

**–û–¢–í–ï–¢: –ß–∞—Å—Ç–∏—á–Ω–æ (fraction) –∏–ª–∏ —Ü–µ–ª–∏–∫–æ–º. –ë–∏—Ä–∂–∞ —Ä–µ—à–∞–µ—Ç –∫–∞–∫–∏–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã –∑–∞–∫—Ä—ã–≤–∞—Ç—å (FIFO/LIFO)**

```python
# –ß–∞—Å—Ç–∏—á–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ (Partial TP)
fraction = 0.6  # 60% –ø–æ–∑–∏—Ü–∏–∏
close_size_contracts = abs(current_size) * fraction
remaining_size_contracts = abs(current_size) * (1.0 - fraction)

# –ë–∏—Ä–∂–∞ —Å–∞–º–∞ —Ä–µ—à–∞–µ—Ç –∫–∞–∫–∏–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã –∑–∞–∫—Ä—ã–≤–∞—Ç—å
# (–æ–±—ã—á–Ω–æ FIFO - –ø–µ—Ä–≤—ã–µ –æ—Ç–∫—Ä—ã—Ç—ã–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è –ø–µ—Ä–≤—ã–º–∏)
```

### üìä –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è fraction –¥–ª—è Partial TP:
```python
base_fraction = 0.6  # 60% –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

# –ê–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ PnL:
if pnl_percent < 1.0:
    fraction = base_fraction * 0.67  # 40% –µ—Å–ª–∏ PnL < 1.0%
elif pnl_percent >= 2.0:
    fraction = base_fraction * 1.33  # 80% –µ—Å–ª–∏ PnL >= 2.0%
else:
    fraction = base_fraction  # 60% —Å—Ç–∞–Ω–¥–∞—Ä—Ç
```

### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞ —Å Partial TP (40% –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è):
- **–ü—Ä–∏—á–∏–Ω–∞**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∑–∞–∫—Ä—ã—Ç–∏—è
- **–ö–æ–¥**: `position_manager.py:6080-6099`
- **–õ–æ–≥–∏–∫–∞**: –ï—Å–ª–∏ —Å—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞–∫—Ä—ã—Ç–∏—è < $3-10 (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø—Ä–æ—Ñ–∏–ª—è), —Ç–æ –∑–∞–∫—Ä—ã—Ç–∏–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è
- **–†–µ—à–µ–Ω–∏–µ**: –£–º–µ–Ω—å—à–∏—Ç—å `min_partial_tp_value_usd` –∏–ª–∏ —É–±—Ä–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É

---

## ‚úÖ 5. –ö–û–ù–¢–†–û–õ–¨ –†–ò–°–ö–ê (`risk_manager.py`)

### üìç –§–∞–π–ª: `src/strategies/scalping/futures/risk_manager.py`

### üî¢ –û–±—â–∏–π —Ä–∏—Å–∫ –ø—Ä–∏ –ª–µ—Å—Ç–Ω–∏—á–Ω–æ–º –≤—Ö–æ–¥–µ:

```python
# –ü—Ä–∏ –∫–∞–∂–¥–æ–º –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è:
1. –î–æ—Å—Ç—É–ø–Ω–∞—è –º–∞—Ä–∂–∞: available_margin >= margin_needed * 1.2 (—Ä–µ–∑–µ—Ä–≤ 20%)
2. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –º–∞—Ä–∂–∞ –Ω–∞ –ø–æ–∑–∏—Ü–∏—é: margin_needed <= max_margin_per_position * 0.5
3. –û–±—â–∏–π —Ä–∏—Å–∫ –ø–æ—Ä—Ç—Ñ–µ–ª—è: total_margin <= balance * max_portfolio_margin (65%)

# –†–∞—Å—á–µ—Ç –º–∞—Ä–∂–∏ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è:
margin_needed = addition_size_usd / existing_leverage
# –ö–†–ò–¢–ò–ß–ù–û: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è leverage —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –ø–æ–∑–∏—Ü–∏–∏!
```

### üìä –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞:
```yaml
risk_config:
  max_margin_per_trade: 22.0%  # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –º–∞—Ä–∂–∞ –Ω–∞ —Å–¥–µ–ª–∫—É
  max_portfolio_margin: 65.0%   # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –º–∞—Ä–∂–∞ –≤ –ø–æ—Ä—Ç—Ñ–µ–ª–µ
  min_margin_cap: 8.0 USD       # –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –º–∞—Ä–∂–∞
  max_margin_cap_multiplier: 2.5  # –ú–Ω–æ–∂–∏—Ç–µ–ª—å –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ –∫–∞–ø–∞
```

---

## ‚úÖ 6. –ö–û–ù–§–ò–ì (`config_futures.yaml`)

### üìç –§–∞–π–ª: `config/config_futures.yaml`

### üî¢ –ù–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

```yaml
# –õ–µ—Å—Ç–Ω–∏—á–Ω—ã–π –≤—Ö–æ–¥
position_scaling:
  max_additions: 7
  min_interval_seconds: 30
  max_loss_for_addition: -3.0
  ladder: [1.0, 0.8, 0.6, 0.4, 0.3, 0.2, 0.15]

# –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –ª–µ–≤–µ—Ä–∏–¥–∂ (–≤ –∫–æ–¥–µ, –Ω–µ –≤ –∫–æ–Ω—Ñ–∏–≥–µ)
# –î–∏–∞–ø–∞–∑–æ–Ω: 3-30x
# –ó–∞–≤–∏—Å–∏—Ç –æ—Ç: signal_strength, regime, volatility

# Partial TP
partial_tp:
  enabled: true
  fraction: 0.6  # 60% –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  trigger_percent: 1.0  # –ê–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ 1.0% –ø—Ä–∏–±—ã–ª–∏
  by_regime:
    trending:
      fraction: 0.5
      trigger_percent: 1.2
    ranging:
      fraction: 0.6
      trigger_percent: 1.2
    choppy:
      fraction: 0.7
      trigger_percent: 0.8

# –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∏—Å–∫
risk_config:
  max_margin_per_trade: 22.0%
  max_portfolio_margin: 65.0%
```

---

## ‚ùì –û–¢–í–ï–¢–´ –ù–ê –í–û–ü–†–û–°–´ –ö–ò–ú–ò

### 1. –°–∫–æ–ª—å–∫–æ —à–∞–≥–æ–≤ –≤ –ª–µ—Å—Ç–Ω–∏—Ü–µ?
**–û–¢–í–ï–¢: 7 —à–∞–≥–æ–≤** (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- –õ–µ—Å—Ç–Ω–∏—Ü–∞: `[1.0, 0.8, 0.6, 0.4, 0.3, 0.2, 0.15]`
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ –∫–æ–Ω—Ñ–∏–≥–µ —á–µ—Ä–µ–∑ `position_scaling.ladder`

### 2. –ö–∞–∫ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π –ª–µ–≤–µ—Ä–∏–¥–∂?
**–û–¢–í–ï–¢: –°–º. —Ä–∞–∑–¥–µ–ª 1 –≤—ã—à–µ**
- –§–æ—Ä–º—É–ª–∞: `adjusted_strength = signal_strength * regime_multiplier * volatility_multiplier`
- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏: very_weak(3x), weak(5x), medium(10x), strong(20x), very_strong(30x)
- –û–∫—Ä—É–≥–ª—è–µ—Ç—Å—è –¥–æ –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –Ω–∞ –±–∏—Ä–∂–µ

### 3. –û–¥–Ω–∞ –ø–æ–∑–∏—Ü–∏—è –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ?
**–û–¢–í–ï–¢: –û–¥–Ω–∞ –ø–æ–∑–∏—Ü–∏—è –Ω–∞ –±–∏—Ä–∂–µ, –Ω–æ —Å –∏—Å—Ç–æ—Ä–∏–µ–π –¥–æ–±–∞–≤–ª–µ–Ω–∏–π –≤ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö**
- –ë–∏—Ä–∂–∞ —É—Å—Ä–µ–¥–Ω—è–µ—Ç —Ü–µ–Ω—É –≤—Ö–æ–¥–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (`avgPx`)
- –ò—Å—Ç–æ—Ä–∏—è —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ `PositionMetadata.scaling_history`

### 4. –ö–∞–∫ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è?
**–û–¢–í–ï–¢: –ß–∞—Å—Ç–∏—á–Ω–æ (fraction) –∏–ª–∏ —Ü–µ–ª–∏–∫–æ–º. –ë–∏—Ä–∂–∞ —Ä–µ—à–∞–µ—Ç (FIFO/LIFO)**
- –ß–∞—Å—Ç–∏—á–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ: `close_position_partially(symbol, fraction, reason)`
- –ë–∏—Ä–∂–∞ —Å–∞–º–∞ —Ä–µ—à–∞–µ—Ç –∫–∞–∫–∏–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã –∑–∞–∫—Ä—ã–≤–∞—Ç—å
- –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è fraction –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç PnL

### 5. –ï—Å—Ç—å –ª–∏ –ª–æ–≥–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å?
**–û–¢–í–ï–¢: –î–∞, –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `logs/futures/archived/logs_2025-12-21_10-22-57/`**
- `futures_main_2025-12-21.log` - –æ—Å–Ω–æ–≤–Ω—ã–µ –ª–æ–≥–∏
- `trades_2025-12-21.csv` - –≤—Å–µ —Å–¥–µ–ª–∫–∏
- `signals_2025-12-21.csv` - –≤—Å–µ —Å–∏–≥–Ω–∞–ª—ã
- `orders_2025-12-21.csv` - –≤—Å–µ –æ—Ä–¥–µ—Ä–∞
- `errors_2025-12-21.log` - –æ—à–∏–±–∫–∏

---

## ‚ö†Ô∏è –ü–†–û–ë–õ–ï–ú–´ –ò –†–ï–®–ï–ù–ò–Ø

### 1. Partial TP –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç 40%
**–ü—Ä–æ–±–ª–µ–º–∞**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∑–∞–∫—Ä—ã—Ç–∏—è –±–ª–æ–∫–∏—Ä—É–µ—Ç —á–∞—Å—Ç–∏—á–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ  
**–ö–æ–¥**: `position_manager.py:6080-6099`  
**–†–µ—à–µ–Ω–∏–µ**: –£–º–µ–Ω—å—à–∏—Ç—å `min_partial_tp_value_usd` –∏–ª–∏ —É–±—Ä–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É

### 2. Position limit >= 5
**–ü—Ä–æ–±–ª–µ–º–∞**: –í –∫–æ–¥–µ –µ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∞ `>= 5`, –Ω–æ –≤ –∫–æ–Ω—Ñ–∏–≥–µ `max_positions_per_symbol: 1`  
**–ö–æ–¥**: `signal_coordinator.py:458, 485, 1167`  
**–†–µ—à–µ–Ω–∏–µ**: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥ –∏ –∫–æ–¥

### 3. –û–∫—Ä—É–≥–ª–µ–Ω–∏–µ —Ü–µ–Ω—ã (51006)
**–ü—Ä–æ–±–ª–µ–º–∞**: –û—à–∏–±–∫–∞ 51006 - —Ü–µ–Ω–∞ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º –±–∏—Ä–∂–∏  
**–ö–æ–¥**: `order_executor.py:_calculate_limit_price`  
**–†–µ—à–µ–Ω–∏–µ**: –£–ª—É—á—à–∏—Ç—å –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ —Ü–µ–Ω—ã –¥–æ tick size

---

## üìÅ –°–ü–ò–°–û–ö –§–ê–ô–õ–û–í –î–õ–Ø –ö–ò–ú–ò

1. ‚úÖ `src/strategies/scalping/futures/risk/adaptive_leverage.py` - –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –ª–µ–≤–µ—Ä–∏–¥–∂
2. ‚úÖ `src/strategies/scalping/futures/positions/position_scaling_manager.py` - –õ–µ—Å—Ç–Ω–∏—á–Ω—ã–π –≤—Ö–æ–¥
3. ‚úÖ `src/strategies/scalping/futures/position_manager.py` - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏—è–º–∏
4. ‚úÖ `src/strategies/scalping/futures/positions/exit_analyzer.py` - –õ–æ–≥–∏–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è
5. ‚úÖ `src/strategies/scalping/futures/risk_manager.py` - –ö–æ–Ω—Ç—Ä–æ–ª—å —Ä–∏—Å–∫–∞
6. ‚úÖ `src/strategies/scalping/futures/order_executor.py` - –ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Ä–¥–µ—Ä–æ–≤
7. ‚úÖ `config/config_futures.yaml` - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
8. ‚úÖ `logs/futures/archived/logs_2025-12-21_10-22-57/` - –õ–æ–≥–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å–µ—Å—Å–∏–∏

---

## üéØ –ö–õ–Æ–ß–ï–í–´–ï –ú–û–ú–ï–ù–¢–´

1. **–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –ª–µ–≤–µ—Ä–∏–¥–∂**: 3-30x –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–∞—á–µ—Å—Ç–≤–∞ —Å–∏–≥–Ω–∞–ª–∞
2. **–õ–µ—Å—Ç–Ω–∏—á–Ω—ã–π –≤—Ö–æ–¥**: 7 —à–∞–≥–æ–≤ —Å —É–º–µ–Ω—å—à–µ–Ω–∏–µ–º —Ä–∞–∑–º–µ—Ä–∞ (100% ‚Üí 15%)
3. **–•—Ä–∞–Ω–µ–Ω–∏–µ**: –û–¥–Ω–∞ –ø–æ–∑–∏—Ü–∏—è –Ω–∞ –±–∏—Ä–∂–µ, –∏—Å—Ç–æ—Ä–∏—è –≤ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
4. **–ó–∞–∫—Ä—ã—Ç–∏–µ**: –ß–∞—Å—Ç–∏—á–Ω–æ–µ (fraction) –∏–ª–∏ —Ü–µ–ª–∏–∫–æ–º, –±–∏—Ä–∂–∞ —Ä–µ—à–∞–µ—Ç FIFO/LIFO
5. **–†–∏—Å–∫**: –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
6. **Partial TP**: –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è fraction (40-80%) –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç PnL

---

**–ì–æ—Ç–æ–≤–æ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ö–ò–ú–ò! üöÄ**








