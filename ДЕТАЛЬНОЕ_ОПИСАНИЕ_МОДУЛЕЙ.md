# üî¨ –î–ï–¢–ê–õ–¨–ù–û–ï –û–ü–ò–°–ê–ù–ò–ï –ú–û–î–£–õ–ï–ô (Phase 1 + 2 + 3)

## üìö –°–û–î–ï–†–ñ–ê–ù–ò–ï

1. Phase 1: –ë–∞–∑–æ–≤—ã–µ –º–æ–¥—É–ª–∏ (6 —à—Ç)
2. Phase 2: –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –º–æ–¥—É–ª–∏ (2 —à—Ç)
3. Phase 3: AI –º–æ–¥—É–ª—å (1 —à—Ç)
4. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ –∏—Ö –≤–ª–∏—è–Ω–∏–µ
5. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ì–∏–±—Ä–∏–¥–æ–º

---

# üéØ PHASE 1: –ë–ê–ó–û–í–´–ï –ú–û–î–£–õ–ò

---

## 1Ô∏è‚É£ MULTI-TIMEFRAME CONFIRMATION

### üìÅ –§–∞–π–ª: `src/strategies/modules/multi_timeframe.py`

### üéØ –¶–µ–ª—å –º–æ–¥—É–ª—è:
–§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å —Å–∏–≥–Ω–∞–ª—ã –Ω–∞ 1m, –∫–æ—Ç–æ—Ä—ã–µ –ü–†–û–¢–ò–í —Ç—Ä–µ–Ω–¥–∞ –Ω–∞ 5m.

### üîß –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã:

**–®–∞–≥ 1**: –ü–æ–ª—É—á–∞–µ–º —Å–∏–≥–Ω–∞–ª –Ω–∞ 1m
```
1m: LONG —Å–∏–≥–Ω–∞–ª (—Ü–µ–Ω–∞ –ø—Ä–æ–±–∏–ª–∞ SMA5 –≤–≤–µ—Ä—Ö)
```

**–®–∞–≥ 2**: –ü—Ä–æ–≤–µ—Ä—è–µ–º 5m —Ç–∞–π–º—Ñ—Ä–µ–π–º
```
–ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ 100 —Å–≤–µ—á–µ–π 5m
–†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º EMA8 –∏ EMA21 –Ω–∞ 5m
```

**–®–∞–≥ 3**: –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
```
5m: EMA8 > EMA21 (–±—ã—á–∏–π —Ç—Ä–µ–Ω–¥) ‚úÖ
1m: LONG —Å–∏–≥–Ω–∞–ª ‚úÖ
‚Üí –°–æ–≤–ø–∞–¥–∞—é—Ç! –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ–º +2 –±–∞–ª–ª–∞

–ò–õ–ò

5m: EMA8 < EMA21 (–º–µ–¥–≤–µ–∂–∏–π —Ç—Ä–µ–Ω–¥) ‚ùå
1m: LONG —Å–∏–≥–Ω–∞–ª
‚Üí –ö–æ–Ω—Ñ–ª–∏–∫—Ç! –ë–ª–æ–∫–∏—Ä—É–µ–º —Å–∏–≥–Ω–∞–ª
```

### üìä –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ –≤–∞—Ä–∏–∞–Ω—Ç—ã:

#### –í–∞—Ä–∏–∞–Ω—Ç 1: –ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π (–º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å)
```yaml
multi_timeframe:
  confirmation_timeframe: "15m"       # –°—Ç–∞—Ä—à–∏–π —Ç–∞–π–º—Ñ—Ä–µ–π–º
  block_against_trend: true           # –°—Ç—Ä–æ–≥–æ –±–ª–æ–∫–∏—Ä—É–µ–º
  require_rsi_confirmation: true      # RSI –Ω–∞ 15m —Ç–æ–∂–µ –¥–æ–ª–∂–µ–Ω –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—Ç—å
  min_candles: 50                     # –ë–æ–ª—å—à–µ –¥–∞–Ω–Ω—ã—Ö
  score_bonus: 3                      # –ë–æ–ª—å—à–µ –≤–µ—Å
```
**–≠—Ñ—Ñ–µ–∫—Ç**:
- –°–¥–µ–ª–æ–∫: -50% (–æ—á–µ–Ω—å —Å—Ç—Ä–æ–≥–∏–π –æ—Ç–±–æ—Ä)
- Win Rate: +30% (—Ç–æ–ª—å–∫–æ –ø–æ —Å–∏–ª—å–Ω–æ–º—É —Ç—Ä–µ–Ω–¥—É)
- –ü—Ä–∏–±—ã–ª—å: +20-25% (–º–µ–Ω—å—à–µ, –Ω–æ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–µ–µ)

#### –í–∞—Ä–∏–∞–Ω—Ç 2: –°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```yaml
multi_timeframe:
  confirmation_timeframe: "5m"        # –°—Ä–µ–¥–Ω–∏–π
  block_against_trend: true           # –ë–ª–æ–∫–∏—Ä—É–µ–º
  require_rsi_confirmation: false     # –¢–æ–ª—å–∫–æ EMA
  min_candles: 20                     # –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ
  score_bonus: 2                      # –°—Ä–µ–¥–Ω–∏–π –≤–µ—Å
```
**–≠—Ñ—Ñ–µ–∫—Ç**:
- –°–¥–µ–ª–æ–∫: -20% (—É–º–µ—Ä–µ–Ω–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è)
- Win Rate: +20% (—Ö–æ—Ä–æ—à–∏–π –±–∞–ª–∞–Ω—Å)
- –ü—Ä–∏–±—ã–ª—å: +30-35% (–æ–ø—Ç–∏–º–∞–ª—å–Ω–æ)

#### –í–∞—Ä–∏–∞–Ω—Ç 3: –ê–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π (–±–æ–ª—å—à–µ —Å–¥–µ–ª–æ–∫)
```yaml
multi_timeframe:
  confirmation_timeframe: "3m"        # –ë–ª–∏–∂–µ –∫ 1m
  block_against_trend: false          # –ù–ï –±–ª–æ–∫–∏—Ä—É–µ–º, —Ç–æ–ª—å–∫–æ bonus
  score_bonus: 1                      # –ú–∞–ª—ã–π –≤–µ—Å
  allow_counter_trend: true           # –†–∞–∑—Ä–µ—à–∞–µ–º –ø—Ä–æ—Ç–∏–≤ —Ç—Ä–µ–Ω–¥–∞
```
**–≠—Ñ—Ñ–µ–∫—Ç**:
- –°–¥–µ–ª–æ–∫: -10% (—Å–ª–∞–±–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è)
- Win Rate: +10% (–Ω–µ–±–æ–ª—å—à–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ)
- –ü—Ä–∏–±—ã–ª—å: +15-20%

### üí° –ü–æ—á–µ–º—É –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ:

**–†–∞–∑–Ω—ã–µ –∞–∫—Ç–∏–≤—ã ‚Üí —Ä–∞–∑–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã**!

```yaml
# BTC (–º–µ–¥–ª–µ–Ω–Ω—ã–π, —Ç—Ä–µ–Ω–¥—ã –¥–æ–ª–≥–∏–µ)
multi_timeframe:
  BTC-USDT:
    confirmation_timeframe: "15m"     # –°—Ç–∞—Ä—à–∏–π —Ç–∞–π–º—Ñ—Ä–µ–π–º
    
# SOL (–±—ã—Å—Ç—Ä—ã–π, —Ç—Ä–µ–Ω–¥—ã –∫–æ—Ä–æ—Ç–∫–∏–µ)
multi_timeframe:
  SOL-USDT:
    confirmation_timeframe: "3m"      # –ú–ª–∞–¥—à–∏–π —Ç–∞–π–º—Ñ—Ä–µ–π–º
    
# ETH (—Å—Ä–µ–¥–Ω–∏–π)
multi_timeframe:
  ETH-USDT:
    confirmation_timeframe: "5m"
```

---

## 2Ô∏è‚É£ CORRELATION FILTER

### üìÅ –§–∞–π–ª: `src/filters/correlation_manager.py`

### üéØ –¶–µ–ª—å –º–æ–¥—É–ª—è:
–ù–µ –æ—Ç–∫—Ä—ã–≤–∞—Ç—å 3 –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –ø–æ–∑–∏—Ü–∏–∏ (–≤—Å–µ LONG –∏–ª–∏ –≤—Å–µ SHORT) –Ω–∞ –∫–æ—Ä—Ä–µ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∞–∫—Ç–∏–≤–∞—Ö.

### üîß –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã:

**–®–∞–≥ 1**: –†–∞—Å—á–µ—Ç –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏ (–∫–∞–∂–¥—ã–π —á–∞—Å)
```python
# –°–æ–±–∏—Ä–∞–µ–º —Ü–µ–Ω—ã –∑–∞ 24 —á–∞—Å–∞
btc_prices = [60000, 60100, 60050, ..., 61000]  # 1440 —Ç–æ—á–µ–∫ (–º–∏–Ω—É—Ç–Ω—ã–µ)
eth_prices = [3800, 3805, 3802, ..., 3850]
sol_prices = [180, 180.5, 180.2, ..., 182]

# –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏
btc_returns = (btc_prices[1:] - btc_prices[:-1]) / btc_prices[:-1]
eth_returns = (eth_prices[1:] - eth_prices[:-1]) / eth_prices[:-1]
sol_returns = (sol_prices[1:] - sol_prices[:-1]) / sol_prices[:-1]

# –ö–æ—Ä—Ä–µ–ª—è—Ü–∏—è (Pearson)
corr_btc_eth = np.corrcoef(btc_returns, eth_returns)[0, 1]  # –ù–∞–ø—Ä–∏–º–µ—Ä: 0.92
corr_btc_sol = np.corrcoef(btc_returns, sol_returns)[0, 1]  # –ù–∞–ø—Ä–∏–º–µ—Ä: 0.78
corr_eth_sol = np.corrcoef(eth_returns, sol_returns)[0, 1]  # –ù–∞–ø—Ä–∏–º–µ—Ä: 0.85
```

**–®–∞–≥ 2**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –≤—Ö–æ–¥–æ–º
```python
# –£–∂–µ –æ—Ç–∫—Ä—ã—Ç–æ:
positions = {
    "BTC-USDT": LONG,
    "ETH-USDT": LONG
}

# –ù–æ–≤—ã–π —Å–∏–≥–Ω–∞–ª:
new_signal = "SOL-USDT: LONG"

# –ü—Ä–æ–≤–µ—Ä–∫–∞:
def can_open_position(new_symbol, new_direction):
    correlated_positions = []
    
    for symbol, position in positions.items():
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ—Ä—Ä–µ–ª—è—Ü–∏—é
        corr = get_correlation(new_symbol, symbol)
        
        # –ï—Å–ª–∏ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏—è –≤—ã—Å–æ–∫–∞—è –ò –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ –∂–µ
        if corr > 0.7 and position.direction == new_direction:
            correlated_positions.append(symbol)
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–∏–º–∏—Ç
    if len(correlated_positions) >= MAX_CORRELATED:
        return False  # –ë–ª–æ–∫–∏—Ä—É–µ–º
    
    return True

# –†–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è SOL:
# - BTC-SOL: 0.78 > 0.7 ‚úÖ + BTC LONG ‚Üí correlated
# - ETH-SOL: 0.85 > 0.7 ‚úÖ + ETH LONG ‚Üí correlated
# - –ò—Ç–æ–≥–æ: 2 –∫–æ—Ä—Ä–µ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö LONG
# - Max: 2
# ‚Üí –ë–õ–û–ö–ò–†–£–ï–ú SOL LONG
```

### üìä –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ –∏—Ö –≤–ª–∏—è–Ω–∏–µ:

#### –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç 1: –°—Ç—Ä–æ–≥–∞—è –∫–æ—Ä—Ä–µ–ª—è—Ü–∏—è
```yaml
correlation_filter:
  correlation_threshold: 0.6          # –ù–∏–∑–∫–∏–π –ø–æ—Ä–æ–≥
  max_correlated_positions: 1         # –¢–æ–ª—å–∫–æ 1 –ø–æ–∑–∏—Ü–∏—è
```
**–≠—Ñ—Ñ–µ–∫—Ç**:
- –°–¥–µ–ª–æ–∫: -40% (–æ—á–µ–Ω—å —Å—Ç—Ä–æ–≥–æ)
- –î–∏–≤–µ—Ä—Å–∏—Ñ–∏–∫–∞—Ü–∏—è: –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è
- –†–∏—Å–∫ –ø—Ä–æ—Å–∞–¥–∫–∏: -60%
- –£–ø—É—â–µ–Ω–Ω–∞—è –ø—Ä–∏–±—ã–ª—å –≤ —Ç—Ä–µ–Ω–¥–∞—Ö: +30%

#### –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç 2: –°—Ä–µ–¥–Ω—è—è –∫–æ—Ä—Ä–µ–ª—è—Ü–∏—è (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```yaml
correlation_filter:
  correlation_threshold: 0.75         # –°—Ä–µ–¥–Ω–∏–π –ø–æ—Ä–æ–≥
  max_correlated_positions: 2         # 2 –ø–æ–∑–∏—Ü–∏–∏ OK
```
**–≠—Ñ—Ñ–µ–∫—Ç**:
- –°–¥–µ–ª–æ–∫: -15% (—É–º–µ—Ä–µ–Ω–Ω–æ)
- –î–∏–≤–µ—Ä—Å–∏—Ñ–∏–∫–∞—Ü–∏—è: –•–æ—Ä–æ—à–∞—è
- –†–∏—Å–∫ –ø—Ä–æ—Å–∞–¥–∫–∏: -40%
- –ë–∞–ª–∞–Ω—Å —Ä–∏—Å–∫/–ø—Ä–∏–±—ã–ª—å: –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π

#### –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç 3: –ú—è–≥–∫–∞—è –∫–æ—Ä—Ä–µ–ª—è—Ü–∏—è
```yaml
correlation_filter:
  correlation_threshold: 0.85         # –í—ã—Å–æ–∫–∏–π –ø–æ—Ä–æ–≥
  max_correlated_positions: 3         # –í—Å–µ 3 –º–æ–∂–Ω–æ
```
**–≠—Ñ—Ñ–µ–∫—Ç**:
- –°–¥–µ–ª–æ–∫: -5% (–ø–æ—á—Ç–∏ –Ω–µ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç)
- –î–∏–≤–µ—Ä—Å–∏—Ñ–∏–∫–∞—Ü–∏—è: –°–ª–∞–±–∞—è
- –†–∏—Å–∫ –ø—Ä–æ—Å–∞–¥–∫–∏: -15%
- –ë–æ–ª—å—à–µ –ø—Ä–∏–±—ã–ª–∏ –≤ —Ç—Ä–µ–Ω–¥–∞—Ö: +20%

### üß™ –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –∫–æ—Ä—Ä–µ–ª—è—Ü–∏—è (–ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ):
```yaml
correlation_filter:
  adaptive_threshold: true            # –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –ø–æ—Ä–æ–≥
  
  # –í HIGH VOL - –∫–æ—Ä—Ä–µ–ª—è—Ü–∏—è –ø–∞–¥–∞–µ—Ç (–∞–∫—Ç–∏–≤—ã —Ç–æ—Ä–≥—É—é—Ç—Å—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ)
  high_vol_threshold: 0.6             # –ú–µ–Ω–µ–µ —Å—Ç—Ä–æ–≥–æ
  
  # –í LOW VOL - –∫–æ—Ä—Ä–µ–ª—è—Ü–∏—è —Ä–∞—Å—Ç–µ—Ç (–∞–∫—Ç–∏–≤—ã –¥–≤–∏–≥–∞—é—Ç—Å—è –≤–º–µ—Å—Ç–µ)
  low_vol_threshold: 0.85             # –ë–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–æ
  
  # –í TRENDING - –∫–æ—Ä—Ä–µ–ª—è—Ü–∏—è –≤—ã—Å–æ–∫–∞—è (–≤—Å–µ —Å–ª–µ–¥—É—é—Ç –∑–∞ —Ç—Ä–µ–Ω–¥–æ–º)
  trending_threshold: 0.8
```

**–í–ª–∏—è–Ω–∏–µ –Ω–∞ —Ç–æ—Ä–≥–æ–≤–ª—é**:
- ‚úÖ **-40-50% —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ —Ä–∏—Å–∫–∞** (3 LONG –Ω–µ –ø–∞–¥—É—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ)
- ‚úÖ **+10-15% Sharpe Ratio**
- ‚ö†Ô∏è **-15-20% —Å–¥–µ–ª–æ–∫** (–∏–Ω–æ–≥–¥–∞ –±–ª–æ–∫–∏—Ä—É–µ–º —Ö–æ—Ä–æ—à–∏–µ —Å–∏–≥–Ω–∞–ª—ã)
- üéØ **–°—Ç–∞–±–∏–ª—å–Ω–µ–µ PnL** (–Ω–µ—Ç "—á–µ—Ä–Ω—ã—Ö –ª–µ–±–µ–¥–µ–π")

---

## 3Ô∏è‚É£ TIME-BASED FILTERS

### üìÅ –§–∞–π–ª: `src/filters/time_session_manager.py`

### üéØ –¶–µ–ª—å –º–æ–¥—É–ª—è:
–¢–æ—Ä–≥–æ–≤–∞—Ç—å –¢–û–õ–¨–ö–û –≤ –ø—Ä–∏–±—ã–ª—å–Ω—ã–µ —á–∞—Å—ã, –∏–∑–±–µ–≥–∞—Ç—å —É–±—ã—Ç–æ—á–Ω—ã—Ö.

### üîß –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã:

**–§–∞–∑–∞ 1: –°–±–æ—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏** (–ø–µ—Ä–≤—ã–µ 30 –¥–Ω–µ–π)
```python
# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–¥–µ–ª–æ–∫

CREATE TABLE trade_history (
    id INTEGER PRIMARY KEY,
    symbol TEXT,
    hour_utc INTEGER,              -- –ß–∞—Å –æ—Ç–∫—Ä—ã—Ç–∏—è (0-23)
    direction TEXT,                -- LONG/SHORT
    entry_price REAL,
    exit_price REAL,
    pnl REAL,
    win BOOLEAN,
    timestamp DATETIME
)

# –ö–∞–∂–¥–∞—è —Å–¥–µ–ª–∫–∞ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è —Å –ø—Ä–∏–≤—è–∑–∫–æ–π –∫ —á–∞—Å—É
```

**–§–∞–∑–∞ 2: –ê–Ω–∞–ª–∏–∑** (–∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 00:00 UTC)
```python
# SQL –∑–∞–ø—Ä–æ—Å

SELECT 
    hour_utc,
    COUNT(*) as total_trades,
    SUM(CASE WHEN win = 1 THEN 1 ELSE 0 END) as winning_trades,
    AVG(pnl) as avg_pnl,
    (SUM(CASE WHEN win = 1 THEN 1 ELSE 0 END) * 100.0 / COUNT(*)) as win_rate
FROM trade_history
WHERE timestamp > datetime('now', '-30 days')
GROUP BY hour_utc
ORDER BY hour_utc

# –†–µ–∑—É–ª—å—Ç–∞—Ç (–ø—Ä–∏–º–µ—Ä):

Hour | Trades | Win Rate | Avg PnL | Status
-----|--------|----------|---------|--------
0    | 45     | 42%      | -0.15%  | WEAK
1    | 38     | 35%      | -0.42%  | BLACKLIST ‚ùå
2    | 32     | 31%      | -0.68%  | BLACKLIST ‚ùå
3    | 28     | 38%      | -0.28%  | WEAK
4    | 35     | 44%      | -0.05%  | NEUTRAL
5    | 42     | 51%      | +0.12%  | NEUTRAL
6    | 50     | 56%      | +0.28%  | OK
7    | 78     | 68%      | +0.95%  | WHITELIST ‚úÖ
8    | 95     | 72%      | +1.42%  | WHITELIST ‚úÖ
9    | 88     | 66%      | +0.88%  | WHITELIST ‚úÖ
...
13   | 102    | 71%      | +1.28%  | WHITELIST ‚úÖ
14   | 108    | 74%      | +1.65%  | WHITELIST ‚úÖ (best!)
15   | 98     | 69%      | +1.12%  | WHITELIST ‚úÖ
...
```

**–§–∞–∑–∞ 3: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ**
```python
# –ö–∞–∂–¥—ã–π tick –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â–∏–π —á–∞—Å

current_hour = datetime.utcnow().hour  # –ù–∞–ø—Ä–∏–º–µ—Ä: 2 (02:00 UTC)

# –°–º–æ—Ç—Ä–∏–º —Å—Ç–∞—Ç—É—Å
hour_stats = time_filter.get_hour_stats(current_hour)

if hour_stats.status == "BLACKLIST":
    logger.warning(
        f"‚è∞ Hour {current_hour} BLACKLISTED: "
        f"Win Rate {hour_stats.win_rate}% (< 35%), "
        f"Avg PnL {hour_stats.avg_pnl}%"
    )
    return None  # –ù–ï —Ç–æ—Ä–≥—É–µ–º!
    
elif hour_stats.status == "WHITELIST":
    logger.info(
        f"üü¢ Hour {current_hour} WHITELISTED: "
        f"Win Rate {hour_stats.win_rate}% (> 65%)"
    )
    # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏
    position_size *= 1.2  # +20%
    
    # –ò–õ–ò –ø–æ–Ω–∏–∂–∞–µ–º scoring threshold
    self.min_score_threshold -= 1  # 6/12 –≤–º–µ—Å—Ç–æ 7/12
```

### üìä –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

```yaml
time_based_filter:
  # –û—Å–Ω–æ–≤–Ω—ã–µ
  enabled: true
  learning_period_days: 30            # ‚Üê –ú–æ–∂–Ω–æ 7, 14, 30, 60, 90
  
  # Blacklist (–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞)
  blacklist_hours_enabled: true       # ‚Üê –ú–æ–∂–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å
  blacklist_winrate_threshold: 35     # ‚Üê –ú–æ–∂–Ω–æ 30-45
  blacklist_min_trades: 10            # ‚Üê –ú–∏–Ω–∏–º—É–º —Å–¥–µ–ª–æ–∫ –¥–ª—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
  
  # Whitelist (—É—Å–∏–ª–µ–Ω–∏–µ)
  whitelist_hours_enabled: true       # ‚Üê –ú–æ–∂–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å
  whitelist_winrate_threshold: 65     # ‚Üê –ú–æ–∂–Ω–æ 60-75
  whitelist_size_multiplier: 1.2      # ‚Üê –ú–æ–∂–Ω–æ 1.1-1.5
  whitelist_threshold_reduction: 1    # ‚Üê –°–Ω–∏–∂–∞–µ–º –ø–æ—Ä–æ–≥ –Ω–∞ 1 –±–∞–ª–ª
  
  # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ
  update_frequency: "daily"           # ‚Üê –ú–æ–∂–Ω–æ "hourly", "weekly"
  rolling_window: true                # ‚Üê –°–∫–æ–ª—å–∑—è—â–µ–µ –æ–∫–Ω–æ
  
  # Per-symbol –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
  per_symbol_stats: true              # ‚Üê –û—Ç–¥–µ–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–ª—è –∫–∞–∂–¥–æ–π –ø–∞—Ä—ã
```

**–ü–æ—á–µ–º—É –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤–∞–∂–Ω—ã**:

```
learning_period_days: 7
  ‚Üí –ë—ã—Å—Ç—Ä–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è (–Ω–µ–¥–µ–ª—è)
  ‚Üí –ù–û: –ú–∞–ª–æ –¥–∞–Ω–Ω—ã—Ö, –º–æ–∂–µ—Ç –±—ã—Ç—å —à—É–º
  ‚Üí –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è: –ë—ã—Å—Ç—Ä–æ –º–µ–Ω—è—é—â–µ–≥–æ—Å—è —Ä—ã–Ω–∫–∞

learning_period_days: 90
  ‚Üí –ú–µ–¥–ª–µ–Ω–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è (3 –º–µ—Å—è—Ü–∞)
  ‚Üí –ú–Ω–æ–≥–æ –¥–∞–Ω–Ω—ã—Ö, —Å—Ç–∞–±–∏–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
  ‚Üí –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è: –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–π —Ç–æ—Ä–≥–æ–≤–ª–∏

---

blacklist_winrate_threshold: 30
  ‚Üí –ë–ª–æ–∫–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –û–ß–ï–ù–¨ –ø–ª–æ—Ö–∏–µ —á–∞—Å—ã
  ‚Üí –ë–æ–ª—å—à–µ —Å–¥–µ–ª–æ–∫
  ‚Üí –†–∏—Å–∫ —Ç–æ—Ä–≥–æ–≤–ª–∏ –≤ —Å–ª–∞–±—ã–µ —á–∞—Å—ã

blacklist_winrate_threshold: 45
  ‚Üí –ë–ª–æ–∫–∏—Ä—É–µ–º –≤—Å—ë –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–µ
  ‚Üí –ú–µ–Ω—å—à–µ —Å–¥–µ–ª–æ–∫
  ‚Üí –¢–æ—Ä–≥—É–µ–º —Ç–æ–ª—å–∫–æ –≤ –ª—É—á—à–µ–µ –≤—Ä–µ–º—è
```

### üéØ Per-Symbol —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:

```yaml
# –í–∫–ª—é—á–∞–µ–º —Ä–∞–∑–¥–µ–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
time_based_filter:
  per_symbol_stats: true

# –†–µ–∑—É–ª—å—Ç–∞—Ç:

BTC-USDT —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
  Hour 14: Win Rate 76% ‚Üê –•–æ—Ä–æ—à–æ
  Hour 02: Win Rate 28% ‚Üê –ü–ª–æ—Ö–æ

SOL-USDT —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
  Hour 14: Win Rate 68% ‚Üê –•–æ—Ä–æ—à–æ (–Ω–æ –º–µ–Ω—å—à–µ —á–µ–º BTC!)
  Hour 02: Win Rate 45% ‚Üê OK (–ª—É—á—à–µ —á–µ–º BTC!)

–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:
  - –í 14:00: –¢–æ—Ä–≥—É–µ–º BTC –∏ SOL (–æ–±–∞ OK)
  - –í 02:00: –ë–ª–æ–∫–∏—Ä—É–µ–º BTC, —Ä–∞–∑—Ä–µ—à–∞–µ–º SOL
```

**–í–ª–∏—è–Ω–∏–µ –Ω–∞ —Ç–æ—Ä–≥–æ–≤–ª—é**:
- ‚úÖ **+10-15% –æ–±—â–∏–π Win Rate**
- ‚úÖ **+25-30% –ø—Ä–∏–±—ã–ª—å –≤ whitelist —á–∞—Å—ã**
- ‚ö†Ô∏è **-15% —Å–¥–µ–ª–æ–∫** (–±–ª–æ–∫–∏—Ä—É–µ–º 2-4 —á–∞—Å–∞)
- üéØ **–°—Ç–∞–±–∏–ª—å–Ω–µ–µ equity curve**

---

## 4Ô∏è‚É£ VOLATILITY MODES (–î–µ—Ç–∞–ª—å–Ω–æ)

### üìÅ –§–∞–π–ª: `src/filters/regime_detector.py`

### üéØ –¶–µ–ª—å –º–æ–¥—É–ª—è:
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –¥–µ—Ç–µ–∫—Ü–∏—é —Ä–µ–∂–∏–º–æ–≤ –∏ –ü–†–ò–ú–ï–ù–Ø–¢–¨ —Ä–∞–∑–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã.

### üîß –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –¥–µ—Ç–µ–∫—Ü–∏—è —Ä–µ–∂–∏–º–æ–≤:

**–°–µ–π—á–∞—Å**: 3 —Ä–µ–∂–∏–º–∞ (HIGH_VOL, TRENDING, RANGING)  
**–ü–æ—Å–ª–µ**: 5 —Ä–µ–∂–∏–º–æ–≤ (–¥–µ—Ç–∞–ª—å–Ω–µ–µ)

```python
def _detect_enhanced_regime(self, symbol):
    """–£–ª—É—á—à–µ–Ω–Ω–∞—è –¥–µ—Ç–µ–∫—Ü–∏—è —Å 5 —Ä–µ–∂–∏–º–∞–º–∏"""
    
    # –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –º–µ—Ç—Ä–∏–∫–∏
    volatility = self._calculate_volatility(symbol, period=20)
    trend_strength = self._calculate_trend_strength(symbol)
    
    # –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è
    
    # 1. EXTREME VOLATILITY (>4%)
    if volatility > 0.04:
        return "EXTREME_VOL"
        # –ü—Ä–∏–º–µ—Ä: –ü–æ—Å–ª–µ –≤–∞–∂–Ω—ã—Ö –Ω–æ–≤–æ—Å—Ç–µ–π, –ª–∏–∫–≤–∏–¥–∞—Ü–∏–π
        # –î–µ–π—Å—Ç–≤–∏–µ: –ù–ï —Ç–æ—Ä–≥—É–µ–º –≤–æ–æ–±—â–µ! –°–ª–∏—à–∫–æ–º –æ–ø–∞—Å–Ω–æ
    
    # 2. HIGH VOLATILITY (2-4%)
    elif volatility > 0.02:
        return "HIGH_VOL"
        # –ü—Ä–∏–º–µ—Ä: –°–∏–ª—å–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ, –Ω–æ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–æ–µ
        # –î–µ–π—Å—Ç–≤–∏–µ: Scalping —Å —à–∏—Ä–æ–∫–∏–º–∏ SL/TP
    
    # 3. TRENDING (—Ç—Ä–µ–Ω–¥ >5%, –Ω–æ—Ä–º–∞–ª—å–Ω–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å)
    elif trend_strength > 0.05 and volatility < 0.02:
        return "TRENDING"
        # –ü—Ä–∏–º–µ—Ä: –ß–µ—Ç–∫–∏–π —Ç—Ä–µ–Ω–¥ –≤–≤–µ—Ä—Ö/–≤–Ω–∏–∑
        # –î–µ–π—Å—Ç–≤–∏–µ: –ù–æ—Ä–º–∞–ª—å–Ω—ã–π Scalping (—Ç–µ–∫—É—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã)
    
    # 4. LOW VOLATILITY (<1%)
    elif volatility < 0.01:
        return "LOW_VOL"
        # –ü—Ä–∏–º–µ—Ä: –ê–∑–∏–∞—Ç—Å–∫–∞—è —Å–µ—Å—Å–∏—è, –≤—ã—Ö–æ–¥–Ω—ã–µ
        # –î–µ–π—Å—Ç–≤–∏–µ: –£–º–µ–Ω—å—à–∞–µ–º TP/SL, —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä
    
    # 5. RANGING (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
    else:
        return "RANGING"
        # –ü—Ä–∏–º–µ—Ä: –ë–æ–∫–æ–≤–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ
        # –î–µ–π—Å—Ç–≤–∏–µ: Grid Trading (–≤ –±—É–¥—É—â–µ–º)
```

### üìä –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ–∂–∏–º–∞:

```yaml
volatility_modes:
  enabled: true
  
  # –ü–æ—Ä–æ–≥–∏ –¥–µ—Ç–µ–∫—Ü–∏–∏
  thresholds:
    extreme_vol: 0.04              # 4% –∏ –≤—ã—à–µ
    high_vol: 0.02                 # 2-4%
    low_vol: 0.01                  # –ú–µ–Ω–µ–µ 1%
    trending: 0.05                 # –¢—Ä–µ–Ω–¥ 5%+
  
  # –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–µ–∂–∏–º–æ–≤
  modes:
    # EXTREME_VOL: –ù–ï —Ç–æ—Ä–≥—É–µ–º!
    extreme_vol:
      trading_enabled: false        # –ë–ª–æ–∫–∏—Ä—É–µ–º —Ç–æ—Ä–≥–æ–≤–ª—é
      close_existing: false         # –û—Å—Ç–∞–≤–ª—è–µ–º –æ—Ç–∫—Ä—ã—Ç—ã–µ (–ø—É—Å—Ç—å —Ä–∞–±–æ—Ç–∞—é—Ç)
      reason: "Too dangerous"
    
    # HIGH_VOL: –û—Å—Ç–æ—Ä–æ–∂–Ω–∞—è —Ç–æ—Ä–≥–æ–≤–ª—è
    high_vol:
      tp_multiplier: 2.0            # –î–∞–ª—å—à–µ —Ü–µ–ª—å
      sl_multiplier: 3.5            # –®–∏—Ä–µ —Å—Ç–æ–ø
      position_size_modifier: 0.7   # –ú–µ–Ω—å—à–µ —Ä–∞–∑–º–µ—Ä (70%)
      max_trades_hour: 20           # –ë–æ–ª—å—à–µ –ø–æ–ø—ã—Ç–æ–∫
      scoring_threshold: 6          # –ù–∏–∂–µ –ø–æ—Ä–æ–≥ (–∞–≥—Ä–µ—Å—Å–∏–≤–Ω–µ–µ)
      partial_tp_levels: [1.0, 1.5, 2.5]  # –î—Ä—É–≥–∏–µ —É—Ä–æ–≤–Ω–∏
      
    # TRENDING: –ù–æ—Ä–º–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
    trending:
      tp_multiplier: 1.5            # –¢–µ–∫—É—â–∏–µ
      sl_multiplier: 2.5
      position_size_modifier: 1.0
      max_trades_hour: 15
      scoring_threshold: 7
      partial_tp_levels: [0.7, 1.2, 2.0]
      
    # LOW_VOL: –ë—ã—Å—Ç—Ä–∞—è —Ç–æ—Ä–≥–æ–≤–ª—è
    low_vol:
      tp_multiplier: 1.0            # –ë–ª–∏–∑–∫–æ
      sl_multiplier: 2.0            # –£–∑–∫–æ
      position_size_modifier: 1.2   # –ë–æ–ª—å—à–µ (120%)
      max_trades_hour: 10           # –†–µ–∂–µ (–Ω–µ—Ç –¥–≤–∏–∂–µ–Ω–∏—è)
      scoring_threshold: 8          # –°—Ç—Ä–æ–∂–µ
      partial_tp_levels: [0.5, 0.8, 1.2]  # –ë—ã—Å—Ç—Ä—ã–µ —Ñ–∏–∫—Å–∞—Ü–∏–∏
      
    # RANGING: –ü–æ–∫–∞ –Ω–µ —Ç–æ—Ä–≥—É–µ–º (–±—É–¥–µ—Ç Grid)
    ranging:
      trading_enabled: false        # Scalping –≤—ã–∫–ª—é—á–µ–Ω
      future_strategy: "grid"       # –ó–∞–º–µ—Ç–∫–∞ –¥–ª—è –±—É–¥—É—â–µ–≥–æ
```

**–ü—Ä–∏–º–µ—Ä –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è**:
```python
# –°–∏—Ç—É–∞—Ü–∏—è: SOL –≤–æ—à–µ–ª –≤ HIGH_VOL —Ä–µ–∂–∏–º

# –ë—ã–ª–æ (NORMAL):
Entry: $180.00
ATR: $0.50
TP: $180.00 + (1.5 √ó $0.50) = $180.75
SL: $180.00 - (2.5 √ó $0.50) = $178.75
Size: 1% –±–∞–ª–∞–Ω—Å–∞ = $10
Risk/Reward: 1.25 / 1.25 = 1:1

# –°—Ç–∞–ª–æ (HIGH_VOL):
Entry: $180.00
ATR: $1.20 (–≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å –≤—ã—Ä–æ—Å–ª–∞!)
TP: $180.00 + (2.0 √ó $1.20) = $182.40  ‚Üê –î–∞–ª—å—à–µ!
SL: $180.00 - (3.5 √ó $1.20) = $175.80  ‚Üê –®–∏—Ä–µ!
Size: 1% √ó 0.7 = $7                     ‚Üê –ú–µ–Ω—å—à–µ!
Risk/Reward: 2.40 / 4.20 = 1:1.75       ‚Üê –õ—É—á—à–µ R/R!

–õ–æ–≥–∏–∫–∞:
  ‚úÖ –í –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ –Ω—É–∂–Ω–æ –±–æ–ª—å—à–µ –≤–æ–∑–¥—É—Ö–∞ (–Ω–µ –≤—ã–±—å–µ—Ç)
  ‚úÖ –ú–æ–∂–Ω–æ –ø–æ–π–º–∞—Ç—å –±–æ–ª—å—à–µ–µ –¥–≤–∏–∂–µ–Ω–∏–µ (TP –¥–∞–ª—å—à–µ)
  ‚úÖ –ù–æ —Ä–∏—Å–∫—É–µ–º –º–µ–Ω—å—à–µ (—Ä–∞–∑–º–µ—Ä 70%)
```

**–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤** (—Å –≥–∏—Å—Ç–µ—Ä–µ–∑–∏—Å–æ–º):
```python
# –ó–∞—â–∏—Ç–∞ –æ—Ç "–¥–µ—Ä–≥–∞–Ω–∏–π"

current_regime = "TRENDING"
new_volatility = 0.022  # 2.2% > 2% ‚Üí HIGH_VOL

# –ù–û: –ù—É–∂–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ!
confirmations = check_last_5_minutes()
# –ú–∏–Ω—É—Ç–∞ 1: 2.1% ‚Üí HIGH_VOL
# –ú–∏–Ω—É—Ç–∞ 2: 2.3% ‚Üí HIGH_VOL
# –ú–∏–Ω—É—Ç–∞ 3: 1.9% ‚Üí TRENDING (!)
# –ú–∏–Ω—É—Ç–∞ 4: 2.2% ‚Üí HIGH_VOL
# –ú–∏–Ω—É—Ç–∞ 5: 2.4% ‚Üí HIGH_VOL

# –ò—Ç–æ–≥–æ: 4 –∏–∑ 5 = HIGH_VOL
if confirmations >= 4:
    switch_to("HIGH_VOL")
    logger.info("üîÑ Regime changed: TRENDING ‚Üí HIGH_VOL")
```

**–í–ª–∏—è–Ω–∏–µ –Ω–∞ —Ç–æ—Ä–≥–æ–≤–ª—é**:
- ‚úÖ **-25% SL —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π** (–∞–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Å—Ç–æ–ø—ã)
- ‚úÖ **+20-30% —Å—Ä–µ–¥–Ω—è—è –ø—Ä–∏–±—ã–ª—å** (–æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ TP)
- ‚úÖ **-15% —Ä–∏—Å–∫** –≤ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ (–º–µ–Ω—å—à–µ —Ä–∞–∑–º–µ—Ä)
- üéØ **+25-35% –æ–±—â–∞—è –ø—Ä–∏–±—ã–ª—å** (–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —É—Å–ª–æ–≤–∏–π)

---

## 5Ô∏è‚É£ PIVOT POINTS (–ü–æ–¥—Ä–æ–±–Ω–µ–µ)

### üìÅ –§–∞–π–ª: `src/indicators/advanced/pivot_calculator.py`

### üéØ –¢—Ä–∏ –º–µ—Ç–æ–¥–∞ —Ä–∞—Å—á–µ—Ç–∞:

#### –ú–µ—Ç–æ–¥ 1: STANDARD (–∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π)
```python
# –ò—Å–ø–æ–ª—å–∑—É–µ–º High, Low, Close –í–ß–ï–†–ê–®–ù–ï–ì–û –¥–Ω—è

yesterday = get_previous_day_candle()
H = yesterday.high
L = yesterday.low
C = yesterday.close

PP = (H + L + C) / 3

R1 = (2 √ó PP) - L
R2 = PP + (H - L)
R3 = H + 2 √ó (PP - L)

S1 = (2 √ó PP) - H
S2 = PP - (H - L)
S3 = L - 2 √ó (H - PP)
```

**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ**:
```yaml
pivot_points:
  calculation_method: "standard"
  use_levels: [S2, S1, PP, R1, R2]   # –ò—Å–ø–æ–ª—å–∑—É–µ–º 5 —É—Ä–æ–≤–Ω–µ–π
```

#### –ú–µ—Ç–æ–¥ 2: FIBONACCI (—Ç–æ—á–Ω–µ–µ –¥–ª—è –∫—Ä–∏–ø—Ç—ã)
```python
# –¢–µ –∂–µ –¥–∞–Ω–Ω—ã–µ, –Ω–æ –¥—Ä—É–≥–∏–µ –º–Ω–æ–∂–∏—Ç–µ–ª–∏

PP = (H + L + C) / 3

# –§–∏–±–æ–Ω–∞—á—á–∏ —É—Ä–æ–≤–Ω–∏
R1 = PP + 0.382 √ó (H - L)
R2 = PP + 0.618 √ó (H - L)
R3 = PP + 1.000 √ó (H - L)

S1 = PP - 0.382 √ó (H - L)
S2 = PP - 0.618 √ó (H - L)
S3 = PP - 1.000 √ó (H - L)
```

**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ**:
```yaml
pivot_points:
  calculation_method: "fibonacci"
  fibonacci_levels: [0.236, 0.382, 0.5, 0.618, 0.786, 1.0]  # –í—Å–µ —É—Ä–æ–≤–Ω–∏ –§–∏–±
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ**: –ë–æ–ª–µ–µ "–µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ" —É—Ä–æ–≤–Ω–∏ (–ø—Ä–∏—Ä–æ–¥–∞ –ª—é–±–∏—Ç –§–∏–±–æ–Ω–∞—á—á–∏)

#### –ú–µ—Ç–æ–¥ 3: CAMARILLA (–¥–ª—è —Å–∫–∞–ª—å–ø–∏–Ω–≥–∞!) ‚≠ê
```python
# 4 —É—Ä–æ–≤–Ω—è —Å –∫–∞–∂–¥–æ–π —Å—Ç–æ—Ä–æ–Ω—ã, –û–ß–ï–ù–¨ –±–ª–∏–∑–∫–æ –∫ —Ü–µ–Ω–µ

PP = C  # –ü—Ä–æ—Å—Ç–æ —Ü–µ–Ω–∞ –∑–∞–∫—Ä—ã—Ç–∏—è!

# –ö–æ—Ä–æ—Ç–∫–∏–µ –¥–∏—Å—Ç–∞–Ω—Ü–∏–∏ (–∏–¥–µ–∞–ª—å–Ω–æ –¥–ª—è 1m)
R1 = C + (H - L) √ó 1.1 / 12
R2 = C + (H - L) √ó 1.1 / 6
R3 = C + (H - L) √ó 1.1 / 4
R4 = C + (H - L) √ó 1.1 / 2

S1 = C - (H - L) √ó 1.1 / 12
S2 = C - (H - L) √ó 1.1 / 6
S3 = C - (H - L) √ó 1.1 / 4
S4 = C - (H - L) √ó 1.1 / 2
```

**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ**:
```yaml
pivot_points:
  calculation_method: "camarilla"
  use_levels: [S3, S2, S1, R1, R2, R3]  # –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–µ —É—Ä–æ–≤–Ω–∏
  camarilla_scalping_mode: true         # –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ**: **8 —É—Ä–æ–≤–Ω–µ–π** (–≤–º–µ—Å—Ç–æ 6), –æ—á–µ–Ω—å –±–ª–∏–∑–∫–æ –∫ —Ü–µ–Ω–µ = –∏–¥–µ–∞–ª—å–Ω–æ –¥–ª—è —Å–∫–∞–ª—å–ø–∏–Ω–≥–∞!

### üéØ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ —Ç–æ—Ä–≥–æ–≤–ª–µ:

#### –°—Ç—Ä–∞—Ç–µ–≥–∏—è 1: Entry –æ–∫–æ–ª–æ —É—Ä–æ–≤–Ω–µ–π
```python
# SOL –ø—Ä–∏–º–µ—Ä

Pivots (Standard):
  R2: $187.50
  R1: $185.00
  PP: $182.50
  S1: $180.00
  S2: $177.50

–¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞: $180.20 (–æ–∫–æ–ª–æ S1)

–õ–æ–≥–∏–∫–∞:
  - –¶–µ–Ω–∞ –∫–∞—Å–∞–µ—Ç—Å—è S1 (–ø–æ–¥–¥–µ—Ä–∂–∫–∞)
  - LONG scoring: 7/12
  - Pivot bonus: +2
  - –ò—Ç–æ–≥–æ: 9/12 ‚Üí –í—Ö–æ–¥–∏–º LONG!
  - TP: –û–∫–æ–ª–æ PP ($182.50) –∏–ª–∏ R1 ($185.00)
  - SL: –ù–∏–∂–µ S2 ($177.00)
```

#### –°—Ç—Ä–∞—Ç–µ–≥–∏—è 2: TP –Ω–∞ —É—Ä–æ–≤–Ω—è—Ö
```python
# LONG –ø–æ–∑–∏—Ü–∏—è

Entry: $180.50
–ë–∞–∑–æ–≤—ã–π TP (1.5 ATR): $182.80

Pivots:
  R1: $185.00

–ü—Ä–æ–≤–µ—Ä–∫–∞:
  - $182.80 –¥–∞–ª–µ–∫–æ –æ—Ç R1
  - –û—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å
  
# –ò–õ–ò - –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ:

Entry: $184.00
–ë–∞–∑–æ–≤—ã–π TP: $186.00
R1: $185.00 ‚Üê –ë–õ–ò–ó–ö–û!

–ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞:
  - R1 –º–æ–∂–µ—Ç –æ—Ç–±–∏—Ç—å —Ü–µ–Ω—É
  - –°—Ç–∞–≤–∏–º TP: $184.80 (–ü–ï–†–ï–î R1)
  - –õ–æ–≥–∏–∫–∞: –õ—É—á—à–µ –≤–∑—è—Ç—å –º–µ–Ω—å—à–µ, –Ω–æ —Ç–æ—á–Ω–æ
```

#### –°—Ç—Ä–∞—Ç–µ–≥–∏—è 3: SL –∑–∞ —É—Ä–æ–≤–Ω—è–º–∏
```python
# SHORT –ø–æ–∑–∏—Ü–∏—è

Entry: $185.50
–ë–∞–∑–æ–≤—ã–π SL: $187.00

Pivots:
  R1: $185.00
  R2: $187.50

–ü—Ä–æ–≤–µ—Ä–∫–∞:
  - SL $187.00 –º–µ–∂–¥—É R1 –∏ R2
  - –ú–æ–∂–µ—Ç –∑–∞–¥–µ—Ç—å –ø—Ä–∏ —Ç–µ—Å—Ç–µ R2
  - –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º SL: $187.70 (–ó–ê R2)
  - –õ–æ–≥–∏–∫–∞: –î–∞–µ–º –∑–∞–ø–∞—Å –Ω–∞ –ø—Ä–æ–±–æ–π, –ø–æ—Ç–æ–º SL
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≤–ª–∏—è—é—Ç –Ω–∞ —Å—Ç–∏–ª—å**:
```yaml
# –ê–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π (–±–æ–ª—å—à–µ –ø—Ä–∏–±—ã–ª–∏, –±–æ–ª—å—à–µ —Ä–∏—Å–∫)
pivot_points:
  adjust_tp_to_resistance: false      # –ù–ï –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º TP (—Ö–æ—Ç–∏–º –¥–æ—Ç—è–Ω—É—Ç—å)
  adjust_sl_beyond_support: false     # –£–∑–∫–∏–µ SL (–∫–∞–∫ –±–∞–∑–æ–≤—ã–µ)
  pivot_margin_percent: 0.1           # –ú–∞–ª–µ–Ω—å–∫–∏–π –æ—Ç—Å—Ç—É–ø

# –ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π (–º–µ–Ω—å—à–µ –ø—Ä–∏–±—ã–ª–∏, –º–µ–Ω—å—à–µ —Ä–∏—Å–∫)
pivot_points:
  adjust_tp_to_resistance: true       # –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º TP (—Ñ–∏–∫—Å–∏—Ä—É–µ–º —Ä–∞–Ω—å—à–µ)
  adjust_sl_beyond_support: true      # SL –∑–∞ —É—Ä–æ–≤–Ω—è–º–∏ (–±–æ–ª—å—à–µ –≤–æ–∑–¥—É—Ö–∞)
  pivot_margin_percent: 0.3           # –ë–æ–ª—å—à–æ–π –æ—Ç—Å—Ç—É–ø (–∑–∞–ø–∞—Å)
```

**–í–ª–∏—è–Ω–∏–µ –Ω–∞ —Ç–æ—Ä–≥–æ–≤–ª—é**:
- ‚úÖ **+10-12% —Ç–æ—á–Ω–æ—Å—Ç—å –≤—Ö–æ–¥–æ–≤**
- ‚úÖ **-15% –ø—Ä–æ–±–∏—Ç—ã—Ö TP** (—Ñ–∏–∫—Å–∏—Ä—É–µ–º –ø–µ—Ä–µ–¥ —É—Ä–æ–≤–Ω—è–º–∏)
- ‚úÖ **-10% –ª–æ–∂–Ω—ã—Ö SL** (—Å—Ç–æ–ø—ã –∑–∞ —É—Ä–æ–≤–Ω—è–º–∏)
- üéØ **+8-12% –æ–±—â–∞—è –ø—Ä–∏–±—ã–ª—å**

---

## 6Ô∏è‚É£ VOLUME PROFILE (–ì–ª—É–±–æ–∫–æ)

### üìÅ –§–∞–π–ª: `src/indicators/advanced/volume_profile.py`

### üîß –†–∞—Å—á–µ—Ç (–¥–µ—Ç–∞–ª—å–Ω–æ):

**–®–∞–≥ 1**: –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ
```python
# –ó–∞ 24 —á–∞—Å–∞ = 1440 –º–∏–Ω—É—Ç–Ω—ã—Ö —Å–≤–µ—á–µ–π

candles = client.get_candles(symbol, timeframe="1m", limit=1440)

# –ö–∞–∂–¥–∞—è —Å–≤–µ—á–∞:
candle = {
    'open': 180.00,
    'high': 180.50,
    'low': 179.80,
    'close': 180.20,
    'volume': 15000  # ‚Üê –í–∞–∂–Ω–æ!
}
```

**–®–∞–≥ 2**: –°–æ–∑–¥–∞–µ–º Profile
```python
# –î–µ–ª–∏–º —Ü–µ–Ω–æ–≤–æ–π –¥–∏–∞–ø–∞–∑–æ–Ω –Ω–∞ bins (—É—Ä–æ–≤–Ω–∏)

price_min = min([c.low for c in candles])    # $179.00
price_max = max([c.high for c in candles])   # $186.00
range_size = price_max - price_min           # $7.00

num_bins = 50
bin_size = range_size / num_bins             # $0.14 –∑–∞ bin

# –°–æ–∑–¥–∞–µ–º bins
volume_bins = [0] * 50  # –ú–∞—Å—Å–∏–≤ –¥–ª—è –æ–±—ä–µ–º–æ–≤

# –ó–∞–ø–æ–ª–Ω—è–µ–º
for candle in candles:
    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –≤ –∫–∞–∫–æ–π bin –ø–æ–ø–∞–¥–∞–µ—Ç —Ü–µ–Ω–∞ –∑–∞–∫—Ä—ã—Ç–∏—è
    bin_index = int((candle.close - price_min) / bin_size)
    
    # –î–æ–±–∞–≤–ª—è–µ–º –æ–±—ä–µ–º —ç—Ç–æ–π —Å–≤–µ—á–∏ –∫ bin
    volume_bins[bin_index] += candle.volume

# –†–µ–∑—É–ª—å—Ç–∞—Ç:
# volume_bins[0] (179.00-179.14): 25000 –æ–±—ä–µ–º
# volume_bins[1] (179.14-179.28): 18000 –æ–±—ä–µ–º
# ...
# volume_bins[35] (183.90-184.04): 185000 –æ–±—ä–µ–º ‚Üê –ú–ê–ö–°–ò–ú–£–ú!
# ...
# volume_bins[49] (185.86-186.00): 12000 –æ–±—ä–µ–º
```

**–®–∞–≥ 3**: –ù–∞—Ö–æ–¥–∏–º –∫–ª—é—á–µ–≤—ã–µ –∑–æ–Ω—ã
```python
# VPOC (Volume Point of Control)
vpoc_bin = volume_bins.index(max(volume_bins))  # bin 35
vpoc_price = price_min + (vpoc_bin * bin_size)  # $183.90

# Value Area (70% –æ–±—ä–µ–º–∞)
total_volume = sum(volume_bins)
target_volume = total_volume * 0.70  # 70%

# –°–æ—Ä—Ç–∏—Ä—É–µ–º bins –ø–æ –æ–±—ä–µ–º—É
sorted_bins = sorted(enumerate(volume_bins), key=lambda x: x[1], reverse=True)

# –ë–µ—Ä–µ–º bins –ø–æ–∫–∞ –Ω–µ –Ω–∞–±–µ—Ä–µ–º 70%
value_area_bins = []
accumulated_volume = 0

for bin_idx, volume in sorted_bins:
    value_area_bins.append(bin_idx)
    accumulated_volume += volume
    if accumulated_volume >= target_volume:
        break

# –ì—Ä–∞–Ω–∏—Ü—ã Value Area
va_low = price_min + (min(value_area_bins) * bin_size)   # $182.00
va_high = price_min + (max(value_area_bins) * bin_size)  # $185.50

# –†–µ–∑—É–ª—å—Ç–∞—Ç:
# VPOC: $183.90 (—É—Ä–æ–≤–µ–Ω—å —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º –æ–±—ä–µ–º–æ–º)
# Value Area: $182.00 - $185.50 (–∑–æ–Ω–∞ 70% –æ–±—ä–µ–º–∞)
# High Volume Area (HVA): –æ–∫–æ–ª–æ VPOC
# Low Volume Area (LVA): –≤–Ω–µ Value Area
```

### üìä –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:

#### –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ 1: Entry –æ–∫–æ–ª–æ VPOC
```python
# –¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞: $183.85
# VPOC: $183.90
# –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ: 0.03%

LONG —Å–∏–≥–Ω–∞–ª:
  Base score: 7/12
  Price near VPOC (0.03% < 0.5%) ‚úÖ
  VPOC bonus: +2
  Total: 9/12 ‚Üí –û—Ç–∫—Ä—ã–≤–∞–µ–º!

–õ–æ–≥–∏–∫–∞:
  - VPOC = –º–∞–≥–Ω–∏—Ç –¥–ª—è —Ü–µ–Ω—ã
  - –ú–Ω–æ–≥–æ –æ–±—ä–µ–º–∞ = —Å–∏–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å
  - –í—ã—Å–æ–∫–∞—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –æ—Ç—Å–∫–æ–∫–∞
```

#### –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ 2: –ò–∑–±–µ–≥–∞–µ–º LVA –¥–ª—è –≤—Ö–æ–¥–∞
```python
# –¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞: $186.50
# Value Area: $182-$185.50
# –¶–µ–Ω–∞ –í–´–®–ï VA ‚Üí Low Volume Area

SHORT —Å–∏–≥–Ω–∞–ª:
  Base score: 8/12 (—Ö–æ—Ä–æ—à–∏–π!)
  
  –ü—Ä–æ–≤–µ—Ä–∫–∞ LVA:
    - –¶–µ–Ω–∞ –≤ LVA ‚ùå
    - –ú–∞–ª–æ –æ–±—ä–µ–º–∞ = —Å–ª–∞–±—ã–π —É—Ä–æ–≤–µ–Ω—å
    - –ú–æ–∂–µ—Ç –±—ã—Å—Ç—Ä–æ "–ø—Ä–æ–ª–µ—Ç–µ—Ç—å" –±–µ–∑ —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏—è
  
  –î–µ–π—Å—Ç–≤–∏—è:
    –í–∞—Ä–∏–∞–Ω—Ç A: –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–∏–≥–Ω–∞–ª (–∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–æ)
    –í–∞—Ä–∏–∞–Ω—Ç B: –£–º–µ–Ω—å—à–∞–µ–º —Ä–∞–∑–º–µ—Ä –Ω–∞ 50% (—É–º–µ—Ä–µ–Ω–Ω–æ)
    –í–∞—Ä–∏–∞–Ω—Ç C: –°—Ç–∞–≤–∏–º TP –±–ª–∏–∂–µ, SL —à–∏—Ä–µ (–∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ)
```

#### –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ 3: TP –ø–µ—Ä–µ–¥ HVA
```python
# LONG –≤—Ö–æ–¥: $181.00
# –ë–∞–∑–æ–≤—ã–π TP: $182.50

# Volume Profile:
# $182.00-$184.00: HIGH VOLUME AREA (HVA)
# –ú–Ω–æ–≥–æ –æ–±—ä–µ–º–∞ –∑–¥–µ—Å—å = –º–Ω–æ–≥–æ –æ—Ä–¥–µ—Ä–æ–≤

# –ü—Ä–æ–≤–µ—Ä–∫–∞:
if tp_in_hva($182.50):
    # –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º TP –ø–µ—Ä–µ–¥ HVA
    adjusted_tp = $181.80  # –ü–µ—Ä–µ–¥ HVA
    logger.info("TP adjusted: HVA detected at $182-184")

# –õ–æ–≥–∏–∫–∞:
# –í HVA —Ü–µ–Ω–∞ –º–æ–∂–µ—Ç "–∑–∞—Å—Ç—Ä—è—Ç—å"
# –ú–Ω–æ–≥–æ –ø—Ä–æ–¥–∞–≤—Ü–æ–≤ –Ω–∞ —ç—Ç–∏—Ö —É—Ä–æ–≤–Ω—è—Ö
# –õ—É—á—à–µ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å—Å—è —á—É—Ç—å —Ä–∞–Ω—å—à–µ
```

### üéõÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:

```yaml
# –î–ª—è —Ä–∞–∑–Ω—ã—Ö —Å—Ç–∏–ª–µ–π —Ç–æ—Ä–≥–æ–≤–ª–∏:

# –°–∫–∞–ª—å–ø–∏–Ω–≥ (–±—ã—Å—Ç—Ä—ã–π)
volume_profile:
  lookback_period: 12               # 12 —á–∞—Å–æ–≤ (—Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ)
  price_bins: 100                   # –í—ã—Å–æ–∫–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ
  vpoc_proximity_threshold: 0.3     # –¢–æ—á–Ω–æ–µ –∫–∞—Å–∞–Ω–∏–µ
  hva_avoid: true                   # –°—Ç—Ä–æ–≥–æ –∏–∑–±–µ–≥–∞–µ–º HVA

# Swing (–º–µ–¥–ª–µ–Ω–Ω—ã–π)
volume_profile:
  lookback_period: 168              # 7 –¥–Ω–µ–π
  price_bins: 30                    # –ù–∏–∑–∫–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ
  vpoc_proximity_threshold: 1.0     # –®–∏—Ä–æ–∫–∞—è –∑–æ–Ω–∞
  hva_avoid: false                  # –ù–µ –∏–∑–±–µ–≥–∞–µ–º

# –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π
volume_profile:
  adaptive_period: true             # –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–∏–æ–¥
  high_vol_period: 6                # –í HIGH VOL - 6 —á–∞—Å–æ–≤
  normal_vol_period: 24             # –í NORMAL - 24 —á–∞—Å–∞
  low_vol_period: 48                # –í LOW VOL - 48 —á–∞—Å–æ–≤
```

**–í–ª–∏—è–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤**:

```
lookback_period: 12 —á–∞—Å–æ–≤
  ‚Üí –°–≤–µ–∂–∏–π –ø—Ä–æ—Ñ–∏–ª—å (–∞–∫—Ç—É–∞–ª—å–Ω—ã–π)
  ‚Üí –ë—ã—Å—Ç—Ä–æ –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è
  ‚Üí –ù–û: –ú–æ–∂–µ—Ç –±—ã—Ç—å —à—É–º

lookback_period: 48 —á–∞—Å–æ–≤
  ‚Üí –°—Ç–∞–±–∏–ª—å–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å
  ‚Üí –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ —É—Ä–æ–≤–Ω–∏
  ‚Üí –ù–û: –ú–æ–∂–µ—Ç —É—Å—Ç–∞—Ä–µ—Ç—å

---

price_bins: 20
  ‚Üí –ù–∏–∑–∫–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ
  ‚Üí –ë—ã—Å—Ç—Ä—ã–π —Ä–∞—Å—á–µ—Ç
  ‚Üí –ù–û: –ú–µ–Ω–µ–µ —Ç–æ—á–Ω–æ

price_bins: 100
  ‚Üí –í—ã—Å–æ–∫–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ  
  ‚Üí –¢–æ—á–Ω—ã–µ —É—Ä–æ–≤–Ω–∏
  ‚Üí –ù–û: –ú–µ–¥–ª–µ–Ω–Ω–µ–µ —Ä–∞—Å—á–µ—Ç, –º–æ–∂–µ—Ç –±—ã—Ç—å —à—É–º
```

**–í–ª–∏—è–Ω–∏–µ –Ω–∞ —Ç–æ—Ä–≥–æ–≤–ª—é**:
- ‚úÖ **+15-20% —Ç–æ—á–Ω–æ—Å—Ç—å –≤—Ö–æ–¥–æ–≤**
- ‚úÖ **+10-12% Win Rate**
- ‚úÖ **-10-15% –∑–∞—Å—Ç—Ä–µ–≤–∞–Ω–∏–π –≤ –ø–æ–∑–∏—Ü–∏–∏**
- üéØ **+12-18% –æ–±—â–∞—è –ø—Ä–∏–±—ã–ª—å**

---

# üöÄ PHASE 2: –ü–†–û–î–í–ò–ù–£–¢–´–ï –ú–û–î–£–õ–ò

---

## 7Ô∏è‚É£ MARKET MICROSTRUCTURE (Order Book)

### üìÅ –§–∞–π–ª: `src/strategies/modules/market_microstructure.py`

### üéØ –¶–µ–ª—å:
–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å **–æ—Ä–¥–µ—Ä –±—É–∫** (–∫–Ω–∏–≥–∞ –∑–∞—è–≤–æ–∫) –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –∫—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω–æ–≥–æ –¥–≤–∏–∂–µ–Ω–∏—è (—Å–µ–∫—É–Ω–¥—ã-–º–∏–Ω—É—Ç—ã).

### üîß –ß—Ç–æ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º:

#### –ú–µ—Ç—Ä–∏–∫–∞ 1: BID/ASK IMBALANCE (–î–∏—Å–±–∞–ª–∞–Ω—Å)
```python
# –û—Ä–¥–µ—Ä –±—É–∫ –ø—Ä–∏–º–µ—Ä:

ASKS (–ø—Ä–æ–¥–∞–≤—Ü—ã):
Price    | Size (SOL)
---------|------------
$181.50  | 100 SOL
$181.40  | 250 SOL
$181.30  | 180 SOL
$181.20  | 150 SOL
$181.10  | 120 SOL
         | TOTAL ASK: 800 SOL

BIDS (–ø–æ–∫—É–ø–∞—Ç–µ–ª–∏):
Price    | Size (SOL)
---------|------------
$181.00  | 300 SOL  
$180.90  | 450 SOL
$180.80  | 350 SOL
$180.70  | 280 SOL
$180.60  | 220 SOL
         | TOTAL BID: 1600 SOL ‚Üê –í 2 –†–ê–ó–ê –ë–û–õ–¨–®–ï!

# –†–∞—Å—á–µ—Ç Imbalance
imbalance = (BID_volume - ASK_volume) / (BID_volume + ASK_volume)
imbalance = (1600 - 800) / (1600 + 800) = 0.33  (33% –≤ –ø–æ–ª—å–∑—É BID)

# –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è:
imbalance > 0.2 ‚Üí –°–∏–ª—å–Ω–æ–µ –¥–∞–≤–ª–µ–Ω–∏–µ –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π ‚Üí LONG –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–æ
imbalance < -0.2 ‚Üí –°–∏–ª—å–Ω–æ–µ –¥–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–¥–∞–≤—Ü–æ–≤ ‚Üí SHORT –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–æ
```

#### –ú–µ—Ç—Ä–∏–∫–∞ 2: SPREAD (–°–ø—Ä–µ–¥)
```python
# Best Bid: $181.00
# Best Ask: $181.10

spread_absolute = $181.10 - $181.00 = $0.10
spread_percent = ($0.10 / $181.05) √ó 100 = 0.055%

# –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è:
spread < 0.05% ‚Üí –û—Ç–ª–∏—á–Ω–∞—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å, –º–æ–∂–Ω–æ —Ç–æ—Ä–≥–æ–≤–∞—Ç—å
spread 0.05-0.1% ‚Üí –ù–æ—Ä–º–∞–ª—å–Ω–æ
spread > 0.1% ‚Üí –ü–ª–æ—Ö–∞—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å, –∏–∑–±–µ–≥–∞—Ç—å
```

#### –ú–µ—Ç—Ä–∏–∫–∞ 3: ORDER BOOK DEPTH (–ì–ª—É–±–∏–Ω–∞)
```python
# –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —Ç–æ–ø 10 —É—Ä–æ–≤–Ω–µ–π —Å –∫–∞–∂–¥–æ–π —Å—Ç–æ—Ä–æ–Ω—ã

top_10_bids = sum([bid.size for bid in top_10])  # 2500 SOL
top_10_asks = sum([ask.size for ask in top_10])  # 1800 SOL

depth_ratio = top_10_bids / top_10_asks = 1.39

# –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è:
depth_ratio > 1.3 ‚Üí –ì–ª—É–±–æ–∫–∏–π bid side ‚Üí LONG +1 –±–∞–ª–ª
depth_ratio < 0.7 ‚Üí –ì–ª—É–±–æ–∫–∏–π ask side ‚Üí SHORT +1 –±–∞–ª–ª
```

### üìä –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:

```yaml
market_microstructure:
  enabled: true
  
  # Order Book –∞–Ω–∞–ª–∏–∑
  depth_levels: 10                  # –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —Ç–æ–ø 10 —É—Ä–æ–≤–Ω–µ–π
  update_frequency: 5               # –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
  
  # Imbalance
  imbalance_threshold: 0.2          # –ü–æ—Ä–æ–≥ –¥–ª—è —Å–∏–≥–Ω–∞–ª–∞ (20%)
  imbalance_score_bonus: 1          # +1 –±–∞–ª–ª –ø—Ä–∏ –∏–º–±–∞–ª–∞–Ω—Å–µ
  
  # Spread
  max_spread_percent: 0.1           # –£–∂–µ –µ—Å—Ç—å!
  
  # Depth
  depth_ratio_threshold: 1.3        # –ü–æ—Ä–æ–≥ –¥–ª—è bonus
  depth_score_bonus: 1              # +1 –±–∞–ª–ª
  
  # –ê–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–µ –ø–æ–∫—É–ø–∫–∏/–ø—Ä–æ–¥–∞–∂–∏ (advanced)
  track_aggressive_trades: true     # –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º market orders
  aggressive_threshold: 50000       # $50k –∑–∞ 1 –º–∏–Ω—É—Ç—É = —Å–∏–ª—å–Ω—ã–π —Å–∏–≥–Ω–∞–ª
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**:
```python
# –ü—Ä–∏–º–µ—Ä

LONG —Å–∏–≥–Ω–∞–ª: 7/12 –±–∞–ª–ª–æ–≤

Order Book –ø—Ä–æ–≤–µ—Ä–∫–∞:
  - BID/ASK imbalance: +0.28 (28% –≤ –ø–æ–ª—å–∑—É BID) ‚úÖ
  - Depth ratio: 1.45 ‚úÖ
  - Spread: 0.06% ‚úÖ
  
–ë–æ–Ω—É—Å—ã:
  + Imbalance bonus: +1 –±–∞–ª–ª
  + Depth bonus: +1 –±–∞–ª–ª
  
–ò—Ç–æ–≥–æ: 9/12 ‚Üí –°–∏–ª—å–Ω—ã–π LONG —Å–∏–≥–Ω–∞–ª!

–õ–æ–≥–∏–∫–∞:
  - –ú–Ω–æ–≥–æ –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π –≤ –æ—Ä–¥–µ—Ä–±—É–∫–µ
  - –î–∞–≤–ª–µ–Ω–∏–µ –≤–≤–µ—Ä—Ö
  - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ —Å–∏–≥–Ω–∞–ª–∞
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ –≤–ª–∏—è–Ω–∏–µ**:

```yaml
# –ê–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π (–±–æ–ª—å—à–µ –≤–µ—Å–∞ Order Book)
market_microstructure:
  imbalance_score_bonus: 2          # –ë–æ–ª—å—à–µ –≤–µ—Å (+2 –≤–º–µ—Å—Ç–æ +1)
  imbalance_threshold: 0.15         # –ù–∏–∂–µ –ø–æ—Ä–æ–≥ (–ª–µ–≥—á–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å)
  depth_score_bonus: 2

–≠—Ñ—Ñ–µ–∫—Ç:
  - –ë–æ–ª—å—à–µ —Å–¥–µ–ª–æ–∫ (+20%)
  - –°–ª–µ–¥—É–µ–º –∑–∞ "—Ç–æ–ª–ø–æ–π"
  - –†–∏—Å–∫: –¢–æ–ª–ø–∞ –º–æ–∂–µ—Ç –æ—à–∏–±–∞—Ç—å—Å—è

# –ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π (Order Book —Ç–æ–ª—å–∫–æ —Ñ–∏–ª—å—Ç—Ä)
market_microstructure:
  imbalance_score_bonus: 0          # –ù–µ –¥–∞–µ–º –±–∞–ª–ª—ã
  block_against_imbalance: true     # –¢–æ–ª—å–∫–æ –±–ª–æ–∫–∏—Ä—É–µ–º –ø—Ä–∏ –æ–±—Ä–∞—Ç–Ω–æ–º –∏–º–±–∞–ª–∞–Ω—Å–µ
  imbalance_threshold: 0.3          # –í—ã—Å–æ–∫–∏–π –ø–æ—Ä–æ–≥

–≠—Ñ—Ñ–µ–∫—Ç:
  - –ú–µ–Ω—å—à–µ —Å–¥–µ–ª–æ–∫ (-10%)
  - –¢–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ Order Book —á–µ—Ç–∫–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç
  - –ú–µ–Ω—å—à–µ –ª–æ–∂–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤
```

**–í–ª–∏—è–Ω–∏–µ –Ω–∞ —Ç–æ—Ä–≥–æ–≤–ª—é**:
- ‚úÖ **+8-12% Win Rate** (–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ—Ç –æ—Ä–¥–µ—Ä –±—É–∫–∞)
- ‚úÖ **–ë—ã—Å—Ç—Ä–µ–µ –≤—Ö–æ–¥—ã** (–≤–∏–¥–∏–º –¥–∞–≤–ª–µ–Ω–∏–µ –î–û –¥–≤–∏–∂–µ–Ω–∏—è)
- ‚ö†Ô∏è **–¢—Ä–µ–±—É–µ—Ç –±—ã—Å—Ç—Ä–æ–µ API** (–∑–∞–¥–µ—Ä–∂–∫–∞ —É–±–∏–≤–∞–µ—Ç –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ)
- üéØ **+10-15% –ø—Ä–∏–±—ã–ª—å** (–æ—Å–æ–±–µ–Ω–Ω–æ –Ω–∞ 1m —Å–∫–∞–ª—å–ø–∏–Ω–≥–µ)

---

## 8Ô∏è‚É£ LIQUIDITY ZONES (–ö–ª–∞—Å—Ç–µ—Ä–Ω—ã–π –∞–Ω–∞–ª–∏–∑)

### üìÅ –§–∞–π–ª: `src/strategies/modules/liquidity_zones.py`

### üéØ –¶–µ–ª—å:
–ù–∞–π—Ç–∏ –∑–æ–Ω—ã —Å **–∫–ª–∞—Å—Ç–µ—Ä–∞–º–∏ –æ—Ä–¥–µ—Ä–æ–≤** (–º–Ω–æ–≥–æ –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π/–ø—Ä–æ–¥–∞–≤—Ü–æ–≤ –Ω–∞ –±–ª–∏–∑–∫–∏—Ö —É—Ä–æ–≤–Ω—è—Ö).

### üîß –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:

**–ö–æ–Ω—Ü–µ–ø—Ü–∏—è**: –ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ, —á—Ç–æ –≤–∏–¥–∏—Ç–µ –í–°–ï limit –æ—Ä–¥–µ—Ä–∞ –≤ –æ—Ä–¥–µ—Ä –±—É–∫–µ:

```
Price Range | Aggregated Orders | Interpretation
------------|-------------------|----------------
$187-$188   | 50 BTC           | Weak resistance
$186-$187   | 350 BTC          | STRONG RESISTANCE ‚Üê Cluster!
$185-$186   | 80 BTC           | Weak resistance
$184-$185   | 120 BTC          | Medium resistance
$183-$184   | 600 BTC          | STRONG SUPPORT ‚Üê Cluster!
$182-$183   | 95 BTC           | Weak support
```

**–ö–ª–∞—Å—Ç–µ—Ä—ã** = Liquidity Zones:
- **$186-$187**: –°–∏–ª—å–Ω–æ–µ —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏–µ (350 BTC)
- **$183-$184**: –°–∏–ª—å–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ (600 BTC)

### üéØ –ê–ª–≥–æ—Ä–∏—Ç–º –ø–æ–∏—Å–∫–∞:

```python
def find_liquidity_clusters(order_book, price_range_percent=0.5):
    """
    –ù–∞—Ö–æ–¥–∏—Ç –∫–ª–∞—Å—Ç–µ—Ä—ã –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏
    
    price_range_percent: –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –æ—Ä–¥–µ—Ä–∞ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö 0.5%
    """
    
    # –®–∞–≥ 1: –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –±–ª–∏–∑–∫–∏–µ —É—Ä–æ–≤–Ω–∏
    clusters = []
    
    for price_level in order_book:
        # –ò—â–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–ª–∞—Å—Ç–µ—Ä –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö 0.5%
        found_cluster = find_cluster_within(price_level, 0.5%)
        
        if found_cluster:
            # –î–æ–±–∞–≤–ª—è–µ–º –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É
            found_cluster.add_order(price_level)
        else:
            # –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –∫–ª–∞—Å—Ç–µ—Ä
            new_cluster = Cluster(center=price_level)
            clusters.append(new_cluster)
    
    # –®–∞–≥ 2: –ù–∞—Ö–æ–¥–∏–º –∑–Ω–∞—á–∏–º—ã–µ (>—Å—Ä–µ–¥–Ω–µ–≥–æ √ó 3)
    avg_size = average([c.total_size for c in clusters])
    
    significant_clusters = [
        c for c in clusters 
        if c.total_size > avg_size * 3
    ]
    
    return significant_clusters

# –ü—Ä–∏–º–µ—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:

Cluster 1:
  Center: $186.50
  Range: $186.00-$187.00
  Total Size: 350 BTC
  Type: RESISTANCE (ask side)
  Strength: STRONG (3.5x average)

Cluster 2:
  Center: $183.50
  Range: $183.00-$184.00
  Total Size: 600 BTC
  Type: SUPPORT (bid side)
  Strength: VERY STRONG (6x average)
```

### üìä –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ —Ç–æ—Ä–≥–æ–≤–ª–µ:

#### –°—Ç—Ä–∞—Ç–µ–≥–∏—è 1: –í—Ö–æ–¥ –æ–∫–æ–ª–æ Liquidity Zone
```python
# LONG —Å–∏–≥–Ω–∞–ª

Current price: $183.20
Liquidity Cluster (support): $183.00-$184.00 (600 BTC)

–ü—Ä–æ–≤–µ—Ä–∫–∞:
  - –¶–µ–Ω–∞ –í–ù–£–¢–†–ò —Å–∏–ª—å–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏ ‚úÖ
  - –õ–æ–≥–∏–∫–∞: 600 BTC –±—É–¥—É—Ç –∑–∞—â–∏—â–∞—Ç—å —É—Ä–æ–≤–µ–Ω—å
  
Scoring:
  Base: 7/12
  Liquidity Zone bonus: +2 –±–∞–ª–ª–∞
  Total: 9/12 ‚Üí –í—Ö–æ–¥–∏–º!

Entry: $183.20
SL: $182.70 (–ù–ò–ñ–ï –∫–ª–∞—Å—Ç–µ—Ä–∞, –µ—Å–ª–∏ –ø—Ä–æ–±—å—é—Ç 600 BTC = —Å–∏–ª—å–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ)
TP: $186.00 (–ø–µ—Ä–µ–¥ –∫–ª–∞—Å—Ç–µ—Ä–æ–º —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏—è)
```

#### –°—Ç—Ä–∞—Ç–µ–≥–∏—è 2: TP –ø–µ—Ä–µ–¥ –∫–ª–∞—Å—Ç–µ—Ä–æ–º
```python
# LONG –ø–æ–∑–∏—Ü–∏—è

Entry: $184.00
–ë–∞–∑–æ–≤—ã–π TP (1.5 ATR): $185.80

Liquidity Zones:
  - Resistance cluster: $186-$187 (350 BTC)

–ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞:
  - –ë–∞–∑–æ–≤—ã–π TP $185.80 –±–ª–∏–∑–∫–æ –∫ –∫–ª–∞—Å—Ç–µ—Ä—É
  - –°—Ç–∞–≤–∏–º TP: $185.50 (–ü–ï–†–ï–î –∫–ª–∞—Å—Ç–µ—Ä–æ–º)
  - –ó–∞–ø–∞—Å: $0.50 –ø–µ—Ä–µ–¥ 350 BTC —Å—Ç–µ–Ω–æ–π
  
–õ–æ–≥–∏–∫–∞:
  - 350 BTC –º–æ–≥—É—Ç –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–≤–∏–∂–µ–Ω–∏–µ
  - –õ—É—á—à–µ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å—Å—è —á—É—Ç—å —Ä–∞–Ω—å—à–µ
  - –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è: –í—ã—à–µ
```

#### –°—Ç—Ä–∞—Ç–µ–≥–∏—è 3: –ò–∑–±–µ–≥–∞–µ–º –≤—Ö–æ–¥–æ–≤ –º–µ–∂–¥—É –∫–ª–∞—Å—Ç–µ—Ä–∞–º–∏
```python
# –°–∏—Ç—É–∞—Ü–∏—è: "–ù–µ–π—Ç—Ä–∞–ª—å–Ω–∞—è –∑–æ–Ω–∞"

Current price: $185.00

Clusters:
  - Support: $183-$184 (–Ω–∏–∂–µ)
  - Resistance: $186-$187 (–≤—ã—à–µ)
  - Current: –ú–µ–∂–¥—É –∫–ª–∞—Å—Ç–µ—Ä–∞–º–∏ (–≤–∞–∫—É—É–º)

SHORT —Å–∏–≥–Ω–∞–ª: 8/12

–ü—Ä–æ–≤–µ—Ä–∫–∞:
  - –¶–µ–Ω–∞ –≤ "–Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ–π –∑–æ–Ω–µ" ‚ö†Ô∏è
  - –ù–µ—Ç strong support/resistance –∑–¥–µ—Å—å
  - –ú–æ–∂–µ—Ç –ø–æ–π—Ç–∏ –í –õ–Æ–ë–£–Æ —Å—Ç–æ—Ä–æ–Ω—É
  
–î–µ–π—Å—Ç–≤–∏–µ:
  - –õ–∏–±–æ –ø—Ä–æ–ø—É—Å–∫–∞–µ–º (–∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–æ)
  - –õ–∏–±–æ —É–º–µ–Ω—å—à–∞–µ–º —Ä–∞–∑–º–µ—Ä –Ω–∞ 50%
  - –õ–∏–±–æ TP/SL –¥–µ–ª–∞–µ–º —É–∂–µ (–±—ã—Å—Ç—Ä—ã–π –≤—ã—Ö–æ–¥)
```

### üéõÔ∏è –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:

```yaml
liquidity_zones:
  enabled: true
  
  # –ê–Ω–∞–ª–∏–∑ Order Book
  depth_levels: 50                  # –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —Ç–æ–ø 50 —É—Ä–æ–≤–Ω–µ–π
  cluster_range_percent: 0.5        # –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö 0.5%
  min_cluster_strength: 3.0         # –ú–∏–Ω–∏–º—É–º 3x –æ—Ç —Å—Ä–µ–¥–Ω–µ–≥–æ
  
  # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
  entry_near_cluster: true          # –í—Ö–æ–¥–∏—Ç—å –æ–∫–æ–ª–æ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
  cluster_proximity: 0.3            # 0.3% –æ—Ç –∫–ª–∞—Å—Ç–µ—Ä–∞
  cluster_score_bonus: 2            # +2 –±–∞–ª–ª–∞
  
  avoid_neutral_zones: true         # –ò–∑–±–µ–≥–∞—Ç—å –∑–æ–Ω –º–µ–∂–¥—É –∫–ª–∞—Å—Ç–µ—Ä–∞–º–∏
  neutral_zone_action: "reduce"     # "skip" –∏–ª–∏ "reduce" –∏–ª–∏ "allow"
  neutral_zone_size_modifier: 0.5   # –£–º–µ–Ω—å—à–∞–µ–º —Ä–∞–∑–º–µ—Ä –≤–¥–≤–æ–µ
  
  # TP/SL adjustment
  adjust_tp_before_cluster: true    # TP –ø–µ—Ä–µ–¥ –∫–ª–∞—Å—Ç–µ—Ä–æ–º
  adjust_sl_beyond_cluster: true    # SL –∑–∞ –∫–ª–∞—Å—Ç–µ—Ä–æ–º
  cluster_margin_percent: 0.2       # –û—Ç—Å—Ç—É–ø –æ—Ç –∫–ª–∞—Å—Ç–µ—Ä–∞
  
  # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ
  refresh_interval: 10              # –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ –≤–ª–∏—è–Ω–∏–µ**:

```yaml
# –ê–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π (–±–æ–ª—å—à–µ –≤–µ—Å–∞ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤)
liquidity_zones:
  cluster_score_bonus: 3            # –ë–æ–ª—å—à–µ –±–∞–ª–ª–æ–≤
  min_cluster_strength: 2.0         # –ë–æ–ª–µ–µ –Ω–∏–∑–∫–∏–π –ø–æ—Ä–æ–≥
  avoid_neutral_zones: false        # –¢–æ—Ä–≥—É–µ–º –≤–µ–∑–¥–µ

–≠—Ñ—Ñ–µ–∫—Ç:
  - –ë–æ–ª—å—à–µ —Å–¥–µ–ª–æ–∫ –æ–∫–æ–ª–æ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
  - –†–∏—Å–∫: –ö–ª–∞—Å—Ç–µ—Ä—ã –º–æ–≥—É—Ç "—Ä–∞—Å—Ç–∞—è—Ç—å" (–æ—Ä–¥–µ—Ä–∞ –æ—Ç–º–µ–Ω—è—Ç)

# –ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π
liquidity_zones:
  cluster_score_bonus: 1
  min_cluster_strength: 5.0         # –¢–æ–ª—å–∫–æ –æ—á–µ–Ω—å —Å–∏–ª—å–Ω—ã–µ –∫–ª–∞—Å—Ç–µ—Ä—ã
  avoid_neutral_zones: true         # –°—Ç—Ä–æ–≥–æ –∏–∑–±–µ–≥–∞–µ–º

–≠—Ñ—Ñ–µ–∫—Ç:
  - –ú–µ–Ω—å—à–µ —Å–¥–µ–ª–æ–∫
  - –¢–æ–ª—å–∫–æ –æ–∫–æ–ª–æ —Å–∏–ª—å–Ω–µ–π—à–∏—Ö —É—Ä–æ–≤–Ω–µ–π
  - –í—ã—à–µ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å
```

**–í–ª–∏—è–Ω–∏–µ –Ω–∞ —Ç–æ—Ä–≥–æ–≤–ª—é**:
- ‚úÖ **+12-15% —Ç–æ—á–Ω–æ—Å—Ç—å –≤—Ö–æ–¥–æ–≤** (–æ–∫–æ–ª–æ —Å–∏–ª—å–Ω—ã—Ö —É—Ä–æ–≤–Ω–µ–π)
- ‚úÖ **-20% –ø—Ä–æ–±–∏—Ç—ã—Ö SL** (—Å—Ç–æ–ø—ã –∑–∞ –∫–ª–∞—Å—Ç–µ—Ä–∞–º–∏)
- ‚ö†Ô∏è **–¢—Ä–µ–±—É–µ—Ç Order Book API** (–Ω–µ –≤—Å–µ –±–∏—Ä–∂–∏ –¥–∞—é—Ç)
- üéØ **+15-20% –æ–±—â–∞—è –ø—Ä–∏–±—ã–ª—å**

---

# ü§ñ PHASE 3: REINFORCEMENT LEARNING

---

## 9Ô∏è‚É£ RL AGENT (–°–∞–º–æ–æ–±—É—á–∞—é—â–∏–π—Å—è –±–æ—Ç)

### üìÅ –§–∞–π–ª—ã: 
- `src/ml/rl_environment.py` (—Å—Ä–µ–¥–∞ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è)
- `src/ml/rl_agent.py` (–∞–≥–µ–Ω—Ç)
- `src/ml/model_trainer.py` (–æ–±—É—á–µ–Ω–∏–µ)

### üéØ –¶–µ–ª—å:
–ë–æ—Ç **–°–ê–ú –£–ß–ò–¢–°–Ø** –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ–ø—ã—Ç–∞, –Ω–∞—Ö–æ–¥–∏—Ç –ø–∞—Ç—Ç–µ—Ä–Ω—ã, –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –∫ —Ä—ã–Ω–∫—É.

### üß† –ö–æ–Ω—Ü–µ–ø—Ü–∏—è RL (Reinforcement Learning):

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  AGENT  ‚îÇ (–ë–æ—Ç)
‚îÇ  (RL)   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ
     ‚îÇ –ù–∞–±–ª—é–¥–∞–µ—Ç STATE
     ‚îÇ (–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã, –±–∞–ª–∞–Ω—Å, –ø–æ–∑–∏—Ü–∏–∏)
     ‚îÇ
     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ENVIRONMENT ‚îÇ (–†—ã–Ω–æ–∫)
‚îÇ (Trading)   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ
     ‚îÇ –ü–æ–ª—É—á–∞–µ—Ç REWARD
     ‚îÇ (PnL –æ—Ç —Å–¥–µ–ª–∫–∏)
     ‚îÇ
     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ LEARNING‚îÇ
‚îÇ (Update ‚îÇ
‚îÇ  Policy)‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ
     ‚îÇ –£–ª—É—á—à–∞–µ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏—é
     ‚îÇ
     ‚îî‚îÄ‚îÄ> –ü–æ–≤—Ç–æ—Ä—è–µ–º
```

### üîß –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

#### STATE (–°–æ—Å—Ç–æ—è–Ω–∏–µ) - —á—Ç–æ –≤–∏–¥–∏—Ç –±–æ—Ç:
```python
state = {
    # –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã (9 —à—Ç)
    'rsi': 45.2,
    'macd_line': 0.15,
    'macd_signal': 0.08,
    'sma_fast': 180.5,
    'sma_slow': 181.2,
    'ema_fast': 180.3,
    'ema_slow': 181.0,
    'bb_upper': 182.5,
    'bb_lower': 179.5,
    'atr': 0.45,
    'volume_ratio': 1.3,
    
    # –†—ã–Ω–æ–∫
    'current_price': 180.2,
    'spread': 0.05,
    'volatility': 0.015,
    'market_regime': 'TRENDING',
    
    # –ü–æ—Ä—Ç—Ñ–µ–ª—å
    'balance': 1000.0,
    'position_open': False,
    'position_pnl': 0.0,
    'consecutive_losses': 0,
    
    # –í—Ä–µ–º—è
    'hour_utc': 14,
    'is_whitelisted_hour': True,
    
    # Order Book (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω)
    'bid_ask_imbalance': 0.25,
    'depth_ratio': 1.4,
    
    # Multi-timeframe
    '5m_ema_trend': 'BULLISH',
    
    # ... –≤—Å–µ–≥–æ 25-30 –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
}
```

#### ACTION (–î–µ–π—Å—Ç–≤–∏–µ) - —á—Ç–æ –º–æ–∂–µ—Ç –¥–µ–ª–∞—Ç—å:
```python
actions = {
    0: "HOLD",                     # –ù–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞—Ç—å
    1: "LONG",                     # –û—Ç–∫—Ä—ã—Ç—å LONG
    2: "SHORT",                    # –û—Ç–∫—Ä—ã—Ç—å SHORT
    3: "CLOSE",                    # –ó–∞–∫—Ä—ã—Ç—å –ø–æ–∑–∏—Ü–∏—é
    4: "INCREASE_LONG",            # –£–≤–µ–ª–∏—á–∏—Ç—å LONG (scaling)
    5: "INCREASE_SHORT",           # –£–≤–µ–ª–∏—á–∏—Ç—å SHORT
}

# –ê–≥–µ–Ω—Ç –≤—ã–±–∏—Ä–∞–µ—Ç action –Ω–∞ –æ—Å–Ω–æ–≤–µ state
```

#### REWARD (–ù–∞–≥—Ä–∞–¥–∞) - –∫–∞–∫ –æ—Ü–µ–Ω–∏–≤–∞–µ–º:
```python
def calculate_reward(trade_result):
    """
    –ù–∞–≥—Ä–∞–¥–∞ –∑–∞ –¥–µ–π—Å—Ç–≤–∏–µ
    """
    
    # –ë–∞–∑–æ–≤–∞—è –Ω–∞–≥—Ä–∞–¥–∞ = PnL
    reward = trade_result.pnl
    
    # –®—Ç—Ä–∞—Ñ—ã/–±–æ–Ω—É—Å—ã:
    
    # –®—Ç—Ä–∞—Ñ –∑–∞ —É–±—ã—Ç–æ–∫ (–±–æ–ª—å—à–µ —á–µ–º —Å–∞–º–∞ –ø–æ—Ç–µ—Ä—è)
    if trade_result.pnl < 0:
        reward *= 1.5  # –£–±—ã—Ç–æ–∫ $10 ‚Üí reward -$15
    
    # –ë–æ–Ω—É—Å –∑–∞ –ø–æ–±–µ–¥—É
    if trade_result.pnl > 0:
        reward *= 1.2  # –ü—Ä–∏–±—ã–ª—å $10 ‚Üí reward +$12
    
    # –®—Ç—Ä–∞—Ñ –∑–∞ –¥–æ–ª–≥–æ–µ –¥–µ—Ä–∂–∞–Ω–∏–µ
    if trade_result.duration_minutes > 15:
        reward -= 5  # –î–µ—Ä–∂–∞–ª–∏ —Å–ª–∏—à–∫–æ–º –¥–æ–ª–≥–æ
    
    # –ë–æ–Ω—É—Å –∑–∞ –±—ã—Å—Ç—Ä—ã–π –ø—Ä–æ—Ñ–∏—Ç
    if trade_result.pnl > 0 and trade_result.duration_minutes < 5:
        reward += 10  # –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–∏–±—ã–ª—å - —Ö–æ—Ä–æ—à–æ!
    
    # –®—Ç—Ä–∞—Ñ –∑–∞ consecutive losses
    if consecutive_losses > 2:
        reward -= 20  # –°–µ—Ä–∏—è —É–±—ã—Ç–∫–æ–≤ - –ø–ª–æ—Ö–æ!
    
    # –ë–æ–Ω—É—Å –∑–∞ Sharpe Ratio
    reward += sharpe_ratio * 5
    
    return reward
```

#### LEARNING (–û–±—É—á–µ–Ω–∏–µ):
```python
# –ê–ª–≥–æ—Ä–∏—Ç–º: PPO (Proximal Policy Optimization)

agent = PPO(
    state_dim=30,                  # 30 –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
    action_dim=6,                  # 6 –¥–µ–π—Å—Ç–≤–∏–π
    hidden_layers=[128, 256, 128], # –ù–µ–π—Ä–æ–Ω–Ω–∞—è —Å–µ—Ç—å
    learning_rate=0.0003
)

# –û–±—É—á–µ–Ω–∏–µ:

for episode in range(10000):  # 10,000 —ç–ø–∏–∑–æ–¥–æ–≤
    state = env.reset()  # –ù–∞—á–∏–Ω–∞–µ–º —Å –Ω–∞—á–∞–ª–∞
    episode_reward = 0
    
    for step in range(1440):  # 1 –¥–µ–Ω—å = 1440 –º–∏–Ω—É—Ç
        # –ê–≥–µ–Ω—Ç –≤—ã–±–∏—Ä–∞–µ—Ç –¥–µ–π—Å—Ç–≤–∏–µ
        action = agent.select_action(state)
        
        # –í—ã–ø–æ–ª–Ω—è–µ–º –¥–µ–π—Å—Ç–≤–∏–µ
        next_state, reward, done = env.step(action)
        
        # –ó–∞–ø–æ–º–∏–Ω–∞–µ–º
        agent.remember(state, action, reward, next_state)
        
        episode_reward += reward
        state = next_state
        
        if done:
            break
    
    # –û–±—É—á–∞–µ–º –∞–≥–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ —ç–ø–∏–∑–æ–¥–∞
    agent.train()
    
    # –õ–æ–≥–∏—Ä—É–µ–º
    print(f"Episode {episode}: Reward {episode_reward:.2f}")

# –ü–æ—Å–ª–µ –æ–±—É—á–µ–Ω–∏—è:
# –ê–≥–µ–Ω—Ç "–ø–æ–Ω—è–ª" –∫–∞–∫–∏–µ state –ø—Ä–∏–≤–æ–¥—è—Ç –∫ —Ö–æ—Ä–æ—à–∏–º reward
# –ú–æ–∂–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Ä–µ—à–µ–Ω–∏—è –ª—É—á—à–µ —á–µ–º —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞
```

### üìä –ü–∞—Ä–∞–º–µ—Ç—Ä—ã RL:

```yaml
reinforcement_learning:
  enabled: false                    # –ü–æ–∫–∞ –≤—ã–∫–ª—é—á–µ–Ω
  
  # –ú–æ–¥–µ–ª—å
  algorithm: "PPO"                  # –ú–æ–∂–Ω–æ "DQN", "A2C", "SAC"
  state_features:                   # –ß—Ç–æ –≤–∏–¥–∏—Ç –∞–≥–µ–Ω—Ç
    - "all_indicators"              # –í—Å–µ 9 –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤
    - "market_regime"               # –†–µ–∂–∏–º —Ä—ã–Ω–∫–∞
    - "portfolio_state"             # –ë–∞–ª–∞–Ω—Å, –ø–æ–∑–∏—Ü–∏–∏
    - "time_features"               # –ß–∞—Å, –¥–µ–Ω—å –Ω–µ–¥–µ–ª–∏
    - "order_book"                  # Order Book (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω)
    
  action_space: "discrete"          # "discrete" (6 –¥–µ–π—Å—Ç–≤–∏–π) –∏–ª–∏ "continuous"
  
  # –û–±—É—á–µ–Ω–∏–µ
  training_episodes: 10000          # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ø–∏–∑–æ–¥–æ–≤
  episode_length: 1440              # –î–ª–∏–Ω–∞ —ç–ø–∏–∑–æ–¥–∞ (–º–∏–Ω—É—Ç)
  learning_rate: 0.0003             # –°–∫–æ—Ä–æ—Å—Ç—å –æ–±—É—á–µ–Ω–∏—è
  
  # Reward shaping
  pnl_multiplier: 1.0               # –í–µ—Å PnL
  loss_penalty_multiplier: 1.5      # –®—Ç—Ä–∞—Ñ –∑–∞ —É–±—ã—Ç–æ–∫
  duration_penalty: true            # –®—Ç—Ä–∞—Ñ –∑–∞ –¥–æ–ª–≥–æ–µ –¥–µ—Ä–∂–∞–Ω–∏–µ
  sharpe_bonus: true                # –ë–æ–Ω—É—Å –∑–∞ Sharpe
  
  # Production
  confidence_threshold: 0.7         # –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –∞–≥–µ–Ω—Ç–∞
  fallback_to_rules: true           # –ï—Å–ª–∏ –∞–≥–µ–Ω—Ç –Ω–µ —É–≤–µ—Ä–µ–Ω ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∞–≤–∏–ª–∞
  
  # Model updates
  retrain_frequency: "weekly"       # –ü–µ—Ä–µ–æ–±—É—á–∞–µ–º –∫–∞–∂–¥—É—é –Ω–µ–¥–µ–ª—é
  online_learning: false            # –û–±—É—á–µ–Ω–∏–µ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ (–æ–ø–∞—Å–Ω–æ!)
```

### üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ RL:

```
1. –°–ê–ú–û–û–ë–£–ß–ï–ù–ò–ï:
   - –ê–≥–µ–Ω—Ç –°–ê–ú –Ω–∞—Ö–æ–¥–∏—Ç –ø–∞—Ç—Ç–µ—Ä–Ω—ã
   - –ù–µ –Ω—É–∂–Ω–æ –ø—Ä–∏–¥—É–º—ã–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª–∞
   - –ê–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º —Ä—ã–Ω–∫–∞

2. –ö–û–ú–ü–õ–ï–ö–°–ù–´–ï –ü–ê–¢–¢–ï–†–ù–´:
   - –ú–æ–∂–µ—Ç –Ω–∞–π—Ç–∏ —Å–≤—è–∑–∏, –∫–æ—Ç–æ—Ä—ã–µ —á–µ–ª–æ–≤–µ–∫ –Ω–µ –≤–∏–¥–∏—Ç
   - –ù–∞–ø—Ä–∏–º–µ—Ä: "RSI 45 + MACD 0.15 + Hour 14 + BID imbalance ‚Üí 85% Win Rate"

3. –ê–î–ê–ü–¢–ê–¶–ò–Ø:
   - –†—ã–Ω–æ–∫ –º–µ–Ω—è–µ—Ç—Å—è ‚Üí –∞–≥–µ–Ω—Ç –ø–µ—Ä–µ–æ–±—É—á–∞–µ—Ç—Å—è
   - –ù–æ–≤—ã–µ —É—Å–ª–æ–≤–∏—è ‚Üí –Ω–æ–≤–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è

4. –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø:
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞–π–¥–µ—Ç –ª—É—á—à–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
   - –õ—É—á—à–µ —á–µ–º —Ä—É—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
```

### ‚ö†Ô∏è –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏ RL:

```
1. –°–õ–û–ñ–ù–û–°–¢–¨:
   - –ù—É–∂–Ω–æ –º–Ω–æ–≥–æ –¥–∞–Ω–Ω—ã—Ö (6-12 –º–µ—Å—è—Ü–µ–≤ –∏—Å—Ç–æ—Ä–∏–∏)
   - –û–±—É—á–µ–Ω–∏–µ 2-7 –¥–Ω–µ–π –Ω–∞ GPU
   - –°–ª–æ–∂–Ω–æ –¥–µ–±–∞–∂–∏—Ç—å

2. –ü–ï–†–ï–û–ë–£–ß–ï–ù–ò–ï (Overfitting):
   - –ê–≥–µ–Ω—Ç "–∑–∞–ø–æ–º–∏–Ω–∞–µ—Ç" –∏—Å—Ç–æ—Ä–∏—é
   - –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
   - –ù—É–∂–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è

3. "–ß–ï–†–ù–´–ô –Ø–©–ò–ö":
   - –ù–µ–ø–æ–Ω—è—Ç–Ω–æ –ü–û–ß–ï–ú–£ –∞–≥–µ–Ω—Ç –¥–µ–ª–∞–µ—Ç —Ç–∞–∫
   - –°–ª–æ–∂–Ω–æ –æ–±—ä—è—Å–Ω–∏—Ç—å –ª–æ–≥–∏–∫—É

4. –†–ò–°–ö –í PRODUCTION:
   - –ú–æ–∂–µ—Ç –¥–µ–ª–∞—Ç—å —Å—Ç—Ä–∞–Ω–Ω—ã–µ –≤–µ—â–∏
   - –ù—É–∂–µ–Ω fallback –Ω–∞ –ø—Ä–∞–≤–∏–ª–∞
```

### üîß –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):

```python
# –ù–ï –ø–æ–ª–Ω–∞—è –∑–∞–º–µ–Ω–∞, –∞ –ü–û–ú–û–©–ù–ò–ö

class HybridRLStrategy:
    def __init__(self):
        self.rl_agent = RLAgent()           # RL –∞–≥–µ–Ω—Ç
        self.rule_based = ScalpingEngine()  # –ü—Ä–∞–≤–∏–ª–∞ (—Ç–µ–∫—É—â–∏–µ)
        
    async def generate_signal(self, state):
        # 1. –°–ø—Ä–∞—à–∏–≤–∞–µ–º RL –∞–≥–µ–Ω—Ç–∞
        rl_action, rl_confidence = self.rl_agent.predict(state)
        
        # 2. –°–ø—Ä–∞—à–∏–≤–∞–µ–º rule-based
        rule_signal = await self.rule_based.generate_signal(state)
        
        # 3. –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º
        if rl_confidence > 0.8:
            # RL —É–≤–µ—Ä–µ–Ω ‚Üí —Å–ª–µ–¥—É–µ–º –∑–∞ –Ω–∏–º
            return rl_action
            
        elif rl_confidence > 0.6 and rl_action == rule_signal:
            # RL –∏ –ø—Ä–∞–≤–∏–ª–∞ —Å–æ–≥–ª–∞—Å–Ω—ã ‚Üí —Å–∏–ª—å–Ω—ã–π —Å–∏–≥–Ω–∞–ª!
            return rl_action  # –£—Å–∏–ª–µ–Ω–Ω—ã–π –≤–µ—Å
            
        elif rl_confidence < 0.6:
            # RL –Ω–µ —É–≤–µ—Ä–µ–Ω ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∞–≤–∏–ª–∞
            return rule_signal
            
        else:
            # RL –∏ –ø—Ä–∞–≤–∏–ª–∞ –Ω–µ —Å–æ–≥–ª–∞—Å–Ω—ã ‚Üí –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
            return None  # –ë–µ–∑–æ–ø–∞—Å–Ω–µ–µ
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≥–∏–±—Ä–∏–¥–∞**:
```yaml
rl_hybrid:
  rl_enabled: true
  
  # –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å
  high_confidence_threshold: 0.8    # RL —Ä–µ—à–∞–µ—Ç —Å–∞–º
  medium_confidence_threshold: 0.6  # –ù—É–∂–Ω–æ —Å–æ–≥–ª–∞—Å–∏–µ —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏
  
  # Fallback
  fallback_to_rules: true           # –ï—Å–ª–∏ RL —Å–æ–º–Ω–µ–≤–∞–µ—Ç—Å—è
  require_agreement: false          # –¢—Ä–µ–±–æ–≤–∞—Ç—å —Å–æ–≥–ª–∞—Å–∏–µ (—Å—Ç—Ä–æ–∂–µ)
  
  # –í–µ—Å RL vs Rules
  rl_weight: 0.6                    # 60% –≤–µ—Å RL
  rules_weight: 0.4                 # 40% –≤–µ—Å –ø—Ä–∞–≤–∏–ª–∞
```

**–í–ª–∏—è–Ω–∏–µ –Ω–∞ —Ç–æ—Ä–≥–æ–≤–ª—é**:
- ‚úÖ **+20-40% Win Rate** (–µ—Å–ª–∏ —Ö–æ—Ä–æ—à–æ –æ–±—É—á–µ–Ω)
- ‚úÖ **–ù–∞—Ö–æ–¥–∏—Ç —Å–∫—Ä—ã—Ç—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã**
- ‚ö†Ô∏è **–û—á–µ–Ω—å —Å–ª–æ–∂–Ω–æ** (2-3 –º–µ—Å—è—Ü–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
- ‚ö†Ô∏è **–†–∏—Å–∫ –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏—è**
- üéØ **–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª –æ–≥—Ä–æ–º–Ω—ã–π**, –ù–û –Ω—É–∂–Ω–∞ —ç–∫—Å–ø–µ—Ä—Ç–∏–∑–∞

---

# üîó –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø –° –ì–ò–ë–†–ò–î–ù–´–ú –ë–û–¢–û–ú

## ü§ù –ö–∞–∫ Phase 1-3 —Ä–∞–±–æ—Ç–∞—é—Ç –≤ –ì–∏–±—Ä–∏–¥–µ:

### Grid Trading –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:
```python
class GridTradingEngine:
    def __init__(self, shared_modules):
        # –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º –º–æ–¥—É–ª–∏!
        self.correlation_mgr = shared_modules.correlation  ‚úÖ
        self.time_mgr = shared_modules.time_filter         ‚úÖ
        self.volatility_detector = shared_modules.vol_modes ‚úÖ
        self.pivot_calc = shared_modules.pivots            ‚úÖ
        self.vp_analyzer = shared_modules.volume_profile   ‚úÖ
        
        # –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ–º:
        # self.mtf_filter = None  ‚ùå (Grid –Ω–µ –Ω—É–∂–µ–Ω MTF)
        # self.rl_agent = None    ‚ùå (Grid - –ø—Ä–æ—Å—Ç—ã–µ –ø—Ä–∞–≤–∏–ª–∞)
        
    def calculate_grid_levels(self, symbol):
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º Pivot Points –¥–ª—è –≥—Ä–∞–Ω–∏—Ü!
        pivots = self.pivot_calc.get_pivots(symbol)
        
        grid_low = pivots['S2']   # –ù–∏–∂–Ω—è—è –≥—Ä–∞–Ω–∏—Ü–∞ = S2
        grid_high = pivots['R2']  # –í–µ—Ä—Ö–Ω—è—è –≥—Ä–∞–Ω–∏—Ü–∞ = R2
        
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º Volume Profile –¥–ª—è —à–∞–≥–∞!
        vpoc = self.vp_analyzer.get_vpoc(symbol)
        
        # –û–¥–∏–Ω —É—Ä–æ–≤–µ–Ω—å Grid –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –Ω–∞ VPOC
        levels = [vpoc]  # –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å
        
        # –î–æ–±–∞–≤–ª—è–µ–º —É—Ä–æ–≤–Ω–∏ –≤—ã—à–µ/–Ω–∏–∂–µ
        # ...
        
        return levels
        
    def can_place_grid_order(self, symbol, level):
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º correlation
        if not self.correlation_mgr.can_open(symbol, "LONG"):
            return False  # –£–∂–µ 2 LONG –Ω–∞ –∫–æ—Ä—Ä–µ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö
            
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º time filter
        if self.time_mgr.is_blacklisted(current_hour):
            return False  # –ü–ª–æ—Ö–æ–π —á–∞—Å
            
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º volatility
        regime = self.volatility_detector.get_regime(symbol)
        
        if regime == "HIGH_VOL":
            # –í HIGH VOL - —à–∏—Ä–µ —à–∞–≥ Grid
            grid_step_modifier = 1.5
        elif regime == "LOW_VOL":
            # –í LOW VOL - —É–∂–µ —à–∞–≥ Grid
            grid_step_modifier = 0.7
            
        return True
```

### Scalping Engine –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:
```python
class ScalpingEngine:
    def __init__(self, shared_modules):
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º –í–°–ï –º–æ–¥—É–ª–∏!
        self.mtf_filter = shared_modules.mtf              ‚úÖ
        self.correlation_mgr = shared_modules.correlation ‚úÖ
        self.time_mgr = shared_modules.time_filter        ‚úÖ
        self.volatility_detector = shared_modules.vol_modes ‚úÖ
        self.pivot_calc = shared_modules.pivots           ‚úÖ
        self.vp_analyzer = shared_modules.volume_profile  ‚úÖ
        self.order_book = shared_modules.order_book       ‚úÖ
        self.liquidity_zones = shared_modules.liquidity   ‚úÖ
        self.rl_agent = shared_modules.rl_agent           ‚úÖ
        
    async def generate_signal(self, ...):
        # –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –í–°–ï–• –º–æ–¥—É–ª–µ–π
        # (–∫–∞–∫ –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–º –ø–ª–∞–Ω–µ)
```

### Hybrid Orchestrator:
```python
class HybridStrategy:
    def __init__(self, ...):
        # –°–æ–∑–¥–∞–µ–º –û–ë–©–ò–ï –º–æ–¥—É–ª–∏ (–æ–¥–∏–Ω —Ä–∞–∑!)
        shared_modules = SharedModules(
            mtf=MultiTimeframeFilter(...),
            correlation=CorrelationManager(...),
            time_filter=TimeSessionManager(...),
            vol_modes=VolatilityModeManager(...),
            pivots=PivotCalculator(...),
            volume_profile=VolumeProfileAnalyzer(...),
            order_book=OrderBookAnalyzer(...),
            liquidity=LiquidityZoneDetector(...),
            rl_agent=RLAgent(...) if rl_enabled else None
        )
        
        # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –¥–≤–∏–∂–∫–∏
        self.scalping = ScalpingEngine(shared_modules)
        self.grid = GridTradingEngine(shared_modules)
        
    async def run(self):
        # –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è
        regime = shared_modules.vol_modes.get_regime(symbol)
        
        if regime == "RANGING":
            await self.grid.process_tick(...)
        elif regime == "TRENDING":
            await self.scalping.process_tick(...)
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- ‚úÖ **DRY principle** (Don't Repeat Yourself) - –º–æ–¥—É–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–≤–∞–∂–¥—ã
- ‚úÖ **–ï–¥–∏–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** - –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ
- ‚úÖ **–ú–µ–Ω—å—à–µ –∫–æ–¥–∞** - –Ω–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ **–õ–µ–≥—á–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∞** - –æ–±–Ω–æ–≤–∏–ª–∏ –º–æ–¥—É–ª—å ‚Üí —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–µ–∑–¥–µ

---

# üìä –ò–¢–û–ì–û–í–ê–Ø –¢–ê–ë–õ–ò–¶–ê –ü–ê–†–ê–ú–ï–¢–†–û–í

## üéõÔ∏è –í–°–ï –ù–ê–°–¢–†–ê–ò–í–ê–ï–ú–´–ï –ü–ê–†–ê–ú–ï–¢–†–´:

| –ú–æ–¥—É–ª—å | –ü–∞—Ä–∞–º–µ—Ç—Ä | Default | –î–∏–∞–ø–∞–∑–æ–Ω | –í–ª–∏—è–Ω–∏–µ |
|--------|----------|---------|----------|---------|
| **Multi-Timeframe** | | | | |
| | confirmation_timeframe | "5m" | 3m-15m | –°—Ç—Ä–æ–≥–æ—Å—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞ |
| | score_bonus | 2 | 1-3 | –í–µ—Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è |
| | block_against_trend | true | true/false | –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ vs Bonus |
| **Correlation** | | | | |
| | threshold | 0.75 | 0.5-0.9 | –°—Ç—Ä–æ–≥–æ—Å—Ç—å |
| | max_correlated | 2 | 1-3 | –î–∏–≤–µ—Ä—Å–∏—Ñ–∏–∫–∞—Ü–∏—è |
| **Time Filter** | | | | |
| | learning_period | 30 | 7-90 | –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å |
| | blacklist_threshold | 35% | 30-45% | –°—Ç—Ä–æ–≥–æ—Å—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ |
| | whitelist_threshold | 65% | 60-75% | –£—Å–∏–ª–µ–Ω–∏–µ |
| | size_multiplier | 1.2 | 1.1-1.5 | –ê–≥—Ä–µ—Å—Å–∏–≤–Ω–æ—Å—Ç—å |
| **Volatility Modes** | | | | |
| | high_vol_threshold | 2.5% | 2-4% | –ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å |
| | low_vol_threshold | 1.0% | 0.5-1.5% | –î–µ—Ç–µ–∫—Ü–∏—è LOW VOL |
| | HIGH: tp_multiplier | 2.0 | 1.5-3.0 | –î–∞–ª—å–Ω–æ—Å—Ç—å TP |
| | HIGH: sl_multiplier | 3.5 | 2.5-4.0 | –®–∏—Ä–∏–Ω–∞ SL |
| | HIGH: size_modifier | 0.7 | 0.5-1.0 | –†–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏ |
| **Pivot Points** | | | | |
| | method | standard | std/fib/cam | –¢–∏–ø —Ä–∞—Å—á–µ—Ç–∞ |
| | score_bonus | 2 | 1-3 | –í–µ—Å |
| | proximity | 0.3% | 0.1-0.5% | –ó–æ–Ω–∞ –∫–∞—Å–∞–Ω–∏—è |
| | adjust_tp | true | true/false | –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ |
| **Volume Profile** | | | | |
| | lookback_period | 24h | 12-48h | –ü–µ—Ä–∏–æ–¥ –¥–∞–Ω–Ω—ã—Ö |
| | price_bins | 50 | 20-100 | –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ |
| | vpoc_bonus | 2 | 1-3 | –í–µ—Å VPOC |
| | hva_avoid | true | true/false | –ò–∑–±–µ–≥–∞—Ç—å HVA |
| **Order Book** | | | | |
| | depth_levels | 10 | 5-50 | –ì–ª—É–±–∏–Ω–∞ –∞–Ω–∞–ª–∏–∑–∞ |
| | imbalance_threshold | 0.2 | 0.15-0.3 | –ü–æ—Ä–æ–≥ –∏–º–±–∞–ª–∞–Ω—Å–∞ |
| | imbalance_bonus | 1 | 0-2 | –í–µ—Å |
| **Liquidity Zones** | | | | |
| | cluster_strength | 3.0 | 2-5 | –ú–∏–Ω. —Å–∏–ª–∞ –∫–ª–∞—Å—Ç–µ—Ä–∞ |
| | cluster_range | 0.5% | 0.3-1.0% | –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ |
| | cluster_bonus | 2 | 1-3 | –í–µ—Å |
| **RL Agent** | | | | |
| | enabled | false | true/false | –í–∫–ª—é—á–µ–Ω–∏–µ |
| | confidence_threshold | 0.7 | 0.5-0.9 | –ú–∏–Ω. —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å |
| | fallback_to_rules | true | true/false | –û—Ç–∫–∞—Ç –Ω–∞ –ø—Ä–∞–≤–∏–ª–∞ |

---

# üéØ –§–ò–ù–ê–õ–¨–ù–´–ï –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

## ‚úÖ –ü–û–†–Ø–î–û–ö –í–ù–ï–î–†–ï–ù–ò–Ø:

### **–≠–¢–ê–ü 1: –ë–∞–∑–æ–≤—ã–µ –º–æ–¥—É–ª–∏** (6-7 –Ω–µ–¥–µ–ª—å)
1. Multi-Timeframe ‚≠ê‚≠ê‚≠ê (–ø–µ—Ä–≤—ã–º!)
2. Volatility Modes (–∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ—Ç–µ–∫—Ü–∏—é)
3. Correlation Filter
4. Pivot Points
5. Volume Profile
6. Time-Based Filter

**–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ**: –¢–µ—Å—Ç–∏—Ä—É–µ–º 2-3 –Ω–µ–¥–µ–ª–∏ –Ω–∞ demo, —Å–æ–±–∏—Ä–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É.

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**: Win Rate 55-60%, —Å—Ç–∞–±–∏–ª—å–Ω–∞—è —Ç–æ—Ä–≥–æ–≤–ª—è.

### **–≠–¢–ê–ü 2: –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ** (2-3 –Ω–µ–¥–µ–ª–∏)
7. Market Microstructure (Order Book)
8. Liquidity Zones

**–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ**: –ï—â–µ 1-2 –Ω–µ–¥–µ–ª–∏ —Ç–µ—Å—Ç–æ–≤.

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**: Win Rate 60-65%, —Ç–æ—á–Ω—ã–µ –≤—Ö–æ–¥—ã/–≤—ã—Ö–æ–¥—ã.

### **–≠–¢–ê–ü 3: –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π AI** (2-3 –º–µ—Å—è—Ü–∞)
9. Reinforcement Learning

**–ò–õ–ò –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –≠–¢–ê–ü–£ 4** (–µ—Å–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≠—Ç–∞–ø–∞ 1-2 —Ö–æ—Ä–æ—à–∏).

### **–≠–¢–ê–ü 4: –ì–∏–±—Ä–∏–¥–Ω—ã–π –±–æ—Ç** (3-4 –Ω–µ–¥–µ–ª–∏)
10. Grid Trading Engine
11. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Scalping
12. –û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä —Ä–µ–∂–∏–º–æ–≤

**–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ**: Production (—Ä–µ–∞–ª—å–Ω—ã–π —Å—á—ë—Ç —Å –º–∞–ª—ã–º–∏ —Å—É–º–º–∞–º–∏).

---

## üéØ –ú–û–Ø –ò–¢–û–ì–û–í–ê–Ø –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–Ø:

**–ü–õ–ê–ù –ê** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):
1. ‚úÖ –≠—Ç–∞–ø 1 (Phase 1 –º–æ–¥—É–ª–∏) - 6-7 –Ω–µ–¥–µ–ª—å
2. ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ - 2-3 –Ω–µ–¥–µ–ª–∏
3. ‚úÖ –≠—Ç–∞–ø 2 (Order Book, Liquidity) - 2-3 –Ω–µ–¥–µ–ª–∏
4. ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ - 1-2 –Ω–µ–¥–µ–ª–∏
5. ‚úÖ **–ï—Å–ª–∏ Win Rate >60%** ‚Üí –≠—Ç–∞–ø 4 (–ì–∏–±—Ä–∏–¥)
6. ‚è∏Ô∏è –≠—Ç–∞–ø 3 (RL) - –û–ü–¶–ò–û–ù–ê–õ–¨–ù–û, –≤ –±—É–¥—É—â–µ–º

**–ü–õ–ê–ù –ë** (–±—ã—Å—Ç—Ä—ã–π):
1. ‚úÖ –¢–æ–ª—å–∫–æ –¢–û–ü-3 –º–æ–¥—É–ª—è: MTF + Vol Modes + Correlation - 3 –Ω–µ–¥–µ–ª–∏
2. ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ - 2 –Ω–µ–¥–µ–ª–∏
3. ‚úÖ **–ï—Å–ª–∏ —Ö–æ—Ä–æ—à–æ** ‚Üí —Å—Ä–∞–∑—É –ì–∏–±—Ä–∏–¥ - 4 –Ω–µ–¥–µ–ª–∏
4. ‚è∏Ô∏è –û—Å—Ç–∞–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏ - –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

**–ü–æ—á–µ–º—É Plan –ê**:
- –ë–æ–ª–µ–µ —Å—Ç–∞–±–∏–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- –ö–∞–∂–¥—ã–π –º–æ–¥—É–ª—å –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω
- –ú–µ–Ω—å—à–µ —Ä–∏—Å–∫ "—Å–ª–æ–º–∞—Ç—å" —á—Ç–æ-—Ç–æ
- –õ—É—á—à–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞

---

**–í—Å–µ –º–æ–¥—É–ª–∏ –°–û–í–ú–ï–°–¢–ò–ú–´ —Å –ì–∏–±—Ä–∏–¥–æ–º!** –î–µ–ª–∞–µ–º Phase 1 ‚Üí –ø–æ–ª—É—á–∞–µ–º —É–ª—É—á—à–µ–Ω–Ω—ã–π Scalping ‚Üí –ª–µ–≥–∫–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ–º –≤ Hybrid! üöÄ

üìÇ **–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤**: `–î–ï–¢–ê–õ–¨–ù–û–ï_–û–ü–ò–°–ê–ù–ò–ï_–ú–û–î–£–õ–ï–ô.md` (—ç—Ç–æ —Ñ–∞–π–ª!)

