# ‚úÖ –≠–¢–ê–ü 2: –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø –ü–†–û–ö–°–ò –ò POSITIONMONITOR –ó–ê–í–ï–†–®–ï–ù–ê

**–î–∞—Ç–∞:** 25.11.2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü—Ä–æ–∫—Å–∏ –∏ PositionMonitor –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã

---

## ‚úÖ –í–´–ü–û–õ–ù–ï–ù–ù–´–ï –ó–ê–î–ê–ß–ò

### 1. ‚úÖ –°–æ–∑–¥–∞–Ω –ø—Ä–æ–∫—Å–∏ `active_positions` ‚Üí PositionRegistry

**–§–∞–π–ª:** `src/strategies/scalping/futures/orchestrator.py`

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- Property `active_positions` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ PositionRegistry
- –ú–µ—Ç–æ–¥ `get_all_positions_sync()` –¥–æ–±–∞–≤–ª–µ–Ω –≤ PositionRegistry
- –í—Å–µ —á—Ç–µ–Ω–∏—è `active_positions` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞—é—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ä–µ–µ—Å—Ç—Ä–∞
- –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ (66 –º–µ—Å—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å)

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã (PositionRegistry)
- ‚úÖ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å (—Å—Ç–∞—Ä—ã–π –∫–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç)
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è (–±–µ–∑ –ø–æ–ª–æ–º–æ–∫)

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:**
- –ü—Ä—è–º–æ–µ –ø—Ä–∏—Å–≤–∞–∏–≤–∞–Ω–∏–µ `self.active_positions = {}` –∑–∞–º–µ–Ω–µ–Ω–æ –Ω–∞ —Ä–∞–±–æ—Ç—É —Å —Ä–µ–µ—Å—Ç—Ä–æ–º
- –ó–∞–ø–∏—Å—å –ø–æ–∑–∏—Ü–∏–π —Ç–µ–ø–µ—Ä—å –∏–¥–µ—Ç —á–µ—Ä–µ–∑ `position_registry.register_position()`

---

### 2. ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω PositionMonitor –∫–∞–∫ —Ñ–æ–Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞

**–§–∞–π–ª:** `src/strategies/scalping/futures/orchestrator.py`

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- –ò–º–ø–æ—Ä—Ç `PositionMonitor` –¥–æ–±–∞–≤–ª–µ–Ω
- –°–æ–∑–¥–∞–Ω–∏–µ `PositionMonitor` –≤ `__init__()` –ø–æ—Å–ª–µ ExitAnalyzer
- –ó–∞–ø—É—Å–∫ `position_monitor.start()` –≤ `start()` –∫–∞–∫ —Ñ–æ–Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞
- –û—Å—Ç–∞–Ω–æ–≤–∫–∞ `position_monitor.stop()` –≤ `stop()`

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `check_interval=5.0` —Å–µ–∫—É–Ω–¥ (–ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥)
- `exit_analyzer` –ø–µ—Ä–µ–¥–∞–Ω –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø–æ–∑–∏—Ü–∏–π
- –†–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ü–∏–∫–ª–∞

**–õ–æ–≥–∏–∫–∞:**
```
PositionMonitor (—Ñ–æ–Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞)
  ‚îî‚îÄ‚îÄ –ö–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥:
      ‚îî‚îÄ‚îÄ –î–ª—è –∫–∞–∂–¥–æ–π –ø–æ–∑–∏—Ü–∏–∏ –≤ PositionRegistry:
          ‚îî‚îÄ‚îÄ –í—ã–∑—ã–≤–∞–µ—Ç ExitAnalyzer.analyze_position()
          ‚îî‚îÄ‚îÄ –í—ã–ø–æ–ª–Ω—è–µ—Ç —Ä–µ—à–µ–Ω–∏–µ (close, partial_close, extend_tp)
```

---

### 3. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –ø—Ä–∏—Å–≤–∞–∏–≤–∞–Ω–∏–µ `active_positions = {}`

**–§–∞–π–ª:** `src/strategies/scalping/futures/orchestrator.py` (—Å—Ç—Ä–æ–∫–∞ 1571)

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –£–±—Ä–∞–Ω–æ –ø—Ä—è–º–æ–µ –ø—Ä–∏—Å–≤–∞–∏–≤–∞–Ω–∏–µ `self.active_positions = {}`
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –ø–æ–∑–∏—Ü–∏–π –∏–∑ PositionRegistry
- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤—ã—Ö –ø–æ–∑–∏—Ü–∏–π —á–µ—Ä–µ–∑ `register_position()`

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –í—Å–µ –ø–æ–∑–∏—Ü–∏–∏ —Ç–µ–ø–µ—Ä—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ PositionRegistry
- –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
- –ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## üìã –†–ï–ó–£–õ–¨–¢–ê–¢

‚úÖ **–ü—Ä–æ–∫—Å–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- `active_positions` ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ PositionRegistry
- –í—Å–µ —á—Ç–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞—é—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞

‚úÖ **PositionMonitor —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∫ —Ñ–æ–Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞
- –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Å–µ –ø–æ–∑–∏—Ü–∏–∏
- –í—ã–∑—ã–≤–∞–µ—Ç ExitAnalyzer –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞

‚úÖ **–ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã:**
- –í—Å–µ –ø–æ–∑–∏—Ü–∏–∏ –≤ PositionRegistry
- –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –±–∏—Ä–∂–µ–π —á–µ—Ä–µ–∑ —Ä–µ–µ—Å—Ç—Ä

---

## üéØ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

**–≠–¢–ê–ü 3:** –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è EntryManager –≤ signal_coordinator  
**–≠–¢–ê–ü 4:** –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è SignalPipeline  
**–≠–¢–ê–ü 5:** –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è TradingControlCenter  
**–≠–¢–ê–ü 6:** –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ DataRegistry  

---

**–ü—Ä–æ–∫—Å–∏ –∏ PositionMonitor —É—Å–ø–µ—à–Ω–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã! ‚úÖ**






