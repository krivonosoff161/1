# ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –ó–ê–í–ï–†–®–ï–ù–´ - 7 —è–Ω–≤–∞—Ä—è 2026

## –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 1. ‚úÖ NoneType.__format__ Error (–ö–†–ò–¢–ò–ß–ù–û)

**–ü—Ä–æ–±–ª–µ–º–∞:**
```
ParameterProvider: Error applying adaptive params for ETH-USDT:
unsupported format string passed to NoneType.__format__
```

**–ü—Ä–∏—á–∏–Ω–∞:** –ü—Ä–∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ `f"–±–∞–ª–∞–Ω—Å=${balance:.0f}"` –µ—Å–ª–∏ `balance=None`, Python –≤—ã–¥–∞—ë—Ç –æ—à–∏–±–∫—É.

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞—â–∏—Ç–∞ –æ—Ç None –ø–µ—Ä–µ–¥ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º:

```python
# ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï (07.01.2026): –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞—â–∏—Ç–∞ –æ—Ç NoneType –ø—Ä–∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
balance_str = f"${balance:.0f}" if balance is not None else "N/A"
pnl_str = f"{current_pnl:.1f}%" if current_pnl is not None else "N/A"
drawdown_str = f"{drawdown:.1f}%" if drawdown is not None else "N/A"

logger.info(
    f"üéØ [ADAPTIVE] {symbol} ({regime}): –§–∏–Ω–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ‚Üí "
    f"TP: {adaptive_params['tp_atr_multiplier']:.2f}, "
    f"SL: {adaptive_params['sl_atr_multiplier']:.2f} | "
    f"–ö–æ–Ω—Ç–µ–∫—Å—Ç: –±–∞–ª–∞–Ω—Å={balance_str}, P&L={pnl_str}, –ø—Ä–æ—Å–∞–¥–∫–∞={drawdown_str}"
)
```

**–§–∞–π–ª:** `src/strategies/scalping/futures/config/parameter_provider.py` (—Å—Ç—Ä–æ–∫–∞ ~1095)

---

### 2. ‚úÖ Margin Ratio = 0.10 (–ö–†–ò–¢–ò–ß–ù–û)

**–ü—Ä–æ–±–ª–µ–º–∞:** –í –ª–æ–≥–∞—Ö –ø–æ–∫–∞–∑—ã–≤–∞–ª–æ:
```
[MARGIN_RATIO] safe=False | margin_ratio=0.10 [CRITICAL] (threshold=1.80)
```

**–ü—Ä–∏—á–∏–Ω–∞:** –î–ª—è —Ä–∞—Å—á—ë—Ç–∞ margin_ratio –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è **equity –ø–æ–∑–∏—Ü–∏–∏** (~$42) –≤–º–µ—Å—Ç–æ **–æ–±—â–µ–≥–æ –±–∞–ª–∞–Ω—Å–∞ —Å—á—ë—Ç–∞** ($665).

**–§–æ—Ä–º—É–ª–∞ margin_ratio:**
```
margin_ratio = equity / margin_used
```

**–ß—Ç–æ –±—ã–ª–æ:**
- `equity = position_equity = $42.79` (–º–∞—Ä–∂–∞ –¢–û–õ–¨–ö–û —ç—Ç–æ–π –ø–æ–∑–∏—Ü–∏–∏)
- `margin_used = $42.79` (–Ω—É–∂–Ω–∞—è –º–∞—Ä–∂–∞)
- `margin_ratio = 42.79 / 42.79 = 1.0` ‚ùå –ù–û –±–æ—Ç –≤–∏–¥–µ–ª 0.10!

**–ß—Ç–æ —Å—Ç–∞–ª–æ:**
- `equity = total_balance = $665.22` (–≤–µ—Å—å USDT –±–∞–ª–∞–Ω—Å)
- `margin_used = $42.79`
- `margin_ratio = 665.22 / 42.79 = 15.5` ‚úÖ (–ë–ï–ó–û–ü–ê–°–ù–û!)

**–†–µ—à–µ–Ω–∏–µ:** –ó–∞–º–µ–Ω–∏–ª–∏ —Å–ª–æ–∂–Ω—ã–π fallback-–∫–æ–¥ –Ω–∞ –ø—Ä–æ—Å—Ç–æ–π:

```python
# ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û (07.01.2026): –î–ª—è margin_ratio –í–°–ï–ì–î–ê –∏—Å–ø–æ–ª—å–∑—É–µ–º –û–ë–©–ò–ô –±–∞–ª–∞–Ω—Å —Å—á—ë—Ç–∞!
try:
    equity = await self.client.get_balance()
    logger.debug(f"üí∞ –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—â–∏–π –±–∞–ª–∞–Ω—Å –¥–ª—è margin_ratio –ø—Ä–æ–≤–µ—Ä–∫–∏ {symbol}: ${equity:.2f}")
except Exception as e:
    equity = 1000.0  # Fallback –∑–Ω–∞—á–µ–Ω–∏–µ
    logger.warning(f"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –æ–±—â–∏–π –±–∞–ª–∞–Ω—Å –¥–ª—è {symbol}: {e}")
```

**–§–∞–π–ª:** `src/strategies/scalping/futures/position_manager.py` (—Å—Ç—Ä–æ–∫–∞ ~895)

**–£–¥–∞–ª–µ–Ω–æ:** ~150 —Å—Ç—Ä–æ–∫ fallback-–∫–æ–¥–∞

---

## –°—Ç–∞—Ç—É—Å

| –ü—Ä–æ–±–ª–µ–º–∞ | –î–æ | –ü–æ—Å–ª–µ | –°—Ç–∞—Ç—É—Å |
|----------|-----|-------|--------|
| NoneType error | üî¥ –ë–ª–æ–∫–∏—Ä—É–µ—Ç TP/SL | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ | **–ì–û–¢–û–í–û** |
| Margin ratio 0.10 | üî¥ –†–∏—Å–∫ –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏ | ‚úÖ –î–æ–ª–∂–Ω–æ –±—ã—Ç—å >10 | **–ì–û–¢–û–í–û** |
| REST API blocked | ‚ùì –î—É–º–∞–ª–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | **–ù–ï –ü–†–û–ë–õ–ï–ú–ê** |

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è!
