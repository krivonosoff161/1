# ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø: –ú–∞–ª–µ–Ω—å–∫–∞—è –ø—Ä–∏–±—ã–ª—å –ø—Ä–∏ –±—ã—Å—Ç—Ä–æ–º –∑–∞–∫—Ä—ã—Ç–∏–∏

**–î–∞—Ç–∞:** 2025-12-07  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–°–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –ü–†–ò–ú–ï–ù–ï–ù–´

---

## üìã –ü–†–ò–ú–ï–ù–ï–ù–ù–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### 1Ô∏è‚É£ CONFIG_FUTURES.YAML

#### ‚úÖ Partial TP trigger_percent —É–≤–µ–ª–∏—á–µ–Ω:

**–ë—ã–ª–æ:**
```yaml
partial_tp:
  trigger_percent: 0.4  # –ë–∞–∑–æ–≤—ã–π
  by_regime:
    trending:
      trigger_percent: 0.4  # 17% –æ—Ç TP (2.4%)
    ranging:
      trigger_percent: 0.3  # 12% –æ—Ç TP (2.4%)
    choppy:
      trigger_percent: 0.2  # 8% –æ—Ç TP (2.4%)
```

**–°—Ç–∞–ª–æ:**
```yaml
partial_tp:
  trigger_percent: 1.0  # ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 0.4% –¥–æ 1.0%
  by_regime:
    trending:
      trigger_percent: 1.2  # ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 0.4% –¥–æ 1.2% (50% –æ—Ç TP 2.4%)
    ranging:
      trigger_percent: 1.0  # ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 0.3% –¥–æ 1.0% (42% –æ—Ç TP 2.4%)
    choppy:
      trigger_percent: 0.8  # ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 0.2% –¥–æ 0.8% (33% –æ—Ç TP 2.4%)
```

**–≠—Ñ—Ñ–µ–∫—Ç:**
- Partial TP —Ç–µ–ø–µ—Ä—å —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä–∏ **33-50% –æ—Ç TP** –≤–º–µ—Å—Ç–æ **8-17%**
- –ü–æ–∑–∏—Ü–∏–∏ –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è —á–∞—Å—Ç–∏—á–Ω–æ –±–ª–∏–∂–µ –∫ –ø–æ–ª–Ω–æ–º—É TP
- –°—Ä–µ–¥–Ω—è—è –ø—Ä–∏–±—ã–ª—å —É–≤–µ–ª–∏—á–∏—Ç—Å—è —Å 0.2-0.4% –¥–æ 1.2-2.5%

---

#### ‚úÖ big_profit_exit_percent —É–≤–µ–ª–∏—á–µ–Ω:

**–ë—ã–ª–æ:**
```yaml
big_profit_exit_percent_majors: 1.5  # 62% –æ—Ç TP (2.4%)
big_profit_exit_percent_alts: 2.0    # 83% –æ—Ç TP (2.4%)
```

**–°—Ç–∞–ª–æ:**
```yaml
big_profit_exit_percent_majors: 2.5  # ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 1.5% –¥–æ 2.5% (104% –æ—Ç TP 2.4%)
big_profit_exit_percent_alts: 3.0    # ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 2.0% –¥–æ 3.0% (125% –æ—Ç TP 2.4%)
```

**–≠—Ñ—Ñ–µ–∫—Ç:**
- Profit Harvesting —Ç–µ–ø–µ—Ä—å –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –ø—Ä–∏ **104-125% –æ—Ç TP** –≤–º–µ—Å—Ç–æ **62-83%**
- –ü–æ–∑–∏—Ü–∏–∏ –¥–µ—Ä–∂–∞—Ç—Å—è –¥–æ–ª—å—à–µ –∏ –¥–æ—Å—Ç–∏–≥–∞—é—Ç –ø–æ–ª–Ω–æ–≥–æ TP
- –°—Ä–µ–¥–Ω—è—è –ø—Ä–∏–±—ã–ª—å —É–≤–µ–ª–∏—á–∏—Ç—Å—è

---

#### ‚úÖ profit_drawdown.drawdown_percent —É–≤–µ–ª–∏—á–µ–Ω:

**–ë—ã–ª–æ:**
```yaml
profit_drawdown:
  drawdown_percent: 0.20  # 20% –æ—Ç–∫–∞—Ç
  by_regime:
    trending:
      multiplier: 2.0  # 40% –æ—Ç–∫–∞—Ç (0.20 * 2.0)
    ranging:
      multiplier: 1.5  # 30% –æ—Ç–∫–∞—Ç (0.20 * 1.5)
    choppy:
      multiplier: 1.0  # 20% –æ—Ç–∫–∞—Ç (0.20 * 1.0)
```

**–°—Ç–∞–ª–æ:**
```yaml
profit_drawdown:
  drawdown_percent: 0.35  # ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 0.20 –¥–æ 0.35 (35% –æ—Ç–∫–∞—Ç)
  by_regime:
    trending:
      multiplier: 2.0  # 70% –æ—Ç–∫–∞—Ç (0.35 * 2.0) - –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è —Ç—Ä–µ–Ω–¥–∞
    ranging:
      multiplier: 1.5  # 52.5% –æ—Ç–∫–∞—Ç (0.35 * 1.5) - –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
    choppy:
      multiplier: 1.0  # 35% –æ—Ç–∫–∞—Ç (0.35 * 1.0) - –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è —Ñ–∏–∫—Å–∞—Ü–∏–∏ –ø—Ä–∏–±—ã–ª–∏
```

**–≠—Ñ—Ñ–µ–∫—Ç:**
- Profit Drawdown —Ç–µ–ø–µ—Ä—å –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –ø—Ä–∏ **35-70% –æ—Ç–∫–∞—Ç–µ** –≤–º–µ—Å—Ç–æ **20-40%**
- –ü–æ–∑–∏—Ü–∏–∏ –ø–æ–ª—É—á–∞—é—Ç –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –¥–æ TP
- –ú–µ–Ω—å—à–µ –ø—Ä–µ–∂–¥–µ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–∫—Ä—ã—Ç–∏–π –ø—Ä–∏ –º–∞–ª—ã—Ö –æ—Ç–∫–∞—Ç–∞—Ö

---

### 2Ô∏è‚É£ POSITION_MANAGER.PY

#### ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞: Partial TP —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø—Ä–∏–±—ã–ª—å >= 50% –æ—Ç TP

**–ö–æ–¥ (—Å—Ç—Ä–æ–∫–∏ 2959-2970):**
```python
# ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: Partial TP —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø—Ä–∏–±—ã–ª—å >= 50% –æ—Ç TP
# –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ —á–∞—Å—Ç–∏—á–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –±–ª–∏–∂–µ –∫ –ø–æ–ª–Ω–æ–º—É TP
# –ü–æ–ª—É—á–∞–µ–º –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π TP –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ (–∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ—Ç –∂–µ –º–µ—Ç–æ–¥, —á—Ç–æ –∏ –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ TP)
tp_percent_for_check = self._get_adaptive_tp_percent(symbol, current_regime, current_price)
min_profit_for_partial_tp = tp_percent_for_check * 0.5  # 50% –æ—Ç TP

if (
    ptp_enabled
    and not partial_done
    and size > 0
    and pnl_percent > 0
    and pnl_percent >= ptp_trigger
    and pnl_percent >= min_profit_for_partial_tp  # ‚úÖ –ù–û–í–û–ï: –ü—Ä–æ–≤–µ—Ä–∫–∞ 50% –æ—Ç TP
):
```

**–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (—Å—Ç—Ä–æ–∫–∏ 2936-2939):**
```python
# ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ü–æ–ª—É—á–∞–µ–º –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π TP –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ 50% –æ—Ç TP
tp_percent_for_check = self._get_adaptive_tp_percent(symbol, current_regime, current_price)
min_profit_for_partial_tp = tp_percent_for_check * 0.5  # 50% –æ—Ç TP

logger.debug(
    f"üìä Partial TP –¥–ª—è {symbol}: —Ä–µ–∂–∏–º={current_regime}, "
    f"fraction={ptp_fraction:.1%}, trigger={ptp_trigger:.2f}%, "
    f"TP={tp_percent_for_check:.2f}%, min_profit_for_partial={min_profit_for_partial_tp:.2f}% (50% –æ—Ç TP)"
)
```

**–≠—Ñ—Ñ–µ–∫—Ç:**
- –ï—Å–ª–∏ TP = 2.4%, —Ç–æ Partial TP —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø—Ä–∏–±—ã–ª–∏ >= 1.2% (50% –æ—Ç TP)
- –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ —á–∞—Å—Ç–∏—á–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –±–ª–∏–∂–µ –∫ –ø–æ–ª–Ω–æ–º—É TP
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–µ–∂–¥–µ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏ –º–∞–ª–æ–π –ø—Ä–∏–±—ã–ª–∏ (0.2-0.4%)

---

## üìä –û–ñ–ò–î–ê–ï–ú–´–ô –≠–§–§–ï–ö–¢

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
- **–°—Ä–µ–¥–Ω—è—è –ø—Ä–∏–±—ã–ª—å:** 0.2-0.4%
- **Partial TP —Å—Ä–∞–±–∞—Ç—ã–≤–∞–ª:** –ø—Ä–∏ 8-17% –æ—Ç TP
- **Profit Harvesting –∑–∞–∫—Ä—ã–≤–∞–ª:** –ø—Ä–∏ 62-83% –æ—Ç TP
- **Profit Drawdown –∑–∞–∫—Ä—ã–≤–∞–ª:** –ø—Ä–∏ 20% –æ—Ç–∫–∞—Ç–µ
- **–ö–æ–º–∏—Å—Å–∏—è —Å—ä–µ–¥–∞–ª–∞ –ø—Ä–∏–±—ã–ª—å:** commission > gross_pnl

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
- **–°—Ä–µ–¥–Ω—è—è –ø—Ä–∏–±—ã–ª—å:** 1.2-2.5% ‚úÖ
- **Partial TP —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç:** –ø—Ä–∏ 33-50% –æ—Ç TP ‚úÖ
- **Profit Harvesting –∑–∞–∫—Ä—ã–≤–∞–µ—Ç:** –ø—Ä–∏ 104-125% –æ—Ç TP ‚úÖ
- **Profit Drawdown –∑–∞–∫—Ä—ã–≤–∞–µ—Ç:** –ø—Ä–∏ 35-70% –æ—Ç–∫–∞—Ç–µ ‚úÖ
- **–ö–æ–º–∏—Å—Å–∏—è –Ω–µ —Å—ä–µ–¥–∞–µ—Ç –ø—Ä–∏–±—ã–ª—å:** gross_pnl > commission ‚úÖ

---

## ‚úÖ –°–¢–ê–¢–£–° –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô

| –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ | –°—Ç–∞—Ç—É—Å | –§–∞–π–ª |
|-------------|--------|------|
| Partial TP trigger_percent —É–≤–µ–ª–∏—á–µ–Ω | ‚úÖ –ü—Ä–∏–º–µ–Ω–µ–Ω–æ | `config_futures.yaml` |
| big_profit_exit_percent —É–≤–µ–ª–∏—á–µ–Ω | ‚úÖ –ü—Ä–∏–º–µ–Ω–µ–Ω–æ | `config_futures.yaml` |
| drawdown_percent —É–≤–µ–ª–∏—á–µ–Ω | ‚úÖ –ü—Ä–∏–º–µ–Ω–µ–Ω–æ | `config_futures.yaml` |
| –ü—Ä–æ–≤–µ—Ä–∫–∞ 50% –æ—Ç TP –¥–ª—è Partial TP | ‚úÖ –ü—Ä–∏–º–µ–Ω–µ–Ω–æ | `position_manager.py` |

---

## üöÄ –ì–û–¢–û–í–û –ö –ü–ï–†–ï–ó–ê–ü–£–°–ö–£

–í—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã. –ë–æ—Ç –≥–æ—Ç–æ–≤ –∫ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫—É –¥–ª—è —Å–±–æ—Ä–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Å –Ω–æ–≤—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏.

**–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:**
1. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
2. –°–æ–±—Ä–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∑–∞ 24 —á–∞—Å–∞
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `trades.csv` –Ω–∞ —É–ª—É—á—à–µ–Ω–∏–µ Net PnL
4. –°—Ä–∞–≤–Ω–∏—Ç—å —Å—Ä–µ–¥–Ω—é—é –ø—Ä–∏–±—ã–ª—å –¥–æ/–ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

---

**–ì–æ—Ç–æ–≤–æ!** ‚úÖ

