# üß† –ê–Ω–∞–ª–∏–∑ "—É–º–Ω—ã—Ö" —Ä–µ—à–µ–Ω–∏–π –±–æ—Ç–∞ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –ø–æ–∑–∏—Ü–∏–π (29.11.2025)

## üìä –¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã –∑–∞–∫—Ä—ã—Ç–∏—è

### ‚úÖ –ß—Ç–æ –±–æ—Ç –£–ñ–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π:

#### 1. **–î–∞–Ω–Ω—ã–µ —Å –±–∏—Ä–∂–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏**
- ‚úÖ `markPx` - —Ç–µ–∫—É—â–∞—è —Ü–µ–Ω–∞ –ø–æ–∑–∏—Ü–∏–∏ (–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ WebSocket)
- ‚úÖ `get_price_limits()` - –∞–∫—Ç—É–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ –∏–∑ —Å—Ç–∞–∫–∞–Ω–∞ (best_bid, best_ask, current_price)
- ‚úÖ `get_instrument_details()` - –¥–µ—Ç–∞–ª–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ (ctVal, —Ä–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏)
- ‚úÖ –î–∞–Ω–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏: `entry_price`, `current_price`, `size`, `side`

**–ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:**
- `manage_position()` - –ø–æ–ª—É—á–∞–µ—Ç `current_price = markPx` (—Å—Ç—Ä–æ–∫–∞ 424)
- `_check_profit_drawdown()` - –ø–æ–ª—É—á–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—É—é —Ü–µ–Ω—É –∏–∑ —Å—Ç–∞–∫–∞–Ω–∞ (—Å—Ç—Ä–æ–∫–∞ 3687)
- `_check_profit_harvesting()` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `current_price` –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ PnL (—Å—Ç—Ä–æ–∫–∞ 1252)
- `_check_tp_only()` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `current_price` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ TP (—Å—Ç—Ä–æ–∫–∞ 1629)

#### 2. **–ê–Ω–∞–ª–∏–∑ —Ä–µ–∂–∏–º–∞ —Ä—ã–Ω–∫–∞ (ADX, —Ç—Ä–µ–Ω–¥)**
- ‚úÖ `regime_manager` - –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä–µ–∂–∏–º —Ä—ã–Ω–∫–∞ (trending/ranging/choppy)
- ‚úÖ –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ —Ä–µ–∂–∏–º—É:
  - `ph_threshold` - —Ä–∞–∑–Ω—ã–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ–∂–∏–º–∞
  - `ph_time_limit` - —Ä–∞–∑–Ω—ã–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ–∂–∏–º–∞
  - `drawdown_threshold` - —Ä–∞–∑–Ω—ã–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ–∂–∏–º–∞
  - `max_holding_minutes` - —Ä–∞–∑–Ω—ã–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ–∂–∏–º–∞

**–ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:**
- `_check_profit_harvesting()` - –ø–æ–ª—É—á–∞–µ—Ç —Ä–µ–∂–∏–º –∏ –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (—Å—Ç—Ä–æ–∫–∞ 1274-1331)
- `_check_profit_drawdown()` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–µ–∂–∏–º –¥–ª—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–≥–æ –ø–æ—Ä–æ–≥–∞ (—Å—Ç—Ä–æ–∫–∞ 3772-3795)
- `_check_max_holding()` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–µ–∂–∏–º –¥–ª—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ (—Å—Ç—Ä–æ–∫–∞ 3888-3920)

#### 3. **–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã (—á–∞—Å—Ç–∏—á–Ω–æ)**
- ‚úÖ ATR (Average True Range) - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–≥–æ TP (—Å—Ç—Ä–æ–∫–∞ 248-260)
- ‚úÖ Trailing Stop Loss - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –¥–≤–∏–∂–µ–Ω–∏–µ —Ü–µ–Ω—ã –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

**–ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:**
- `_get_adaptive_tp_percent()` - –ø—ã—Ç–∞–µ—Ç—Å—è –ø–æ–ª—É—á–∏—Ç—å ATR –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ TP (—Å—Ç—Ä–æ–∫–∞ 248)
- `TrailingStopLoss.update()` - –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ü–µ–Ω—ã

#### 4. **–ê–Ω–∞–ª–∏–∑ PnL –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏**
- ‚úÖ –†–∞—Å—á–µ—Ç —Ç–µ–∫—É—â–µ–≥–æ PnL —Å —É—á–µ—Ç–æ–º –∫–æ–º–∏—Å—Å–∏–π
- ‚úÖ –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø–∏–∫–æ–≤–æ–π –ø—Ä–∏–±—ã–ª–∏ (`peak_profit_usd`)
- ‚úÖ –†–∞—Å—á–µ—Ç –æ—Ç–∫–∞—Ç–∞ –æ—Ç –º–∞–∫—Å–∏–º—É–º–∞

**–ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:**
- `_update_peak_profit()` - –æ–±–Ω–æ–≤–ª—è–µ—Ç –ø–∏–∫–æ–≤—É—é –ø—Ä–∏–±—ã–ª—å (—Å—Ç—Ä–æ–∫–∞ 3547)
- `_check_profit_drawdown()` - —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –æ—Ç–∫–∞—Ç –æ—Ç –ø–∏–∫–∞ (—Å—Ç—Ä–æ–∫–∞ 3663)
- `_check_profit_harvesting()` - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –±—ã—Å—Ç—Ä—É—é –ø—Ä–∏–±—ã–ª—å (—Å—Ç—Ä–æ–∫–∞ 1229)

---

## ‚ùå –ß—Ç–æ –±–æ—Ç –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç (–Ω–æ –º–æ–≥ –±—ã):

### 1. **–ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏**
- ‚ùå RSI - –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏
- ‚ùå MACD - –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏
- ‚ùå Bollinger Bands - –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏
- ‚ùå Moving Averages - –Ω–µ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏
- ‚ùå ADX - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞, –Ω–µ –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è

**–ü—Ä–æ–±–ª–µ–º–∞:** –ë–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã —Ç–æ–ª—å–∫–æ –¥–ª—è **–æ—Ç–∫—Ä—ã—Ç–∏—è** –ø–æ–∑–∏—Ü–∏–π, –Ω–æ –Ω–µ –¥–ª—è **–∑–∞–∫—Ä—ã—Ç–∏—è**.

### 2. **–ê–Ω–∞–ª–∏–∑ –≥—Ä–∞—Ñ–∏–∫–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏**
- ‚ùå –ù–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–∞–∑–≤–æ—Ä–æ—Ç —Ç—Ä–µ–Ω–¥–∞ –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º
- ‚ùå –ù–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–µ—Ä–µ–∫—É–ø–ª–µ–Ω–Ω–æ—Å—Ç—å/–ø–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω–Ω–æ—Å—Ç—å
- ‚ùå –ù–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–æ–±–æ–π —É—Ä–æ–≤–Ω–µ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏/—Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏—è

### 3. **–ú—É–ª—å—Ç–∏—Ç–∞–π–º—Ñ—Ä–µ–π–º –∞–Ω–∞–ª–∏–∑ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏**
- ‚ùå –ù–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ä—à–∏–µ —Ç–∞–π–º—Ñ—Ä–µ–π–º—ã –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º
- ‚ùå –ù–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç —Å–∏–≥–Ω–∞–ª–æ–≤ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —Ç–∞–π–º—Ñ—Ä–µ–π–º–∞—Ö

---

## üí° –ü–æ—á–µ–º—É —Ç–µ–∫—É—â–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –¥–ª—è —Å–∫–∞–ª—å–ø–∏–Ω–≥–∞

### ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–¥—Ö–æ–¥–∞:

1. **–°–∫–æ—Ä–æ—Å—Ç—å –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π:**
   - –°–∫–∞–ª—å–ø–∏–Ω–≥ —Ç—Ä–µ–±—É–µ—Ç –±—ã—Å—Ç—Ä—ã—Ö —Ä–µ—à–µ–Ω–∏–π
   - –ê–Ω–∞–ª–∏–∑ –≤—Å–µ—Ö –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ –∑–∞–Ω–∏–º–∞–µ—Ç –≤—Ä–µ–º—è
   - –¢–µ–∫—É—â–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ü–µ–Ω—ã

2. **–ó–∞—â–∏—Ç–∞ –æ—Ç –ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏—è:**
   - –ë—ã—Å—Ç—Ä–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –ø–æ—Ä–æ–≥–æ–≤
   - –ù–µ –∂–¥–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤
   - –ú–∏–Ω–∏–º–∏–∑–∏—Ä—É–µ—Ç –ø–æ—Ç–µ—Ä–∏ –ø—Ä–∏ —Ä–∞–∑–≤–æ—Ä–æ—Ç–∞—Ö

3. **–ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å:**
   - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∞–¥–∞–ø—Ç–∏—Ä—É—é—Ç—Å—è –ø–æ–¥ —Ä–µ–∂–∏–º —Ä—ã–Ω–∫–∞
   - –†–∞–∑–Ω—ã–µ –ø–æ—Ä–æ–≥–∏ –¥–ª—è trending/ranging/choppy
   - –£—á–∏—Ç—ã–≤–∞–µ—Ç –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ ATR

4. **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:**
   - –ü—Ä–æ—Å—Ç—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –ª–µ–≥—á–µ –æ—Ç–ª–∞–¥–∏—Ç—å
   - –ú–µ–Ω—å—à–µ —Ç–æ—á–µ–∫ –æ—Ç–∫–∞–∑–∞
   - –ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

---

## üéØ –ö–∞–∫ —Å–¥–µ–ª–∞—Ç—å –±–æ—Ç–∞ "—É–º–Ω–µ–µ" (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

### –í–∞—Ä–∏–∞–Ω—Ç 1: **–ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

**–ò–¥–µ—è:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –∫–∞–∫ **—Ñ–∏–ª—å—Ç—Ä**, –∞ –Ω–µ –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π —Ç—Ä–∏–≥–≥–µ—Ä.

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```python
async def _check_profit_harvesting(self, position: Dict[str, Any]) -> bool:
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ PH ...
    
    if should_close:
        # ‚úÖ –ù–û–í–û–ï: –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º
        # –ï—Å–ª–∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —Ç—Ä–µ–Ω–¥–∞ - –ù–ï –∑–∞–∫—Ä—ã–≤–∞–µ–º
        try:
            if hasattr(self, "orchestrator") and self.orchestrator:
                if hasattr(self.orchestrator, "data_registry"):
                    data_registry = self.orchestrator.data_registry
                    market_data = await data_registry.get_market_data(symbol)
                    
                    if market_data and market_data.indicators:
                        # –ü—Ä–æ–≤–µ—Ä—è–µ–º RSI
                        rsi = market_data.indicators.get("RSI")
                        if rsi:
                            if side == "long" and rsi < 70:
                                # LONG –ø–æ–∑–∏—Ü–∏—è, RSI –Ω–µ –ø–µ—Ä–µ–∫—É–ø–ª–µ–Ω - —Ç—Ä–µ–Ω–¥ –º–æ–∂–µ—Ç –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å—Å—è
                                logger.debug(
                                    f"üìä PH –¥–ª—è {symbol}: RSI={rsi:.1f} –Ω–µ –ø–µ—Ä–µ–∫—É–ø–ª–µ–Ω, "
                                    f"—Ç—Ä–µ–Ω–¥ –º–æ–∂–µ—Ç –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å—Å—è - –ù–ï –∑–∞–∫—Ä—ã–≤–∞–µ–º"
                                )
                                return False
                            elif side == "short" and rsi > 30:
                                # SHORT –ø–æ–∑–∏—Ü–∏—è, RSI –Ω–µ –ø–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω - —Ç—Ä–µ–Ω–¥ –º–æ–∂–µ—Ç –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å—Å—è
                                logger.debug(
                                    f"üìä PH –¥–ª—è {symbol}: RSI={rsi:.1f} –Ω–µ –ø–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω, "
                                    f"—Ç—Ä–µ–Ω–¥ –º–æ–∂–µ—Ç –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å—Å—è - –ù–ï –∑–∞–∫—Ä—ã–≤–∞–µ–º"
                                )
                                return False
                        
                        # –ü—Ä–æ–≤–µ—Ä—è–µ–º MACD
                        macd = market_data.indicators.get("MACD")
                        if macd:
                            macd_line = macd.get("macd", 0)
                            signal_line = macd.get("signal", 0)
                            
                            if side == "long" and macd_line > signal_line:
                                # LONG –ø–æ–∑–∏—Ü–∏—è, MACD –±—ã—á–∏–π - —Ç—Ä–µ–Ω–¥ –º–æ–∂–µ—Ç –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å—Å—è
                                logger.debug(
                                    f"üìä PH –¥–ª—è {symbol}: MACD –±—ã—á–∏–π (macd={macd_line:.4f} > signal={signal_line:.4f}), "
                                    f"—Ç—Ä–µ–Ω–¥ –º–æ–∂–µ—Ç –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å—Å—è - –ù–ï –∑–∞–∫—Ä—ã–≤–∞–µ–º"
                                )
                                return False
                            elif side == "short" and macd_line < signal_line:
                                # SHORT –ø–æ–∑–∏—Ü–∏—è, MACD –º–µ–¥–≤–µ–∂–∏–π - —Ç—Ä–µ–Ω–¥ –º–æ–∂–µ—Ç –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å—Å—è
                                logger.debug(
                                    f"üìä PH –¥–ª—è {symbol}: MACD –º–µ–¥–≤–µ–∂–∏–π (macd={macd_line:.4f} < signal={signal_line:.4f}), "
                                    f"—Ç—Ä–µ–Ω–¥ –º–æ–∂–µ—Ç –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å—Å—è - –ù–ï –∑–∞–∫—Ä—ã–≤–∞–µ–º"
                                )
                                return False
        except Exception as e:
            logger.debug(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ –¥–ª—è PH {symbol}: {e}, –∑–∞–∫—Ä—ã–≤–∞–µ–º –ø–æ PH")
        
        # –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç - –∑–∞–∫—Ä—ã–≤–∞–µ–º
        return True
    
    return False
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–∫–æ—Ä–æ—Å—Ç—å –∑–∞–∫—Ä—ã—Ç–∏—è
- ‚úÖ –î–æ–±–∞–≤–ª—è–µ—Ç "—É–º–Ω—ã–π" —Ñ–∏–ª—å—Ç—Ä
- ‚úÖ –ù–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏ —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–æ–π –ø—Ä–∏–±—ã–ª–∏

---

### –í–∞—Ä–∏–∞–Ω—Ç 2: **–£–º–Ω—ã–π Profit Drawdown**

**–ò–¥–µ—è:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –æ—Ç–∫–∞—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–º –∏–ª–∏ —Ä–∞–∑–≤–æ—Ä–æ—Ç–æ–º.

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```python
async def _check_profit_drawdown(self, position: Dict[str, Any]) -> bool:
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—Ç–∫–∞—Ç–∞ ...
    
    if drawdown_percent >= drawdown_threshold:
        # ‚úÖ –ù–û–í–û–ï: –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º
        # –ï—Å–ª–∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —Ç—Ä–µ–Ω–¥–∞ - –ù–ï –∑–∞–∫—Ä—ã–≤–∞–µ–º
        try:
            if hasattr(self, "orchestrator") and self.orchestrator:
                if hasattr(self.orchestrator, "data_registry"):
                    data_registry = self.orchestrator.data_registry
                    market_data = await data_registry.get_market_data(symbol)
                    
                    if market_data and market_data.indicators:
                        # –ü—Ä–æ–≤–µ—Ä—è–µ–º ADX - –µ—Å–ª–∏ —Ç—Ä–µ–Ω–¥ —Å–∏–ª—å–Ω—ã–π, –æ—Ç–∫–∞—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–º
                        adx_data = self.adx_filter.check_trend_strength(
                            symbol, OrderSide.BUY if side == "long" else OrderSide.SELL,
                            market_data.ohlcv_data
                        )
                        
                        if adx_data.adx_value >= self.adx_filter.config.adx_threshold:
                            # –°–∏–ª—å–Ω—ã–π —Ç—Ä–µ–Ω–¥ - –æ—Ç–∫–∞—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–º
                            logger.debug(
                                f"üìä Profit Drawdown –¥–ª—è {symbol}: –°–∏–ª—å–Ω—ã–π —Ç—Ä–µ–Ω–¥ (ADX={adx_data.adx_value:.1f}), "
                                f"–æ—Ç–∫–∞—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–º - –ù–ï –∑–∞–∫—Ä—ã–≤–∞–µ–º"
                            )
                            return False
        except Exception as e:
            logger.debug(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ –¥–ª—è Profit Drawdown {symbol}: {e}, –∑–∞–∫—Ä—ã–≤–∞–µ–º –ø–æ –æ—Ç–∫–∞—Ç—É")
        
        # –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç - –∑–∞–∫—Ä—ã–≤–∞–µ–º
        return True
    
    return False
```

---

### –í–∞—Ä–∏–∞–Ω—Ç 3: **–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –ø–æ—Ä–æ–≥–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤**

**–ò–¥–µ—è:** –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∏–∑–º–µ–Ω—è—Ç—å –ø–æ—Ä–æ–≥–∏ PH –∏ Drawdown –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤.

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```python
async def _check_profit_harvesting(self, position: Dict[str, Any]) -> bool:
    # ... –ø–æ–ª—É—á–µ–Ω–∏–µ –±–∞–∑–æ–≤—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ PH ...
    
    # ‚úÖ –ù–û–í–û–ï: –ê–¥–∞–ø—Ç–∏—Ä—É–µ–º –ø–æ—Ä–æ–≥ PH –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤
    try:
        if hasattr(self, "orchestrator") and self.orchestrator:
            if hasattr(self.orchestrator, "data_registry"):
                data_registry = self.orchestrator.data_registry
                market_data = await data_registry.get_market_data(symbol)
                
                if market_data and market_data.indicators:
                    # –ü–æ–ª—É—á–∞–µ–º RSI
                    rsi = market_data.indicators.get("RSI")
                    if rsi:
                        # –ï—Å–ª–∏ RSI –ø–µ—Ä–µ–∫—É–ø–ª–µ–Ω/–ø–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω - —Å–Ω–∏–∂–∞–µ–º –ø–æ—Ä–æ–≥ PH (–±—ã—Å—Ç—Ä–µ–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º)
                        if (side == "long" and rsi > 70) or (side == "short" and rsi < 30):
                            ph_threshold = ph_threshold * 0.8  # –°–Ω–∏–∂–∞–µ–º –ø–æ—Ä–æ–≥ –Ω–∞ 20%
                            logger.debug(
                                f"üìä –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π PH –¥–ª—è {symbol}: RSI={rsi:.1f} –ø–µ—Ä–µ–∫—É–ø–ª–µ–Ω/–ø–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω, "
                                f"–ø–æ—Ä–æ–≥ —Å–Ω–∏–∂–µ–Ω –¥–æ ${ph_threshold:.2f}"
                            )
                    
                    # –ü–æ–ª—É—á–∞–µ–º –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å (ATR)
                    atr = market_data.indicators.get("ATR")
                    if atr and current_price > 0:
                        volatility_pct = (atr / current_price) * 100
                        # –í—ã—Å–æ–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å - —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º –ø–æ—Ä–æ–≥ PH (–¥–µ—Ä–∂–∏–º –¥–æ–ª—å—à–µ)
                        if volatility_pct > 2.0:
                            ph_threshold = ph_threshold * 1.2  # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –ø–æ—Ä–æ–≥ –Ω–∞ 20%
                            logger.debug(
                                f"üìä –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π PH –¥–ª—è {symbol}: –í—ã—Å–æ–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å ({volatility_pct:.2f}%), "
                                f"–ø–æ—Ä–æ–≥ —É–≤–µ–ª–∏—á–µ–Ω –¥–æ ${ph_threshold:.2f}"
                            )
    except Exception as e:
        logger.debug(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –∞–¥–∞–ø—Ç–∞—Ü–∏–∏ PH –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤: {e}, –∏—Å–ø–æ–ª—å–∑—É–µ–º –±–∞–∑–æ–≤—ã–π –ø–æ—Ä–æ–≥")
    
    # ... –æ—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ PH —Å –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –ø–æ—Ä–æ–≥–æ–º ...
```

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ–¥—Ö–æ–¥–æ–≤

| –ü–æ–¥—Ö–æ–¥ | –°–∫–æ—Ä–æ—Å—Ç—å | –£–º–Ω–æ—Å—Ç—å | –°–ª–æ–∂–Ω–æ—Å—Ç—å | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è |
|--------|----------|---------|-----------|--------------|
| **–¢–µ–∫—É—â–∏–π (–≤—Ä–µ–º—è + –ø–æ—Ä–æ–≥–∏)** | ‚ö°‚ö°‚ö° –ë—ã—Å—Ç—Ä–æ | üß† –°—Ä–µ–¥–Ω–µ | ‚úÖ –ü—Ä–æ—Å—Ç–æ | ‚úÖ **–û–ø—Ç–∏–º–∞–ª—å–Ω–æ –¥–ª—è —Å–∫–∞–ª—å–ø–∏–Ω–≥–∞** |
| **–ì–∏–±—Ä–∏–¥–Ω—ã–π (—Ñ–∏–ª—å—Ç—Ä –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤)** | ‚ö°‚ö° –ë—ã—Å—Ç—Ä–æ | üß†üß† –£–º–Ω–æ | ‚ö†Ô∏è –°—Ä–µ–¥–Ω–µ | ‚úÖ **–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è** |
| **–ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤** | ‚ö° –ú–µ–¥–ª–µ–Ω–Ω–æ | üß†üß†üß† –û—á–µ–Ω—å —É–º–Ω–æ | ‚ùå –°–ª–æ–∂–Ω–æ | ‚ùå –°–ª–∏—à–∫–æ–º –º–µ–¥–ª–µ–Ω–Ω–æ –¥–ª—è —Å–∫–∞–ª—å–ø–∏–Ω–≥–∞ |

---

## ‚úÖ –í—ã–≤–æ–¥—ã

### –¢–µ–∫—É—â–∞—è —Å–∏—Å—Ç–µ–º–∞ –£–ñ–ï "—É–º–Ω–∞—è":

1. ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–∞–Ω–Ω—ã–µ —Å –±–∏—Ä–∂–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
2. ‚úÖ –ê–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –ø–æ–¥ —Ä–µ–∂–∏–º —Ä—ã–Ω–∫–∞ (trending/ranging/choppy)
3. ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç ATR –¥–ª—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–≥–æ TP
4. ‚úÖ –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –¥–≤–∏–∂–µ–Ω–∏–µ —Ü–µ–Ω—ã —á–µ—Ä–µ–∑ Trailing Stop Loss
5. ‚úÖ –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç PnL —Å —É—á–µ—Ç–æ–º –∫–æ–º–∏—Å—Å–∏–π
6. ‚úÖ –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –ø–∏–∫–æ–≤—É—é –ø—Ä–∏–±—ã–ª—å –∏ –æ—Ç–∫–∞—Ç—ã

### –ß—Ç–æ –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):

1. **–î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤** –¥–ª—è PH –∏ Profit Drawdown (–í–∞—Ä–∏–∞–Ω—Ç 1)
2. **–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –ø–æ—Ä–æ–≥–∏** –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ (–í–∞—Ä–∏–∞–Ω—Ç 3)
3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–≤–æ—Ä–æ—Ç–∞ —Ç—Ä–µ–Ω–¥–∞** –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º (–í–∞—Ä–∏–∞–Ω—Ç 2)

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:

**–¢–µ–∫—É—â–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –¥–ª—è —Å–∫–∞–ª—å–ø–∏–Ω–≥–∞!** 

–ù–æ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å **–í–∞—Ä–∏–∞–Ω—Ç 1 (–ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥)** - —ç—Ç–æ –¥–æ–±–∞–≤–∏—Ç "—É–º–Ω–æ—Å—Ç–∏" –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ —Å–∫–æ—Ä–æ—Å—Ç–∏.

---

## üéØ –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø–ª–∞–Ω —É–ª—É—á—à–µ–Ω–∏–π

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: **–ò—Å–ø—Ä–∞–≤–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã**
- ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å `peak_profit` –¥–ª—è —É–±—ã—Ç–æ—á–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π
- ‚úÖ –£–≤–µ–ª–∏—á–∏—Ç—å `ph_time_limit`
- ‚úÖ –£–±—Ä–∞—Ç—å `ph_time_limit` –¥–ª—è —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã—Ö –ø—Ä–∏–±—ã–ª–µ–π

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: **–î–æ–±–∞–≤–∏—Ç—å "—É–º–Ω—ã–π" —Ñ–∏–ª—å—Ç—Ä** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É RSI/MACD –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º –ø–æ PH
- ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É ADX –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º –ø–æ Profit Drawdown

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: **–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –ø–æ—Ä–æ–≥–∏** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- ‚úÖ –ê–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å `ph_threshold` –Ω–∞ –æ—Å–Ω–æ–≤–µ RSI –∏ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏

---

## üí¨ –û—Ç–≤–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**"–ú—ã –ø—Ä–æ—Å—Ç–æ –Ω–µ –º–æ–∂–µ–º —Å–¥–µ–ª–∞—Ç—å –µ–≥–æ —É–º–Ω—ã–º? –ú—ã –Ω–µ –º–æ–∂–µ–º –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏–π –∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤?"**

**–û—Ç–≤–µ—Ç:** 
- ‚úÖ –ë–æ—Ç **–£–ñ–ï —É–º–Ω—ã–π** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∞–Ω–∞–ª–∏–∑ —Ä–µ–∂–∏–º–∞ —Ä—ã–Ω–∫–∞, –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Ü–µ–Ω—ã
- ‚úÖ –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏–π **–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è** - PH ‚Üí Profit Drawdown ‚Üí TP/SL ‚Üí MAX_HOLDING
- ‚úÖ –ü–∞—Ä–∞–º–µ—Ç—Ä—ã **–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è** - —á–µ—Ä–µ–∑ –∫–æ–Ω—Ñ–∏–≥, –∞–¥–∞–ø—Ç–∏—Ä—É—é—Ç—Å—è –ø–æ–¥ —Ä–µ–∂–∏–º

**–ù–û:** –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ "—É–º–Ω–æ—Å—Ç–∏" —á–µ—Ä–µ–∑ —Ñ–∏–ª—å—Ç—Ä—ã –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ!

