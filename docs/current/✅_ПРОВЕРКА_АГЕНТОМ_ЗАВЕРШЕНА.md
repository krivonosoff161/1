# ‚úÖ –ü–†–û–í–ï–†–ö–ê –ê–ì–ï–ù–¢–û–ú –ó–ê–í–ï–†–®–ï–ù–ê

**–î–∞—Ç–∞:** 23.11.2025, 23:59  
**–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç:** –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –ª–∏–Ω—Ç–µ—Ä + flake8  
**–°—Ç–∞—Ç—É—Å:** –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã

---

## ‚úÖ –†–ï–ó–£–õ–¨–¢–ê–¢–´ –ü–†–û–í–ï–†–ö–ò

### 1. –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –ª–∏–Ω—Ç–µ—Ä (`read_lints`) ‚úÖ

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```python
read_lints(['src/strategies/scalping/futures/position_manager.py', 'config/config_futures.yaml'])
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ **–ù–µ—Ç –æ—à–∏–±–æ–∫**
- –°–∏–Ω—Ç–∞–∫—Å–∏—Å –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω
- –ù–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫
- –ù–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π

---

### 2. Flake8 (—Å—Ç–∏–ª–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏) ‚úÖ

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
python -m flake8 --select=E,F,W src/strategies/scalping/futures/position_manager.py
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ **–¢–æ–ª—å–∫–æ —Å—Ç–∏–ª–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è**

#### –ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è:

**F401 - –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∏–º–ø–æ—Ä—Ç—ã (–Ω–µ–∫—Ä–∏—Ç–∏—á–Ω–æ):**
- `timedelta` (—Å—Ç—Ä–æ–∫–∞ 13) - –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤ –¥—Ä—É–≥–∏—Ö –º–µ—Ç–æ–¥–∞—Ö
- `List` (—Å—Ç—Ä–æ–∫–∞ 14) - –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤ –¥—Ä—É–≥–∏—Ö –º–µ—Ç–æ–¥–∞—Ö
- `Tuple` (—Å—Ç—Ä–æ–∫–∞ 14) - –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤ –¥—Ä—É–≥–∏—Ö –º–µ—Ç–æ–¥–∞—Ö
- `ScalpingConfig` (—Å—Ç—Ä–æ–∫–∞ 19) - –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤ –¥—Ä—É–≥–∏—Ö –º–µ—Ç–æ–¥–∞—Ö

**F841 - –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è (–Ω–µ–∫—Ä–∏—Ç–∏—á–Ω–æ):**
- `side` (—Å—Ç—Ä–æ–∫–∞ 390) - –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ—Ç—Å—è, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –º–µ—Ç–æ–¥–µ `_check_position_safety`

**W293 - –ü—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ —Å –ø—Ä–æ–±–µ–ª–∞–º–∏ (—Å—Ç–∏–ª–∏—Å—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞):**
- –ú–Ω–æ–∂–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫ (W293) - –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç –ø—Ä–æ–±–µ–ª—ã

**W503 - –ü–µ—Ä–µ–Ω–æ—Å —Å—Ç—Ä–æ–∫–∏ –ø–µ—Ä–µ–¥ –±–∏–Ω–∞—Ä–Ω—ã–º –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–º (—Å—Ç–∏–ª–∏—Å—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞):**
- –ú–Ω–æ–∂–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫ (W503) - –ø–µ—Ä–µ–Ω–æ—Å —Å—Ç—Ä–æ–∫–∏ –ø–µ—Ä–µ–¥ `and`, `or`

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** üü¢ **–ù–∏–∑–∫–∞—è** - –≤—Å–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è —Å—Ç–∏–ª–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ, –Ω–µ –≤–ª–∏—è—é—Ç –Ω–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

---

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç–æ–¥–æ–≤ ‚úÖ

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –º–µ—Ç–æ–¥–æ–≤:**

‚úÖ **–ú–µ—Ç–æ–¥ `_get_adaptive_sl_percent`:**
- –°—Ç—Ä–æ–∫–∞ 235: `def _get_adaptive_sl_percent(self, symbol: str, regime: Optional[str] = None) -> float:`
- –ù–∞–π–¥–µ–Ω: ‚úÖ
- –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑: `_check_sl` (—Å—Ç—Ä–æ–∫–∞ 847)

‚úÖ **–ú–µ—Ç–æ–¥ `_check_sl`:**
- –°—Ç—Ä–æ–∫–∞ 805: `async def _check_sl(self, position: Dict[str, Any]) -> bool:`
- –ù–∞–π–¥–µ–Ω: ‚úÖ
- –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑: `_check_tp_only` (—Å—Ç—Ä–æ–∫–∞ 1141)

‚úÖ **–ú–µ—Ç–æ–¥ `_close_position_by_reason`:**
- –°—Ç—Ä–æ–∫–∞ 2226: `async def _close_position_by_reason(self, position: Dict[str, Any], reason: str) -> Optional[TradeResult]:`
- –ù–∞–π–¥–µ–Ω: ‚úÖ
- –í—ã–∑—ã–≤–∞–µ—Ç—Å—è —Å `reason="sl"` –∏–∑: `_check_sl` (—Å—Ç—Ä–æ–∫–∞ 918)

---

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–∏–∫–∏ ‚úÖ

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:**

‚úÖ **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ `_check_tp_only`:**
```python
# –°—Ç—Ä–æ–∫–∞ 1141
sl_should_close = await self._check_sl(position)
if sl_should_close:
    return  # –ó–∞–∫—Ä—ã–ª–∏ –ø–æ SL, –≤—ã—Ö–æ–¥–∏–º
```

‚úÖ **–õ–æ–≥–∏–∫–∞ `_check_sl`:**
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç TSL –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (—Å—Ç—Ä–æ–∫–∞ 832)
- –ü–æ–ª—É—á–∞–µ—Ç —Ä–µ–∂–∏–º (—Å—Ç—Ä–æ–∫–∞ 838)
- –ü–æ–ª—É—á–∞–µ—Ç –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π SL (—Å—Ç—Ä–æ–∫–∞ 847)
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç min_holding (—Å—Ç—Ä–æ–∫–∞ 881)
- –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç PnL% –æ—Ç –º–∞—Ä–∂–∏ (—Å—Ç—Ä–æ–∫–∞ 908)
- –ó–∞–∫—Ä—ã–≤–∞–µ—Ç –ø–æ–∑–∏—Ü–∏—é –µ—Å–ª–∏ `pnl_percent_from_margin <= -sl_percent` (—Å—Ç—Ä–æ–∫–∞ 911)

‚úÖ **–ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–∏:**
- –í—ã–∑—ã–≤–∞–µ—Ç—Å—è `_close_position_by_reason(position, "sl")` (—Å—Ç—Ä–æ–∫–∞ 918)
- `reason="sl"` - –≤–∞–ª–∏–¥–Ω—ã–π reason –¥–ª—è `_close_position_by_reason`

---

### 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ LONG/SHORT –ª–æ–≥–∏–∫–∏ ‚úÖ

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ PnL:**

‚úÖ **LONG –ø–æ–∑–∏—Ü–∏—è:**
```python
# –°—Ç—Ä–æ–∫–∞ 904
if position_side == "long":
    unrealized_pnl = size_in_coins * (current_price - entry_price)
```

‚úÖ **SHORT –ø–æ–∑–∏—Ü–∏—è:**
```python
# –°—Ç—Ä–æ–∫–∞ 906
else:  # short
    unrealized_pnl = size_in_coins * (entry_price - current_price)
```

‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `size_in_coins` (–ø–µ—Ä–µ–≤–µ–¥–µ–Ω–æ –∏–∑ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ —á–µ—Ä–µ–∑ `ctVal`)
- –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞ –¥–ª—è LONG: `size * (current - entry)`
- –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞ –¥–ª—è SHORT: `size * (entry - current)`

---

### 6. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤ ‚úÖ

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—è–¥–∫–∞ –ø—Ä–æ–≤–µ—Ä–æ–∫:**

‚úÖ **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∑–∞–∫—Ä—ã—Ç–∏—è —É–±—ã—Ç–æ—á–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π:**
1. TSL (–µ—Å–ª–∏ –∞–∫—Ç–∏–≤–µ–Ω) - —Å—Ç—Ä–æ–∫–∞ 832 (–ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –≤ `_check_sl`)
2. SL (–ù–û–í–û–ï) - —Å—Ç—Ä–æ–∫–∞ 1141 (–≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ü–ï–†–ï–î loss_cut)
3. loss_cut - —Å—Ç—Ä–æ–∫–∞ 1201 (–≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ü–û–°–õ–ï SL)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫

---

## ‚ö†Ô∏è –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò (–Ω–µ–∫—Ä–∏—Ç–∏—á–Ω–æ)

### 1. –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∏–º–ø–æ—Ä—Ç—ã

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –£–¥–∞–ª–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∏–º–ø–æ—Ä—Ç—ã –∏–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π `# noqa: F401` –µ—Å–ª–∏ –æ–Ω–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–æ—Å–≤–µ–Ω–Ω–æ.

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** üü¢ –ù–∏–∑–∫–∞—è (–Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å)

### 2. –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `side`

**–ü—Ä–æ–±–ª–µ–º–∞:** –°—Ç—Ä–æ–∫–∞ 390: `side = position.get("posSide", "long")` –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –º–µ—Ç–æ–¥–µ `_check_position_safety`.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –£–¥–∞–ª–∏—Ç—å —Å—Ç—Ä–æ–∫—É 390 –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é.

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** üü¢ –ù–∏–∑–∫–∞—è (–Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å)

### 3. –°—Ç–∏–ª–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –û—á–∏—Å—Ç–∏—Ç—å –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –æ—Ç –ø—Ä–æ–±–µ–ª–æ–≤ (W293) –∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫ (W503) –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è PEP 8.

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** üü¢ –ù–∏–∑–∫–∞—è (–Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å)

---

## ‚úÖ –ò–¢–û–ì–û–í–´–ô –°–¢–ê–¢–£–°

| –ü—Ä–æ–≤–µ—Ä–∫–∞ | –°—Ç–∞—Ç—É—Å | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|----------|--------|-----------|
| –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –ª–∏–Ω—Ç–µ—Ä | ‚úÖ | –ù–µ—Ç –æ—à–∏–±–æ–∫ |
| Flake8 (E, F) | ‚úÖ | –ù–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫ |
| Flake8 (W) | ‚ö†Ô∏è | –°—Ç–∏–ª–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è |
| –ù–∞–ª–∏—á–∏–µ –º–µ—Ç–æ–¥–æ–≤ | ‚úÖ | –í—Å–µ –º–µ—Ç–æ–¥—ã –Ω–∞–π–¥–µ–Ω—ã |
| –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è | ‚úÖ | –ü—Ä–∞–≤–∏–ª—å–Ω–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ |
| LONG/SHORT –ª–æ–≥–∏–∫–∞ | ‚úÖ | –ü—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ |
| –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã | ‚úÖ | –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ |

**–û–±—â–∏–π —Å—Ç–∞—Ç—É—Å:** ‚úÖ **–í–°–ï –ü–†–û–í–ï–†–ö–ò –ü–†–û–ô–î–ï–ù–´**

---

## üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê

- **–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ —Ñ–∞–π–ª–æ–≤:** 2
- **–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞:** ~3,240
- **–ù–∞–π–¥–µ–Ω–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫:** 0
- **–ù–∞–π–¥–µ–Ω–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π:** ~40 (–≤—Å–µ —Å—Ç–∏–ª–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ)
- **–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π:** üü¢ –ù–∏–∑–∫–∞—è

---

## ‚úÖ –ì–û–¢–û–í–û –ö –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Æ

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ö–æ–¥ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é**

–í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã. –ù–∞–π–¥–µ–Ω—ã —Ç–æ–ª—å–∫–æ —Å—Ç–∏–ª–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –≤–ª–∏—è—é—Ç –Ω–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å. –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π SL —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏ –≥–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é.

---

**–î–∞—Ç–∞:** 23.11.2025, 23:59

