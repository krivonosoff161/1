# üîç –ê–ù–ê–õ–ò–ó –ü–†–û–ë–õ–ï–ú–´ –õ–û–ñ–ù–û–ì–û –û–ë–ù–ê–†–£–ñ–ï–ù–ò–Ø –ó–ê–ö–†–´–¢–ò–Ø –ü–û–ó–ò–¶–ò–ô

**–î–∞—Ç–∞:** 03 —è–Ω–≤–∞—Ä—è 2026  
**–°—Ç–∞—Ç—É—Å:** –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å: **–°–†–ï–î–ù–Ø–Ø/–í–´–°–û–ö–ê–Ø**

---

## üìã –°–£–¢–¨ –ü–†–û–ë–õ–ï–ú–´

–ë–æ—Ç –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –ø–æ–∑–∏—Ü–∏—é —á–µ—Ä–µ–∑ `_close_position()`, –Ω–æ –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ `_sync_positions_with_exchange()` –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–µ—Ç, —á—Ç–æ –∑–∞–∫—Ä—ã—Ç–∏–µ –±—ã–ª–æ –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–Ω–æ —Å–∞–º–∏–º –±–æ—Ç–æ–º, –∏ –≤—ã–¥–∞–µ—Ç –ª–æ–∂–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:

```
üö® –û–ë–ù–ê–†–£–ñ–ï–ù–û –ó–ê–ö–†–´–¢–ò–ï –ù–ê –ë–ò–†–ñ–ï: BTC-USDT
‚ö†Ô∏è –ü–æ–∑–∏—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∞ –Ω–∞ –±–∏—Ä–∂–µ, –Ω–æ –ù–ï —á–µ—Ä–µ–∑ –±–æ—Ç–∞!
```

---

## üéØ –ö–†–ò–¢–ò–ß–ù–û–°–¢–¨

### ‚úÖ **–°–†–ï–î–ù–Ø–Ø/–í–´–°–û–ö–ê–Ø** (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏, –Ω–æ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏)

**–ü–æ—á–µ–º—É –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏:**
- –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- –ü–æ–∑–∏—Ü–∏–∏ –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –ù–µ—Ç –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ –¥–µ–Ω–µ–≥

**–ü–æ—á–µ–º—É –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:**
- ‚ùå **–õ–æ–∂–Ω—ã–µ —Ç—Ä–µ–≤–æ–≥–∏ –≤ –ª–æ–≥–∞—Ö** - –∑–∞—Å–æ—Ä—è—é—Ç –ª–æ–≥–∏, –º–µ—à–∞—é—Ç –∞–Ω–∞–ª–∏–∑—É
- ‚ùå **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞** - –º–æ–∂–µ—Ç –ø–æ–∫–∞–∑–∞—Ç—å, —á—Ç–æ –ø–æ–∑–∏—Ü–∏–∏ –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è –≤–Ω–µ—à–Ω–µ, —Ö–æ—Ç—è —ç—Ç–æ –Ω–µ —Ç–∞–∫
- ‚ùå **–°–∫—Ä—ã—Ç–∏–µ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º** - –µ—Å–ª–∏ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –±—É–¥–µ—Ç –≤–Ω–µ—à–Ω–µ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ (–ª–∏–∫–≤–∏–¥–∞—Ü–∏—è, TSL –Ω–∞ –±–∏—Ä–∂–µ), –µ–≥–æ –±—É–¥–µ—Ç —Å–ª–æ–∂–Ω–æ –æ—Ç–ª–∏—á–∏—Ç—å –æ—Ç –ª–æ–∂–Ω–æ–≥–æ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è
- ‚ùå **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** - –º–æ–∂–µ—Ç –≤–ª–∏—è—Ç—å –Ω–∞ –º–µ—Ç—Ä–∏–∫–∏ –∏ –æ—Ç—á–µ—Ç—ã

---

## üîç –í–°–ï –ú–ï–°–¢–ê –ë–ï–ó –ü–†–û–í–ï–†–ö–ò

### 1. ‚úÖ **–ö–†–ò–¢–ò–ß–ù–û** - `orchestrator._sync_positions_with_exchange()` (—Å—Ç—Ä–æ–∫–∞ 2462)

**–§–∞–π–ª:** `src/strategies/scalping/futures/orchestrator.py`  
**–°—Ç—Ä–æ–∫–∞:** 2462  
**–ü—Ä–æ–±–ª–µ–º–∞:** –í—ã–≤–æ–¥–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –≤–Ω–µ—à–Ω–µ–º –∑–∞–∫—Ä—ã—Ç–∏–∏ –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ `_closing_positions_cache`

**–ö–æ–¥:**
```python
# –°—Ç—Ä–æ–∫–∞ 2388-2458: –ü—Ä–æ–≤–µ—Ä–∫–∞ stale_symbols
for symbol in list(stale_symbols):
    # ... –ø—Ä–æ–≤–µ—Ä–∫–∏ ...
    
    # –°—Ç—Ä–æ–∫–∞ 2462: –í–´–í–û–î –°–û–û–ë–©–ï–ù–ò–Ø –ë–ï–ó –ü–†–û–í–ï–†–ö–ò
    logger.critical(f"üö® –û–ë–ù–ê–†–£–ñ–ï–ù–û –ó–ê–ö–†–´–¢–ò–ï –ù–ê –ë–ò–†–ñ–ï: {symbol}")
```

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø–µ—Ä–µ–¥ —Å—Ç—Ä–æ–∫–æ–π 2462:
```python
# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –±–æ—Ç —Å–∞–º –∑–∞–∫—Ä—ã–ª –ø–æ–∑–∏—Ü–∏—é
if hasattr(self, "_closing_positions_cache") and symbol in self._closing_positions_cache:
    logger.debug(
        f"üîç {symbol}: –ü–æ–∑–∏—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∞ –±–æ—Ç–æ–º (–≤ _closing_positions_cache), "
        f"–Ω–µ –ª–æ–≥–∏—Ä—É–µ–º –∫–∞–∫ –≤–Ω–µ—à–Ω–µ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ"
    )
    continue  # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É –∫–∞–∫ –≤–Ω–µ—à–Ω–µ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ
```

---

### 2. ‚ö†Ô∏è **–ù–ï –ö–†–ò–¢–ò–ß–ù–û** - `position_sync.sync_positions_with_exchange()` (—Å—Ç—Ä–æ–∫–∞ 237)

**–§–∞–π–ª:** `src/strategies/scalping/futures/core/position_sync.py`  
**–°—Ç—Ä–æ–∫–∞:** 237  
**–ü—Ä–æ–±–ª–µ–º–∞:** –£–¥–∞–ª—è–µ—Ç –ø–æ–∑–∏—Ü–∏–∏ –∏–∑ `stale_symbols`, –Ω–æ –ù–ï –ª–æ–≥–∏—Ä—É–µ—Ç –∫–∞–∫ –≤–Ω–µ—à–Ω–µ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ

**–ö–æ–¥:**
```python
# –°—Ç—Ä–æ–∫–∞ 237-240: –ü—Ä–æ—Å—Ç–æ —É–¥–∞–ª—è–µ—Ç –ø–æ–∑–∏—Ü–∏–∏
stale_symbols = set(self.active_positions.keys()) - seen_symbols
for symbol in list(stale_symbols):
    logger.warning(f"DRIFT_REMOVE {symbol} not on exchange")
    self.active_positions.pop(symbol, None)
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ù–ï –ö–†–ò–¢–ò–ß–ù–û** - –∑–¥–µ—Å—å –Ω–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤–Ω–µ—à–Ω–µ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è, —Ç–æ–ª—å–∫–æ —É–¥–∞–ª–µ–Ω–∏–µ. –ù–æ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏.

---

## üîÑ –ú–ï–°–¢–ê, –ì–î–ï –í–´–ó–´–í–ê–ï–¢–°–Ø –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø –ü–û–°–õ–ï –ó–ê–ö–†–´–¢–ò–Ø

### 1. `_close_position()` (—Å—Ç—Ä–æ–∫–∞ 4718)
- –í—ã–∑—ã–≤–∞–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è
- **–ü—Ä–æ–±–ª–µ–º–∞:** Race condition - —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–æ–∂–µ—Ç –ø—Ä–æ–∏–∑–æ–π—Ç–∏ –¥–æ —Ç–æ–≥–æ, –∫–∞–∫ –ø–æ–∑–∏—Ü–∏—è —É–¥–∞–ª–∏—Ç—Å—è –∏–∑ `active_positions`

### 2. `position_manager.close_position_manually()` (—Å—Ç—Ä–æ–∫–∞ 4778)
- –í—ã–∑—ã–≤–∞–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è
- **–ü—Ä–æ–±–ª–µ–º–∞:** –ê–Ω–∞–ª–æ–≥–∏—á–Ω–∞—è race condition

### 3. `websocket_coordinator.handle_private_ws_positions()` (—Å—Ç—Ä–æ–∫–∞ 683)
- –í—ã–∑—ã–≤–∞–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –∑–∞–∫—Ä—ã—Ç–∏—è —á–µ—Ä–µ–∑ WebSocket
- **–ü—Ä–æ–±–ª–µ–º–∞:** –ú–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–∫—Ä—ã—Ç–∏–µ —á–µ—Ä–µ–∑ –±–æ—Ç–∞, –Ω–æ WebSocket –ø–æ–ª—É—á–∏–ª –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞–Ω—å—à–µ

---

## üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ü–†–û–ë–õ–ï–ú–ù–´–• –ú–ï–°–¢

| –ú–µ—Å—Ç–æ | –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å | –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω—É–∂–Ω–∞? | –°—Ç–∞—Ç—É—Å |
|-------|-------------|-----------------|--------|
| `orchestrator._sync_positions_with_exchange()` | üî¥ –í–´–°–û–ö–ê–Ø | ‚úÖ –î–ê | ‚ùå –ù–ï–¢ |
| `position_sync.sync_positions_with_exchange()` | üü° –ù–ò–ó–ö–ê–Ø | ‚ö†Ô∏è –ñ–ï–õ–ê–¢–ï–õ–¨–ù–û | ‚ùå –ù–ï–¢ |
| `websocket_coordinator` | üü° –ù–ò–ó–ö–ê–Ø | ‚ö†Ô∏è –ñ–ï–õ–ê–¢–ï–õ–¨–ù–û | ‚ùå –ù–ï–¢ |

---

## ‚úÖ –†–ï–®–ï–ù–ò–ï

### –û—Å–Ω–æ–≤–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (–ö–†–ò–¢–ò–ß–ù–û):

**–§–∞–π–ª:** `src/strategies/scalping/futures/orchestrator.py`  
**–ú–µ—Ç–æ–¥:** `_sync_positions_with_exchange()`  
**–°—Ç—Ä–æ–∫–∞:** ~2458 (–ø–µ—Ä–µ–¥ —Å—Ç—Ä–æ–∫–æ–π 2462)

**–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É:**
```python
# ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï (03.01.2026): –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –±–æ—Ç —Å–∞–º –∑–∞–∫—Ä—ã–ª –ø–æ–∑–∏—Ü–∏—é
if hasattr(self, "_closing_positions_cache") and symbol in self._closing_positions_cache:
    logger.debug(
        f"üîç {symbol}: –ü–æ–∑–∏—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∞ –±–æ—Ç–æ–º (–≤ _closing_positions_cache), "
        f"–Ω–µ –ª–æ–≥–∏—Ä—É–µ–º –∫–∞–∫ –≤–Ω–µ—à–Ω–µ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ"
    )
    # –£–¥–∞–ª—è–µ–º –∏–∑ –∫—ç—à–∞, —Ç–∞–∫ –∫–∞–∫ —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–ª–∏
    try:
        del self._closing_positions_cache[symbol]
    except KeyError:
        pass
    continue  # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É –∫–∞–∫ –≤–Ω–µ—à–Ω–µ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ

# –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–æ–∑–∏—Ü–∏—è –ù–ï –≤ –∫—ç—à–µ - —ç—Ç–æ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –≤–Ω–µ—à–Ω–µ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ
logger.critical("=" * 80)
logger.critical(f"üö® –û–ë–ù–ê–†–£–ñ–ï–ù–û –ó–ê–ö–†–´–¢–ò–ï –ù–ê –ë–ò–†–ñ–ï: {symbol}")
# ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ ...
```

---

## üéØ –ò–¢–û–ì–û

- **–ö—Ä–∏—Ç–∏—á–Ω—ã—Ö –º–µ—Å—Ç:** 1 (`orchestrator._sync_positions_with_exchange`)
- **–ñ–µ–ª–∞—Ç–µ–ª—å–Ω—ã—Ö –º–µ—Å—Ç:** 2 (`position_sync`, `websocket_coordinator`)
- **–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** –°–†–ï–î–ù–Ø–Ø/–í–´–°–û–ö–ê–Ø (–¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏)
- **–í–ª–∏—è–Ω–∏–µ –Ω–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:** –ù–ï–¢
- **–í–ª–∏—è–Ω–∏–µ –Ω–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É:** –î–ê (–ª–æ–∂–Ω—ã–µ —Ç—Ä–µ–≤–æ–≥–∏)

---

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ò—Å–ø—Ä–∞–≤–∏—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–µ –º–µ—Å—Ç–æ (`orchestrator._sync_positions_with_exchange`) - —ç—Ç–æ —Ä–µ—à–∏—Ç 90% –ø—Ä–æ–±–ª–µ–º. –û—Å—Ç–∞–ª—å–Ω—ã–µ –º–µ—Å—Ç–∞ –º–æ–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –ø–æ–∑–∂–µ –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏.

