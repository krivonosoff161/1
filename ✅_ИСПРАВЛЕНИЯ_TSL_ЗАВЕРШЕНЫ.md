# ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø TSL –ó–ê–í–ï–†–®–ï–ù–´

**–î–∞—Ç–∞:** 26.11.2025 22:00  
**–°—Ç–∞—Ç—É—Å:** –í—Å–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã

---

## üìã –í–´–ü–û–õ–ù–ï–ù–ù–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### **1. ORCHESTRATOR.PY**

#### ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 1.1: –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π entry_time –∏–∑ API**
- **–§–∞–π–ª:** `src/strategies/scalping/futures/orchestrator.py`
- **–ú–µ—Ç–æ–¥:** `_load_existing_positions()` (—Å—Ç—Ä–æ–∫–∞ ~1225-1238)
- **–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
  - –¢–µ–ø–µ—Ä—å –ø–æ–ª—É—á–∞–µ–º —Ä–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏ –∏–∑ `cTime`/`uTime` API
  - –ü–∞—Ä—Å–∏–º –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã –≤ `datetime`
  - –ò—Å–ø–æ–ª—å–∑—É–µ–º `datetime.now()` —Ç–æ–ª—å–∫–æ –∫–∞–∫ fallback

#### ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 1.2: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ initialize_trailing_stop()**
- **–§–∞–π–ª:** `src/strategies/scalping/futures/orchestrator.py`
- **–ú–µ—Ç–æ–¥:** `_sync_positions_with_exchange()` (—Å—Ç—Ä–æ–∫–∞ ~1579-1585)
- **–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
  - –†–µ–∑—É–ª—å—Ç–∞—Ç `initialize_trailing_stop()` —Ç–µ–ø–µ—Ä—å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `tsl`
  - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ `if not tsl:` —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
  - –ü–µ—Ä–µ–¥–∞—á–∞ `entry_time` —á–µ—Ä–µ–∑ `signal` –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ TSL

#### ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 1.3: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ entry_time –≤ PositionRegistry**
- **–§–∞–π–ª:** `src/strategies/scalping/futures/orchestrator.py`
- **–ú–µ—Ç–æ–¥:** `_load_existing_positions()` (—Å—Ç—Ä–æ–∫–∞ ~1320-1336)
- **–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
  - –ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–∑–∏—Ü–∏–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –µ—ë –≤ `PositionRegistry` —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏
  - `entry_time` —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `PositionMetadata`

#### ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 1.4: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ entry_time –≤ _update_state()**
- **–§–∞–π–ª:** `src/strategies/scalping/futures/orchestrator.py`
- **–ú–µ—Ç–æ–¥:** `_update_state()` (—Å—Ç—Ä–æ–∫–∞ ~1866-1959)
- **–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
  - –ü–æ–ª—É—á–∞–µ–º `entry_time` –∏–∑ `cTime`/`uTime` –ø—Ä–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø–æ–∑–∏—Ü–∏–π
  - –°–æ—Ö—Ä–∞–Ω—è–µ–º `entry_time` –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö, –µ—Å–ª–∏ –æ–Ω –µ—â–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
  - –ò—Å–ø–æ–ª—å–∑—É–µ–º `entry_time_from_api` –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–∑–∏—Ü–∏–π

---

### **2. TRAILING_STOP_LOSS.PY**

#### ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 2.1: –ü–∞—Ä–∞–º–µ—Ç—Ä entry_timestamp –≤ initialize()**
- **–§–∞–π–ª:** `src/strategies/scalping/futures/indicators/trailing_stop_loss.py`
- **–ú–µ—Ç–æ–¥:** `initialize()` (—Å—Ç—Ä–æ–∫–∞ ~136-149)
- **–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
  - –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `entry_timestamp: Optional[float] = None`
  - –ï—Å–ª–∏ `entry_timestamp` –ø–µ—Ä–µ–¥–∞–Ω –∏ > 0, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–Ω
  - –ï—Å–ª–∏ `None`, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `time.time()` (–¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–∑–∏—Ü–∏–π)

---

### **3. TRAILING_SL_COORDINATOR.PY**

#### ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 3.1: –ü–µ—Ä–µ–¥–∞—á–∞ entry_timestamp –≤ TSL**
- **–§–∞–π–ª:** `src/strategies/scalping/futures/coordinators/trailing_sl_coordinator.py`
- **–ú–µ—Ç–æ–¥:** `initialize_trailing_stop()` (—Å—Ç—Ä–æ–∫–∞ ~304-310)
- **–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
  - –ü–æ–ª—É—á–∞–µ–º `entry_time` –∏–∑ `signal.get("entry_time")`
  - –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º `datetime` –≤ Unix timestamp
  - –ü–µ—Ä–µ–¥–∞–µ–º `entry_timestamp` –≤ `tsl.initialize()`

#### ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 3.2: –ü–µ—Ä–µ–¥–∞—á–∞ entry_time –≤ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏**
- **–§–∞–π–ª:** `src/strategies/scalping/futures/coordinators/trailing_sl_coordinator.py`
- **–ú–µ—Ç–æ–¥:** `update_trailing_stop_loss()` (—Å—Ç—Ä–æ–∫–∞ ~459-477)
- **–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
  - –ü–æ–ª—É—á–∞–µ–º `entry_time` –∏–∑ –ø–æ–∑–∏—Ü–∏–∏ –ø—Ä–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
  - –ü–µ—Ä–µ–¥–∞–µ–º —á–µ—Ä–µ–∑ `signal_with_entry_time` –≤ `initialize_trailing_stop()`

---

## üîó –°–í–Ø–ó–¨ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô

### **–¶–µ–ø–æ—á–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:**

```
1. ORCHESTRATOR: –ü–æ–ª—É—á–∞–µ–º entry_time –∏–∑ API (cTime/uTime)
   ‚Üì
2. ORCHESTRATOR: –°–æ—Ö—Ä–∞–Ω—è–µ–º entry_time –≤ PositionRegistry
   ‚Üì
3. ORCHESTRATOR: –ü–µ—Ä–µ–¥–∞–µ–º entry_time —á–µ—Ä–µ–∑ signal –≤ initialize_trailing_stop()
   ‚Üì
4. TRAILING_SL_COORDINATOR: –ü–æ–ª—É—á–∞–µ–º entry_time –∏–∑ signal, –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ timestamp
   ‚Üì
5. TRAILING_STOP_LOSS: –ò—Å–ø–æ–ª—å–∑—É–µ–º entry_timestamp –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ min_holding
   ‚Üì
6. –†–ï–ó–£–õ–¨–¢–ê–¢: TSL –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Ä–µ–∞–ª—å–Ω—ã–º –≤—Ä–µ–º–µ–Ω–µ–º –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏!
```

---

## üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´

### **–ß—Ç–æ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ:**

1. ‚úÖ **–†–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏:**
   - –ë–µ—Ä–µ—Ç—Å—è –∏–∑ API (`cTime`/`uTime`)
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `active_positions[symbol]["entry_time"]`
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `PositionRegistry` –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö

2. ‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è TSL:**
   - `entry_timestamp` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∏–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ `entry_time`
   - `min_holding` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –æ—Ç —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–∫—Ä—ã—Ç–∏—è
   - `loss_cut` –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ

3. ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:**
   - –†–µ–∑—É–ª—å—Ç–∞—Ç `initialize_trailing_stop()` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è
   - –õ–æ–≥–∏—Ä—É—é—Ç—Å—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è, –µ—Å–ª–∏ TSL –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω

4. ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:**
   - `entry_time` –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –ø—Ä–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ TSL
   - –ü—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –ø–æ–∑–∏—Ü–∏–π, –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ —Å—Ç–∞—Ä—Ç–∞

---

## üéØ –ß–¢–û –î–û–õ–ñ–ù–û –ò–°–ü–†–ê–í–ò–¢–¨–°–Ø

### **–ü—Ä–æ–±–ª–µ–º—ã, –∫–æ—Ç–æ—Ä—ã–µ —Ç–µ–ø–µ—Ä—å —Ä–µ—à–µ–Ω—ã:**

1. ‚úÖ ETH –ø–æ–∑–∏—Ü–∏—è –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–ª–∞—Å—å –∏–∑-–∑–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ `entry_time`
   - –¢–µ–ø–µ—Ä—å `min_holding` —Å—á–∏—Ç–∞–µ—Ç—Å—è –æ—Ç —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–∫—Ä—ã—Ç–∏—è
   - `loss_cut` –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –∑–∞—â–∏—Ç–æ–π `min_holding`

2. ‚úÖ TSL –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
   - –¢–µ–ø–µ—Ä—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è
   - `entry_timestamp` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ

3. ‚úÖ `entry_time` —Ç–µ—Ä—è–ª—Å—è –ø—Ä–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
   - –¢–µ–ø–µ—Ä—å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `PositionRegistry`
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø–æ–∑–∏—Ü–∏–π

---

## üöÄ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

1. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   - –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ TSL –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–∑–∏—Ü–∏–π
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `entry_time` –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `loss_cut` —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ

2. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤:**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ "‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–∞ –ø–æ–∑–∏—Ü–∏—è ... TrailingStopLoss –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω"
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ "‚úÖ TrailingStopLoss –¥–ª—è {symbol} –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω"
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –Ω–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π "‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å TrailingStopLoss"

3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã TSL:**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø–æ–∑–∏—Ü–∏–∏ –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è –ø–æ `loss_cut`
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `min_holding` —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ TSL –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –¥–ª—è –≤—Å–µ—Ö –ø–æ–∑–∏—Ü–∏–π

---

## üìù –ó–ê–ú–ï–¢–ö–ò

- –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ–±—Ä–∞—Ç–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã
- Fallback –Ω–∞ `datetime.now()` –¥–ª—è —Å–ª—É—á–∞–µ–≤, –∫–æ–≥–¥–∞ API –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `cTime`/`uTime`
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —É–ª—É—á—à–µ–Ω–æ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–æ–±–ª–µ–º

---

**–í—Å–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã! –ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é! ‚úÖ**






