# üîç –ê–ù–ê–õ–ò–ó –ü–†–û–ë–õ–ï–ú–´ –ó–ê–ö–†–´–¢–ò–Ø –ü–û–ó–ò–¶–ò–ò BTC-USDT

**–î–∞—Ç–∞:** 2025-11-12  
**–ü–æ–∑–∏—Ü–∏—è:** BTC-USDT SHORT  
**–í—Ä–µ–º—è –æ—Ç–∫—Ä—ã—Ç–∏—è:** 17:36:10  
**–í—Ä–µ–º—è –∑–∞–∫—Ä—ã—Ç–∏—è:** 17:38:50  
**–í—Ä–µ–º—è —É–¥–µ—Ä–∂–∞–Ω–∏—è:** ~2 –º–∏–Ω—É—Ç—ã 40 —Å–µ–∫—É–Ω–¥

---

## üìä –î–ê–ù–ù–´–ï –° –ë–ò–†–ñ–ò

- **–í—Ö–æ–¥–Ω–∞—è —Ü–µ–Ω–∞:** 105 296,4
- **–¶–µ–Ω–∞ –≤—ã—Ö–æ–¥–∞:** 105 194,6
- **PnL:** -0,01 USDT (-0,02%)
- **–†–∞–∑–º–µ—Ä:** 0,0005 BTC
- **–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ–∑–∏—Ü–∏—è –∑–∞–∫—Ä—ã–ª–∞—Å—å —Å —É–±—ã—Ç–∫–æ–º, —Ö–æ—Ç—è –±–æ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–ª –ø—Ä–∏–±—ã–ª—å

---

## üîç –ê–ù–ê–õ–ò–ó –õ–û–ì–û–í

### 1. –û—Ç–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–∏ (17:36:13)
```
‚úÖ –ü–æ–∑–∏—Ü–∏—è BTC-USDT SHORT –æ—Ç–∫—Ä—ã—Ç–∞ –ø–æ —Ä–µ–∞–ª—å–Ω–æ–º—É —Å–∏–≥–Ω–∞–ª—É
TrailingStopLoss –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω: entry=105455.7, side=sell, trail=0.50%
```

**–ü—Ä–æ–±–ª–µ–º–∞:** Entry price –≤ —Ç—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å = 105455.7, –Ω–æ –Ω–∞ –±–∏—Ä–∂–µ = 105296.4
- –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –ª–∏–º–∏—Ç–Ω—ã–π –æ—Ä–¥–µ—Ä –∏—Å–ø–æ–ª–Ω–∏–ª—Å—è –ø–æ –¥—Ä—É–≥–æ–π —Ü–µ–Ω–µ
- –ò–ª–∏ –±—ã–ª–∞ –∑–∞–¥–µ—Ä–∂–∫–∞ –≤ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

### 2. –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–∏ (17:38:49-50)
```
üìä TP –ø—Ä–æ–≤–µ—Ä–∫–∞ BTC-USDT: PnL=$0.11, margin=$10.53, PnL%=1.03% (–æ—Ç –º–∞—Ä–∂–∏)
üéØ TP –¥–æ—Å—Ç–∏–≥–Ω—É—Ç –¥–ª—è BTC-USDT: 1.03% (TP=1.00%, PnL=$0.11, margin=$10.53)
‚úÖ –ü–æ–∑–∏—Ü–∏—è BTC-USDT –∑–∞–∫—Ä—ã—Ç–∞ –ø–æ tp, PnL = +0.10 USDT
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ë–æ—Ç —Å—á–∏—Ç–∞–µ—Ç PnL% –æ—Ç –º–∞—Ä–∂–∏, –Ω–æ –Ω–∞ –±–∏—Ä–∂–µ PnL —Å—á–∏—Ç–∞–µ—Ç—Å—è –æ—Ç —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏!

### 3. –†–∞—Å—á–µ—Ç TP
```python
# –í position_manager.py:
pnl_percent = (unrealized_pnl / margin_used) * 100
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ë–æ—Ç —Å—á–∏—Ç–∞–µ—Ç: PnL% = $0.11 / $10.53 * 100 = 1.03%
- –ù–æ –Ω–∞ –±–∏—Ä–∂–µ: PnL% = -0,01 USDT / (0.0005 BTC * 105296.4) * 100 = -0,02%
- **–†–∞–∑–Ω–∏—Ü–∞:** –ë–æ—Ç –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç –∫–æ–º–∏—Å—Å–∏—é –∏ –ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏–µ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏!

### 4. –¢—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª
```
üîç TrailingSL check: side=sell, price=105350.00000, stop=105898.30811, profit=0.010%, time_in_position=2.16 –º–∏–Ω
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –¢—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å –±—ã–ª –Ω–∞ 105898.31 (–≤—ã—à–µ —Ç–µ–∫—É—â–µ–π —Ü–µ–Ω—ã 105350.00)
- –ü–æ–∑–∏—Ü–∏—è –∑–∞–∫—Ä—ã–ª–∞—Å—å –ø–æ TP —Ä–∞–Ω—å—à–µ, —á–µ–º —Ü–µ–Ω–∞ –¥–æ—Å—Ç–∏–≥–ª–∞ —Å—Ç–æ–ø-–ª–æ—Å—Å–∞
- **TP –∏–º–µ–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞–¥ —Ç—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å!**

### 5. –°—Ä–∞–∑—É –æ—Ç–∫—Ä—ã–ª–∞—Å—å –Ω–æ–≤–∞—è –ø–æ–∑–∏—Ü–∏—è
```
‚úÖ MA BEARISH —Å–∏–≥–Ω–∞–ª –¥–ª—è BTC-USDT: EMA_12(104686.12) < EMA_26(104740.62)
‚úÖ –ü–æ–∑–∏—Ü–∏—è BTC-USDT SHORT –æ—Ç–∫—Ä—ã—Ç–∞ –ø–æ —Ä–µ–∞–ª—å–Ω–æ–º—É —Å–∏–≥–Ω–∞–ª—É
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ü–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏ –±–æ—Ç —Å—Ä–∞–∑—É —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª –Ω–æ–≤—ã–π —Å–∏–≥–Ω–∞–ª
- –ù–µ—Ç –∑–∞–¥–µ—Ä–∂–∫–∏ –º–µ–∂–¥—É –∑–∞–∫—Ä—ã—Ç–∏–µ–º –∏ –æ—Ç–∫—Ä—ã—Ç–∏–µ–º –Ω–æ–≤–æ–π –ø–æ–∑–∏—Ü–∏–∏
- –≠—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –æ—Ç–∫—Ä—ã—Ç–∏—é –ø–æ–∑–∏—Ü–∏–∏ –≤ –Ω–µ–ø–æ–¥—Ö–æ–¥—è—â–∏–π –º–æ–º–µ–Ω—Ç

---

## üêõ –ù–ê–ô–î–ï–ù–ù–´–ï –ü–†–û–ë–õ–ï–ú–´

### 1. ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç TP
**–ü—Ä–æ–±–ª–µ–º–∞:** TP —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –æ—Ç –º–∞—Ä–∂–∏, –∞ –Ω–µ –æ—Ç —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏, –∏ –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç –∫–æ–º–∏—Å—Å–∏—é –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏.

**–†–µ—à–µ–Ω–∏–µ:**
- –£—á–∏—Ç—ã–≤–∞—Ç—å –∫–æ–º–∏—Å—Å–∏—é –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ TP
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç PnL% (–æ—Ç —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏, –∞ –Ω–µ –æ—Ç –º–∞—Ä–∂–∏)
- –î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∞—Å –¥–ª—è –∫–æ–º–∏—Å—Å–∏–∏ –∏ –ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏—è

### 2. ‚ùå TP –∏–º–µ–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞–¥ —Ç—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ–∑–∏—Ü–∏—è –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø–æ TP —Ä–∞–Ω—å—à–µ, —á–µ–º —Ç—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å –º–æ–∂–µ—Ç —Å—Ä–∞–±–æ—Ç–∞—Ç—å.

**–†–µ—à–µ–Ω–∏–µ:**
- –î–ª—è –ø—Ä–∏–±—ã–ª—å–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π —Ç—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞–¥ TP
- TP –¥–æ–ª–∂–µ–Ω —Å—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ç—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω –∏–ª–∏ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª

### 3. ‚ùå –ù–µ—Ç –∑–∞–¥–µ—Ä–∂–∫–∏ –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏ –±–æ—Ç —Å—Ä–∞–∑—É –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –Ω–æ–≤—É—é –ø–æ–∑–∏—Ü–∏—é.

**–†–µ—à–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–µ—Ä–∂–∫—É –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 30-60 —Å–µ–∫—É–Ω–¥)
- –≠—Ç–æ –¥–∞—Å—Ç –≤—Ä–µ–º—è —Ä—ã–Ω–∫—É "—É—Å–ø–æ–∫–æ–∏—Ç—å—Å—è" –∏ –∏–∑–±–µ–∂–∞—Ç—å –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏ –≤ –Ω–µ–ø–æ–¥—Ö–æ–¥—è—â–∏–π –º–æ–º–µ–Ω—Ç

### 4. ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π entry price –≤ —Ç—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å
**–ü—Ä–æ–±–ª–µ–º–∞:** Entry price –≤ —Ç—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å (105455.7) –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Ä–µ–∞–ª—å–Ω–æ–π —Ü–µ–Ω–æ–π –≤—Ö–æ–¥–∞ (105296.4).

**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—É—é —Ü–µ–Ω—É –≤—Ö–æ–¥–∞ –∏–∑ –ø–æ–∑–∏—Ü–∏–∏ –Ω–∞ –±–∏—Ä–∂–µ
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å entry price –ø–æ—Å–ª–µ –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏

---

## ‚úÖ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –ò–°–ü–†–ê–í–õ–ï–ù–ò–Æ

### 1. –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Ä–∞—Å—á–µ—Ç TP
```python
# –£—á–∏—Ç—ã–≤–∞—Ç—å –∫–æ–º–∏—Å—Å–∏—é –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ TP
commission_rate = 0.0009  # 0.09% –Ω–∞ –∫—Ä—É–≥
tp_percent_with_commission = tp_percent + (commission_rate * 100)  # –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–º–∏—Å—Å–∏—é –∫ TP
```

### 2. –ò–∑–º–µ–Ω–∏—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç: —Ç—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å > TP
```python
# –ü—Ä–æ–≤–µ—Ä—è—Ç—å —Ç—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å –ü–ï–†–ï–î TP
if tsl.should_close_position(...):
    # –ó–∞–∫—Ä—ã–≤–∞–µ–º –ø–æ —Ç—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å
    await self._close_position(symbol, "trailing_stop")
elif pnl_percent >= tp_percent:
    # –ó–∞–∫—Ä—ã–≤–∞–µ–º –ø–æ TP —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ç—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª
    await self._close_position(symbol, "tp")
```

### 3. –î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–µ—Ä–∂–∫—É –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏
```python
# –ü–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏
self.last_position_close_time[symbol] = time.time()
cooldown_seconds = 60  # 60 —Å–µ–∫—É–Ω–¥ –∑–∞–¥–µ—Ä–∂–∫–∏

# –ü—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Å–∏–≥–Ω–∞–ª–æ–≤
if symbol in self.last_position_close_time:
    time_since_close = time.time() - self.last_position_close_time[symbol]
    if time_since_close < cooldown_seconds:
        logger.debug(f"‚è∏Ô∏è Cooldown –¥–ª—è {symbol}: –ø—Ä–æ—à–ª–æ {time_since_close:.1f}—Å < {cooldown_seconds}—Å")
        return False
```

### 4. –ò—Å–ø—Ä–∞–≤–∏—Ç—å entry price –≤ —Ç—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å
```python
# –ü–æ—Å–ª–µ –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å entry price
position_data = await self.client.get_position(symbol)
real_entry_price = position_data.get("avgPx")
if real_entry_price:
    tsl.entry_price = float(real_entry_price)
    tsl.initialize(float(real_entry_price), side)
```

---

## üéØ –ò–¢–û–ì

**–û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:**
1. ‚ùå TP —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ (–Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç –∫–æ–º–∏—Å—Å–∏—é)
2. ‚ùå TP –∏–º–µ–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞–¥ —Ç—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å
3. ‚ùå –ù–µ—Ç –∑–∞–¥–µ—Ä–∂–∫–∏ –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏
4. ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π entry price –≤ —Ç—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å

**–†–µ—à–µ–Ω–∏—è:**
1. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Ä–∞—Å—á–µ—Ç TP —Å —É—á–µ—Ç–æ–º –∫–æ–º–∏—Å—Å–∏–∏
2. ‚úÖ –ò–∑–º–µ–Ω–∏—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç: —Ç—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å > TP
3. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–µ—Ä–∂–∫—É –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏
4. ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å entry price –ø–æ—Å–ª–µ –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏

---

## üìã –ü–õ–ê–ù –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

1. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å —Ä–∞—Å—á–µ—Ç TP** - —É—á–∏—Ç—ã–≤–∞—Ç—å –∫–æ–º–∏—Å—Å–∏—é –∏ –ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏–µ
2. **–ò–∑–º–µ–Ω–∏—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç** - —Ç—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø-–ª–æ—Å—Å > TP
3. **–î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–µ—Ä–∂–∫—É** - –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏ –ø–µ—Ä–µ–¥ –æ—Ç–∫—Ä—ã—Ç–∏–µ–º –Ω–æ–≤–æ–π
4. **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å entry price** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—É—é —Ü–µ–Ω—É –≤—Ö–æ–¥–∞ –∏–∑ –±–∏—Ä–∂–∏

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ –ö–†–ò–¢–ò–ß–ù–û

