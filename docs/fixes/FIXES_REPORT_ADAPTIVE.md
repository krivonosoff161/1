# üîß –û–¢–ß–ï–¢ –û–ë –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø–• –° –£–ß–ï–¢–û–ú –ê–î–ê–ü–¢–ò–í–ù–û–°–¢–ò

**–î–∞—Ç–∞:** 2025-12-07  
**–ü–µ—Ä–∏–æ–¥ –∞–Ω–∞–ª–∏–∑–∞:** 2025-12-04 - 2025-12-05  
**–ê—Ä—Ö–∏–≤ –ª–æ–≥–æ–≤:** `logs_2025-12-06_15-58-40.zip`

---

## üìä –ü–†–û–ë–õ–ï–ú–´, –ù–ê–ô–î–ï–ù–ù–´–ï –í –ê–£–î–ò–¢–ï

### 1. –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ duration_sec (94 —Å–¥–µ–ª–∫–∏, 66.7%)
**–ü—Ä–æ–±–ª–µ–º–∞:** `entry_time` –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–ª—Å—è –∏–ª–∏ –ø–æ–ª—É—á–∞–ª—Å—è, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–º—É `duration_sec`.

**–ü—Ä–∏—á–∏–Ω—ã:**
- `entry_time` –∏–∑ timestamp –Ω–µ –∏–º–µ–ª timezone.utc
- –ù–µ –±—ã–ª–æ fallback –Ω–∞ cTime/uTime –∏–∑ –ø–æ–∑–∏—Ü–∏–∏
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è entry_time –ø–µ—Ä–µ–¥ —Ä–∞—Å—á–µ—Ç–æ–º duration

### 2. –ù—É–ª–µ–≤—ã–µ duration_sec (30 —Å–¥–µ–ª–æ–∫, 21.3%)
**–ü—Ä–æ–±–ª–µ–º–∞:** `entry_time` –Ω–µ –Ω–∞—Ö–æ–¥–∏–ª—Å—è, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è —Ç–µ–∫—É—â–∏–π –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏ –∫–∞–∫ fallback.

**–ü—Ä–∏—á–∏–Ω—ã:**
- –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è entry_time
- –ù–µ –±—ã–ª–æ –ø—Ä–æ–≤–µ—Ä–∫–∏ cTime/uTime –∏–∑ –ø–æ–∑–∏—Ü–∏–∏

### 3. max_holding_exceeded –∑–∞–∫—Ä—ã–≤–∞–µ—Ç —É–±—ã—Ç–æ—á–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ (30 —Å–¥–µ–ª–æ–∫, -$25.92 USDT)
**–ü—Ä–æ–±–ª–µ–º–∞:** `max_holding_exceeded` –∑–∞–∫—Ä—ã–≤–∞–ª –ø–æ–∑–∏—Ü–∏–∏ –¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω–∏ –±—ã–ª–∏ –≤ —É–±—ã—Ç–∫–µ, —á—Ç–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ.

**–ü—Ä–∏—á–∏–Ω—ã:**
- –ù–µ –±—ã–ª–æ –ø—Ä–æ–≤–µ—Ä–∫–∏ PnL –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º –ø–æ max_holding
- –ù–µ —É—á–∏—Ç—ã–≤–∞–ª–∞—Å—å –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å (—Ä–µ–∂–∏–º—ã —Ä—ã–Ω–∫–∞)

### 4. –†–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ PnL —Å –±–∏—Ä–∂–µ–π ($5.26 USDT)
**–ü—Ä–æ–±–ª–µ–º–∞:** PnL –±–æ—Ç–∞ (+$0.79) –Ω–µ —Å–æ–≤–ø–∞–¥–∞–ª —Å PnL –±–∏—Ä–∂–∏ (-$4.48).

**–ü—Ä–∏—á–∏–Ω—ã:**
- –í–æ–∑–º–æ–∂–Ω–æ –Ω–µ –≤—Å–µ –∫–æ–º–∏—Å—Å–∏–∏ —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è
- Funding fees –º–æ–≥—É—Ç –Ω–µ —É—á–∏—Ç—ã–≤–∞—Ç—å—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é

---

## ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ entry_time –∏–∑ timestamp

**–§–∞–π–ª:** `src/strategies/scalping/futures/position_manager.py:3551`

**–ë—ã–ª–æ:**
```python
entry_time = datetime.fromtimestamp(tsl.entry_timestamp)
```

**–°—Ç–∞–ª–æ:**
```python
entry_time = datetime.fromtimestamp(tsl.entry_timestamp, tz=timezone.utc)
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** `entry_time` —Ç–µ–ø–µ—Ä—å –≤—Å–µ–≥–¥–∞ –≤ UTC timezone.

---

### 2. –î–æ–±–∞–≤–ª–µ–Ω fallback –Ω–∞ cTime/uTime –∏–∑ –ø–æ–∑–∏—Ü–∏–∏

**–§–∞–π–ª:** `src/strategies/scalping/futures/position_manager.py:3589-3610`

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
```python
# 4. –ü–æ—Å–ª–µ–¥–Ω–∏–π fallback: –ø—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –∏–∑ timestamp –ø–æ–∑–∏—Ü–∏–∏
if entry_time is None:
    # –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –∏–∑ cTime/uTime –ø–æ–∑–∏—Ü–∏–∏
    c_time = position.get("cTime") or position.get("uTime") or position.get("openTime")
    if c_time:
        try:
            if isinstance(c_time, (int, float)):
                entry_time = datetime.fromtimestamp(float(c_time) / 1000.0, tz=timezone.utc)
            elif isinstance(c_time, str) and c_time.isdigit():
                entry_time = datetime.fromtimestamp(float(c_time) / 1000.0, tz=timezone.utc)
            else:
                entry_time = datetime.fromisoformat(c_time.replace("Z", "+00:00"))
                if entry_time.tzinfo is None:
                    entry_time = entry_time.replace(tzinfo=timezone.utc)
            logger.debug(
                f"‚úÖ entry_time –¥–ª—è {symbol} –ø–æ–ª—É—á–µ–Ω –∏–∑ cTime/uTime –ø–æ–∑–∏—Ü–∏–∏: {entry_time}"
            )
        except Exception as e:
            logger.warning(
                f"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å cTime/uTime –¥–ª—è {symbol}: {e}"
            )
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ë–æ–ª—å—à–µ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è `entry_time`, –º–µ–Ω—å—à–µ –Ω—É–ª–µ–≤—ã—Ö duration.

---

### 3. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ max_holding_exceeded - –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç —É–±—ã—Ç–æ—á–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏

**–§–∞–π–ª:** `src/strategies/scalping/futures/positions/exit_analyzer.py`

#### 3.1. Ranging —Ä–µ–∂–∏–º (—Å—Ç—Ä–æ–∫–∞ 1570)

**–ë—ã–ª–æ:**
```python
if minutes_in_position >= actual_max_holding:
    # –í—Ä–µ–º—è –ø—Ä–µ–≤—ã—à–µ–Ω–æ - –∑–∞–∫—Ä—ã–≤–∞–µ–º
    return {"action": "close", "reason": "max_holding_exceeded", ...}
```

**–°—Ç–∞–ª–æ:**
```python
if minutes_in_position >= actual_max_holding:
    # ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –ù–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º —É–±—ã—Ç–æ—á–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –ø–æ max_holding
    if pnl_percent < 0:
        logger.info(
            f"‚è∞ ExitAnalyzer RANGING: –í—Ä–µ–º—è {minutes_in_position:.1f} –º–∏–Ω >= {actual_max_holding:.1f} –º–∏–Ω, "
            f"–Ω–æ –ø–æ–∑–∏—Ü–∏—è –≤ —É–±—ã—Ç–∫–µ ({pnl_percent:.2f}%) - –ù–ï –∑–∞–∫—Ä—ã–≤–∞–µ–º, –∂–¥–µ–º SL –∏–ª–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è"
        )
        return {
            "action": "hold",
            "reason": "max_holding_exceeded_but_loss",
            ...
        }
    
    # –í—Ä–µ–º—è –ø—Ä–µ–≤—ã—à–µ–Ω–æ –∏ –ø–æ–∑–∏—Ü–∏—è –≤ –ø—Ä–∏–±—ã–ª–∏ - –∑–∞–∫—Ä—ã–≤–∞–µ–º
    return {"action": "close", "reason": "max_holding_exceeded", ...}
```

#### 3.2. Choppy —Ä–µ–∂–∏–º (—Å—Ç—Ä–æ–∫–∞ 1799)

**–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ:** –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ `if pnl_percent < 0` –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º.

#### 3.3. Trending —Ä–µ–∂–∏–º (—Å—Ç—Ä–æ–∫–∞ 1290)

**–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ:** –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ `if pnl_percent < 0` –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** `max_holding_exceeded` –±–æ–ª—å—à–µ –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç —É–±—ã—Ç–æ—á–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏, –ø–æ–∑–≤–æ–ª—è—è –∏–º –¥–æ–π—Ç–∏ –¥–æ SL –∏–ª–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è.

---

## üìä –û–ñ–ò–î–ê–ï–ú–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´

### 1. Duration_sec
- ‚úÖ –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö duration –¥–æ–ª–∂–Ω–æ —Å—Ç–∞—Ç—å –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –º–µ–Ω—å—à–µ (–∏–ª–∏ –∏—Å—á–µ–∑–Ω—É—Ç—å)
- ‚úÖ –ù—É–ª–µ–≤—ã—Ö duration –¥–æ–ª–∂–Ω–æ —Å—Ç–∞—Ç—å –º–µ–Ω—å—à–µ (–±–ª–∞–≥–æ–¥–∞—Ä—è fallback –Ω–∞ cTime/uTime)

### 2. max_holding_exceeded
- ‚úÖ –£–±—ã—Ç–∫–∏ –æ—Ç max_holding_exceeded –¥–æ–ª–∂–Ω—ã —É–º–µ–Ω—å—à–∏—Ç—å—Å—è
- ‚úÖ –ü–æ–∑–∏—Ü–∏–∏ –≤ —É–±—ã—Ç–∫–µ –±—É–¥—É—Ç –¥–µ—Ä–∂–∞—Ç—å—Å—è –¥–æ SL –∏–ª–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è

### 3. PnL
- ‚úÖ –ë–æ–ª–µ–µ —Ç–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç PnL (–±–ª–∞–≥–æ–¥–∞—Ä—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É entry_time)
- ‚ö†Ô∏è –†–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ —Å –±–∏—Ä–∂–µ–π —Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–º–∏—Å—Å–∏–π –∏ funding fees

---

## üîç –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –ü–†–û–ë–õ–ï–ú–´ –î–õ–Ø –ü–†–û–í–ï–†–ö–ò

### 1. –†–∞—Å—á–µ—Ç PnL —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –∫–æ–º–∏—Å—Å–∏–π
**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- –í—Å–µ –ª–∏ –∫–æ–º–∏—Å—Å–∏–∏ —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è (maker/taker)
- –£—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –ª–∏ funding fees
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è net_pnl

### 2. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–π –æ—Ä–¥–µ—Ä–æ–≤
**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–∞ –±–∏—Ä–∂–µ 476 fills, –≤ –ª–æ–≥–∞—Ö –±–æ—Ç–∞ 141 —Å–¥–µ–ª–æ–∫.

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- –õ–æ–≥–∏—Ä—É—é—Ç—Å—è –ª–∏ –≤—Å–µ fills
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ –∞–≥—Ä–µ–≥–∏—Ä—É—é—Ç—Å—è —á–∞—Å—Ç–∏—á–Ω—ã–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è

---

## üìù –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

1. ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:** entry_time –∏ duration_sec
2. ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:** max_holding_exceeded –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç —É–±—ã—Ç–æ—á–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏
3. ‚ö†Ô∏è **–¢—Ä–µ–±—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏:** –†–∞—Å—á–µ—Ç PnL —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –∫–æ–º–∏—Å—Å–∏–π
4. ‚ö†Ô∏è **–¢—Ä–µ–±—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏:** –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–π –æ—Ä–¥–µ—Ä–æ–≤
5. ‚ö†Ô∏è **–¢—Ä–µ–±—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏:** –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö —Å –±–∏—Ä–∂–µ–π

---

## üéØ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

1. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞—Å—á–µ—Ç PnL —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –∫–æ–º–∏—Å—Å–∏–π
3. –£–ª—É—á—à–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–π –æ—Ä–¥–µ—Ä–æ–≤
4. –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–≥—É–ª—è—Ä–Ω—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é —Å –±–∏—Ä–∂–µ–π

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ç—á–µ—Ç–∞:** 2025-12-07  
**–ê–≤—Ç–æ—Ä:** AI Assistant  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω—ã

