# –§–ò–ù–ê–õ–¨–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê –ì–ê–†–ú–û–ù–ò–ò –°–ò–°–¢–ï–ú–´

**–î–∞—Ç–∞:** 23 –Ω–æ—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü–†–û–í–ï–†–ï–ù–û –ò –ò–°–ü–†–ê–í–õ–ï–ù–û

---

## ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ê –õ–û–ì–ò–ö–ê –ü–†–ò–û–†–ò–¢–ï–¢–û–í

### –ü—Ä–æ–±–ª–µ–º–∞:

**–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```python
offset_percent = default_offset  # 0.05
if offset_percent == default_offset:  # ‚ùå –ü—Ä–æ–±–ª–µ–º–∞: –µ—Å–ª–∏ per-symbol offset = 0.05, –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º per-regime
```

**–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```python
offset_percent = None  # ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ–º None –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è
if offset_percent is None:  # ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º per-regime –∏–ª–∏ global
```

---

## ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–ê–Ø –õ–û–ì–ò–ö–ê –ü–†–ò–û–†–ò–¢–ï–¢–û–í

### –ü–æ—Ä—è–¥–æ–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏:

1. **Per-symbol + Per-regime** (–µ—Å–ª–∏ –µ—Å—Ç—å)
   ```python
   if symbol and limit_order_config.get("by_symbol"):
       symbol_config = limit_order_config.get("by_symbol", {}).get(symbol, {})
       if regime and symbol_config.get("by_regime"):
           regime_config = symbol_config.get("by_regime", {}).get(regime, {})
           symbol_regime_offset = regime_config.get("limit_offset_percent")
           if symbol_regime_offset is not None:
               offset_percent = symbol_regime_offset  # ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
   ```

2. **Per-symbol** (–µ—Å–ª–∏ –Ω–µ—Ç —Ä–µ–∂–∏–º–∞ –∏–ª–∏ —Ä–µ–∂–∏–º –Ω–µ –Ω–∞–π–¥–µ–Ω)
   ```python
   symbol_offset = symbol_config.get("limit_offset_percent")
   if symbol_offset is not None:
       offset_percent = symbol_offset  # ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
   ```

3. **Per-regime** (–µ—Å–ª–∏ per-symbol –Ω–µ –Ω–∞–π–¥–µ–Ω)
   ```python
   if offset_percent is None and regime and limit_order_config.get("by_regime"):
       regime_config = limit_order_config.get("by_regime", {}).get(regime, {})
       regime_offset = regime_config.get("limit_offset_percent")
       if regime_offset is not None:
           offset_percent = regime_offset  # ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
   ```

4. **–ì–ª–æ–±–∞–ª—å–Ω—ã–π** (fallback)
   ```python
   if offset_percent is None:
       offset_percent = default_offset  # ‚úÖ Fallback
   ```

---

## ‚úÖ –ü–†–û–í–ï–†–ö–ê –í–°–ï–• –°–¶–ï–ù–ê–†–ò–ï–í

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: BTC-USDT –≤ —Ä–µ–∂–∏–º–µ ranging

**–ö–æ–Ω—Ñ–∏–≥:**
```yaml
by_symbol:
  "BTC-USDT":
    limit_offset_percent: 0.03
    by_regime:
      ranging: 0.08
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ù–∞–π–¥–µ–Ω `per-symbol+regime` offset: `0.08%`
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ: `üí∞ Per-symbol+regime offset –¥–ª—è BTC-USDT (ranging): 0.08%`

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: BTC-USDT –±–µ–∑ —Ä–µ–∂–∏–º–∞

**–ö–æ–Ω—Ñ–∏–≥:**
```yaml
by_symbol:
  "BTC-USDT":
    limit_offset_percent: 0.03
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ù–∞–π–¥–µ–Ω `per-symbol` offset: `0.03%`
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ: `üí∞ Per-symbol offset –¥–ª—è BTC-USDT: 0.03%`

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –ø–∞—Ä–∞ –≤ —Ä–µ–∂–∏–º–µ ranging

**–ö–æ–Ω—Ñ–∏–≥:**
```yaml
by_regime:
  ranging:
    limit_offset_percent: 0.12
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ù–∞–π–¥–µ–Ω `per-regime` offset: `0.12%`
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ: `üí∞ Per-regime offset –¥–ª—è ranging: 0.12%`

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –ø–∞—Ä–∞ –±–µ–∑ —Ä–µ–∂–∏–º–∞

**–ö–æ–Ω—Ñ–∏–≥:**
```yaml
limit_offset_percent: 0.05
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≥–ª–æ–±–∞–ª—å–Ω—ã–π offset: `0.05%`
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ: `üí∞ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≥–ª–æ–±–∞–ª—å–Ω—ã–π offset: 0.05%`

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 5: Per-symbol offset = default_offset

**–ö–æ–Ω—Ñ–∏–≥:**
```yaml
limit_offset_percent: 0.05
by_symbol:
  "BTC-USDT":
    limit_offset_percent: 0.05  # –†–∞–≤–µ–Ω default_offset
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ù–∞–π–¥–µ–Ω `per-symbol` offset: `0.05%` (–Ω–µ fallback –Ω–∞ per-regime)
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ: `üí∞ Per-symbol offset –¥–ª—è BTC-USDT: 0.05%`

---

## ‚úÖ –ü–†–û–í–ï–†–ö–ê –†–ê–°–ß–ï–¢–ê –¶–ï–ù–´

### –î–ª—è BUY (LONG):

**–§–æ—Ä–º—É–ª–∞:**
```python
limit_price = best_ask * (1 + offset_percent / 100.0)
```

**–ü—Ä–∏–º–µ—Ä—ã:**
- BTC-USDT (ranging): `best_ask * 1.0008` (0.08%)
- XRP-USDT (ranging): `best_ask * 1.0018` (0.18%)
- –ì–ª–æ–±–∞–ª—å–Ω—ã–π: `best_ask * 1.0005` (0.05%)

**–í—ã–≤–æ–¥:** ‚úÖ –†–∞—Å—á–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π

---

### –î–ª—è SELL (SHORT):

**–§–æ—Ä–º—É–ª–∞:**
```python
limit_price = best_bid * (1 - offset_percent / 100.0)
```

**–ü—Ä–∏–º–µ—Ä—ã:**
- BTC-USDT (ranging): `best_bid * 0.9992` (0.08%)
- XRP-USDT (ranging): `best_bid * 0.9982` (0.18%)
- –ì–ª–æ–±–∞–ª—å–Ω—ã–π: `best_bid * 0.9995` (0.05%)

**–í—ã–≤–æ–¥:** ‚úÖ –†–∞—Å—á–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π

---

## ‚úÖ –ü–†–û–í–ï–†–ö–ê –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò

### Edge Cases:

1. **`by_symbol` –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç:**
   - ‚úÖ Fallback –Ω–∞ `per-regime` –∏–ª–∏ `global`
   - ‚úÖ –ù–µ –≤—ã–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–æ–∫

2. **`symbol` –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ `by_symbol`:**
   - ‚úÖ Fallback –Ω–∞ `per-regime` –∏–ª–∏ `global`
   - ‚úÖ –ù–µ –≤—ã–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–æ–∫

3. **`regime` –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω:**
   - ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `per-symbol` –∏–ª–∏ `global`
   - ‚úÖ –ù–µ –≤—ã–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–æ–∫

4. **`limit_offset_percent` = `None` –≤ –∫–æ–Ω—Ñ–∏–≥–µ:**
   - ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `default_offset = 0.0`
   - ‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π offset 0.01% –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

5. **`offset_percent` = 0.0:**
   - ‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π offset 0.01% –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
   - ‚úÖ –ì–∞—Ä–∞–Ω—Ç–∏—è –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –æ—Ä–¥–µ—Ä–∞

**–í—ã–≤–æ–¥:** ‚úÖ –í—Å–µ edge cases –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ

---

## ‚úÖ –ü–†–û–í–ï–†–ö–ê –°–û–í–ú–ï–°–¢–ò–ú–û–°–¢–ò

### –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:

1. **–°—Ç–∞—Ä—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (`by_regime`) –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å:**
   - ‚úÖ –ï—Å–ª–∏ `by_symbol` –Ω–µ –Ω–∞–π–¥–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `by_regime`
   - ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–æ–Ω—Ñ–∏–≥–∞—Ö

2. **–ù–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (`by_symbol`) –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã:**
   - ‚úÖ –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ `by_regime`
   - ‚úÖ –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ `by_symbol`
   - ‚úÖ –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–±–∞ –≤–º–µ—Å—Ç–µ

3. **–ì–ª–æ–±–∞–ª—å–Ω—ã–π fallback –≤—Å–µ–≥–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
   - ‚úÖ –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `limit_offset_percent`
   - ‚úÖ –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É —Å–∏—Å—Ç–µ–º—ã

**–í—ã–≤–æ–¥:** ‚úÖ –ü–æ–ª–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

---

## ‚úÖ –ò–¢–û–ì–û–í–ê–Ø –ü–†–û–í–ï–†–ö–ê

### –ì–∞—Ä–º–æ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã:

1. ‚úÖ **–õ–æ–≥–∏–∫–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤:** –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∏ –Ω–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É–µ—Ç
2. ‚úÖ **Fallback –∑–Ω–∞—á–µ–Ω–∏—è:** –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∏ —Ä–∞–±–æ—Ç–∞—é—Ç
3. ‚úÖ **–†–∞—Å—á–µ—Ç —Ü–µ–Ω—ã:** –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –¥–ª—è BUY –∏ SELL
4. ‚úÖ **Edge cases:** –í—Å–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ
5. ‚úÖ **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:** –ü–æ–ª–Ω–∞—è
6. ‚úÖ **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ü–æ–º–æ–≥–∞–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –≤—ã–±–æ—Ä offset

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:

1. ‚úÖ **–û—à–∏–±–∫–∏:** –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ fallback –∑–Ω–∞—á–µ–Ω–∏—è
2. ‚úÖ **None –∑–Ω–∞—á–µ–Ω–∏—è:** –ü—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
3. ‚úÖ **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π offset:** –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –°–ò–°–¢–ï–ú–ê –ì–ê–†–ú–û–ù–ò–ß–ù–ê, –ë–ï–ó–û–ü–ê–°–ù–ê –ò –ì–û–¢–û–í–ê –ö –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Æ

