# –ü–†–û–í–ï–†–ö–ê –õ–û–ì–ò–ö–ò –ù–ê–ü–†–ê–í–õ–ï–ù–ò–Ø –°–ò–ì–ù–ê–õ–û–í –ò PNL

**–î–∞—Ç–∞:** 23 –Ω–æ—è–±—Ä—è 2025  
**–¶–µ–ª—å:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –ª–æ–≥–∏–∫–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤ –∏ —Ä–∞—Å—á–µ—Ç–∞ PnL

---

## ‚úÖ –ü–†–û–í–ï–†–ö–ê –õ–û–ì–ò–ö–ò –ù–ê–ü–†–ê–í–õ–ï–ù–ò–Ø –°–ò–ì–ù–ê–õ–û–í

### –ú–æ–¥—É–ª—å: `signal_generator.py`

**–ú–µ—Ç–æ–¥:** `_check_ma_signal()` (—Å—Ç—Ä–æ–∫–∏ 2247-2588)

**–õ–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ü–µ–Ω—ã:**
1. ‚úÖ –ë–µ—Ä–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 —Å–≤–µ—á–µ–π –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
2. ‚úÖ –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç –ø–µ—Ä–≤—É—é –∏ –ø–æ—Å–ª–µ–¥–Ω—é—é —Ü–µ–Ω—É –≤ –æ–∫–Ω–µ
3. ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `price_change_threshold` –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 0.0005 = 0.05%)
4. ‚úÖ –¢–∞–∫–∂–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ 3 —Å–≤–µ—á–∏ –¥–ª—è –±–æ–ª–µ–µ –±—ã—Å—Ç—Ä–æ–π —Ä–µ–∞–∫—Ü–∏–∏

**–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤ –ø–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—é:**
- ‚úÖ **BULLISH —Å–∏–≥–Ω–∞–ª:** –ë–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –µ—Å–ª–∏ `price_direction == "down"` (—Å—Ç—Ä–æ–∫–∞ 2487)
- ‚úÖ **BEARISH —Å–∏–≥–Ω–∞–ª:** –ë–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –µ—Å–ª–∏ `price_direction == "up"` (—Å—Ç—Ä–æ–∫–∞ 2540)

**–í—ã–≤–æ–¥:** ‚úÖ –õ–æ–≥–∏–∫–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è. –°–∏–≥–Ω–∞–ª—ã —Ñ–∏–ª—å—Ç—Ä—É—é—Ç—Å—è –ø–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—é —Ü–µ–Ω—ã.

---

## ‚úÖ –ü–†–û–í–ï–†–ö–ê –†–ê–°–ß–ï–¢–ê PNL

### –ú–æ–¥—É–ª—å: `trailing_stop_loss.py`

**–ú–µ—Ç–æ–¥:** `get_profit_pct()` (—Å—Ç—Ä–æ–∫–∞ 374)

**–§–æ—Ä–º—É–ª–∞ –¥–ª—è LONG:**
```python
profit_pct = (current_price - entry_price) / entry_price
```

**–§–æ—Ä–º—É–ª–∞ –¥–ª—è SHORT:**
```python
profit_pct = (entry_price - current_price) / entry_price
```

**–£—á–µ—Ç –∫–æ–º–∏—Å—Å–∏–π:**
- ‚úÖ –ï—Å–ª–∏ `include_fees=True`: –≤—ã—á–∏—Ç–∞–µ—Ç—Å—è –∫–æ–º–∏—Å—Å–∏—è –≤—Ö–æ–¥–∞ –∏ –≤—ã—Ö–æ–¥–∞
- ‚úÖ –ö–æ–º–∏—Å—Å–∏—è —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ `trading_fee_rate * 2` (–≤—Ö–æ–¥ + –≤—ã—Ö–æ–¥)

**–í—ã–≤–æ–¥:** ‚úÖ –†–∞—Å—á–µ—Ç PnL –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –¥–ª—è LONG –∏ SHORT –ø–æ–∑–∏—Ü–∏–π.

---

## üîç –ê–ù–ê–õ–ò–ó –ü–†–û–ë–õ–ï–ú–´ ETH-USDT SHORT

### –î–∞–Ω–Ω—ã–µ:
- **–°–∏–≥–Ω–∞–ª:** ETH-USDT SHORT @ $2813.49 (—Å–∏–ª–∞=0.56)
- **–¶–µ–Ω–∞ –≤—Ö–æ–¥–∞:** 2816.28 USDT
- **–¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞:** 2843.81 USDT
- **PnL:** -1.76 USDT (-4.87% –æ—Ç –º–∞—Ä–∂–∏)

### –ê–Ω–∞–ª–∏–∑:

**1. –ü–æ—á–µ–º—É —Å–∏–≥–Ω–∞–ª –±—ã–ª SHORT –ø—Ä–∏ —Ä–æ—Å—Ç–µ —Ü–µ–Ω—ã?**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ `price_direction != "up"` —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚ö†Ô∏è –í–æ–∑–º–æ–∂–Ω–∞ –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π —Å–∏–≥–Ω–∞–ª–∞ –∏ –æ—Ç–∫—Ä—ã—Ç–∏–µ–º –ø–æ–∑–∏—Ü–∏–∏
- ‚ö†Ô∏è EMA –º–æ–≥–ª–∞ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–∞–¥–µ–Ω–∏–µ, –Ω–æ —Ü–µ–Ω–∞ —É–∂–µ –Ω–∞—á–∞–ª–∞ —Ä–∞—Å—Ç–∏

**2. –†–∞—Å—á–µ—Ç PnL:**
- ‚úÖ –§–æ—Ä–º—É–ª–∞ –¥–ª—è SHORT: `(2816.28 - 2843.81) / 2816.28 * 100 = -0.98%` –æ—Ç —Ü–µ–Ω—ã
- ‚úÖ –° –ª–µ–≤–µ—Ä–∏–¥–∂–µ–º 5x: `-0.98% * 5 = -4.9%` –æ—Ç –º–∞—Ä–∂–∏ ‚âà -4.87% ‚úÖ
- ‚úÖ –í USD: `(2816.28 - 2843.81) * 0.064 = -1.76 USDT` ‚úÖ

**–í—ã–≤–æ–¥:** ‚úÖ –†–∞—Å—á–µ—Ç PnL –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π. –ü–æ–∑–∏—Ü–∏—è –≤ –º–∏–Ω—É—Å–µ –∏–∑-–∑–∞ —Ä–æ—Å—Ç–∞ —Ü–µ–Ω—ã –ø–æ—Å–ª–µ –æ—Ç–∫—Ä—ã—Ç–∏—è SHORT –ø–æ–∑–∏—Ü–∏–∏.

---

## ‚úÖ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### 1. –£–ª—É—á—à–∏—Ç—å –ª–æ–≥–∏–∫—É –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤ ‚úÖ

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π —Å–∏–≥–Ω–∞–ª–∞ –∏ –æ—Ç–∫—Ä—ã—Ç–∏–µ–º –ø–æ–∑–∏—Ü–∏–∏
- EMA –º–æ–∂–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –æ–¥–Ω–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ, –∞ —Ü–µ–Ω–∞ —É–∂–µ –¥–≤–∏–∂–µ—Ç—Å—è –≤ –¥—Ä—É–≥–æ–º

**–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ü–µ–Ω—ã –ø–µ—Ä–µ–¥ –æ—Ç–∫—Ä—ã—Ç–∏–µ–º –ø–æ–∑–∏—Ü–∏–∏
- ‚úÖ –£—á–∏—Ç—ã–≤–∞—Ç—å –Ω–µ —Ç–æ–ª—å–∫–æ EMA, –Ω–æ –∏ —Ç–µ–∫—É—â–µ–µ –¥–≤–∏–∂–µ–Ω–∏–µ —Ü–µ–Ω—ã
- ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø–æ—Ä–æ–≥ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ü–µ–Ω—ã –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Å–∏–≥–Ω–∞–ª–∞

**–ú–æ–¥—É–ª—å:** `signal_generator.py` (–º–µ—Ç–æ–¥ `_check_ma_signal`)

---

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞—Å—á–µ—Ç PnL –≤–æ –≤—Å–µ—Ö –º–æ–¥—É–ª—è—Ö ‚úÖ

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- ‚úÖ `trailing_stop_loss.py` - –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç –¥–ª—è LONG –∏ SHORT
- ‚úÖ `position_manager.py` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `tsl.get_profit_pct()` ‚úÖ
- ‚úÖ `trailing_sl_coordinator.py` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `tsl.get_profit_pct()` ‚úÖ

**–í—ã–≤–æ–¥:** ‚úÖ –†–∞—Å—á–µ—Ç PnL –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤–æ –≤—Å–µ—Ö –º–æ–¥—É–ª—è—Ö.

---

### 3. –î–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –æ—Ç–∫—Ä—ã—Ç–∏–µ–º ‚úÖ

**–ú–æ–¥—É–ª—å:** `signal_coordinator.py` (–º–µ—Ç–æ–¥ `execute_signal_from_price`)

**–õ–æ–≥–∏–∫–∞:**
- –ü–µ—Ä–µ–¥ –æ—Ç–∫—Ä—ã—Ç–∏–µ–º –ø–æ–∑–∏—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–µ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω—ã
- –ï—Å–ª–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å - –æ—Ç–º–µ–Ω–∏—Ç—å –æ—Ç–∫—Ä—ã—Ç–∏–µ
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏—á–∏–Ω—É –æ—Ç–º–µ–Ω—ã

---

## ‚úÖ –í–´–í–û–î–´

### –õ–æ–≥–∏–∫–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤:
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ `price_direction`
- ‚ö†Ô∏è –í–æ–∑–º–æ–∂–Ω–∞ –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π —Å–∏–≥–Ω–∞–ª–∞ –∏ –æ—Ç–∫—Ä—ã—Ç–∏–µ–º –ø–æ–∑–∏—Ü–∏–∏
- ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –ø–µ—Ä–µ–¥ –æ—Ç–∫—Ä—ã—Ç–∏–µ–º

### –†–∞—Å—á–µ—Ç PnL:
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç –¥–ª—è LONG –∏ SHORT –ø–æ–∑–∏—Ü–∏–π
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —É—á–µ—Ç –∫–æ–º–∏—Å—Å–∏–π
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —É—á–µ—Ç –ª–µ–≤–µ—Ä–∏–¥–∂–∞

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –õ–æ–≥–∏–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –æ—Ç–∫—Ä—ã—Ç–∏–µ–º –ø–æ–∑–∏—Ü–∏–∏

