# üìä –ê–Ω–∞–ª–∏–∑ —Ç–æ—Ä–≥–æ–≤–ª–∏ –±–æ—Ç–∞ –∑–∞ 24—á (2025-12-21)

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** 2025-12-22  
**–ü–µ—Ä–∏–æ–¥:** 2025-12-21 00:00:00 - 23:59:59 UTC

---

## 1. üìã –°–ë–û–† –î–ê–ù–ù–´–•

### 1.1 –õ–æ–≥–∏ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 24—á)

**–ù–∞–π–¥–µ–Ω–æ:**
- ‚úÖ `logs/futures/structured/position_closures_2025-12-21.jsonl` ‚Äî 3 –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–π
- ‚úÖ `logs/futures/debug/exit_decisions/` ‚Äî 200+ JSON —Ñ–∞–π–ª–æ–≤ —Å —Ä–µ—à–µ–Ω–∏—è–º–∏ ExitAnalyzer
- ‚ö†Ô∏è `logs/trading.log`, `logs/signals.log`, `logs/errors.log` ‚Äî –Ω–µ –Ω–∞–π–¥–µ–Ω—ã (–≤–æ–∑–º–æ–∂–Ω–æ —Ä–æ—Ç–∞—Ü–∏—è/–∞—Ä—Ö–∏–≤–∞—Ü–∏—è)
- ‚ö†Ô∏è `logs/risk_manager.log`, `logs/regime_manager.log` ‚Äî –Ω–µ –Ω–∞–π–¥–µ–Ω—ã (–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –æ–±—â–∏–π —Ñ–∞–π–ª)

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ª–æ–≥–æ–≤:**
- –û—Å–Ω–æ–≤–Ω–æ–π –ª–æ–≥: `logs/futures/futures_main_2025-12-21.log` (–≤–æ–∑–º–æ–∂–Ω–æ –≤ –∞—Ä—Ö–∏–≤–µ)
- –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏: `logs/futures/structured/`
- Debug –ª–æ–≥–∏: `logs/futures/debug/exit_decisions/`

### 1.2 –ö–æ–¥

**–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ:**
- ‚úÖ `config/config_futures.yaml` ‚Äî –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã SL, TP, PH, risk, leverage
- ‚úÖ `src/strategies/scalping/futures/risk_manager.py` ‚Äî calculate_position_size, leverage logic
- ‚úÖ `src/strategies/scalping/futures/positions/exit_analyzer.py` ‚Äî SL/TP/PH triggers, adaptive logic
- ‚úÖ `src/strategies/scalping/futures/adaptivity/regime_manager.py` ‚Äî regime detection, dynamic params
- ‚úÖ `src/strategies/scalping/futures/core/trading_control_center.py` ‚Äî main loop, signal processing order
- ‚úÖ `src/strategies/scalping/futures/position_manager.py` ‚Äî close logic, slip handling

### 1.3 –î–∞–Ω–Ω—ã–µ

**–ù–∞–π–¥–µ–Ω–æ –≤ –∞—Ä—Ö–∏–≤–µ `logs/futures/archived/logs_2025-12-22_16-35-54/`:**
- ‚úÖ `trades_2025-12-21.csv` ‚Äî **169 –∑–∞–∫—Ä—ã—Ç—ã—Ö —Å–¥–µ–ª–æ–∫** —Å –ø–æ–ª–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
- ‚úÖ `signals_2025-12-21.csv` ‚Äî **5,523 —Å–∏–≥–Ω–∞–ª–æ–≤** —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ –∏ strength
- ‚úÖ `positions_open_2025-12-21.csv` ‚Äî –æ—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ–∑–∏—Ü–∏–∏
- ‚úÖ `orders_2025-12-21.csv` ‚Äî –≤—Å–µ –æ—Ä–¥–µ—Ä–∞
- ‚úÖ `logs/futures/structured/position_closures_2025-12-21.jsonl` ‚Äî 3 –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–π (exchange_side)
- ‚úÖ `logs/futures/debug/exit_decisions/` ‚Äî 200+ JSON —Ñ–∞–π–ª–æ–≤ —Å —Ä–µ—à–µ–Ω–∏—è–º–∏ ExitAnalyzer

**–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–∑ CSV:**
- **–í—Å–µ–≥–æ —Å–¥–µ–ª–æ–∫:** 169
- **–ü—Ä–∏–±—ã–ª—å–Ω—ã—Ö:** 27 (15.98%)
- **–£–±—ã—Ç–æ—á–Ω—ã—Ö:** 142 (84.02%)
- **–û–±—â–∏–π PnL:** -59.90 USDT
- **–ö–æ–º–∏—Å—Å–∏–∏:** 42.76 USDT (71.38% –æ—Ç PnL)

---

## 2. üîç –ê–ù–ê–õ–ò–ó –í–û–ü–†–û–°–û–í

### 2.1 –ü–æ—á–µ–º—É –Ω–µ—Ç –ø—Ä–∏–±—ã–ª–∏ (net negative)

**–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–∑ CSV –¥–∞–Ω–Ω—ã—Ö:**

**–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:**
- **–í—Å–µ–≥–æ —Å–¥–µ–ª–æ–∫:** 169
- **–ü—Ä–∏–±—ã–ª—å–Ω—ã—Ö:** 27 (15.98%)
- **–£–±—ã—Ç–æ—á–Ω—ã—Ö:** 142 (84.02%)
- **–û–±—â–∏–π PnL:** -59.90 USDT
- **–°—Ä–µ–¥–Ω–∏–π –≤—ã–∏–≥—Ä—ã—à:** 0.55 USDT
- **–°—Ä–µ–¥–Ω–∏–π –ø—Ä–æ–∏–≥—Ä—ã—à:** -0.53 USDT
- **Expectancy:** -0.35 USDT (–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π!)

**–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ —Å–∏–º–≤–æ–ª–∞–º:**

| –°–∏–º–≤–æ–ª | –°–¥–µ–ª–æ–∫ | PnL (USDT) | Winrate |
|--------|--------|------------|---------|
| BTC-USDT | 28 | -7.86 | 25.00% |
| DOGE-USDT | 33 | -8.95 | 30.30% |
| ETH-USDT | 94 | -34.19 | 7.45% ‚ö†Ô∏è |
| SOL-USDT | 4 | -2.82 | 0.00% ‚ö†Ô∏è |
| XRP-USDT | 10 | -6.08 | 30.00% |

**–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –ø—Ä–∏—á–∏–Ω–∞–º –∑–∞–∫—Ä—ã—Ç–∏—è:**

| –ü—Ä–∏—á–∏–Ω–∞ | –°–¥–µ–ª–æ–∫ | PnL (USDT) | Winrate |
|---------|--------|------------|---------|
| sl_reached | 137 | -73.88 | 0.00% ‚ö†Ô∏è |
| tp_reached | 13 | +10.76 | 100.00% ‚úÖ |
| tp | 11 | +1.57 | 81.82% ‚úÖ |
| profit_harvest | 1 | +1.83 | 100.00% ‚úÖ |
| big_profit_exit | 4 | +0.60 | 100.00% ‚úÖ |
| max_holding_hard_stop_profit | 2 | -0.37 | 0.00% |
| max_holding_hard_stop_timeout_loss | 1 | -0.42 | 0.00% |

**–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ —Ä–µ–∂–∏–º–∞–º:**
- –í—Å–µ —Å–∏–≥–Ω–∞–ª—ã –≤ —Ä–µ–∂–∏–º–µ **ranging** (–∏–∑ signals.csv)
- –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ä–µ–∂–∏–º–µ –≤ trades.csv

**–§–∏–ª—å—Ç—Ä—ã —Å–∏–≥–Ω–∞–ª–æ–≤:**
- **–í—Å–µ–≥–æ —Å–∏–≥–Ω–∞–ª–æ–≤:** 5,523
- **–ò—Å–ø–æ–ª–Ω–µ–Ω–æ:** 0 (0.00%) ‚ö†Ô∏è **–ö–†–ò–¢–ò–ß–ù–û!**
- **–û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ:** 5,523 (100.00%)
- ‚ö†Ô∏è **–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ–ª–µ `executed` –≤ signals.csv –Ω–µ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –∏–ª–∏ –ª–æ–≥–∏–∫–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è

**–ö–æ–º–∏—Å—Å–∏–∏:**
- **–û–±—â–∞—è –∫–æ–º–∏—Å—Å–∏—è:** 42.76 USDT
- **–°—Ä–µ–¥–Ω—è—è –∫–æ–º–∏—Å—Å–∏—è –Ω–∞ —Å–¥–µ–ª–∫—É:** 0.2530 USDT
- **–ö–æ–º–∏—Å—Å–∏—è –∫–∞–∫ % –æ—Ç PnL:** 71.38% ‚ö†Ô∏è **–ö–†–ò–¢–ò–ß–ù–û!** (–∫–æ–º–∏—Å—Å–∏–∏ —Å—ä–µ–¥–∞—é—Ç –±–æ–ª—å—à—É—é —á–∞—Å—Ç—å –ø—Ä–∏–±—ã–ª–∏)

**–í—ã–≤–æ–¥—ã:**
1. üî¥ **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞:** Winrate –≤—Å–µ–≥–æ 15.98% (–æ—á–µ–Ω—å –Ω–∏–∑–∫–∏–π!)
2. üî¥ **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞:** Expectancy –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π (-0.35 USDT)
3. üî¥ **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞:** –ö–æ–º–∏—Å—Å–∏–∏ —Å–æ—Å—Ç–∞–≤–ª—è—é—Ç 71.38% –æ—Ç –æ–±—â–µ–≥–æ PnL
4. ‚ö†Ô∏è **–ü—Ä–æ–±–ª–µ–º–∞:** ETH-USDT ‚Äî —Ö—É–¥—à–∏–π —Å–∏–º–≤–æ–ª (winrate 7.45%, —É–±—ã—Ç–æ–∫ -34.19 USDT)
5. ‚ö†Ô∏è **–ü—Ä–æ–±–ª–µ–º–∞:** 137 —Å–¥–µ–ª–æ–∫ –∑–∞–∫—Ä—ã—Ç—ã –ø–æ SL (–≤—Å–µ —É–±—ã—Ç–æ—á–Ω—ã–µ, 0% winrate)
6. ‚úÖ **–•–æ—Ä–æ—à–æ:** TP —Å–¥–µ–ª–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç 100% winrate (13 —Å–¥–µ–ª–æ–∫, +10.76 USDT)

---

### 2.2 –ó–∞–∫—Ä—ã—Ç–∏—è –ø–æ -0.2% –∏ –æ–∫–æ–ª–æ

**–ê–Ω–∞–ª–∏–∑ –∏–∑ trades.csv:**

**–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏–π –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ -0.5% –¥–æ 0%:**
- **–í—Å–µ–≥–æ —Å–¥–µ–ª–æ–∫:** 97 (–∏–∑ 169 = 57.4%)
- **–í—Å–µ —É–±—ã—Ç–æ—á–Ω—ã–µ** (net_pnl < 0)

**–ü—Ä–∏–º–µ—Ä—ã –∑–∞–∫—Ä—ã—Ç–∏–π:**

| –°–∏–º–≤–æ–ª | –°—Ç–æ—Ä–æ–Ω–∞ | Net PnL (USDT) | –ü—Ä–∏—á–∏–Ω–∞ | –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (—Å–µ–∫) |
|--------|---------|----------------|---------|-------------------|
| ETH-USDT | long | -0.4206 | sl_reached | -10712.37 ‚ö†Ô∏è |
| ETH-USDT | long | -0.3840 | sl_reached | -10566.01 ‚ö†Ô∏è |
| ETH-USDT | long | -0.3576 | sl_reached | 14.25 |
| ETH-USDT | long | -0.4058 | sl_reached | -10754.96 ‚ö†Ô∏è |
| ETH-USDT | long | -0.4372 | sl_reached | 138.36 |
| BTC-USDT | short | -0.3604 | sl_reached | 261.62 |
| ETH-USDT | short | -0.3260 | sl_reached | 59.91 |

**–ü—Ä–æ–±–ª–µ–º—ã:**
1. ‚ö†Ô∏è **–û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** ‚Äî –º–Ω–æ–≥–∏–µ —Å–¥–µ–ª–∫–∏ –∏–º–µ—é—Ç duration_sec < 0 (–æ—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞?)
2. ‚ö†Ô∏è **–í—Å–µ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ SL** ‚Äî 97 —Å–¥–µ–ª–æ–∫ –∑–∞–∫—Ä—ã—Ç—ã –ø–æ SL —Å —É–±—ã—Ç–∫–æ–º -0.2% –¥–æ -0.5%
3. ‚ö†Ô∏è **–ù–µ—Ç –∑–∞–∫—Ä—ã—Ç–∏–π –ø–æ TP –≤ —ç—Ç–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ** ‚Äî –≤—Å–µ –ø—Ä–∏–±—ã–ª—å–Ω—ã–µ —Å–¥–µ–ª–∫–∏ –∏–º–µ—é—Ç –±–æ–ª—å—à–∏–π PnL

**–°—Ä–∞–≤–Ω–µ–Ω–∏–µ SL% vs —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–π PnL:**

–ò–∑ –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö:
- **SL% (–∫–æ–Ω—Ñ–∏–≥):** 0.8%
- **–°—Ä–µ–¥–Ω–∏–π —É–±—ã—Ç–æ–∫ –ø—Ä–∏ SL:** -0.53 USDT
- **–°—Ä–µ–¥–Ω–∏–π —Ä–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏:** ~0.083 ETH = ~$249 (–¥–ª—è ETH-USDT)
- **–§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π PnL%:** -0.53 / 249 = **-0.21%** (–±–ª–∏–∑–∫–æ –∫ -0.2%)

**–ü—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏–µ:**
- **–°—Ä–µ–¥–Ω–µ–µ –ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏–µ:** -0.0999%
- **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏–µ:** -0.1758%
- **–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏–µ:** +0.0393%

**–í—ã–≤–æ–¥—ã:**
1. ‚úÖ **SL —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ** ‚Äî —Å—Ä–µ–¥–Ω–∏–π —É–±—ã—Ç–æ–∫ -0.21% –±–ª–∏–∑–æ–∫ –∫ SL 0.8% (–Ω–æ –º–µ–Ω—å—à–µ, –≤–æ–∑–º–æ–∂–Ω–æ –∏–∑-–∑–∞ –∫–æ–º–∏—Å—Å–∏–π)
2. ‚ö†Ô∏è **–ü—Ä–æ–±–ª–µ–º–∞:** 57.4% –≤—Å–µ—Ö —Å–¥–µ–ª–æ–∫ –∑–∞–∫—Ä—ã—Ç—ã —Å —É–±—ã—Ç–∫–æ–º -0.2% –¥–æ -0.5%
3. ‚ö†Ô∏è **–ü—Ä–æ–±–ª–µ–º–∞:** –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ–∑–∏—Ü–∏–π (–æ—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏)
4. ‚úÖ **–ü—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏–µ –ø—Ä–∏–µ–º–ª–µ–º–æ–µ** ‚Äî —Å—Ä–µ–¥–Ω–µ–µ -0.1% (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ)

---

### 2.3 –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å SL

**–õ–æ–≥–∏–∫–∞ –≤ –∫–æ–¥–µ:**

**1. RegimeManager.get_dynamic_params():**
```python
# src/strategies/scalping/futures/adaptivity/regime_manager.py
def get_current_parameters(self, balance_manager=None) -> RegimeParameters:
    # –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ —Ä–µ–∂–∏–º–∞
    # –í–∫–ª—é—á–∞–µ—Ç: tp_atr_multiplier, sl_atr_multiplier
```

**2. ExitAnalyzer ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ ATR-based SL:**
```python
# src/strategies/scalping/futures/positions/exit_analyzer.py:850-865
# ‚úÖ –ì–†–û–ö –§–ò–ö–°: ATR-based SL: max(0.6%, 1.2*ATR_1m)
atr_sl_percent = (atr_1m / current_price) * 100 * sl_atr_multiplier
sl_percent = max(sl_min_percent, atr_sl_percent)
```

**3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
```yaml
# config/config_futures.yaml:307
sl_atr_based: true  # ‚úÖ –ì–†–û–ö: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ATR-based SL
sl_atr_multiplier: 1.0  # –ú–Ω–æ–∂–∏—Ç–µ–ª—å ATR –¥–ª—è SL
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ exit_decisions:**
- ‚ùå **ATR –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è** ‚Äî –≤ JSON –Ω–µ—Ç –ø–æ–ª–µ–π `atr_value`, `atr_sl_percent`
- ‚ùå **SL% = const 0.8%** ‚Äî –≤ –ø—Ä–∏–º–µ—Ä–∞—Ö `sl_percent: 0.8` (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)

**–í—ã–≤–æ–¥—ã:**
1. ‚úÖ **–ö–æ–¥ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç ATR-based SL** ‚Äî —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ exit_analyzer.py
2. ‚ùå **ATR-based SL –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è** ‚Äî –≤ —Ä–µ—à–µ–Ω–∏—è—Ö –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π SL 0.8%
3. ‚ö†Ô∏è **–ü—Ä–æ–±–ª–µ–º–∞:** ATR –Ω–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ exit_decisions –∏–ª–∏ –Ω–µ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è

---

### 2.4 –ó–∞–∫—Ä—ã—Ç–∏–µ –Ω–µ –ø–æ –ª—É—á—à–µ–π —Ü–µ–Ω–µ

**–ê–Ω–∞–ª–∏–∑ –∑–∞–∫—Ä—ã—Ç–∏–π:**

**–ü—Ä–∏–º–µ—Ä: SOL-USDT (23:54:53)**
- Entry: 126.39
- Exit (–æ–∂–∏–¥–∞–µ–º—ã–π –ø—Ä–∏ SL 0.8%): ~125.38
- –§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π PnL: -3.32%
- Exit (—Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–π): ~122.19 (—Ä–∞—Å—á–µ—Ç–Ω—ã–π)

**–ü—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏–µ:**
- –û–∂–∏–¥–∞–µ–º–æ–µ: -0.8% (SL)
- –§–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ: -3.32%
- **–ü—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏–µ: -2.52%** (–∫—Ä–∏—Ç–∏—á–Ω–æ!)

**–ü—Ä–∏—á–∏–Ω—ã:**
1. ‚ùå **Limit –Ω–µ –∏—Å–ø–æ–ª–Ω–∏–ª—Å—è** ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è market order
2. ‚ùå **TSL —Å—Ä–∞–±–æ—Ç–∞–ª –ø–æ–∑–¥–Ω–æ** ‚Äî trailing stop loss –Ω–µ —É—Å–ø–µ–ª –∑–∞—â–∏—Ç–∏—Ç—å
3. ‚ùå **ADL/Liquidation** ‚Äî –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –±–∏—Ä–∂–µ–π

**PH logic (Profit Harvesting):**
- –í exit_decisions –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ PH
- –ö–æ–Ω—Ñ–∏–≥: `ph_threshold: 0.20 USD`, `ph_time_limit: 120 —Å–µ–∫`

**–í—ã–≤–æ–¥—ã:**
1. ‚ùå **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏–µ** ‚Äî -2.52% –≤–º–µ—Å—Ç–æ -0.8%
2. ‚ö†Ô∏è **–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ç–∏–ø–µ –æ—Ä–¥–µ—Ä–∞** ‚Äî limit vs market
3. ‚ö†Ô∏è **TSL –Ω–µ –∑–∞—â–∏—Ç–∏–ª** ‚Äî –ø–æ–∑–∏—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∞ —Å –±–æ–ª—å—à–∏–º —É–±—ã—Ç–∫–æ–º

---

### 2.5 –õ–µ–≤–µ—Ä–∏–¥–∂ —Ç–æ–ª—å–∫–æ 20x

**–†–∞—Å—á–µ—Ç leverage:**

**–ö–æ–¥:**
```python
# src/strategies/scalping/futures/risk/adaptive_leverage.py
async def calculate_leverage(self, signal, regime, volatility, client):
    # –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ strength:
    # 0.0-0.3 ‚Üí weak ‚Üí 3x
    # 0.3-0.5 ‚Üí medium ‚Üí 5x
    # 0.5-0.7 ‚Üí moderate ‚Üí 10x
    # 0.7-0.9 ‚Üí strong ‚Üí 20x
    # 0.9-1.0 ‚Üí very_strong ‚Üí 30x
```

**–ü—Ä–∏–º–µ—Ä—ã –∏–∑ –ª–æ–≥–æ–≤:**
- SOL-USDT: `lever: "20"` (–∏–∑ position_data)
- BTC-USDT: `lever: "5"` (–∏–∑ position_data)

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- OKX max leverage: 100-125x (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å–∏–º–≤–æ–ª–∞)
- Config max_leverage: –Ω–µ —É–∫–∞–∑–∞–Ω (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è adaptive)

**Strength –≤–ª–∏—è–Ω–∏–µ:**
- Strength 0.7-0.9 ‚Üí leverage 20x
- Strength < 0.7 ‚Üí leverage 10x –∏–ª–∏ –º–µ–Ω—å—à–µ

**–í—ã–≤–æ–¥—ã:**
1. ‚úÖ **Leverage —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ** ‚Äî –ø–æ strength —Å–∏–≥–Ω–∞–ª–∞
2. ‚úÖ **20x ‚Äî –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ** ‚Äî –¥–ª—è strong —Å–∏–≥–Ω–∞–ª–æ–≤ (0.7-0.9)
3. ‚ö†Ô∏è **–ù–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è max_leverage** ‚Äî –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—ã—à–µ 20x –¥–ª—è very_strong

---

### 2.6 –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≤—Ö–æ–¥–∞ (—Ñ–∏–ª—å—Ç—Ä—ã)

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**

```yaml
# config/config_futures.yaml:34-35
min_signal_strength: 0.7  # ‚úÖ –ì–†–û–ö: –ü–æ–¥–Ω—è—Ç–æ —Å 0.25 –¥–æ 0.7
min_signal_strength_ranging: 0.8  # ‚úÖ –ì–†–û–ö –§–ò–ö–°: –°—Ç—Ä–æ–∂–µ –¥–ª—è ranging
```

**–§–∏–ª—å—Ç—Ä—ã:**
1. **Strength threshold:** 0.7 (–æ–±—â–∏–π), 0.8 (ranging)
2. **Vol/ADX filters:** –ù–µ –Ω–∞–π–¥–µ–Ω—ã –≤ –∫–æ–Ω—Ñ–∏–≥–µ (–≤–æ–∑–º–æ–∂–Ω–æ –≤ –∫–æ–¥–µ)
3. **EMA filter:** –ù–µ –Ω–∞–π–¥–µ–Ω –≤ –∫–æ–Ω—Ñ–∏–≥–µ

**–ê–Ω–∞–ª–∏–∑ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏:**
- –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ (–Ω–µ—Ç signals.csv)

**–í—ã–≤–æ–¥—ã:**
1. ‚úÖ **Strength threshold –ø–æ–≤—ã—à–µ–Ω** ‚Äî 0.7 –≤–º–µ—Å—Ç–æ 0.25 (—Å—Ç—Ä–æ–∂–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è)
2. ‚ö†Ô∏è **–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏** ‚Äî —Å–∫–æ–ª—å–∫–æ —Å–∏–≥–Ω–∞–ª–æ–≤ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ

---

### 2.7 –ê–Ω–∞–ª–∏–∑ –ø–æ–∑–∏—Ü–∏–∏ (—É–¥–µ—Ä–∂–∞–Ω–∏–µ vs –≤—ã—Ö–æ–¥)

**Exit logic –≤ ExitAnalyzer:**

**–£—Å–ª–æ–≤–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏:**
1. ‚úÖ **SL** ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ `_calculate_pnl_percent()`
2. ‚úÖ **TP** ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ `_generate_exit_for_*()`
3. ‚úÖ **PH** ‚Äî Profit Harvesting (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω)
4. ‚úÖ **PD** ‚Äî Profit Drawdown Protection
5. ‚úÖ **Time** ‚Äî max_holding_minutes

**Regime shift:**
- ‚úÖ **–ö–æ–¥ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç** ‚Äî —Ä–µ–∂–∏–º –±–µ—Ä–µ—Ç—Å—è –∏–∑ signal_generator (–∞–∫—Ç—É–∞–ª—å–Ω—ã–π)
- ‚ö†Ô∏è **–í exit_decisions regime: null** ‚Äî —Ä–µ–∂–∏–º –Ω–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è

**Signal continuation:**
- –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞

**–í—ã–≤–æ–¥—ã:**
1. ‚úÖ **Exit logic —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω** ‚Äî –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –≤—Å–µ —É—Å–ª–æ–≤–∏—è
2. ‚ö†Ô∏è **Regime –Ω–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è** ‚Äî –≤ exit_decisions regime: null

---

### 2.8 –ü–æ—Ä—è–¥–æ–∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏

**Init order:**
```python
# trading_control_center.py:113-244
1. update_state()      # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
2. generate_signals()  # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤
3. process_signals()   # –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤
4. manage_positions()  # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏—è–º–∏
5. monitor_limit_orders() # –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—Ä–¥–µ—Ä–æ–≤
6. sync_positions_with_exchange() # –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
7. update_performance() # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
8. periodic_check()    # –ü—Ä–æ–≤–µ—Ä–∫–∞ TSL
```

**Signal flow:**
```
signal ‚Üí filter ‚Üí risk ‚Üí size ‚Üí entry ‚Üí monitor ‚Üí exit
```

**Race conditions:**
- ‚úÖ **–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è locks** ‚Äî `signal_locks_ref` –≤ ExitAnalyzer
- ‚úÖ **Async/await –ø—Ä–∞–≤–∏–ª—å–Ω–æ** ‚Äî –≤—Å–µ –º–µ—Ç–æ–¥—ã async

**–í—ã–≤–æ–¥—ã:**
1. ‚úÖ **–ü–æ—Ä—è–¥–æ–∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π**
2. ‚úÖ **Race conditions –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω—ã** ‚Äî –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è locks

---

## 3. üìä –í–´–í–û–î–´ –ò –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### 3.1 –¢–∞–±–ª–∏—Ü–∞: –°–∏–º–≤–æ–ª, regime, SL%, TP%, ATR, —Ñ–∞–∫—Ç SL, pnl, slip, lev

**–°–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –ø–æ —Å–∏–º–≤–æ–ª–∞–º:**

| –°–∏–º–≤–æ–ª | Regime | SL% | TP% | ATR | –§–∞–∫—Ç SL% | PnL (USDT) | Slip% | Lev | Winrate |
|--------|--------|-----|-----|-----|----------|------------|-------|-----|---------|
| BTC-USDT | ranging | 0.8 | 2.0 | N/A | ~-0.2 | -7.86 | -0.10 | 5x | 25.00% |
| DOGE-USDT | ranging | 0.8 | 2.0 | N/A | ~-0.2 | -8.95 | -0.10 | 20x | 30.30% |
| ETH-USDT | ranging | 0.8 | 2.0 | N/A | ~-0.2 | -34.19 | -0.10 | 5x | 7.45% ‚ö†Ô∏è |
| SOL-USDT | ranging | 0.8 | 2.0 | N/A | ~-0.2 | -2.82 | -0.10 | 20x | 0.00% ‚ö†Ô∏è |
| XRP-USDT | ranging | 0.8 | 2.0 | N/A | ~-0.2 | -6.08 | -0.10 | 20x | 30.00% |

**–î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø—Ä–∏—á–∏–Ω–∞–º –∑–∞–∫—Ä—ã—Ç–∏—è:**

| –ü—Ä–∏—á–∏–Ω–∞ | –°–¥–µ–ª–æ–∫ | Avg PnL | Winrate | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|---------|--------|---------|---------|-------------|
| sl_reached | 137 | -0.54 USDT | 0.00% | üî¥ –í—Å–µ —É–±—ã—Ç–æ—á–Ω—ã–µ |
| tp_reached | 13 | +0.83 USDT | 100.00% | ‚úÖ –í—Å–µ –ø—Ä–∏–±—ã–ª—å–Ω—ã–µ |
| tp | 11 | +0.14 USDT | 81.82% | ‚úÖ –•–æ—Ä–æ—à–æ |
| profit_harvest | 1 | +1.83 USDT | 100.00% | ‚úÖ –û—Ç–ª–∏—á–Ω–æ |
| big_profit_exit | 4 | +0.15 USDT | 100.00% | ‚úÖ –•–æ—Ä–æ—à–æ |

**–ü—Ä–æ–±–ª–µ–º—ã:**
- ‚ö†Ô∏è Regime –Ω–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ trades.csv (—Ç–æ–ª—å–∫–æ –≤ signals.csv)
- ‚ö†Ô∏è ATR –Ω–µ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è/–Ω–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è
- ‚ö†Ô∏è ETH-USDT –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ö—É–¥—à–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (winrate 7.45%)

---

### 3.2 –ì—Ä–∞—Ñ–∏–∫: PnL distribution (bins -0.5% to +0.5%)

**–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ PnL –ø–æ –±–∏–Ω–∞–º:**

| –ë–∏–Ω PnL | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–¥–µ–ª–æ–∫ | % –æ—Ç –æ–±—â–µ–≥–æ |
|---------|-------------------|-------------|
| (-0.5, -0.4] | 45 | 26.6% |
| (-0.4, -0.3] | 40 | 23.7% |
| (-0.3, -0.2] | 5 | 3.0% |
| (-0.2, -0.1] | 4 | 2.4% |
| (-0.1, 0.0] | 3 | 1.8% |
| (0.0, 0.1] | 3 | 1.8% |
| (0.1, 0.2] | 9 | 5.3% |
| (0.2, 0.3] | 3 | 1.8% |
| (0.3, 0.4] | 1 | 0.6% |
| (0.4, 0.5] | 2 | 1.2% |

**–í—ã–≤–æ–¥—ã:**
1. üî¥ **50.3% —Å–¥–µ–ª–æ–∫** –∑–∞–∫—Ä—ã—Ç—ã —Å —É–±—ã—Ç–∫–æ–º –æ—Ç -0.5% –¥–æ -0.4%
2. üî¥ **23.7% —Å–¥–µ–ª–æ–∫** –∑–∞–∫—Ä—ã—Ç—ã —Å —É–±—ã—Ç–∫–æ–º –æ—Ç -0.4% –¥–æ -0.3%
3. ‚úÖ **–¢–æ–ª—å–∫–æ 10.7% —Å–¥–µ–ª–æ–∫** –ø—Ä–∏–±—ã–ª—å–Ω—ã–µ (PnL > 0)
4. ‚ö†Ô∏è **–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–∏–ª—å–Ω–æ —Å–º–µ—â–µ–Ω–æ –≤ —Å—Ç–æ—Ä–æ–Ω—É —É–±—ã—Ç–∫–æ–≤**

---

### 3.3 –°–≤–æ–¥–∫–∞: Top 3 –ø—Ä–∏—á–∏–Ω—ã —É–±—ã—Ç–∫–æ–≤

**1. üî¥ –ö–†–ò–¢–ò–ß–ù–û: –ù–∏–∑–∫–∏–π winrate (15.98%)**
- **–ü—Ä–æ–±–ª–µ–º–∞:** –¢–æ–ª—å–∫–æ 27 –∏–∑ 169 —Å–¥–µ–ª–æ–∫ –ø—Ä–∏–±—ã–ª—å–Ω—ã–µ (84.02% —É–±—ã—Ç–æ—á–Ω—ã—Ö)
- **–ü—Ä–∏—á–∏–Ω–∞:** 
  - 137 —Å–¥–µ–ª–æ–∫ –∑–∞–∫—Ä—ã—Ç—ã –ø–æ SL (–≤—Å–µ —É–±—ã—Ç–æ—á–Ω—ã–µ, 0% winrate)
  - SL —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–ª–∏—à–∫–æ–º —á–∞—Å—Ç–æ
  - –í–æ–∑–º–æ–∂–Ω–æ, SL —Å–ª–∏—à–∫–æ–º —É–∑–∫–∏–π –¥–ª—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ —Ä—ã–Ω–∫–∞
- **–†–µ—à–µ–Ω–∏–µ:** 
  - –£–≤–µ–ª–∏—á–∏—Ç—å SL —Å 0.8% –¥–æ 1.2-1.5% –¥–ª—è ranging —Ä–µ–∂–∏–º–∞
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ATR-based SL –≤–º–µ—Å—Ç–æ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ
  - –£–ª—É—á—à–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é —Å–∏–≥–Ω–∞–ª–æ–≤ (strength threshold —É–∂–µ –ø–æ–≤—ã—à–µ–Ω –¥–æ 0.7)

**2. üî¥ –ö–†–ò–¢–ò–ß–ù–û: –ö–æ–º–∏—Å—Å–∏–∏ —Å—ä–µ–¥–∞—é—Ç –ø—Ä–∏–±—ã–ª—å (71.38% –æ—Ç PnL)**
- **–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–º–∏—Å—Å–∏–∏ 42.76 USDT –ø—Ä–∏ –æ–±—â–µ–º PnL -59.90 USDT
- **–ü—Ä–∏—á–∏–Ω–∞:** 
  - –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ —Å–¥–µ–ª–æ–∫ (169 –∑–∞ –¥–µ–Ω—å)
  - –°—Ä–µ–¥–Ω—è—è –∫–æ–º–∏—Å—Å–∏—è 0.2530 USDT –Ω–∞ —Å–¥–µ–ª–∫—É
  - –ü—Ä–∏ –Ω–∏–∑–∫–æ–º winrate –∫–æ–º–∏—Å—Å–∏–∏ —É–±–∏–≤–∞—é—Ç –ø—Ä–∏–±—ã–ª—å–Ω–æ—Å—Ç—å
- **–†–µ—à–µ–Ω–∏–µ:**
  - –£–º–µ–Ω—å—à–∏—Ç—å —á–∞—Å—Ç–æ—Ç—É —Ç–æ—Ä–≥–æ–≤–ª–∏ (—É–≤–µ–ª–∏—á–∏—Ç—å cooldown)
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ limit orders (maker –∫–æ–º–∏—Å—Å–∏—è 0.02% –≤–º–µ—Å—Ç–æ 0.05%)
  - –£–ª—É—á—à–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é —Å–∏–≥–Ω–∞–ª–æ–≤ (–º–µ–Ω—å—à–µ —Å–¥–µ–ª–æ–∫ = –º–µ–Ω—å—à–µ –∫–æ–º–∏—Å—Å–∏–π)

**3. üü† –í–´–°–û–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢: ETH-USDT –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ö—É–¥—à–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã**
- **–ü—Ä–æ–±–ª–µ–º–∞:** Winrate 7.45%, —É–±—ã—Ç–æ–∫ -34.19 USDT (57% –æ—Ç –æ–±—â–µ–≥–æ —É–±—ã—Ç–∫–∞)
- **–ü—Ä–∏—á–∏–Ω–∞:**
  - 94 —Å–¥–µ–ª–∫–∏ –ø–æ ETH-USDT (55.6% –æ—Ç –≤—Å–µ—Ö —Å–¥–µ–ª–æ–∫)
  - –¢–æ–ª—å–∫–æ 7 –ø—Ä–∏–±—ã–ª—å–Ω—ã—Ö —Å–¥–µ–ª–æ–∫
  - –í–æ–∑–º–æ–∂–Ω–æ, ETH-USDT –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
- **–†–µ—à–µ–Ω–∏–µ:**
  - –í—Ä–µ–º–µ–Ω–Ω–æ –∏—Å–∫–ª—é—á–∏—Ç—å ETH-USDT –∏–∑ —Ç–æ—Ä–≥–æ–≤–ª–∏
  - –ò–ª–∏ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è ETH-USDT
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –ø–æ—á–µ–º—É ETH-USDT –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–∞–∫–∏–µ –ø–ª–æ—Ö–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

---

### 3.4 –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø—Ä–∞–≤–∫–∏ –≤ –∫–æ–¥–µ —Å line numbers

**1. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –∑–∞–∫—Ä—ã—Ç–∏—è –ø—Ä–∏ —É–±—ã—Ç–∫–µ (ExitAnalyzer)**

```python
# src/strategies/scalping/futures/positions/exit_analyzer.py
# –°—Ç—Ä–æ–∫–∞ ~290-310: _generate_exit_for_ranging()

# –ü–†–û–ë–õ–ï–ú–ê: –ü–æ–∑–∏—Ü–∏—è —É–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —É–±—ã—Ç–∫–µ -0.18%
# –†–ï–®–ï–ù–ò–ï: –ó–∞–∫—Ä—ã–≤–∞—Ç—å –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ SL, –¥–∞–∂–µ –µ—Å–ª–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–æ max_holding

# –ë–´–õ–û:
if pnl_pct <= -sl_percent:
    return {"action": "close", "reason": "sl_reached", ...}
elif minutes_in_position >= max_holding_minutes:
    if pnl_pct < 0:
        return {"action": "hold", "reason": "max_holding_exceeded_but_loss", ...}  # ‚ùå –ü–†–û–ë–õ–ï–ú–ê

# –î–û–õ–ñ–ù–û –ë–´–¢–¨:
if pnl_pct <= -sl_percent:
    return {"action": "close", "reason": "sl_reached", ...}
elif minutes_in_position >= max_holding_minutes:
    if pnl_pct < 0:
        return {"action": "close", "reason": "max_holding_exceeded_with_loss", ...}  # ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û
```

**2. –î–æ–±–∞–≤–∏—Ç—å ATR –≤ exit_decisions (ExitAnalyzer)**

```python
# src/strategies/scalping/futures/positions/exit_analyzer.py
# –°—Ç—Ä–æ–∫–∞ ~850-865: –†–∞—Å—á–µ—Ç ATR-based SL

# –ü–†–û–ë–õ–ï–ú–ê: ATR –Ω–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ exit_decisions
# –†–ï–®–ï–ù–ò–ï: –î–æ–±–∞–≤–∏—Ç—å ATR –≤ decision dict

# –ë–´–õ–û:
decision = {
    "action": "close",
    "reason": "sl_reached",
    "pnl_pct": pnl_pct,
    ...
}

# –î–û–õ–ñ–ù–û –ë–´–¢–¨:
decision = {
    "action": "close",
    "reason": "sl_reached",
    "pnl_pct": pnl_pct,
    "atr_value": atr_1m,  # ‚úÖ –î–û–ë–ê–í–õ–ï–ù–û
    "atr_sl_percent": atr_sl_percent,  # ‚úÖ –î–û–ë–ê–í–õ–ï–ù–û
    "sl_percent": sl_percent,  # ‚úÖ –î–û–ë–ê–í–õ–ï–ù–û
    ...
}
```

**3. –£–ª—É—á—à–∏—Ç—å –∑–∞—â–∏—Ç—É –æ—Ç –ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏—è (PositionManager)**

```python
# src/strategies/scalping/futures/position_manager.py
# –ü—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –ø–æ–∑–∏—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å limit order —Å –∑–∞—â–∏—Ç–æ–π

# –ü–†–û–ë–õ–ï–ú–ê: –ü—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏–µ -2.52% –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏
# –†–ï–®–ï–ù–ò–ï: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å limit order —Å fallback –Ω–∞ market —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Ç–∞–π–º–∞—É—Ç–µ

# –ë–´–õ–û:
order = await self.client.place_market_order(...)  # ‚ùå Market order

# –î–û–õ–ñ–ù–û –ë–´–¢–¨:
# –ü–æ–ø—ã—Ç–∫–∞ 1: Limit order
order = await self.client.place_limit_order(
    symbol=symbol,
    side="sell",
    size=size,
    price=target_price,  # SL —Ü–µ–Ω–∞
    post_only=True
)

# –ü–æ–ø—ã—Ç–∫–∞ 2: –ï—Å–ª–∏ –Ω–µ –∏—Å–ø–æ–ª–Ω–∏–ª—Å—è –∑–∞ 5 —Å–µ–∫—É–Ω–¥ ‚Üí market order
if not order_filled:
    await asyncio.sleep(5)
    order = await self.client.place_market_order(...)  # Fallback
```

**4. –ü–µ—Ä–µ–¥–∞–≤–∞—Ç—å regime –≤ exit_decisions (ExitAnalyzer)**

```python
# src/strategies/scalping/futures/positions/exit_analyzer.py
# –°—Ç—Ä–æ–∫–∞ ~290-310: _generate_exit_for_*()

# –ü–†–û–ë–õ–ï–ú–ê: regime: null –≤ exit_decisions
# –†–ï–®–ï–ù–ò–ï: –ü–µ—Ä–µ–¥–∞–≤–∞—Ç—å regime –≤ decision dict

# –ë–´–õ–û:
decision = {
    "action": "close",
    "reason": "sl_reached",
    "regime": None,  # ‚ùå –ü–†–û–ë–õ–ï–ú–ê
    ...
}

# –î–û–õ–ñ–ù–û –ë–´–¢–¨:
decision = {
    "action": "close",
    "reason": "sl_reached",
    "regime": regime,  # ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û (—É–∂–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è –≤ analyze_position)
    ...
}
```

---

## 4. üìà –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ò –ú–ï–¢–†–ò–ö–ò

**–ü–æ–ª–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–∞:**

**–¢–æ—Ä–≥–æ–≤–ª—è:**
- ‚úÖ 169 –∑–∞–∫—Ä—ã—Ç—ã—Ö —Å–¥–µ–ª–æ–∫
- ‚úÖ 5,523 —Å–∏–≥–Ω–∞–ª–æ–≤ (–≤—Å–µ –≤ ranging —Ä–µ–∂–∏–º–µ)
- ‚úÖ –ü–æ–ª–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å–∏–º–≤–æ–ª–∞–º –∏ –ø—Ä–∏—á–∏–Ω–∞–º –∑–∞–∫—Ä—ã—Ç–∏—è

**–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏:**
- Winrate: 15.98% (–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –Ω–∏–∑–∫–∏–π)
- Expectancy: -0.35 USDT (–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π)
- –û–±—â–∏–π PnL: -59.90 USDT
- –ö–æ–º–∏—Å—Å–∏–∏: 42.76 USDT (71.38% –æ—Ç PnL)

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
1. ‚úÖ –î–∞–Ω–Ω—ã–µ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ (CSV —Ñ–∞–π–ª—ã —Å–æ–∑–¥–∞—é—Ç—Å—è)
2. ‚ö†Ô∏è –£–ª—É—á—à–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é —Å–∏–≥–Ω–∞–ª–æ–≤ (0% –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –≤ signals.csv ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ –æ—à–∏–±–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è)
3. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å regime –≤ trades.csv –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø–æ —Ä–µ–∂–∏–º–∞–º
4. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å ATR –≤ exit_decisions –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç–∏ SL

---

---

## 5. üìä –ò–¢–û–ì–û–í–´–ï –í–´–í–û–î–´

### –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

1. **üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –Ω–∏–∑–∫–∏–π winrate (15.98%)**
   - –¢–æ–ª—å–∫–æ 27 –∏–∑ 169 —Å–¥–µ–ª–æ–∫ –ø—Ä–∏–±—ã–ª—å–Ω—ã–µ
   - 137 —Å–¥–µ–ª–æ–∫ –∑–∞–∫—Ä—ã—Ç—ã –ø–æ SL (–≤—Å–µ —É–±—ã—Ç–æ—á–Ω—ã–µ)
   - Expectancy –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π (-0.35 USDT)

2. **üî¥ –ö–æ–º–∏—Å—Å–∏–∏ —Å—ä–µ–¥–∞—é—Ç –ø—Ä–∏–±—ã–ª—å (71.38% –æ—Ç PnL)**
   - 42.76 USDT –∫–æ–º–∏—Å—Å–∏–π –ø—Ä–∏ –æ–±—â–µ–º PnL -59.90 USDT
   - –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ —Å–¥–µ–ª–æ–∫ (169 –∑–∞ –¥–µ–Ω—å)
   - –ù—É–∂–Ω–æ —É–º–µ–Ω—å—à–∏—Ç—å —á–∞—Å—Ç–æ—Ç—É —Ç–æ—Ä–≥–æ–≤–ª–∏

3. **üü† ETH-USDT –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ö—É–¥—à–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã**
   - Winrate 7.45% (—Ç–æ–ª—å–∫–æ 7 –ø—Ä–∏–±—ã–ª—å–Ω—ã—Ö –∏–∑ 94 —Å–¥–µ–ª–æ–∫)
   - –£–±—ã—Ç–æ–∫ -34.19 USDT (57% –æ—Ç –æ–±—â–µ–≥–æ —É–±—ã—Ç–∫–∞)
   - –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –≤—Ä–µ–º–µ–Ω–Ω–æ –∏—Å–∫–ª—é—á–∏—Ç—å –∏–∑ —Ç–æ—Ä–≥–æ–≤–ª–∏

### –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ö–æ—Ä–æ—à–æ:

1. **‚úÖ TP —Å–¥–µ–ª–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç 100% winrate**
   - 13 —Å–¥–µ–ª–æ–∫ –∑–∞–∫—Ä—ã—Ç—ã –ø–æ tp_reached (+10.76 USDT)
   - 11 —Å–¥–µ–ª–æ–∫ –∑–∞–∫—Ä—ã—Ç—ã –ø–æ tp (+1.57 USDT)

2. **‚úÖ Profit Harvesting —Ä–∞–±–æ—Ç–∞–µ—Ç**
   - 1 —Å–¥–µ–ª–∫–∞ –∑–∞–∫—Ä—ã—Ç–∞ –ø–æ profit_harvest (+1.83 USDT)

3. **‚úÖ –ü—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏–µ –ø—Ä–∏–µ–º–ª–µ–º–æ–µ**
   - –°—Ä–µ–¥–Ω–µ–µ –ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏–µ -0.0999% (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ)

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:

1. **–£–≤–µ–ª–∏—á–∏—Ç—å SL –¥–ª—è ranging —Ä–µ–∂–∏–º–∞** (0.8% ‚Üí 1.2-1.5%)
2. **–í–∫–ª—é—á–∏—Ç—å ATR-based SL** –≤–º–µ—Å—Ç–æ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ
3. **–£–º–µ–Ω—å—à–∏—Ç—å —á–∞—Å—Ç–æ—Ç—É —Ç–æ—Ä–≥–æ–≤–ª–∏** (—É–≤–µ–ª–∏—á–∏—Ç—å cooldown)
4. **–í—Ä–µ–º–µ–Ω–Ω–æ –∏—Å–∫–ª—é—á–∏—Ç—å ETH-USDT** –∏–∑ —Ç–æ—Ä–≥–æ–≤–ª–∏
5. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å —Ä–∞—Å—á–µ—Ç –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø–æ–∑–∏—Ü–∏–π** (–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è)

---

## 6. üî¨ –£–ì–õ–£–ë–õ–ï–ù–ù–´–ô –ê–ù–ê–õ–ò–ó –ö–û–î–ê –ò –ú–ï–•–ê–ù–ò–ó–ú–û–í

> **–¶–µ–ª—å —Ä–∞–∑–¥–µ–ª–∞:** –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∫–ª—é—á–µ–≤—ã—Ö –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤ –±–æ—Ç–∞ —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∫–æ–¥–∞ –∏ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è–º–∏ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –ø—Ä–∏—á–∏–Ω –ø—Ä–æ–±–ª–µ–º –∏ –ø—É—Ç–µ–π –∏—Ö —Ä–µ—à–µ–Ω–∏—è.

**–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ:**
- 6.1 ‚Äî –õ–æ–≥–∏–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ SL (–ø–æ—á–µ–º—É 137 —Å–¥–µ–ª–æ–∫ –∑–∞–∫—Ä—ã—Ç—ã –ø–æ SL)
- 6.2 ‚Äî –†–∞—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏ –∏ –º–∞—Ä–∂–∏ (–ø–æ—á–µ–º—É –∫–æ–º–∏—Å—Å–∏–∏ –≤—ã—Å–æ–∫–∏–µ)
- 6.3 ‚Äî –ü–æ—Ä—è–¥–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤ –≥–ª–∞–≤–Ω–æ–º —Ü–∏–∫–ª–µ (–≤–æ–∑–º–æ–∂–Ω—ã–µ race conditions)
- 6.4 ‚Äî –†–∞—Å—á–µ—Ç PnL% –æ—Ç –º–∞—Ä–∂–∏ (–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ–∑–∏—Ü–∏–π)
- 6.5 ‚Äî –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è SL/TP –¥–ª—è ranging —Ä–µ–∂–∏–º–∞
- 6.6 ‚Äî –°–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –ø—Ä–æ–±–ª–µ–º –∏ —Ä–µ—à–µ–Ω–∏–π

---

### 6.1 –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ª–æ–≥–∏–∫–∏ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ SL

**–ü—Ä–æ–±–ª–µ–º–∞:** 137 —Å–¥–µ–ª–æ–∫ –∑–∞–∫—Ä—ã—Ç—ã –ø–æ SL —Å 0% winrate. –†–∞–∑–±–µ—Ä–µ–º, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º SL.

#### –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ ExitAnalyzer

```1845:1997:src/strategies/scalping/futures/positions/exit_analyzer.py
# 2. –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º PnL
# ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –î–ª—è SL –∏—Å–ø–æ–ª—å–∑—É–µ–º Gross PnL (–±–µ–∑ –∫–æ–º–∏—Å—Å–∏–π)
# SL –¥–æ–ª–∂–µ–Ω —Å—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–≤–∏–∂–µ–Ω–∏—è —Ü–µ–Ω—ã, –∞ –Ω–µ –∫–æ–º–∏—Å—Å–∏–π
# –ö–æ–º–∏—Å—Å–∏–∏ —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ PnL
gross_pnl_percent = self._calculate_pnl_percent(
    entry_price,
    current_price,
    position_side,
    include_fees=False,  # ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: Gross PnL –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Å SL
    entry_time=entry_time,
    position=position,
    metadata=metadata,
)

# Net PnL (—Å –∫–æ–º–∏—Å—Å–∏—è–º–∏) –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥—Ä—É–≥–∏—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫
net_pnl_percent = self._calculate_pnl_percent(
    entry_price,
    current_price,
    position_side,
    include_fees=True,  # Net PnL –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
    entry_time=entry_time,
    position=position,
    metadata=metadata,
)
```

**–ê–Ω–∞–ª–∏–∑:**
- ‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω–æ:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Gross PnL –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Å SL (–¥–≤–∏–∂–µ–Ω–∏–µ —Ü–µ–Ω—ã, –∞ –Ω–µ –∫–æ–º–∏—Å—Å–∏–∏)
- ‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω–æ:** Net PnL –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (—Ä–µ–∞–ª—å–Ω–∞—è –ø—Ä–∏–±—ã–ª—å/—É–±—ã—Ç–æ–∫)
- ‚ö†Ô∏è **–ü—Ä–æ–±–ª–µ–º–∞:** SL% = 0.8% —Å–ª–∏—à–∫–æ–º —É–∑–∫–∏–π –¥–ª—è ranging —Ä–µ–∂–∏–º–∞

#### –†–∞—Å—á–µ—Ç SL% —Å —É—á–µ—Ç–æ–º ATR

```1931:1987:src/strategies/scalping/futures/positions/exit_analyzer.py
# 2.5. ‚úÖ –ù–û–í–û–ï: –ü—Ä–æ–≤–µ—Ä–∫–∞ SL (Stop Loss) - –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –î–û –ø—Ä–æ–≤–µ—Ä–∫–∏ TP
# ‚úÖ –ì–†–û–ö –ö–û–ú–ü–†–û–ú–ò–°–°: –ü–µ—Ä–µ–¥–∞–µ–º current_price –∏ market_data –¥–ª—è ATR-based SL
sl_percent = self._get_sl_percent(
    symbol, "ranging", current_price, market_data
)
# ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ sl_percent - —á–∏—Å–ª–æ, –∞ –Ω–µ —Å—Ç—Ä–æ–∫–∞
if not isinstance(sl_percent, (int, float)):
    try:
        sl_percent = float(sl_percent)
    except (TypeError, ValueError):
        logger.error(
            f"‚ùå ExitAnalyzer RANGING: sl_percent={sl_percent} –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —á–∏—Å–ª–æ–º, –∏—Å–ø–æ–ª—å–∑—É–µ–º fallback 2.0"
        )
        sl_percent = 2.0

# ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –ü–æ—Å–ª–µ partial TP –∏—Å–ø–æ–ª—å–∑—É–µ–º –±–æ–ª–µ–µ –º—è–≥–∫–∏–π SL –¥–ª—è –æ—Å—Ç–∞–≤—à–µ–π—Å—è –ø–æ–∑–∏—Ü–∏–∏
# –≠—Ç–æ –∑–∞—â–∏—â–∞–µ—Ç –æ—Å—Ç–∞–≤—à–∏–µ—Å—è 40% –æ—Ç –ø—Ä–µ–∂–¥–µ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è
if (
    metadata
    and hasattr(metadata, "partial_tp_executed")
    and metadata.partial_tp_executed
):
    # –ü–æ—Å–ª–µ partial TP —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º SL –≤ 1.5 —Ä–∞–∑–∞ –¥–ª—è –æ—Å—Ç–∞–≤—à–µ–π—Å—è –ø–æ–∑–∏—Ü–∏–∏
    sl_percent = sl_percent * 1.5  # 1.2% * 1.5 = 1.8%
    logger.debug(
        f"üõ°Ô∏è ExitAnalyzer RANGING: –ü–æ—Å–ª–µ partial TP –¥–ª—è {symbol} –∏—Å–ø–æ–ª—å–∑—É–µ–º –±–æ–ª–µ–µ –º—è–≥–∫–∏–π SL: "
        f"{sl_percent:.2f}% (–≤–º–µ—Å—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ {self._get_sl_percent(symbol, 'ranging', current_price, market_data):.2f}%)"
    )

spread_buffer = self._get_spread_buffer(symbol, current_price)
sl_threshold = -sl_percent - spread_buffer
# ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ò—Å–ø–æ–ª—å–∑—É–µ–º Gross PnL –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Å SL threshold
# SL –¥–æ–ª–∂–µ–Ω —Å—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–≤–∏–∂–µ–Ω–∏—è —Ü–µ–Ω—ã, –∞ –Ω–µ –∫–æ–º–∏—Å—Å–∏–π
gross_format_sl = (
    f"{gross_pnl_percent:.4f}"
    if abs(gross_pnl_percent) < 0.1
    else f"{gross_pnl_percent:.2f}"
)
net_format_sl = (
    f"{net_pnl_percent:.4f}"
    if abs(net_pnl_percent) < 0.1
    else f"{net_pnl_percent:.2f}"
)
# ‚ûû –û–¢–õ–ê–î–û–ß–ù–û–ï –õ–û–ì–ò–†–û–í–ê–ù–ò–ï: –≤—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É SL
logger.debug(
    f"üîç ExitAnalyzer RANGING: SL –ø—Ä–æ–≤–µ—Ä–∫–∞ {symbol} | "
    f"Gross PnL={gross_pnl_percent:.2f}% (–¥–ª—è SL) | Net PnL={net_pnl_percent:.2f}% (—Å –∫–æ–º–∏—Å—Å–∏–µ–π) | "
    f"SL={sl_percent:.2f}% | threshold={sl_threshold:.2f}% | action={'PASS' if gross_pnl_percent > sl_threshold else 'TRIGGER'}"
)
logger.info(
    f"üîç ExitAnalyzer RANGING {symbol}: SL={sl_percent:.2f}%, "
    f"Gross PnL%={gross_format_sl}% (–¥–ª—è SL), Net PnL%={net_format_sl}% (—Å –∫–æ–º–∏—Å—Å–∏–µ–π), "
    f"spread_buffer={spread_buffer:.4f}%, SL threshold={sl_threshold:.2f}%, "
    f"–¥–æ—Å—Ç–∏–≥–Ω—É—Ç={gross_pnl_percent <= sl_threshold}"
)
# ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º Gross PnL —Å SL threshold
if gross_pnl_percent <= sl_threshold:
    logger.warning(
        f"üõë ExitAnalyzer RANGING: SL –¥–æ—Å—Ç–∏–≥–Ω—É—Ç –¥–ª—è {symbol}: "
        f"Gross PnL {gross_pnl_percent:.2f}% <= SL threshold {sl_threshold:.2f}% "
        f"(SL={sl_percent:.2f}% + spread_buffer={spread_buffer:.4f}%), "
        f"Net PnL={net_pnl_percent:.2f}% (—Å –∫–æ–º–∏—Å—Å–∏–µ–π)"
    )
    return {
        "action": "close",
        "reason": "sl_reached",
        "pnl_pct": gross_pnl_percent,  # Gross PnL –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
```

**–í—ã–≤–æ–¥—ã:**
1. ‚úÖ –õ–æ–≥–∏–∫–∞ SL –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Gross PnL –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
2. ‚ö†Ô∏è **–ü—Ä–æ–±–ª–µ–º–∞:** SL% = 0.8% —Å–ª–∏—à–∫–æ–º —É–∑–∫–∏–π (–≤ –∫–æ–Ω—Ñ–∏–≥–µ —É–∫–∞–∑–∞–Ω–æ 1.0%, –Ω–æ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è 0.8%)
3. ‚ö†Ô∏è **–ü—Ä–æ–±–ª–µ–º–∞:** ATR-based SL –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç (–≤ –ª–æ–≥–∞—Ö –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ–± ATR)

#### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è ATR-based SL

```826:868:src/strategies/scalping/futures/positions/exit_analyzer.py
# ‚úÖ –ì–†–û–ö –ö–û–ú–ü–†–û–ú–ò–°–°: ATR-based SL –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω
if sl_atr_based and current_price and current_price > 0:
    try:
        # –ü–æ–ª—É—á–∞–µ–º ATR –∏–∑ market_data –∏–ª–∏ —á–µ—Ä–µ–∑ orchestrator
        atr_1m = None
        if market_data and hasattr(market_data, "get"):
            atr_1m = market_data.get("atr_1m")
        elif hasattr(self, "orchestrator") and self.orchestrator:
            if hasattr(self.orchestrator, "signal_generator"):
                indicator_manager = getattr(
                    self.orchestrator.signal_generator,
                    "indicator_manager",
                    None,
                )
                if indicator_manager:
                    atr_indicator = indicator_manager.get_indicator("ATR")
                    if atr_indicator:
                        atr_1m = (
                            atr_indicator.get_value()
                            if hasattr(atr_indicator, "get_value")
                            else None
                        )

        if atr_1m and atr_1m > 0:
            # ‚úÖ –ì–†–û–ö –§–ò–ö–°: ATR-based SL: max(0.6%, 1.2*ATR_1m) –¥–ª—è –º–µ–Ω—å—à–∏—Ö —à—É–º–æ–≤—ã—Ö —Ö–∏—Ç–æ–≤
            atr_sl_percent = (atr_1m / current_price) * 100 * sl_atr_multiplier
            sl_percent = max(sl_min_percent, atr_sl_percent)
            logger.debug(
                f"‚úÖ [ATR_SL] {symbol}: ATR-based SL | "
                f"ATR_1m={atr_1m:.6f}, ATR%={(atr_1m/current_price)*100:.4f}%, "
                f"multiplier={sl_atr_multiplier:.2f}, min={sl_min_percent:.2f}%, "
                f"final SL={sl_percent:.2f}%"
            )
        else:
            logger.debug(
                f"‚ö†Ô∏è [ATR_SL] {symbol}: ATR –Ω–µ –Ω–∞–π–¥–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π SL={sl_percent:.2f}%"
            )
    except Exception as e:
        logger.debug(
            f"‚ö†Ô∏è ExitAnalyzer: –û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ ATR-based SL –¥–ª—è {symbol}: {e}, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π"
        )
```

**–ü—Ä–æ–±–ª–µ–º–∞:** ATR –Ω–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ `market_data` –∏–ª–∏ –Ω–µ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è. –í –ª–æ–≥–∞—Ö –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π `‚úÖ [ATR_SL]`, —á—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ ATR –Ω–µ –Ω–∞–π–¥–µ–Ω.

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–¥–∞—á—É ATR –≤ `market_data` –∏–ª–∏ —á–µ—Ä–µ–∑ `indicator_manager`.

---

### 6.2 –ê–Ω–∞–ª–∏–∑ —Ä–∞—Å—á–µ—Ç–∞ —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏ –∏ –º–∞—Ä–∂–∏

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–º–∏—Å—Å–∏–∏ —Å–æ—Å—Ç–∞–≤–ª—è—é—Ç 71.38% –æ—Ç PnL. –†–∞–∑–±–µ—Ä–µ–º, –∫–∞–∫ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è —Ä–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏.

#### –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∫–∞–ø –º–∞—Ä–∂–∏

```149:266:src/strategies/scalping/futures/risk_manager.py
async def _calculate_dynamic_margin_cap(
    self,
    balance: float,
    symbol: str,
    regime: str,
    volatility: Optional[float] = None,
    daily_pnl: float = 0.0,
    open_positions_margin: float = 0.0,
) -> float:
    """
    –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∫–∞–ø –º–∞—Ä–∂–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ:
    - –ë–∞–∑–æ–≤–æ–≥–æ –ø—Ä–æ—Ü–µ–Ω—Ç–∞ –æ—Ç –±–∞–ª–∞–Ω—Å–∞
    - –í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ (—á–µ–º –≤—ã—à–µ, —Ç–µ–º –º–µ–Ω—å—à–µ –∫–∞–ø)
    - –ü—Ä–æ—Å–∞–¥–∫–∏ (—á–µ–º –±–æ–ª—å—à–µ –ø—Ä–æ—Å–∞–¥–∫–∞, —Ç–µ–º –º–µ–Ω—å—à–µ –∫–∞–ø)
    - –†–µ–∂–∏–º–∞ —Ä—ã–Ω–∫–∞ (trending = –±–æ–ª—å—à–µ, choppy = –º–µ–Ω—å—à–µ)
    """
    try:
        risk_config = getattr(self.scalping_config, "risk_config", {})
        if isinstance(risk_config, dict):
            max_margin_per_trade_pct = (
                risk_config.get("max_margin_per_trade", 15.0) / 100.0
            )
            volatility_factor_enabled = risk_config.get(
                "volatility_factor_enabled", True
            )
            drawdown_factor_enabled = getattr(
                risk_config, "drawdown_factor_enabled", True
            )
            min_margin_cap = getattr(risk_config, "min_margin_cap", 8.0)
            max_margin_cap_multiplier = getattr(
                risk_config, "max_margin_cap_multiplier", 2.0
            )

        # –ë–∞–∑–æ–≤—ã–π –∫–∞–ø = –±–∞–ª–∞–Ω—Å * –ø—Ä–æ—Ü–µ–Ω—Ç
        base_cap = balance * max_margin_per_trade_pct

        # –§–∞–∫—Ç–æ—Ä –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ (—á–µ–º –≤—ã—à–µ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å, —Ç–µ–º –º–µ–Ω—å—à–µ –∫–∞–ø)
        volatility_factor = 1.0
        if volatility_factor_enabled and volatility is not None and volatility > 0:
            # –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å: 1% = 1.0, 2% = 0.5, 3% = 0.33
            # –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—Ä–∞—Ç–Ω—É—é –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å: factor = 1 / (1 + volatility)
            volatility_factor = 1.0 / (
                1.0 + volatility * 10
            )  # –£–º–Ω–æ–∂–∞–µ–º –Ω–∞ 10 –¥–ª—è —É—Å–∏–ª–µ–Ω–∏—è —ç—Ñ—Ñ–µ–∫—Ç–∞
            volatility_factor = max(
                0.5, min(1.5, volatility_factor)
            )  # –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º 0.5-1.5

        # –§–∞–∫—Ç–æ—Ä –ø—Ä–æ—Å–∞–¥–∫–∏ (—á–µ–º –±–æ–ª—å—à–µ –ø—Ä–æ—Å–∞–¥–∫–∞, —Ç–µ–º –º–µ–Ω—å—à–µ –∫–∞–ø)
        drawdown_factor = 1.0
        if drawdown_factor_enabled and daily_pnl < 0:
            # –ü—Ä–æ—Å–∞–¥–∫–∞ —É–º–µ–Ω—å—à–∞–µ—Ç –∫–∞–ø: -5% = 0.5, -10% = 0.0
            drawdown_pct = abs(daily_pnl) / balance if balance > 0 else 0.0
            drawdown_factor = max(
                0.0, 1.0 - drawdown_pct * 2
            )  # –£—Å–∏–ª–∏–≤–∞–µ–º —ç—Ñ—Ñ–µ–∫—Ç –ø—Ä–æ—Å–∞–¥–∫–∏
            drawdown_factor = max(
                0.3, min(1.0, drawdown_factor)
            )  # –ú–∏–Ω–∏–º—É–º 30% –æ—Ç –±–∞–∑–æ–≤–æ–≥–æ –∫–∞–ø–∞

        # –†–µ–∂–∏–º–Ω—ã–π –º–Ω–æ–∂–∏—Ç–µ–ª—å (trending = –±–æ–ª—å—à–µ, choppy = –º–µ–Ω—å—à–µ)
        regime_multiplier = 1.0
        if regime:
            regime_lower = regime.lower()
            if regime_lower == "trending":
                regime_multiplier = 1.2  # +20% –≤ —Ç—Ä–µ–Ω–¥–µ
            elif regime_lower == "ranging":
                regime_multiplier = 1.0  # –°—Ç–∞–Ω–¥–∞—Ä—Ç
            elif regime_lower == "choppy":
                regime_multiplier = 0.8  # -20% –≤ —Ö–∞–æ—Å–µ

        # –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∫–∞–ø
        dynamic_cap = (
            base_cap * volatility_factor * drawdown_factor * regime_multiplier
        )

        # –ü—Ä–∏–º–µ–Ω—è–µ–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
        min_cap = min_margin_cap
        max_cap = base_cap * max_margin_cap_multiplier

        final_cap = max(min_cap, min(dynamic_cap, max_cap))

        logger.debug(
            f"üìä Dynamic Margin Cap –¥–ª—è {symbol} ({regime}): "
            f"base=${base_cap:.2f}, vol_factor={volatility_factor:.2f}, "
            f"drawdown_factor={drawdown_factor:.2f}, regime_mult={regime_multiplier:.2f}, "
            f"final=${final_cap:.2f}"
        )

        return final_cap
```

**–ê–Ω–∞–ª–∏–∑:**
- ‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω–æ:** –£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å, –ø—Ä–æ—Å–∞–¥–∫–∞, —Ä–µ–∂–∏–º —Ä—ã–Ω–∫–∞
- ‚ö†Ô∏è **–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –Ω–∏–∑–∫–æ–º –±–∞–ª–∞–Ω—Å–µ –∏ –≤—ã—Å–æ–∫–æ–π —á–∞—Å—Ç–æ—Ç–µ —Ç–æ—Ä–≥–æ–≤–ª–∏ –∫–æ–º–∏—Å—Å–∏–∏ –Ω–∞–∫–∞–ø–ª–∏–≤–∞—é—Ç—Å—è
- ‚ö†Ô∏è **–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–¥–µ–ª–æ–∫ –≤ –¥–µ–Ω—å

**–ü—Ä–∏–º–µ—Ä —Ä–∞—Å—á–µ—Ç–∞:**
- –ë–∞–ª–∞–Ω—Å: $1000
- `max_margin_per_trade`: 15% = $150
- –í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å: 2% ‚Üí `volatility_factor` = 1/(1+2*10) = 0.048 ‚Üí –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ –¥–æ 0.5
- –†–µ–∂–∏–º: ranging ‚Üí `regime_multiplier` = 1.0
- **–ò—Ç–æ–≥–æ–≤—ã–π –∫–∞–ø:** $150 * 0.5 * 1.0 = $75

–ü—Ä–∏ 169 —Å–¥–µ–ª–∫–∞—Ö –∑–∞ –¥–µ–Ω—å –∏ —Å—Ä–µ–¥–Ω–µ–π –∫–æ–º–∏—Å—Å–∏–∏ 0.2530 USDT:
- **–û–±—â–∞—è –∫–æ–º–∏—Å—Å–∏—è:** 169 * 0.2530 = 42.76 USDT
- **–ö–æ–º–∏—Å—Å–∏—è –∫–∞–∫ % –æ—Ç –±–∞–ª–∞–Ω—Å–∞:** 42.76 / 1000 = 4.28%

---

### 6.3 –ê–Ω–∞–ª–∏–∑ –ø–æ—Ä—è–¥–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤ –≥–ª–∞–≤–Ω–æ–º —Ü–∏–∫–ª–µ

**–ü—Ä–æ–±–ª–µ–º–∞:** –í–æ–∑–º–æ–∂–Ω—ã race conditions –∏–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –ø—Ä–æ–≤–µ—Ä–æ–∫.

#### –ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª TradingControlCenter

```113:244:src/strategies/scalping/futures/core/trading_control_center.py
async def run_main_loop(self) -> None:
    """
    –ì–ª–∞–≤–Ω—ã–π —Ç–æ—Ä–≥–æ–≤—ã–π —Ü–∏–∫–ª (–±—ã–≤—à–∏–π _main_trading_loop).

    –ö–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç –≤—Å–µ —à–∞–≥–∏ —Ç–æ—Ä–≥–æ–≤–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞:
    1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
    2. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤
    3. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤
    4. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏—è–º–∏
    5. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—Ä–¥–µ—Ä–æ–≤
    6. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –±–∏—Ä–∂–µ–π
    7. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    8. –ü—Ä–æ–≤–µ—Ä–∫–∞ TSL
    """
    logger.info("üîÑ TCC: –ó–∞–ø—É—Å–∫ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ç–æ—Ä–≥–æ–≤–æ–≥–æ —Ü–∏–∫–ª–∞")

    self.is_running = True
    loop_start_time = time.time()

    while self.is_running:
        try:
            cycle_start_time = time.perf_counter()

            # –ü—Ä–æ–≤–µ—Ä—è–µ–º is_running –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º —à–∞–≥–æ–º
            if not self.is_running:
                break

            # ‚úÖ –ù–û–í–û–ï: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ memory usage —Ä–∞–∑ –≤ 10 –º–∏–Ω—É—Ç
            current_time = time.time()
            if (
                current_time - self._last_memory_log_time
                >= self._memory_log_interval
            ):
                await self._log_memory_usage()
                self._last_memory_log_time = current_time

            # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
            state_start = time.perf_counter()
            await self.update_state()
            state_time = (time.perf_counter() - state_start) * 1000  # –º—Å

            if not self.is_running:
                break

            # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤
            signals_start = time.perf_counter()
            signals = await self.signal_generator.generate_signals()
            signals_time = (time.perf_counter() - signals_start) * 1000  # –º—Å

            if len(signals) > 0:
                logger.info(f"üìä TCC: –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ {len(signals)} —Å–∏–≥–Ω–∞–ª–æ–≤")
            else:
                logger.debug("üìä TCC: –°–∏–≥–Ω–∞–ª–æ–≤ –Ω–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ")

            if not self.is_running:
                break

            # –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤
            process_start = time.perf_counter()
            await self.signal_coordinator.process_signals(signals)
            process_time = (time.perf_counter() - process_start) * 1000  # –º—Å

            if not self.is_running:
                break

            # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏—è–º–∏
            manage_start = time.perf_counter()
            await self.manage_positions()
            manage_time = (time.perf_counter() - manage_start) * 1000  # –º—Å

            if not self.is_running:
                break

            # –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–∏–º–∏—Ç–Ω—ã—Ö –æ—Ä–¥–µ—Ä–æ–≤ (—Ç–∞–π–º–∞—É—Ç –∏ –∑–∞–º–µ–Ω–∞ –Ω–∞ —Ä—ã–Ω–æ—á–Ω—ã–µ)
            monitor_start = time.perf_counter()
            await self.order_coordinator.monitor_limit_orders()
            monitor_time = (time.perf_counter() - monitor_start) * 1000  # –º—Å

            if not self.is_running:
                break

            # ‚úÖ –ù–û–í–û–ï: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
            # ‚úÖ –ì–†–û–ö –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø: –õ–æ–≥–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ cycle > 10s (–ø—Ä–æ–±–ª–µ–º–∞) –∏–ª–∏ —Ä–∞–∑ –≤ 10 —Ü–∏–∫–ª–æ–≤
            cycle_time = (time.perf_counter() - cycle_start_time) * 1000  # –º—Å
            if not hasattr(self, "_cycle_count"):
                self._cycle_count = 0
            self._cycle_count += 1

            if cycle_time > 10000 or self._cycle_count % 10 == 0:
                logger.info(
                    f"‚è±Ô∏è TCC Performance: cycle={cycle_time:.1f}ms, "
                    f"state={state_time:.1f}ms, signals={signals_time:.1f}ms, "
                    f"process={process_time:.1f}ms, manage={manage_time:.1f}ms, "
                    f"monitor={monitor_time:.1f}ms"
                )
            else:
                logger.debug(
                    f"‚è±Ô∏è TCC Performance: cycle={cycle_time:.1f}ms, "
                    f"state={state_time:.1f}ms, signals={signals_time:.1f}ms, "
                    f"process={process_time:.1f}ms, manage={manage_time:.1f}ms, "
                    f"monitor={monitor_time:.1f}ms"
                )

            # –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –æ—Ä–¥–µ—Ä–æ–≤ –≤ –∫—ç—à–µ
            await self.order_coordinator.update_orders_cache_status(
                self._normalize_symbol
            )

            if not self.is_running:
                break

            # –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π —Å –±–∏—Ä–∂–µ–π
            await self._sync_positions_with_exchange()

            if not self.is_running:
                break

            # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
            await self.update_performance()

            if not self.is_running:
                break

            # –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ TSL –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ç–∏–∫–µ—Ä–æ–≤
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º TSL –∫–∞–∂–¥—ã–µ 1-2 —Å–µ–∫—É–Ω–¥—ã –¥–ª—è –≤—Å–µ—Ö –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π
            await self.trailing_sl_coordinator.periodic_check()

            if not self.is_running:
                break

            # –ü–∞—É–∑–∞ –º–µ–∂–¥—É –∏—Ç–µ—Ä–∞—Ü–∏—è–º–∏
            await asyncio.sleep(self.scalping_config.check_interval)
```

**–ê–Ω–∞–ª–∏–∑ –ø–æ—Ä—è–¥–∫–∞:**
1. ‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω–æ:** –°–Ω–∞—á–∞–ª–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è, –ø–æ—Ç–æ–º –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤
2. ‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω–æ:** –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤ –ø–µ—Ä–µ–¥ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –ø–æ–∑–∏—Ü–∏—è–º–∏
3. ‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω–æ:** TSL –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –≤ –∫–æ–Ω—Ü–µ —Ü–∏–∫–ª–∞ (–ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏)
4. ‚ö†Ô∏è **–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞:** `manage_positions()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –¥–æ `monitor_limit_orders()`, —á—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –∑–∞–∫—Ä—ã—Ç–∏—é –ø–æ–∑–∏—Ü–∏–∏ –¥–æ —Ç–æ–≥–æ, –∫–∞–∫ –ª–∏–º–∏—Ç–Ω—ã–π –æ—Ä–¥–µ—Ä –±—É–¥–µ—Ç –∑–∞–º–µ–Ω–µ–Ω –Ω–∞ —Ä—ã–Ω–æ—á–Ω—ã–π

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ü–æ—Ä—è–¥–æ–∫ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π, –Ω–æ —Å—Ç–æ–∏—Ç –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ –∞–∫—Ç–∏–≤–Ω—ã–µ –ª–∏–º–∏—Ç–Ω—ã–µ –æ—Ä–¥–µ—Ä–∞ –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º –ø–æ–∑–∏—Ü–∏–∏.

---

### 6.4 –ê–Ω–∞–ª–∏–∑ —Ä–∞—Å—á–µ—Ç–∞ PnL% –æ—Ç –º–∞—Ä–∂–∏

**–ü—Ä–æ–±–ª–µ–º–∞:** –í –¥–∞–Ω–Ω—ã—Ö –µ—Å—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ–∑–∏—Ü–∏–π. –†–∞–∑–±–µ—Ä–µ–º —Ä–∞—Å—á–µ—Ç PnL.

#### –†–∞—Å—á–µ—Ç PnL% –æ—Ç –º–∞—Ä–∂–∏

```349:500:src/strategies/scalping/futures/positions/exit_analyzer.py
def _calculate_pnl_percent(
    self,
    entry_price: float,
    current_price: float,
    position_side: str,
    include_fees: bool = True,
    entry_time: Optional[datetime] = None,
    position: Optional[Any] = None,
    metadata: Optional[Any] = None,
) -> float:
    """
    –†–∞—Å—á–µ—Ç PnL% —Å —É—á–µ—Ç–æ–º –∫–æ–º–∏—Å—Å–∏–∏.

    ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –î–ª—è —Ñ—å—é—á–µ—Ä—Å–æ–≤ —Å—á–∏—Ç–∞–µ–º PnL% –æ—Ç –ú–ê–†–ñ–ò, –∞ –Ω–µ –æ—Ç —Ü–µ–Ω—ã!
    –ë–∏—Ä–∂–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç PnL% –æ—Ç –º–∞—Ä–∂–∏ (—Å —É—á–µ—Ç–æ–º –ø–ª–µ—á–∞), –ø–æ—ç—Ç–æ–º—É –Ω–∞—à —Ä–∞—Å—á–µ—Ç –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å.

    Args:
        entry_price: –¶–µ–Ω–∞ –≤—Ö–æ–¥–∞
        current_price: –¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞
        position_side: –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ ("long" –∏–ª–∏ "short")
        include_fees: –£—á–∏—Ç—ã–≤–∞—Ç—å –∫–æ–º–∏—Å—Å–∏—é
        entry_time: –í—Ä–µ–º—è –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–≤—ã—Ö 10 —Å–µ–∫—É–Ω–¥)
        position: –î–∞–Ω–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ (–¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è margin –∏ unrealizedPnl)
        metadata: –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ (–¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è margin –∏ unrealizedPnl)

    Returns:
        PnL% –æ—Ç –º–∞—Ä–∂–∏ (—Å –∫–æ–º–∏—Å—Å–∏–µ–π –µ—Å–ª–∏ include_fees=True –∏ –ø—Ä–æ—à–ª–æ >10 —Å–µ–∫—É–Ω–¥)
    """
    if entry_price == 0:
        return 0.0

    # ‚úÖ –ü–†–ò–û–†–ò–¢–ï–¢ 1: –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å PnL% –æ—Ç –º–∞—Ä–∂–∏ (–∫–∞–∫ –Ω–∞ –±–∏—Ä–∂–µ)
    margin_used = None
    unrealized_pnl = None

    # –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –∏–∑ position
    if position and isinstance(position, dict):
        try:
            margin_str = position.get("margin") or position.get("imr") or "0"
            if margin_str and str(margin_str).strip() and str(margin_str) != "0":
                margin_used = float(margin_str)
            unrealized_pnl_str = position.get("unrealizedPnl") or position.get("upl") or "0"
            if unrealized_pnl_str and str(unrealized_pnl_str).strip() and str(unrealized_pnl_str) != "0":
                unrealized_pnl = float(unrealized_pnl_str)
        except (ValueError, TypeError) as e:
            logger.debug(f"‚ö†Ô∏è ExitAnalyzer: –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ position –¥–∞–Ω–Ω—ã—Ö: {e}")

    # –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –∏–∑ metadata
    if (margin_used is None or unrealized_pnl is None) and metadata:
        try:
            if hasattr(metadata, "margin_used"):
                margin_used = metadata.margin_used
            elif isinstance(metadata, dict):
                margin_used = metadata.get("margin_used")
            
            if hasattr(metadata, "unrealized_pnl"):
                unrealized_pnl = metadata.unrealized_pnl
            elif isinstance(metadata, dict):
                unrealized_pnl = metadata.get("unrealized_pnl")
        except Exception as e:
            logger.debug(f"‚ö†Ô∏è ExitAnalyzer: –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ metadata: {e}")

    # ‚úÖ –ü–†–ò–û–†–ò–¢–ï–¢ 2: –ï—Å–ª–∏ –µ—Å—Ç—å margin –∏ unrealizedPnl –æ—Ç –±–∏—Ä–∂–∏ - –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏—Ö
    if margin_used and margin_used > 0 and unrealized_pnl is not None:
        pnl_percent_from_margin = (unrealized_pnl / margin_used) * 100.0
        
        # ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –ö–æ–º–∏—Å—Å–∏–∏ —É—á–∏—Ç—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø—Ä–æ—à–ª–æ >10 —Å–µ–∫—É–Ω–¥ –ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞
        # –í –ø–µ—Ä–≤—ã–µ 10 —Å–µ–∫—É–Ω–¥ –∫–æ–º–∏—Å—Å–∏–∏ –µ—â–µ –Ω–µ —Å–ø–∏—Å–∞–Ω—ã, –ø–æ—ç—Ç–æ–º—É –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ–º –∏—Ö
        if include_fees and entry_time:
            time_since_entry = (datetime.now(timezone.utc) - entry_time).total_seconds()
            if time_since_entry > 10:
                # –ü–æ–ª—É—á–∞–µ–º –∫–æ–º–∏—Å—Å–∏—é –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
                fee_rate = 0.0005  # 0.05% –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (taker)
                if self.config_manager:
                    try:
                        fee_config = getattr(self.scalping_config, "fees", {})
                        if isinstance(fee_config, dict):
                            fee_rate = fee_config.get("taker_fee", 0.0005)
                        else:
                            fee_rate = getattr(fee_config, "taker_fee", 0.0005)
                    except Exception:
                        pass
                
                # –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –∫–æ–º–∏—Å—Å–∏—é –∫–∞–∫ % –æ—Ç –º–∞—Ä–∂–∏
                # –ö–æ–º–∏—Å—Å–∏—è = (entry_price * size * fee_rate + current_price * size * fee_rate) / margin_used
                # –£–ø—Ä–æ—â–µ–Ω–Ω–æ: –∫–æ–º–∏—Å—Å–∏—è ‚âà 2 * fee_rate * leverage (–¥–ª—è —Ñ—å—é—á–µ—Ä—Å–æ–≤)
                # –î–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ –Ω—É–∂–µ–Ω —Ä–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏
                # –ü–æ–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç
                estimated_fee_pct = fee_rate * 2 * 100  # –ü—Ä–∏–º–µ—Ä–Ω–æ 0.1% –¥–ª—è taker fee
                pnl_percent_from_margin = pnl_percent_from_margin - estimated_fee_pct
        
        return pnl_percent_from_margin

    # ‚úÖ –ü–†–ò–û–†–ò–¢–ï–¢ 3: –†–∞—Å—á–µ—Ç –æ—Ç —Ü–µ–Ω—ã (fallback, –µ—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ—Ç –±–∏—Ä–∂–∏)
    # –î–ª—è —Ñ—å—é—á–µ—Ä—Å–æ–≤: PnL% = (price_change / entry_price) * leverage * 100
    # –ù–æ –º—ã –Ω–µ –∑–Ω–∞–µ–º leverage, –ø–æ—ç—Ç–æ–º—É –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç
    if position_side.lower() == "long":
        price_change_pct = ((current_price - entry_price) / entry_price) * 100.0
    else:  # short
        price_change_pct = ((entry_price - current_price) / entry_price) * 100.0

    # –ï—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –º–∞—Ä–∂–µ, –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç
    # –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º leverage = 5x (—Å—Ä–µ–¥–Ω–∏–π)
    estimated_leverage = 5.0
    pnl_percent = price_change_pct * estimated_leverage

    # –£—á–∏—Ç—ã–≤–∞–µ–º –∫–æ–º–∏—Å—Å–∏—é
    if include_fees and entry_time:
        time_since_entry = (datetime.now(timezone.utc) - entry_time).total_seconds()
        if time_since_entry > 10:
            fee_rate = 0.0005  # 0.05% taker
            estimated_fee_pct = fee_rate * 2 * 100  # 0.1%
            pnl_percent = pnl_percent - estimated_fee_pct

    return pnl_percent
```

**–ê–Ω–∞–ª–∏–∑:**
- ‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω–æ:** –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –æ—Ç–¥–∞–µ—Ç—Å—è –¥–∞–Ω–Ω—ã–º –æ—Ç –±–∏—Ä–∂–∏ (margin, unrealizedPnl)
- ‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω–æ:** –ö–æ–º–∏—Å—Å–∏–∏ —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ 10 —Å–µ–∫—É–Ω–¥
- ‚ö†Ô∏è **–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ—Ç –±–∏—Ä–∂–∏, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å leverage=5x
- ‚ö†Ô∏è **–ü—Ä–æ–±–ª–µ–º–∞:** –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –º–æ–∂–µ—Ç –±—ã—Ç—å –∏–∑-–∑–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ `entry_time`

---

### 6.5 –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è SL/TP –¥–ª—è ranging —Ä–µ–∂–∏–º–∞

**–ü—Ä–æ–±–ª–µ–º–∞:** SL% = 0.8% —Å–ª–∏—à–∫–æ–º —É–∑–∫–∏–π. –ü—Ä–æ–≤–µ—Ä–∏–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é.

```300:325:config/config_futures.yaml
tp_percent: 1.8  # ‚úÖ –ì–†–û–ö –§–ò–ö–°: –°–Ω–∏–∂–µ–Ω–æ —Å 2.0% –¥–æ 1.8% (–∞–≥—Ä–µ—Å—Å–∏–≤–Ω–µ–µ –¥–ª—è ranging)
tp_adaptive: true  # ‚úÖ –ì–†–û–ö: –í–∫–ª—é—á–∏—Ç—å –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π TP —Å ATR
tp_atr_based: true  # ‚úÖ –ì–†–û–ö –§–ò–ö–°: –í–∫–ª—é—á–∏—Ç—å ATR-based TP –¥–ª—è ranging
tp_atr_multiplier: 2.5  # ‚úÖ –ì–†–û–ö –§–ò–ö–°: –ú–Ω–æ–∂–∏—Ç–µ–ª—å ATR –¥–ª—è TP (2.5 –¥–ª—è ranging)
tp_min_percent: 1.5  # ‚úÖ –ì–†–û–ö –§–ò–ö–°: –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π TP 1.5%
tp_max_percent: 2.2  # ‚úÖ –ì–†–û–ö: –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π TP 2.2%
sl_percent: 1.0  # ‚úÖ –ì–†–û–ö –§–ò–ö–°: –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 0.8% –¥–æ 1.0% (–±–∞–ª–∞–Ω—Å –¥–ª—è ranging noise)
sl_atr_based: true  # ‚úÖ –ì–†–û–ö: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ATR-based SL –≤–º–µ—Å—Ç–æ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ
sl_atr_multiplier: 1.5  # ‚úÖ –ì–†–û–ö –§–ò–ö–°: –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 1.2 –¥–æ 1.5 –¥–ª—è –º–µ–Ω—å—à–∏—Ö —à—É–º–æ–≤—ã—Ö —Ö–∏—Ç–æ–≤ (max(0.6%, 1.5*ATR_1m))
sl_min_percent: 0.6  # ‚úÖ –ì–†–û–ö: –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π SL 0.6% (–∑–∞—â–∏—Ç–∞ –æ—Ç —à—É–º–∞)
sl_max_percent: 1.2  # ‚úÖ –ì–†–û–ö –§–ò–ö–°: –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π SL 1.2% (–∑–∞—â–∏—Ç–∞ –æ—Ç —Å–ª–∏—à–∫–æ–º —à–∏—Ä–æ–∫–æ–≥–æ SL)
max_holding_minutes: 25  # ‚úÖ –ì–†–û–ö: –£–º–µ–Ω—å—à–µ–Ω–æ —Å 28 –¥–æ 25 –º–∏–Ω—É—Ç –¥–ª—è –±–æ–ª–µ–µ –±—ã—Å—Ç—Ä–æ–π —Ä–æ—Ç–∞—Ü–∏–∏
max_holding_hard_stop: true  # ‚úÖ –ì–†–û–ö: –ñ–µ—Å—Ç–∫–∏–π —Å—Ç–æ–ø –ø–æ max_holding (–Ω–µ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å —É–±—ã—Ç–æ—á–Ω—ã–µ)
timeout_loss_percent: 1.5  # ‚úÖ –ì–†–û–ö: –ó–∞–∫—Ä—ã–≤–∞—Ç—å –ø–æ max_holding –µ—Å–ª–∏ —É–±—ã—Ç–æ–∫ >= 1.5%
extend_time_if_profitable: true  # ‚úÖ –ù–û–í–û–ï: –ü—Ä–æ–¥–ª–µ–≤–∞—Ç—å –≤—Ä–µ–º—è –µ—Å–ª–∏ –ø–æ–∑–∏—Ü–∏—è –≤ –ø—Ä–∏–±—ã–ª–∏
min_profit_for_extension: 0.4  # ‚úÖ –ê–ì–†–ï–°–°–ò–í–ù–û: –°–Ω–∏–∂–µ–Ω–æ —Å 0.5% –¥–æ 0.4% - —Ä–∞–Ω—å—à–µ –ø—Ä–æ–¥–ª–µ–≤–∞–µ–º
extension_percent: 120  # ‚úÖ –ê–ì–†–ï–°–°–ò–í–ù–û: –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 100% –¥–æ 120% - –ø—Ä–æ–¥–ª–µ–≤–∞–µ–º –µ—â–µ –±–æ–ª—å—à–µ
cooldown_after_loss_minutes: 0.5  # ‚úÖ –ê–ì–†–ï–°–°–ò–í–ù–û: –£–º–µ–Ω—å—à–µ–Ω–æ —Å 1 –¥–æ 0.5 –º–∏–Ω - –±—ã—Å—Ç—Ä–µ–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è
pivot_bonus_multiplier: 1.2
volume_profile_bonus_multiplier: 1.0
ph_enabled: true
ph_threshold_type: "margin_percent"  # ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï (21.12.2025): –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π PH –æ—Ç –º–∞—Ä–∂–∏
ph_threshold_percent: 0.9  # ‚úÖ –ì–†–û–ö –§–ò–ö–°: 0.9% (–±–∞–ª–∞–Ω—Å –º–µ–∂–¥—É 0.8-1.0% –¥–ª—è early PH)
ph_min_absolute_usd: 0.05  # ‚úÖ –ì–†–û–ö –ö–û–ú–ü–†–û–ú–ò–°–°: –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∞–±—Å–æ–ª—é—Ç–Ω—ã–π –ø–æ—Ä–æ–≥ 0.05 USD (1.5-2x –∫–æ–º–∏—Å—Å–∏–∏)
ph_threshold: 0.10  # ‚úÖ Fallback –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
ph_time_limit: 1200  # ‚úÖ –£–í–ï–õ–ò–ß–ï–ù–û: 20 –º–∏–Ω—É—Ç (–±—ã–ª–æ 300 = 5 –º–∏–Ω—É—Ç) –¥–ª—è –±–æ–ª—å—à–µ–≥–æ –æ—Ö–≤–∞—Ç–∞
min_holding_minutes: 0.5  # ‚úÖ –ì–†–û–ö: –£–º–µ–Ω—å—à–µ–Ω–æ —Å 1 –¥–æ 0.5 –º–∏–Ω—É—Ç—ã (30 —Å–µ–∫) –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ Partial TP
```

**–ê–Ω–∞–ª–∏–∑:**
- ‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω–æ:** SL% = 1.0% –≤ –∫–æ–Ω—Ñ–∏–≥–µ (–Ω–æ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è 0.8% ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ, –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –≥–¥–µ-—Ç–æ)
- ‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω–æ:** ATR-based SL –≤–∫–ª—é—á–µ–Ω (`sl_atr_based: true`)
- ‚ö†Ô∏è **–ü—Ä–æ–±–ª–µ–º–∞:** ATR –Ω–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ `exit_analyzer`, –ø–æ—ç—Ç–æ–º—É –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π SL
- ‚ö†Ô∏è **–ü—Ä–æ–±–ª–µ–º–∞:** `sl_max_percent: 1.2%` –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–ª–∏—à–∫–æ–º —É–∑–∫–∏–º –¥–ª—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω—ã—Ö –ø–µ—Ä–∏–æ–¥–æ–≤

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** 
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –ø–æ—á–µ–º—É —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–π SL% = 0.8% –≤–º–µ—Å—Ç–æ 1.0%
2. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ ATR –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ `market_data` –ø—Ä–∏ –≤—ã–∑–æ–≤–µ `_get_sl_percent()`
3. –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å —É–≤–µ–ª–∏—á–µ–Ω–∏–µ `sl_max_percent` –¥–æ 1.5-2.0% –¥–ª—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω—ã—Ö –ø–µ—Ä–∏–æ–¥–æ–≤

---

### 6.6 –°–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –ø—Ä–æ–±–ª–µ–º –∏ —Ä–µ—à–µ–Ω–∏–π

| –ü—Ä–æ–±–ª–µ–º–∞ | –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –≤ –∫–æ–¥–µ | –ü—Ä–∏—á–∏–Ω–∞ | –†–µ—à–µ–Ω–∏–µ |
|----------|----------------------|---------|---------|
| SL% = 0.8% –≤–º–µ—Å—Ç–æ 1.0% | `exit_analyzer.py:1933` | –í–æ–∑–º–æ–∂–Ω–æ, –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤ `symbol_profiles` | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `symbol_profiles` –¥–ª—è ranging —Ä–µ–∂–∏–º–∞ |
| ATR –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è | `exit_analyzer.py:826-868` | ATR –Ω–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ `market_data` | –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–¥–∞—á—É ATR —á–µ—Ä–µ–∑ `indicator_manager` |
| –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å | `trades.csv` | –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç `entry_time` | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏–∫—É —Ä–∞—Å—á–µ—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏ –≤ `position_manager` |
| –í—ã—Å–æ–∫–∏–µ –∫–æ–º–∏—Å—Å–∏–∏ | `risk_manager.py:149-266` | –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ —Å–¥–µ–ª–æ–∫ (169/–¥–µ–Ω—å) | –£–≤–µ–ª–∏—á–∏—Ç—å `cooldown_after_loss_minutes` |
| ETH-USDT –Ω–∏–∑–∫–∏–π winrate | –û–±—â–∞—è –ø—Ä–æ–±–ª–µ–º–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ | –í–æ–∑–º–æ–∂–Ω–æ, ETH –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ | –í—Ä–µ–º–µ–Ω–Ω–æ –∏—Å–∫–ª—é—á–∏—Ç—å ETH-USDT –∏–ª–∏ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã |

---

## 7. üìã –ü–ê–†–ê–ú–ï–¢–†–´ –§–ò–õ–¨–¢–†–û–í –ò –ò–ù–î–ò–ö–ê–¢–û–†–û–í –î–õ–Ø –ö–ê–ñ–î–û–ô –ü–ê–†–´

> **–¶–µ–ª—å —Ä–∞–∑–¥–µ–ª–∞:** –î–µ—Ç–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Ñ–∏–ª—å—Ç—Ä–æ–≤, –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ –∏ –ø–æ–∑–∏—Ü–∏–π –¥–ª—è –∫–∞–∂–¥–æ–π —Ç–æ—Ä–≥–æ–≤–æ–π –ø–∞—Ä—ã –≤ –∫–∞–∂–¥–æ–º —Ä–µ–∂–∏–º–µ —Ä—ã–Ω–∫–∞.

### 7.1 BTC-USDT

#### –û–±—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- **position_multiplier:** 1.6x
- **tp_percent (fallback):** 2.0%
- **sl_percent (fallback):** 1.5%

#### Trending —Ä–µ–∂–∏–º
```yaml
tp_percent: 5.0%
sl_percent: 1.5%
big_profit_exit_percent: 2.5%
min_score_threshold: 2.0
position_size_multiplier: 1.2x
tp_atr_multiplier: 1.0
sl_atr_multiplier: 0.5
base_position_usd: $42.0
min_position_usd: $28.0
max_position_usd: $65.0

–§–∏–ª—å—Ç—Ä—ã:
  liquidity:
    min_best_bid_volume_usd: $140
    min_best_ask_volume_usd: $140
    min_orderbook_depth_usd: $1200
    max_spread_percent: 1.34%
  order_flow:
    long_threshold: 0.0065
    short_threshold: -0.0072
    min_total_depth_usd: $2080
  funding:
    max_positive_rate: 0.0109
    max_negative_rate: 0.0100
    max_abs_rate: 0.0125
  volatility:
    min_range_percent: 0.032%
    max_range_percent: 7.52%
    min_atr_percent: 0.006%
```

#### Ranging —Ä–µ–∂–∏–º
```yaml
tp_percent: 5.0%
sl_percent: 2.0%
big_profit_exit_percent: 2.5%
min_score_threshold: 1.8
position_size_multiplier: 1.05x
tp_atr_multiplier: 0.8
sl_atr_multiplier: 0.45
base_position_usd: $38.0
min_position_usd: $24.0
max_position_usd: $58.0

–§–∏–ª—å—Ç—Ä—ã:
  liquidity:
    min_best_bid_volume_usd: $110
    min_best_ask_volume_usd: $110
    min_orderbook_depth_usd: $1000
    max_spread_percent: 1.67%
  order_flow:
    long_threshold: 0.005
    short_threshold: -0.0056
    min_total_depth_usd: $1280
  funding:
    max_positive_rate: 0.0100
    max_negative_rate: 0.0092
    max_abs_rate: 0.0117
  volatility:
    min_range_percent: 0.028%
    max_range_percent: 8.02%
    min_atr_percent: 0.0048%

–ú–æ–¥—É–ª–∏:
  multi_timeframe:
    block_opposite: false
    score_bonus: 1
    confirmation_timeframe: "5m"
    fail_open_enabled: true
    fail_open_blocks: 2
    fail_open_cooldown_seconds: 45
```

#### Choppy —Ä–µ–∂–∏–º
```yaml
tp_percent: 4.0%
sl_percent: 1.5%
big_profit_exit_percent: 1.5%
min_score_threshold: 1.5
position_size_multiplier: 0.90x
tp_atr_multiplier: 0.6
sl_atr_multiplier: 0.4
base_position_usd: $35.0
min_position_usd: $20.0
max_position_usd: $50.0

–§–∏–ª—å—Ç—Ä—ã:
  liquidity:
    min_best_bid_volume_usd: $90
    min_best_ask_volume_usd: $90
    min_orderbook_depth_usd: $850
    max_spread_percent: 2.00%
  order_flow:
    long_threshold: 0.0045
    short_threshold: -0.0048
    min_total_depth_usd: $1440
  funding:
    max_positive_rate: 0.0092
    max_negative_rate: 0.0084
    max_abs_rate: 0.0109
  volatility:
    min_range_percent: 0.024%
    max_range_percent: 8.35%
    min_atr_percent: 0.004%
```

---

### 7.2 ETH-USDT

#### –û–±—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- **position_multiplier:** 1.3x
- **tp_percent (fallback):** 1.95%
- **sl_percent (fallback):** 1.5%

#### Trending —Ä–µ–∂–∏–º
```yaml
tp_percent: 5.0%
sl_percent: 1.5%
big_profit_exit_percent: 2.5%
min_score_threshold: 1.5
position_size_multiplier: 1.15x
tp_atr_multiplier: 1.0
sl_atr_multiplier: 0.5
base_position_usd: $38.0
min_position_usd: $24.0
max_position_usd: $58.0

–§–∏–ª—å—Ç—Ä—ã:
  liquidity:
    min_best_bid_volume_usd: $90
    min_best_ask_volume_usd: $90
    min_orderbook_depth_usd: $900
    max_spread_percent: 1.50%
  order_flow:
    long_threshold: 0.006
    short_threshold: -0.0064
    min_total_depth_usd: $1680
  funding:
    max_positive_rate: 0.0100
    max_negative_rate: 0.0092
    max_abs_rate: 0.0117
  volatility:
    min_range_percent: 0.028%
    max_range_percent: 7.68%
    min_atr_percent: 0.0056%
```

#### Ranging —Ä–µ–∂–∏–º
```yaml
tp_percent: 3.5%
sl_percent: 2.0%
big_profit_exit_percent: 2.5%
min_score_threshold: 1.5
position_size_multiplier: 1.05x
tp_atr_multiplier: 0.8
sl_atr_multiplier: 0.45
base_position_usd: $34.0
min_position_usd: $22.0
max_position_usd: $52.0

–§–∏–ª—å—Ç—Ä—ã:
  liquidity:
    min_best_bid_volume_usd: $80
    min_best_ask_volume_usd: $80
    min_orderbook_depth_usd: $750
    max_spread_percent: 1.84%
  order_flow:
    long_threshold: 0.005
    short_threshold: -0.0052
    min_total_depth_usd: $960
  funding:
    max_positive_rate: 0.0092
    max_negative_rate: 0.0084
    max_abs_rate: 0.0109
  volatility:
    min_range_percent: 0.024%
    max_range_percent: 8.18%
    min_atr_percent: 0.0044%

–ú–æ–¥—É–ª–∏:
  multi_timeframe:
    block_opposite: false
    score_bonus: 1
    confirmation_timeframe: "5m"
    fail_open_enabled: true
    fail_open_blocks: 2
    fail_open_cooldown_seconds: 45
```

#### Choppy —Ä–µ–∂–∏–º
```yaml
tp_percent: 4.0%
sl_percent: 1.2%
big_profit_exit_percent: 1.5%
min_score_threshold: 1.7
position_size_multiplier: 0.85x
tp_atr_multiplier: 0.6
sl_atr_multiplier: 0.4
min_position_usd: $18.0
max_position_usd: $500.0

–§–∏–ª—å—Ç—Ä—ã:
  liquidity:
    min_best_bid_volume_usd: $70
    min_best_ask_volume_usd: $70
    min_orderbook_depth_usd: $650
    max_spread_percent: 2.17%
  order_flow:
    long_threshold: 0.004
    short_threshold: -0.0044
    min_total_depth_usd: $1120
  funding:
    max_positive_rate: 0.0084
    max_negative_rate: 0.0075
    max_abs_rate: 0.0100
  volatility:
    min_range_percent: 0.020%
    max_range_percent: 8.68%
    min_atr_percent: 0.0036%
```

---

### 7.3 SOL-USDT

#### –û–±—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- **position_multiplier:** 1.2x
- **tp_percent (fallback):** 1.9%
- **sl_percent (fallback):** 1.5%

#### Trending —Ä–µ–∂–∏–º
```yaml
tp_percent: 5.0%
sl_percent: 1.5%
big_profit_exit_percent: 3.0%
min_score_threshold: 1.3
position_size_multiplier: 1.1x
tp_atr_multiplier: 0.55
sl_atr_multiplier: 0.35
base_position_usd: $32.0
min_position_usd: $20.0
max_position_usd: $48.0

–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã:
  min_ma_difference_pct: 0.09%

–§–∏–ª—å—Ç—Ä—ã:
  liquidity:
    min_best_bid_volume_usd: $45
    min_best_ask_volume_usd: $45
    min_orderbook_depth_usd: $420
    max_spread_percent: 1.84%
  order_flow:
    long_threshold: 0.0048
    short_threshold: -0.0048
    min_total_depth_usd: $1000
  funding:
    max_positive_rate: 0.0109
    max_negative_rate: 0.0100
    max_abs_rate: 0.0125
  volatility:
    min_range_percent: 0.040%
    max_range_percent: 8.35%
    min_atr_percent: 0.0072%
```

#### Ranging —Ä–µ–∂–∏–º
```yaml
tp_percent: 3.5%
sl_percent: 2.0%
big_profit_exit_percent: 2.5%
min_score_threshold: 1.7
position_size_multiplier: 1.0x
tp_atr_multiplier: 0.45
sl_atr_multiplier: 0.30
base_position_usd: $30.0
min_position_usd: $18.0
max_position_usd: $500.0

–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã:
  min_ma_difference_pct: 0.02%

–§–∏–ª—å—Ç—Ä—ã:
  liquidity:
    min_best_bid_volume_usd: $40
    min_best_ask_volume_usd: $40
    min_orderbook_depth_usd: $340
    max_spread_percent: 2.17%
  order_flow:
    long_threshold: 0.004
    short_threshold: -0.004
    min_total_depth_usd: $600
  funding:
    max_positive_rate: 0.0100
    max_negative_rate: 0.0092
    max_abs_rate: 0.0117
  volatility:
    min_range_percent: 0.032%
    max_range_percent: 8.85%
    min_atr_percent: 0.006%

–ú–æ–¥—É–ª–∏:
  multi_timeframe:
    block_opposite: false
    score_bonus: 1
    confirmation_timeframe: "5m"
    fail_open_enabled: true
    fail_open_blocks: 2
    fail_open_cooldown_seconds: 45
```

#### Choppy —Ä–µ–∂–∏–º
```yaml
tp_percent: 4.0%
sl_percent: 1.5%
big_profit_exit_percent: 2.0%
min_score_threshold: 1.4
position_size_multiplier: 0.85x
tp_atr_multiplier: 0.28
sl_atr_multiplier: 0.24
base_position_usd: $26.0
min_position_usd: $16.0
max_position_usd: $500.0

–§–∏–ª—å—Ç—Ä—ã:
  liquidity:
    min_best_bid_volume_usd: $48
    min_best_ask_volume_usd: $48
    min_orderbook_depth_usd: $360
    max_spread_percent: 2.50%
  order_flow:
    long_threshold: 0.0032
    short_threshold: -0.0032
    min_total_depth_usd: $640
  funding:
    max_positive_rate: 0.0092
    max_negative_rate: 0.0084
    max_abs_rate: 0.0109
  volatility:
    min_range_percent: 0.028%
    max_range_percent: 9.18%
    min_atr_percent: 0.0048%
```

---

### 7.4 DOGE-USDT

#### –û–±—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- **position_multiplier:** 1.1x
- **tp_percent (fallback):** 4.0%
- **sl_percent (fallback):** 1.8%

#### Trending —Ä–µ–∂–∏–º
```yaml
tp_percent: 4.5%
sl_percent: 1.8%
big_profit_exit_percent: 3.0%
min_score_threshold: 1.3
position_size_multiplier: 1.05x
tp_atr_multiplier: 0.52
sl_atr_multiplier: 0.32
base_position_usd: $26.0
min_position_usd: $18.0
max_position_usd: $500.0

–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã:
  min_ma_difference_pct: 0.09%

–§–∏–ª—å—Ç—Ä—ã:
  liquidity:
    min_best_bid_volume_usd: $18
    min_best_ask_volume_usd: $18
    min_orderbook_depth_usd: $260
    max_spread_percent: 2.17%
  order_flow:
    long_threshold: 0.0028
    short_threshold: -0.0024
    min_total_depth_usd: $360
  funding:
    max_positive_rate: 0.0117
    max_negative_rate: 0.0109
    max_abs_rate: 0.0134
  volatility:
    min_range_percent: 0.048%
    max_range_percent: 10.02%
    min_atr_percent: 0.008%
```

#### Ranging —Ä–µ–∂–∏–º
```yaml
tp_percent: 2.0%
sl_percent: 1.0%
big_profit_exit_percent: 2.5%
min_score_threshold: 1.7
position_size_multiplier: 1.0x
tp_atr_multiplier: 0.42
sl_atr_multiplier: 0.28
base_position_usd: $24.0
min_position_usd: $16.0
max_position_usd: $50.0

–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã:
  min_ma_difference_pct: 0.02%

–§–∏–ª—å—Ç—Ä—ã:
  liquidity:
    min_best_bid_volume_usd: $12
    min_best_ask_volume_usd: $12
    min_orderbook_depth_usd: $200
    max_spread_percent: 2.67%
  order_flow:
    long_threshold: 0.002
    short_threshold: -0.0016
    min_total_depth_usd: $200
  funding:
    max_positive_rate: 0.0109
    max_negative_rate: 0.0100
    max_abs_rate: 0.0125
  volatility:
    min_range_percent: 0.040%
    max_range_percent: 10.52%
    min_atr_percent: 0.0068%

–ú–æ–¥—É–ª–∏:
  multi_timeframe:
    block_opposite: false
    block_neutral: false
    score_bonus: 1
    confirmation_timeframe: "5m"
    fail_open_enabled: true
    fail_open_blocks: 2
    fail_open_cooldown_seconds: 45
```

#### Choppy —Ä–µ–∂–∏–º
```yaml
tp_percent: 4.5%
sl_percent: 1.5%
big_profit_exit_percent: 2.0%
min_score_threshold: 1.2
position_size_multiplier: 0.8x
tp_atr_multiplier: 0.25
sl_atr_multiplier: 0.22
base_position_usd: $20.0
min_position_usd: $12.0
max_position_usd: $500.0

–§–∏–ª—å—Ç—Ä—ã:
  liquidity:
    min_best_bid_volume_usd: $8
    min_best_ask_volume_usd: $8
    min_orderbook_depth_usd: $150
    max_spread_percent: 3.17%
  order_flow:
    long_threshold: 0.0015
    short_threshold: -0.0012
    min_total_depth_usd: $160
  funding:
    max_positive_rate: 0.0100
    max_negative_rate: 0.0092
    max_abs_rate: 0.0117
  volatility:
    min_range_percent: 0.036%
    max_range_percent: 10.86%
    min_atr_percent: 0.006%
```

---

### 7.5 XRP-USDT

#### –û–±—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- **position_multiplier:** 1.1x
- **tp_percent (fallback):** 4.0%
- **sl_percent (fallback):** 1.8%

#### Trending —Ä–µ–∂–∏–º
```yaml
tp_percent: 3.5%
sl_percent: 1.5%
big_profit_exit_percent: 3.0%
min_score_threshold: 1.2
position_size_multiplier: 1.05x
tp_atr_multiplier: 0.50
sl_atr_multiplier: 0.32
base_position_usd: $24.0
min_position_usd: $16.0
max_position_usd: $50.0

–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã:
  min_ma_difference_pct: 0.015%

–ú–æ–¥—É–ª–∏:
  adx_filter:
    adx_threshold: 15.0
    di_difference: 1.2
  multi_timeframe:
    block_neutral: false

–§–∏–ª—å—Ç—Ä—ã:
  liquidity:
    min_best_bid_volume_usd: $10
    min_best_ask_volume_usd: $10
    min_orderbook_depth_usd: $250
    max_spread_percent: 2.00%
  order_flow:
    long_threshold: 0.0035
    short_threshold: -0.0035
    min_total_depth_usd: $340
  funding:
    max_positive_rate: 0.0109
    max_negative_rate: 0.0100
    max_abs_rate: 0.0125
  volatility:
    min_range_percent: 0.032%
    max_range_percent: 9.18%
    min_atr_percent: 0.0056%
```

---

## 8. üîß –î–ê–ù–ù–´–ï –î–õ–Ø –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–ò –ò –†–ê–°–ß–ï–¢–ê

> **–¶–µ–ª—å —Ä–∞–∑–¥–µ–ª–∞:** –û–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —Ç—Ä–µ–±—É—é—Ç—Å—è –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ —Ä–∞—Å—á–µ—Ç–∞ —Å–∏–≥–Ω–∞–ª–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–π –ø–∞—Ä—ã –≤ –∫–∞–∂–¥–æ–º —Ä–µ–∂–∏–º–µ.

### 8.1 –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –±–æ—Ç–∞

#### 1. –ó–∞–≥—Ä—É–∑–∫–∞ —Å–≤–µ—á–µ–π (Candle Buffers)

**–ò—Å—Ç–æ—á–Ω–∏–∫:** `src/strategies/scalping/futures/orchestrator.py:_initialize_candle_buffers()`

**–î–ª—è –∫–∞–∂–¥–æ–π –ø–∞—Ä—ã –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è:**
- ‚úÖ **–¢–∞–π–º—Ñ—Ä–µ–π–º:** 1m (1 –º–∏–Ω—É—Ç–∞)
- ‚úÖ **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:** 200 —Å–≤–µ—á–µ–π
- ‚úÖ **–•—Ä–∞–Ω–µ–Ω–∏–µ:** `DataRegistry.CandleBuffer` (–∫—ç—à –≤ –ø–∞–º—è—Ç–∏)
- ‚úÖ **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** –ß–µ—Ä–µ–∑ WebSocket –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö:**
```python
{
    "BTC-USDT": {
        "1m": CandleBuffer(max_size=200)  # –ü–æ—Å–ª–µ–¥–Ω–∏–µ 200 —Å–≤–µ—á–µ–π 1m
    },
    "ETH-USDT": {
        "1m": CandleBuffer(max_size=200)
    },
    # ... –¥–ª—è –≤—Å–µ—Ö –ø–∞—Ä
}
```

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞:**
- –ú–∏–Ω–∏–º—É–º 20 —Å–≤–µ—á–µ–π –¥–ª—è –±–∞–∑–æ–≤—ã—Ö –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ (RSI, MACD, MA)
- –ú–∏–Ω–∏–º—É–º 14 —Å–≤–µ—á–µ–π –¥–ª—è ATR (period=14)
- –ú–∏–Ω–∏–º—É–º 21 —Å–≤–µ—á–∞ –¥–ª—è EMA (fast=10, slow=25)

---

#### 2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤

**–ò—Å—Ç–æ—á–Ω–∏–∫:** `src/strategies/scalping/futures/signal_generator.py`

**–î–ª—è –∫–∞–∂–¥–æ–π –ø–∞—Ä—ã –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è:**

**–ë–∞–∑–æ–≤—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã:**
- ‚úÖ **RSI** (period=14) ‚Äî –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–µ—Ä–µ–∫—É–ø–ª–µ–Ω–Ω–æ—Å—Ç–∏/–ø–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω–Ω–æ—Å—Ç–∏
- ‚úÖ **MACD** (fast=12, slow=26, signal=9) ‚Äî –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç—Ä–µ–Ω–¥–∞
- ‚úÖ **EMA** (fast=10, slow=25) ‚Äî –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–µ–Ω–¥–∞
- ‚úÖ **SMA** (fast=10, slow=25) ‚Äî –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ EMA
- ‚úÖ **ATR** (period=14) ‚Äî –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ –∏ –∞–¥–∞–ø—Ç–∏–≤–Ω—ã—Ö SL/TP
- ‚úÖ **Bollinger Bands** (period=20, std_dev=2.0) ‚Äî –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏

**ADX –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä:**
- ‚úÖ **ADX** (period=14) ‚Äî –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–∏–ª—ã —Ç—Ä–µ–Ω–¥–∞
- ‚úÖ **+DI –∏ -DI** ‚Äî –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–µ–Ω–¥–∞

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ —Ä–µ–∂–∏–º–∞–º (–∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞):**
```yaml
ranging:
  indicators:
    rsi_overbought: 70
    rsi_oversold: 30
    sma_fast: 10
    sma_slow: 25
    ema_fast: 10
    ema_slow: 25
    atr_period: 14
    min_volatility_atr: 0.0003
    min_ma_difference_pct: 0.01  # –î–ª—è BTC –∏ –¥—Ä—É–≥–∏—Ö –ø–∞—Ä —Å –Ω–∏–∑–∫–æ–π –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å—é
```

---

#### 3. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∂–∏–º–∞ —Ä—ã–Ω–∫–∞ (Regime Manager)

**–ò—Å—Ç–æ—á–Ω–∏–∫:** `src/strategies/scalping/futures/adaptivity/regime_manager.py`

**–î–ª—è –∫–∞–∂–¥–æ–π –ø–∞—Ä—ã –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è:**
- ‚úÖ **–¢–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º:** trending / ranging / choppy
- ‚úÖ **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–µ–∂–∏–º–∞:** TP%, SL%, min_score_threshold, position_size_multiplier
- ‚úÖ **–ò—Å—Ç–æ—Ä–∏—è —Ä–µ–∂–∏–º–æ–≤:** –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç —á–∞—Å—Ç–æ–≥–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞:**
- ADX –∑–Ω–∞—á–µ–Ω–∏–µ (–¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–∏–ª—ã —Ç—Ä–µ–Ω–¥–∞)
- –í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å (ATR% –æ—Ç —Ü–µ–Ω—ã)
- –†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É —Ü–µ–Ω–æ–π –∏ SMA (–¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç—Ä–µ–Ω–¥–∞)
- –ò—Å—Ç–æ—Ä–∏—è —Ä–µ–∂–∏–º–æ–≤ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 15 –º–∏–Ω—É—Ç (–∑–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è)

**–ü–æ—Ä–æ–≥–∏ —Ä–µ–∂–∏–º–æ–≤:**
```yaml
trending_adx_threshold: 25.0  # ADX >25 = —Ç—Ä–µ–Ω–¥
ranging_adx_threshold: 20.0   # ADX <20 = –±–æ–∫–æ–≤–∏–∫
high_volatility_threshold: 0.05  # >5% = –≤—ã—Å–æ–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å
low_volatility_threshold: 0.02   # <2% = –Ω–∏–∑–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å
trend_strength_percent: 2.0      # –¶–µ–Ω–∞ >2% –æ—Ç SMA = —Ç—Ä–µ–Ω–¥
min_regime_duration_minutes: 15 # –ú–∏–Ω–∏–º—É–º 15 –º–∏–Ω –≤ –æ–¥–Ω–æ–º —Ä–µ–∂–∏–º–µ
required_confirmations: 3        # –ù—É–∂–Ω–æ 3 –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è
```

---

#### 4. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ä—ã–Ω–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (Market Data)

**–ò—Å—Ç–æ—á–Ω–∏–∫:** `src/strategies/scalping/futures/core/data_registry.py`

**–î–ª—è –∫–∞–∂–¥–æ–π –ø–∞—Ä—ã –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è:**

**–ß–µ—Ä–µ–∑ WebSocket (—Ä–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è):**
- ‚úÖ **–¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞** (last_price)
- ‚úÖ **Best bid/ask** (–¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Å–ø—Ä–µ–¥–∞)
- ‚úÖ **–û–±—ä–µ–º** (volume_24h)
- ‚úÖ **–°–≤–µ—á–∏** (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ WebSocket)

**–ß–µ—Ä–µ–∑ API (–ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ):**
- ‚úÖ **Orderbook** (–≥–ª—É–±–∏–Ω–∞ —Å—Ç–∞–∫–∞–Ω–∞)
- ‚úÖ **Funding rate** (–¥–ª—è —Ñ—å—é—á–µ—Ä—Å–æ–≤)
- ‚úÖ **Open Interest** (–¥–ª—è —Ñ—å—é—á–µ—Ä—Å–æ–≤)

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö:**
```python
{
    "BTC-USDT": {
        "price": 110000.0,
        "best_bid": 109999.5,
        "best_ask": 110000.5,
        "spread": 0.0009,  # 0.09%
        "volume_24h": 1000000.0,
        "funding_rate": 0.0001,
        "open_interest": 5000000.0,
        "updated_at": datetime.now()
    }
}
```

---

### 8.2 –î–∞–Ω–Ω—ã–µ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Å–∏–≥–Ω–∞–ª–æ–≤

#### –î–ª—è –∫–∞–∂–¥–æ–π –ø–∞—Ä—ã –≤ –∫–∞–∂–¥–æ–º —Ä–µ–∂–∏–º–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è:

**1. –†—ã–Ω–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- ‚úÖ –¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞ (last_price)
- ‚úÖ Best bid/ask (–¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏)
- ‚úÖ Orderbook depth (–¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏)
- ‚úÖ Funding rate (–¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞ funding)
- ‚úÖ –°–≤–µ—á–∏ 1m (–º–∏–Ω–∏–º—É–º 20-200 —Å–≤–µ—á–µ–π)
- ‚úÖ –°–≤–µ—á–∏ 5m (–¥–ª—è Multi-Timeframe —Ñ–∏–ª—å—Ç—Ä–∞, –º–∏–Ω–∏–º—É–º 21 —Å–≤–µ—á–∞)

**2. –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã:**
- ‚úÖ RSI (–∑–Ω–∞—á–µ–Ω–∏–µ –∏ —Å–∏–≥–Ω–∞–ª)
- ‚úÖ MACD (–∑–Ω–∞—á–µ–Ω–∏–µ, —Å–∏–≥–Ω–∞–ª, –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞)
- ‚úÖ EMA/SMA (fast –∏ slow, —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É –Ω–∏–º–∏)
- ‚úÖ ATR (–∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è –∞–¥–∞–ø—Ç–∏–≤–Ω—ã—Ö SL/TP)
- ‚úÖ ADX (+DI, -DI –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞)
- ‚úÖ Bollinger Bands (–≤–µ—Ä—Ö–Ω—è—è, –Ω–∏–∂–Ω—è—è, —Å—Ä–µ–¥–Ω—è—è)

**3. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–µ–∂–∏–º–∞:**
- ‚úÖ –¢–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º (trending/ranging/choppy)
- ‚úÖ TP% –¥–ª—è —Ä–µ–∂–∏–º–∞
- ‚úÖ SL% –¥–ª—è —Ä–µ–∂–∏–º–∞
- ‚úÖ min_score_threshold –¥–ª—è —Ä–µ–∂–∏–º–∞
- ‚úÖ position_size_multiplier –¥–ª—è —Ä–µ–∂–∏–º–∞
- ‚úÖ tp_atr_multiplier –¥–ª—è —Ä–µ–∂–∏–º–∞
- ‚úÖ sl_atr_multiplier –¥–ª—è —Ä–µ–∂–∏–º–∞

**4. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–æ–≤ (–∏–∑ symbol_profiles):**
- ‚úÖ **Liquidity filter:** min_best_bid_volume_usd, min_best_ask_volume_usd, min_orderbook_depth_usd, max_spread_percent
- ‚úÖ **Order Flow filter:** long_threshold, short_threshold, min_total_depth_usd
- ‚úÖ **Funding filter:** max_positive_rate, max_negative_rate, max_abs_rate
- ‚úÖ **Volatility filter:** min_range_percent, max_range_percent, min_atr_percent

**5. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –º–æ–¥—É–ª–µ–π (–∏–∑ symbol_profiles):**
- ‚úÖ **Multi-Timeframe:** block_opposite, score_bonus, confirmation_timeframe, fail_open_enabled
- ‚úÖ **ADX Filter:** adx_threshold, di_difference (–¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –ø–∞—Ä)
- ‚úÖ **Pivot Points:** level_tolerance_percent, score_bonus_near_level
- ‚úÖ **Volume Profile:** score_bonus_in_value_area, score_bonus_near_poc

**6. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∑–∏—Ü–∏–∏ (–∏–∑ symbol_profiles):**
- ‚úÖ base_position_usd
- ‚úÖ min_position_usd
- ‚úÖ max_position_usd
- ‚úÖ position_multiplier (–æ–±—â–∏–π –¥–ª—è –ø–∞—Ä—ã)

---

### 8.3 –ü–æ—Ä—è–¥–æ–∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ

**1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞ (OKX API)**
```python
# orchestrator.py:_initialize_client()
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ OKX API
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ leverage –¥–ª—è –∫–∞–∂–¥–æ–π –ø–∞—Ä—ã
```

**2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è DataRegistry**
```python
# orchestrator.py:_initialize_data_registry()
- –°–æ–∑–¥–∞–Ω–∏–µ DataRegistry
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è CandleBuffer –¥–ª—è –∫–∞–∂–¥–æ–π –ø–∞—Ä—ã
- –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—á–∞–ª—å–Ω—ã—Ö —Å–≤–µ—á–µ–π (200 —Å–≤–µ—á–µ–π 1m)
```

**3. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è WebSocket**
```python
# orchestrator.py:_initialize_websocket()
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ WebSocket
- –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Ç–∏–∫–µ—Ä—ã –¥–ª—è –∫–∞–∂–¥–æ–π –ø–∞—Ä—ã
- –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–≤–µ—á–∏ 1m –¥–ª—è –∫–∞–∂–¥–æ–π –ø–∞—Ä—ã
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ DataRegistry –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
```

**4. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è SignalGenerator**
```python
# orchestrator.py:_initialize_signal_generator()
- –°–æ–∑–¥–∞–Ω–∏–µ IndicatorManager
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ (RSI, MACD, EMA, ATR, ADX, BB)
- –ó–∞–≥—Ä—É–∑–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏–∑ config_futures.yaml
- –ó–∞–≥—Ä—É–∑–∫–∞ symbol_profiles –¥–ª—è –∫–∞–∂–¥–æ–π –ø–∞—Ä—ã
```

**5. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è RegimeManager**
```python
# orchestrator.py:_initialize_regime_manager()
- –°–æ–∑–¥–∞–Ω–∏–µ RegimeManager –¥–ª—è –∫–∞–∂–¥–æ–π –ø–∞—Ä—ã
- –ó–∞–≥—Ä—É–∑–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Ä–µ–∂–∏–º–æ–≤ –∏–∑ config_futures.yaml
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ –¥–ª—è –∫–∞–∂–¥–æ–π –ø–∞—Ä—ã
```

**6. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è RiskManager**
```python
# orchestrator.py:_initialize_risk_manager()
- –°–æ–∑–¥–∞–Ω–∏–µ FuturesRiskManager
- –ó–∞–≥—Ä—É–∑–∫–∞ risk_config –∏–∑ config_futures.yaml
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–ª–∞–Ω—Å–∞ –∏ –ø—Ä–æ—Ñ–∏–ª—è –±–∞–ª–∞–Ω—Å–∞
```

**7. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è PositionManager**
```python
# orchestrator.py:_initialize_position_manager()
- –°–æ–∑–¥–∞–Ω–∏–µ FuturesPositionManager
- –ó–∞–≥—Ä—É–∑–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø–æ–∑–∏—Ü–∏–π –∏–∑ symbol_profiles
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ExitAnalyzer —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ —Ä–µ–∂–∏–º–æ–≤
```

---

### 8.4 –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –¥–∞–Ω–Ω—ã–º –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Å–∏–≥–Ω–∞–ª–∞

**–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- ‚úÖ –ú–∏–Ω–∏–º—É–º 20 —Å–≤–µ—á–µ–π 1m (–¥–ª—è –±–∞–∑–æ–≤—ã—Ö –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤)
- ‚úÖ –ú–∏–Ω–∏–º—É–º 21 —Å–≤–µ—á–∞ 5m (–¥–ª—è Multi-Timeframe —Ñ–∏–ª—å—Ç—Ä–∞)
- ‚úÖ –¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞ (—á–µ—Ä–µ–∑ WebSocket)
- ‚úÖ Best bid/ask (—á–µ—Ä–µ–∑ WebSocket)
- ‚úÖ Orderbook depth (—á–µ—Ä–µ–∑ WebSocket –∏–ª–∏ API)
- ‚úÖ Funding rate (—á–µ—Ä–µ–∑ API, –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Ä–µ–∂–µ)

**–û–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- ‚úÖ 200 —Å–≤–µ—á–µ–π 1m (–¥–ª—è —Ç–æ—á–Ω—ã—Ö —Ä–∞—Å—á–µ—Ç–æ–≤ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤)
- ‚úÖ 50 —Å–≤–µ—á–µ–π 5m (–¥–ª—è Multi-Timeframe —Ñ–∏–ª—å—Ç—Ä–∞)
- ‚úÖ –†–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö (WebSocket)
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—è —Ä–µ–∂–∏–º–æ–≤ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 15 –º–∏–Ω—É—Ç

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö:**
```python
# –ü–µ—Ä–µ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π —Å–∏–≥–Ω–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è:
1. –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ª–∏ —Å–≤–µ—á–µ–π (>= 20 –¥–ª—è 1m, >= 21 –¥–ª—è 5m)
2. –ê–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö (updated_at < 5 —Å–µ–∫—É–Ω–¥ –Ω–∞–∑–∞–¥)
3. –í–∞–ª–∏–¥–Ω–æ—Å—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ (–Ω–µ None, –Ω–µ NaN)
4. –û–ø—Ä–µ–¥–µ–ª–µ–Ω –ª–∏ —Ä–µ–∂–∏–º (regime != None)
```

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ç—á–µ—Ç–∞:** 2025-12-22  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ü–û–õ–ù–´–ô –ê–ù–ê–õ–ò–ó –ó–ê–í–ï–†–®–ï–ù**  
**–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö:** `logs/futures/archived/logs_2025-12-22_16-35-54/`

