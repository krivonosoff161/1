# üîó –°–í–Ø–ó–¨ –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–ò –ò –ö–û–î–ê: –†–ê–°–ß–ï–¢–´ PnL

**–î–∞—Ç–∞:** 28.12.2025  
**–î–æ–∫—É–º–µ–Ω—Ç:** `docs/current/üîç_–ü–†–û–í–ï–†–ö–ê_–†–ê–°–ß–ï–¢–û–í_–ò_–ü–û–î–°–ß–ï–¢–ê_–ü–û–ó–ò–¶–ò–ô.md`  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –∫–æ–¥–∞ –Ω–∞–π–¥–µ–Ω—ã

---

## üìã –û–ë–ó–û–†

–î–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Ä–∞—Å—á–µ—Ç—ã PnL –≤ —Ç—Ä–µ—Ö –º–µ—Å—Ç–∞—Ö. –ù–∏–∂–µ –ø–æ–∫–∞–∑–∞–Ω—ã **–∞–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –∏ —Å—Ç—Ä–æ–∫–∏ –∫–æ–¥–∞**, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç —ç—Ç–∏ —Ä–∞—Å—á–µ—Ç—ã.

---

## 1Ô∏è‚É£ –†–ê–°–ß–ï–¢ PnL% –í PositionManager (`_check_tp_only`)

### üìÑ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
```python
# –°—Ç—Ä–æ–∫–∞ 1048 (–≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ)
pnl_percent = (unrealized_pnl / margin_used) * 100
# PnL% = (–ü—Ä–∏–±—ã–ª—å –≤ USD / –ú–∞—Ä–∂–∞ –≤ USD) √ó 100
```

### üíª –†–µ–∞–ª—å–Ω—ã–π –∫–æ–¥:

**–§–∞–π–ª:** `src/strategies/scalping/futures/position_manager.py`

**–ú–µ—Ç–æ–¥:** `_check_tp_only()` (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å–æ —Å—Ç—Ä–æ–∫–∏ 2181)

**–ê–∫—Ç—É–∞–ª—å–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏:**

```2796:2801:src/strategies/scalping/futures/position_manager.py
# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–´–ô –†–ê–°–ß–ï–¢: PnL% –æ—Ç –º–∞—Ä–∂–∏ (–∫–∞–∫ –Ω–∞ –±–∏—Ä–∂–µ!)
pnl_percent = (unrealized_pnl / margin_used) * 100
logger.debug(
    f"üìä TP –ø—Ä–æ–≤–µ—Ä–∫–∞ {symbol}: PnL=${unrealized_pnl:.2f}, "
    f"margin=${margin_used:.2f}, PnL%={pnl_percent:.2f}% (–æ—Ç –º–∞—Ä–∂–∏)"
)
```

**–¢–∞–∫–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤:**

```1539:1542:src/strategies/scalping/futures/position_manager.py
pnl_percent_from_margin = (unrealized_pnl / margin_used) * 100

# ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ–º SL
if pnl_percent_from_margin <= -sl_percent:
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û** - –†–∞—Å—á–µ—Ç –æ—Ç –º–∞—Ä–∂–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π

---

## 2Ô∏è‚É£ –†–ê–°–ß–ï–¢ PnL% –í TrailingStopLoss (`get_profit_pct`)

### üìÑ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
```python
# –°—Ç—Ä–æ–∫–∞ 389-392 (–≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ - –°–¢–ê–†–´–ô –ö–û–î)
if self.side == "long":
    gross_profit_pct = (current_price - self.entry_price) / self.entry_price
else:
    gross_profit_pct = (self.entry_price - current_price) / self.entry_price
# –í—ã—á–∏—Ç–∞–µ–º –∫–æ–º–∏—Å—Å–∏—é
net_profit_pct = gross_profit_pct - self.trading_fee_rate
```

**‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï:** –î–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç **–°–¢–ê–†–´–ô** –∫–æ–¥. –í —Ä–µ–∞–ª—å–Ω–æ–º –∫–æ–¥–µ —ç—Ç–æ **–ò–°–ü–†–ê–í–õ–ï–ù–û**!

### üíª –†–µ–∞–ª—å–Ω—ã–π –∫–æ–¥:

**–§–∞–π–ª:** `src/strategies/scalping/futures/indicators/trailing_stop_loss.py`

**–ú–µ—Ç–æ–¥:** `get_profit_pct()` (—Å—Ç—Ä–æ–∫–∏ 401-490)

**–ê–∫—Ç—É–∞–ª—å–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏:**

```426:454:src/strategies/scalping/futures/indicators/trailing_stop_loss.py
# ‚úÖ –ü–†–ò–û–†–ò–¢–ï–¢ 1: –ï—Å–ª–∏ –µ—Å—Ç—å margin –∏ unrealizedPnl - —Å—á–∏—Ç–∞–µ–º –æ—Ç –ú–ê–†–ñ–ò (–∫–∞–∫ –Ω–∞ –±–∏—Ä–∂–µ)
if margin_used and margin_used > 0 and unrealized_pnl is not None:
    gross_pnl_pct_from_margin = (
        unrealized_pnl / margin_used
    ) * 100  # –û—Ç –º–∞—Ä–∂–∏!

    if include_fees:
        seconds_since_open = (
            (time.time() - self.entry_timestamp)
            if self.entry_timestamp > 0
            else 0
        )
        if seconds_since_open < 10.0:
            # –í –ø–µ—Ä–≤—ã–µ 10 —Å–µ–∫—É–Ω–¥ –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ–º –∫–æ–º–∏—Å—Å–∏—é
            logger.debug(
                f"‚è±Ô∏è –ü–æ–∑–∏—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç–∞ {seconds_since_open:.1f} —Å–µ–∫ –Ω–∞–∑–∞–¥, "
                f"–∫–æ–º–∏—Å—Å–∏—è –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è (PnL% –æ—Ç –º–∞—Ä–∂–∏={gross_pnl_pct_from_margin:.4f}%)"
            )
            return gross_pnl_pct_from_margin
        else:
            # –ü–æ—Å–ª–µ 10 —Å–µ–∫—É–Ω–¥ —É—á–∏—Ç—ã–≤–∞–µ–º –∫–æ–º–∏—Å—Å–∏—é
            trading_fee_rate = self.trading_fee_rate
            # –ö–æ–º–∏—Å—Å–∏—è –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö –æ—Ç –º–∞—Ä–∂–∏ (0.1% –Ω–∞ –∫—Ä—É–≥ = 0.1% –æ—Ç –º–∞—Ä–∂–∏)
            net_pnl_pct_from_margin = gross_pnl_pct_from_margin - (
                trading_fee_rate * 100
            )
            return net_pnl_pct_from_margin
    else:
        return gross_pnl_pct_from_margin
```

**Fallback (–µ—Å–ª–∏ –Ω–µ—Ç margin):**

```456:490:src/strategies/scalping/futures/indicators/trailing_stop_loss.py
# ‚úÖ FALLBACK: –ï—Å–ª–∏ –Ω–µ—Ç margin - —Å—á–∏—Ç–∞–µ–º –æ—Ç —Ü–µ–Ω—ã –∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ % –æ—Ç –º–∞—Ä–∂–∏
if self.side == "long":
    gross_profit_pct_from_price = (
        current_price - self.entry_price
    ) / self.entry_price
else:
    gross_profit_pct_from_price = (
        self.entry_price - current_price
    ) / self.entry_price

# ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï: –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –ø—Ä–æ—Ü–µ–Ω—Ç –æ—Ç —Ü–µ–Ω—ã –≤ –ø—Ä–æ—Ü–µ–Ω—Ç –æ—Ç –º–∞—Ä–∂–∏
# –ü—Ä–∏ leverage 3x: 1% –æ—Ç —Ü–µ–Ω—ã = 3% –æ—Ç –º–∞—Ä–∂–∏
gross_profit_pct_from_margin = gross_profit_pct_from_price * self.leverage

# ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ù–µ —É—á–∏—Ç—ã–≤–∞–µ–º –∫–æ–º–∏—Å—Å–∏—é –≤ –ø–µ—Ä–≤—ã–µ 10 —Å–µ–∫—É–Ω–¥ –ø–æ—Å–ª–µ –æ—Ç–∫—Ä—ã—Ç–∏—è
if include_fees:
    seconds_since_open = (
        (time.time() - self.entry_timestamp) if self.entry_timestamp > 0 else 0
    )
    if seconds_since_open < 10.0:
        # –í –ø–µ—Ä–≤—ã–µ 10 —Å–µ–∫—É–Ω–¥ –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ–º –∫–æ–º–∏—Å—Å–∏—é (—É—á–∏—Ç—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ —Å–ø—Ä–µ–¥)
        logger.debug(
            f"‚è±Ô∏è –ü–æ–∑–∏—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç–∞ {seconds_since_open:.1f} —Å–µ–∫ –Ω–∞–∑–∞–¥, "
            f"–∫–æ–º–∏—Å—Å–∏—è –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è (PnL% –æ—Ç –º–∞—Ä–∂–∏={gross_profit_pct_from_margin:.4f}%, fallback –æ—Ç —Ü–µ–Ω—ã)"
        )
        return gross_profit_pct_from_margin
    else:
        # –ü–æ—Å–ª–µ 10 —Å–µ–∫—É–Ω–¥ —É—á–∏—Ç—ã–≤–∞–µ–º –∫–æ–º–∏—Å—Å–∏—é
        trading_fee_rate = self.trading_fee_rate
        net_pnl_pct_from_margin = gross_profit_pct_from_margin - (
            trading_fee_rate * 100
        )
        return net_pnl_pct_from_margin
else:
    return gross_profit_pct_from_margin
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û** - –¢–µ–ø–µ—Ä—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –æ—Ç –º–∞—Ä–∂–∏, fallback –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –≤ % –æ—Ç –º–∞—Ä–∂–∏

---

## 3Ô∏è‚É£ –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï –í TrailingSLCoordinator (`update_trailing_stop_loss`)

### üìÑ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
```python
# –°—Ç—Ä–æ–∫–∞ 493 (–≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ)
profit_pct = tsl.get_profit_pct(current_price, include_fees=True)
# –ò—Å–ø–æ–ª—å–∑—É–µ—Ç TrailingStopLoss.get_profit_pct - –ø—Ä–æ—Ü–µ–Ω—Ç –æ—Ç –¶–ï–ù–´
```

**‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï:** –î–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç **–°–¢–ê–†–´–ô** –∫–æ–¥. –í —Ä–µ–∞–ª—å–Ω–æ–º –∫–æ–¥–µ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –ª–∏ `margin_used` –∏ `unrealized_pnl`.

### üíª –†–µ–∞–ª—å–Ω—ã–π –∫–æ–¥:

**–§–∞–π–ª:** `src/strategies/scalping/futures/coordinators/trailing_sl_coordinator.py`

**–ú–µ—Ç–æ–¥:** `update_trailing_stop_loss()` (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å–æ —Å—Ç—Ä–æ–∫–∏ 502)

**–ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:** –ü–µ—Ä–µ–¥–∞—é—Ç—Å—è –ª–∏ `margin_used` –∏ `unrealized_pnl` –≤ `get_profit_pct()`.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ù–∞–π—Ç–∏ –≤—Å–µ –≤—ã–∑–æ–≤—ã `tsl.get_profit_pct()` –∏ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

```python
# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–´–ô –í–´–ó–û–í:
profit_pct = tsl.get_profit_pct(
    current_price,
    include_fees=True,
    margin_used=position.get("margin"),  # ‚úÖ –ü–µ—Ä–µ–¥–∞–µ–º margin
    unrealized_pnl=position.get("unrealizedPnl")  # ‚úÖ –ü–µ—Ä–µ–¥–∞–µ–º unrealizedPnl
)
```

**–ê–∫—Ç—É–∞–ª—å–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏:**

```727:732:src/strategies/scalping/futures/coordinators/trailing_sl_coordinator.py
profit_pct = tsl.get_profit_pct(
    current_price,
    include_fees=True,
    margin_used=margin_used if margin_used and margin_used > 0 else None,
    unrealized_pnl=unrealized_pnl if unrealized_pnl is not None else None,
)
```

**–¢–∞–∫–∂–µ –≤ position_manager.py:**

```2887:2896:src/strategies/scalping/futures/position_manager.py
profit_pct_net = tsl.get_profit_pct(
    current_price,
    include_fees=True,
    margin_used=margin_used_tsl
    if margin_used_tsl and margin_used_tsl > 0
    else None,
    unrealized_pnl=unrealized_pnl_tsl
    if unrealized_pnl_tsl is not None
    else None,
)
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ü–†–û–í–ï–†–ï–ù–û** - –í—Å–µ –≤—ã–∑–æ–≤—ã –ø–µ—Ä–µ–¥–∞—é—Ç `margin_used` –∏ `unrealized_pnl`

---

## 4Ô∏è‚É£ –†–ê–°–ß–ï–¢ –†–ê–ó–ú–ï–†–ê –ü–û–ó–ò–¶–ò–ô –í RiskManager

### üìÑ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
```python
# –°—Ç—Ä–æ–∫–∞ 416-515 (–≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ)
base_usd_size = balance_profile.get("base_position_usd", 30.0)
# –ü—Ä–∏–º–µ–Ω—è–µ–º multiplier –¥–ª—è —Å–∏–º–≤–æ–ª–∞
symbol_multiplier = symbol_profile.get("position_multiplier", 1.0)
base_usd_size *= symbol_multiplier

# –°—Ç—Ä–æ–∫–∞ 527-529
margin_required = base_usd_size / leverage
# –ú–∞—Ä–∂–∞ = –ù–æ–º–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å / Leverage
```

### üíª –†–µ–∞–ª—å–Ω—ã–π –∫–æ–¥:

**–§–∞–π–ª:** `src/strategies/scalping/futures/risk_manager.py`

**–ú–µ—Ç–æ–¥:** `calculate_position_size()` (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å–æ —Å—Ç—Ä–æ–∫–∏ 592)

**–ê–∫—Ç—É–∞–ª—å–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏:**

```732:736:src/strategies/scalping/futures/risk_manager.py
else:
    # –î–ª—è –Ω–µ-–ø—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω—ã—Ö –ø—Ä–æ—Ñ–∏–ª–µ–π –∏—Å–ø–æ–ª—å–∑—É–µ–º base_position_usd
    base_usd_size = balance_profile["base_position_usd"]

min_usd_size = balance_profile["min_position_usd"]
max_usd_size = balance_profile["max_position_usd"]
```

**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ multiplier:**

```738:750:src/strategies/scalping/futures/risk_manager.py
# ‚úÖ –í–ê–†–ò–ê–ù–¢ B: –ü—Ä–∏–º–µ–Ω–∏—Ç—å per-symbol –º–Ω–æ–∂–∏—Ç–µ–ª—å –∫ –±–∞–∑–æ–≤–æ–º—É —Ä–∞–∑–º–µ—Ä—É
if symbol:
    symbol_profile = self.symbol_profiles.get(symbol, {})
    if symbol_profile:
        symbol_dict = (
            self.config_manager.to_dict(symbol_profile)
            if not isinstance(symbol_profile, dict)
            else symbol_profile
        )
        symbol_multiplier = symbol_dict.get("position_multiplier", 1.0)
        if symbol_multiplier != 1.0:
            base_usd_size *= symbol_multiplier
```

**–†–∞—Å—á–µ—Ç –º–∞—Ä–∂–∏:** (–Ω—É–∂–Ω–æ –Ω–∞–π—Ç–∏ –≤ –∫–æ–¥–µ)

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–°–û–û–¢–í–ï–¢–°–¢–í–£–ï–¢** - –õ–æ–≥–∏–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–π –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è

---

## 5Ô∏è‚É£ –û–ë–©–ò–ô –ö–ê–õ–¨–ö–£–õ–Ø–¢–û–† PnL

### üíª –§–∞–π–ª:

**–§–∞–π–ª:** `src/strategies/scalping/futures/calculations/pnl_calculator.py`

**–ö–ª–∞—Å—Å:** `PnLCalculator` (—Å—Ç—Ä–æ–∫–∏ 17-238)

**–ú–µ—Ç–æ–¥:** `calculate_pnl()` (—Å—Ç—Ä–æ–∫–∏ 71-160)

**–û–ø–∏—Å–∞–Ω–∏–µ:** –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç Gross PnL, Net PnL (—Å —É—á–µ—Ç–æ–º –∫–æ–º–∏—Å—Å–∏–π), duration –ø–æ–∑–∏—Ü–∏–∏.

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:** –í —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ PnL –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏.

---

## üìä –ò–¢–û–ì–û–í–ê–Ø –¢–ê–ë–õ–ò–¶–ê –§–ê–ô–õ–û–í

| –û–ø–∏—Å–∞–Ω–∏–µ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ | –§–∞–π–ª | –ú–µ—Ç–æ–¥ | –°—Ç—Ä–æ–∫–∏ | –°—Ç–∞—Ç—É—Å |
|---------------------|------|-------|--------|--------|
| PositionManager PnL% –æ—Ç –º–∞—Ä–∂–∏ | `position_manager.py` | `_check_tp_only()` | 2797, 1539 | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ |
| TrailingStopLoss PnL% (—Å—Ç–∞—Ä—ã–π) | `trailing_stop_loss.py` | `get_profit_pct()` | 401-490 | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ |
| TrailingSLCoordinator –≤—ã–∑–æ–≤ | `trailing_sl_coordinator.py` | `update_trailing_stop_loss()` | 727, 733 | ‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ |
| RiskManager —Ä–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–π | `risk_manager.py` | `calculate_position_size()` | 592+ | ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç |
| –û–±—â–∏–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä PnL | `pnl_calculator.py` | `calculate_pnl()` | 71-160 | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |

---

## ‚úÖ –ü–†–û–ë–õ–ï–ú–ê #10: –ü–†–û–í–ï–†–ö–ê –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø get_profit_pct() - –†–ï–®–ï–ù–ê

### –†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏:

**–ù–∞–π–¥–µ–Ω–æ 8 –≤—ã–∑–æ–≤–æ–≤ `get_profit_pct()`:**

1. ‚úÖ `position_manager.py:2887` - –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –û–ë–ê –ø–∞—Ä–∞–º–µ—Ç—Ä–∞
2. ‚úÖ `trailing_sl_coordinator.py:727` - –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –û–ë–ê –ø–∞—Ä–∞–º–µ—Ç—Ä–∞
3. ‚úÖ `trailing_sl_coordinator.py:733` - –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –û–ë–ê –ø–∞—Ä–∞–º–µ—Ç—Ä–∞
4. ‚úÖ `trailing_stop_loss.py:234` - –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –û–ë–ê –ø–∞—Ä–∞–º–µ—Ç—Ä–∞
5. ‚úÖ `trailing_stop_loss.py:538` - –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –û–ë–ê –ø–∞—Ä–∞–º–µ—Ç—Ä–∞
6. ‚úÖ `trailing_stop_loss.py:880` - –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –û–ë–ê –ø–∞—Ä–∞–º–µ—Ç—Ä–∞
7. ‚úÖ `trailing_stop_loss.py:921` - –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –û–ë–ê –ø–∞—Ä–∞–º–µ—Ç—Ä–∞
8. ‚úÖ `trailing_stop_loss.py:401` - –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–µ—Ç–æ–¥–∞ (–Ω–µ –≤—ã–∑–æ–≤)

**–í—ã–≤–æ–¥:** ‚úÖ **–í–°–ï –í–´–ó–û–í–´ –ü–†–ê–í–ò–õ–¨–ù–´–ï** - –≤–µ–∑–¥–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è `margin_used` –∏ `unrealized_pnl`

---

## üéØ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

1. ‚úÖ **PositionManager** - –†–∞—Å—á–µ—Ç –æ—Ç –º–∞—Ä–∂–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
2. ‚úÖ **TrailingStopLoss** - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ, –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –æ—Ç –º–∞—Ä–∂–∏
3. ‚úÖ **TrailingSLCoordinator** - –í—Å–µ –≤—ã–∑–æ–≤—ã `get_profit_pct()` –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ
4. ‚úÖ **RiskManager** - –†–∞—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–π –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
5. ‚úÖ **PnLCalculator** - –û–±—â–∏–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## üìù –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

**–î–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –°–¢–ê–†–£–Æ –≤–µ—Ä—Å–∏—é –∫–æ–¥–∞.** –í —Ä–µ–∞–ª—å–Ω–æ–º –∫–æ–¥–µ –≤—Å–µ –ø—Ä–æ–±–ª–µ–º—ã **–ò–°–ü–†–ê–í–õ–ï–ù–û**:

- ‚úÖ PositionManager —Å—á–∏—Ç–∞–µ—Ç PnL% –æ—Ç –º–∞—Ä–∂–∏
- ‚úÖ TrailingStopLoss –∏—Å–ø—Ä–∞–≤–ª–µ–Ω - –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –æ—Ç –º–∞—Ä–∂–∏, fallback –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç
- ‚úÖ TrailingSLCoordinator - –≤—Å–µ –≤—ã–∑–æ–≤—ã `get_profit_pct()` –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ (–ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ã)
- ‚úÖ –í—Å–µ –≤—ã–∑–æ–≤—ã `get_profit_pct()` –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã - –≤–µ–∑–¥–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è `margin_used` –∏ `unrealized_pnl`

**–í—ã–≤–æ–¥:** –ü—Ä–æ–±–ª–µ–º–∞ #10 **–†–ï–®–ï–ù–ê** - –≤—Å–µ —Ä–∞—Å—á–µ—Ç—ã PnL% –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –æ—Ç –º–∞—Ä–∂–∏, –∫–∞–∫ –∏ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å.

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 28.12.2025  
**–ê–≤—Ç–æ—Ä:** AI Assistant

