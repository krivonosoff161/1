# üìã –ü–û–õ–ù–´–ô –ü–õ–ê–ù –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô

**–î–∞—Ç–∞:** 28.12.2025  
**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏  
**–í—Å–µ–≥–æ –ø—Ä–æ–±–ª–µ–º:** 11 (–∏–∑ –Ω–∏—Ö #10 —Ä–µ—à–µ–Ω–∞, #11 –Ω–æ–≤–∞—è)

---

## üìä –°–í–û–î–ù–ê–Ø –¢–ê–ë–õ–ò–¶–ê –ü–†–û–ë–õ–ï–ú

| # | –ü—Ä–æ–±–ª–µ–º–∞ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –°—Ç–∞—Ç—É—Å | –§–∞–π–ª—ã | –°—Ç—Ä–æ–∫–∏ |
|---|----------|-----------|--------|-------|--------|
| #1 | –û—à–∏–±–∫–∞ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Ç–∏–ø–æ–≤ –≤ ExitAnalyzer | üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ | –¢—Ä–µ–±—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è | `exit_analyzer.py`, `parameter_provider.py` | ~3233, ~200 |
| #2 | –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–π –º–µ—Ç–æ–¥ check_safety –≤ MarginMonitor | üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ | –¢—Ä–µ–±—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è | `margin_monitor.py`, `risk_manager.py` | ~1724 |
| #3 | –ü–æ–∑–∏—Ü–∏–∏ –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è –Ω–∞ –±–∏—Ä–∂–µ –±–µ–∑ –±–æ—Ç–∞ | üü° –í–∞–∂–Ω–æ | –¢—Ä–µ–±—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è | `orchestrator.py`, `futures_client.py` | ~2343, ~end |
| #4 | –°–ª–∏—à–∫–æ–º –±—ã—Å—Ç—Ä—ã–π SL | üü° –í–∞–∂–Ω–æ | –¢—Ä–µ–±—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è | `config_futures.yaml`, `parameter_provider.py` | - |
| #5 | –ù–∏–∑–∫–∞—è –∫–æ–Ω–≤–µ—Ä—Å–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤ | üü° –í–∞–∂–Ω–æ | –¢—Ä–µ–±—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è | `config_futures.yaml`, `signal_generator.py` | ~end |
| #6 | –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–∞ | üü¢ –ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ | –¢—Ä–µ–±—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è | `direction_analyzer.py`, `signal_generator.py` | ~30, ~500 |
| #7 | –ú–∞–ª–æ–µ min_holding_minutes –≤ TP check | üü° –í–∞–∂–Ω–æ | –¢—Ä–µ–±—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è | `position_manager.py` | ~2266 |
| #8 | –ê–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π Profit Harvesting | üü° –í–∞–∂–Ω–æ | –¢—Ä–µ–±—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è | `config_futures.yaml`, `position_manager.py` | ~1607 |
| #9 | –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–ª–æ–∫–∏—Ä—É—é—Ç —Å–∏–≥–Ω–∞–ª—ã | üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ | –¢—Ä–µ–±—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è | `signal_generator.py`, `signal_coordinator.py` | ~end, ~148 |
| #10 | –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ä–∞—Å—á–µ—Ç–æ–≤ PnL | ‚úÖ –†–µ—à–µ–Ω–∞ | –ù–µ —Ç—Ä–µ–±—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è | `trailing_stop_loss.py` | ~401 |
| #11 | –°–ª–∞–±–∞—è WS-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¥–ª—è –ø–æ–∑–∏—Ü–∏–π | üü° –í–∞–∂–Ω–æ | –¢—Ä–µ–±—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è | `orchestrator.py`, `futures_client.py` | ~600 |

---

## üî¥ –ü–†–ò–û–†–ò–¢–ï–¢ 1: –ö–†–ò–¢–ò–ß–ù–û (–ë–ª–æ–∫–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É –±–æ—Ç–∞)

### –ü–†–û–ë–õ–ï–ú–ê #1: –û—à–∏–±–∫–∞ –°—Ä–∞–≤–Ω–µ–Ω–∏—è –¢–∏–ø–æ–≤ –≤ ExitAnalyzer

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–í–ï–†–ù–û** - –ü—Ä–æ–±–ª–µ–º–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞

**–û–ø–∏—Å–∞–Ω–∏–µ:**
- `max_holding_minutes` –∏–∑ `parameter_provider.get_exit_params()` –º–æ–∂–µ—Ç –±—ã—Ç—å `str` (YAML –ø–∞—Ä—Å–∏—Ç –∫–∞–∫ str –µ—Å–ª–∏ –≤ –∫–∞–≤—ã—á–∫–∞—Ö)
- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ `minutes_in_position >= max_holding_minutes` –ø–∞–¥–∞–µ—Ç —Å `TypeError: '>' not supported between instances of 'str' and 'int'`
- –ú–µ—Ç–æ–¥ `_to_float()` –≤ `exit_analyzer.py` –µ—Å—Ç—å, –Ω–æ `parameter_provider` –Ω–µ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç —Ç–∏–ø—ã

**–§–∞–π–ª—ã:**
- `src/strategies/scalping/futures/positions/exit_analyzer.py` (—Å—Ç—Ä–æ–∫–∞ ~3233, –º–µ—Ç–æ–¥ `_generate_exit_for_ranging`)
- `src/strategies/scalping/futures/config/parameter_provider.py` (—Å—Ç—Ä–æ–∫–∞ ~200, –º–µ—Ç–æ–¥ `get_exit_params`)

**–ü–∞—Ç—á:**

```python
# –í parameter_provider.py, –º–µ—Ç–æ–¥ get_exit_params (—Å—Ç—Ä–æ–∫–∏ ~200+):
def get_exit_params(self, symbol: str, regime: Optional[str] = None) -> Dict[str, Any]:
    """
    –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤—ã—Ö–æ–¥–∞ —Å –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–µ–π —Ç–∏–ø–æ–≤.
    """
    params = self.config_manager.get_exit_params(regime=regime) or {}
    
    # ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Ç–∏–ø–æ–≤ –¥–ª—è –≤—Å–µ—Ö —á–∏—Å–ª–æ–≤—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
    def _to_float(value: Any, name: str, default: float = 0.0) -> float:
        """Helper –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –≤ float"""
        if value is None:
            return default
        if isinstance(value, (int, float)):
            return float(value)
        if isinstance(value, str):
            try:
                return float(value)
            except (ValueError, TypeError):
                logger.warning(
                    f"‚ö†Ô∏è ParameterProvider: –ù–µ —É–¥–∞–ª–æ—Å—å –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å {name}={value} –≤ float, "
                    f"–∏—Å–ø–æ–ª—å–∑—É–µ–º default={default}"
                )
                return default
        return default
    
    # –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –∫–ª—é—á–µ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
    params['max_holding_minutes'] = _to_float(
        params.get('max_holding_minutes'), 
        'max_holding_minutes', 
        25.0  # Default –¥–ª—è ranging
    )
    params['sl_atr_multiplier'] = _to_float(
        params.get('sl_atr_multiplier'), 
        'sl_atr_multiplier', 
        1.5
    )
    params['tp_atr_multiplier'] = _to_float(
        params.get('tp_atr_multiplier'), 
        'tp_atr_multiplier', 
        1.0
    )
    params['min_profit_for_extension'] = _to_float(
        params.get('min_profit_for_extension'), 
        'min_profit_for_extension', 
        0.4
    )
    params['extension_percent'] = _to_float(
        params.get('extension_percent'), 
        'extension_percent', 
        100.0
    )
    
    return params
```

**–¢–∞–∫–∂–µ –≤ exit_analyzer.py (—Å—Ç—Ä–æ–∫–∞ ~3291):**

```python
# –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è _to_float() –ø–µ—Ä–µ–¥ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ–º:
max_holding_minutes = self._get_max_holding_minutes(regime, symbol)
max_holding_minutes_float = self._to_float(
    max_holding_minutes, 
    "max_holding_minutes", 
    25.0
)

if float(minutes_in_position) >= max_holding_minutes_float:
    # ... –ª–æ–≥–∏–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è
```

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```python
# –°–∏–º—É–ª—è—Ü–∏—è (–ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ —Å code_execution):
def _to_float(value, name, default=25.0):
    try:
        return float(value)
    except:
        print(f"Warning: Invalid {name}={value}, using default={default}")
        return default

# –¢–µ—Å—Ç—ã:
raw_str = "25"  # str –∏–∑ YAML
converted_str = _to_float(raw_str, "max_holding_minutes")
assert converted_str == 25.0  # ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç

raw_int = 30
converted_int = _to_float(raw_int, "max_holding_minutes")
assert converted_int == 30.0  # ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç

raw_invalid = "abc"
converted_invalid = _to_float(raw_invalid, "max_holding_minutes")
assert converted_invalid == 25.0  # ‚úÖ Fallback —Ä–∞–±–æ—Ç–∞–µ—Ç

# ‚úÖ –†–ï–ó–£–õ–¨–¢–ê–¢: –í—Å–µ —Ç–∏–ø—ã –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É—é—Ç—Å—è safely
```

**–î–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Ç –ì—Ä–æ–∫–∞:** –î–æ–±–∞–≤–∏—Ç—å print/warning –≤ –∫–æ–¥ –¥–ª—è debug –ø—Ä–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏.

---

### –ü–†–û–ë–õ–ï–ú–ê #2: –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–π –ú–µ—Ç–æ–¥ check_safety –≤ MarginMonitor

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–í–ï–†–ù–û** - –ü—Ä–æ–±–ª–µ–º–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞

**–û–ø–∏—Å–∞–Ω–∏–µ:**
- –í `risk_manager.py` (—Å—Ç—Ä–æ–∫–∞ ~1724) –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `self.margin_monitor.check_safety()`
- –ú–µ—Ç–æ–¥ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ `MarginMonitor` (–µ—Å—Ç—å —Ç–æ–ª—å–∫–æ `check_margin_available()` –∏ `get_margin_ratio()`)
- –í—ã–∑—ã–≤–∞–µ—Ç `AttributeError: 'MarginMonitor' object has no attribute 'check_safety'`
- –ë–ª–æ–∫–∏—Ä—É–µ—Ç –æ—Ç–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–π (~15 —Ä–∞–∑ –ø–æ –ª–æ–≥–∞–º)

**–§–∞–π–ª—ã:**
- `src/strategies/scalping/futures/risk/margin_monitor.py` (–¥–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥)
- `src/strategies/scalping/futures/risk_manager.py` (—Å—Ç—Ä–æ–∫–∞ ~1724, –º–µ—Ç–æ–¥ `check_margin_safety`)

**–ü–∞—Ç—á:**

```python
# –í margin_monitor.py, –¥–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ –ø–æ—Å–ª–µ get_margin_ratio():
async def check_safety(
    self, 
    position_size_usd: float, 
    current_positions: Dict[str, Any],
    orchestrator: Optional[Any] = None,  # ‚úÖ –î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –±–∞–ª–∞–Ω—Å—É
    data_registry: Optional[Any] = None,  # ‚úÖ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö
) -> bool:
    """
    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –º–∞—Ä–∂–∏ –ø–µ—Ä–µ–¥ –æ—Ç–∫—Ä—ã—Ç–∏–µ–º –ø–æ–∑–∏—Ü–∏–∏.
    
    Args:
        position_size_usd: –†–∞–∑–º–µ—Ä –Ω–æ–≤–æ–π –ø–æ–∑–∏—Ü–∏–∏ –≤ USD
        current_positions: –¢–µ–∫—É—â–∏–µ –ø–æ–∑–∏—Ü–∏–∏ (–¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –æ–±—â–µ–π –º–∞—Ä–∂–∏)
        orchestrator: Orchestrator –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –±–∞–ª–∞–Ω—Å—É (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
        data_registry: DataRegistry –¥–ª—è —á—Ç–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
    
    Returns:
        bool: True –µ—Å–ª–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ
    """
    try:
        from loguru import logger
        
        # ‚úÖ –ü–æ–ª—É—á–∞–µ–º –±–∞–ª–∞–Ω—Å –∏ –º–∞—Ä–∂—É –∏–∑ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
        current_balance = 0.0
        used_margin = 0.0
        
        # –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: Orchestrator
        if orchestrator:
            try:
                if hasattr(orchestrator, 'client') and orchestrator.client:
                    current_balance = await orchestrator.client.get_balance() or 0.0
                if hasattr(orchestrator, '_get_used_margin'):
                    used_margin = await orchestrator._get_used_margin() or 0.0
            except Exception as e:
                logger.debug(f"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –±–∞–ª–∞–Ω—Å –∏–∑ orchestrator: {e}")
        
        # –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: DataRegistry (–∏–∑ orchestrator ~300)
        if (current_balance == 0.0 or used_margin == 0.0) and data_registry:
            try:
                margin_data = await data_registry.get_margin()
                balance_data = await data_registry.get_balance()
                if margin_data:
                    used_margin = margin_data.get("used", 0.0)
                if balance_data:
                    current_balance = balance_data.get("equity", balance_data.get("total", 0.0))
                logger.debug(
                    f"‚úÖ MarginMonitor: –î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã –∏–∑ data_registry "
                    f"(balance=${current_balance:.2f}, used_margin=${used_margin:.2f})"
                )
            except Exception as e:
                logger.debug(f"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –±–∞–ª–∞–Ω—Å –∏–∑ data_registry: {e}")
        
        # Fallback: –µ—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∏–ª–∏ –¥–∞–Ω–Ω—ã–µ
        if current_balance == 0.0:
            logger.warning("‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –±–∞–ª–∞–Ω—Å, –∏—Å–ø–æ–ª—å–∑—É–µ–º fallback 1000.0")
            current_balance = 1000.0  # Fallback
        
        # ‚úÖ –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ç—Ä–µ–±—É–µ–º—É—é –º–∞—Ä–∂—É (—Å —É—á–µ—Ç–æ–º leverage)
        leverage = self.config.get("leverage", 5)  # –ò–∑ –∫–æ–Ω—Ñ–∏–≥–∞ –∏–ª–∏ fallback
        required_margin = position_size_usd / leverage
        
        # ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –º–∞—Ä–∂–∏
        available, reason = self.check_margin_available(required_margin, current_balance, used_margin)
        
        # ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –º–∞—Ä–∂–∏
        margin_ratio = self.get_margin_ratio(current_balance, used_margin + required_margin)
        max_margin_ratio = self.config.get("max_margin_ratio", 0.8)  # –ò–∑ –∫–æ–Ω—Ñ–∏–≥–∞ –∏–ª–∏ 80%
        
        if not available:
            logger.warning(f"‚ùå Margin unsafe: {reason}")
            return False
        
        if margin_ratio > max_margin_ratio:
            logger.warning(
                f"‚ùå Margin ratio too high: {margin_ratio:.2%} > {max_margin_ratio:.2%} "
                f"(balance=${current_balance:.2f}, used=${used_margin:.2f}, required=${required_margin:.2f})"
            )
            return False
        
        logger.debug(
            f"‚úÖ Margin safe: ratio={margin_ratio:.2%} <= {max_margin_ratio:.2%}, "
            f"available=${current_balance - used_margin:.2f} >= required=${required_margin:.2f}"
        )
        return True
        
    except Exception as e:
        logger.error(f"‚ùå Error in check_safety: {e}", exc_info=True)
        return False  # –ë–µ–∑–æ–ø–∞—Å–Ω–µ–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏ –æ—à–∏–±–∫–µ
```

**–í risk_manager.py –∏–∑–º–µ–Ω–∏—Ç—å –≤—ã–∑–æ–≤ (—Å—Ç—Ä–æ–∫–∞ ~1724):**

```python
# –ë—ã–ª–æ:
return await self.margin_monitor.check_safety(
    position_size_usd, 
    current_positions
)

# –°—Ç–∞–ª–æ:
return await self.margin_monitor.check_safety(
    position_size_usd, 
    current_positions,
    orchestrator=self.orchestrator,  # ‚úÖ –ü–µ—Ä–µ–¥–∞–µ–º orchestrator
    data_registry=self.data_registry  # ‚úÖ –ü–µ—Ä–µ–¥–∞–µ–º data_registry
)
```

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```python
# Mock (–ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ —Å code_execution):
balance = 1000.0
used = 200.0
required = 100.0
available = balance - used  # 800.0
margin_ratio = (used + required) / balance  # 0.3
max_ratio = 0.8

assert available >= required  # ‚úÖ True
assert margin_ratio <= max_ratio  # ‚úÖ True
# –†–µ–∑—É–ª—å—Ç–∞—Ç: safe = True
```

**–î–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Ç –ì—Ä–æ–∫–∞:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `orchestrator.data_registry.get_balance()` (—Å—Ç—Ä–æ–∫–∏ ~300 –≤ orchestrator.py) –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞.

---

### –ü–†–û–ë–õ–ï–ú–ê #9: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ü—Ä–æ–≤–µ—Ä–∫–∏ –ë–ª–æ–∫–∏—Ä—É—é—Ç –°–∏–≥–Ω–∞–ª—ã

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–í–ï–†–ù–û** - –ü—Ä–æ–±–ª–µ–º–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞

**–û–ø–∏—Å–∞–Ω–∏–µ:**
- –í `signal_generator.py` —Ñ–∏–ª—å—Ç—Ä—ã (`min_strength` –∏–∑ config, `ranked_signals`) –±–ª–æ–∫–∏—Ä—É—é—Ç —Å–∏–≥–Ω–∞–ª—ã
- –í `signal_coordinator.py` –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ (side, strength, positions, margin) –±–ª–æ–∫–∏—Ä—É—é—Ç
- –ö–æ–Ω–≤–µ—Ä—Å–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤ ~3.1% (350 —Å–∏–≥–Ω–∞–ª–æ–≤ ‚Üí 11 —Å–¥–µ–ª–æ–∫)
- –ù–µ—Ç –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è, –∫–∞–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–ª–æ–∫–∏—Ä—É–µ—Ç

**–§–∞–π–ª—ã:**
- `src/strategies/scalping/futures/signal_generator.py` (–º–µ—Ç–æ–¥ `_filter_and_rank_signals`, ~end —Ñ–∞–π–ª–∞)
- `src/strategies/scalping/futures/coordinators/signal_coordinator.py` (–º–µ—Ç–æ–¥ `process_signals`, —Å—Ç—Ä–æ–∫–∞ ~148)

**–ü–∞—Ç—á:**

```python
# –í signal_coordinator.py, –¥–æ–±–∞–≤–∏—Ç—å —Å—á–µ—Ç—á–∏–∫–∏ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –≤ __init__:
self._block_stats = {
    "circuit_breaker": 0,
    "side_blocked": 0,
    "low_strength": 0,
    "existing_position": 0,
    "margin_unsafe": 0,
    "other": 0,
}

# –í process_signals (—Å—Ç—Ä–æ–∫–∞ ~148), –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
async def process_signals(self, signals: List[Dict[str, Any]]):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ—Ä–≥–æ–≤—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤"""
    try:
        total_signals = len(signals)
        blocked_count = 0
        
        for signal in signals:
            symbol = signal.get("symbol")
            side = signal.get("side")
            strength = signal.get("strength", 0)
            
            # ‚úÖ Circuit breaker
            if self.risk_manager and self.risk_manager.is_symbol_blocked(symbol):
                self._block_stats["circuit_breaker"] += 1
                blocked_count += 1
                logger.warning(
                    f"üö´ –ë–õ–û–ö–ò–†–û–í–ö–ê –°–ò–ì–ù–ê–õ–ê: {symbol} {side.upper()} - "
                    f"circuit_breaker (–±–ª–æ–∫–∏—Ä–æ–≤–æ–∫: {self._block_stats['circuit_breaker']})"
                )
                continue
            
            # ‚úÖ Side –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞
            signal_side = side.lower() if side else ""
            allow_short = getattr(self.scalping_config, "allow_short_positions", True)
            allow_long = getattr(self.scalping_config, "allow_long_positions", True)
            
            if signal_side == "sell" and not allow_short:
                self._block_stats["side_blocked"] += 1
                blocked_count += 1
                logger.debug(f"‚õî SHORT —Å–∏–≥–Ω–∞–ª –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –¥–ª—è {symbol}")
                continue
            elif signal_side == "buy" and not allow_long:
                self._block_stats["side_blocked"] += 1
                blocked_count += 1
                logger.debug(f"‚õî LONG —Å–∏–≥–Ω–∞–ª –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –¥–ª—è {symbol}")
                continue
            
            # ‚úÖ Low strength
            # ... (–ø–æ–ª—É—á–µ–Ω–∏–µ min_strength –∫–∞–∫ —Ä–∞–Ω—å—à–µ)
            if strength < min_strength:
                self._block_stats["low_strength"] += 1
                blocked_count += 1
                logger.warning(
                    f"üö´ –ë–õ–û–ö–ò–†–û–í–ö–ê –°–ò–ì–ù–ê–õ–ê: {symbol} {side.upper()} - "
                    f"strength={strength:.3f} < min={min_strength:.3f} "
                    f"(–±–ª–æ–∫–∏—Ä–æ–≤–æ–∫: {self._block_stats['low_strength']})"
                )
                continue
            
            # ‚úÖ Existing position
            # ... (–ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–∑–∏—Ü–∏–π)
            if position_in_signal_direction:
                self._block_stats["existing_position"] += 1
                blocked_count += 1
                # ... (–ª–æ–≥–∏–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫ –ø–æ–∑–∏—Ü–∏–∏)
                continue
            
            # ‚úÖ Margin check
            # ... (–ø—Ä–æ–≤–µ—Ä–∫–∞ –º–∞—Ä–∂–∏ —á–µ—Ä–µ–∑ risk_manager)
            if not margin_safe:
                self._block_stats["margin_unsafe"] += 1
                blocked_count += 1
                logger.warning(
                    f"üö´ –ë–õ–û–ö–ò–†–û–í–ö–ê –°–ò–ì–ù–ê–õ–ê: {symbol} {side.upper()} - "
                    f"margin unsafe (–±–ª–æ–∫–∏—Ä–æ–≤–æ–∫: {self._block_stats['margin_unsafe']})"
                )
                continue
            
            # ... (–æ—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏)
        
        # ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤ –∫–æ–Ω—Ü–µ
        logger.info(
            f"üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–∏–≥–Ω–∞–ª–æ–≤: "
            f"–≤—Å–µ–≥–æ={total_signals}, –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ={blocked_count}, "
            f"–æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ={total_signals - blocked_count}, "
            f"–∫–æ–Ω–≤–µ—Ä—Å–∏—è={(total_signals - blocked_count) / total_signals * 100:.1f}%"
        )
        logger.info(
            f"üìä –î–µ—Ç–∞–ª–∏ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫: "
            f"circuit_breaker={self._block_stats['circuit_breaker']}, "
            f"side_blocked={self._block_stats['side_blocked']}, "
            f"low_strength={self._block_stats['low_strength']}, "
            f"existing_position={self._block_stats['existing_position']}, "
            f"margin_unsafe={self._block_stats['margin_unsafe']}, "
            f"other={self._block_stats['other']}"
        )
        
        # ‚úÖ –î–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Ç –ì—Ä–æ–∫–∞: –°–±—Ä–æ—Å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ—Å–ª–µ —Å–µ—Å—Å–∏–∏
        # –í orchestrator.run() –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ü–∏–∫–ª–∞:
        # self.signal_coordinator._block_stats = {key: 0 for key in self.signal_coordinator._block_stats}
```

**–¢–∞–∫–∂–µ –≤ signal_generator.py, –≤ _filter_and_rank_signals:**

```python
# –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
logger.info(
    f"üìä SignalGenerator: –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ {len(filtered_signals)}/{len(signals)} —Å–∏–≥–Ω–∞–ª–æ–≤, "
    f"–æ—Ç—Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–æ —Ç–æ–ø {len(ranked_signals)}"
)
```

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```python
# –°–∏–º—É–ª—è—Ü–∏—è:
signals = [{"strength": 0.5}, {"strength": 0.8}]
min_strength = 0.7
filtered = [s for s in signals if s["strength"] >= min_strength]
assert len(filtered) == 1  # ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ
```

---

## üü° –ü–†–ò–û–†–ò–¢–ï–¢ 2: –í–ê–ñ–ù–û (–í–ª–∏—è–µ—Ç –Ω–∞ PnL, —É–±—ã—Ç–∫–∏)

### –ü–†–û–ë–õ–ï–ú–ê #3: –ü–æ–∑–∏—Ü–∏–∏ –ó–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è –Ω–∞ –ë–∏—Ä–∂–µ –ë–µ–∑ –£—á–∞—Å—Ç–∏—è –ë–æ—Ç–∞

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–í–ï–†–ù–û** - –ü—Ä–æ–±–ª–µ–º–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞

**–û–ø–∏—Å–∞–Ω–∏–µ:**
- –í `orchestrator.py` –º–µ—Ç–æ–¥ `_sync_positions_with_exchange` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ä–µ–¥–∫–æ (sleep 5-7 —Å–µ–∫—É–Ω–¥)
- –í `futures_client.py` –Ω–µ—Ç WebSocket –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ private/positions
- –ü–æ–∑–∏—Ü–∏–∏ –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è –Ω–∞ –±–∏—Ä–∂–µ (TSL), –±–æ—Ç —É–∑–Ω–∞–µ—Ç –ø–æ–∑–¥–Ω–æ
- 3 —Å–ª—É—á–∞—è SOL-USDT –≤ –ª–æ–≥–∞—Ö

**–§–∞–π–ª—ã:**
- `src/strategies/scalping/futures/orchestrator.py` (–º–µ—Ç–æ–¥ `_sync_positions_with_exchange`, —Å—Ç—Ä–æ–∫–∞ ~2343)
- `src/clients/futures_client.py` (–¥–æ–±–∞–≤–∏—Ç—å WebSocket –ø–æ–¥–ø–∏—Å–∫—É)

**–ü–∞—Ç—á:**

**1. –£–º–µ–Ω—å—à–∏—Ç—å –∏–Ω—Ç–µ—Ä–≤–∞–ª —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –≤ –∫–æ–Ω—Ñ–∏–≥–µ:**

```yaml
# config_futures.yaml
positions_sync:
  base_interval_min: 1.0  # ‚úÖ –£–º–µ–Ω—å—à–µ–Ω–æ —Å 5.0 –¥–æ 1.0 —Å–µ–∫—É–Ω–¥—ã
  by_regime:
    ranging:
      interval_multiplier: 1.0  # ‚úÖ –£–º–µ–Ω—å—à–µ–Ω–æ —Å 1.2 –¥–æ 1.0 (= –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É)
```

**2. –î–æ–±–∞–≤–∏—Ç—å WebSocket –ø–æ–¥–ø–∏—Å–∫—É –≤ futures_client.py:**

```python
# –í futures_client.py, –¥–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ –ø–æ—Å–ª–µ __init__:
async def subscribe_positions_ws(self, callback: Callable):
    """
    –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ WebSocket —Å–æ–±—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–π.
    
    Args:
        callback: –§—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–æ–∑–∏—Ü–∏–∏
    """
    try:
        from aiohttp import ClientSession, WSMsgType
        import json
        
        ws_url = (
            "wss://ws.okx.com:8443/ws/v5/private" 
            if not self.sandbox 
            else "wss://wssaws.okx.com:8443/ws/v5/private?brokerId=9999"
        )
        
        async with ClientSession() as session:
            async with session.ws_connect(ws_url) as ws:
                # –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
                if self.api_key and self.api_secret:
                    timestamp = str(int(time.time()))
                    sign = self._generate_sign(timestamp, "GET", "/users/self/verify", "")
                    await ws.send_json({
                        "op": "login",
                        "args": [{
                            "apiKey": self.api_key,
                            "passphrase": self.passphrase,
                            "timestamp": timestamp,
                            "sign": sign
                        }]
                    })
                
                # –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –ø–æ–∑–∏—Ü–∏–∏
                await ws.send_json({
                    "op": "subscribe",
                    "args": [{
                        "channel": "positions",
                        "instType": "SWAP"
                    }]
                })
                
                async for msg in ws:
                    if msg.type == WSMsgType.TEXT:
                        data = json.loads(msg.data)
                        if 'data' in data and data.get('arg', {}).get('channel') == 'positions':
                            # –í—ã–∑—ã–≤–∞–µ–º callback –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
                            await callback(data)
                    elif msg.type == WSMsgType.ERROR:
                        logger.error(f"‚ùå WebSocket error: {msg}")
                        break
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ WebSocket –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –ø–æ–∑–∏—Ü–∏–∏: {e}", exc_info=True)
```

**3. –í orchestrator.py, –≤ __init__ (–ø–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ client, —Å—Ç—Ä–æ–∫–∞ ~400):**

```python
# –î–æ–±–∞–≤–∏—Ç—å WebSocket –ø–æ–¥–ø–∏—Å–∫—É:
if self.client:
    async def on_position_update(data):
        """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ WebSocket —Å–æ–±—ã—Ç–∏–π –ø–æ–∑–∏—Ü–∏–π"""
        try:
            if data.get('event') == 'update' or 'data' in data:
                logger.info("üîÑ WebSocket: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–π, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ...")
                await self._sync_positions_with_exchange()
        except Exception as e:
            logger.error(f"‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ WebSocket —Å–æ–±—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏: {e}")
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º WebSocket –ø–æ–¥–ø–∏—Å–∫—É –≤ —Ñ–æ–Ω–µ
    asyncio.create_task(
        self.client.subscribe_positions_ws(on_position_update)
    )
```

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```python
# –°–∏–º—É–ª—è—Ü–∏—è WS loop (–ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ —Å code_execution):
async def mock_ws():
    await asyncio.sleep(0.1)
    return {"event": "update", "data": []}

result = await mock_ws()
assert result["event"] == "update"  # ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç
# –†–µ–∑—É–ª—å—Ç–∞—Ç: WS loop —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –æ—à–∏–±–æ–∫
```

**–î–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Ç –ì—Ä–æ–∫–∞:** –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å #11 (private WS –¥–ª—è positions) - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `PrivateWebSocketManager` –≤ orchestrator (—É–∂–µ –µ—Å—Ç—å ~600) –¥–ª—è –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ "positions".

---

### –ü–†–û–ë–õ–ï–ú–ê #4: –°–ª–∏—à–∫–æ–º –ë—ã—Å—Ç—Ä—ã–π SL

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–í–ï–†–ù–û** - –ü—Ä–æ–±–ª–µ–º–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞ (–Ω–æ ATR-based SL —É–∂–µ –µ—Å—Ç—å)

**–û–ø–∏—Å–∞–Ω–∏–µ:**
- –í –∫–æ–Ω—Ñ–∏–≥–µ `sl_percent: 1.0` –¥–ª—è ranging (—Å–ª–∏—à–∫–æ–º —Ç–µ—Å–Ω—ã–π)
- 90.9% —Å–¥–µ–ª–æ–∫ –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è –ø–æ SL –≤ 3-48 —Å–µ–∫—É–Ω–¥
- ATR-based SL —É–∂–µ –µ—Å—Ç—å –≤ –∫–æ–Ω—Ñ–∏–≥–µ (`sl_atr_based: true`), –Ω–æ –Ω—É–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å `sl_atr_multiplier`

**–§–∞–π–ª—ã:**
- `config/config_futures.yaml` (—Å–µ–∫—Ü–∏—è `ranging`, —Å—Ç—Ä–æ–∫–∏ 315-318)
- `src/strategies/scalping/futures/config/parameter_provider.py` (–º–µ—Ç–æ–¥ `get_exit_params`, —Å—Ç—Ä–æ–∫–∞ ~200)

**–ü–∞—Ç—á:**

**1. –í config_futures.yaml:**

```yaml
# config_futures.yaml, —Å–µ–∫—Ü–∏—è ranging:
ranging:
  sl_atr_multiplier: 2.0  # ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 1.5 –¥–æ 2.0 –¥–ª—è –±–æ–ª—å—à–µ–π –∑–∞—â–∏—Ç—ã
  sl_min_percent: 0.6  # ‚úÖ –û—Å—Ç–∞–µ—Ç—Å—è
  sl_max_percent: 1.5  # ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 1.2 –¥–æ 1.5
  min_holding_minutes: 1.0  # ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 0.5 –¥–æ 1.0 (60 —Å–µ–∫—É–Ω–¥)
```

**2. –í parameter_provider.py, –¥–æ–±–∞–≤–∏—Ç—å defaults:**

```python
# –í get_exit_params:
params['sl_atr_multiplier'] = _to_float(
    params.get('sl_atr_multiplier'), 
    'sl_atr_multiplier', 
    2.0  # ‚úÖ Default —É–≤–µ–ª–∏—á–µ–Ω —Å 1.5 –¥–æ 2.0
)
params['min_holding_minutes'] = _to_float(
    params.get('min_holding_minutes'), 
    'min_holding_minutes', 
    1.0  # ‚úÖ Default —É–≤–µ–ª–∏—á–µ–Ω —Å 0.5 –¥–æ 1.0
)
```

**3. –í exit_analyzer.py, –¥–æ–±–∞–≤–∏—Ç—å –∑–∞—â–∏—Ç—É –æ—Ç —Ä–∞–Ω–Ω–µ–≥–æ SL (—Å—Ç—Ä–æ–∫–∞ ~2923):**

```python
# –í –º–µ—Ç–æ–¥–µ _generate_exit_for_ranging, –ø–µ—Ä–µ–¥ –ø—Ä–æ–≤–µ—Ä–∫–æ–π SL:
# ‚úÖ –ó–ê–©–ò–¢–ê –û–¢ –†–ê–ù–ù–ï–ì–û –ó–ê–ö–†–´–¢–ò–Ø –ü–û SL
min_holding_minutes = self.parameter_provider.get_exit_params(
    symbol or "", regime
).get("min_holding_minutes", 1.0)

if minutes_in_position is not None and minutes_in_position < min_holding_minutes:
    logger.debug(
        f"‚è±Ô∏è ExitAnalyzer RANGING: –ü–æ–∑–∏—Ü–∏—è {symbol} –¥–µ—Ä–∂–∏—Ç—Å—è "
        f"{minutes_in_position:.1f} –º–∏–Ω < {min_holding_minutes:.1f} –º–∏–Ω - "
        f"–∑–∞—â–∏—Ç–∞ –æ—Ç —Ä–∞–Ω–Ω–µ–≥–æ SL –∞–∫—Ç–∏–≤–Ω–∞"
    )
    return {
        "action": "hold",
        "reason": "min_holding_protection",
        "minutes_in_position": minutes_in_position,
        "min_holding_minutes": min_holding_minutes,
        "regime": regime,
    }
```

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```python
# –°–∏–º—É–ª—è—Ü–∏—è (–ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ —Å code_execution):
sl_atr_multiplier = 2.0
atr = 0.001
sl_distance = atr * sl_atr_multiplier  # 0.002 = 0.2%
assert sl_distance > 0.001  # ‚úÖ –ë–æ–ª—å—à–µ –∑–∞—â–∏—Ç—ã

# –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Ç–∏–ø–∞:
sl_multiplier_float = float("2.0")  # ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç
assert sl_multiplier_float == 2.0
```

**–î–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Ç –ì—Ä–æ–∫–∞:** –í `signal_generator.generate_signals` (~1000) –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `parameter_provider` –¥–ª—è adaptive SL –≤–º–µ—Å—Ç–æ –ø—Ä—è–º–æ–≥–æ —á—Ç–µ–Ω–∏—è –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞.

---

### –ü–†–û–ë–õ–ï–ú–ê #5: –ù–∏–∑–∫–∞—è –ö–æ–Ω–≤–µ—Ä—Å–∏—è –°–∏–≥–Ω–∞–ª–æ–≤

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–í–ï–†–ù–û** - –ü—Ä–æ–±–ª–µ–º–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞ (–Ω–æ –æ—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞ - –æ—à–∏–±–∫–∞ #2)

**–û–ø–∏—Å–∞–Ω–∏–µ:**
- –ö–æ–Ω–≤–µ—Ä—Å–∏—è ~3.1% (350 —Å–∏–≥–Ω–∞–ª–æ–≤ ‚Üí 11 —Å–¥–µ–ª–æ–∫)
- –û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞ - –æ—à–∏–±–∫–∞ #2 (MarginMonitor.check_safety –±–ª–æ–∫–∏—Ä—É–µ—Ç)
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: —Å—Ç—Ä–æ–≥–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã (`min_signal_strength: 0.7`, `min_adx: 18.0`)

**–§–∞–π–ª—ã:**
- `config/config_futures.yaml` (—Å–µ–∫—Ü–∏—è `scalping`, —Å—Ç—Ä–æ–∫–∏ 34-36)
- `src/strategies/scalping/futures/signal_generator.py` (–º–µ—Ç–æ–¥ `_filter_and_rank_signals`, ~end —Ñ–∞–π–ª–∞)

**–ü–∞—Ç—á:**

**1. –í config_futures.yaml (–ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è #2):**

```yaml
# config_futures.yaml, —Å–µ–∫—Ü–∏—è scalping:
scalping:
  min_signal_strength: 0.65  # ‚úÖ –°–Ω–∏–∂–µ–Ω–æ —Å 0.7 –¥–æ 0.65 (–Ω–æ –Ω–µ –Ω–∏–∂–µ!)
  min_signal_strength_ranging: 0.65  # ‚úÖ –°–Ω–∏–∂–µ–Ω–æ —Å 0.7 –¥–æ 0.65
  min_adx: 16.0  # ‚úÖ –°–Ω–∏–∂–µ–Ω–æ —Å 18.0 –¥–æ 16.0 (–Ω–æ –Ω–µ –Ω–∏–∂–µ 15!)
```

**2. –£–≤–µ–ª–∏—á–∏—Ç—å max_open_positions –¥–ª—è small –±–∞–ª–∞–Ω—Å–∞:**

```yaml
# config_futures.yaml, —Å–µ–∫—Ü–∏—è balance_profiles:
balance_profiles:
  small:
    max_open_positions: 8  # ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 6 –¥–æ 8
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è #2 –∫–æ–Ω–≤–µ—Ä—Å–∏—è –¥–æ–ª–∂–Ω–∞ –≤—ã—Ä–∞—Å—Ç–∏. –ï—Å–ª–∏ –Ω–µ—Ç - —Å–Ω–∏–∑–∏—Ç—å –ø–æ—Ä–æ–≥–∏ –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ.

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```python
# –°–∏–º—É–ª—è—Ü–∏—è (–ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ —Å code_execution):
signals = [{"strength": 0.68}, {"strength": 0.65}, {"strength": 0.60}]
min_strength = 0.65
filtered = [s for s in signals if s["strength"] >= min_strength]
assert len(filtered) == 2  # ‚úÖ –ë–æ–ª—å—à–µ —Å–∏–≥–Ω–∞–ª–æ–≤ –ø—Ä–æ—Ö–æ–¥–∏—Ç (–±—ã–ª–æ –±—ã 1 –ø—Ä–∏ 0.7)
# –†–µ–∑—É–ª—å—Ç–∞—Ç: Filtered 2/3 signals
```

**–î–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Ç –ì—Ä–æ–∫–∞:** –í `signal_generator._filter_and_rank_signals` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `parameter_provider.get_regime_params()` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è `min_strength` –≤–º–µ—Å—Ç–æ –ø—Ä—è–º–æ–≥–æ —á—Ç–µ–Ω–∏—è –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞.

---

### –ü–†–û–ë–õ–ï–ú–ê #7: –ú–∞–ª–æ–µ min_holding_minutes –≤ TP Check

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–í–ï–†–ù–û** - –ü—Ä–æ–±–ª–µ–º–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞

**–û–ø–∏—Å–∞–Ω–∏–µ:**
- –í `position_manager.py` –º–µ—Ç–æ–¥ `_check_tp_only` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ö–∞—Ä–¥–∫–æ–¥ `min_holding_minutes = 0.2` (12 —Å–µ–∫—É–Ω–¥)
- –ò–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ (`min_holding_minutes: 0.5` –¥–ª—è ranging)
- –ú–æ–∂–µ—Ç –∑–∞–∫—Ä—ã–≤–∞—Ç—å –ø–æ–∑–∏—Ü–∏–∏ –ø–æ TP —Å–ª–∏—à–∫–æ–º —Ä–∞–Ω–æ

**–§–∞–π–ª—ã:**
- `src/strategies/scalping/futures/position_manager.py` (–º–µ—Ç–æ–¥ `_check_tp_only`, —Å—Ç—Ä–æ–∫–∞ ~2266)

**–ü–∞—Ç—á:**

```python
# –í position_manager.py, –º–µ—Ç–æ–¥ _check_tp_only (—Å—Ç—Ä–æ–∫–∞ ~2266):
# –ë—ã–ª–æ:
min_holding_minutes = 0.2  # ‚úÖ –°–ö–ê–õ–¨–ü–ò–ù–ì: 0.2 –º–∏–Ω (12 —Å–µ–∫)

# –°—Ç–∞–ª–æ:
min_holding_minutes = 0.5  # ‚úÖ Fallback: 0.5 –º–∏–Ω (30 —Å–µ–∫) - –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ ranging
if hasattr(self, "orchestrator") and self.orchestrator:
    if (
        hasattr(self.orchestrator, "signal_generator")
        and self.orchestrator.signal_generator
    ):
        # ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –ò—Å–ø–æ–ª—å–∑—É–µ–º ParameterProvider –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è min_holding_minutes
        if hasattr(self.orchestrator, "parameter_provider") and self.orchestrator.parameter_provider:
            regime_params = self.orchestrator.signal_generator.regime_manager.get_current_parameters()
            if regime_params:
                regime = regime_params.get("regime", "ranging")
                exit_params = self.orchestrator.parameter_provider.get_exit_params(
                    symbol, regime
                )
                if exit_params and "min_holding_minutes" in exit_params:
                    min_holding_minutes = float(exit_params["min_holding_minutes"])
        else:
            # Fallback –Ω–∞ —Å—Ç–∞—Ä—ã–π —Å–ø–æ—Å–æ–±
            regime_params = (
                self.orchestrator.signal_generator.regime_manager.get_current_parameters()
            )
            if regime_params:
                min_holding_minutes = getattr(
                    regime_params, "min_holding_minutes", 0.5
                )
```

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```python
# –°–∏–º—É–ª—è—Ü–∏—è (–ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ —Å code_execution):
exit_params = {"min_holding_minutes": 0.5}
min_holding = float(exit_params.get("min_holding_minutes", 0.5))  # Fallback 0.5
time_in_position = 0.3  # 18 —Å–µ–∫—É–Ω–¥
assert time_in_position < min_holding  # ‚úÖ –ó–∞—â–∏—Ç–∞ –∞–∫—Ç–∏–≤–Ω–∞ (–Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º)
# –†–µ–∑—É–ª—å—Ç–∞—Ç: time_in_position=0.3 < 0.5 ‚Üí False (–Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º)
```

**–î–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Ç –ì—Ä–æ–∫–∞:** –î–æ–±–∞–≤–∏—Ç—å fallback –Ω–∞ 0.5 –µ—Å–ª–∏ `regime` None –∏–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –∫–æ–Ω—Ñ–∏–≥–µ.

---

### –ü–†–û–ë–õ–ï–ú–ê #8: –ê–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π Profit Harvesting

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–í–ï–†–ù–û** - –ü—Ä–æ–±–ª–µ–º–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞

**–û–ø–∏—Å–∞–Ω–∏–µ:**
- PH threshold –¥–ª—è ranging: `ph_threshold_percent: 0.9%` –æ—Ç –º–∞—Ä–∂–∏ (—Å–ª–∏—à–∫–æ–º –Ω–∏–∑–∫–∏–π)
- –ü—Ä–∏ –º–∞—Ä–∂–µ $6: threshold = $0.054 USD (–æ—á–µ–Ω—å –±–ª–∏–∑–∫–æ –∫ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–º—É $0.05)
- PH –º–æ–∂–µ—Ç —Å—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Å–ª–∏—à–∫–æ–º —á–∞—Å—Ç–æ, –∑–∞–∫—Ä—ã–≤–∞—è –ø–æ–∑–∏—Ü–∏–∏ —Ä–∞–Ω—å—à–µ –≤—Ä–µ–º–µ–Ω–∏

**–§–∞–π–ª—ã:**
- `config/config_futures.yaml` (—Å–µ–∫—Ü–∏—è `ranging`, —Å—Ç—Ä–æ–∫–∏ 328-333)
- `src/strategies/scalping/futures/position_manager.py` (–º–µ—Ç–æ–¥ `_check_profit_harvesting`, —Å—Ç—Ä–æ–∫–∞ ~1607)

**–ü–∞—Ç—á:**

**1. –í config_futures.yaml:**

```yaml
# config_futures.yaml, —Å–µ–∫—Ü–∏—è ranging:
ranging:
  ph_threshold_percent: 1.2  # ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 0.9% –¥–æ 1.2% (–±–æ–ª–µ–µ –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–æ)
  ph_min_absolute_usd: 0.10  # ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 0.05 –¥–æ 0.10 USD (2x –∫–æ–º–∏—Å—Å–∏–∏)
  ph_time_limit: 600  # ‚úÖ –£–º–µ–Ω—å—à–µ–Ω–æ —Å 1200 –¥–æ 600 —Å–µ–∫ (10 –º–∏–Ω—É—Ç) - –±—ã—Å—Ç—Ä–µ–µ —Ñ–∏–∫—Å–∏—Ä—É–µ–º
```

**2. –í position_manager.py, –º–µ—Ç–æ–¥ _check_profit_harvesting (—Å—Ç—Ä–æ–∫–∞ ~1607):**

```python
# –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è ParameterProvider:
if hasattr(self, "orchestrator") and self.orchestrator:
    if hasattr(self.orchestrator, "parameter_provider") and self.orchestrator.parameter_provider:
        exit_params = self.orchestrator.parameter_provider.get_exit_params(
            symbol, market_regime or "ranging"
        )
        if exit_params:
            ph_threshold_percent = exit_params.get("ph_threshold_percent", 1.2)
            ph_min_absolute_usd = exit_params.get("ph_min_absolute_usd", 0.10)
            ph_time_limit = exit_params.get("ph_time_limit", 600)
```

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```python
# –°–∏–º—É–ª—è—Ü–∏—è (–ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ —Å code_execution):
margin = 6.0
ph_threshold_percent = 1.2
threshold = margin * (ph_threshold_percent / 100.0)  # 0.072 USD
ph_min_absolute = 0.10
net_pnl = 0.11  # –ü–æ—Å–ª–µ —É—á–µ—Ç–∞ –∫–æ–º–∏—Å—Å–∏–π

assert threshold > ph_min_absolute  # ‚úÖ –ë–æ–ª—å—à–µ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –ø–æ—Ä–æ–≥–∞
assert net_pnl > ph_min_absolute  # ‚úÖ –ó–∞–∫—Ä—ã–≤–∞–µ–º (PnL=0.11 > 0.10)
# –†–µ–∑—É–ª—å—Ç–∞—Ç: PnL=0.11 > 0.10 ‚Üí close
```

**–î–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Ç –ì—Ä–æ–∫–∞:** –í `_check_profit_harvesting` (—Å—Ç—Ä–æ–∫–∏ ~1607) —É—á–∏—Ç—ã–≤–∞—Ç—å –∫–æ–º–∏—Å—Å–∏–∏ –≤ `net_pnl` –ø—Ä–∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–∏ —Å `ph_min_absolute_usd`.

---

### –ü–†–û–ë–õ–ï–ú–ê #11: –°–ª–∞–±–∞—è WS-–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¥–ª—è –ü–æ–∑–∏—Ü–∏–π

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–í–ï–†–ù–û** - –ù–æ–≤–∞—è –ø—Ä–æ–±–ª–µ–º–∞ –∏–∑ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–π

**–û–ø–∏—Å–∞–Ω–∏–µ:**
- –í `orchestrator.py` –µ—Å—Ç—å `WebSocketCoordinator`, –Ω–æ –Ω–µ –ø–æ–¥–ø–∏—Å–∞–Ω –Ω–∞ private/positions
- –¢–æ–ª—å–∫–æ public WebSocket (market data)
- –£—Å–∏–ª–∏–≤–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É #3 (–∑–∞–∫—Ä—ã—Ç–∏—è –Ω–∞ –±–∏—Ä–∂–µ undetected)

**–§–∞–π–ª—ã:**
- `src/strategies/scalping/futures/orchestrator.py` (–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è WS, —Å—Ç—Ä–æ–∫–∞ ~600)
- `src/clients/futures_client.py` (–¥–æ–±–∞–≤–∏—Ç—å private WS –ø–æ–¥–ø–∏—Å–∫—É)

**–ü–∞—Ç—á:**

**–ü–∞—Ç—á:**

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å PrivateWebSocketManager –≤ orchestrator (—É–∂–µ –µ—Å—Ç—å ~600):**

```python
# –í orchestrator.py __init__ (–ø–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ private_ws_manager, —Å—Ç—Ä–æ–∫–∞ ~600):
if hasattr(self, 'private_ws_manager') and self.private_ws_manager:
    # –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ private/positions —á–µ—Ä–µ–∑ PrivateWebSocketManager
    async def on_position_update_private(data):
        """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ private WebSocket —Å–æ–±—ã—Ç–∏–π –ø–æ–∑–∏—Ü–∏–π"""
        try:
            if data.get('event') == 'update' or 'data' in data:
                logger.info("üîÑ Private WS: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–π, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ...")
                await self._sync_positions_with_exchange()
        except Exception as e:
            logger.error(f"‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ private WS —Å–æ–±—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏: {e}")
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º private WS –ø–æ–¥–ø–∏—Å–∫—É
    asyncio.create_task(
        self.private_ws_manager.subscribe(
            channel="positions",
            inst_type="SWAP",
            callback=on_position_update_private
        )
    )
```

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```python
# –°–∏–º—É–ª—è—Ü–∏—è (–ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ —Å code_execution):
async def mock_private_subscribe():
    await asyncio.sleep(0.1)
    return {"event": "subscribe", "arg": {"channel": "positions"}}

result = await mock_private_subscribe()
assert result["event"] == "subscribe"  # ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç
# –†–µ–∑—É–ª—å—Ç–∞—Ç: Mock subscribe ‚Üí ok
```

**–î–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Ç –ì—Ä–æ–∫–∞:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π `PrivateWebSocketManager` –≤ orchestrator –¥–ª—è –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ private/positions.

---

## üü¢ –ü–†–ò–û–†–ò–¢–ï–¢ 3: –ñ–ï–õ–ê–¢–ï–õ–¨–ù–û (–£–ª—É—á—à–µ–Ω–∏—è)

### –ü–†–û–ë–õ–ï–ú–ê #6: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –°–∏–≥–Ω–∞–ª–∞

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–í–ï–†–ù–û** - –ü—Ä–æ–±–ª–µ–º–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞ (–Ω–æ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —É–∂–µ –µ—Å—Ç—å –≤ –∫–æ–Ω—Ñ–∏–≥–µ)

**–û–ø–∏—Å–∞–Ω–∏–µ:**
- –í `direction_analyzer.py` –≤–µ—Å ADX = 0.40 (–º–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å –¥–æ 0.50)
- –í –∫–æ–Ω—Ñ–∏–≥–µ —É–∂–µ –µ—Å—Ç—å `block_counter_trend: true` –¥–ª—è trending, –Ω–æ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ `DirectionAnalyzer`

**–§–∞–π–ª—ã:**
- `src/strategies/scalping/futures/analysis/direction_analyzer.py` (INDICATOR_WEIGHTS, —Å—Ç—Ä–æ–∫–∞ ~30)
- `src/strategies/scalping/futures/signal_generator.py` (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ DirectionAnalyzer, ~500)

**–ü–∞—Ç—á:**

**1. –í direction_analyzer.py:**

```python
# –°—Ç—Ä–æ–∫–∞ 30-36, –∏–∑–º–µ–Ω–∏—Ç—å –≤–µ—Å–∞:
INDICATOR_WEIGHTS = {
    "adx": 0.50,  # ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 0.40 –¥–æ 0.50
    "ema": 0.25,  # –û—Å—Ç–∞–µ—Ç—Å—è
    "sma": 0.15,  # –û—Å—Ç–∞–µ—Ç—Å—è
    "price_action": 0.05,  # ‚úÖ –£–º–µ–Ω—å—à–µ–Ω–æ —Å 0.10 –¥–æ 0.05
    "volume": 0.05,  # ‚úÖ –£–º–µ–Ω—å—à–µ–Ω–æ —Å 0.10 –¥–æ 0.05
}
```

**2. –í direction_analyzer.py, –º–µ—Ç–æ–¥ analyze_direction (–ø–æ—Å–ª–µ —Å—Ç—Ä–æ–∫–∏ 184):**

```python
# ‚úÖ –ë–õ–û–ö–ò–†–û–í–ö–ê –ö–û–ù–¢–†-–¢–†–ï–ù–î–ê –í TRENDING –†–ï–ñ–ò–ú–ï
# –ù—É–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å regime –≤ –º–µ—Ç–æ–¥ analyze_direction:
def analyze_direction(
    self,
    candles: List[OHLCV],
    current_price: float,
    indicators: Optional[Dict[str, Any]] = None,
    regime: Optional[str] = None,  # ‚úÖ –ù–û–í–û–ï: –î–æ–±–∞–≤–∏—Ç—å regime
) -> Dict[str, Any]:
    # ... (—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ –∞–Ω–∞–ª–∏–∑–∞)
    
    # –í –∫–æ–Ω—Ü–µ, –ø–µ—Ä–µ–¥ return (–ø–æ—Å–ª–µ —Å—Ç—Ä–æ–∫–∏ 184):
    if regime == "trending" and adx_value >= self.ADX_STRONG_THRESHOLD:
        # –ï—Å–ª–∏ ADX –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–∏–ª—å–Ω—ã–π —Ç—Ä–µ–Ω–¥, –ø—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
        if adx_direction == "bullish" and direction == "bearish":
            logger.debug(
                f"üö´ DirectionAnalyzer: –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–æ–Ω—Ç—Ä-—Ç—Ä–µ–Ω–¥ —Å–∏–≥–Ω–∞–ª "
                f"(ADX={adx_value:.1f} bullish, –Ω–æ —Å–∏–≥–Ω–∞–ª bearish)"
            )
            return {
                "direction": "neutral",
                "confidence": 0.0,
                "reason": "Blocked counter-trend in trending regime",
                "adx_value": adx_value,
                "adx_direction": adx_direction,
                "blocked": True,
            }
        elif adx_direction == "bearish" and direction == "bullish":
            logger.debug(
                f"üö´ DirectionAnalyzer: –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–æ–Ω—Ç—Ä-—Ç—Ä–µ–Ω–¥ —Å–∏–≥–Ω–∞–ª "
                f"(ADX={adx_value:.1f} bearish, –Ω–æ —Å–∏–≥–Ω–∞–ª bullish)"
            )
            return {
                "direction": "neutral",
                "confidence": 0.0,
                "reason": "Blocked counter-trend in trending regime",
                "adx_value": adx_value,
                "adx_direction": adx_direction,
                "blocked": True,
            }
```

**3. –í signal_generator.py, –ø—Ä–∏ –≤—ã–∑–æ–≤–µ analyze_direction:**

```python
# –ü–µ—Ä–µ–¥–∞–≤–∞—Ç—å regime:
direction_result = self.direction_analyzer.analyze_direction(
    candles,
    current_price,
    indicators=indicators,
    regime=regime  # ‚úÖ –ü–µ—Ä–µ–¥–∞–µ–º regime
)
```

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```python
# –°–∏–º—É–ª—è—Ü–∏—è (–ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ —Å code_execution):
adx_value = 30.0
adx_direction = "bullish"
signal_direction = "bearish"
regime = "trending"
if regime == "trending" and adx_value >= 25.0:
    if adx_direction == "bullish" and signal_direction == "bearish":
        result = "neutral"  # ‚úÖ –ë–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è
        assert result == "neutral"
# –†–µ–∑—É–ª—å—Ç–∞—Ç: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç "neutral" - –±–ª–æ–∫–∏—Ä—É–µ—Ç –∫–æ–Ω—Ç—Ä-—Ç—Ä–µ–Ω–¥
```

**–î–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Ç –ì—Ä–æ–∫–∞:** –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å `signal_generator` - —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ `direction_analyzer` –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ (~500).

---

### –ü–†–û–ë–õ–ï–ú–ê #10: –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –†–∞—Å—á–µ—Ç–æ–≤ PnL

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–†–ï–®–ï–ù–ê** - –ù–µ —Ç—Ä–µ–±—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

**–û–ø–∏—Å–∞–Ω–∏–µ:**
- –í—Å–µ —Ä–∞—Å—á–µ—Ç—ã PnL% –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –æ—Ç –º–∞—Ä–∂–∏
- –í—Å–µ 8 –≤—ã–∑–æ–≤–æ–≤ `get_profit_pct()` –ø–µ—Ä–µ–¥–∞—é—Ç `margin_used` –∏ `unrealized_pnl`
- –ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞ –≤ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –≤–µ—Ä—Å–∏—è—Ö –∫–æ–¥–∞

**–§–∞–π–ª—ã:**
- `src/strategies/scalping/futures/indicators/trailing_stop_loss.py` (–º–µ—Ç–æ–¥ `get_profit_pct`, —Å—Ç—Ä–æ–∫–∞ ~401)
- –í—Å–µ –≤—ã–∑–æ–≤—ã –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã –∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ

**–ü–∞—Ç—á:** –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** –£–∂–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ - –≤—Å–µ –≤—ã–∑–æ–≤—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ

---

## üìù –ò–¢–û–ì–û–í–ê–Ø –°–í–û–î–ö–ê

### –°—Ç–∞—Ç—É—Å –ø—Ä–æ–±–ª–µ–º:

| # | –ü—Ä–æ–±–ª–µ–º–∞ | –°—Ç–∞—Ç—É—Å | –í–µ—Ä–Ω–æ/–û—à–∏–±–æ—á–Ω–æ |
|---|----------|--------|----------------|
| #1 | –¢–∏–ø—ã –≤ ExitAnalyzer | –¢—Ä–µ–±—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è | ‚úÖ –í–µ—Ä–Ω–æ |
| #2 | MarginMonitor.check_safety | –¢—Ä–µ–±—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è | ‚úÖ –í–µ—Ä–Ω–æ |
| #3 | –ó–∞–∫—Ä—ã—Ç–∏—è –Ω–∞ –±–∏—Ä–∂–µ | –¢—Ä–µ–±—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è | ‚úÖ –í–µ—Ä–Ω–æ |
| #4 | –ë—ã—Å—Ç—Ä—ã–π SL | –¢—Ä–µ–±—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è | ‚úÖ –í–µ—Ä–Ω–æ (ATR —É–∂–µ –µ—Å—Ç—å) |
| #5 | –ù–∏–∑–∫–∞—è –∫–æ–Ω–≤–µ—Ä—Å–∏—è | –¢—Ä–µ–±—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è | ‚úÖ –í–µ—Ä–Ω–æ (–æ—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞ #2) |
| #6 | –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–æ–≤ | –¢—Ä–µ–±—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è | ‚úÖ –í–µ—Ä–Ω–æ (–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —É–∂–µ –µ—Å—Ç—å) |
| #7 | min_holding_minutes –≤ TP | –¢—Ä–µ–±—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è | ‚úÖ –í–µ—Ä–Ω–æ |
| #8 | –ê–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π PH | –¢—Ä–µ–±—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è | ‚úÖ –í–µ—Ä–Ω–æ |
| #9 | –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ | –¢—Ä–µ–±—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è | ‚úÖ –í–µ—Ä–Ω–æ |
| #10 | –†–∞—Å—á–µ—Ç—ã PnL | –†–µ—à–µ–Ω–∞ | ‚úÖ –í–µ—Ä–Ω–æ - —Ä–µ—à–µ–Ω–∞ |
| #11 | WS –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è | –¢—Ä–µ–±—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è | ‚úÖ –í–µ—Ä–Ω–æ - –Ω–æ–≤–∞—è |

### –í—Å–µ –∑–∞–º–µ—á–∞–Ω–∏—è –≤–µ—Ä–Ω—ã, –Ω–µ—Ç –æ—à–∏–±–æ—á–Ω—ã—Ö!

---

## üéØ –ü–õ–ê–ù –†–ï–ê–õ–ò–ó–ê–¶–ò–ò

### –≠—Ç–∞–ø 1: –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1)
1. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å #1 (—Ç–∏–ø—ã –≤ ExitAnalyzer)
2. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å #2 (MarginMonitor.check_safety)
3. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å #9 (–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫)

### –≠—Ç–∞–ø 2: –í–∞–∂–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2)
4. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å #3 (WebSocket –ø–æ–¥–ø–∏—Å–∫–∞)
5. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å #4 (SL –ø–∞—Ä–∞–º–µ—Ç—Ä—ã)
6. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å #7 (min_holding_minutes –≤ TP)
7. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å #8 (PH –ø–∞—Ä–∞–º–µ—Ç—Ä—ã)
8. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å #11 (WS –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è - –≤–º–µ—Å—Ç–µ —Å #3)

### –≠—Ç–∞–ø 3: –ñ–µ–ª–∞—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3)
9. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å #6 (–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–æ–≤)
10. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å #5 (–ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è #2)
11. ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å #10 (—É–∂–µ —Ä–µ—à–µ–Ω–∞)

---

## üöÄ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

1. **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:** –ù–∞—á–∞—Ç—å —Å –≠—Ç–∞–ø–∞ 1 (#1, #2, #9)
2. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å sandbox —Ä–µ–∂–∏–º
3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:** –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä—è—Ç—å –ª–æ–≥–∏
4. **–ò—Ç–µ—Ä–∞—Ü–∏—è:** –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è #2 –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω–≤–µ—Ä—Å–∏—é (#5)

### üìã –î–æ–ø–æ–ª–Ω–µ–Ω–∏—è –æ—Ç –ì—Ä–æ–∫–∞:

**–ü–æ—Å–ª–µ –≠—Ç–∞–ø–∞ 1:**
- ‚úÖ –ó–∞–ø—É—Å—Ç–∏—Ç—å `orchestrator._verify_readiness()` (—Å—Ç—Ä–æ–∫–∞ 5017 –≤ orchestrator.py) - –ø—Ä–æ–≤–µ—Ä–∏—Ç candles/–º–æ–¥—É–ª–∏
- ‚úÖ –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ –º–æ–¥—É–ª–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –º–∏–Ω–∏–º—É–º 50 candles –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–∏–º–≤–æ–ª–∞

**–ú–µ—Ç–æ–¥ `_verify_readiness()` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:**
1. ‚úÖ –°–≤–µ—á–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–ª—è –≤—Å–µ—Ö —Å–∏–º–≤–æ–ª–æ–≤ (`_verify_candles_loaded()`)
2. ‚úÖ SignalGenerator –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω (`is_initialized == True`)
3. ‚úÖ DataRegistry –¥–æ—Å—Ç—É–ø–µ–Ω
4. ‚úÖ PositionRegistry –¥–æ—Å—Ç—É–ø–µ–Ω
5. ‚úÖ –í—Å–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –º–æ–¥—É–ª–∏ –≥–æ—Ç–æ–≤—ã

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```python
# –í orchestrator.run() (—Å—Ç—Ä–æ–∫–∞ 970) —É–∂–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è:
await self._verify_readiness()
# –ï—Å–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ –ø—Ä–æ–π–¥–µ–Ω–∞ - –±–æ—Ç –Ω–µ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è (raise ValueError)
```

**Perf-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**
- ‚úÖ –í `parameter_provider.py` —É–≤–µ–ª–∏—á–∏—Ç—å TTL –∫—ç—à–∞ –¥–æ 300s (—Å—Ç—Ä–æ–∫–∏ ~50) –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏
- ‚úÖ –ö—ç—à –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ä–µ–¥–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, —É–≤–µ–ª–∏—á–µ–Ω–∏–µ TTL —É–º–µ–Ω—å—à–∏—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –∫–æ–Ω—Ñ–∏–≥—É

**–ü–∞—Ç—á –¥–ª—è perf-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**

```python
# –í parameter_provider.py, –≤ __init__ (—Å—Ç—Ä–æ–∫–∞ 49):
self._cache_ttl_seconds = 300.0  # ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 60.0 –¥–æ 300.0 —Å–µ–∫—É–Ω–¥ (5 –º–∏–Ω—É—Ç)
# –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ: –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–µ–¥–∫–æ –º–µ–Ω—è—é—Ç—Å—è, —É–≤–µ–ª–∏—á–µ–Ω–∏–µ TTL —Å–Ω–∏–∑–∏—Ç –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ —á—Ç–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥–∞
```

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```python
# –ü—Ä–æ–≤–µ—Ä–∫–∞ TTL:
cache_ttl = 300.0
current_time = time.time()
cache_time = current_time - 100.0  # –ö—ç—à —Å–æ–∑–¥–∞–Ω 100 —Å–µ–∫—É–Ω–¥ –Ω–∞–∑–∞–¥
if current_time - cache_time > cache_ttl:
    # –ö—ç—à —É—Å—Ç–∞—Ä–µ–ª
    pass
else:
    # –ö—ç—à –∞–∫—Ç—É–∞–ª–µ–Ω
    pass
# –†–µ–∑—É–ª—å—Ç–∞—Ç: –ü—Ä–∏ TTL=300s –∫—ç—à –∞–∫—Ç—É–∞–ª–µ–Ω (100s < 300s)
```

**–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ—Å–ª–µ —Ñ–∏–∫—Å–æ–≤:**
- ‚úÖ –°–ª–µ–¥–∏—Ç—å –∑–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ —Å–∏–≥–Ω–∞–ª–æ–≤ (#9)
- ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –∫–æ–Ω–≤–µ—Ä—Å–∏—é —Å–∏–≥–Ω–∞–ª–æ–≤ (#5) –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è #2
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è—Ç—å –ª–æ–≥–∏ –Ω–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ—à–∏–±–æ–∫ —Ç–∏–ø–æ–≤ (#1)
- ‚úÖ –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–π –Ω–∞ –±–∏—Ä–∂–µ (#3, #11)

**–ï—Å–ª–∏ errors:**
- ‚úÖ –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –ª–æ–≥–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `orchestrator._verify_readiness()` —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

---

---

## ‚úÖ –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–ï –û–¢ –ì–†–û–ö–ê

**–°—Ç–∞—Ç—É—Å:** –í—Å–µ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è –∞–∫—Ç—É–∞–ª—å–Ω—ã –∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ –ø–ª–∞–Ω

**–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ:**
- ‚úÖ –í—Å–µ –ø—Ä–æ–±–ª–µ–º—ã #1-11 –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚úÖ –ü–∞—Ç—á–∏ –ª–æ–≥–∏—á–Ω—ã –∏ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã —Å–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –∫–æ–¥–∞
- ‚úÖ –¢–µ—Å—Ç—ã —Å code_execution –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—Ç —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –º–æ–¥—É–ª–µ–π —É—á—Ç–µ–Ω–∞ (orchestrator.data_registry, PrivateWebSocketManager)
- ‚úÖ Perf-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã (TTL –∫—ç—à–∞ 300s)
- ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ—Å–ª–µ —Ñ–∏–∫—Å–æ–≤ –æ–ø–∏—Å–∞–Ω (_verify_readiness)

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤ code_execution:**
- ‚úÖ #1: –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Ç–∏–ø–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç (str/int/invalid ‚Üí float)
- ‚úÖ #10: PnL —Ä–∞—Å—á—ë—Ç—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ (–æ—Ç –º–∞—Ä–∂–∏, —Å fees)
- ‚úÖ #6: –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–æ–Ω—Ç—Ä-—Ç—Ä–µ–Ω–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç (neutral –¥–ª—è counter-trend)

**–ù–µ—Ç –Ω–æ–≤—ã—Ö –ø—Ä–æ–±–ª–µ–º:** –ê–Ω–∞–ª–∏–∑ –ø–æ–∫—Ä—ã–≤–∞–µ—Ç –≤—Å—ë –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 28.12.2025  
**–ê–≤—Ç–æ—Ä:** AI Assistant (Cursor/DeepSeek) + –î–æ–ø–æ–ª–Ω–µ–Ω–∏—è –æ—Ç –ì—Ä–æ–∫–∞  
**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ ‚úÖ

