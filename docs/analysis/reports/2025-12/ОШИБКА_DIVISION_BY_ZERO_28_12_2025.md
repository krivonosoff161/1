# –ê–ù–ê–õ–ò–ó –ò –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –û–®–ò–ë–ö–ò: float division by zero –≤ slippage_guard

**–î–∞—Ç–∞:** 28.12.2025  
**–°—Ç–∞—Ç—É—Å:** üîß –ò–°–ü–†–ê–í–õ–ï–ù–û (—Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞)

---

## üêõ –ü–†–û–ë–õ–ï–ú–ê

–í –ª–æ–≥–∞—Ö –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –æ—à–∏–±–∫–∞:
```
ERROR | src.strategies.modules.slippage_guard:_analyze_order:186 | –û—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏–∑–∞ –æ—Ä–¥–µ—Ä–∞: float division by zero
```

–û—à–∏–±–∫–∞ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π.

---

## ‚úÖ –í–´–ü–û–õ–ù–ï–ù–ù–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### 1. –ó–∞—â–∏—Ç–∞ –æ—Ç –¥–µ–ª–µ–Ω–∏—è –Ω–∞ –Ω–æ–ª—å –≤ `_analyze_order`

**–ú–µ—Å—Ç–æ:** `src/strategies/modules/slippage_guard.py`, —Å—Ç—Ä–æ–∫–∏ 177-193

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ `bid_price <= 0 or ask_price <= 0` –ü–ï–†–ï–î —Ä–∞—Å—á–µ—Ç–æ–º `mid_price`
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ `mid_price <= 0` –ø–æ—Å–ª–µ —Ä–∞—Å—á–µ—Ç–∞
- –†–∞–Ω–Ω–∏–π `return` –ø—Ä–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö —Ü–µ–Ω–∞—Ö

```python
bid_price = current_prices.get("bid", 0)
ask_price = current_prices.get("ask", 0)

# ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï (28.12.2025): –ó–∞—â–∏—Ç–∞ –æ—Ç –¥–µ–ª–µ–Ω–∏—è –Ω–∞ –Ω–æ–ª—å
if bid_price <= 0 or ask_price <= 0:
    logger.warning(
        f"‚ö†Ô∏è SlippageGuard: –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Ü–µ–Ω—ã –¥–ª—è {symbol}: "
        f"bid={bid_price}, ask={ask_price}, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –∞–Ω–∞–ª–∏–∑"
    )
    return

mid_price = (bid_price + ask_price) / 2
if mid_price <= 0:
    logger.warning(
        f"‚ö†Ô∏è SlippageGuard: mid_price <= 0 –¥–ª—è {symbol}: {mid_price}, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –∞–Ω–∞–ª–∏–∑"
    )
    return
```

### 2. –ó–∞—â–∏—Ç–∞ –æ—Ç –¥–µ–ª–µ–Ω–∏—è –Ω–∞ –Ω–æ–ª—å –≤ `_analyze_slippage`

**–ú–µ—Å—Ç–æ:** `src/strategies/modules/slippage_guard.py`, —Å—Ç—Ä–æ–∫–∏ 303-330

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –†–∞–Ω–Ω–∏–π –≤–æ–∑–≤—Ä–∞—Ç, –µ—Å–ª–∏ `mid_price <= 0`
- –ü—Ä–æ–≤–µ—Ä–∫–∞ `order_price <= 0` –ø–µ—Ä–µ–¥ –¥–µ–ª–µ–Ω–∏–µ–º
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è `expected_price` –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º

```python
# ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï (28.12.2025): –ó–∞—â–∏—Ç–∞ –æ—Ç –¥–µ–ª–µ–Ω–∏—è –Ω–∞ –Ω–æ–ª—å
if mid_price <= 0:
    return {
        "spread": 0,
        "spread_percent": 0,
        "expected_price": mid_price,
        "slippage_percent": 0,
        "volatility": 0,
        "is_spread_acceptable": False,
        "is_slippage_acceptable": False,
    }

# –†–∞—Å—á–µ—Ç —Å–ø—Ä–µ–¥–∞
spread = ask_price - bid_price
spread_percent = (spread / mid_price) * 100 if mid_price > 0 else 0

# –†–∞—Å—á–µ—Ç –æ–∂–∏–¥–∞–µ–º–æ–≥–æ –ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏—è
expected_price = mid_price  # Fallback –∑–Ω–∞—á–µ–Ω–∏–µ
if order_price <= 0:
    slippage = 0
else:
    if side.lower() == "buy":
        expected_price = ask_price
        slippage = (expected_price - order_price) / order_price * 100
    else:  # sell
        expected_price = bid_price
        slippage = (order_price - expected_price) / order_price * 100
```

### 3. –ó–∞—â–∏—Ç–∞ –æ—Ç –¥–µ–ª–µ–Ω–∏—è –Ω–∞ –Ω–æ–ª—å –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ü–µ–Ω—ã –æ—Ä–¥–µ—Ä–∞

**–ú–µ—Å—Ç–æ:** `src/strategies/modules/slippage_guard.py`, —Å—Ç—Ä–æ–∫–∏ 141-154

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–Ω—ã –∏–∑ `current_prices` > 0
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–Ω—ã –∏–∑ `px_value` > 0
- –†–∞–Ω–Ω–∏–π `return` –ø—Ä–∏ –Ω—É–ª–µ–≤–æ–π —Ü–µ–Ω–µ

```python
# ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï (28.12.2025): –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ —Ü–µ–Ω–∞ > 0
if price <= 0:
    logger.warning(
        f"‚ö†Ô∏è SlippageGuard: –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ü–µ–Ω–∞ –¥–ª—è {symbol}: {price}, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –∞–Ω–∞–ª–∏–∑ –æ—Ä–¥–µ—Ä–∞ {order_id}"
    )
    return
```

### 4. –ó–∞—â–∏—Ç–∞ –≤ `validate_order_before_placement`

**–ú–µ—Å—Ç–æ:** `src/strategies/modules/slippage_guard.py`, —Å—Ç—Ä–æ–∫–∏ 470-486

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –ê–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ `bid_price`, `ask_price`, `mid_price`
- –ó–∞—â–∏—Ç–∞ –æ—Ç –¥–µ–ª–µ–Ω–∏—è –Ω–∞ –Ω–æ–ª—å –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ `spread_percent`

### 5. –£–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫

**–ú–µ—Å—Ç–æ:** `src/strategies/modules/slippage_guard.py`, —Å—Ç—Ä–æ–∫–∏ 211-217

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–ª–µ–Ω –ø–æ–ª–Ω—ã–π traceback –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
- –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ `ZeroDivisionError`

```python
except Exception as e:
    import traceback
    error_details = traceback.format_exc()
    logger.error(
        f"–û—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏–∑–∞ –æ—Ä–¥–µ—Ä–∞: {e}\n"
        f"Traceback: {error_details}"
    )
```

---

## üîç –í–û–ó–ú–û–ñ–ù–´–ï –ü–†–ò–ß–ò–ù–´

1. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ .pyc —Ñ–∞–π–ª—ã:** –ë–æ—Ç –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—É—é –≤–µ—Ä—Å–∏—é –∫–æ–¥–∞ –∏–∑ –∫—ç—à–∞ Python
   - **–†–µ—à–µ–Ω–∏–µ:** –û—á–∏—â–µ–Ω—ã –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã `.pyc`

2. **–û—à–∏–±–∫–∞ –≤ –¥—Ä—É–≥–æ–º –º–µ—Å—Ç–µ:** –ù–æ–º–µ—Ä —Å—Ç—Ä–æ–∫–∏ 186 –º–æ–∂–µ—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ –º–µ—Å—Ç–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–∫–∏, –∞ –Ω–µ –Ω–∞ –º–µ—Å—Ç–æ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏—è
   - **–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω –ø–æ–ª–Ω—ã–π traceback –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

3. **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å:** –í–æ–∑–º–æ–∂–Ω–æ, –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑–º–µ–Ω—è—é—Ç—Å—è –º–µ–∂–¥—É –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º
   - **–†–µ—à–µ–Ω–∏–µ:** –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º

---

## üìã –ß–¢–û –ù–£–ñ–ù–û –°–î–ï–õ–ê–¢–¨

1. ‚úÖ **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞** - —ç—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ, —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤—ã–π –∫–æ–¥
2. ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏** - –Ω–æ–≤–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–∫–∞–∂–µ—Ç –ø–æ–ª–Ω—ã–π traceback, –µ—Å–ª–∏ –æ—à–∏–±–∫–∞ –ø–æ–≤—Ç–æ—Ä–∏—Ç—Å—è
3. ‚úÖ **–ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å** - —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –æ—à–∏–±–∫–∞ –±–æ–ª—å—à–µ –Ω–µ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç

---

## ‚úÖ –°–¢–ê–¢–£–°

- ‚úÖ –í—Å–µ –º–µ—Å—Ç–∞ –¥–µ–ª–µ–Ω–∏—è –∑–∞—â–∏—â–µ–Ω—ã –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ —É–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –û—á–∏—â–µ–Ω—ã –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- ‚è≥ **–¢—Ä–µ–±—É–µ—Ç—Å—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞ –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π**

---

## üìä –ü–†–û–í–ï–†–ï–ù–ù–´–ï –ú–ï–°–¢–ê

1. ‚úÖ `_analyze_order` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Ü–µ–Ω (—Å—Ç—Ä–æ–∫–∏ 177-193)
2. ‚úÖ `_analyze_order` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Ü–µ–Ω—ã –æ—Ä–¥–µ—Ä–∞ (—Å—Ç—Ä–æ–∫–∏ 141-154)
3. ‚úÖ `_analyze_slippage` - —Ä–∞—Å—á–µ—Ç —Å–ø—Ä–µ–¥–∞ –∏ –ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏—è (—Å—Ç—Ä–æ–∫–∏ 303-330)
4. ‚úÖ `validate_order_before_placement` - –≤–∞–ª–∏–¥–∞—Ü–∏—è –æ—Ä–¥–µ—Ä–∞ (—Å—Ç—Ä–æ–∫–∏ 470-486)
5. ‚úÖ `_get_current_prices` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Ü–µ–Ω –∏–∑ API (—Å—Ç—Ä–æ–∫–∞ 259)

–í—Å–µ –¥–µ–ª–µ–Ω–∏—è –∑–∞—â–∏—â–µ–Ω—ã –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏ –Ω–∞ –Ω–æ–ª—å.





