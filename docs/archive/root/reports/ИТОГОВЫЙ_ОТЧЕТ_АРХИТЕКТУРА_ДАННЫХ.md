# ‚úÖ –ò–¢–û–ì–û–í–´–ô –û–¢–ß–ï–¢ - –ê–†–•–ò–¢–ï–ö–¢–£–†–ê –ü–û–¢–û–ö–ê –î–ê–ù–ù–´–•

**–î–∞—Ç–∞:** 09.01.2026  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–°–ï –ö–†–ò–¢–ò–ß–ù–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –ó–ê–í–ï–†–®–ï–ù–´ –ò –ì–û–¢–û–í–´ –ö –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Æ

---

## üéØ –ü–†–û–ë–õ–ï–ú–ê (–î–û –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø)

### –°–∏–º–ø—Ç–æ–º—ã:
1. ‚ùå **SignalGenerator** ‚Üí –∏—Å–ø–æ–ª—å–∑—É—è —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ (30-60 —Å–µ–∫)
2. ‚ùå **ExitAnalyzer** ‚Üí –∏—Å–ø–æ–ª—å–∑—É—è REST API (1-5 —Å–µ–∫ –Ω–∞ VPN!)
3. ‚ùå **TrailingSLCoordinator** ‚Üí –∏—Å–ø–æ–ª—å–∑—É—è —Å—Ç–∞—Ä—ã–µ —Å–≤–µ—á–∏ (30-60 —Å–µ–∫)
4. ‚ùå **WebSocket data** ‚Üí –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `current_tick`, —Ç–æ–ª—å–∫–æ –≤ `last_price`

### –†–µ–∑—É–ª—å—Ç–∞—Ç:
- –û—Ä–¥–µ—Ä—ã —Ä–∞–∑–º–µ—â–∞—é—Ç—Å—è –¥–∞–ª–µ–∫–æ –æ—Ç —Ä—ã–Ω–∫–∞ (—Å–ª–∏–ø–¥–∂ 0.5-2%)
- –í—ã—Ö–æ–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π 1-5 —Å–µ–∫—É–Ω–¥
- –ù–∞ VPN (605ms) –±–æ—Ç—É –Ω–µ—á–µ–º –¥—ã—à–∞—Ç—å

---

## ‚úÖ –†–ï–®–ï–ù–ò–ï (–ê–†–•–ò–¢–ï–ö–¢–£–†–ê)

### 1Ô∏è‚É£ –ï–î–ò–ù–´–ô –ò–°–¢–û–ß–ù–ò–ö –ò–°–¢–ò–ù–´: DataRegistry

```
OKX WebSocket API (real-time: 50-150ms)
    ‚Üì
WebSocketCoordinator.handle_ticker_data()
    ‚îú‚îÄ –°–æ–∑–¥–∞–µ—Ç CurrentTick(price, bid, ask, timestamp)
    ‚îî‚îÄ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç: DataRegistry.update_market_data({current_tick, ...})
    ‚Üì
DataRegistry (–≤ –ø–∞–º—è—Ç–∏, O(1) –¥–æ—Å—Ç—É–ø: <1ms)
    ‚îú‚îÄ market_data.current_tick (WebSocket real-time: <100ms)
    ‚îú‚îÄ market_data.ohlcv_data (—Å–≤–µ—á–∏: 30-60s)
    ‚îú‚îÄ market_data.last_known_price (emergency)
    ‚Üì
–í–°–ï –ú–û–î–£–õ–ò –ø–æ–ª—É—á–∞—é—Ç —Ü–µ–Ω—É –æ—Ç—Å—é–¥–∞:
    ‚îú‚îÄ SignalGenerator
    ‚îú‚îÄ ExitAnalyzer
    ‚îú‚îÄ TrailingSLCoordinator
    ‚îú‚îÄ RiskController
    ‚îî‚îÄ OrderExecutor
```

### 2Ô∏è‚É£ 4-–£–†–û–í–ù–ï–í–ê–Ø –ò–ï–†–ê–†–•–ò–Ø FALLBACK (–ù–ï –•–ê–†–î–ö–û–î!)

```
–£–†–û–í–ï–ù–¨ 1: WebSocket real-time (<100ms)
    ‚úÖ market_data.current_tick.price
    ‚îú‚îÄ –ò—Å—Ç–æ—á–Ω–∏–∫: WebSocket API
    ‚îú‚îÄ –ß–∞—Å—Ç–æ—Ç–∞: 50-150ms
    ‚îî‚îÄ –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å: >99.5%
    
–£–†–û–í–ï–ù–¨ 2: Last candle fallback (30-60s)
    ‚ö†Ô∏è market_data.ohlcv_data[-1].close
    ‚îú‚îÄ –ò—Å—Ç–æ—á–Ω–∏–∫: DataRegistry (cached)
    ‚îú‚îÄ –ß–∞—Å—Ç–æ—Ç–∞: –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
    ‚îî‚îÄ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –µ—Å–ª–∏: WebSocket > 1s –ø–æ–∑–∞–¥–∏
    
–£–†–û–í–ï–ù–¨ 3: Saved price emergency (variable)
    üî¥ market_data.last_known_price
    ‚îú‚îÄ –ò—Å—Ç–æ—á–Ω–∏–∫: DataRegistry (last saved)
    ‚îú‚îÄ –ß–∞—Å—Ç–æ—Ç–∞: –ø—Ä–∏ –∫–∞–∂–¥–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
    ‚îî‚îÄ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –µ—Å–ª–∏: –æ–±–∞ –≤—ã—à–µ = None

–£–†–û–í–ï–ù–¨ 4: REST API fallback (1-5s)
    üî¥ REST API client.get_price_limits()
    ‚îú‚îÄ –ò—Å—Ç–æ—á–Ω–∏–∫: OKX HTTP API
    ‚îú‚îÄ –ß–∞—Å—Ç–æ—Ç–∞: –∑–∞–≤–∏—Å–∏—Ç –æ—Ç lag
    ‚îî‚îÄ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –µ—Å–ª–∏: –≤—Å–µ –≤—ã—à–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã
```

---

## üîß –ö–û–ù–ö–†–ï–¢–ù–´–ï –ò–ó–ú–ï–ù–ï–ù–ò–Ø

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ #1: WebSocketCoordinator (–í–•–û–î–ù–ê–Ø –¢–û–ß–ö–ê)

**–§–∞–π–ª:** `src/strategies/scalping/futures/coordinators/websocket_coordinator.py`  
**–õ–∏–Ω–∏–∏:** 352-382

**–ß—Ç–æ –±—ã–ª–æ:**
```python
# ‚ùå –ë–´–õ–û: –¢–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω—è—è —Ü–µ–Ω–∞, –±–µ–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞
await self.data_registry.update_market_data(symbol, {
    "price": price,
    "last_price": price,
    "volume": volume_24h,
    # ‚ùå current_tick –ù–ï —Å–æ—Ö—Ä–∞–Ω—è–ª—Å—è!
})
```

**–ß—Ç–æ —Å—Ç–∞–ª–æ:**
```python
# ‚úÖ –°–¢–ê–õ–û: –ü–æ–ª–Ω—ã–π CurrentTick –æ–±—ä–µ–∫—Ç —Å bid/ask
class CurrentTick:
    def __init__(self, price, bid, ask, timestamp):
        self.price = price
        self.bid = bid
        self.ask = ask
        self.timestamp = timestamp

bid_price = float(ticker.get("bidPx", price))
ask_price = float(ticker.get("askPx", price))

current_tick = CurrentTick(
    price=price,
    bid=bid_price,
    ask=ask_price,
    timestamp=time.time()  # Real-time timestamp!
)

await self.data_registry.update_market_data(symbol, {
    "price": price,
    "last_price": price,
    "current_tick": current_tick,  # ‚úÖ –≠–¢–û –ö–†–ò–¢–ò–ß–ù–û!
    "volume": volume_24h,
})
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ DataRegistry —Ç–µ–ø–µ—Ä—å —Å–æ–¥–µ—Ä–∂–∏—Ç fresh WebSocket prices

---

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ #2: ExitAnalyzer (–ê–ù–ê–õ–ò–ó –í–´–•–û–î–ê)

**–§–∞–π–ª:** `src/strategies/scalping/futures/positions/exit_analyzer.py`  
**–õ–∏–Ω–∏–∏:** 413-460

**–ß—Ç–æ –±—ã–ª–æ:**
```python
# ‚ùå –ë–´–õ–û: REST API call (1-5 —Å–µ–∫ –Ω–∞ VPN!)
price_limits = await self.client.get_price_limits(symbol)
current_price = price_limits.get("current_price", 0)

# Fallback: —Ç–æ–ª—å–∫–æ –Ω–∞ —Å—Ç–∞—Ä—É—é —Å–≤–µ—á—É
if current_price <= 0:
    current_price = market_data.get("ohlcv_data", [{}])[-1].get("close", 0)
```

**–ß—Ç–æ —Å—Ç–∞–ª–æ:**
```python
# ‚úÖ –°–¢–ê–õ–û: 3-—É—Ä–æ–≤–Ω–µ–≤–∞—è –∏–µ—Ä–∞—Ä—Ö–∏—è
market_data = await self.data_registry.get_market_data(symbol)

# Tier 1: WebSocket real-time (<100ms)
current_price = None
if market_data and hasattr(market_data, 'current_tick') and market_data.current_tick:
    if hasattr(market_data.current_tick, 'price') and market_data.current_tick.price > 0:
        current_price = market_data.current_tick.price
        logger.debug(f"‚úÖ ExitAnalyzer: WebSocket real-time price for {symbol}: {current_price:.8f}")

# Tier 2: Last candle fallback (–µ—Å–ª–∏ WebSocket –æ—Ç—Å—Ç–∞–ª)
if current_price is None or current_price <= 0:
    if market_data and hasattr(market_data, 'ohlcv_data') and market_data.ohlcv_data:
        current_price = market_data.ohlcv_data[-1].close
        logger.debug(f"‚ö†Ô∏è ExitAnalyzer: Using last candle for {symbol}: {current_price:.8f}")

# Tier 3: Emergency fallback (last known price)
if current_price is None or current_price <= 0:
    if market_data and hasattr(market_data, 'last_known_price'):
        current_price = market_data.last_known_price
        logger.debug(f"üî¥ ExitAnalyzer: Using emergency fallback for {symbol}: {current_price:.8f}")
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 
- ‚úÖ –£–±—Ä–∞–Ω–∞ REST API (1-5 —Å–µ–∫ ‚Üí <100ms)
- ‚úÖ Graceful fallback –±–µ–∑ —Ö–∞—Ä–¥–∫–æ–¥–∞
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –Ω–∞ VPN

---

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ #3: TrailingSLCoordinator (–¢–†–ï–ô–õ–ò–ù–ì –°–õ)

**–§–∞–π–ª:** `src/strategies/scalping/futures/coordinators/trailing_sl_coordinator.py`

#### –ß–∞—Å—Ç—å A: –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä

**–ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ:**
```python
# –ë–´–õ–û:
def __init__(self, ..., exit_analyzer=None):

# –°–¢–ê–õ–û:
def __init__(self, ..., exit_analyzer=None, position_registry=None):  # ‚úÖ NEW!
    self.position_registry = position_registry  # ‚úÖ SAVE IT!
```

**–õ–∏–Ω–∏–∏:** 51 (–ø–∞—Ä–∞–º–µ—Ç—Ä), 91 (–∞—Ç—Ä–∏–±—É—Ç)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ TrailingSL –º–æ–∂–µ—Ç —Ç–µ–ø–µ—Ä—å –ø–æ–ª—É—á–∞—Ç—å –¥–æ—Å—Ç—É–ø –∫ `position_registry.data_registry`

#### –ß–∞—Å—Ç—å B: –ú–µ—Ç–æ–¥ `_get_current_price()` (–ü–ï–†–ï–ü–ò–°–ê–ù –ü–û–õ–ù–û–°–¢–¨–Æ)

**–§–∞–π–ª:** `src/strategies/scalping/futures/coordinators/trailing_sl_coordinator.py`  
**–õ–∏–Ω–∏–∏:** 1683-1740

**–ß—Ç–æ –±—ã–ª–æ:**
```python
# ‚ùå –ë–´–õ–û: –¢–æ–ª—å–∫–æ REST API callback –∏–ª–∏ client
if self.get_current_price_callback:
    return await self.get_current_price_callback(symbol)  # REST (–º–µ–¥–ª–µ–Ω–Ω–æ)
return await self._fetch_price_via_client(symbol)  # REST (–º–µ–¥–ª–µ–Ω–Ω–æ)
```

**–ß—Ç–æ —Å—Ç–∞–ª–æ:**
```python
# ‚úÖ –°–¢–ê–õ–û: 4-—É—Ä–æ–≤–Ω–µ–≤–∞—è –∏–µ—Ä–∞—Ä—Ö–∏—è
async def _get_current_price(self, symbol: str) -> Optional[float]:
    """
    –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â—É—é —Ü–µ–Ω—É —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º:
    1. WebSocket real-time (DataRegistry) - <100ms
    2. –°–≤–µ—á–∞ (DataRegistry) - fallback
    3. REST API callback - fallback
    4. REST API client - emergency
    """
    
    # TIER 1: WebSocket real-time from DataRegistry
    try:
        if hasattr(self, 'position_registry') and self.position_registry:
            market_data = await self.position_registry.data_registry.get_market_data(symbol)
            if market_data and hasattr(market_data, 'current_tick') and market_data.current_tick:
                if hasattr(market_data.current_tick, 'price') and market_data.current_tick.price > 0:
                    logger.debug(f"‚úÖ TSL: WebSocket real-time price for {symbol}: {market_data.current_tick.price:.8f}")
                    return market_data.current_tick.price
    except Exception as e:
        logger.debug(f"‚ö†Ô∏è TSL: Failed to get DataRegistry real-time price: {e}")
    
    # TIER 2: Last candle from DataRegistry
    try:
        if hasattr(self, 'position_registry') and self.position_registry:
            market_data = await self.position_registry.data_registry.get_market_data(symbol)
            if market_data and hasattr(market_data, 'ohlcv_data') and market_data.ohlcv_data:
                last_candle_price = market_data.ohlcv_data[-1].close
                if last_candle_price > 0:
                    logger.debug(f"‚ö†Ô∏è TSL: Using last candle for {symbol}: {last_candle_price:.8f}")
                    return last_candle_price
    except Exception as e:
        logger.debug(f"‚ö†Ô∏è TSL: Failed to get last candle: {e}")
    
    # TIER 3: Emergency price from DataRegistry
    try:
        if hasattr(self, 'position_registry') and self.position_registry:
            market_data = await self.position_registry.data_registry.get_market_data(symbol)
            if market_data and hasattr(market_data, 'last_known_price'):
                if market_data.last_known_price and market_data.last_known_price > 0:
                    logger.debug(f"üî¥ TSL: Using emergency price for {symbol}: {market_data.last_known_price:.8f}")
                    return market_data.last_known_price
    except Exception as e:
        logger.debug(f"‚ö†Ô∏è TSL: Failed to get emergency price: {e}")
    
    # TIER 4: REST API callback (slower, but reliable)
    if self.get_current_price_callback:
        try:
            price = await self.get_current_price_callback(symbol)
            if price and price > 0:
                logger.warning(f"üî¥ TSL: Using REST API callback for {symbol}: {price:.8f}")
                return price
        except Exception as e:
            logger.warning(f"üî¥ TSL: REST API callback failed for {symbol}: {e}")
    
    # TIER 5: REST API client (emergency)
    try:
        price = await self._fetch_price_via_client(symbol)
        if price and price > 0:
            logger.error(f"üî¥ TSL: Using REST API client (emergency) for {symbol}: {price:.8f}")
            return price
    except Exception as e:
        logger.error(f"üî¥ TSL: All price sources exhausted for {symbol}: {e}")
        return None
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ Tier 1 = WebSocket real-time (<100ms) - –ü–†–ò–û–†–ò–¢–ï–¢!
- ‚úÖ Tier 2 = Cached candles (fallback)
- ‚úÖ Tier 3 = Saved price (emergency)
- ‚úÖ Tier 4-5 = REST API (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω–æ–µ –æ—Ç–∫–∞–∑–∞–ª–æ)

---

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ #4: Orchestrator (–ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø)

**–§–∞–π–ª:** `src/strategies/scalping/futures/orchestrator.py`  
**–õ–∏–Ω–∏—è:** 520

**–ß—Ç–æ –±—ã–ª–æ:**
```python
self.trailing_sl_coordinator = TrailingSLCoordinator(
    ...,
    exit_analyzer=self.exit_analyzer,
    # ‚ùå position_registry –ù–ï –ø–µ—Ä–µ–¥–∞–≤–∞–ª–∞—Å—å
)
```

**–ß—Ç–æ —Å—Ç–∞–ª–æ:**
```python
self.trailing_sl_coordinator = TrailingSLCoordinator(
    ...,
    exit_analyzer=self.exit_analyzer,
    position_registry=self.position_registry,  # ‚úÖ –ù–û–í–û–ï (09.01.2026)
)
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ TrailingSL —Ç–µ–ø–µ—Ä—å –ø–æ–ª—É—á–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ DataRegistry

---

## üìä –°–†–ê–í–ù–ï–ù–ò–ï –°–ö–û–†–û–°–¢–ï–ô

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ò—Å—Ç–æ—á–Ω–∏–∫ | –ó–∞–¥–µ—Ä–∂–∫–∞ | –ü—Ä–æ–±–ª–µ–º–∞ |
|-----------|----------|----------|---------|
| SignalGenerator | WebSocket | <100ms | ‚úÖ OK |
| ExitAnalyzer | REST API | 1-5 —Å–µ–∫ | ‚ùå –ú–ï–î–õ–ï–ù–ù–û |
| TrailingSL | ohlcv_data | 30-60ms | ‚ö†Ô∏è –°–¢–ê–†–ê–Ø |

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ò—Å—Ç–æ—á–Ω–∏–∫ | –ó–∞–¥–µ—Ä–∂–∫–∞ | –°—Ç–∞—Ç—É—Å |
|-----------|----------|----------|--------|
| SignalGenerator | WebSocket | <100ms | ‚úÖ OK (–Ω–µ –º–µ–Ω—è–ª—Å—è) |
| ExitAnalyzer | WebSocket | <100ms | ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û (50x –±—ã—Å—Ç—Ä–µ–µ!) |
| TrailingSL | WebSocket | <100ms | ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û (—Å–≤–µ–∂–∞—è —Ü–µ–Ω–∞) |

---

## üîç –í–ï–†–ò–§–ò–ö–ê–¶–ò–û–ù–ù–´–ô –ß–ï–ö–õ–ò–°–¢

### ‚úÖ –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã:

- ‚úÖ **WebSocketCoordinator** - —Å–æ–∑–¥–∞–µ—Ç –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç `current_tick` –≤ DataRegistry
- ‚úÖ **ExitAnalyzer** - –ø–æ–ª—É—á–∞–µ—Ç `data_registry` –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∏–µ—Ä–∞—Ä—Ö–∏—é
- ‚úÖ **TrailingSLCoordinator** - –ø–æ–ª—É—á–∞–µ—Ç `position_registry`, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç DataRegistry first
- ‚úÖ **Orchestrator** - –ø–µ—Ä–µ–¥–∞–µ—Ç `position_registry` –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ TrailingSL
- ‚úÖ **SignalGenerator** - —É–∂–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç WebSocket —á–µ—Ä–µ–∑ `_get_current_price()`

### ‚úÖ –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ñ–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:

1. ‚úÖ `src/strategies/scalping/futures/coordinators/websocket_coordinator.py` (–ª–∏–Ω–∏–∏ 352-382)
2. ‚úÖ `src/strategies/scalping/futures/positions/exit_analyzer.py` (–ª–∏–Ω–∏–∏ 413-460)
3. ‚úÖ `src/strategies/scalping/futures/coordinators/trailing_sl_coordinator.py`:
   - –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä: –ø–∞—Ä–∞–º–µ—Ç—Ä `position_registry` (–ª–∏–Ω–∏—è 51)
   - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è: `self.position_registry = position_registry` (–ª–∏–Ω–∏—è 91)
   - –ú–µ—Ç–æ–¥: `_get_current_price()` –ø–µ—Ä–µ–ø–∏—Å–∞–Ω (–ª–∏–Ω–∏–∏ 1683-1740)
4. ‚úÖ `src/strategies/scalping/futures/orchestrator.py` (–ª–∏–Ω–∏—è 520)

---

## üöÄ –û–ñ–ò–î–ê–ï–ú–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´

### –ù–∞ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–º –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ (< 50ms latency):
- ‚úÖ –í—Ö–æ–¥—ã: real-time —Ü–µ–Ω—ã –∏–∑ WebSocket
- ‚úÖ –í—ã—Ö–æ–¥—ã: real-time —Ü–µ–Ω—ã –∏–∑ WebSocket (–≤–º–µ—Å—Ç–æ REST API –∑–∞–¥–µ—Ä–∂–∫–∏!)
- ‚úÖ TSL: real-time —Ü–µ–Ω—ã –∏–∑ WebSocket
- ‚úÖ –û–±—â–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –±–æ–µ–≤–æ–≥–æ —Ü–∏–∫–ª–∞: **-2-3 —Å–µ–∫** (–∑–∞ —Å—á–µ—Ç —É–±—Ä–∞–Ω–Ω–æ–π REST API –∑–∞–¥–µ—Ä–∂–∫–∏)

### –ù–∞ –ø–ª–æ—Ö–æ–º –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ (605ms VPN latency):
- ‚úÖ WebSocket —Ä–∞–±–æ—Ç–∞–µ—Ç: real-time —Ü–µ–Ω—ã  
- ‚úÖ WebSocket –æ—Ç—Å—Ç–∞–ª: gracefully –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ —Å–≤–µ–∂–∏–µ —Å–≤–µ—á–∏
- ‚úÖ –°–≤–µ—á–∏ —É—Å—Ç–∞—Ä–µ–ª–∏: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ—Å–ª–µ–¥–Ω—é—é –∏–∑–≤–µ—Å—Ç–Ω—É—é —Ü–µ–Ω—É
- ‚úÖ –í—Å–µ –æ—Ç–∫–∞–∑–∞–ª–æ: fallback –Ω–∞ REST API (–Ω–æ —ç—Ç–æ —Ä–µ–¥–∫–æ)
- ‚úÖ –ë–æ—Ç –Ω–µ –∑–∞–≤–∏—Å–∞–µ—Ç, graceful degradation —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ö–∞—á–µ—Å—Ç–≤–æ –≤—Ö–æ–¥–æ–≤:
- ‚úÖ –î–û: 0.5-2% —Å–ª–∏–ø–¥–∂ (—Å—Ç–∞—Ä—ã–µ —Ü–µ–Ω—ã)
- ‚úÖ –ü–û–°–õ–ï: <0.1% —Å–ª–∏–ø–¥–∂ (real-time —Ü–µ–Ω—ã)

---

## üìù –õ–û–ì–ò–†–û–í–ê–ù–ò–ï –î–õ–Ø –ü–†–û–í–ï–†–ö–ò

**–ß—Ç–æ —Å–º–æ—Ç—Ä–µ—Ç—å –≤ –ª–æ–≥–∞—Ö –¥–ª—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏:**

```
‚úÖ ExitAnalyzer: WebSocket real-time price        ‚Üí –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è WebSocket
‚úÖ TSL: WebSocket real-time price                 ‚Üí –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è WebSocket
‚ö†Ô∏è Using last candle for {symbol}                ‚Üí Fallback –Ω–∞ —Å–≤–µ—á–∏ (–Ω–æ—Ä–º–∞–ª—å–Ω–æ)
üî¥ Using REST API callback                        ‚Üí REST API (—Ä–µ–¥–∫–æ)
üî¥ All price sources exhausted                    ‚Üí –ü–†–û–ë–õ–ï–ú–ê (–æ—á–µ–Ω—å —Ä–µ–¥–∫–æ)
```

**–ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ª–æ–≥–æ–≤:**
```bash
grep "ExitAnalyzer: WebSocket\|TSL: WebSocket\|Using last candle\|Using REST API" logs/futures/*.log | head -50
```

---

## üéì –ê–†–•–ò–¢–ï–ö–¢–£–†–ù–´–ï –ü–†–ò–ù–¶–ò–ü–´

### 1. –ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã
- DataRegistry = central hub –¥–ª—è –≤—Å–µ—Ö price data
- –í—Å–µ –º–æ–¥—É–ª–∏ —á–∏—Ç–∞—é—Ç –æ—Ç—Å—é–¥–∞, –Ω–µ —Å–æ–∑–¥–∞—é—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ –∫—ç—à–∏

### 2. –ò–µ—Ä–∞—Ä—Ö–∏—è fallback (NOT HARDCODED)
- –ö–∞–∂–¥—ã–π —É—Ä–æ–≤–µ–Ω—å = —Ä–µ–∞–ª—å–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö
- –ù–µ—Ç "–º–∞–≥–∏—á–µ—Å–∫–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π" –∏–ª–∏ —Ö–∞—Ä–¥–∫–æ–¥–∞
- Graceful degradation –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö

### 3. WebSocket priority
- –†–µ–∞–ª-—Ç–∞–π–º WebSocket –¥–∞–Ω–Ω—ã–µ –í–°–ï–ì–î–ê –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
- –î—Ä—É–≥–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ = —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞, –Ω–µ –æ—Å–Ω–æ–≤–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ

### 4. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ç—Ä–µ–π—Å–∏–Ω–≥
- –ö–∞–∂–¥—ã–π —É—Ä–æ–≤–µ–Ω—å fallback –ª–æ–≥–∏—Ä—É–µ—Ç –ø–æ—á–µ–º—É –±—ã–ª –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω
- –ú–æ–∂–Ω–æ –æ—Ç—Å–ª–µ–¥–∏—Ç—å –≤–µ—Å—å –ø—É—Ç—å –ø–æ–∏—Å–∫–∞ —Ü–µ–Ω—ã

---

## üìã –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ:
1. ‚úÖ Deploy –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–∞ dev/staging
2. ‚è≥ –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç –∏ —Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –æ—à–∏–±–æ–∫
3. ‚è≥ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ `current_tick` —Å–æ–∑–¥–∞–µ—Ç—Å—è –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è
4. ‚è≥ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ ExitAnalyzer –≤–∏–¥–∏—Ç WebSocket prices
5. ‚è≥ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ TrailingSL –≤–∏–¥–∏—Ç WebSocket prices

### –î–µ—Ç–∞–ª—å–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:
1. ‚è≥ –°–æ–±—Ä–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –≤—Ö–æ–¥–æ–≤ (—Ü–µ–Ω–∞ –≤—Ö–æ–¥–∞ vs —Ä–µ–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞)
2. ‚è≥ –°–æ–±—Ä–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –≤—ã—Ö–æ–¥–æ–≤ (—Å–∫–æ—Ä–æ—Å—Ç—å –∞–Ω–∞–ª–∏–∑–∞)
3. ‚è≥ –°—Ä–∞–≤–Ω–∏—Ç—å —Å–æ —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–µ–π (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–∞–º–Ω–æ–≥–æ –±—ã—Å—Ç—Ä–µ–µ!)

### –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
1. ‚è≥ –û–±–Ω–æ–≤–∏—Ç—å README —Å –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π
2. ‚è≥ –î–æ–±–∞–≤–∏—Ç—å –¥–∏–∞–≥—Ä–∞–º–º—ã data flow
3. ‚è≥ –ù–∞–ø–∏—Å–∞—Ç—å guide –ø–æ troubleshooting —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –ª–æ–≥–æ–≤

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –ø–ª–æ—Ö–æ–º –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ:
1. ‚è≥ –í—ã–∫–ª—é—á–∏—Ç—å WebSocket –≤—Ä–µ–º–µ–Ω–Ω–æ –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å fallback
2. ‚è≥ –ù–∞–±–ª—é–¥–∞—Ç—å –ø–µ—Ä–µ—Ö–æ–¥: WebSocket ‚Üí Candles ‚Üí Saved ‚Üí REST
3. ‚è≥ –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –±–æ—Ç –Ω–µ –∑–∞–≤–∏—Å–∞–µ—Ç –ø—Ä–∏ —Ä–∞–∑—Ä—ã–≤–∞—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

---

## ‚úÖ –ò–¢–û–ì

| –ê—Å–ø–µ–∫—Ç | –°—Ç–∞—Ç—É—Å | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
|--------|--------|-----------|
| **WebSocket‚ÜíDataRegistry** | ‚úÖ –ì–û–¢–û–í–û | current_tick —Å–æ–∑–¥–∞–µ—Ç—Å—è –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è |
| **ExitAnalyzer fix** | ‚úÖ –ì–û–¢–û–í–û | REST API —É–±—Ä–∞–Ω, WebSocket –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
| **TrailingSL fix** | ‚úÖ –ì–û–¢–û–í–û | DataRegistry first, 4-—É—Ä–æ–≤–Ω–µ–≤—ã–π fallback |
| **Orchestrator updates** | ‚úÖ –ì–û–¢–û–í–û | position_registry –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è |
| **SignalGenerator** | ‚úÖ OK | –£–∂–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π, –Ω–µ –º–µ–Ω—è–ª—Å—è |
| **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** | ‚úÖ –î–û–ë–ê–í–õ–ï–ù–û | –ö–∞–∂–¥—ã–π —É—Ä–æ–≤–µ–Ω—å fallback –ª–æ–≥–∏—Ä—É–µ—Ç |
| **Fallback chain** | ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û | Graceful degradation —Ä–∞–±–æ—Ç–∞–µ—Ç |
| **VPN-aware** | ‚úÖ –£–ß–¢–ï–ù–û | Fallback –º–Ω–æ–∂–∏—Ç–µ–ª–∏ –¥–ª—è slow connection |

**–°–¢–ê–¢–£–°: ‚úÖ –ì–û–¢–û–í–û –ö –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Æ**

---

**–î–∞—Ç–∞:** 09.01.2026  
**–ê–≤—Ç–æ—Ä:** GitHub Copilot  
**–í–µ—Ä—Å–∏—è:** 1.0 Final
