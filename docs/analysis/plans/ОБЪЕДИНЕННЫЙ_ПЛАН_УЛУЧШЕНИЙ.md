# üìä –û–ë–™–ï–î–ò–ù–ï–ù–ù–´–ô –ü–õ–ê–ù –£–õ–£–ß–®–ï–ù–ò–ô –ë–û–¢–ê

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-11-14  
**–ò—Å—Ç–æ—á–Ω–∏–∫–∏:**
- –ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∏ –ø–ª–∞–Ω —É–ª—É—á—à–µ–Ω–∏–π –±–æ—Ç–∞
- –ê–Ω–∞–ª–∏–∑ —Å—Ç–∞—Ç—å–∏ Momentum Trading Strategy

**–¶–µ–ª—å:** –û–±—ä–µ–¥–∏–Ω–∏—Ç—å –≤—Å–µ —É–ª—É—á—à–µ–Ω–∏—è –≤ –µ–¥–∏–Ω—ã–π –ø–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏

---

## üéØ –ü–†–ò–û–†–ò–¢–ï–¢–´ –ò –°–¢–†–£–ö–¢–£–†–ê –ü–õ–ê–ù–ê

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –ö–†–ò–¢–ò–ß–ù–û (–Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ)
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º Trailing Stop Loss
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –±–∞–∑–æ–≤—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∏–∑ —Å—Ç–∞—Ç—å–∏ Momentum Trading

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –í–ê–ñ–ù–û (–±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è)
- –£–ª—É—á—à–µ–Ω–∏—è –ª–æ–≥–∏–∫–∏ Trailing Stop Loss
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∏–∑ —Å—Ç–∞—Ç—å–∏
- –£–ª—É—á—à–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤

---

## üìã –ü–†–ò–û–†–ò–¢–ï–¢ 1: –ö–†–ò–¢–ò–ß–ù–û (–ù–ï–ú–ï–î–õ–ï–ù–ù–û)

### 1.1. –í—ã–Ω–µ—Å—Ç–∏ –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ –∫–æ–Ω—Ñ–∏–≥

#### 1.1.1. –ö–æ–º–∏—Å—Å–∏—è –∏ Fees

**–§–∞–π–ª:** `config/config_futures.yaml`  
**–î–æ–±–∞–≤–∏—Ç—å:**
```yaml
# Commission & Fees
commission:
  trading_fee_rate: 0.0009  # 0.09% –Ω–∞ –∫—Ä—É–≥ (0.045% –≤—Ö–æ–¥ + 0.045% –≤—ã—Ö–æ–¥)
  tp_buffer_percent: 0.1  # –ó–∞–ø–∞—Å 0.1% –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ TP
```

**–§–∞–π–ª:** `src/strategies/scalping/futures/position_manager.py:582`  
**–ò–∑–º–µ–Ω–∏—Ç—å:**
```python
# ‚ùå –ë–´–õ–û:
commission_rate = 0.0009  # 0.09% –Ω–∞ –∫—Ä—É–≥

# ‚úÖ –°–¢–ê–õ–û:
commission_config = getattr(self.scalping_config, "commission", {})
commission_rate = commission_config.get("trading_fee_rate", 0.0009)
```

**–§–∞–π–ª:** `src/strategies/scalping/futures/position_manager.py:719`  
**–ò–∑–º–µ–Ω–∏—Ç—å:**
```python
# ‚ùå –ë–´–õ–û:
buffer_pct = 0.1  # –ó–∞–ø–∞—Å 0.1%

# ‚úÖ –°–¢–ê–õ–û:
buffer_pct = commission_config.get("tp_buffer_percent", 0.1) / 100.0
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ö–æ–º–∏—Å—Å–∏—è –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –∫–æ–Ω—Ñ–∏–≥
- ‚úÖ Buffer –¥–ª—è TP –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –∫–æ–Ω—Ñ–∏–≥
- ‚úÖ –ú–æ–∂–Ω–æ –ª–µ–≥–∫–æ –º–µ–Ω—è—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞

---

#### 1.1.2. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –º–∞—Ä–∂–∏

**–§–∞–π–ª:** `config/config_futures.yaml`  
**–î–æ–±–∞–≤–∏—Ç—å:**
```yaml
# Margin Settings
margin:
  maintenance_margin_ratio: 0.01  # 1% maintenance margin
  initial_margin_ratio: 0.1  # 10% initial margin
```

**–§–∞–π–ª:** `src/strategies/scalping/futures/orchestrator.py:97-98`  
**–ò–∑–º–µ–Ω–∏—Ç—å:**
```python
# ‚ùå –ë–´–õ–û:
maintenance_margin_ratio=0.01,
initial_margin_ratio=0.1,

# ‚úÖ –°–¢–ê–õ–û:
margin_config = getattr(self.scalping_config, "margin", {})
maintenance_margin_ratio = margin_config.get("maintenance_margin_ratio", 0.01)
initial_margin_ratio = margin_config.get("initial_margin_ratio", 0.1)
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –º–∞—Ä–∂–∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ –∫–æ–Ω—Ñ–∏–≥
- ‚úÖ –ú–æ–∂–Ω–æ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥ —Ä–∞–∑–Ω—ã–µ –±–∏—Ä–∂–∏

---

#### 1.1.3. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞—â–∏—Ç—ã –æ—Ç –ª–æ–∂–Ω—ã—Ö —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π

**–§–∞–π–ª:** `config/config_futures.yaml`  
**–î–æ–±–∞–≤–∏—Ç—å:**
```yaml
# Position Manager Settings
position_manager:
  false_trigger_protection:
    margin_ratio_threshold: 1.5  # –ü–æ—Ä–æ–≥ –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –ª–æ–∂–Ω—ã—Ö —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π
    pnl_threshold: 10.0  # –ü–æ—Ä–æ–≥ PnL –¥–ª—è –∑–∞—â–∏—Ç—ã (USDT)
    margin_ratio_minimum: 0.5  # –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π margin_ratio –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏
```

**–§–∞–π–ª:** `src/strategies/scalping/futures/position_manager.py:263-274`  
**–ò–∑–º–µ–Ω–∏—Ç—å:**
```python
# ‚ùå –ë–´–õ–û:
if margin_ratio <= 1.5 and abs(pnl) < 10:
    ...
if margin_ratio <= 0.5 and equity > 0:
    ...

# ‚úÖ –°–¢–ê–õ–û:
protection_config = getattr(self.scalping_config, "position_manager", {}).get("false_trigger_protection", {})
margin_ratio_threshold = protection_config.get("margin_ratio_threshold", 1.5)
pnl_threshold = protection_config.get("pnl_threshold", 10.0)
margin_ratio_minimum = protection_config.get("margin_ratio_minimum", 0.5)

if margin_ratio <= margin_ratio_threshold and abs(pnl) < pnl_threshold:
    ...
if margin_ratio <= margin_ratio_minimum and equity > 0:
    ...
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ü–æ—Ä–æ–≥–∏ –∑–∞—â–∏—Ç—ã –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ –∫–æ–Ω—Ñ–∏–≥
- ‚úÖ –ú–æ–∂–Ω–æ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥ —Ä–∞–∑–Ω—ã–µ –±–∞–ª–∞–Ω—Å—ã

---

### 1.2. –£–ª—É—á—à–∏—Ç—å Trailing Stop Loss

#### 1.2.1. –£–≤–µ–ª–∏—á–∏—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ç—Ä–µ–π–ª

**–§–∞–π–ª:** `config/config_futures.yaml`  
**–ò–∑–º–µ–Ω–∏—Ç—å:**
```yaml
trailing_sl:
  max_trail: 0.02  # ‚úÖ –£–í–ï–õ–ò–ß–ï–ù–û: 2% (–±—ã–ª–æ 0.01 = 1%) –¥–ª—è —Å–∫–∞–ª—å–ø–∏–Ω–≥–∞
  by_regime:
    trending:
      max_trail: 0.03  # ‚úÖ 3% –¥–ª—è —Ç—Ä–µ–Ω–¥–∞ (–±–æ–ª—å—à–µ –º–µ—Å—Ç–∞ –¥–ª—è –æ—Ç–∫–∞—Ç–∞)
    ranging:
      max_trail: 0.02  # ‚úÖ 2% –¥–ª—è –±–æ–∫–æ–≤–∏–∫–∞
    choppy:
      max_trail: 0.015  # ‚úÖ 1.5% –¥–ª—è —Ö–∞–æ—Å–∞ (–±–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–æ)
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ë–æ–ª—å—à–µ –º–µ—Å—Ç–∞ –¥–ª—è –æ—Ç–∫–∞—Ç–æ–≤ –≤ —Ç—Ä–µ–Ω–¥–µ
- ‚úÖ –ú–µ–Ω—å—à–µ –∑–∞–∫—Ä—ã—Ç–∏–π —Å –º–µ–Ω—å—à–µ–π –ø—Ä–∏–±—ã–ª—å—é

---

#### 1.2.2. –†–∞—Å—à–∏—Ä–∏—Ç—å –∞–¥–∞–ø—Ç–∏–≤–Ω—É—é –ª–æ–≥–∏–∫—É –¥–ª—è –≤—Å–µ—Ö —Ä–µ–∂–∏–º–æ–≤

**–§–∞–π–ª:** `config/config_futures.yaml`  
**–ò–∑–º–µ–Ω–∏—Ç—å:**
```yaml
trailing_sl:
  by_regime:
    trending:
      regime_multiplier: 2.0  # ‚úÖ –£–í–ï–õ–ò–ß–ï–ù–û: 2.0 (–±—ã–ª–æ 1.5) - –±–æ–ª—å—à–µ –º–µ—Å—Ç–∞
    ranging:
      regime_multiplier: 1.2  # ‚úÖ –î–û–ë–ê–í–õ–ï–ù–û: 1.2 - –Ω–µ–±–æ–ª—å—à–æ–π –±—É—Ñ–µ—Ä –¥–∞–∂–µ –¥–ª—è ranging
    choppy:
      regime_multiplier: 0.9  # ‚úÖ –£–∂–µ –µ—Å—Ç—å: 0.9 - –±–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–æ
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –≤—Å–µ—Ö —Ä–µ–∂–∏–º–æ–≤
- ‚úÖ –î–∞–∂–µ –≤ ranging –µ—Å—Ç—å –Ω–µ–±–æ–ª—å—à–æ–π –±—É—Ñ–µ—Ä –¥–ª—è –æ—Ç–∫–∞—Ç–æ–≤

---

#### 1.2.3. –î–æ–±–∞–≤–∏—Ç—å –∑–∞—â–∏—Ç—É –æ—Ç –∫—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã—Ö –æ—Ç—Å–∫–æ–∫–æ–≤

**–§–∞–π–ª:** `config/config_futures.yaml`  
**–î–æ–±–∞–≤–∏—Ç—å:**
```yaml
trailing_sl:
  short_reversal_protection:
    enabled: true
    min_reversal_duration_seconds: 30  # –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ—Ç—Å–∫–æ–∫–∞ –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è
    max_reversal_percent: 0.5  # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –æ—Ç—Å–∫–æ–∫ –¥–ª—è –∑–∞—â–∏—Ç—ã (0.5%)
```

**–§–∞–π–ª:** `src/strategies/scalping/futures/indicators/trailing_stop_loss.py`  
**–î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥:**
```python
def _check_short_reversal(self, current_price: float, last_price: float, timestamp: float) -> bool:
    """
    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –æ—Ç—Å–∫–æ–∫ –∫—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–º.
    –ï—Å–ª–∏ –æ—Ç—Å–∫–æ–∫ –¥–ª–∏—Ç—Å—è –º–µ–Ω–µ–µ min_reversal_duration_seconds - –Ω–µ –∑–∞–∫—Ä—ã–≤–∞—Ç—å.
    """
    if not self.short_reversal_protection.get("enabled", False):
        return True  # –ó–∞—â–∏—Ç–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∞ - –∑–∞–∫—Ä—ã–≤–∞–µ–º –∫–∞–∫ –æ–±—ã—á–Ω–æ
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ—Ç—Å–∫–æ–∫–∞
    reversal_duration = time.time() - timestamp
    min_duration = self.short_reversal_protection.get("min_reversal_duration_seconds", 30)
    
    if reversal_duration < min_duration:
        # –û—Ç—Å–∫–æ–∫ —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π - –Ω–µ –∑–∞–∫—Ä—ã–≤–∞—Ç—å
        return False
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä –æ—Ç—Å–∫–æ–∫–∞
    max_reversal = self.short_reversal_protection.get("max_reversal_percent", 0.5) / 100.0
    reversal_pct = abs(current_price - last_price) / last_price
    
    if reversal_pct > max_reversal:
        # –û—Ç—Å–∫–æ–∫ —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π - –∑–∞–∫—Ä—ã–≤–∞—Ç—å
        return True
    
    return True
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ù–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –ø–æ–∑–∏—Ü–∏–∏ –Ω–∞ –∫—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã—Ö –æ—Ç—Å–∫–æ–∫–∞—Ö (< 30 —Å–µ–∫)
- ‚úÖ –ó–∞—â–∏—â–∞–µ—Ç –æ—Ç –ª–æ–∂–Ω—ã—Ö —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π

---

### 1.3. –î–æ–±–∞–≤–∏—Ç—å –±–∞–∑–æ–≤—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –∏–∑ —Å—Ç–∞—Ç—å–∏ Momentum Trading

#### 1.3.1. –§–∏–ª—å—Ç—Ä –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã—Ö —Å–∫–∞—á–∫–æ–≤

**–§–∞–π–ª:** `config/config_futures.yaml`  
**–î–æ–±–∞–≤–∏—Ç—å:**
```yaml
# Momentum Filter (–∏–∑ —Å—Ç–∞—Ç—å–∏ Momentum Trading)
momentum_filter:
  enabled: true
  reject_vertical_spikes: true
  max_spike_percent: 1.0  # –û—Ç–∫–ª–æ–Ω—è—Ç—å –µ—Å–ª–∏ —Å–∫–∞—á–æ–∫ > 1% –∑–∞ –ø–µ—Ä–∏–æ–¥
  spike_lookback_periods: 5  # –ü—Ä–æ–≤–µ—Ä—è—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 –ø–µ—Ä–∏–æ–¥–æ–≤
```

**–§–∞–π–ª:** `src/strategies/scalping/futures/filters/momentum_filter.py` (—Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π)  
**–°–æ–∑–¥–∞—Ç—å –∫–ª–∞—Å—Å:**
```python
class MomentumFilter:
    """
    –§–∏–ª—å—Ç—Ä –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤ Momentum Trading –∏–∑ —Å—Ç–∞—Ç—å–∏.
    
    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç:
    - –û—Ç–∫–ª–æ–Ω—è–µ—Ç –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ —Å–∫–∞—á–∫–∏ (vertical spikes)
    - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –º–µ–¥–ª–µ–Ω–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ –∫ —É—Ä–æ–≤–Ω—é (grind into level)
    - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π —Ä–æ—Å—Ç –æ–±—ä–µ–º–∞
    - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ª–µ—Å—Ç–Ω–∏—á–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ (staircase action)
    """
    
    async def check_momentum_criteria(
        self, 
        symbol: str, 
        candles: List[OHLCV], 
        current_price: float,
        level: Optional[float] = None
    ) -> Tuple[bool, str]:
        """
        –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫—Ä–∏—Ç–µ—Ä–∏–∏ –∏–º–ø—É–ª—å—Å–Ω–æ–π —Å–¥–µ–ª–∫–∏ –∏–∑ —Å—Ç–∞—Ç—å–∏.
        
        Returns:
            (is_valid, reason) - True –µ—Å–ª–∏ –≤—Å–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã
        """
        if not self.config.get("enabled", True):
            return True, "Momentum filter disabled"
        
        # 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã—Ö —Å–∫–∞—á–∫–æ–≤
        if self.config.get("reject_vertical_spikes", True):
            if self._has_vertical_spike(candles, current_price):
                return False, "Vertical spike detected - reject signal"
        
        # 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –¥–≤–∏–∂–µ–Ω–∏—è –∫ —É—Ä–æ–≤–Ω—é
        if level is not None:
            if not self._check_grind_into_level(candles, level):
                return False, "Fast movement to level - not a grind"
        
        # 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ —Ä–æ—Å—Ç–∞ –æ–±—ä–µ–º–∞
        if not self._check_volume_increasing(candles):
            return False, "Volume not consistently increasing"
        
        # 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–µ—Å—Ç–Ω–∏—á–Ω–æ–≥–æ –¥–≤–∏–∂–µ–Ω–∏—è
        if not self._check_staircase_action(candles):
            return False, "No staircase pattern detected"
        
        return True, "All momentum criteria met"
    
    def _has_vertical_spike(self, candles: List[OHLCV], current_price: float) -> bool:
        """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–≥–æ —Å–∫–∞—á–∫–∞."""
        max_spike = self.config.get("max_spike_percent", 1.0) / 100.0
        lookback = self.config.get("spike_lookback_periods", 5)
        
        if len(candles) < lookback:
            return False
        
        recent_candles = candles[-lookback:]
        for candle in recent_candles:
            body_size = abs(candle.close - candle.open) / candle.open
            if body_size > max_spike:
                return True  # –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π —Å–∫–∞—á–æ–∫ –æ–±–Ω–∞—Ä—É–∂–µ–Ω
        
        return False
```

**–§–∞–π–ª:** `src/strategies/scalping/futures/signal_generator.py`  
**–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É:**
```python
# –ü–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–∏–≥–Ω–∞–ª–∞, –ø–µ—Ä–µ–¥ –≤–æ–∑–≤—Ä–∞—Ç–æ–º
if self.momentum_filter:
    is_valid, reason = await self.momentum_filter.check_momentum_criteria(
        symbol=symbol,
        candles=candles,
        current_price=current_price,
        level=pivot_level
    )
    if not is_valid:
        logger.debug(f"‚ö†Ô∏è Momentum filter rejected signal for {symbol}: {reason}")
        return []  # –û—Ç–∫–ª–æ–Ω—è–µ–º —Å–∏–≥–Ω–∞–ª
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –û—Ç–∫–ª–æ–Ω—è–µ—Ç —Å–∏–≥–Ω–∞–ª—ã —Å –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–º–∏ —Å–∫–∞—á–∫–∞–º–∏
- ‚úÖ –£–º–µ–Ω—å—à–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–æ–∂–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤

---

#### 1.3.2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ —Ä–æ—Å—Ç–∞ –æ–±—ä–µ–º–∞

**–§–∞–π–ª:** `src/strategies/scalping/futures/filters/momentum_filter.py`  
**–î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥:**
```python
def _check_volume_increasing(self, candles: List[OHLCV]) -> bool:
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –æ–±—ä–µ–º –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è."""
    lookback_periods = self.config.get("volume_increase_periods", 10)
    
    if len(candles) < lookback_periods:
        return False  # –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö
    
    volumes = [c.volume for c in candles[-lookback_periods:]]
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç—Ä–µ–Ω–¥ –æ–±—ä–µ–º–∞ (–æ–±—ä–µ–º –¥–æ–ª–∂–µ–Ω —Ä–∞—Å—Ç–∏)
    increasing_count = 0
    for i in range(1, len(volumes)):
        if volumes[i] > volumes[i-1]:
            increasing_count += 1
    
    # –û–±—ä–µ–º –¥–æ–ª–∂–µ–Ω —Ä–∞—Å—Ç–∏ –º–∏–Ω–∏–º—É–º –≤ 60% –ø–µ—Ä–∏–æ–¥–æ–≤
    min_increasing_ratio = 0.6
    increasing_ratio = increasing_count / (len(volumes) - 1)
    
    return increasing_ratio >= min_increasing_ratio
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –æ–±—ä–µ–º –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ä–∞—Å—Ç–µ—Ç (–Ω–µ –ø—Ä–æ—Å—Ç–æ –≤—ã—Å–æ–∫–∏–π)
- ‚úÖ –£–ª—É—á—à–∞–µ—Ç –∫–∞—á–µ—Å—Ç–≤–æ —Å–∏–≥–Ω–∞–ª–æ–≤

---

#### 1.3.3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–µ—Å—Ç–Ω–∏—á–Ω–æ–≥–æ –¥–≤–∏–∂–µ–Ω–∏—è

**–§–∞–π–ª:** `src/strategies/scalping/futures/filters/momentum_filter.py`  
**–î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥:**
```python
def _check_staircase_action(self, candles: List[OHLCV]) -> bool:
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –ª–µ—Å—Ç–Ω–∏—á–Ω–æ–≥–æ –¥–≤–∏–∂–µ–Ω–∏—è (staircase pattern)."""
    min_duration_hours = self.config.get("min_staircase_duration_hours", 2)
    min_candles = int(min_duration_hours * 60)  # –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º 1-–º–∏–Ω—É—Ç–Ω—ã–µ —Å–≤–µ—á–∏
    
    if len(candles) < min_candles:
        return False  # –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö
    
    recent_candles = candles[-min_candles:]
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–∞ "–ª–µ—Å—Ç–Ω–∏—Ü—ã":
    # - –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã–µ –ø–æ–≤—ã—à–µ–Ω–∏—è —Å –æ—Ç–∫–∞—Ç–∞–º–∏
    # - –ë–æ–ª—å—à–µ –ø–æ–≤—ã—à–µ–Ω–∏–π, —á–µ–º –ø–∞–¥–µ–Ω–∏–π
    higher_closes = 0
    lower_closes = 0
    
    for i in range(1, len(recent_candles)):
        if recent_candles[i].close > recent_candles[i-1].close:
            higher_closes += 1
        elif recent_candles[i].close < recent_candles[i-1].close:
            lower_closes += 1
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ –ø–æ–≤—ã—à–µ–Ω–∏–π –∫ –ø–∞–¥–µ–Ω–∏—è–º
    if higher_closes == 0:
        return False
    
    ratio = higher_closes / (higher_closes + lower_closes)
    min_ratio = 0.6  # –ú–∏–Ω–∏–º—É–º 60% —Å–≤–µ—á–µ–π –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–æ–≤—ã—à–∞—é—â–∏–º–∏—Å—è
    
    return ratio >= min_ratio
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ —Ç—Ä–µ–Ω–¥–∞ –º–∏–Ω–∏–º—É–º 2 —á–∞—Å–∞
- ‚úÖ –û—Ç–∫–ª–æ–Ω—è–µ—Ç —Å–∏–≥–Ω–∞–ª—ã –±–µ–∑ —á–µ—Ç–∫–æ–≥–æ —Ç—Ä–µ–Ω–¥–∞

---

### 1.4. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–¥–ª–µ–Ω–∏–µ TP –≤ —Ç—Ä–µ–Ω–¥–µ

**–§–∞–π–ª:** `config/config_futures.yaml`  
**–î–æ–±–∞–≤–∏—Ç—å:**
```yaml
position_manager:
  tp_extension:
    enabled: true
    min_trend_strength: 0.7  # –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å–∏–ª–∞ —Ç—Ä–µ–Ω–¥–∞ –¥–ª—è –ø—Ä–æ–¥–ª–µ–Ω–∏—è
    extension_step: 0.5  # –®–∞–≥ –ø—Ä–æ–¥–ª–µ–Ω–∏—è TP (0.5%)
    max_tp_percent: 5.0  # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π TP (5%)
    use_indicators: true  # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Ç—Ä–µ–Ω–¥–∞
```

**–§–∞–π–ª:** `src/strategies/scalping/futures/position_manager.py`  
**–î–æ–±–∞–≤–∏—Ç—å –≤ –º–µ—Ç–æ–¥ `_check_tp_only`:**
```python
# –ü–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º –ø–æ TP, –ø—Ä–æ–≤–µ—Ä—è–µ–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–æ–¥–ª–µ–Ω–∏—è
tp_extension_config = getattr(self.scalping_config, "position_manager", {}).get("tp_extension", {})
if tp_extension_config.get("enabled", False):
    trend_strength = self._get_trend_strength(symbol, current_price)
    min_trend_strength = tp_extension_config.get("min_trend_strength", 0.7)
    
    if trend_strength >= min_trend_strength and pnl_percent > 0:
        # –ü—Ä–æ–¥–ª–µ–≤–∞–µ–º TP –≤–º–µ—Å—Ç–æ –∑–∞–∫—Ä—ã—Ç–∏—è
        current_tp = tp_percent
        extension_step = tp_extension_config.get("extension_step", 0.5)
        max_tp = tp_extension_config.get("max_tp_percent", 5.0)
        
        new_tp = min(current_tp + extension_step, max_tp)
        
        logger.info(
            f"üìà –ü—Ä–æ–¥–ª–µ–Ω–∏–µ TP –¥–ª—è {symbol}: {current_tp:.2f}% ‚Üí {new_tp:.2f}% "
            f"(—Ç—Ä–µ–Ω–¥: {trend_strength:.2f})"
        )
        
        # –û–±–Ω–æ–≤–ª—è–µ–º TP –≤ –ø–æ–∑–∏—Ü–∏–∏ (–≤–º–µ—Å—Ç–æ –∑–∞–∫—Ä—ã—Ç–∏—è)
        # TODO: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ TP –Ω–∞ –±–∏—Ä–∂–µ
        return  # –ù–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º, –∞ –ø—Ä–æ–¥–ª–µ–≤–∞–µ–º TP
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ü—Ä–æ–¥–ª–µ–≤–∞–µ—Ç TP –≤ —Å–∏–ª—å–Ω–æ–º —Ç—Ä–µ–Ω–¥–µ –≤–º–µ—Å—Ç–æ –∑–∞–∫—Ä—ã—Ç–∏—è
- ‚úÖ –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Å—Ä–µ–¥–Ω–∏–π PnL

---

## üìã –ü–†–ò–û–†–ò–¢–ï–¢ 2: –í–ê–ñ–ù–û (–ë–õ–ò–ñ–ê–ô–®–ï–ï –í–†–ï–ú–Ø)

### 2.1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–π

**–§–∞–π–ª:** `config/config_futures.yaml`  
**–î–æ–±–∞–≤–∏—Ç—å:**
```yaml
position_manager:
  reversal_detection:
    enabled: true
    min_reversal_duration_seconds: 60  # –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ—Ç—Å–∫–æ–∫–∞
    rsi_check: true
    macd_check: true
    bollinger_check: true
```

**–§–∞–π–ª:** `src/strategies/scalping/futures/orchestrator.py`  
**–î–æ–±–∞–≤–∏—Ç—å –≤ –º–µ—Ç–æ–¥ `_update_trailing_stop_loss`:**
```python
# –ü–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º –ø–æ Trailing Stop, –ø—Ä–æ–≤–µ—Ä—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã
reversal_config = getattr(self.scalping_config, "position_manager", {}).get("reversal_detection", {})
if reversal_config.get("enabled", False):
    # –ü–æ–ª—É—á–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã
    indicators = await self._get_indicators_for_symbol(symbol)
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º RSI
    if reversal_config.get("rsi_check", True):
        rsi = indicators.get("rsi")
        if position_side == "long" and rsi < 30:
            # RSI –ø–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω - –≤–æ–∑–º–æ–∂–µ–Ω —Ä–∞–∑–≤–æ—Ä–æ—Ç –≤–≤–µ—Ä—Ö (–ù–ï –∑–∞–∫—Ä—ã–≤–∞—Ç—å LONG)
            logger.debug(f"üìä RSI –ø–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω ({rsi:.1f}) - –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º LONG –ø–æ–∑–∏—Ü–∏—é")
            return  # –ù–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º
        
        if position_side == "short" and rsi > 70:
            # RSI –ø–µ—Ä–µ–∫—É–ø–ª–µ–Ω - –≤–æ–∑–º–æ–∂–µ–Ω —Ä–∞–∑–≤–æ—Ä–æ—Ç –≤–Ω–∏–∑ (–ù–ï –∑–∞–∫—Ä—ã–≤–∞—Ç—å SHORT)
            logger.debug(f"üìä RSI –ø–µ—Ä–µ–∫—É–ø–ª–µ–Ω ({rsi:.1f}) - –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º SHORT –ø–æ–∑–∏—Ü–∏—é")
            return  # –ù–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º MACD
    if reversal_config.get("macd_check", True):
        macd_line = indicators.get("macd_line")
        macd_signal = indicators.get("macd_signal")
        
        if position_side == "long" and macd_line > macd_signal:
            # MACD –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —Ç—Ä–µ–Ω–¥–∞ –≤–≤–µ—Ä—Ö (–ù–ï –∑–∞–∫—Ä—ã–≤–∞—Ç—å LONG)
            logger.debug(f"üìä MACD –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —Ç—Ä–µ–Ω–¥–∞ - –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º LONG")
            return  # –ù–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º Bollinger Bands
    if reversal_config.get("bollinger_check", True):
        bb_upper = indicators.get("bb_upper")
        bb_lower = indicators.get("bb_lower")
        
        if position_side == "long" and current_price < bb_lower * 1.01:
            # –¶–µ–Ω–∞ –±–ª–∏–∑–∫–æ –∫ –Ω–∏–∂–Ω–µ–π –ø–æ–ª–æ—Å–µ - –≤–æ–∑–º–æ–∂–µ–Ω –æ—Ç—Å–∫–æ–∫ (–ù–ï –∑–∞–∫—Ä—ã–≤–∞—Ç—å LONG)
            logger.debug(f"üìä –¶–µ–Ω–∞ –±–ª–∏–∑–∫–æ –∫ –Ω–∏–∂–Ω–µ–π –ø–æ–ª–æ—Å–µ BB - –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º LONG")
            return  # –ù–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ù–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –ø–æ–∑–∏—Ü–∏–∏, –µ—Å–ª–∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —Ç—Ä–µ–Ω–¥–∞
- ‚úÖ –£–º–µ–Ω—å—à–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫—Ä—ã—Ç–∏–π —Å –º–µ–Ω—å—à–µ–π –ø—Ä–∏–±—ã–ª—å—é

---

### 2.2. –£–ª—É—á—à–∏—Ç—å —Ä–∞—Å—á–µ—Ç —Ç—Ä–µ–π–ª–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∏–±—ã–ª–∏

**–§–∞–π–ª:** `config/config_futures.yaml`  
**–î–æ–±–∞–≤–∏—Ç—å:**
```yaml
trailing_sl:
  trail_growth:
    low_profit_multiplier: 1.5  # –î–ª—è –ø—Ä–∏–±—ã–ª–∏ < 0.5%
    medium_profit_multiplier: 2.0  # –î–ª—è –ø—Ä–∏–±—ã–ª–∏ 0.5-1.5%
    high_profit_multiplier: 3.0  # –î–ª—è –ø—Ä–∏–±—ã–ª–∏ > 1.5%
```

**–§–∞–π–ª:** `src/strategies/scalping/futures/indicators/trailing_stop_loss.py`  
**–ò–∑–º–µ–Ω–∏—Ç—å –º–µ—Ç–æ–¥ `update`:**
```python
# ‚ùå –ë–´–õ–û:
self.current_trail = min(
    self.initial_trail + max(profit_pct_total, 0.0) * 2, 
    self.max_trail
)

# ‚úÖ –°–¢–ê–õ–û:
trail_growth_config = getattr(self, "trail_growth", {})
if profit_pct_total < 0.005:  # < 0.5%
    multiplier = trail_growth_config.get("low_profit_multiplier", 1.5)
elif profit_pct_total < 0.015:  # 0.5-1.5%
    multiplier = trail_growth_config.get("medium_profit_multiplier", 2.0)
else:  # > 1.5%
    multiplier = trail_growth_config.get("high_profit_multiplier", 3.0)

self.current_trail = min(
    self.initial_trail + max(profit_pct_total, 0.0) * multiplier,
    self.max_trail
)
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –¢—Ä–µ–π–ª —Ä–∞—Å—Ç–µ—Ç –±—ã—Å—Ç—Ä–µ–µ –ø—Ä–∏ –±–æ–ª—å—à–æ–π –ø—Ä–∏–±—ã–ª–∏
- ‚úÖ –ë–æ–ª—å—à–µ –∑–∞—â–∏—Ç—ã –ø—Ä–∏–±—ã–ª–∏ –≤ —Å–∏–ª—å–Ω–æ–º —Ç—Ä–µ–Ω–¥–µ

---

### 2.3. –î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä —Ä–∞–∑–≤–æ—Ä–æ—Ç–∞

**–§–∞–π–ª:** `config/config_futures.yaml`  
**–î–æ–±–∞–≤–∏—Ç—å:**
```yaml
momentum_filter:
  reversal_filter:
    enabled: true
    min_reversal_duration_seconds: 60  # –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Ä–∞–∑–≤–æ—Ä–æ—Ç–∞
    price_velocity_threshold: 0.3  # –ü–æ—Ä–æ–≥ —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ü–µ–Ω—ã (%)
```

**–§–∞–π–ª:** `src/strategies/scalping/futures/filters/momentum_filter.py`  
**–î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥:**
```python
def _check_reversal_filter(self, candles: List[OHLCV], current_price: float) -> bool:
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ñ–∏–ª—å—Ç—Ä —Ä–∞–∑–≤–æ—Ä–æ—Ç–∞."""
    reversal_config = self.config.get("reversal_filter", {})
    if not reversal_config.get("enabled", False):
        return True  # –§–∏–ª—å—Ç—Ä –æ—Ç–∫–ª—é—á–µ–Ω
    
    min_duration = reversal_config.get("min_reversal_duration_seconds", 60)
    velocity_threshold = reversal_config.get("price_velocity_threshold", 0.3) / 100.0
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–∫–æ—Ä–æ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ü–µ–Ω—ã
    if len(candles) < 2:
        return True
    
    price_change = abs(current_price - candles[-2].close) / candles[-2].close
    
    # –ï—Å–ª–∏ —Å–∫–æ—Ä–æ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–ª–∏—à–∫–æ–º –≤—ã—Å–æ–∫–∞—è - –≤–æ–∑–º–æ–∂–µ–Ω —Ä–∞–∑–≤–æ—Ä–æ—Ç
    if price_change > velocity_threshold:
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ä–∞–∑–≤–æ—Ä–æ—Ç–∞
        # TODO: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
        return True
    
    return True
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤—ã–≤–∞–µ—Ç –±—ã—Å—Ç—Ä—ã–µ —Ä–∞–∑–≤–æ—Ä–æ—Ç—ã
- ‚úÖ –û—Å—Ç–∞–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã

---

### 2.4. –£–ª—É—á—à–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É "–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –¥–≤–∏–∂–µ–Ω–∏—è –∫ —É—Ä–æ–≤–Ω—é"

**–§–∞–π–ª:** `src/strategies/scalping/futures/filters/momentum_filter.py`  
**–î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥:**
```python
def _check_grind_into_level(self, candles: List[OHLCV], level: float) -> bool:
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ —Ü–µ–Ω–∞ –º–µ–¥–ª–µ–Ω–Ω–æ –ø—Ä–∏–±–ª–∏–∂–∞–µ—Ç—Å—è –∫ —É—Ä–æ–≤–Ω—é (–Ω–µ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π —Å–∫–∞—á–æ–∫)."""
    lookback_periods = self.config.get("grind_lookback_periods", 20)
    
    if len(candles) < lookback_periods:
        return False  # –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö
    
    recent_candles = candles[-lookback_periods:]
    
    # –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å–∫–æ—Ä–æ—Å—Ç—å –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏—è –∫ —É—Ä–æ–≤–Ω—é
    distances = []
    for candle in recent_candles:
        distance = abs(candle.close - level) / level
        distances.append(distance)
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ (–Ω–µ —Ä–µ–∑–∫–æ)
    # –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –≤–∞—Ä–∏–∞—Ü–∏–∏ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–π –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ —Å–ª–∏—à–∫–æ–º –≤—ã—Å–æ–∫–∏–º
    if len(distances) < 3:
        return False
    
    avg_distance = sum(distances) / len(distances)
    variance = sum((d - avg_distance) ** 2 for d in distances) / len(distances)
    std_dev = variance ** 0.5
    cv = std_dev / avg_distance if avg_distance > 0 else 0
    
    # –ï—Å–ª–∏ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –≤–∞—Ä–∏–∞—Ü–∏–∏ —Å–ª–∏—à–∫–æ–º –≤—ã—Å–æ–∫–∏–π - —ç—Ç–æ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π —Å–∫–∞—á–æ–∫
    max_cv = 0.5  # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –≤–∞—Ä–∏–∞—Ü–∏–∏
    return cv <= max_cv
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –û—Ç–∫–ª–æ–Ω—è–µ—Ç —Å–∏–≥–Ω–∞–ª—ã —Å —Ä–µ–∑–∫–∏–º –¥–≤–∏–∂–µ–Ω–∏–µ–º –∫ —É—Ä–æ–≤–Ω—é
- ‚úÖ –û—Å—Ç–∞–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ "–º–µ–¥–ª–µ–Ω–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ" (grind)

---

## üìä –ò–¢–û–ì–û–í–´–ô –°–ü–ò–°–û–ö –ò–ó–ú–ï–ù–ï–ù–ò–ô

### ‚úÖ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –ö—Ä–∏—Ç–∏—á–Ω–æ (–Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ)

1. ‚úÖ –í—ã–Ω–µ—Å—Ç–∏ `commission_rate` –≤ –∫–æ–Ω—Ñ–∏–≥
2. ‚úÖ –í—ã–Ω–µ—Å—Ç–∏ `buffer_pct` –≤ –∫–æ–Ω—Ñ–∏–≥
3. ‚úÖ –í—ã–Ω–µ—Å—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –º–∞—Ä–∂–∏ –≤ –∫–æ–Ω—Ñ–∏–≥
4. ‚úÖ –í—ã–Ω–µ—Å—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞—â–∏—Ç—ã –æ—Ç –ª–æ–∂–Ω—ã—Ö —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π –≤ –∫–æ–Ω—Ñ–∏–≥
5. ‚úÖ –£–≤–µ–ª–∏—á–∏—Ç—å `max_trail` —Å 1% –¥–æ 2% (–¥–ª—è —Å–∫–∞–ª—å–ø–∏–Ω–≥–∞)
6. ‚úÖ –†–∞—Å—à–∏—Ä–∏—Ç—å –∞–¥–∞–ø—Ç–∏–≤–Ω—É—é –ª–æ–≥–∏–∫—É –¥–ª—è ranging —Ä–µ–∂–∏–º–∞
7. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –∑–∞—â–∏—Ç—É –æ—Ç –∫—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã—Ö –æ—Ç—Å–∫–æ–∫–æ–≤
8. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã—Ö —Å–∫–∞—á–∫–æ–≤ (Momentum Trading)
9. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ —Ä–æ—Å—Ç–∞ –æ–±—ä–µ–º–∞ (Momentum Trading)
10. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ª–µ—Å—Ç–Ω–∏—á–Ω–æ–≥–æ –¥–≤–∏–∂–µ–Ω–∏—è (Momentum Trading)
11. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–¥–ª–µ–Ω–∏–µ TP –≤ —Ç—Ä–µ–Ω–¥–µ

---

### ‚úÖ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –í–∞–∂–Ω–æ (–±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è)

1. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–π
2. ‚úÖ –£–ª—É—á—à–∏—Ç—å —Ä–∞—Å—á–µ—Ç —Ç—Ä–µ–π–ª–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∏–±—ã–ª–∏
3. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä —Ä–∞–∑–≤–æ—Ä–æ—Ç–∞
4. ‚úÖ –£–ª—É—á—à–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É "–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –¥–≤–∏–∂–µ–Ω–∏—è –∫ —É—Ä–æ–≤–Ω—é"

---

## üìà –û–ñ–ò–î–ê–ï–ú–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´

### –ü–æ—Å–ª–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ 1:

1. **–£–º–µ–Ω—å—à–µ–Ω–∏–µ –ª–æ–∂–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤:**
   - –¢–µ–∫—É—â–∏–π: ~30-40%
   - –û–∂–∏–¥–∞–µ–º—ã–π: ~15-20% (—É–ª—É—á—à–µ–Ω–∏–µ –Ω–∞ 50%)

2. **–£–ª—É—á—à–µ–Ω–∏–µ Win Rate:**
   - –¢–µ–∫—É—â–∏–π: ~55-60%
   - –û–∂–∏–¥–∞–µ–º—ã–π: ~65-70% (—É–ª—É—á—à–µ–Ω–∏–µ –Ω–∞ 10-15%)

3. **–£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å—Ä–µ–¥–Ω–µ–≥–æ PnL:**
   - –¢–µ–∫—É—â–∏–π: ~+0.1-0.3 USDT
   - –û–∂–∏–¥–∞–µ–º—ã–π: ~+0.3-0.5 USDT (—É–ª—É—á—à–µ–Ω–∏–µ –Ω–∞ 100%)

4. **–£–º–µ–Ω—å—à–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–∏–π —Å –º–µ–Ω—å—à–µ–π –ø—Ä–∏–±—ã–ª—å—é:**
   - –¢–µ–∫—É—â–∏–π: ~30-40% –ø–æ–∑–∏—Ü–∏–π –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è —Å –º–µ–Ω—å—à–µ–π –ø—Ä–∏–±—ã–ª—å—é
   - –û–∂–∏–¥–∞–µ–º—ã–π: ~15-20% (—É–ª—É—á—à–µ–Ω–∏–µ –Ω–∞ 50%)

---

### –ü–æ—Å–ª–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ 2:

1. **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ Win Rate:**
   - –û–∂–∏–¥–∞–µ–º—ã–π: ~70-75% (—É–ª—É—á—à–µ–Ω–∏–µ –µ—â–µ –Ω–∞ 5-10%)

2. **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å—Ä–µ–¥–Ω–µ–≥–æ PnL:**
   - –û–∂–∏–¥–∞–µ–º—ã–π: ~+0.5-0.8 USDT (—É–ª—É—á—à–µ–Ω–∏–µ –µ—â–µ –Ω–∞ 50-100%)

3. **–£–ª—É—á—à–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ —Å–∏–≥–Ω–∞–ª–æ–≤:**
   - –ë–æ–ª–µ–µ —Ç–æ—á–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —É—Å–ª–æ–≤–∏–π –¥–ª—è –∏–º–ø—É–ª—å—Å–Ω—ã—Ö —Å–¥–µ–ª–æ–∫
   - –ú–µ–Ω—å—à–µ –ª–æ–∂–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤

---

## üéØ –ü–õ–ê–ù –†–ï–ê–õ–ò–ó–ê–¶–ò–ò

### –ù–µ–¥–µ–ª—è 1: –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1.1-1.3 (–ó–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã + Trailing Stop)

**–î–µ–Ω—å 1-2:**
- –í—ã–Ω–µ—Å—Ç–∏ –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ –∫–æ–Ω—Ñ–∏–≥ (1.1.1-1.1.3)

**–î–µ–Ω—å 3-4:**
- –£–ª—É—á—à–∏—Ç—å Trailing Stop Loss (1.2.1-1.2.3)

**–î–µ–Ω—å 5:**
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

---

### –ù–µ–¥–µ–ª—è 2: –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1.4 (Momentum Filter)

**–î–µ–Ω—å 1-3:**
- –°–æ–∑–¥–∞—Ç—å MomentumFilter (1.3.1-1.3.3)

**–î–µ–Ω—å 4:**
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å MomentumFilter –≤ SignalGenerator

**–î–µ–Ω—å 5:**
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ MomentumFilter

---

### –ù–µ–¥–µ–ª—è 3: –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1.5 + –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2

**–î–µ–Ω—å 1-2:**
- –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–¥–ª–µ–Ω–∏–µ TP –≤ —Ç—Ä–µ–Ω–¥–µ (1.4)

**–î–µ–Ω—å 3-4:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–π (2.1)

**–î–µ–Ω—å 5:**
- –£–ª—É—á—à–∏—Ç—å —Ä–∞—Å—á–µ—Ç —Ç—Ä–µ–π–ª–∞ (2.2)
- –î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä —Ä–∞–∑–≤–æ—Ä–æ—Ç–∞ (2.3-2.4)

---

### –ù–µ–¥–µ–ª—è 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

**–î–µ–Ω—å 1-3:**
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–∞ –¥–µ–º–æ-—Å—á–µ—Ç–µ

**–î–µ–Ω—å 4-5:**
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-11-14  
**–í–µ—Ä—Å–∏—è:** 1.0  
**–ê–≤—Ç–æ—Ä:** AI Assistant
