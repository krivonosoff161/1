# üîç –ê–ù–ê–õ–ò–ó –ö–†–ò–¢–ò–ß–ï–°–ö–ò–• –ü–†–û–ë–õ–ï–ú –û–¢ –ì–†–û–ö–ê (2025-12-21)

## üéØ –û–ë–ó–û–†

Grok –≤—ã—è–≤–∏–ª –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –±–∞–≥–æ–≤ –∏ –ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º –≤ —Ä–∏—Å–∫-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç–µ/–≤—ã—Ö–æ–¥–∞—Ö –∏–∑ –ø–æ–∑–∏—Ü–∏–π. –ù–∏–∂–µ –¥–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∫–∞–∂–¥–æ–π –ø—Ä–æ–±–ª–µ–º—ã —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ –º–µ—Å—Ç–∞–º–∏ –≤ –∫–æ–¥–µ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é.

---

## ‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –û–®–ò–ë–ö–ò –í –ö–û–î–ï

### 1. ‚ùå –ö–†–ò–¢–ò–ß–ù–û: –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–π —Å–ø–∞–º –æ—à–∏–±–∫–∏ `datetime` –≤ TradingControlCenter

**–ü—Ä–æ–±–ª–µ–º–∞:**
```
TCC cannot access local variable datetime where it is not associated with a value
```

**–õ–æ–∫–∞—Ü–∏—è:** `src/strategies/scalping/futures/core/trading_control_center.py`

**–ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞:**
- `datetime` –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω: `from datetime import datetime` (—Å—Ç—Ä–æ–∫–∞ 18)
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Å—Ç—Ä–æ–∫–∞—Ö: 463, 477, 556
- –ü—Ä–æ–±–ª–µ–º–∞: –í–æ–∑–º–æ–∂–Ω–æ, –ª–æ–∫–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `datetime` –≥–¥–µ-—Ç–æ –ø–µ—Ä–µ–∫—Ä—ã–≤–∞–µ—Ç –∏–º–ø–æ—Ä—Ç, –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–æ –ø—Ä–∏—Å–≤–∞–∏–≤–∞–Ω–∏—è

**–ù–∞–π–¥–µ–Ω–Ω—ã–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
```python
# –°—Ç—Ä–æ–∫–∞ 463
entry_time_from_api = datetime.fromtimestamp(entry_timestamp_sec)

# –°—Ç—Ä–æ–∫–∞ 477
or existing_metadata.entry_time == datetime.now()

# –°—Ç—Ä–æ–∫–∞ 556
else datetime.now()
```

**–ü—Ä–∏—á–∏–Ω–∞:**
- –í –±–ª–æ–∫–µ `try/except` –º–æ–∂–µ—Ç –±—ã—Ç—å –ª–æ–∫–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `datetime`, –∫–æ—Ç–æ—Ä–∞—è –ø–µ—Ä–µ–∫—Ä—ã–≤–∞–µ—Ç –∏–º–ø–æ—Ä—Ç
- –ò–ª–∏ `datetime` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ `except` –±–ª–æ–∫–µ, –≥–¥–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –µ—â–µ –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –∏–º–ø–æ—Ä—Ç: `from datetime import datetime as dt`
2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `dt.now()` –∏ `dt.fromtimestamp()` –≤–º–µ—Å—Ç–æ `datetime.now()` –∏ `datetime.fromtimestamp()`
3. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –Ω–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å –∏–º–µ–Ω–µ–º `datetime`

**–§–∞–π–ª –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** `src/strategies/scalping/futures/core/trading_control_center.py`

---

### 2. ‚ùå –ö–†–ò–¢–ò–ß–ù–û: –ú–∞—Å—Å–æ–≤—ã–µ –æ—à–∏–±–∫–∏ `str vs int` –≤ ExitAnalyzer –¥–ª—è RANGING

**–ü—Ä–æ–±–ª–µ–º–∞:**
```
ExitAnalyzer <symbol> RANGING not supported between instances of str and int
```

**–õ–æ–∫–∞—Ü–∏—è:** `src/strategies/scalping/futures/positions/exit_analyzer.py`, –º–µ—Ç–æ–¥ `_generate_exit_for_ranging`

**–ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞:**
- –ú–µ—Ç–æ–¥—ã `_get_tp_percent()` –∏ `_get_sl_percent()` –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç `float()`, –Ω–æ –º–æ–≥—É—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å —Å—Ç—Ä–æ–∫–∏ –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
- `config_manager.to_dict()` –º–æ–∂–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å —Å—Ç—Ä–æ–∫–∏ –≤–º–µ—Å—Ç–æ —á–∏—Å–µ–ª
- –°—Ä–∞–≤–Ω–µ–Ω–∏—è: `pnl_percent >= tp_percent`, `pnl_percent <= sl_threshold` –º–æ–≥—É—Ç —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å `float` —Å–æ `str`

**–ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ –º–µ—Å—Ç–∞:**

```python
# –°—Ç—Ä–æ–∫–∞ 1748: tp_percent –º–æ–∂–µ—Ç –±—ã—Ç—å —Å—Ç—Ä–æ–∫–æ–π
tp_percent = self._get_tp_percent(symbol, "ranging")
if pnl_percent >= tp_percent:  # ‚ùå str vs float

# –°—Ç—Ä–æ–∫–∞ 1702: sl_percent –º–æ–∂–µ—Ç –±—ã—Ç—å —Å—Ç—Ä–æ–∫–æ–π
sl_percent = self._get_sl_percent(symbol, "ranging")
if pnl_percent <= sl_threshold:  # ‚ùå str vs float

# –°—Ç—Ä–æ–∫–∞ 1769: big_profit_exit_percent –º–æ–∂–µ—Ç –±—ã—Ç—å —Å—Ç—Ä–æ–∫–æ–π
big_profit_exit_percent = self._get_big_profit_exit_percent(symbol)
if pnl_percent >= big_profit_exit_percent:  # ‚ùå str vs float

# –°—Ç—Ä–æ–∫–∞ 1804: trigger_percent –º–æ–∂–µ—Ç –±—ã—Ç—å —Å—Ç—Ä–æ–∫–æ–π
trigger_percent = partial_tp_params.get("trigger_percent", 0.6)
if pnl_percent >= trigger_percent:  # ‚ùå str vs float
```

**–ü—Ä–∏—á–∏–Ω–∞:**
- `config_manager.to_dict()` –º–æ–∂–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ YAML –∫–∞–∫ —Å—Ç—Ä–æ–∫–∏
- –ú–µ—Ç–æ–¥—ã `_get_tp_percent()`, `_get_sl_percent()` –∏—Å–ø–æ–ª—å–∑—É—é—Ç `float()`, –Ω–æ –µ—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ —É–∂–µ —Å—Ç—Ä–æ–∫–∞ –≤ –∫–æ–Ω—Ñ–∏–≥–µ, `float()` –º–æ–∂–µ—Ç –Ω–µ —Å—Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –í —Å—Ç—Ä–æ–∫–µ 610: `tp_percent = getattr(self.scalping_config, "tp_percent", 2.4)` - `getattr` –º–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å —Å—Ç—Ä–æ–∫—É

**–†–µ—à–µ–Ω–∏–µ:**
1. –í –º–µ—Ç–æ–¥–∞—Ö `_get_tp_percent()`, `_get_sl_percent()`, `_get_big_profit_exit_percent()` –¥–æ–±–∞–≤–∏—Ç—å —è–≤–Ω–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ:
   ```python
   value = regime_config.get("tp_percent")
   if value is not None:
       try:
           return float(value)  # ‚úÖ –Ø–≤–Ω–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ
       except (TypeError, ValueError):
           logger.warning(f"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å tp_percent={value} –≤ float")
           return 2.4  # Fallback
   ```

2. –í `_generate_exit_for_ranging` –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Ç–∏–ø–æ–≤ –ø–µ—Ä–µ–¥ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è–º–∏:
   ```python
   tp_percent = self._get_tp_percent(symbol, "ranging")
   if not isinstance(tp_percent, (int, float)):
       tp_percent = float(tp_percent)  # ‚úÖ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ
   ```

3. –í `config_manager.to_dict()` —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —á–∏—Å–ª–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø—Ä–µ–æ–±—Ä–∞–∑—É—é—Ç—Å—è –≤ `float`/`int`

**–§–∞–π–ª –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** `src/strategies/scalping/futures/positions/exit_analyzer.py`

---

## ‚ö†Ô∏è –õ–û–ì–ò–ö–ê –í–´–•–û–î–ê –ò–ó –ü–û–ó–ò–¶–ò–ô

### 3. ‚ö†Ô∏è Max Holding –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –∂–µ—Å—Ç–∫–∏–π —Å—Ç–æ–ø

**–ü—Ä–æ–±–ª–µ–º–∞:**
–î–ª—è BTC-–ª–æ–Ω–≥–∞ –ø–æ–∑–∏—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç–∞ 18:55:38, –∫ 22:28 —É–∂–µ –≤–∏—Å–∏—Ç 32.65 –º–∏–Ω—É—Ç –ø—Ä–∏ `max_holding_minutes=28.0`, –Ω–æ —Ä–µ—à–µ–Ω–∏–µ: `action=hold, reason=max_holding_exceeded_but_loss`.

**–õ–æ–∫–∞—Ü–∏—è:** `src/strategies/scalping/futures/positions/exit_analyzer.py`, –º–µ—Ç–æ–¥ `_generate_exit_for_ranging` (—Å—Ç—Ä–æ–∫–∏ 1962-1989)

**–ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞:**
```python
# –°—Ç—Ä–æ–∫–∞ 1964: –ï—Å–ª–∏ –ø–æ–∑–∏—Ü–∏—è –≤ —É–±—ã—Ç–∫–µ, –ù–ï –∑–∞–∫—Ä—ã–≤–∞–µ–º –ø–æ max_holding
if pnl_percent < 0:
    # ... —É–º–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —É–±—ã—Ç–æ–∫ >= 1.5 * SL
    logger.info(
        f"‚è∞ ExitAnalyzer RANGING: –í—Ä–µ–º—è {minutes_in_position:.1f} –º–∏–Ω >= {max_holding_minutes:.1f} –º–∏–Ω, "
        f"–Ω–æ –ø–æ–∑–∏—Ü–∏—è –≤ —É–±—ã—Ç–∫–µ ({pnl_percent:.2f}%) - –ù–ï –∑–∞–∫—Ä—ã–≤–∞–µ–º, –∂–¥–µ–º SL –∏–ª–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è"
    )
    return {
        "action": "hold",
        "reason": "max_holding_exceeded_but_loss",  # ‚ùå –ú—è–≥–∫–æ–µ —É—Å–ª–æ–≤–∏–µ
        ...
    }
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- Max Holding –ø–æ —Ñ–∞–∫—Ç—É –Ω–µ —Å—Ç–æ–ø, –∞ –º—è–≥–∫–æ–µ —É—Å–ª–æ–≤–∏–µ
- –ï—Å–ª–∏ PnL –≤ –º–∏–Ω—É—Å–µ, –±–æ—Ç —Å–æ–∑–Ω–∞—Ç–µ–ª—å–Ω–æ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ max holding
- –ü–æ–∑–∏—Ü–∏—è –º–æ–∂–µ—Ç –≤–∏—Å–µ—Ç—å –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ –¥–æ–ª–≥–æ, –ø–æ–∫–∞ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç SL

**–í–ª–∏—è–Ω–∏–µ:**
- –ü–æ–∑–∏—Ü–∏–∏ –≤–∏—Å—è—Ç –¥–æ–ª—å—à–µ, —á–µ–º –Ω—É–∂–Ω–æ
- –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è —Ä–∏—Å–∫ –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏
- –ù–∞—Ä—É—à–∞–µ—Ç—Å—è –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞ —Ç–æ—Ä–≥–æ–≤–ª–∏

**–†–µ—à–µ–Ω–∏–µ:**
1. **–í–∞—Ä–∏–∞–Ω—Ç –ê (–ñ–µ—Å—Ç–∫–∏–π —Å—Ç–æ–ø):** –°–¥–µ–ª–∞—Ç—å max holding –∂–µ—Å—Ç–∫–∏–º —Å—Ç–æ–ø–æ–º:
   ```python
   if minutes_in_position >= max_holding_minutes:
       # –ó–∞–∫—Ä—ã–≤–∞–µ–º –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç PnL (–∫—Ä–æ–º–µ —Å–ª—É—á–∞–µ–≤ –±–ª–∏–∑–æ—Å—Ç–∏ –∫ –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏)
       return {
           "action": "close",
           "reason": "max_holding_hard_stop",
           ...
       }
   ```

2. **–í–∞—Ä–∏–∞–Ω—Ç –ë (–ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ):** –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä –≤ –∫–æ–Ω—Ñ–∏–≥:
   ```yaml
   adaptive_regime:
     ranging:
       max_holding_minutes: 28.0
       max_holding_hard_stop: true  # ‚úÖ –ù–û–í–û–ï: –∂–µ—Å—Ç–∫–∏–π —Å—Ç–æ–ø
       # –∏–ª–∏
       max_holding_ignore_if_loss: true  # ‚úÖ –ù–û–í–û–ï: –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –µ—Å–ª–∏ –≤ —É–±—ã—Ç–∫–µ
   ```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –í–∞—Ä–∏–∞–Ω—Ç –ë - —Å–¥–µ–ª–∞—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º—ã–º, –Ω–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∂–µ—Å—Ç–∫–∏–π —Å—Ç–æ–ø.

**–§–∞–π–ª –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** `src/strategies/scalping/futures/positions/exit_analyzer.py`

---

### 4. ‚ö†Ô∏è `profit_too_low_vs_peak` –±–ª–æ–∫–∏—Ä—É–µ—Ç –≤—ã—Ö–æ–¥—ã

**–ü—Ä–æ–±–ª–µ–º–∞:**
–ü—Ä–∏ –Ω–µ–±–æ–ª—å—à–æ–π –ø—Ä–∏–±—ã–ª–∏ ExitAnalyzer –≤—Å—ë –≤—Ä–µ–º—è –¥–∞—ë—Ç `action=hold, reason=profit_too_low_vs_peak`, –ø–æ—Ç–æ–º—É —á—Ç–æ —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Ç–µ–∫—É—â–∏–π PnL —Å ¬´–ø–∏–∫–æ–≤—ã–º¬ª –∏ –Ω–µ –¥–∞—ë—Ç –≤—ã–π—Ç–∏, –ø–æ–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç –æ—Ç –ø–∏–∫–∞ –Ω–µ —Å—Ç–∞–Ω–µ—Ç –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–æ–ª—å—à–∏–º.

**–õ–æ–∫–∞—Ü–∏—è:** `src/strategies/scalping/futures/positions/exit_analyzer.py`, –º–µ—Ç–æ–¥ `_generate_exit_for_ranging` (—Å—Ç—Ä–æ–∫–∏ 1664-1699)

**–ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞:**
```python
# –°—Ç—Ä–æ–∫–∞ 1687: –ù–µ –∑–∞–∫—Ä—ã–≤–∞—Ç—å –µ—Å–ª–∏ —Ç–µ–∫—É—â–∞—è –ø—Ä–∏–±—ã–ª—å < 70% –æ—Ç peak
if pnl_percent < peak_profit_pct * 0.7:
    logger.info(
        f"üõ°Ô∏è ExitAnalyzer RANGING: –ù–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º {symbol} - "
        f"—Ç–µ–∫—É—â–∞—è –ø—Ä–∏–±—ã–ª—å {pnl_percent:.2f}% < 70% –æ—Ç peak {peak_profit_pct:.2f}%"
    )
    return {
        "action": "hold",
        "reason": "profit_too_low_vs_peak",  # ‚ùå –ë–ª–æ–∫–∏—Ä—É–µ—Ç –≤—ã—Ö–æ–¥
        ...
    }
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –í –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ —Å –≤—ã—Å–æ–∫–∏–º –∫–æ–º–∏—Å—Å–∏–æ–Ω–Ω—ã–º —à—É–º–æ–º (–∫–æ–≥–¥–∞ gross PnL –Ω–µ–±–æ–ª—å—à–æ–π, –∞ net –∑–∞ —Å—á—ë—Ç –∫–æ–º–∏—Å—Å–∏–∏ –ª–µ–≥–∫–æ —É—Ö–æ–¥–∏—Ç –≤ –º–∏–Ω—É—Å) —ç—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ —Ç–æ–º—É, —á—Ç–æ –ø–æ–∑–∏—Ü–∏—è –¥–æ–ª–≥–æ –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –Ω–∏ –ø–æ –ø—Ä–æ—Ñ–∏—Ç—É, –Ω–∏ –ø–æ max holding, –∞ —Ç–æ–ª—å–∫–æ –ø–æ SL/—Ç–∞–π–º–∞—É—Ç–∞–º
- –ü–æ–∑–∏—Ü–∏—è –º–æ–∂–µ—Ç –¥–æ—Å—Ç–∏—á—å –Ω–µ–±–æ–ª—å—à–æ–≥–æ –ø–∏–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, +0.5%), –∑–∞—Ç–µ–º –æ—Ç–∫–∞—Ç–∏—Ç—å—Å—è –¥–æ +0.2%, –∏ –±–æ—Ç –±—É–¥–µ—Ç –¥–µ—Ä–∂–∞—Ç—å, –æ–∂–∏–¥–∞—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫ –ø–∏–∫—É
- –ù–æ –∫–æ–º–∏—Å—Å–∏–∏ —Å—ä–µ–¥–∞—é—Ç –ø—Ä–∏–±—ã–ª—å, –∏ –ø–æ–∑–∏—Ü–∏—è —É—Ö–æ–¥–∏—Ç –≤ –º–∏–Ω—É—Å

**–í–ª–∏—è–Ω–∏–µ:**
- –ü–æ–∑–∏—Ü–∏–∏ –Ω–µ –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è –≤–æ–≤—Ä–µ–º—è
- –ö–æ–º–∏—Å—Å–∏–∏ —Å—ä–µ–¥–∞—é—Ç –º–∏–∫—Ä–æ–ø—Ä–∏–±—ã–ª—å
- –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–±—ã—Ç–æ—á–Ω—ã—Ö —Å–¥–µ–ª–æ–∫

**–†–µ—à–µ–Ω–∏–µ:**
1. **–í–∞—Ä–∏–∞–Ω—Ç –ê (–û—Ç–∫–ª—é—á–∏—Ç—å –¥–ª—è –º–∞–ª—ã—Ö –ø—Ä–∏–±—ã–ª–µ–π):** –ù–µ –ø—Ä–∏–º–µ–Ω—è—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É peak, –µ—Å–ª–∏ —Ç–µ–∫—É—â–∞—è –ø—Ä–∏–±—ã–ª—å < 0.5%:
   ```python
   if pnl_percent > 0.5 and peak_profit_pct > 0:  # ‚úÖ –¢–æ–ª—å–∫–æ –¥–ª—è –ø—Ä–∏–±—ã–ª–µ–π > 0.5%
       if pnl_percent < peak_profit_pct * 0.7:
           # –ë–ª–æ–∫–∏—Ä—É–µ–º –≤—ã—Ö–æ–¥
   ```

2. **–í–∞—Ä–∏–∞–Ω—Ç –ë (–£—á–∏—Ç—ã–≤–∞—Ç—å –∫–æ–º–∏—Å—Å–∏–∏):** –°—Ä–∞–≤–Ω–∏–≤–∞—Ç—å net PnL —Å peak, –∞ –Ω–µ gross:
   ```python
   # –£—á–∏—Ç—ã–≤–∞–µ–º –∫–æ–º–∏—Å—Å–∏–∏ –≤ peak_profit_pct
   net_peak_profit_pct = peak_profit_pct * 0.95  # –ú–∏–Ω—É—Å –∫–æ–º–∏—Å—Å–∏–∏
   if pnl_percent < net_peak_profit_pct * 0.7:
       # –ë–ª–æ–∫–∏—Ä—É–µ–º –≤—ã—Ö–æ–¥
   ```

3. **–í–∞—Ä–∏–∞–Ω—Ç –í (–ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º—ã–π –ø–æ—Ä–æ–≥):** –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä –≤ –∫–æ–Ω—Ñ–∏–≥:
   ```yaml
   adaptive_regime:
     ranging:
       peak_profit_check_enabled: true
       peak_profit_min_threshold: 0.5  # ‚úÖ –ù–µ –ø—Ä–∏–º–µ–Ω—è—Ç—å –¥–ª—è –ø—Ä–∏–±—ã–ª–µ–π < 0.5%
       peak_profit_ratio: 0.7  # ‚úÖ –¢–µ–∫—É—â–∏–π 70%
   ```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –í–∞—Ä–∏–∞–Ω—Ç –í - —Å–¥–µ–ª–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º—ã–º, –Ω–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ—Ç–∫–ª—é—á–∏—Ç—å –¥–ª—è –º–∞–ª—ã—Ö –ø—Ä–∏–±—ã–ª–µ–π (< 0.5%).

**–§–∞–π–ª –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** `src/strategies/scalping/futures/positions/exit_analyzer.py`

---

## ‚ö†Ô∏è –ú–ê–†–ñ–ò–ù–ê–õ–¨–ù–´–ï –†–ê–°–ß–ï–¢–´ –ò LIQUIDATIONGUARD

### 5. ‚ö†Ô∏è –ù–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å margin ratio —Ä–∞—Å—á–µ—Ç–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞:**
–í —Å–µ—Ä–µ–¥–∏–Ω–µ –¥–Ω—è –º–∞—Ä–∂–∏–Ω–∞–ª—å–Ω—ã–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –¥–∞—ë—Ç —Å—Ç—Ä–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:
- `margin_ratio=0.10, safe=False, margin_used=49.62, equity=24.99, available_margin=4.96`
- –ó–∞—Ç–µ–º –±—É–∫–≤–∞–ª—å–Ω–æ —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥: `margin_ratio=38.16, safe=True, equity=971.16, margin_used=24.81`

**–õ–æ–∫–∞—Ü–∏—è:** 
- `src/strategies/scalping/futures/calculations/margin_calculator.py`
- `src/strategies/modules/liquidation_guard.py`

**–ê–Ω–∞–ª–∏–∑:**
- –î–≤–µ —Ä–∞–∑–Ω—ã–µ –º–æ–¥–µ–ª–∏ ¬´equity/margin¬ª (–ø–æ –ø–æ–∑–∏—Ü–∏–∏ –∏ –ø–æ –ø—Ä–æ—Ñ–∏–ª—é) –±–æ—Ä—é—Ç—Å—è –¥—Ä—É–≥ —Å –¥—Ä—É–≥–æ–º
- –ü–µ—Ä–≤—ã–π —Ä–∞—Å—á–µ—Ç: `equity=24.99` (–≤–µ—Ä–æ—è—Ç–Ω–æ, –ø–æ –ø–æ–∑–∏—Ü–∏–∏)
- –í—Ç–æ—Ä–æ–π —Ä–∞—Å—á–µ—Ç: `equity=971.16` (–≤–µ—Ä–æ—è—Ç–Ω–æ, –ø–æ –ø—Ä–æ—Ñ–∏–ª—é/–±–∞–ª–∞–Ω—Å—É)

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ù–µ—è—Å–Ω–æ, –∫–∞–∫–∞—è –º–æ–¥–µ–ª—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –∫–∞–∫–æ–π –º–æ–º–µ–Ω—Ç
- –≠—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ —à—É–º—É –≤ –ª–æ–≥–∞—Ö –∏ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º —Ä–µ—à–µ–Ω–∏—è–º –æ–± –æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø–æ–∑–∏—Ü–∏–∏

**–†–µ—à–µ–Ω–∏–µ:**
1. **–ü—Ä–∏–≤–µ—Å—Ç–∏ –∫ –µ–¥–∏–Ω–æ–π –º–æ–¥–µ–ª–∏:** –†–µ—à–∏—Ç—å, —Å—á–∏—Ç–∞—é—Ç—Å—è –ª–∏ safety-–ø–æ—Ä–æ–≥–∏ –æ—Ç equity –ø–æ –ø—Ä–æ—Ñ–∏–ª—é –∏–ª–∏ –ø–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏, –∏ —É–±—Ä–∞—Ç—å –≤—Ç–æ—Ä–æ–π –≤–∞—Ä–∏–∞–Ω—Ç
2. **–î–ª—è –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –º–∞—Ä–∂–∏:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å equity –ø–æ –ø–æ–∑–∏—Ü–∏–∏ (–∏–∑ `get_margin_info`)
3. **–î–ª—è –∫—Ä–æ—Å—Å-–º–∞—Ä–∂–∏:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–±—â–∏–π –±–∞–ª–∞–Ω—Å
4. **–î–æ–±–∞–≤–∏—Ç—å —è–≤–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ö–∞–∫–æ–π equity –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è (–ø–æ –ø–æ–∑–∏—Ü–∏–∏ –∏–ª–∏ –ø–æ –ø—Ä–æ—Ñ–∏–ª—é)

**–§–∞–π–ª—ã –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- `src/strategies/scalping/futures/calculations/margin_calculator.py`
- `src/strategies/modules/liquidation_guard.py`

---

### 6. ‚ö†Ô∏è LiquidationGuard.handle_risk_level –ª–æ–≥–∏—Ä—É–µ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç

**–ü—Ä–æ–±–ª–µ–º–∞:**
LiquidationGuard.handlerisklevel –ª–æ–≥–∏—Ä—É–µ—Ç —á—Ç–æ-—Ç–æ –≤—Ä–æ–¥–µ: `marginratio0.10 ... equity24.99. ?, .` ‚Äî –≤–º–µ—Å—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–≥–æ —Å—Ç–∞—Ç—É—Å–∞ —Ä–∏—Å–∫–∞.

**–õ–æ–∫–∞—Ü–∏—è:** `src/strategies/modules/liquidation_guard.py`, –º–µ—Ç–æ–¥ `_handle_risk_level`

**–ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞:**
- –ú–µ—Ç–æ–¥ `_handle_risk_level` –ª–æ–≥–∏—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è, –Ω–æ —Ñ–æ—Ä–º–∞—Ç—Ç–µ—Ä —Å—Ç–∞—Ç—É—Å–∞ —Ä–∏—Å–∫–∞ –Ω–µ –¥–æ–¥–µ–ª–∞–Ω
- –í —Å—Ç—Ä–æ–∫–∞—Ö 275, 289, 348 –µ—Å—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, –Ω–æ –Ω–µ—Ç —è–≤–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –§–æ—Ä–º–∞—Ç—Ç–µ—Ä —Å—Ç–∞—Ç—É—Å–∞ —Ä–∏—Å–∫–∞ –Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω –Ω–æ—Ä–º–∞–ª—å–Ω—ã–º–∏ —Ç–µ–∫—Å—Ç–∞–º–∏ (excellent/good/warning/danger)
- –ò–∑-–∑–∞ —ç—Ç–æ–≥–æ –≤ –ª–æ–≥–∞—Ö —à—É–º –∏ –Ω–µ–ø–æ–Ω—è—Ç–Ω–æ —Ä–µ–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

**–†–µ—à–µ–Ω–∏–µ:**
1. –î–æ–±–∞–≤–∏—Ç—å —è–≤–Ω–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞:
   ```python
   risk_status_text = {
       "safe": "‚úÖ –ë–ï–ó–û–ü–ê–°–ù–û",
       "warning": "‚ö†Ô∏è –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ï",
       "danger": "üö® –û–ü–ê–°–ù–û–°–¢–¨",
       "critical": "üíÄ –ö–†–ò–¢–ò–ß–ù–û"
   }.get(risk_level, "‚ùì –ù–ï–ò–ó–í–ï–°–¢–ù–û")
   ```

2. –£–ª—É—á—à–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
   ```python
   logger.warning(
       f"{risk_status_text}: {symbol} {side} - "
       f"margin_ratio={margin_ratio:.2f}, "
       f"equity=${equity:.2f}, "
       f"margin_used=${margin_used:.2f}, "
       f"available_margin=${available_margin:.2f}"
   )
   ```

**–§–∞–π–ª –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** `src/strategies/modules/liquidation_guard.py`

---

## ‚ö†Ô∏è –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨ –¶–ò–ö–õ–ê

### 7. ‚ö†Ô∏è –î–æ–ª–≥–∏–π —Ü–∏–∫–ª TCC (27-28 —Å–µ–∫—É–Ω–¥)

**–ü—Ä–æ–±–ª–µ–º–∞:**
–¶–∏–∫–ª TCC `run_main_loop` —Å—Ç–∞–±–∏–ª—å–Ω–æ –∑–∞–Ω–∏–º–∞–µ—Ç –æ–∫–æ–ª–æ 27-28 —Å–µ–∫—É–Ω–¥:
- `Performance cycle: 27-28k ms`
- `state: ~1.1-1.2k ms`
- `signals: ~19-21k ms` (–æ—Å–Ω–æ–≤–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞!)
- `manage: ~3k ms`
- `monitor: ~1.9k ms`

**–õ–æ–∫–∞—Ü–∏—è:** `src/strategies/scalping/futures/core/trading_control_center.py`, –º–µ—Ç–æ–¥ `run_main_loop`

**–ê–Ω–∞–ª–∏–∑:**
- –ü–æ—á—Ç–∏ –≤—Å—è –∑–∞–¥–µ—Ä–∂–∫–∞ —É—Ö–æ–¥–∏—Ç –≤ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —Å–∏–≥–Ω–∞–ª–æ–≤ (19-21 —Å–µ–∫—É–Ω–¥!)
- –ù–∞ —Ç–∞–∫–æ–º —Ç–∞–π–º–∏–Ω–≥–µ –ª—é–±—ã–µ scalping-—Ä–µ—à–µ–Ω–∏—è —Ä–µ–∞–≥–∏—Ä—É—é—Ç –Ω–∞ —Ä—ã–Ω–æ–∫ —Å –∑–∞–ø–æ–∑–¥–∞–Ω–∏–µ–º –¥–æ –æ–¥–Ω–æ–≥–æ –±–∞—Ä–∞ 1m
- –ù–∞ —ç—Ç–∏ –∂–µ —Ü–∏–∫–ª—ã –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –Ω–∞–∫–ª–∞–¥—ã–≤–∞—é—Ç—Å—è –æ—à–∏–±–∫–∏ –ø–æ datetime, —á—Ç–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –Ω–∞–≥—Ä—É–∂–∞–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –°–ª–∏—à–∫–æ–º –¥–æ–ª–≥–∏–π —Ü–∏–∫–ª –¥–ª—è scalping —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
- –ò–∑–±—ã—Ç–æ—á–Ω–æ–µ I/O –∏–∑-–∑–∞ –±–æ–ª—å—à–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ DEBUG/INFO –ø–æ –∫–∞–∂–¥–æ–º—É —Ñ–∏–ª—å—Ç—Ä—É (ADX, MTF, Pivot, VolumeProfile, Correlation)

**–†–µ—à–µ–Ω–∏–µ:**
1. **–í—ã–Ω–µ—Å—Ç–∏ —Ç—è–∂–µ–ª—ã–µ –≤–µ—â–∏ –≤ –º–µ–Ω–µ–µ —á–∞—Å—Ç—ã–π —Ü–∏–∫–ª:**
   - –ß–∞—Å—Ç—å MTF-–∞–Ω–∞–ª–∏—Ç–∏–∫–∏
   - –ö–æ—Ä—Ä–µ–ª—è—Ü–∏–∏
   - Volume Profile —Ä–∞—Å—á–µ—Ç—ã

2. **–ü–æ—Ä–µ–∑–∞—Ç—å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—é DEBUG-–ª–æ–≥–æ–≤ –¥–ª—è –±–æ–µ–≤–æ–≥–æ —Ä–µ–∂–∏–º–∞:**
   - –£–±—Ä–∞—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ —Ñ–∏–ª—å—Ç—Ä–∞ –≤ —Ü–∏–∫–ª–µ
   - –û—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –≤–∞–∂–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è (—Å–∏–≥–Ω–∞–ª—ã, –≤—Ö–æ–¥—ã, –≤—ã—Ö–æ–¥—ã)
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è INFO –≤–º–µ—Å—Ç–æ DEBUG

3. **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —Å–∏–≥–Ω–∞–ª–æ–≤:**
   - –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–æ–≤
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –≤–æ—Ä–∫–µ—Ä—ã –¥–ª—è —Ç—è–∂–µ–ª—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π

**–§–∞–π–ª –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** `src/strategies/scalping/futures/core/trading_control_center.py`

---

## üìã –ü–†–ò–û–†–ò–¢–ï–¢–´ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1 (–ö–†–ò–¢–ò–ß–ù–û - –∏—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ)

1. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å –±–∞–≥ —Å `datetime` –≤ TradingControlCenter**
   - –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –∏–º–ø–æ—Ä—Ç: `from datetime import datetime as dt`
   - –ó–∞–º–µ–Ω–∏—Ç—å –≤—Å–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `datetime.now()` –Ω–∞ `dt.now()`
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –Ω–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å –∏–º–µ–Ω–µ–º `datetime`

2. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å `str vs int` –≤ ExitAnalyzer –¥–ª—è RANGING**
   - –î–æ–±–∞–≤–∏—Ç—å —è–≤–Ω–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ `float()` –≤–æ –≤—Å–µ—Ö –º–µ—Ç–æ–¥–∞—Ö –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤
   - –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Ç–∏–ø–æ–≤ –ø–µ—Ä–µ–¥ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è–º–∏
   - –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ `config_manager.to_dict()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —á–∏—Å–ª–∞, –∞ –Ω–µ —Å—Ç—Ä–æ–∫–∏

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2 (–í–ê–ñ–ù–û - –∏—Å–ø—Ä–∞–≤–∏—Ç—å –≤ —Ç–µ—á–µ–Ω–∏–µ –Ω–µ–¥–µ–ª–∏)

3. **–ü–µ—Ä–µ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–º—ã—Å–ª max_holding –≤ RANGING**
   - –°–¥–µ–ª–∞—Ç—å max holding –∂–µ—Å—Ç–∫–∏–º —Å—Ç–æ–ø–æ–º (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
   - –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä –≤ –∫–æ–Ω—Ñ–∏–≥ –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è
   - –£–±—Ä–∞—Ç—å –ª–æ–≥–∏–∫—É "–¥–µ—Ä–∂–∞—Ç—å, –µ—Å–ª–∏ –Ω–µ–º–Ω–æ–≥–æ –≤ –º–∏–Ω—É—Å–µ"

4. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å `profit_too_low_vs_peak`**
   - –û—Ç–∫–ª—é—á–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É peak –¥–ª—è –º–∞–ª—ã—Ö –ø—Ä–∏–±—ã–ª–µ–π (< 0.5%)
   - –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä –≤ –∫–æ–Ω—Ñ–∏–≥ –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è
   - –£—á–∏—Ç—ã–≤–∞—Ç—å –∫–æ–º–∏—Å—Å–∏–∏ –≤ —Å—Ä–∞–≤–Ω–µ–Ω–∏–∏

5. **–ü—Ä–∏–≤–µ—Å—Ç–∏ –∫ –µ–¥–∏–Ω–æ–π –º–æ–¥–µ–ª–∏ –º–∞—Ä–∂–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ä–∏—Å–∫–∞**
   - –†–µ—à–∏—Ç—å, –∫–∞–∫–∞—è –º–æ–¥–µ–ª—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è (–ø–æ –ø–æ–∑–∏—Ü–∏–∏ –∏–ª–∏ –ø–æ –ø—Ä–æ—Ñ–∏–ª—é)
   - –£–±—Ä–∞—Ç—å –≤—Ç–æ—Ä–æ–π –≤–∞—Ä–∏–∞–Ω—Ç
   - –î–æ–±–∞–≤–∏—Ç—å —è–≤–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–π –º–æ–¥–µ–ª–∏

6. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ LiquidationGuard**
   - –î–æ–±–∞–≤–∏—Ç—å –Ω–æ—Ä–º–∞–ª—å–Ω—ã–µ —Ç–µ–∫—Å—Ç—ã —Å—Ç–∞—Ç—É—Å–æ–≤ (excellent/good/warning/danger)
   - –£–ª—É—á—à–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —è–≤–Ω—ã–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3 (–û–ü–¶–ò–û–ù–ê–õ–¨–ù–û - –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏)

7. **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤—Ä–µ–º—è —Ü–∏–∫–ª–∞**
   - –í—ã–Ω–µ—Å—Ç–∏ —Ç—è–∂–µ–ª—ã–µ –≤–µ—â–∏ –≤ –º–µ–Ω–µ–µ —á–∞—Å—Ç—ã–π —Ü–∏–∫–ª
   - –ü–æ—Ä–µ–∑–∞—Ç—å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—é DEBUG-–ª–æ–≥–æ–≤
   - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —Å–∏–≥–Ω–∞–ª–æ–≤

---

## üìù –ò–¢–û–ì–û–í–ê–Ø –û–¶–ï–ù–ö–ê –ü–†–û–ë–õ–ï–ú

| –ü—Ä–æ–±–ª–µ–º–∞ | –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å | –í–ª–∏—è–Ω–∏–µ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
|----------|-------------|---------|-----------|
| datetime error | ‚ùå –ö–†–ò–¢–ò–ß–ù–û | –°–ø–∞–º –≤ –ª–æ–≥–∞—Ö, –Ω–∞–≥—Ä—É–∂–∞–µ—Ç —Å–∏—Å—Ç–µ–º—É | 1 |
| str vs int | ‚ùå –ö–†–ò–¢–ò–ß–ù–û | ExitAnalyzer —Å–ª–æ–º–∞–Ω –¥–ª—è RANGING | 1 |
| max_holding –º—è–≥–∫–∏–π | ‚ö†Ô∏è –í–ê–ñ–ù–û | –ü–æ–∑–∏—Ü–∏–∏ –≤–∏—Å—è—Ç –¥–æ–ª—å—à–µ, —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è —Ä–∏—Å–∫ | 2 |
| profit_too_low_vs_peak | ‚ö†Ô∏è –í–ê–ñ–ù–û | –ü–æ–∑–∏—Ü–∏–∏ –Ω–µ –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è –≤–æ–≤—Ä–µ–º—è, –∫–æ–º–∏—Å—Å–∏–∏ —Å—ä–µ–¥–∞—é—Ç –ø—Ä–∏–±—ã–ª—å | 2 |
| margin ratio –Ω–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å | ‚ö†Ô∏è –í–ê–ñ–ù–û | –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è –æ–± –æ–ø–∞—Å–Ω–æ—Å—Ç–∏ | 2 |
| LiquidationGuard —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ | ‚ö†Ô∏è –í–ê–ñ–ù–û | –®—É–º –≤ –ª–æ–≥–∞—Ö, –Ω–µ–ø–æ–Ω—è—Ç–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ | 2 |
| –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ü–∏–∫–ª–∞ | ‚ö†Ô∏è –°–†–ï–î–ù–ï | –ó–∞–ø–æ–∑–¥–∞–ª–∞—è —Ä–µ–∞–∫—Ü–∏—è –Ω–∞ —Ä—ã–Ω–æ–∫ | 3 |

---

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** 2025-12-21  
**–ò—Å—Ç–æ—á–Ω–∏–∫:** –ó–∞–º–µ—á–∞–Ω–∏—è –æ—Ç Grok  
**–°—Ç–∞—Ç—É—Å:** ‚è≥ –¢—Ä–µ–±—É—é—Ç—Å—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è




