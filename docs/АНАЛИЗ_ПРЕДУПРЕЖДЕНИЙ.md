# ‚ö†Ô∏è –ê–ù–ê–õ–ò–ó –ü–û–°–¢–û–Ø–ù–ù–´–• –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ô

## üìÖ –î–∞—Ç–∞: 2025-11-21

---

## üîç –ü–†–û–ë–õ–ï–ú–ê #1: "–ù–µ—Ç –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–∫—Ä—ã—Ç–∏—è –¥–ª—è –ø–æ–∑–∏—Ü–∏–∏"

### –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ:
```
‚ö†Ô∏è –ù–µ—Ç –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–∫—Ä—ã—Ç–∏—è –¥–ª—è –ø–æ–∑–∏—Ü–∏–∏ ETH-USDT
‚ö†Ô∏è –ù–µ—Ç –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–∫—Ä—ã—Ç–∏—è –¥–ª—è –ø–æ–∑–∏—Ü–∏–∏ BTC-USDT
```

### –ü—Ä–∏—á–∏–Ω–∞:
- –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø–æ–∑–∏—Ü–∏–∏ —á–µ—Ä–µ–∑ WebSocket (`_handle_private_ws_positions`) –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `update()`, –∫–æ—Ç–æ—Ä—ã–π **–ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç** –¥–∞–Ω–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏
- `entry_time` **–Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è** –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏, –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç –≤ `update_data`
- –≠—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –¥–ª—è –≤—Å–µ—Ö –ø–∞—Ä (BTC, ETH, DOGE, SOL, XRP) –∏ –≤—Å–µ—Ö —Ä–µ–∂–∏–º–æ–≤

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:
‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û** –≤ `src/strategies/scalping/futures/orchestrator.py`:
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞: –µ—Å–ª–∏ `entry_time` –Ω–µ—Ç - —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö (`regime`, `position_side`, `time_extended`, `order_type`, `post_only`) –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø–æ–∑–∏—Ü–∏–∏
- –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ `update()`

### –ö–æ–¥ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```python
# ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –°–æ—Ö—Ä–∞–Ω—è–µ–º entry_time –∏ –¥—Ä—É–≥–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
if "entry_time" not in self.active_positions[symbol]:
    update_data["entry_time"] = datetime.now()
    update_data["timestamp"] = datetime.now()
# –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∂–∏–º –∏ –¥—Ä—É–≥–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
saved_regime = self.active_positions[symbol].get("regime")
saved_position_side = self.active_positions[symbol].get("position_side")
# ... –∏ —Ç.–¥.
```

---

## üîç –ü–†–û–ë–õ–ï–ú–ê #2: "equity –Ω–µ –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ get_margin_info"

### –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ:
```
‚ö†Ô∏è equity –Ω–µ –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ get_margin_info –¥–ª—è BTC-USDT, –∏—Å–ø–æ–ª—å–∑—É–µ–º fallback –±–∞–ª–∞–Ω—Å: 824.40
‚ö†Ô∏è equity –Ω–µ –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ get_margin_info –∏ API –¥–ª—è BTC-USDT, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—â–∏–π –±–∞–ª–∞–Ω—Å: 824.38
```

### –ü—Ä–∏—á–∏–Ω–∞:
- `get_margin_info()` –ø—ã—Ç–∞–µ—Ç—Å—è –ø–æ–ª—É—á–∏—Ç—å equity —Ç—Ä–µ–º—è —Å–ø–æ—Å–æ–±–∞–º–∏:
  1. –ü—Ä—è–º–æ–µ –ø–æ–ª–µ `eq` (–µ—Å–ª–∏ –µ—Å—Ç—å)
  2. –†–∞—Å—á–µ—Ç `equity = margin + unrealizedPnl`
  3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `availEq` –∫–∞–∫ fallback
- –ï—Å–ª–∏ –≤—Å–µ —Ç—Ä–∏ —Å–ø–æ—Å–æ–±–∞ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç 0, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–±—â–∏–π –±–∞–ª–∞–Ω—Å –∞–∫–∫–∞—É–Ω—Ç–∞
- –≠—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å, –µ—Å–ª–∏:
  - –ü–æ–∑–∏—Ü–∏—è —Ç–æ–ª—å–∫–æ —á—Ç–æ –æ—Ç–∫—Ä—ã—Ç–∞ –∏ –µ—â–µ –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–∞
  - API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Å—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è `margin` –∏–ª–∏ `upl`
  - –ü–æ–∑–∏—Ü–∏—è –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

### –ê–Ω–∞–ª–∏–∑:
- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –≤—ã–≤–æ–¥–∏—Ç—Å—è –¥–∞–∂–µ –∫–æ–≥–¥–∞ `equity = 0`, –Ω–æ —ç—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–∑–∏—Ü–∏–π
- –ü—Ä–æ–±–ª–µ–º–∞ –≤ —Ç–æ–º, —á—Ç–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ —Å–ª–∏—à–∫–æ–º —á–∞—Å—Ç–æ–µ –∏ –∑–∞—Å–æ—Ä—è–µ—Ç –ª–æ–≥–∏
- –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –ø–æ—á–µ–º—É `margin` –∏–ª–∏ `upl` –Ω–µ –Ω–∞—Ö–æ–¥—è—Ç—Å—è

### –†–µ—à–µ–Ω–∏–µ:
1. ‚úÖ **–£–ª—É—á—à–∏—Ç—å –ª–æ–≥–∏–∫—É –ø–æ–ª—É—á–µ–Ω–∏—è equity** - –¥–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ –ø—Ä–æ–≤–µ—Ä–æ–∫
2. ‚úÖ **–°–Ω–∏–∑–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `DEBUG` –≤–º–µ—Å—Ç–æ `WARNING` –¥–ª—è –Ω–æ—Ä–º–∞–ª—å–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤
3. ‚úÖ **–î–æ–±–∞–≤–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** - –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å equity –Ω–∞ –∫–æ—Ä–æ—Ç–∫–æ–µ –≤—Ä–µ–º—è, —á—Ç–æ–±—ã –Ω–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å –∫–∞–∂–¥—ã–π —Ä–∞–∑

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª—è –≤—Å–µ—Ö –ø–∞—Ä –∏ —Ä–µ–∂–∏–º–æ–≤:
- ‚úÖ **BTC-USDT** - –ø—Ä–æ–±–ª–µ–º–∞ –µ—Å—Ç—å (ranging —Ä–µ–∂–∏–º)
- ‚úÖ **ETH-USDT** - –ø—Ä–æ–±–ª–µ–º–∞ –µ—Å—Ç—å (ranging —Ä–µ–∂–∏–º)
- ‚ö†Ô∏è **DOGE-USDT** - –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å
- ‚ö†Ô∏è **SOL-USDT** - –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å
- ‚ö†Ô∏è **XRP-USDT** - –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å

---

## üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ô

### "–ù–µ—Ç –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–∫—Ä—ã—Ç–∏—è":
- **–ß–∞—Å—Ç–æ—Ç–∞:** –ü–æ—Å—Ç–æ—è–Ω–Ω–æ (–∫–∞–∂–¥—ã–µ 1-2 —Å–µ–∫—É–Ω–¥—ã)
- **–ü–∞—Ä:** BTC-USDT, ETH-USDT (–∏ –≤–æ–∑–º–æ–∂–Ω–æ –¥—Ä—É–≥–∏–µ)
- **–†–µ–∂–∏–º—ã:** –í—Å–µ —Ä–µ–∂–∏–º—ã (trending, ranging, choppy)

### "equity –Ω–µ –Ω–∞–π–¥–µ–Ω":
- **–ß–∞—Å—Ç–æ—Ç–∞:** –ü–æ—Å—Ç–æ—è–Ω–Ω–æ (–∫–∞–∂–¥—ã–µ 1-2 —Å–µ–∫—É–Ω–¥—ã)
- **–ü–∞—Ä:** BTC-USDT (–∏ –≤–æ–∑–º–æ–∂–Ω–æ –¥—Ä—É–≥–∏–µ)
- **–†–µ–∂–∏–º—ã:** –í—Å–µ —Ä–µ–∂–∏–º—ã (trending, ranging, choppy)

---

## ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Å `entry_time`:
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ `entry_time` –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø–æ–∑–∏—Ü–∏–∏ —á–µ—Ä–µ–∑ WebSocket
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø–æ–∑–∏—Ü–∏–∏
- ‚úÖ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ `update()`

### 2. –ù—É–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å –ª–æ–≥–∏–∫—É –ø–æ–ª—É—á–µ–Ω–∏—è equity:
- ‚ö†Ô∏è –î–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ –ø—Ä–æ–≤–µ—Ä–æ–∫ –≤ `get_margin_info()`
- ‚ö†Ô∏è –°–Ω–∏–∑–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –Ω–æ—Ä–º–∞–ª—å–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤
- ‚ö†Ô∏è –î–æ–±–∞–≤–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ equity

---

## üéØ –í–´–í–û–î–´

### ‚úÖ –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:
1. ‚úÖ **–ü—Ä–æ–±–ª–µ–º–∞ —Å `entry_time`** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞, —Ç–µ–ø–µ—Ä—å `entry_time` —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø–æ–∑–∏—Ü–∏–∏

### ‚ö†Ô∏è –ß—Ç–æ –Ω—É–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å:
1. ‚ö†Ô∏è **–õ–æ–≥–∏–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è equity** - –Ω—É–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å, —á—Ç–æ–±—ã –Ω–µ –≤—ã–≤–æ–¥–∏—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –¥–ª—è –Ω–æ—Ä–º–∞–ª—å–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤
2. ‚ö†Ô∏è **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ equity** - –¥–æ–±–∞–≤–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ, —á—Ç–æ–±—ã –Ω–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å –∫–∞–∂–¥—ã–π —Ä–∞–∑

### üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
1. **–°–Ω–∏–∑–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `DEBUG` –≤–º–µ—Å—Ç–æ `WARNING` –¥–ª—è —Å–ª—É—á–∞–µ–≤, –∫–æ–≥–¥–∞ equity = 0, –Ω–æ —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ
2. **–î–æ–±–∞–≤–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** - –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å equity –Ω–∞ 1-2 —Å–µ–∫—É–Ω–¥—ã, —á—Ç–æ–±—ã –Ω–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å –∫–∞–∂–¥—ã–π —Ä–∞–∑
3. **–£–ª—É—á—à–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏** - –¥–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ –ø—Ä–æ–≤–µ—Ä–æ–∫ –≤ `get_margin_info()`, —á—Ç–æ–±—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å, –∫–æ–≥–¥–∞ equity –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –Ω–µ –Ω–∞–π–¥–µ–Ω

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü—Ä–æ–±–ª–µ–º–∞ —Å `entry_time` –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞. –ü—Ä–æ–±–ª–µ–º–∞ —Å equity —Ç—Ä–µ–±—É–µ—Ç —É–ª—É—á—à–µ–Ω–∏—è –ª–æ–≥–∏–∫–∏ –ø–æ–ª—É—á–µ–Ω–∏—è –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è.



