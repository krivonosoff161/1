# üîç –ê–ù–ê–õ–ò–ó –ü–†–û–ë–õ–ï–ú –ê–ù–ê–õ–ò–ó–ê–¢–û–†–ê –õ–û–ì–û–í

**–î–∞—Ç–∞:** 2025-11-16  
**–°—Ç–∞—Ç—É—Å:** ‚ùå –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

---

## üö® –ù–ê–ô–î–ï–ù–ù–´–ï –ü–†–û–ë–õ–ï–ú–´

### 1. ‚ùå **–ü–ê–†–°–ò–ù–ì –õ–û–ì–û–í - –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π regex –ø–∞—Ç—Ç–µ—Ä–Ω**

**–§–∞–π–ª:** `logs/analyze_logs.py:191`

**–ü—Ä–æ–±–ª–µ–º–∞:**
```python
pattern = r"(\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}(?:\.\d+)?)\s*\|\s*(\w+)\s*\|\s*([^|]+?)(?:\s*-\s*|\s*\|\s*)(.+)"
```

**–†–µ–∞–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –ª–æ–≥–æ–≤:**
```
2025-11-16 23:28:30 | DEBUG | src.strategies.scalping.futures.signal_generator:_generate_ma_signals:1833 - üîç MA –¥–ª—è DOGE-USDT...
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–∞—Ç—Ç–µ—Ä–Ω `([^|]+?)` –∑–∞—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç `src.strategies.scalping.futures.signal_generator:_generate_ma_signals:1833`, –Ω–æ –ø–æ—Å–ª–µ –Ω–µ–≥–æ –∏–¥–µ—Ç ` - `, –∞ –Ω–µ `|` –∏–ª–∏ –¥—Ä—É–≥–æ–π —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å. –ü–∞—Ç—Ç–µ—Ä–Ω –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å:
```python
pattern = r"(\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}(?:\.\d+)?)\s*\|\s*(\w+)\s*\|\s*([^-]+?)\s*-\s*(.+)"
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- –ó–∞–º–µ–Ω–∏—Ç—å `([^|]+?)(?:\s*-\s*|\s*\|\s*)` –Ω–∞ `([^-]+?)\s*-\s*`
- –ò–ª–∏ —Å–¥–µ–ª–∞—Ç—å –±–æ–ª–µ–µ –≥–∏–±–∫–∏–π –ø–∞—Ç—Ç–µ—Ä–Ω, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ–±–∞ —Ñ–æ—Ä–º–∞—Ç–∞

---

### 2. ‚ùå **–ê–†–•–ò–í–ê–¶–ò–Ø - –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–æ–≤**

**–§–∞–π–ª:** `logs/archive_logs.py:38-71`

**–ü—Ä–æ–±–ª–µ–º–∞ 1:**
```python
for log_file in logs_path.glob("*.log"):
    if log_file.name.endswith(".zip"):  # ‚ùå –≠—Ç–æ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è!
        continue
```

**–ü—Ä–∏—á–∏–Ω–∞:** `glob("*.log")` –Ω–µ –Ω–∞–π–¥–µ—Ç —Ñ–∞–π–ª—ã —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º `.zip`! –≠—Ç–æ –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–µ—Å–ø–æ–ª–µ–∑–Ω–∞.

**–ü—Ä–æ–±–ª–µ–º–∞ 2:**
```python
# –ï—Å–ª–∏ —Ñ–∞–π–ª —Å—Ç–∞—Ä—à–µ auto_archive_days –∏ –µ—â–µ –Ω–µ –∑–∞–∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω
if age_days >= auto_archive_days:
    # ... –∞—Ä—Ö–∏–≤–∞—Ü–∏—è ...
    log_file.unlink()  # –§–∞–π–ª —É–¥–∞–ª—è–µ—Ç—Å—è
elif age_days >= keep_days:  # ‚ùå –≠—Ç–æ—Ç –±–ª–æ–∫ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è –¥–ª—è –∞—Ä—Ö–∏–≤–æ–≤!
    # ... —É–¥–∞–ª–µ–Ω–∏–µ ...
```

**–ü—Ä–∏—á–∏–Ω–∞:** 
- –ï—Å–ª–∏ —Ñ–∞–π–ª —Å—Ç–∞—Ä—à–µ `auto_archive_days` (7 –¥–Ω–µ–π), –æ–Ω –∞—Ä—Ö–∏–≤–∏—Ä—É–µ—Ç—Å—è –∏ —É–¥–∞–ª—è–µ—Ç—Å—è
- –ï—Å–ª–∏ —Ñ–∞–π–ª —Å—Ç–∞—Ä—à–µ `keep_days` (30 –¥–Ω–µ–π), –Ω–æ –º–ª–∞–¥—à–µ `auto_archive_days`, –æ–Ω —É–¥–∞–ª—è–µ—Ç—Å—è –±–µ–∑ –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏ (–ª–æ–≥–∏–∫–∞ —Å—Ç—Ä–∞–Ω–Ω–∞—è!)
- –ï—Å–ª–∏ —Ñ–∞–π–ª –º–ª–∞–¥—à–µ `auto_archive_days`, –æ–Ω –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è
- **–ü—Ä–æ–±–ª–µ–º–∞:** –§–∞–π–ª—ã —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º `.log.zip` –≤ –∫–æ—Ä–Ω–µ –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –≤–æ–æ–±—â–µ!

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
1. –û–±—Ä–∞–±–æ—Ç–∞—Ç—å `.log.zip` —Ñ–∞–π–ª—ã –≤ –∫–æ—Ä–Ω–µ (–æ–Ω–∏ —É–∂–µ –∑–∞–∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω—ã)
2. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É: –µ—Å–ª–∏ `age >= keep_days` ‚Üí —É–¥–∞–ª–∏—Ç—å, –µ—Å–ª–∏ `age >= auto_archive_days` –∏ –µ—â–µ –Ω–µ –∑–∞–∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω ‚Üí –∑–∞–∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å

---

### 3. ‚ùå **–ì–†–ê–§–ò–ö–ò - –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—É—Ç–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è**

**–§–∞–π–ª:** `logs/analyze_logs.py:634-647`

**–ü—Ä–æ–±–ª–µ–º–∞ 1:**
```python
# –í generate_charts (—Å—Ç—Ä–æ–∫–∞ 517):
output_dir = Path("logs/reports/charts")  # ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ

# –í generate_html_report (—Å—Ç—Ä–æ–∫–∞ 634):
charts_dir = output_path.parent / "charts"  # ‚ö†Ô∏è –ú–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ!
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ `output_path = Path("logs/reports/report_2025-11-16_12-00-00.html")`, —Ç–æ:
- `output_path.parent` = `Path("logs/reports")`
- `charts_dir` = `Path("logs/reports/charts")` ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ

–ù–æ –µ—Å–ª–∏ `output_path = Path("logs/reports/reports/report_2025-11-16_12-00-00.html")`, —Ç–æ:
- `output_path.parent` = `Path("logs/reports/reports")`
- `charts_dir` = `Path("logs/reports/reports/charts")` ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ!

**–ü—Ä–æ–±–ª–µ–º–∞ 2:**
```python
# –í generate_charts (—Å—Ç—Ä–æ–∫–∞ 1117):
output_dir = Path("logs/reports/charts")  # –•–∞—Ä–¥–∫–æ–¥ –ø—É—Ç–∏

# –ù–æ –≤ full_report –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è:
analyzer.generate_charts(stats, parsed_logs, output_dir, report_id=report_id)
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –ø—É—Ç—å –≤–µ–∑–¥–µ
- –ò–ª–∏ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å `output_dir` –≤ `generate_html_report` —è–≤–Ω–æ

---

### 4. ‚ùå **JSON –°–î–ï–õ–û–ö - –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —ç–∫—Å–ø–æ—Ä—Ç —Å–¥–µ–ª–æ–∫ –≤ JSON**

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –í `analyze_logs.py` **–Ω–µ—Ç –∫–æ–¥–∞** –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ —Å–¥–µ–ª–æ–∫ –≤ JSON
- –°–¥–µ–ª–∫–∏ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ CSV —á–µ—Ä–µ–∑ `performance_tracker.py` (—Ç–æ–ª—å–∫–æ –¥–ª—è spot, –Ω–µ –¥–ª—è futures!)
- –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –ª–æ–≥–æ–≤ –º–æ–∂–µ—Ç –ø–∞—Ä—Å–∏—Ç—å —Å–¥–µ–ª–∫–∏ –∏–∑ –ª–æ–≥–æ–≤, –Ω–æ –Ω–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –∏—Ö –≤ JSON

**–ß—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
1. –ü–∞—Ä—Å–∏–Ω–≥ –≤—Å–µ—Ö —Å–¥–µ–ª–æ–∫ –∏–∑ –ª–æ–≥–æ–≤ (–æ—Ç–∫—Ä—ã—Ç—ã—Ö –∏ –∑–∞–∫—Ä—ã—Ç—ã—Ö)
2. –≠–∫—Å–ø–æ—Ä—Ç –≤ JSON —Å –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
3. –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV (–∫–∞–∫ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç)

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ `export_trades_to_json()` –≤ `LogAnalyzer`
- –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ `export_trades_to_csv()` –≤ `LogAnalyzer`
- –ü–∞—Ä—Å–∏—Ç—å —Å–¥–µ–ª–∫–∏ –∏–∑ –ª–æ–≥–æ–≤ (–æ—Ç–∫—Ä—ã—Ç–∏–µ –∏ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–π)
- –°–æ—Ö—Ä–∞–Ω—è—Ç—å –≤ `logs/trades_YYYY-MM-DD.json` –∏ `logs/trades_YYYY-MM-DD.csv`

---

## üìã –î–ï–¢–ê–õ–¨–ù–´–ô –†–ê–ó–ë–û–†

### **–ü—Ä–æ–±–ª–µ–º–∞ 1: –ü–∞—Ä—Å–∏–Ω–≥ –ª–æ–≥–æ–≤**

**–¢–µ–∫—É—â–∏–π –ø–∞—Ç—Ç–µ—Ä–Ω:**
```python
pattern = r"(\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}(?:\.\d+)?)\s*\|\s*(\w+)\s*\|\s*([^|]+?)(?:\s*-\s*|\s*\|\s*)(.+)"
```

**–ü—Ä–∏–º–µ—Ä —Å—Ç—Ä–æ–∫–∏:**
```
2025-11-16 23:28:30 | DEBUG | src.strategies.scalping.futures.signal_generator:_generate_ma_signals:1833 - üîç MA –¥–ª—è DOGE-USDT...
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- `(\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}(?:\.\d+)?)` ‚Üí `2025-11-16 23:28:30` ‚úÖ
- `(\w+)` ‚Üí `DEBUG` ‚úÖ
- `([^|]+?)` ‚Üí `src.strategies.scalping.futures.signal_generator:_generate_ma_signals:1833` ‚úÖ
- `(?:\s*-\s*|\s*\|\s*)` ‚Üí ` - ` ‚úÖ
- `(.+)` ‚Üí `üîç MA –¥–ª—è DOGE-USDT...` ‚úÖ

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–∞ —Å–∞–º–æ–º –¥–µ–ª–µ, –ø–∞—Ç—Ç–µ—Ä–Ω –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å! –ù–æ –º–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å –¥–ª—è —Å—Ç—Ä–æ–∫ –±–µ–∑ –º–∏–∫—Ä–æ—Å–µ–∫—É–Ω–¥ –∏–ª–∏ —Å –¥—Ä—É–≥–∏–º —Ñ–æ—Ä–º–∞—Ç–æ–º.

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
–ù—É–∂–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –ª–æ–≥–∞—Ö, –≤–æ–∑–º–æ–∂–Ω–æ –ø—Ä–æ–±–ª–µ–º–∞ –≤ –¥—Ä—É–≥–æ–º –º–µ—Å—Ç–µ.

---

### **–ü—Ä–æ–±–ª–µ–º–∞ 2: –ê—Ä—Ö–∏–≤–∞—Ü–∏—è**

**–¢–µ–∫—É—â–∞—è –ª–æ–≥–∏–∫–∞:**
```python
# –ï—Å–ª–∏ —Ñ–∞–π–ª —Å—Ç–∞—Ä—à–µ auto_archive_days (7 –¥–Ω–µ–π)
if age_days >= auto_archive_days:
    # –ê—Ä—Ö–∏–≤–∏—Ä—É–µ–º
    # –£–¥–∞–ª—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª
elif age_days >= keep_days (30 –¥–Ω–µ–π):  # ‚ùå –≠—Ç–æ—Ç –±–ª–æ–∫ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è!
    # –£–¥–∞–ª—è–µ–º –±–µ–∑ –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ï—Å–ª–∏ `age_days >= 30` –∏ `age_days >= 7`, —Ç–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è –ø–µ—Ä–≤—ã–π –±–ª–æ–∫
- –í—Ç–æ—Ä–æ–π –±–ª–æ–∫ `elif age_days >= 30` –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ
- –ù–æ –µ—Å–ª–∏ —Ñ–∞–π–ª —Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π, –Ω–æ –º—ã –µ–≥–æ –Ω–µ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–ª–∏ (–ø–æ—Ç–æ–º—É —á—Ç–æ —É–∂–µ –∞—Ä—Ö–∏–≤), —Ç–æ –æ–Ω –Ω–µ —É–¥–∞–ª–∏—Ç—Å—è!

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```python
# –ï—Å–ª–∏ —Ñ–∞–π–ª —Å—Ç–∞—Ä—à–µ keep_days - —É–¥–∞–ª—è–µ–º (–∞—Ä—Ö–∏–≤ –∏–ª–∏ –Ω–µ—Ç)
if age_days >= keep_days:
    if not log_file.name.endswith(".zip"):
        # –ê—Ä—Ö–∏–≤–∏—Ä—É–µ–º –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º (–µ—Å–ª–∏ –µ—â–µ –Ω–µ –∑–∞–∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω)
        if age_days >= auto_archive_days:
            # –ê—Ä—Ö–∏–≤–∏—Ä—É–µ–º
    # –£–¥–∞–ª—è–µ–º (–∞—Ä—Ö–∏–≤ –∏–ª–∏ –æ—Ä–∏–≥–∏–Ω–∞–ª)
# –ï—Å–ª–∏ —Ñ–∞–π–ª —Å—Ç–∞—Ä—à–µ auto_archive_days, –Ω–æ –º–ª–∞–¥—à–µ keep_days - –∞—Ä—Ö–∏–≤–∏—Ä—É–µ–º
elif age_days >= auto_archive_days:
    if not log_file.name.endswith(".zip"):
        # –ê—Ä—Ö–∏–≤–∏—Ä—É–µ–º
        # –£–¥–∞–ª—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª
```

**–¢–∞–∫–∂–µ:** –û–±—Ä–∞–±–æ—Ç–∞—Ç—å `.log.zip` —Ñ–∞–π–ª—ã –≤ –∫–æ—Ä–Ω–µ (–æ–Ω–∏ —É–∂–µ –∑–∞–∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω—ã, –Ω–æ –Ω–µ –≤ –ø–∞–ø–∫–µ `archived`)

---

### **–ü—Ä–æ–±–ª–µ–º–∞ 3: –ì—Ä–∞—Ñ–∏–∫–∏**

**–ü—Ä–æ–±–ª–µ–º–∞ –≤ –ø—É—Ç—è—Ö:**
- `generate_charts` —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≥—Ä–∞—Ñ–∏–∫–∏ –≤ `logs/reports/charts/`
- `generate_html_report` –∏—â–µ—Ç –≥—Ä–∞—Ñ–∏–∫–∏ –≤ `output_path.parent / "charts"`
- –ï—Å–ª–∏ `output_path = logs/reports/report.html`, —Ç–æ `output_path.parent = logs/reports`, –∞ `charts_dir = logs/reports/charts` ‚úÖ
- –ù–æ –µ—Å–ª–∏ –ø—É—Ç—å –¥—Ä—É–≥–æ–π, –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–æ–±–ª–µ–º–∞!

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –ø—É—Ç—å –≤–µ–∑–¥–µ
- –ü–µ—Ä–µ–¥–∞–≤–∞—Ç—å `charts_dir` —è–≤–Ω–æ –≤ `generate_html_report`

---

### **–ü—Ä–æ–±–ª–µ–º–∞ 4: JSON —Å–¥–µ–ª–æ–∫**

**–¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è:**
- –í `analyze_logs.py` **–Ω–µ—Ç** —ç–∫—Å–ø–æ—Ä—Ç–∞ —Å–¥–µ–ª–æ–∫ –≤ JSON
- –í `performance_tracker.py` –µ—Å—Ç—å —ç–∫—Å–ø–æ—Ä—Ç –≤ CSV (—Ç–æ–ª—å–∫–æ –¥–ª—è spot, –Ω–µ –¥–ª—è futures)
- –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –ø–∞—Ä—Å–∏—Ç—å —Å–¥–µ–ª–∫–∏ –∏–∑ –ª–æ–≥–æ–≤, –Ω–æ –Ω–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –∏—Ö

**–ß—Ç–æ –Ω—É–∂–Ω–æ:**
1. –ü–∞—Ä—Å–∏–Ω–≥ —Å–¥–µ–ª–æ–∫ –∏–∑ –ª–æ–≥–æ–≤:
   - –û—Ç–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–∏: "‚úÖ –ü–æ–∑–∏—Ü–∏—è {symbol} {side} –æ—Ç–∫—Ä—ã—Ç–∞"
   - –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–∏: "‚úÖ –ü–æ–∑–∏—Ü–∏—è {symbol} –∑–∞–∫—Ä—ã—Ç–∞ –ø–æ {reason}, PnL = {pnl} USDT"
   
2. –°–±–æ—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–¥–µ–ª–∫–µ:
   - Symbol
   - Side (long/short)
   - Entry price
   - Exit price
   - Size
   - Gross PnL
   - Commission
   - Net PnL
   - Duration
   - Reason
   - Timestamp

3. –≠–∫—Å–ø–æ—Ä—Ç –≤ JSON:
   ```json
   {
     "trades": [
       {
         "timestamp": "2025-11-16T23:28:30",
         "symbol": "BTC-USDT",
         "side": "long",
         "entry_price": 94640.00,
         "exit_price": 94700.00,
         "size": 0.0013,
         "gross_pnl": 0.78,
         "commission": 0.12,
         "net_pnl": 0.66,
         "duration_sec": 120,
         "reason": "tp"
       }
     ]
   }
   ```

4. –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV (–¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)

---

## üîß –ü–õ–ê–ù –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô

### **1. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø–∞—Ä—Å–∏–Ω–≥ –ª–æ–≥–æ–≤**

**–ó–∞–¥–∞—á–∞:** –°–¥–µ–ª–∞—Ç—å –ø–∞—Ç—Ç–µ—Ä–Ω –±–æ–ª–µ–µ –≥–∏–±–∫–∏–º –∏ –Ω–∞–¥–µ–∂–Ω—ã–º

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```python
def parse_log_line(self, line: str) -> Optional[Dict]:
    """–ü–∞—Ä—Å–∏–Ω–≥ —Å—Ç—Ä–æ–∫–∏ –ª–æ–≥–∞"""
    # –§–æ—Ä–º–∞—Ç: YYYY-MM-DD HH:mm:ss[.fff] | LEVEL | module - message
    # –ò–ª–∏: YYYY-MM-DD HH:mm:ss[.fff] | LEVEL | module | message
    
    # –ü–æ–ø—Ä–æ–±—É–µ–º –ø–∞—Ç—Ç–µ—Ä–Ω —Å "-"
    pattern1 = r"(\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}(?:\.\d+)?)\s*\|\s*(\w+)\s*\|\s*([^-]+?)\s*-\s*(.+)"
    match = re.match(pattern1, line)
    
    if match:
        time_str, level, module, message = match.groups()
    else:
        # –ü–æ–ø—Ä–æ–±—É–µ–º –ø–∞—Ç—Ç–µ—Ä–Ω —Å "|"
        pattern2 = r"(\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}(?:\.\d+)?)\s*\|\s*(\w+)\s*\|\s*([^|]+?)\s*\|\s*(.+)"
        match = re.match(pattern2, line)
        if match:
            time_str, level, module, message = match.groups()
        else:
            return None
    
    # –ü–∞—Ä—Å–∏–Ω–≥ –≤—Ä–µ–º–µ–Ω–∏
    try:
        timestamp = datetime.strptime(time_str, "%Y-%m-%d %H:%M:%S.%f")
    except:
        try:
            timestamp = datetime.strptime(time_str, "%Y-%m-%d %H:%M:%S")
        except:
            timestamp = None
    
    return {
        "timestamp": timestamp,
        "level": level,
        "module": module.strip(),
        "message": message.strip(),
        "raw": line,
    }
```

---

### **2. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∞—Ä—Ö–∏–≤–∞—Ü–∏—é**

**–ó–∞–¥–∞—á–∞:** –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–æ–≤

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```python
def archive_old_logs(
    logs_dir: str = "logs/futures", 
    keep_days: int = 30, 
    auto_archive_days: int = 7
):
    logs_path = Path(logs_dir)
    if not logs_path.exists():
        return
    
    now = datetime.now()
    archived_count = 0
    deleted_count = 0
    
    # –°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫—É –¥–ª—è –∞—Ä—Ö–∏–≤–æ–≤
    archive_dir = logs_path / "archived"
    archive_dir.mkdir(exist_ok=True)
    
    # ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï 1: –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º .log —Ñ–∞–π–ª—ã
    for log_file in logs_path.glob("*.log"):
        # –£–±–∏—Ä–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ .zip (–æ–Ω–∞ –±–µ—Å–ø–æ–ª–µ–∑–Ω–∞)
        if log_file.name.endswith(".zip"):
            continue
        
        mod_time = datetime.fromtimestamp(log_file.stat().st_mtime)
        age_days = (now - mod_time).days
        
        # ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï 2: –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞
        if age_days >= keep_days:
            # –°—Ç–∞—Ä—à–µ keep_days - —É–¥–∞–ª—è–µ–º (—Å–Ω–∞—á–∞–ª–∞ –∞—Ä—Ö–∏–≤–∏—Ä—É–µ–º, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
            zip_name = f"{log_file.stem}.zip"
            zip_path = archive_dir / zip_name
            
            # –ê—Ä—Ö–∏–≤–∏—Ä—É–µ–º –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º (–µ—Å–ª–∏ –µ—â–µ –Ω–µ –∑–∞–∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω)
            if not zip_path.exists() and age_days >= auto_archive_days:
                try:
                    with zipfile.ZipFile(zip_path, "w", zipfile.ZIP_DEFLATED) as zipf:
                        zipf.write(log_file, log_file.name)
                    print(f"‚úÖ –ó–∞–∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º: {log_file.name}")
                except Exception as e:
                    print(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏ {log_file.name}: {e}")
            
            # –£–¥–∞–ª—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª
            try:
                log_file.unlink()
                deleted_count += 1
                print(f"üóëÔ∏è  –£–¥–∞–ª–µ–Ω (—Å—Ç–∞—Ä—à–µ {keep_days} –¥–Ω–µ–π): {log_file.name}")
            except Exception as e:
                print(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è {log_file.name}: {e}")
        
        elif age_days >= auto_archive_days:
            # –°—Ç–∞—Ä—à–µ auto_archive_days, –Ω–æ –º–ª–∞–¥—à–µ keep_days - –∞—Ä—Ö–∏–≤–∏—Ä—É–µ–º
            zip_name = f"{log_file.stem}.zip"
            zip_path = archive_dir / zip_name
            
            if not zip_path.exists():
                try:
                    with zipfile.ZipFile(zip_path, "w", zipfile.ZIP_DEFLATED) as zipf:
                        zipf.write(log_file, log_file.name)
                    
                    # –£–¥–∞–ª—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª
                    log_file.unlink()
                    archived_count += 1
                    print(f"‚úÖ –ó–∞–∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω: {log_file.name} ‚Üí {zip_name}")
                except Exception as e:
                    print(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏ {log_file.name}: {e}")
    
    # ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï 3: –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º .log.zip —Ñ–∞–π–ª—ã –≤ –∫–æ—Ä–Ω–µ (—É–∂–µ –∑–∞–∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ)
    for zip_file in logs_path.glob("*.log.zip"):
        mod_time = datetime.fromtimestamp(zip_file.stat().st_mtime)
        age_days = (now - mod_time).days
        
        if age_days >= keep_days:
            # –ü–µ—Ä–µ–º–µ—â–∞–µ–º –≤ archived (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —Ç–∞–º)
            archive_zip_path = archive_dir / zip_file.name
            if not archive_zip_path.exists():
                try:
                    zip_file.rename(archive_zip_path)
                    print(f"‚úÖ –ü–µ—Ä–µ–º–µ—â–µ–Ω –≤ –∞—Ä—Ö–∏–≤: {zip_file.name}")
                except Exception as e:
                    print(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è {zip_file.name}: {e}")
            else:
                # –£–¥–∞–ª—è–µ–º, –µ—Å–ª–∏ —É–∂–µ –µ—Å—Ç—å –≤ –∞—Ä—Ö–∏–≤–µ
                try:
                    zip_file.unlink()
                    print(f"üóëÔ∏è  –£–¥–∞–ª–µ–Ω –¥—É–±–ª–∏–∫–∞—Ç: {zip_file.name}")
                except Exception as e:
                    print(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è {zip_file.name}: {e}")
    
    # ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï 4: –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∞—Ä—Ö–∏–≤—ã –≤ –ø–∞–ø–∫–µ archived
    for zip_file in archive_dir.glob("*.zip"):
        mod_time = datetime.fromtimestamp(zip_file.stat().st_mtime)
        age_days = (now - mod_time).days
        
        if age_days >= keep_days:
            try:
                zip_file.unlink()
                deleted_count += 1
                print(f"üóëÔ∏è  –£–¥–∞–ª–µ–Ω –∞—Ä—Ö–∏–≤ (—Å—Ç–∞—Ä—à–µ {keep_days} –¥–Ω–µ–π): {zip_file.name}")
            except Exception as e:
                print(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∞—Ä—Ö–∏–≤–∞ {zip_file.name}: {e}")
    
    print(f"\nüìä –ò—Ç–æ–≥–æ: –∑–∞–∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–æ {archived_count}, —É–¥–∞–ª–µ–Ω–æ {deleted_count}")
```

---

### **3. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫–∏**

**–ó–∞–¥–∞—á–∞:** –ï–¥–∏–Ω—ã–π –ø—É—Ç—å –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```python
def generate_html_report(
    self, 
    stats: SessionStats, 
    output_path: Path, 
    report_id: Optional[str] = None,
    charts_dir: Optional[Path] = None  # ‚úÖ –î–æ–±–∞–≤–ª—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä
):
    """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è HTML –æ—Ç—á–µ—Ç–∞"""
    output_path.parent.mkdir(parents=True, exist_ok=True)
    
    # ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ò—Å–ø–æ–ª—å–∑—É–µ–º —è–≤–Ω—ã–π –ø—É—Ç—å –∏–ª–∏ –≤—ã—á–∏—Å–ª—è–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω–æ
    if charts_dir is None:
        # –ï—Å–ª–∏ output_path = logs/reports/report.html, —Ç–æ charts_dir = logs/reports/charts
        charts_dir = output_path.parent / "charts"
    
    # ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ ...
```

---

### **4. –î–æ–±–∞–≤–∏—Ç—å —ç–∫—Å–ø–æ—Ä—Ç —Å–¥–µ–ª–æ–∫ –≤ JSON**

**–ó–∞–¥–∞—á–∞:** –ü–∞—Ä—Å–∏—Ç—å –∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Å–¥–µ–ª–∫–∏

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–∏—Ç—å –≤ `LogAnalyzer`:

```python
def export_trades_to_json(
    self, 
    parsed_logs: List[Dict], 
    output_path: Optional[Path] = None
) -> Path:
    """–≠–∫—Å–ø–æ—Ä—Ç —Å–¥–µ–ª–æ–∫ –≤ JSON"""
    if output_path is None:
        today = datetime.now().strftime("%Y-%m-%d")
        output_path = self.logs_dir / f"trades_{today}.json"
    
    trades = []
    open_positions = {}  # symbol -> {entry, side, size, timestamp}
    
    for log in parsed_logs:
        message = log["message"]
        timestamp = log["timestamp"]
        
        # –û—Ç–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–∏
        if "‚úÖ –ø–æ–∑–∏—Ü–∏—è" in message.lower() and "–æ—Ç–∫—Ä—ã—Ç" in message.lower():
            # –ü–∞—Ä—Å–∏–º: "‚úÖ –ü–æ–∑–∏—Ü–∏—è BTC-USDT LONG –æ—Ç–∫—Ä—ã—Ç–∞ –ø–æ —Ä–µ–∞–ª—å–Ω–æ–º—É —Å–∏–≥–Ω–∞–ª—É"
            match = re.search(r"‚úÖ –ø–æ–∑–∏—Ü–∏—è\s+(\S+)\s+(\w+)\s+–æ—Ç–∫—Ä—ã—Ç", message, re.I)
            if match:
                symbol = match.group(1)
                side = match.group(2).lower()
                
                # –ò—â–µ–º entry price, size
                entry_match = re.search(r"entry[=:]\s*([\d.]+)", message, re.I)
                size_match = re.search(r"size[=:]\s*([\d.]+)", message, re.I)
                
                open_positions[symbol] = {
                    "side": side,
                    "entry_price": float(entry_match.group(1)) if entry_match else None,
                    "size": float(size_match.group(1)) if size_match else None,
                    "timestamp": timestamp,
                }
        
        # –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–∏
        elif "‚úÖ –ø–æ–∑–∏—Ü–∏—è" in message.lower() and "–∑–∞–∫—Ä—ã—Ç" in message.lower():
            # –ü–∞—Ä—Å–∏–º: "‚úÖ –ü–æ–∑–∏—Ü–∏—è BTC-USDT –∑–∞–∫—Ä—ã—Ç–∞ –ø–æ tp, PnL = +0.65 USDT"
            match = re.search(r"‚úÖ –ø–æ–∑–∏—Ü–∏—è\s+(\S+)\s+–∑–∞–∫—Ä—ã—Ç", message, re.I)
            if match:
                symbol = match.group(1)
                
                if symbol in open_positions:
                    pos = open_positions[symbol]
                    
                    # –ò—â–µ–º exit price, PnL
                    exit_match = re.search(r"exit[=:]\s*([\d.]+)", message, re.I)
                    pnl_match = re.search(r"pnl\s*[=:]\s*([\-\+]?[\d.]+)\s*usdt", message, re.I)
                    reason_match = re.search(r"–∑–∞–∫—Ä—ã—Ç\s+(?:–ø–æ|—á–µ—Ä–µ–∑)\s+(\w+)", message, re.I)
                    
                    trade = {
                        "timestamp": pos["timestamp"].isoformat() if pos["timestamp"] else None,
                        "symbol": symbol,
                        "side": pos["side"],
                        "entry_price": pos["entry_price"],
                        "exit_price": float(exit_match.group(1)) if exit_match else None,
                        "size": pos["size"],
                        "net_pnl": float(pnl_match.group(1)) if pnl_match else None,
                        "reason": reason_match.group(1) if reason_match else None,
                        "duration_sec": (timestamp - pos["timestamp"]).total_seconds() if timestamp and pos["timestamp"] else None,
                    }
                    
                    trades.append(trade)
                    del open_positions[symbol]
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ JSON
    output_path.parent.mkdir(parents=True, exist_ok=True)
    with open(output_path, "w", encoding="utf-8") as f:
        json.dump({"trades": trades, "count": len(trades)}, f, indent=2, ensure_ascii=False)
    
    print(f"‚úÖ –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ {len(trades)} —Å–¥–µ–ª–æ–∫ –≤ {output_path}")
    return output_path
```

---

## ‚úÖ –ò–¢–û–ì–û

**–ü—Ä–æ–±–ª–µ–º—ã –Ω–∞–π–¥–µ–Ω—ã:**
1. ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ –ª–æ–≥–æ–≤ - –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞—Ç—Ç–µ—Ä–Ω –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –ª–æ–≥–∞—Ö
2. ‚úÖ –ê—Ä—Ö–∏–≤–∞—Ü–∏—è - –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–æ–≤
3. ‚úÖ –ì—Ä–∞—Ñ–∏–∫–∏ - –ø—É—Ç–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏
4. ‚úÖ JSON —Å–¥–µ–ª–æ–∫ - —ç–∫—Å–ø–æ—Ä—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã:**
1. **–í—ã—Å–æ–∫–∏–π:** –ê—Ä—Ö–∏–≤–∞—Ü–∏—è (–∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è —Ä–∞–±–æ—Ç—ã)
2. **–í—ã—Å–æ–∫–∏–π:** JSON —Å–¥–µ–ª–æ–∫ (—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç)
3. **–°—Ä–µ–¥–Ω–∏–π:** –ì—Ä–∞—Ñ–∏–∫–∏ (–ø—É—Ç–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –ø—Ä–æ–±–ª–µ–º–æ–π)
4. **–°—Ä–µ–¥–Ω–∏–π:** –ü–∞—Ä—Å–∏–Ω–≥ (–Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –ª–æ–≥–∞—Ö)

---

**–î–∞—Ç–∞:** 2025-11-16  
**–°—Ç–∞—Ç—É—Å:** –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω, –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é

