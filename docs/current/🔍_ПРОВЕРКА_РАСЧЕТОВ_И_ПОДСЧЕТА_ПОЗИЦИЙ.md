# –ü–†–û–í–ï–†–ö–ê –†–ê–°–ß–ï–¢–û–í –ò –ü–û–î–°–ß–ï–¢–ê –ü–û–ó–ò–¶–ò–ô

**–î–∞—Ç–∞:** 23 –Ω–æ—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** üîç –ü–†–û–í–ï–†–ö–ê –í –ü–†–û–¶–ï–°–°–ï

---

## üìä –ü–†–û–í–ï–†–ö–ê –†–ê–°–ß–ï–¢–û–í PnL

### –ö–∞–∫ —Å—á–∏—Ç–∞–µ—Ç—Å—è PnL%:

#### 1. –í PositionManager (`_check_tp_only`):
```python
# –°—Ç—Ä–æ–∫–∞ 1048
pnl_percent = (unrealized_pnl / margin_used) * 100
# PnL% = (–ü—Ä–∏–±—ã–ª—å –≤ USD / –ú–∞—Ä–∂–∞ –≤ USD) √ó 100
```
**‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û:** –ü—Ä–æ—Ü–µ–Ω—Ç —Å—á–∏—Ç–∞–µ—Ç—Å—è **–æ—Ç –º–∞—Ä–∂–∏**

#### 2. –í TrailingStopLoss (`get_profit_pct`):
```python
# –°—Ç—Ä–æ–∫–∞ 389-392
if self.side == "long":
    gross_profit_pct = (current_price - self.entry_price) / self.entry_price
else:
    gross_profit_pct = (self.entry_price - current_price) / self.entry_price
# –í—ã—á–∏—Ç–∞–µ–º –∫–æ–º–∏—Å—Å–∏—é
net_profit_pct = gross_profit_pct - self.trading_fee_rate
```
**‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï:** –ü—Ä–æ—Ü–µ–Ω—Ç —Å—á–∏—Ç–∞–µ—Ç—Å—è **–æ—Ç —Ü–µ–Ω—ã**, –∞ –Ω–µ –æ—Ç –º–∞—Ä–∂–∏!

#### 3. –í TrailingSLCoordinator (`update_trailing_stop_loss`):
```python
# –°—Ç—Ä–æ–∫–∞ 493
profit_pct = tsl.get_profit_pct(current_price, include_fees=True)
# –ò—Å–ø–æ–ª—å–∑—É–µ—Ç TrailingStopLoss.get_profit_pct - –ø—Ä–æ—Ü–µ–Ω—Ç –æ—Ç –¶–ï–ù–´
```
**‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï:** –ü—Ä–æ—Ü–µ–Ω—Ç —Å—á–∏—Ç–∞–µ—Ç—Å—è **–æ—Ç —Ü–µ–Ω—ã**, –∞ –Ω–µ –æ—Ç –º–∞—Ä–∂–∏!

---

## ‚ö†Ô∏è –û–ë–ù–ê–†–£–ñ–ï–ù–ù–ê–Ø –ü–†–û–ë–õ–ï–ú–ê: –ù–ï–°–û–û–¢–í–ï–¢–°–¢–í–ò–ï –í –†–ê–°–ß–ï–¢–ê–•

### –ü—Ä–æ–±–ª–µ–º–∞:
- **PositionManager** —Å—á–∏—Ç–∞–µ—Ç PnL% **–æ—Ç –º–∞—Ä–∂–∏**
- **TrailingStopLoss** —Å—á–∏—Ç–∞–µ—Ç PnL% **–æ—Ç —Ü–µ–Ω—ã**
- **TrailingSLCoordinator** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç PnL% **–æ—Ç —Ü–µ–Ω—ã**

### –ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:
- –ü—Ä–∏ leverage 5x: **1% –æ—Ç —Ü–µ–Ω—ã = 5% –æ—Ç –º–∞—Ä–∂–∏**
- –ï—Å–ª–∏ TP=5% –æ—Ç –º–∞—Ä–∂–∏, —Ç–æ –≤ TrailingStopLoss –Ω—É–∂–Ω–æ —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å —Å **1% –æ—Ç —Ü–µ–Ω—ã**
- –ù–æ TrailingStopLoss —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Å **5% –æ—Ç —Ü–µ–Ω—ã** (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ!)

---

## üìä –ü–†–û–í–ï–†–ö–ê –†–ê–°–ß–ï–¢–ê –†–ê–ó–ú–ï–†–ê –ü–û–ó–ò–¶–ò–ô

### –í RiskManager (`calculate_position_size`):

#### –ë–∞–∑–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä:
```python
# –°—Ç—Ä–æ–∫–∞ 416-515
base_usd_size = balance_profile.get("base_position_usd", 30.0)
# –ü—Ä–∏–º–µ–Ω—è–µ–º multiplier –¥–ª—è —Å–∏–º–≤–æ–ª–∞
symbol_multiplier = symbol_profile.get("position_multiplier", 1.0)
base_usd_size *= symbol_multiplier
```

#### –ú–∞—Ä–∂–∞:
```python
# –°—Ç—Ä–æ–∫–∞ 527-529
margin_required = base_usd_size / leverage
# –ú–∞—Ä–∂–∞ = –ù–æ–º–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å / Leverage
```

**‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û:** –†–∞—Å—á–µ—Ç –º–∞—Ä–∂–∏ –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω

---

## üìä –ü–†–û–í–ï–†–ö–ê –ü–†–ò–ú–ï–ù–ï–ù–ò–Ø –ü–ê–†–ê–ú–ï–¢–†–û–í

### TP –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

#### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∏:
1. **Per-regime TP** (–µ—Å–ª–∏ —Ä–µ–∂–∏–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω)
2. **Per-symbol TP** (fallback)
3. **–ì–ª–æ–±–∞–ª—å–Ω—ã–π TP** (fallback)

**‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û:** –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω

#### –ü—Ä–æ–±–ª–µ–º–∞:
- –†–µ–∂–∏–º –Ω–µ –≤—Å–µ–≥–¥–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ø–æ–∑–∏—Ü–∏—é
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è fallback –Ω–∞ per-symbol TP –≤–º–µ—Å—Ç–æ per-regime TP

**‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û:** –†–µ–∂–∏–º —Ç–µ–ø–µ—Ä—å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ø–æ–∑–∏—Ü–∏—é

---

## üîç –ü–†–û–í–ï–†–ö–ê –î–õ–Ø –†–ê–ó–ù–´–• –ü–ê–† –ò –†–ï–ñ–ò–ú–û–í

### BTC-USDT:
- **Ranging:** TP=5.0% –æ—Ç –º–∞—Ä–∂–∏ (‚âà 1.0% –æ—Ç —Ü–µ–Ω—ã –ø—Ä–∏ leverage 5x)
- **Trending:** TP=5.0% –æ—Ç –º–∞—Ä–∂–∏ (‚âà 1.0% –æ—Ç —Ü–µ–Ω—ã)
- **Choppy:** TP=4.0% –æ—Ç –º–∞—Ä–∂–∏ (‚âà 0.8% –æ—Ç —Ü–µ–Ω—ã)

### ETH-USDT:
- **Ranging:** TP=3.5% –æ—Ç –º–∞—Ä–∂–∏ (‚âà 0.7% –æ—Ç —Ü–µ–Ω—ã)
- **Trending:** TP=5.0% –æ—Ç –º–∞—Ä–∂–∏ (‚âà 1.0% –æ—Ç —Ü–µ–Ω—ã)
- **Choppy:** TP=4.0% –æ—Ç –º–∞—Ä–∂–∏ (‚âà 0.8% –æ—Ç —Ü–µ–Ω—ã)

### SOL-USDT:
- **Ranging:** TP=3.5% –æ—Ç –º–∞—Ä–∂–∏ (‚âà 0.7% –æ—Ç —Ü–µ–Ω—ã)
- **Trending:** TP=5.0% –æ—Ç –º–∞—Ä–∂–∏ (‚âà 1.0% –æ—Ç —Ü–µ–Ω—ã)
- **Choppy:** TP=4.0% –æ—Ç –º–∞—Ä–∂–∏ (‚âà 0.8% –æ—Ç —Ü–µ–Ω—ã)

### DOGE-USDT:
- **Ranging:** TP=4.0% –æ—Ç –º–∞—Ä–∂–∏ (‚âà 0.8% –æ—Ç —Ü–µ–Ω—ã)
- **Trending:** TP=4.5% –æ—Ç –º–∞—Ä–∂–∏ (‚âà 0.9% –æ—Ç —Ü–µ–Ω—ã)
- **Choppy:** TP=4.0% –æ—Ç –º–∞—Ä–∂–∏ (‚âà 0.8% –æ—Ç —Ü–µ–Ω—ã)

### XRP-USDT:
- **Ranging:** TP=4.0% –æ—Ç –º–∞—Ä–∂–∏ (‚âà 0.8% –æ—Ç —Ü–µ–Ω—ã)
- **Trending:** TP=4.5% –æ—Ç –º–∞—Ä–∂–∏ (‚âà 0.9% –æ—Ç —Ü–µ–Ω—ã)

**‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û:** –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –¥–ª—è –≤—Å–µ—Ö –ø–∞—Ä –∏ —Ä–µ–∂–∏–º–æ–≤

---

## ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê: –ù–ï–°–û–û–¢–í–ï–¢–°–¢–í–ò–ï –í –†–ê–°–ß–ï–¢–ê–• PnL

### –ü—Ä–æ–±–ª–µ–º–∞:
- **PositionManager** —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç TP —Å PnL% **–æ—Ç –º–∞—Ä–∂–∏**
- **TrailingStopLoss** —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç loss_cut —Å PnL% **–æ—Ç —Ü–µ–Ω—ã**

### –†–µ—à–µ–Ω–∏–µ:
- –ù—É–∂–Ω–æ –ø—Ä–∏–≤–µ—Å—Ç–∏ –≤—Å–µ —Ä–∞—Å—á–µ—Ç—ã –∫ –æ–¥–Ω–æ–º—É –±–∞–∑–∏—Å—É (–æ—Ç –º–∞—Ä–∂–∏)
- –ò–ª–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—Ä–∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–∏

---

## üîß –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –ò–°–ü–†–ê–í–õ–ï–ù–ò–Æ

### 1. –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Ä–∞—Å—á–µ—Ç PnL%
- –í—Å–µ —Ä–∞—Å—á–µ—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å **–æ—Ç –º–∞—Ä–∂–∏**
- –ò–ª–∏ –≤—Å–µ —Ä–∞—Å—á–µ—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å **–æ—Ç —Ü–µ–Ω—ã** —Å —É—á–µ—Ç–æ–º leverage

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- TP/SL/TSL –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–æ–ª–∂–Ω—ã —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å—Å—è —Å PnL% –≤ —Ç–æ–º –∂–µ –±–∞–∑–∏—Å–µ
- –ï—Å–ª–∏ TP=5% –æ—Ç –º–∞—Ä–∂–∏, –∞ PnL% —Å—á–∏—Ç–∞–µ—Ç—Å—è –æ—Ç —Ü–µ–Ω—ã, –Ω—É–∂–Ω–æ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å

### 3. –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å, –æ—Ç —á–µ–≥–æ —Å—á–∏—Ç–∞–µ—Ç—Å—è PnL% (–º–∞—Ä–∂–∏ –∏–ª–∏ —Ü–µ–Ω—ã)
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—é –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø—Ä–∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–∏

---

**–°—Ç–∞—Ç—É—Å:** üîç –û–ë–ù–ê–†–£–ñ–ï–ù–ê –ü–†–û–ë–õ–ï–ú–ê - –ù–£–ñ–ù–û –ò–°–ü–†–ê–í–ò–¢–¨

