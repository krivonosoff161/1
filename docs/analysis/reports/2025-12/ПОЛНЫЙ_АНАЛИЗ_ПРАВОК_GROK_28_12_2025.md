# –ü–û–õ–ù–´–ô –ê–ù–ê–õ–ò–ó –ü–†–ê–í–û–ö GROK –ò –ü–†–û–ï–ö–¢–ê

**–î–∞—Ç–∞:** 28.12.2025  
**–ê–≤—Ç–æ—Ä:** AI Assistant (Composer)  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω

---

## üìã –°–û–î–ï–†–ñ–ê–ù–ò–ï

1. [–ê–Ω–∞–ª–∏–∑ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π Grok](#1-–∞–Ω–∞–ª–∏–∑-–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π-grok)
2. [–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∑–∞–∏–º–æ—Å–≤—è–∑–µ–π –º–æ–¥—É–ª–µ–π](#2-–ø—Ä–æ–≤–µ—Ä–∫–∞-–≤–∑–∞–∏–º–æ—Å–≤—è–∑–µ–π-–º–æ–¥—É–ª–µ–π)
3. [–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã –∏ –Ω–µ–ø–æ–Ω—è—Ç–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã](#3-–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ-–≤–æ–ø—Ä–æ—Å—ã-–∏-–Ω–µ–ø–æ–Ω—è—Ç–Ω—ã–µ-—ç–ª–µ–º–µ–Ω—Ç—ã)
4. [–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–º–µ—á–∞–Ω–∏—è](#4-–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ-–∑–∞–º–µ—á–∞–Ω–∏—è)
5. [–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏](#5-—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏)
6. [–ò—Ç–æ–≥–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞](#6-–∏—Ç–æ–≥–æ–≤–∞—è-–æ—Ü–µ–Ω–∫–∞)

---

## 1. –ê–ù–ê–õ–ò–ó –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô GROK

### ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï #1: –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Ç–∏–ø–æ–≤ –≤ ExitAnalyzer –∏ ParameterProvider

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–í–ï–†–ù–û –ò –†–ï–ê–õ–ò–ó–û–í–ê–ù–û**

**–ß—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç Grok:**
- `max_holding_minutes` –∏–∑ `parameter_provider.get_exit_params()` –º–æ–∂–µ—Ç –±—ã—Ç—å `str` (YAML –ø–∞—Ä—Å–∏—Ç –∫–∞–∫ str –µ—Å–ª–∏ –≤ –∫–∞–≤—ã—á–∫–∞—Ö)
- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ `minutes_in_position >= max_holding_minutes` –ø–∞–¥–∞–µ—Ç —Å `TypeError`
- –ù—É–∂–Ω–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Ç–∏–ø–æ–≤ —á–µ—Ä–µ–∑ `_to_float()`

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞:**

```174:201:src/strategies/scalping/futures/config/parameter_provider.py
                exit_params["sl_atr_multiplier"] = _to_float(
                    exit_params.get("sl_atr_multiplier"),
                    "sl_atr_multiplier",
                    2.0,  # ‚úÖ Default —É–≤–µ–ª–∏—á–µ–Ω —Å 1.5 –¥–æ 2.0
                )
                exit_params["tp_atr_multiplier"] = _to_float(
                    exit_params.get("tp_atr_multiplier"), "tp_atr_multiplier", 1.0
                )
                exit_params["min_profit_for_extension"] = _to_float(
                    exit_params.get("min_profit_for_extension"),
                    "min_profit_for_extension",
                    0.4,
                )
                exit_params["extension_percent"] = _to_float(
                    exit_params.get("extension_percent"), "extension_percent", 100.0
                )
                exit_params["min_holding_minutes"] = _to_float(
                    exit_params.get("min_holding_minutes"),
                    "min_holding_minutes",
                    0.5,  # ‚úÖ Default –¥–ª—è ranging: 0.5 –º–∏–Ω—É—Ç—ã
                )
```

**–í—ã–≤–æ–¥:** ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –†–ï–ê–õ–ò–ó–û–í–ê–ù–û –ö–û–†–†–ï–ö–¢–ù–û**
- –ú–µ—Ç–æ–¥ `_to_float()` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤—Å–µ—Ö —á–∏—Å–ª–æ–≤—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Ç–∏–ø–æ–≤ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ `parameter_provider.get_exit_params()`
- –í `exit_analyzer.py` —Ç–∞–∫–∂–µ –µ—Å—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è (—Å—Ç—Ä–æ–∫–∏ 3200-3202)

**–í–∑–∞–∏–º–æ—Å–≤—è–∑–∏:**
- `ParameterProvider.get_exit_params()` ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ `ExitAnalyzer._generate_exit_for_ranging()` (—Å—Ç—Ä–æ–∫–∞ 3200)
- `ExitAnalyzer` –ø–æ–ª—É—á–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —á–µ—Ä–µ–∑ `self.parameter_provider.get_exit_params()`
- –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Ç–∏–ø–æ–≤ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç `TypeError` –ø—Ä–∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–∏ `minutes_in_position >= max_holding_minutes`

---

### ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï #2: –ú–µ—Ç–æ–¥ check_safety –≤ MarginMonitor

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–í–ï–†–ù–û –ò –†–ï–ê–õ–ò–ó–û–í–ê–ù–û**

**–ß—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç Grok:**
- –í `risk_manager.py` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `self.margin_monitor.check_safety()`
- –ú–µ—Ç–æ–¥ –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª –≤ `MarginMonitor`
- –í—ã–∑—ã–≤–∞–ª `AttributeError` –∏ –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –æ—Ç–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–π

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞:**

```77:179:src/strategies/scalping/futures/risk/margin_monitor.py
    async def check_safety(
        self,
        position_size_usd: float,
        current_positions: Dict[str, Any],
        orchestrator: Optional[Any] = None,  # ‚úÖ –î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –±–∞–ª–∞–Ω—Å—É
        data_registry: Optional[Any] = None,  # ‚úÖ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö
    ) -> bool:
        """
        ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï (28.12.2025): –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –º–∞—Ä–∂–∏ –ø–µ—Ä–µ–¥ –æ—Ç–∫—Ä—ã—Ç–∏–µ–º –ø–æ–∑–∏—Ü–∏–∏.

        Args:
            position_size_usd: –†–∞–∑–º–µ—Ä –Ω–æ–≤–æ–π –ø–æ–∑–∏—Ü–∏–∏ –≤ USD
            current_positions: –¢–µ–∫—É—â–∏–µ –ø–æ–∑–∏—Ü–∏–∏ (–¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –æ–±—â–µ–π –º–∞—Ä–∂–∏)
            orchestrator: Orchestrator –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –±–∞–ª–∞–Ω—Å—É (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
            data_registry: DataRegistry –¥–ª—è —á—Ç–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

        Returns:
            bool: True –µ—Å–ª–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ
        """
        try:
            # ‚úÖ –ü–æ–ª—É—á–∞–µ–º –±–∞–ª–∞–Ω—Å –∏ –º–∞—Ä–∂—É –∏–∑ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
            current_balance = 0.0
            used_margin = 0.0

            # –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: Orchestrator
            if orchestrator:
                try:
                    if hasattr(orchestrator, "client") and orchestrator.client:
                        current_balance = await orchestrator.client.get_balance() or 0.0
                    if hasattr(orchestrator, "_get_used_margin"):
                        used_margin = await orchestrator._get_used_margin() or 0.0
                except Exception as e:
                    logger.debug(
                        f"‚ö†Ô∏è MarginMonitor: –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –±–∞–ª–∞–Ω—Å –∏–∑ orchestrator: {e}"
                    )

            # –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: DataRegistry (–∏–∑ orchestrator ~300)
            if (current_balance == 0.0 or used_margin == 0.0) and data_registry:
                try:
                    margin_data = await data_registry.get_margin()
                    balance_data = await data_registry.get_balance()
                    if margin_data:
                        used_margin = margin_data.get("used", 0.0)
                    if balance_data:
                        current_balance = balance_data.get(
                            "equity", balance_data.get("total", 0.0)
                        )
                    logger.debug(
                        f"‚úÖ MarginMonitor: –î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã –∏–∑ data_registry "
                        f"(balance=${current_balance:.2f}, used_margin=${used_margin:.2f})"
                    )
                except Exception as e:
                    logger.debug(
                        f"‚ö†Ô∏è MarginMonitor: –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –±–∞–ª–∞–Ω—Å –∏–∑ data_registry: {e}"
                    )

            # Fallback: –µ—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∏–ª–∏ –¥–∞–Ω–Ω—ã–µ
            if current_balance == 0.0:
                logger.warning(
                    "‚ö†Ô∏è MarginMonitor: –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –±–∞–ª–∞–Ω—Å, –∏—Å–ø–æ–ª—å–∑—É–µ–º fallback 1000.0"
                )
                current_balance = 1000.0  # Fallback

            # ‚úÖ –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ç—Ä–µ–±—É–µ–º—É—é –º–∞—Ä–∂—É (—Å —É—á–µ—Ç–æ–º leverage)
            # ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û (28.12.2025): RiskConfig –Ω–µ –∏–º–µ–µ—Ç –º–µ—Ç–æ–¥–∞ .get(), –∏—Å–ø–æ–ª—å–∑—É–µ–º getattr()
            if isinstance(self.config, dict):
                leverage = self.config.get("leverage", 5)
                max_margin_ratio = self.config.get("max_margin_ratio", 0.8)
            else:
                leverage = getattr(self.config, "leverage", 5)
                max_margin_ratio = getattr(self.config, "max_margin_ratio", 0.8)
            required_margin = position_size_usd / leverage

            # ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –º–∞—Ä–∂–∏
            available, reason = self.check_margin_available(
                required_margin, current_balance, used_margin
            )

            # ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –º–∞—Ä–∂–∏
            margin_ratio = self.get_margin_ratio(
                current_balance, used_margin + required_margin
            )

            if not available:
                logger.warning(f"‚ùå MarginMonitor: Margin unsafe: {reason}")
                return False

            if margin_ratio > max_margin_ratio:
                logger.warning(
                    f"‚ùå MarginMonitor: Margin ratio too high: {margin_ratio:.2%} > {max_margin_ratio:.2%} "
                    f"(balance=${current_balance:.2f}, used=${used_margin:.2f}, required=${required_margin:.2f})"
                )
                return False

            logger.debug(
                f"‚úÖ MarginMonitor: Margin safe: ratio={margin_ratio:.2%} <= {max_margin_ratio:.2%}, "
                f"available=${current_balance - used_margin:.2f} >= required=${required_margin:.2f}"
            )
            return True

        except Exception as e:
            logger.error(f"‚ùå MarginMonitor: Error in check_safety: {e}", exc_info=True)
            return False  # –ë–µ–∑–æ–ø–∞—Å–Ω–µ–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏ –æ—à–∏–±–∫–µ
```

**–í—ã–≤–æ–¥:** ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –†–ï–ê–õ–ò–ó–û–í–ê–ù–û –ö–û–†–†–ï–ö–¢–ù–û**
- –ú–µ—Ç–æ–¥ `check_safety()` –¥–æ–±–∞–≤–ª–µ–Ω –≤ `MarginMonitor`
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö (orchestrator, data_registry, fallback)
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `False` –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö

**–í–∑–∞–∏–º–æ—Å–≤—è–∑–∏:**
- `RiskManager.check_margin_safety()` ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç `self.margin_monitor.check_safety()`
- `SignalCoordinator.execute_signal()` ‚Üí –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –º–∞—Ä–∂—É —á–µ—Ä–µ–∑ `risk_manager.check_margin_safety()`
- –ú–µ—Ç–æ–¥ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–π –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–π –º–∞—Ä–∂–µ

**‚ö†Ô∏è –í–û–ü–†–û–°:** –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –ª–∏ `orchestrator` –∏ `data_registry` –≤ `risk_manager.check_margin_safety()` –ø—Ä–∏ –≤—ã–∑–æ–≤–µ `check_safety()`. –ï—Å–ª–∏ –Ω–µ—Ç - –º–µ—Ç–æ–¥ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å fallback –±–∞–ª–∞–Ω—Å 1000.0, —á—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–≤–µ—Ä–Ω–æ.

---

### ‚ö†Ô∏è –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï #9: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ —Å–∏–≥–Ω–∞–ª–æ–≤

**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è **–ß–ê–°–¢–ò–ß–ù–û –†–ï–ê–õ–ò–ó–û–í–ê–ù–û**

**–ß—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç Grok:**
- –ú–µ—Ç–æ–¥ `_log_block_stats()` –¥–æ–±–∞–≤–ª–µ–Ω, –Ω–æ –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è
- `process_signals()` –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è –∏–∑-–∑–∞ `use_legacy_signal_processing=False`
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –≤ `check_for_signals`, –Ω–æ –Ω–µ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞:**

```647:663:src/strategies/scalping/futures/coordinators/signal_coordinator.py
    def _log_block_stats(self):
        """
        ‚úÖ –ù–û–í–û–ï (28.12.2025): –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ —Å–∏–≥–Ω–∞–ª–æ–≤.
        
        –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–∏–≥–Ω–∞–ª–æ–≤ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–∏—á–∏–Ω –Ω–∏–∑–∫–æ–π –∫–æ–Ω–≤–µ—Ä—Å–∏–∏.
        """
        total_blocked = sum(self._block_stats.values())
        if total_blocked > 0:
            logger.info(
                f"üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ —Å–∏–≥–Ω–∞–ª–æ–≤ (–≤—Å–µ–≥–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ: {total_blocked}):\n"
                f"   - Circuit breaker: {self._block_stats['circuit_breaker']}\n"
                f"   - Side blocked: {self._block_stats['side_blocked']}\n"
                f"   - Low strength: {self._block_stats['low_strength']}\n"
                f"   - Existing position: {self._block_stats['existing_position']}\n"
                f"   - Margin unsafe: {self._block_stats['margin_unsafe']}\n"
                f"   - Other: {self._block_stats['other']}"
            )
```

**–ü—Ä–æ–±–ª–µ–º–∞:**

```158:167:src/strategies/scalping/futures/coordinators/signal_coordinator.py
    async def process_signals(self, signals: List[Dict[str, Any]]):
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ—Ä–≥–æ–≤—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤"""
        try:
            # üîÑ –ù–û–í–û–ï: –æ—Ç–∫–ª—é—á–∞–µ–º legacy-–æ–±—Ä–∞–±–æ—Ç–∫—É, —á—Ç–æ–±—ã –Ω–µ –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã,
            # –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏—Ö–æ–¥—è—Ç –∏–∑ WebSocket (_check_for_signals)
            if not getattr(self.scalping_config, "use_legacy_signal_processing", False):
                logger.debug(
                    "‚è≠Ô∏è Legacy process_signals –ø—Ä–æ–ø—É—â–µ–Ω (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è realtime –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤ —á–µ—Ä–µ–∑ WebSocket)."
                )
                return
```

**–í—ã–≤–æ–¥:** ‚ö†Ô∏è **–ß–ê–°–¢–ò–ß–ù–û –†–ï–ê–õ–ò–ó–û–í–ê–ù–û**
- –ú–µ—Ç–æ–¥ `_log_block_stats()` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –ù–æ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ `process_signals()`, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è –¥–ª—è legacy —Ä–µ–∂–∏–º–∞
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –≤ `check_for_signals()` (—Å—Ç—Ä–æ–∫–∏ 136-144), –Ω–æ –Ω–µ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å –≤—ã–∑–æ–≤ `_log_block_stats()` –≤ –∫–æ–Ω—Ü–µ `check_for_signals()` –∏–ª–∏ –≤ `execute_signal_from_price()` –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–∏–≥–Ω–∞–ª–æ–≤.

**–í–∑–∞–∏–º–æ—Å–≤—è–∑–∏:**
- `SignalCoordinator.check_for_signals()` ‚Üí —Å–æ–±–∏—Ä–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –≤ `self._block_stats`
- `SignalCoordinator.process_signals()` ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç `_log_block_stats()` –≤ `finally` –±–ª–æ–∫–µ (—Å—Ç—Ä–æ–∫–∞ 645)
- –ù–æ `process_signals()` –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è –¥–ª—è legacy —Ä–µ–∂–∏–º–∞, –ø–æ—ç—Ç–æ–º—É —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω–µ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è

---

### ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï #14: –£—á–µ—Ç Slippage –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–∏–≥–Ω–∞–ª–æ–≤

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–í–ï–†–ù–û –ò –†–ï–ê–õ–ò–ó–û–í–ê–ù–û**

**–ß—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç Grok:**
- Slippage —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–∏–≥–Ω–∞–ª–æ–≤
- –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ —Ü–µ–Ω—ã: –¥–ª—è BUY —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ 0.1%, –¥–ª—è SELL —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —É—Ä–æ–≤–Ω–µ DEBUG

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞:**

```1740:1780:src/strategies/scalping/futures/signal_generator.py
    def _adjust_price_for_slippage(self, symbol: str, price: float, side: str) -> float:
        """
        –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ —Ü–µ–Ω—ã —Å–∏–≥–Ω–∞–ª–∞ —Å —É—á–µ—Ç–æ–º slippage.

        Args:
            symbol: –¢–æ—Ä–≥–æ–≤—ã–π —Å–∏–º–≤–æ–ª
            price: –ò—Å—Ö–æ–¥–Ω–∞—è —Ü–µ–Ω–∞ —Å–∏–≥–Ω–∞–ª–∞
            side: –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–¥–µ–ª–∫–∏ ("buy" –∏–ª–∏ "sell")

        Returns:
            –°–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ü–µ–Ω–∞ —Å —É—á–µ—Ç–æ–º slippage
        """
        if not price or price <= 0:
            return price
        
        try:
            # –ü–æ–ª—É—á–∞–µ–º slippage –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
            slippage_pct = 0.1  # Fallback: 0.1%
            
            # –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –∏–∑ scalping_config
            if hasattr(self.scalping_config, "slippage_percent"):
                slippage_pct = float(getattr(self.scalping_config, "slippage_percent", 0.1))
            elif isinstance(self.scalping_config, dict):
                slippage_pct = float(self.scalping_config.get("slippage_percent", 0.1))
            
            # –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º —Ü–µ–Ω—É –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            if side.lower() == "buy":
                # –î–ª—è LONG: —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Ü–µ–Ω—É –≤—Ö–æ–¥–∞ (–ø–æ–∫—É–ø–∞–µ–º –¥–æ—Ä–æ–∂–µ –∏–∑-–∑–∞ slippage)
                adjusted_price = price * (1 + slippage_pct / 100)
            else:  # sell
                # –î–ª—è SHORT: —É–º–µ–Ω—å—à–∞–µ–º —Ü–µ–Ω—É –≤—Ö–æ–¥–∞ (–ø—Ä–æ–¥–∞–µ–º –¥–µ—à–µ–≤–ª–µ –∏–∑-–∑–∞ slippage)
                adjusted_price = price * (1 - slippage_pct / 100)
            
            logger.debug(
                f"üí∞ {symbol}: –¶–µ–Ω–∞ —Å–∏–≥–Ω–∞–ª–∞ —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∞ –Ω–∞ slippage {slippage_pct:.3f}% "
                f"({side.upper()}): {price:.6f} ‚Üí {adjusted_price:.6f}"
            )
            return adjusted_price
        except Exception as e:
            logger.debug(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ —Ü–µ–Ω—ã –Ω–∞ slippage –¥–ª—è {symbol}: {e}")
            return price  # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∏—Å—Ö–æ–¥–Ω—É—é —Ü–µ–Ω—É –ø—Ä–∏ –æ—à–∏–±–∫–µ
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–¥–µ:**
- `_generate_ma_signals()` ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç `_adjust_price_for_slippage()` (—Å—Ç—Ä–æ–∫–∞ 4619)
- `_generate_macd_signals()` ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç `_adjust_price_for_slippage()` (—Å—Ç—Ä–æ–∫–∏ 3146, 3237)
- `_generate_rsi_signals()` ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç `_adjust_price_for_slippage()` (—Å—Ç—Ä–æ–∫–∏ 3511, 3612)
- `_generate_bb_signals()` ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç `_adjust_price_for_slippage()` (—Å—Ç—Ä–æ–∫–∏ 3822, 3940)

**–í—ã–≤–æ–¥:** ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –†–ï–ê–õ–ò–ó–û–í–ê–ù–û –ö–û–†–†–ï–ö–¢–ù–û**
- –ú–µ—Ç–æ–¥ `_adjust_price_for_slippage()` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–æ –≤—Å–µ—Ö –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞—Ö —Å–∏–≥–Ω–∞–ª–æ–≤ (MA, MACD, RSI, BB)
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —É—Ä–æ–≤–Ω–µ DEBUG
- –†–∞—Å—á–µ—Ç –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω: –¥–ª—è BUY `price * (1 + slippage_pct / 100)`, –¥–ª—è SELL `price * (1 - slippage_pct / 100)`

**–í–∑–∞–∏–º–æ—Å–≤—è–∑–∏:**
- `SignalGenerator._generate_base_signals()` ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã —Å–∏–≥–Ω–∞–ª–æ–≤ (MA, MACD, RSI, BB)
- –ö–∞–∂–¥—ã–π –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –≤—ã–∑—ã–≤–∞–µ—Ç `_adjust_price_for_slippage()` –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º —Å–∏–≥–Ω–∞–ª–∞
- –°–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ü–µ–Ω–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ `signal["price"]` –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏

---

### ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï #12: ATRProvider —Å fallback –∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–í–ï–†–ù–û –ò –†–ï–ê–õ–ò–ó–û–í–ê–ù–û**

**–ß—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç Grok:**
- –ü—Ä–æ–±–ª–µ–º–Ω—ã–π fallback —á–µ—Ä–µ–∑ `IndicatorManager.get_indicator()` —É–¥–∞–ª–µ–Ω
- ATR –ø–æ–ª—É—á–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `ATRProvider` –±–µ–∑ –æ—à–∏–±–æ–∫
- TTL —É–≤–µ–ª–∏—á–µ–Ω –¥–æ 60s –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞:**

```36:103:src/strategies/scalping/futures/indicators/atr_provider.py
    def get_atr(self, symbol: str, fallback: Optional[float] = None) -> Optional[float]:
        """
        –ü–æ–ª—É—á–∏—Ç—å ATR –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è —Å–∏–º–≤–æ–ª–∞ (—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ).

        –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:
        1. –ö—ç—à (–µ—Å–ª–∏ —Å–≤–µ–∂–∏–π)
        2. DataRegistry._indicators (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
        3. Fallback –∑–Ω–∞—á–µ–Ω–∏–µ

        Args:
            symbol: –¢–æ—Ä–≥–æ–≤—ã–π —Å–∏–º–≤–æ–ª
            fallback: –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –µ—Å–ª–∏ ATR –Ω–µ –Ω–∞–π–¥–µ–Ω

        Returns:
            ATR –∑–Ω–∞—á–µ–Ω–∏–µ –∏–ª–∏ None
        """
        import time

        # 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à
        if symbol in self._atr_cache:
            cache_time = self._cache_timestamps.get(symbol, 0)
            current_time = time.time()

            if current_time - cache_time < self._cache_ttl_seconds:
                # –ö—ç—à —Å–≤–µ–∂–∏–π
                return self._atr_cache[symbol]

        # 2. –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –∏–∑ DataRegistry (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
        if self.data_registry:
            try:
                # DataRegistry._indicators - —ç—Ç–æ —Å–ª–æ–≤–∞—Ä—å, –¥–æ—Å—Ç—É–ø —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π
                if hasattr(self.data_registry, "_indicators"):
                    indicators = self.data_registry._indicators.get(symbol, {})
                    if indicators:
                        # –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ –∫–ª—é—á–∏ –¥–ª—è ATR
                        atr_value = (
                            indicators.get("atr")
                            or indicators.get("ATR")
                            or indicators.get("atr_1m")
                            or indicators.get("atr_14")
                        )

                        if atr_value is not None:
                            try:
                                atr_float = float(atr_value)
                                # –û–±–Ω–æ–≤–ª—è–µ–º –∫—ç—à
                                self._atr_cache[symbol] = atr_float
                                self._cache_timestamps[symbol] = time.time()
                                logger.debug(
                                    f"‚úÖ ATRProvider: ATR –ø–æ–ª—É—á–µ–Ω –∏–∑ DataRegistry –¥–ª—è {symbol}: {atr_float:.6f}"
                                )
                                return atr_float
                            except (ValueError, TypeError):
                                pass
            except Exception as e:
                logger.debug(
                    f"‚ö†Ô∏è ATRProvider: –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è ATR –∏–∑ DataRegistry –¥–ª—è {symbol}: {e}"
                )

        # 3. Fallback
        if fallback is not None:
            logger.debug(
                f"‚ö†Ô∏è ATRProvider: ATR –Ω–µ –Ω–∞–π–¥–µ–Ω –¥–ª—è {symbol}, –∏—Å–ø–æ–ª—å–∑—É–µ–º fallback: {fallback:.6f}"
            )
            return fallback

        logger.debug(f"‚ö†Ô∏è ATRProvider: ATR –Ω–µ –Ω–∞–π–¥–µ–Ω –¥–ª—è {symbol}, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º None")
        return None
```

**TTL –∫—ç—à–∞:**

```33:34:src/strategies/scalping/futures/indicators/atr_provider.py
        # TTL –∫—ç—à–∞: 60 —Å–µ–∫—É–Ω–¥ (‚úÖ –£–í–ï–õ–ò–ß–ï–ù–û 28.12.2025 –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤)
        self._cache_ttl_seconds = 60.0
```

**–í—ã–≤–æ–¥:** ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –†–ï–ê–õ–ò–ó–û–í–ê–ù–û –ö–û–†–†–ï–ö–¢–ù–û**
- `ATRProvider` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å TTL=60 —Å–µ–∫—É–Ω–¥
- –ü–æ–ª—É—á–∞–µ—Ç ATR –∏–∑ `DataRegistry._indicators` —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç fallback –∑–Ω–∞—á–µ–Ω–∏–µ
- –ü—Ä–æ–±–ª–µ–º–Ω—ã–π fallback —á–µ—Ä–µ–∑ `IndicatorManager.get_indicator()` —É–¥–∞–ª–µ–Ω –∏–∑ `exit_analyzer.py`

**–í–∑–∞–∏–º–æ—Å–≤—è–∑–∏:**
- `ExitAnalyzer` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `self.atr_provider.get_atr(symbol)` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è ATR
- `ATRProvider` –∫—ç—à–∏—Ä—É–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ `DataRegistry._indicators`
- `DataRegistry` –æ–±–Ω–æ–≤–ª—è–µ—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã —á–µ—Ä–µ–∑ WebSocket –∏ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ —Ä–∞—Å—á–µ—Ç—ã

---

### ‚ö†Ô∏è –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï #15: TALib Warnings (Silent Fallback)

**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è **–ß–ê–°–¢–ò–ß–ù–û –†–ï–ê–õ–ò–ó–û–í–ê–ù–û**

**–ß—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç Grok:**
- Warnings –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ debug —É—Ä–æ–≤–µ–Ω—å
- Silent fallback —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –∏–∑–±—ã—Ç–æ—á–Ω—ã—Ö –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞:**

**TALibRSI (‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ):**

```39:45:src/indicators/talib_wrapper.py
        except Exception as e:
            # ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û (28.12.2025): Silent fallback –±–µ–∑ warning (—Ç–æ–ª—å–∫–æ debug –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏)
            logger.debug(
                f"TALibRSI: –û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ —á–µ—Ä–µ–∑ TA-Lib ({type(e).__name__}: {e}), –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è fallback"
            )
            # Fallback –Ω–∞ –ø—Ä–æ—Å—Ç–æ–µ —Å—Ä–µ–¥–Ω–µ–µ (–Ω–µ –∏–¥–µ–∞–ª—å–Ω–æ, –Ω–æ –ª—É—á—à–µ —á–µ–º –æ—à–∏–±–∫–∞)
            rsi_value = 50.0
```

**TALibEMA (‚ùå –ù–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ):**

```88:94:src/indicators/talib_wrapper.py
        except Exception as e:
            # ‚úÖ –õ–û–ì–ò–†–û–í–ê–ù–ò–ï: –õ–æ–≥–∏—Ä—É–µ–º –æ—à–∏–±–∫—É –∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º fallback
            logger.warning(
                f"‚ö†Ô∏è TALibEMA: –û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ —á–µ—Ä–µ–∑ TA-Lib ({type(e).__name__}: {e}), –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è fallback"
            )
            # Fallback –Ω–∞ –ø—Ä–æ—Å—Ç–æ–µ —Å—Ä–µ–¥–Ω–µ–µ
            ema = float(np.mean(data[-self.period :]))
```

**TALibATR (‚ùå –ù–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ):**

```143:149:src/indicators/talib_wrapper.py
        except Exception as e:
            # ‚úÖ –õ–û–ì–ò–†–û–í–ê–ù–ò–ï: –õ–æ–≥–∏—Ä—É–µ–º –æ—à–∏–±–∫—É –∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º fallback
            logger.warning(
                f"‚ö†Ô∏è TALibATR: –û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ —á–µ—Ä–µ–∑ TA-Lib ({type(e).__name__}: {e}), –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è fallback"
            )
            # Fallback –Ω–∞ –ø—Ä–æ—Å—Ç–æ–µ —Å—Ä–µ–¥–Ω–µ–µ True Range
            atr_value = 0.0
```

**–í—ã–≤–æ–¥:** ‚ö†Ô∏è **–ß–ê–°–¢–ò–ß–ù–û –†–ï–ê–õ–ò–ó–û–í–ê–ù–û**
- `TALibRSI` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `logger.debug()` –≤–º–µ—Å—Ç–æ `logger.warning()` ‚úÖ
- `TALibEMA`, `TALibATR`, `TALibMACD`, `TALibSMA`, `TALibBollingerBands` –≤—Å–µ –µ—â–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç `logger.warning()` ‚ùå

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ó–∞–º–µ–Ω–∏—Ç—å `logger.warning()` –Ω–∞ `logger.debug()` –≤–æ –≤—Å–µ—Ö TALib –æ–±–µ—Ä—Ç–∫–∞—Ö –¥–ª—è silent fallback.

**–í–∑–∞–∏–º–æ—Å–≤—è–∑–∏:**
- TALib –æ–±–µ—Ä—Ç–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ `IndicatorManager` –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤
- –û—à–∏–±–∫–∏ TALib –º–æ–≥—É—Ç –≤–æ–∑–Ω–∏–∫–∞—Ç—å –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- Silent fallback –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –∏–∑–±—ã—Ç–æ—á–Ω—ã–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –≤ –ª–æ–≥–∞—Ö

---

### ‚ùì –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï #13: Retry –ª–æ–≥–∏–∫–∞ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø–æ–∑–∏—Ü–∏–π

**–°—Ç–∞—Ç—É—Å:** ‚ùì **–ù–ï –ù–ê–ô–î–ï–ù–û**

**–ß—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç Grok:**
- Retry –ª–æ–≥–∏–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (3 –ø–æ–ø—ã—Ç–∫–∏ —Å –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏ 0.5, 1.0, 2.0 —Å–µ–∫)
- –ù–æ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –µ—ë —Ä–∞–±–æ—Ç–µ (–≤–æ–∑–º–æ–∂–Ω–æ, –ø–æ–∑–∏—Ü–∏–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è —Å—Ä–∞–∑—É)

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞:**

–í `_sync_positions_with_exchange()` (—Å—Ç—Ä–æ–∫–∏ 1866-2150) **–ù–ï–¢** —è–≤–Ω–æ–π retry –ª–æ–≥–∏–∫–∏ —Å 3 –ø–æ–ø—ã—Ç–∫–∞–º–∏ –∏ –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏.

**–í—ã–≤–æ–¥:** ‚ùì **RETRY –õ–û–ì–ò–ö–ê –ù–ï –†–ï–ê–õ–ò–ó–û–í–ê–ù–ê**
- –í –∫–æ–¥–µ –Ω–µ—Ç retry –ª–æ–≥–∏–∫–∏ —Å 3 –ø–æ–ø—ã—Ç–∫–∞–º–∏ –∏ –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏ 0.5, 1.0, 2.0 —Å–µ–∫
- –í–æ–∑–º–æ–∂–Ω–æ, Grok –∏–º–µ–ª –≤ –≤–∏–¥—É –¥—Ä—É–≥—É—é —á–∞—Å—Ç—å –∫–æ–¥–∞ –∏–ª–∏ —ç—Ç–æ –±—ã–ª–æ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ, –Ω–æ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å retry –ª–æ–≥–∏–∫—É –≤ `_sync_positions_with_exchange()` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫ API:

```python
async def _sync_positions_with_exchange(self, force: bool = False) -> None:
    """–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ–∑–∏—Ü–∏–π —Å –±–∏—Ä–∂–µ–π —Å retry –ª–æ–≥–∏–∫–æ–π"""
    retry_delays = [0.5, 1.0, 2.0]  # –ó–∞–¥–µ—Ä–∂–∫–∏ –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏
    max_retries = 3
    
    for attempt in range(max_retries):
        try:
            exchange_positions = await self.client.get_positions()
            # ... –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–∑–∏—Ü–∏–π ...
            break  # –£—Å–ø–µ—à–Ω–æ
        except Exception as e:
            if attempt < max_retries - 1:
                await asyncio.sleep(retry_delays[attempt])
                logger.debug(f"‚ö†Ô∏è Retry {attempt + 1}/{max_retries} —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø–æ–∑–∏—Ü–∏–π: {e}")
            else:
                logger.error(f"‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ–∑–∏—Ü–∏–∏ –ø–æ—Å–ª–µ {max_retries} –ø–æ–ø—ã—Ç–æ–∫: {e}")
                return
```

**–í–∑–∞–∏–º–æ—Å–≤—è–∑–∏:**
- `_sync_positions_with_exchange()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑ `orchestrator.run()` –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏
- –¢–∞–∫–∂–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ DRIFT_ADD (–ø–æ–∑–∏—Ü–∏—è –Ω–∞ –±–∏—Ä–∂–µ, –Ω–æ –Ω–µ—Ç –≤ —Ä–µ–µ—Å—Ç—Ä–µ)
- Retry –ª–æ–≥–∏–∫–∞ –ø–æ–º–æ–∂–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–µ—Ç–µ–≤—ã–µ –æ—à–∏–±–∫–∏ –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã —Å API

---

### ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï #3/#11: WebSocket –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¥–ª—è –ø–æ–∑–∏—Ü–∏–π

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–†–ï–ê–õ–ò–ó–û–í–ê–ù–û**

**–ß—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç Grok:**
- –í `orchestrator.py` –µ—Å—Ç—å `PrivateWebSocketManager`, –Ω–æ –Ω–µ –ø–æ–¥–ø–∏—Å–∞–Ω –Ω–∞ private/positions
- –ù—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `PrivateWebSocketManager` –¥–ª—è –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ private/positions

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞:**

**PrivateWebSocketManager:**

```189:219:src/strategies/scalping/futures/private_websocket_manager.py
    async def subscribe_positions(self, callback: Callable) -> bool:
        """
        –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–π.

        Args:
            callback: Callback –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –ø–æ–∑–∏—Ü–∏–π

        Returns:
            True –µ—Å–ª–∏ –ø–æ–¥–ø–∏—Å–∫–∞ —É—Å–ø–µ—à–Ω–∞
        """
        if not self.connected or not self.authenticated:
            logger.error("‚ùå Private WebSocket –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω –∏–ª–∏ –Ω–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω")
            return False

        try:
            self.position_callback = callback

            subscribe_msg = {
                "op": "subscribe",
                "args": [{"channel": "positions", "instType": "SWAP"}],
            }

            await self.ws.send_str(json.dumps(subscribe_msg))
            self.subscribed_channels.add("positions")

            logger.info("üìä –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –ø–æ–∑–∏—Ü–∏–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞")
            return True

        except Exception as e:
            logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –ø–æ–∑–∏—Ü–∏–∏: {e}")
            return False
```

**WebSocketCoordinator:**

```163:173:src/strategies/scalping/futures/coordinators/websocket_coordinator.py
        # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Private WebSocket –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø–æ–∑–∏—Ü–∏–π/–æ—Ä–¥–µ—Ä–æ–≤
        if self.private_ws_manager:
            try:
                connected = await self.private_ws_manager.connect()
                if connected:
                    # –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–π
                    await self.private_ws_manager.subscribe_positions(
                        callback=self.handle_private_ws_positions
                    )
                    # –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ä–¥–µ—Ä–æ–≤
                    await self.private_ws_manager.subscribe_orders
```

**–í—ã–≤–æ–¥:** ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –†–ï–ê–õ–ò–ó–û–í–ê–ù–û**
- `PrivateWebSocketManager` –∏–º–µ–µ—Ç –º–µ—Ç–æ–¥ `subscribe_positions()`
- `WebSocketCoordinator` –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –ø–æ–∑–∏—Ü–∏–∏ —á–µ—Ä–µ–∑ `private_ws_manager.subscribe_positions()`
- Callback `handle_private_ws_positions` –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–π

**–í–∑–∞–∏–º–æ—Å–≤—è–∑–∏:**
- `WebSocketCoordinator.initialize_websocket()` ‚Üí –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –ø–æ–∑–∏—Ü–∏–∏ —á–µ—Ä–µ–∑ `private_ws_manager`
- `WebSocketCoordinator.handle_private_ws_positions()` ‚Üí –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–π –∏ –≤—ã–∑—ã–≤–∞–µ—Ç `_sync_positions_with_exchange()`
- –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –ø–æ–∑–∏—Ü–∏–π –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –Ω–∞ –±–∏—Ä–∂–µ

---

## 2. –ü–†–û–í–ï–†–ö–ê –í–ó–ê–ò–ú–û–°–í–Ø–ó–ï–ô –ú–û–î–£–õ–ï–ô

### 2.1. –¶–µ–ø–æ—á–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–∏–≥–Ω–∞–ª–æ–≤

**–ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö:**

1. **WebSocket ‚Üí SignalCoordinator.check_for_signals()**
   - WebSocket –ø–æ–ª—É—á–∞–µ—Ç —Ü–µ–Ω—É ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç `check_for_signals(symbol, price)`
   - `check_for_signals()` –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–∏–≥–Ω–∞–ª—ã —á–µ—Ä–µ–∑ `signal_generator.generate_signals()`
   - –°–æ–±–∏—Ä–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –≤ `self._block_stats`

2. **SignalGenerator.generate_signals()**
   - –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–∏–≥–Ω–∞–ª—ã –¥–ª—è –≤—Å–µ—Ö —Å–∏–º–≤–æ–ª–æ–≤
   - –ü—Ä–∏–º–µ–Ω—è–µ—Ç `_adjust_price_for_slippage()` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–∏–≥–Ω–∞–ª–∞
   - –§–∏–ª—å—Ç—Ä—É–µ—Ç —Å–∏–≥–Ω–∞–ª—ã –ø–æ strength, –≤—Ä–µ–º–µ–Ω–∏, —Ä–µ–∂–∏–º—É

3. **SignalCoordinator.execute_signal()**
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –º–∞—Ä–∂—É —á–µ—Ä–µ–∑ `risk_manager.check_margin_safety()`
   - `RiskManager.check_margin_safety()` ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç `margin_monitor.check_safety()`
   - –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –ø–æ–∑–∏—Ü–∏—é —á–µ—Ä–µ–∑ `order_executor.execute_signal()`

4. **OrderExecutor.execute_signal()**
   - –†–∞–∑–º–µ—â–∞–µ—Ç –æ—Ä–¥–µ—Ä –Ω–∞ –±–∏—Ä–∂–µ
   - –ü–æ—Å–ª–µ –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç entry_price —Å –±–∏—Ä–∂–µ–π

5. **Orchestrator._sync_positions_with_exchange()**
   - –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç –ø–æ–∑–∏—Ü–∏–∏ —Å –±–∏—Ä–∂–µ–π
   - –û–±–Ω–æ–≤–ª—è–µ—Ç `active_positions` –∏ `total_margin_used`
   - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç DRIFT_ADD (–ø–æ–∑–∏—Ü–∏—è –Ω–∞ –±–∏—Ä–∂–µ, –Ω–æ –Ω–µ—Ç –≤ —Ä–µ–µ—Å—Ç—Ä–µ)

**–ü—Ä–æ–±–ª–µ–º—ã –≤ —Ü–µ–ø–æ—á–∫–µ:**

1. ‚ö†Ô∏è **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –Ω–µ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è**
   - `check_for_signals()` —Å–æ–±–∏—Ä–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É, –Ω–æ –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç `_log_block_stats()`
   - `process_signals()` –≤—ã–∑—ã–≤–∞–µ—Ç `_log_block_stats()`, –Ω–æ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è –¥–ª—è legacy —Ä–µ–∂–∏–º–∞

2. ‚ùì **Retry –ª–æ–≥–∏–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç**
   - `_sync_positions_with_exchange()` –Ω–µ –∏–º–µ–µ—Ç retry –ª–æ–≥–∏–∫–∏ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫

---

### 2.2. –¶–µ–ø–æ—á–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏—è–º–∏

**–ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö:**

1. **PositionManager._check_position_safety()**
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –º–∞—Ä–∂–∏
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç TP (Take Profit)
   - –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –∏–∑ `trailing_sl_coordinator.update_trailing_stop_loss()`

2. **ExitAnalyzer.analyze_position()**
   - –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø–æ–∑–∏—Ü–∏—é –ø–æ —Ä–µ–∂–∏–º—É —Ä—ã–Ω–∫–∞
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `atr_provider.get_atr()` –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ ATR-based TP/SL
   - –ü–æ–ª—É—á–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —á–µ—Ä–µ–∑ `parameter_provider.get_exit_params()` —Å –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–µ–π —Ç–∏–ø–æ–≤

3. **TrailingSLCoordinator.update_trailing_stop_loss()**
   - –û–±–Ω–æ–≤–ª—è–µ—Ç trailing stop loss –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ü–µ–Ω—ã
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —É—Å–ª–æ–≤–∏—è –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ TSL
   - –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –∏–∑ `orchestrator.run()`

**–ü—Ä–æ–±–ª–µ–º—ã –≤ —Ü–µ–ø–æ—á–∫–µ:**

1. ‚úÖ **–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Ç–∏–ø–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç**
   - `ParameterProvider.get_exit_params()` –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –≤—Å–µ —á–∏—Å–ª–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —á–µ—Ä–µ–∑ `_to_float()`
   - `ExitAnalyzer` –ø–æ–ª—É—á–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Ç–∏–ø—ã –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è

2. ‚úÖ **ATRProvider —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ**
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å TTL=60s
   - –ü–æ–ª—É—á–∞–µ—Ç ATR –∏–∑ `DataRegistry._indicators` —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
   - –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç fallback –∑–Ω–∞—á–µ–Ω–∏–µ

---

### 2.3. –¶–µ–ø–æ—á–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∏—Å–∫–∞–º–∏

**–ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö:**

1. **RiskManager.check_margin_safety()**
   - –í—ã–∑—ã–≤–∞–µ—Ç `margin_monitor.check_safety()`
   - –ü–µ—Ä–µ–¥–∞–µ—Ç `orchestrator` –∏ `data_registry` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞

2. **MarginMonitor.check_safety()**
   - –ü–æ–ª—É—á–∞–µ—Ç –±–∞–ª–∞–Ω—Å –∏–∑ `orchestrator.client.get_balance()` –∏–ª–∏ `data_registry.get_balance()`
   - –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Ç—Ä–µ–±—É–µ–º—É—é –º–∞—Ä–∂—É —Å —É—á–µ—Ç–æ–º leverage
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –º–∞—Ä–∂–∏ –∏ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

3. **SignalCoordinator.execute_signal()**
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –º–∞—Ä–∂—É –ø–µ—Ä–µ–¥ –æ—Ç–∫—Ä—ã—Ç–∏–µ–º –ø–æ–∑–∏—Ü–∏–∏
   - –ë–ª–æ–∫–∏—Ä—É–µ—Ç —Å–∏–≥–Ω–∞–ª, –µ—Å–ª–∏ –º–∞—Ä–∂–∞ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–∞
   - –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Å—á–µ—Ç—á–∏–∫ `_block_stats["margin_unsafe"]`

**–ü—Ä–æ–±–ª–µ–º—ã –≤ —Ü–µ–ø–æ—á–∫–µ:**

1. ‚ö†Ô∏è **–ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–¥–∞—á—É –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤**
   - `RiskManager.check_margin_safety()` –¥–æ–ª–∂–µ–Ω –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å `orchestrator` –∏ `data_registry` –≤ `check_safety()`
   - –ï—Å–ª–∏ –Ω–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è - –º–µ—Ç–æ–¥ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å fallback –±–∞–ª–∞–Ω—Å 1000.0

---

## 3. –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –í–û–ü–†–û–°–´ –ò –ù–ï–ü–û–ù–Ø–¢–ù–´–ï –≠–õ–ï–ú–ï–ù–¢–´

### 3.1. –ù–µ–ø–æ–Ω—è—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ —ç–ª–µ–º–µ–Ω—Ç—ã

#### ‚ùì –í–æ–ø—Ä–æ—Å #1: –ì–¥–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `check_for_signals()` –∏–∑ WebSocket?

**–ü—Ä–æ–±–ª–µ–º–∞:** Grok —É–ø–æ–º–∏–Ω–∞–µ—Ç, —á—Ç–æ `check_for_signals()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑ WebSocket, –Ω–æ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–æ—á–Ω–æ–µ –º–µ—Å—Ç–æ –≤—ã–∑–æ–≤–∞.

**–ì–¥–µ –∏—Å–∫–∞—Ç—å:**
- `WebSocketCoordinator.handle_ticker()` ‚Üí –¥–æ–ª–∂–µ–Ω –≤—ã–∑—ã–≤–∞—Ç—å `check_signals_callback`
- `Orchestrator` –ø–µ—Ä–µ–¥–∞–µ—Ç `check_for_signals` –∫–∞–∫ callback –≤ `WebSocketCoordinator`

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `check_signals_callback` –ø—Ä–∞–≤–∏–ª—å–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ü–µ–Ω—ã –∏–∑ WebSocket.

---

#### ‚ùì –í–æ–ø—Ä–æ—Å #2: –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç `use_legacy_signal_processing`?

**–ü—Ä–æ–±–ª–µ–º–∞:** `process_signals()` –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è, –µ—Å–ª–∏ `use_legacy_signal_processing=False`. –ù–æ –≥–¥–µ —Ç–æ–≥–¥–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —Å–∏–≥–Ω–∞–ª—ã?

**–ì–¥–µ –∏—Å–∫–∞—Ç—å:**
- `SignalCoordinator.check_for_signals()` ‚Üí –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–∏–≥–Ω–∞–ª—ã –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- `SignalCoordinator.execute_signal_from_price()` ‚Üí –∏—Å–ø–æ–ª–Ω—è–µ—Ç —Å–∏–≥–Ω–∞–ª –∏–∑ —Ü–µ–Ω—ã WebSocket

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –£—Ç–æ—á–Ω–∏—Ç—å –ª–æ–≥–∏–∫—É –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–∏–≥–Ω–∞–ª–æ–≤:
- –ï—Å–ª–∏ `use_legacy_signal_processing=False` ‚Üí —Å–∏–≥–Ω–∞–ª—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `check_for_signals()` –∏–∑ WebSocket
- –ï—Å–ª–∏ `use_legacy_signal_processing=True` ‚Üí —Å–∏–≥–Ω–∞–ª—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `process_signals()` –∏–∑ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏—Ö —Ü–∏–∫–ª–æ–≤

---

#### ‚ùì –í–æ–ø—Ä–æ—Å #3: –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç `execute_signal_from_price()`?

**–ü—Ä–æ–±–ª–µ–º–∞:** Grok —É–ø–æ–º–∏–Ω–∞–µ—Ç `execute_signal_from_price()`, –Ω–æ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –≥–¥–µ –æ–Ω –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏ –∫–∞–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–∏–≥–Ω–∞–ª—ã.

**–ì–¥–µ –∏—Å–∫–∞—Ç—å:**
- `SignalCoordinator.execute_signal_from_price()` ‚Üí –¥–æ–ª–∂–µ–Ω –≤—ã–∑—ã–≤–∞—Ç—å—Å—è –∏–∑ WebSocket callback
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–∏–≥–Ω–∞–ª, –ø–æ–ª—É—á–µ–Ω–Ω—ã–π –∏–∑ —Ü–µ–Ω—ã WebSocket

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `execute_signal_from_price()` –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–∏–≥–Ω–∞–ª—ã –∏ –≤—ã–∑—ã–≤–∞–µ—Ç `_log_block_stats()` –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏.

---

#### ‚ùì –í–æ–ø—Ä–æ—Å #4: –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç fallback –±–∞–ª–∞–Ω—Å 1000.0 –≤ `MarginMonitor.check_safety()`?

**–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ –±–∞–ª–∞–Ω—Å –Ω–µ –ø–æ–ª—É—á–µ–Ω –∏–∑ `orchestrator` –∏ `data_registry`, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è fallback 1000.0. –≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–≤–µ—Ä–Ω–æ –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** 
- –î–æ–±–∞–≤–∏—Ç—å –±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ fallback –±–∞–ª–∞–Ω—Å–∞
- –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–π –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `orchestrator` –∏ `data_registry` –≤—Å–µ–≥–¥–∞ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ `check_safety()`

---

#### ‚ùì –í–æ–ø—Ä–æ—Å #5: –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç `_get_used_margin()` –≤ orchestrator?

**–ü—Ä–æ–±–ª–µ–º–∞:** `MarginMonitor.check_safety()` –≤—ã–∑—ã–≤–∞–µ—Ç `orchestrator._get_used_margin()`, –Ω–æ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —ç—Ç–æ—Ç –º–µ—Ç–æ–¥ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

**–ì–¥–µ –∏—Å–∫–∞—Ç—å:**
- `Orchestrator._get_used_margin()` ‚Üí –¥–æ–ª–∂–µ–Ω —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—É—é –º–∞—Ä–∂—É –∏–∑ `active_positions`
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `total_margin_used_ref` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω–æ–π –º–∞—Ä–∂–∏

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `_get_used_margin()` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω–æ–π –º–∞—Ä–∂–∏.

---

### 3.2. –ù–µ–ø–æ–Ω—è—Ç–Ω—ã–µ –≤–∑–∞–∏–º–æ—Å–≤—è–∑–∏

#### ‚ùì –í–æ–ø—Ä–æ—Å #6: –ö–∞–∫ —Å–≤—è–∑–∞–Ω—ã `SignalCoordinator` –∏ `WebSocketCoordinator`?

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù—É–∂–Ω–æ –ø–æ–Ω—è—Ç—å, –∫–∞–∫ `WebSocketCoordinator` –≤—ã–∑—ã–≤–∞–µ—Ç –º–µ—Ç–æ–¥—ã `SignalCoordinator` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–∏–≥–Ω–∞–ª–æ–≤.

**–ì–¥–µ –∏—Å–∫–∞—Ç—å:**
- `WebSocketCoordinator.__init__()` ‚Üí –ø–æ–ª—É—á–∞–µ—Ç `check_signals_callback` –∫–∞–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä
- `WebSocketCoordinator.handle_ticker()` ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç `check_signals_callback(symbol, price)`
- `Orchestrator` –ø–µ—Ä–µ–¥–∞–µ—Ç `signal_coordinator.check_for_signals` –∫–∞–∫ callback

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ callback –ø—Ä–∞–≤–∏–ª—å–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ü–µ–Ω—ã –∏–∑ WebSocket.

---

#### ‚ùì –í–æ–ø—Ä–æ—Å #7: –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç `DataRegistry` –∏ –≥–¥–µ –æ–Ω –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è?

**–ü—Ä–æ–±–ª–µ–º–∞:** `ATRProvider` –ø–æ–ª—É—á–∞–µ—Ç ATR –∏–∑ `DataRegistry._indicators`, –Ω–æ –Ω—É–∂–Ω–æ –ø–æ–Ω—è—Ç—å, –∫–∞–∫ –∏ –∫–æ–≥–¥–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è `DataRegistry`.

**–ì–¥–µ –∏—Å–∫–∞—Ç—å:**
- `DataRegistry.update_indicators()` ‚Üí –æ–±–Ω–æ–≤–ª—è–µ—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã
- `DataRegistry` –º–æ–∂–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è —á–µ—Ä–µ–∑ WebSocket –∏–ª–∏ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ —Ä–∞—Å—á–µ—Ç—ã

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `DataRegistry` –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Ä–µ–≥—É–ª—è—Ä–Ω–æ –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤.

---

## 4. –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ó–ê–ú–ï–ß–ê–ù–ò–Ø

### üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–º–µ—á–∞–Ω–∏–µ #1: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –Ω–µ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `_log_block_stats()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ `process_signals()`, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è –¥–ª—è legacy —Ä–µ–∂–∏–º–∞
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –≤ `check_for_signals()`, –Ω–æ –Ω–µ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è

**–í–ª–∏—è–Ω–∏–µ:**
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ—Ç—Å–ª–µ–¥–∏—Ç—å –ø—Ä–∏—á–∏–Ω—ã –Ω–∏–∑–∫–æ–π –∫–æ–Ω–≤–µ—Ä—Å–∏–∏ —Å–∏–≥–Ω–∞–ª–æ–≤
- –ù–µ—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ —Å–∏–≥–Ω–∞–ª–æ–≤

**–†–µ—à–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–∏—Ç—å –≤—ã–∑–æ–≤ `_log_block_stats()` –≤ –∫–æ–Ω—Ü–µ `check_for_signals()` –∏–ª–∏ –≤ `execute_signal_from_price()` –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–∏–≥–Ω–∞–ª–æ–≤.

---

### üü° –í–∞–∂–Ω–æ–µ –∑–∞–º–µ—á–∞–Ω–∏–µ #2: Retry –ª–æ–≥–∏–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `_sync_positions_with_exchange()` –Ω–µ –∏–º–µ–µ—Ç retry –ª–æ–≥–∏–∫–∏ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫ API
- Grok —É–ø–æ–º–∏–Ω–∞–µ—Ç retry –ª–æ–≥–∏–∫—É (3 –ø–æ–ø—ã—Ç–∫–∏ —Å –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏ 0.5, 1.0, 2.0 —Å–µ–∫), –Ω–æ –æ–Ω–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞

**–í–ª–∏—è–Ω–∏–µ:**
- –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–µ—Ç–µ–≤—ã–µ –æ—à–∏–±–∫–∏ –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã —Å API –º–æ–≥—É—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø—Ä–æ–ø—É—Å–∫—É —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø–æ–∑–∏—Ü–∏–π
- DRIFT_ADD –º–æ–∂–µ—Ç –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å—Å—è –ø—Ä–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ—à–∏–±–∫–∞—Ö

**–†–µ—à–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–∏—Ç—å retry –ª–æ–≥–∏–∫—É –≤ `_sync_positions_with_exchange()` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫.

---

### üü° –í–∞–∂–Ω–æ–µ –∑–∞–º–µ—á–∞–Ω–∏–µ #3: TALib warnings –Ω–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –¢–æ–ª—å–∫–æ `TALibRSI` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `logger.debug()` –≤–º–µ—Å—Ç–æ `logger.warning()`
- –û—Å—Ç–∞–ª—å–Ω—ã–µ TALib –æ–±–µ—Ä—Ç–∫–∏ (`TALibEMA`, `TALibATR`, `TALibMACD`, `TALibSMA`, `TALibBollingerBands`) –≤—Å–µ –µ—â–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç `logger.warning()`

**–í–ª–∏—è–Ω–∏–µ:**
- –ò–∑–±—ã—Ç–æ—á–Ω—ã–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –≤ –ª–æ–≥–∞—Ö –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö TALib
- –ó–∞—Ç—Ä—É–¥–Ω—è–µ—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º

**–†–µ—à–µ–Ω–∏–µ:**
–ó–∞–º–µ–Ω–∏—Ç—å `logger.warning()` –Ω–∞ `logger.debug()` –≤–æ –≤—Å–µ—Ö TALib –æ–±–µ—Ä—Ç–∫–∞—Ö –¥–ª—è silent fallback.

---

### üü¢ –ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ–µ –∑–∞–º–µ—á–∞–Ω–∏–µ #4: Fallback –±–∞–ª–∞–Ω—Å –≤ MarginMonitor

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ï—Å–ª–∏ –±–∞–ª–∞–Ω—Å –Ω–µ –ø–æ–ª—É—á–µ–Ω –∏–∑ `orchestrator` –∏ `data_registry`, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è fallback 1000.0
- –≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–≤–µ—Ä–Ω–æ –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞

**–í–ª–∏—è–Ω–∏–µ:**
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –º–∞—Ä–∂–∏ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞
- –ú–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –æ—Ç–∫—Ä—ã—Ç–∏—é –ø–æ–∑–∏—Ü–∏–π –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–π –º–∞—Ä–∂–µ –∏–ª–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ –ø—Ä–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–π –º–∞—Ä–∂–µ

**–†–µ—à–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–∏—Ç—å –±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ fallback –±–∞–ª–∞–Ω—Å–∞
- –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–π –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `orchestrator` –∏ `data_registry` –≤—Å–µ–≥–¥–∞ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ `check_safety()`

---

## 5. –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:

1. **–î–æ–±–∞–≤–∏—Ç—å –≤—ã–∑–æ–≤ `_log_block_stats()` –≤ `check_for_signals()`**
   - –§–∞–π–ª: `src/strategies/scalping/futures/coordinators/signal_coordinator.py`
   - –ú–µ—Å—Ç–æ: –í –∫–æ–Ω—Ü–µ –º–µ—Ç–æ–¥–∞ `check_for_signals()` –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–∏–≥–Ω–∞–ª–æ–≤
   - –≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç –≤–∏–¥–µ—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

2. **–î–æ–±–∞–≤–∏—Ç—å retry –ª–æ–≥–∏–∫—É –≤ `_sync_positions_with_exchange()`**
   - –§–∞–π–ª: `src/strategies/scalping/futures/orchestrator.py`
   - –ú–µ—Å—Ç–æ: –í –Ω–∞—á–∞–ª–µ –º–µ—Ç–æ–¥–∞ `_sync_positions_with_exchange()`
   - Retry: 3 –ø–æ–ø—ã—Ç–∫–∏ —Å –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏ 0.5, 1.0, 2.0 —Å–µ–∫

3. **–ó–∞–º–µ–Ω–∏—Ç—å `logger.warning()` –Ω–∞ `logger.debug()` –≤–æ –≤—Å–µ—Ö TALib –æ–±–µ—Ä—Ç–∫–∞—Ö**
   - –§–∞–π–ª: `src/indicators/talib_wrapper.py`
   - –ö–ª–∞—Å—Å—ã: `TALibEMA`, `TALibATR`, `TALibMACD`, `TALibSMA`, `TALibBollingerBands`

### –í–∞–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:

4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–¥–∞—á—É –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤ `RiskManager.check_margin_safety()`**
   - –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ `orchestrator` –∏ `data_registry` –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ `margin_monitor.check_safety()`
   - –ï—Å–ª–∏ –Ω–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è - –∏—Å–ø—Ä–∞–≤–∏—Ç—å –≤—ã–∑–æ–≤

5. **–î–æ–±–∞–≤–∏—Ç—å –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ fallback –±–∞–ª–∞–Ω—Å–∞**
   - –§–∞–π–ª: `src/strategies/scalping/futures/risk/margin_monitor.py`
   - –ú–µ—Å—Ç–æ: –í –º–µ—Ç–æ–¥–µ `check_safety()` –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ fallback –±–∞–ª–∞–Ω—Å–∞
   - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å WARNING –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ fallback –±–∞–ª–∞–Ω—Å–∞

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:

6. **–°–ª–µ–¥–∏—Ç—å –∑–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ —Å–∏–≥–Ω–∞–ª–æ–≤**
   - –ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è `_log_block_stats()` –≤ `check_for_signals()` –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –ª–æ–≥–∏
   - –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ø—Ä–∏—á–∏–Ω—ã –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ (circuit_breaker, side_blocked, low_strength, margin_unsafe)

7. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É retry –ª–æ–≥–∏–∫–∏**
   - –ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è retry –ª–æ–≥–∏–∫–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ retry –ø–æ–ø—ã—Ç–æ–∫
   - –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —É—Å–ø–µ—à–Ω–æ—Å—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø–æ–∑–∏—Ü–∏–π –ø–æ—Å–ª–µ retry

---

## 6. –ò–¢–û–ì–û–í–ê–Ø –û–¶–ï–ù–ö–ê

### ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (5 –∏–∑ 8):

1. ‚úÖ **#1: –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Ç–∏–ø–æ–≤** - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤ `ParameterProvider.get_exit_params()`
2. ‚úÖ **#2: –ú–µ—Ç–æ–¥ check_safety** - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤ `MarginMonitor`
3. ‚úÖ **#14: –£—á–µ—Ç slippage** - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤–æ –≤—Å–µ—Ö –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞—Ö —Å–∏–≥–Ω–∞–ª–æ–≤
4. ‚úÖ **#12: ATRProvider** - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏ fallback
5. ‚úÖ **#3/#11: WebSocket –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —á–µ—Ä–µ–∑ `PrivateWebSocketManager`

### ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏ (3 –∏–∑ 8):

1. ‚ö†Ô∏è **#9: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫** - –ú–µ—Ç–æ–¥ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω, –Ω–æ –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ `check_for_signals()`
2. ‚ö†Ô∏è **#15: TALib warnings** - –¢–æ–ª—å–∫–æ `TALibRSI` –∏—Å–ø—Ä–∞–≤–ª–µ–Ω, –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç `logger.warning()`
3. ‚ùì **#13: Retry –ª–æ–≥–∏–∫–∞** - –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ `_sync_positions_with_exchange()`

### –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞: **7/10**

**–ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã:**
- –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (#1, #2) —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- Slippage —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–∏–≥–Ω–∞–ª–æ–≤
- ATRProvider —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- WebSocket –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¥–ª—è –ø–æ–∑–∏—Ü–∏–π —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞

**–û–±–ª–∞—Å—Ç–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è:**
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –Ω–µ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è (—Ç—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏)
- Retry –ª–æ–≥–∏–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç (—Ç—Ä–µ–±—É–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏)
- TALib warnings –Ω–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã (—Ç—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏)

**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –∑–∞–ø—É—Å–∫—É:** ‚úÖ **–î–ê** - –±–æ—Ç –≥–æ—Ç–æ–≤ –∫ —Ç–æ—Ä–≥–æ–≤–ª–µ, –Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –∏ retry –ª–æ–≥–∏–∫—É –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏.

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 28.12.2025  
**–í–µ—Ä—Å–∏—è:** 1.0  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω

