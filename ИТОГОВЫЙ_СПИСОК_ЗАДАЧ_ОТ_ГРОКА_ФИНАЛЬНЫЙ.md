# üéØ –ò—Ç–æ–≥–æ–≤—ã–π —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á –æ—Ç –ì—Ä–æ–∫–∞ (–§–ò–ù–ê–õ–¨–ù–ê–Ø –í–ï–†–°–ò–Ø)

> **–î–∞—Ç–∞:** 21 –¥–µ–∫–∞–±—Ä—è 2025  
> **–ò—Å—Ç–æ—á–Ω–∏–∫:** –ê–Ω–∞–ª–∏–∑—ã –ì—Ä–æ–∫–∞ 4.1 + –ø—Ä–æ–≤–µ—Ä–∫–∞ Cursor + –¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è –ì—Ä–æ–∫–∞  
> **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π ‚Üí –í–∞–∂–Ω—ã–π ‚Üí –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π  
> **–§–∏–ª–æ—Å–æ—Ñ–∏—è:** –ì–∏–±–∫–∞—è –∏ –∞–¥–∞–ø—Ç–∏–≤–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞, –∞ –Ω–µ —É–ø—Ä–æ—â–µ–Ω–Ω–∞—è

---

## üî¥ –ü–†–ò–û–†–ò–¢–ï–¢ 1: –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### 1.1. Adaptive Profit Harvesting (PH) - –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û!

**–ü—Ä–æ–±–ª–µ–º–∞:**
- PH threshold —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π ($0.10) –¥–ª—è –≤—Å–µ—Ö –±–∞–ª–∞–Ω—Å–æ–≤ –∏ —Ä–∞–∑–º–µ—Ä–æ–≤ –ø–æ–∑–∏—Ü–∏–π
- –ü—Ä–∏ –±–∞–ª–∞–Ω—Å–µ $1000: PH = $0.10 = 0.013% –æ—Ç notional ($750) ‚Üí –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –ø—Ä–∏ –º–∏–∫—Ä–æ–ø—Ä–∏–±—ã–ª–∏
- –ü—Ä–∏ –ª–µ—Å—Ç–Ω–∏—á–Ω–æ–º –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–∏ (3 –¥–æ–ª–∏–≤–∫–∏, $2,100 notional): PH = $0.10 = 0.0048% ‚Üí –ö–ê–¢–ê–°–¢–†–û–§–ê!

**–†–µ—à–µ–Ω–∏–µ:**
–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Adaptive PH –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–æ—Ü–µ–Ω—Ç–∞ –æ—Ç –º–∞—Ä–∂–∏ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤—Å–µ—Ö —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤.

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ:**

**–§–∞–π–ª:** `src/strategies/scalping/futures/position_manager.py`

**–ú–µ—Ç–æ–¥:** `_check_profit_harvesting()` (—Å—Ç—Ä–æ–∫–∏ ~1597-1950)

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
```python
# –ë–´–õ–û:
ph_threshold = float(regime_config.get("ph_threshold", 0.0))

# –°–¢–ê–õ–û (–ì–ò–ë–ö–ê–Ø –°–ò–°–¢–ï–ú–ê):
ph_threshold_type = regime_config.get("ph_threshold_type", "fixed")
if ph_threshold_type == "margin_percent":
    ph_threshold_percent = regime_config.get("ph_threshold_percent", 1.5)
    # –ü–æ–ª—É—á–∞–µ–º margin_used –∏–∑ –ø–æ–∑–∏—Ü–∏–∏ (—Å fallback –Ω–∞ metadata)
    margin_used = (
        position.get("margin", 0) 
        or position.get("margin_used", 0)
        or (metadata.margin_used if metadata else 0)
        or 0
    )
    
    if margin_used > 0:
        ph_threshold = margin_used * (ph_threshold_percent / 100)
        logger.debug(
            f"üîç PH –¥–ª—è {symbol}: Adaptive threshold | "
            f"margin=${margin_used:.2f}, percent={ph_threshold_percent}%, "
            f"threshold=${ph_threshold:.2f}"
        )
    else:
        # Fallback –Ω–∞ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π, –µ—Å–ª–∏ margin –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω
        ph_threshold = float(regime_config.get("ph_threshold", 0.0))
        logger.warning(
            f"‚ö†Ô∏è PH –¥–ª—è {symbol}: margin –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π threshold=${ph_threshold:.2f}"
        )
else:
    ph_threshold = float(regime_config.get("ph_threshold", 0.0))

# ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï: –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫—É –Ω–∞ –∫–æ–º–∏—Å—Å–∏–∏ (–£–ñ–ï –ï–°–¢–¨ –≤ –∫–æ–¥–µ, —Å—Ç—Ä–æ–∫–∞ 1781)
# ph_threshold_adjusted = ph_threshold + commission
# –ù–û! –ù—É–∂–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –î–û –∏ –ü–û–°–õ–ï –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏:
logger.debug(
    f"üîç PH –¥–ª—è {symbol}: –ü–æ—Ä–æ–≥ –î–û –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ –Ω–∞ –∫–æ–º–∏—Å—Å–∏–∏ | "
    f"threshold=${ph_threshold:.2f}, commission=${commission:.4f}"
)
ph_threshold_adjusted = ph_threshold + commission
logger.info(
    f"üîç PH –¥–ª—è {symbol}: –ü–æ—Ä–æ–≥ –ü–û–°–õ–ï –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ –Ω–∞ –∫–æ–º–∏—Å—Å–∏–∏ | "
    f"original=${ph_threshold:.2f}, adjusted=${ph_threshold_adjusted:.2f}, "
    f"notional=${notional:.2f}, ph_percent_from_notional={(ph_threshold_adjusted/notional*100):.4f}%"
)
```

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–Ω—Ñ–∏–≥–µ:**

**–§–∞–π–ª:** `config/config_futures.yaml`

**–°–µ–∫—Ü–∏—è:** `scalping.adaptive_regime.by_regime`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
```yaml
trending:
  ph_enabled: true
  ph_threshold_type: "margin_percent"  # ‚úÖ –ù–û–í–û–ï: "fixed" –∏–ª–∏ "margin_percent"
  ph_threshold_percent: 2.5  # ‚úÖ –ì–†–û–ö: 2.5% –¥–ª—è trending (0.5% –æ—Ç notional, –±–æ–ª—å—à–µ –º–µ—Å—Ç–∞ –¥–ª—è —Ä–æ—Å—Ç–∞)
  ph_threshold: 0.12  # ‚úÖ –û—Å—Ç–∞–≤–∏—Ç—å –¥–ª—è fallback (–µ—Å–ª–∏ type="fixed")
  ph_time_limit: 600

ranging:
  ph_enabled: true
  ph_threshold_type: "margin_percent"  # ‚úÖ –ù–û–í–û–ï
  ph_threshold_percent: 1.5  # ‚úÖ 1.5% –¥–ª—è ranging (0.3% –æ—Ç notional, —Å—Ç–∞–Ω–¥–∞—Ä—Ç)
  ph_threshold: 0.10  # ‚úÖ –û—Å—Ç–∞–≤–∏—Ç—å –¥–ª—è fallback
  ph_time_limit: 1200

choppy:
  ph_enabled: true
  ph_threshold_type: "margin_percent"  # ‚úÖ –ù–û–í–û–ï
  ph_threshold_percent: 1.0  # ‚úÖ –ì–†–û–ö: 1.0% –¥–ª—è choppy (0.2% –æ—Ç notional, –±—ã—Å—Ç—Ä–µ–µ —Ñ–∏–∫—Å–∞—Ü–∏—è)
  ph_threshold: 0.1  # ‚úÖ –û—Å—Ç–∞–≤–∏—Ç—å –¥–ª—è fallback
  ph_time_limit: 60
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –î–ª—è $150 –º–∞—Ä–∂–∏ (ranging): PH = $2.25 (1.5% –æ—Ç $150) = 0.3% –æ—Ç notional $750 ‚úÖ
- –î–ª—è $420 –º–∞—Ä–∂–∏ (3 –¥–æ–ª–∏–≤–∫–∏, ranging): PH = $6.30 (1.5% –æ—Ç $420) = 0.3% –æ—Ç notional $2,100 ‚úÖ
- PH –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è —Å —Ä–∞–∑–º–µ—Ä–æ–º –ø–æ–∑–∏—Ü–∏–∏!
- –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –Ω–∞ –∫–æ–º–∏—Å—Å–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –∏ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è!

---

### 1.2. Adaptive Profit Drawdown - –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û!

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `min_profit_to_activate_usd` —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π ($0.5) –¥–ª—è –≤—Å–µ—Ö –±–∞–ª–∞–Ω—Å–æ–≤
- –ü—Ä–∏ –±–∞–ª–∞–Ω—Å–µ $1000: –∞–∫—Ç–∏–≤–∞—Ü–∏—è –ø—Ä–∏ $0.5 = 0.067% –æ—Ç notional ($750) ‚Üí —Å–ª–∏—à–∫–æ–º —Ä–∞–Ω–æ
- –ü—Ä–∏ –ª–µ—Å—Ç–Ω–∏—á–Ω–æ–º –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–∏ ($2,100 notional): –∞–∫—Ç–∏–≤–∞—Ü–∏—è –ø—Ä–∏ $0.5 = 0.024% ‚Üí –ö–ê–¢–ê–°–¢–†–û–§–ê!

**–†–µ—à–µ–Ω–∏–µ:**
–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Adaptive Profit Drawdown –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–æ—Ü–µ–Ω—Ç–∞ –æ—Ç –º–∞—Ä–∂–∏.

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ:**

**–§–∞–π–ª:** `src/strategies/scalping/futures/position_manager.py`

**–ú–µ—Ç–æ–¥:** –ì–¥–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è `min_profit_to_activate_usd` (–Ω—É–∂–Ω–æ –Ω–∞–π—Ç–∏ –º–µ—Ç–æ–¥ –ø—Ä–æ–≤–µ—Ä–∫–∏ Profit Drawdown)

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
```python
# –ë–´–õ–û:
min_profit_to_activate_usd = profit_drawdown_config.get("min_profit_to_activate_usd", 0.5)

# –°–¢–ê–õ–û (–ì–ò–ë–ö–ê–Ø –°–ò–°–¢–ï–ú–ê):
min_profit_to_activate_type = profit_drawdown_config.get("min_profit_to_activate_type", "fixed")
if min_profit_to_activate_type == "margin_percent":
    min_profit_to_activate_percent = profit_drawdown_config.get("min_profit_to_activate_percent", 3.0)
    # –ü–æ–ª—É—á–∞–µ–º margin_used –∏–∑ –ø–æ–∑–∏—Ü–∏–∏ (—Å fallback –Ω–∞ metadata)
    margin_used = (
        position.get("margin", 0) 
        or position.get("margin_used", 0)
        or (metadata.margin_used if metadata else 0)
        or 0
    )
    
    if margin_used > 0:
        min_profit_to_activate_usd = margin_used * (min_profit_to_activate_percent / 100)
        logger.debug(
            f"üîç Profit Drawdown –¥–ª—è {symbol}: Adaptive activation | "
            f"margin=${margin_used:.2f}, percent={min_profit_to_activate_percent}%, "
            f"activation_threshold=${min_profit_to_activate_usd:.2f}, "
            f"notional=${notional:.2f}, activation_percent_from_notional={(min_profit_to_activate_usd/notional*100):.4f}%"
        )
    else:
        # Fallback –Ω–∞ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π
        min_profit_to_activate_usd = profit_drawdown_config.get("min_profit_to_activate_usd", 0.5)
        logger.warning(
            f"‚ö†Ô∏è Profit Drawdown –¥–ª—è {symbol}: margin –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π threshold=${min_profit_to_activate_usd:.2f}"
        )
else:
    min_profit_to_activate_usd = profit_drawdown_config.get("min_profit_to_activate_usd", 0.5)
```

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–Ω—Ñ–∏–≥–µ:**

**–§–∞–π–ª:** `config/config_futures.yaml`

**–°–µ–∫—Ü–∏—è:** `scalping.profit_drawdown`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
```yaml
profit_drawdown:
  enabled: true
  drawdown_percent: 0.75
  min_profit_to_activate_type: "margin_percent"  # ‚úÖ –ù–û–í–û–ï: "fixed" –∏–ª–∏ "margin_percent"
  min_profit_to_activate_percent: 3.0  # ‚úÖ 3% –æ—Ç –º–∞—Ä–∂–∏ (0.6% –æ—Ç notional, 30% –æ—Ç TP 2.0%)
  min_profit_to_activate_usd: 0.5  # ‚úÖ –û—Å—Ç–∞–≤–∏—Ç—å –¥–ª—è fallback (–µ—Å–ª–∏ type="fixed")
  by_regime:
    trending:
      multiplier: 2.0
    ranging:
      multiplier: 1.2
    choppy:
      multiplier: 1.0
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –î–ª—è $150 –º–∞—Ä–∂–∏: –∞–∫—Ç–∏–≤–∞—Ü–∏—è –ø—Ä–∏ $4.50 (3% –æ—Ç $150) = 0.6% –æ—Ç notional $750 = 30% –æ—Ç TP 2.0% ‚úÖ
- –î–ª—è $420 –º–∞—Ä–∂–∏ (3 –¥–æ–ª–∏–≤–∫–∏): –∞–∫—Ç–∏–≤–∞—Ü–∏—è –ø—Ä–∏ $12.60 (3% –æ—Ç $420) = 0.6% –æ—Ç notional $2,100 ‚úÖ
- Profit Drawdown –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è —Å —Ä–∞–∑–º–µ—Ä–æ–º –ø–æ–∑–∏—Ü–∏–∏!
- –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –≤ –ª–æ–≥–∞—Ö: –µ—Å–ª–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏—è —Å–ª–∏—à–∫–æ–º —Ä–∞–Ω–æ/–ø–æ–∑–¥–Ω–æ ‚Üí —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ü–µ–Ω—Ç!

---

## üü† –ü–†–ò–û–†–ò–¢–ï–¢ 2: –í–ê–ñ–ù–´–ï –£–õ–£–ß–®–ï–ù–ò–Ø –ò –ü–†–û–í–ï–†–ö–ò

### 2.1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞—Å—á–µ—Ç –º–∞—Ä–∂–∏ (–ø–æ—á–µ–º—É $49 –∏–∑ $50?) - –ö–†–ò–¢–ò–ß–ù–û!

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ì—Ä–æ–∫ –≤—ã—è–≤–∏–ª, —á—Ç–æ –º–∞—Ä–∂–∞ $49 –∏–∑ –±–∞–ª–∞–Ω—Å–∞ $50 = 98% (–Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É 22-25%)
- –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –∫–∞–∫–æ–π –º–µ—Ç–æ–¥ —Ä–∞—Å—á–µ—Ç–∞ –º–∞—Ä–∂–∏ —Ä–µ–∞–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

**–ó–∞–¥–∞—á–∏:**
1. –ù–∞–π—Ç–∏, –≥–¥–µ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –º–∞—Ä–∂–∞ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–∏ `risk_based_margin` –∏–ª–∏ `max_margin_per_trade_pct`
3. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –º–∞—Ä–∂–∞ –Ω–µ –ø—Ä–µ–≤—ã—à–∞–µ—Ç –ª–∏–º–∏—Ç—ã –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–∏ –≤–µ—Å—å –±–∞–ª–∞–Ω—Å –≤–º–µ—Å—Ç–æ –ø—Ä–æ—Ü–µ–Ω—Ç–∞

**–§–∞–π–ª—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:**
- `src/strategies/scalping/futures/risk_manager.py` (–º–µ—Ç–æ–¥ `_calculate_risk_based_margin`)
- `src/strategies/scalping/futures/calculations/position_sizer.py`
- `src/strategies/scalping/futures/orchestrator.py` (–≥–¥–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ä–∞—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–∞)
- `src/strategies/scalping/futures/positions/entry_manager.py` (–≥–¥–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø–æ–∑–∏—Ü–∏—è)

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ú–∞—Ä–∂–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å 22-25% –æ—Ç –±–∞–ª–∞–Ω—Å–∞ (–Ω–µ 98%!)
- –î–ª—è –±–∞–ª–∞–Ω—Å–∞ $50: –º–∞—Ä–∂–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å ~$11-12.50 (–Ω–µ $49!)
- –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ ‚Üí –∏—Å–ø—Ä–∞–≤–∏—Ç—å!

**–í—Ä–µ–º—è:** 1 —á–∞—Å

---

### 2.2. –£–ª—É—á—à–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ PH –∏ Profit Drawdown

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ù—É–∂–Ω–æ –≤–∏–¥–µ—Ç—å, –∫–æ–≥–¥–∞ PH/Profit Drawdown –±–ª–æ–∫–∏—Ä—É—é—Ç –∑–∞–∫—Ä—ã—Ç–∏–µ –∏–ª–∏ –∑–∞–∫—Ä—ã–≤–∞—é—Ç –ø–æ–∑–∏—Ü–∏—é
- –ù—É–∂–Ω–æ –≤–∏–¥–µ—Ç—å —Ä–∞—Å—á–µ—Ç–Ω—ã–µ –ø–æ—Ä–æ–≥–∏ (–æ—Å–æ–±–µ–Ω–Ω–æ –¥–ª—è adaptive)
- –ù—É–∂–Ω–æ –≤–∏–¥–µ—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫—É –Ω–∞ –∫–æ–º–∏—Å—Å–∏–∏

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

**–§–∞–π–ª:** `src/strategies/scalping/futures/position_manager.py`

**–ú–µ—Ç–æ–¥:** `_check_profit_harvesting()`

**–î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```python
# ‚úÖ –î–ï–¢–ê–õ–¨–ù–û–ï –õ–û–ì–ò–†–û–í–ê–ù–ò–ï PH:
logger.info(
    f"üîç PH –¥–ª—è {symbol}: "
    f"margin=${margin_used:.2f}, "
    f"type={ph_threshold_type}, "
    f"threshold_original=${ph_threshold:.2f}, "
    f"commission=${commission:.4f}, "
    f"threshold_adjusted=${ph_threshold_adjusted:.2f}, "
    f"current_pnl_gross=${pnl_usd:.4f}, "
    f"current_pnl_net=${net_pnl_usd:.4f}, "
    f"notional=${notional:.2f}, "
    f"ph_percent_from_notional={(ph_threshold_adjusted/notional*100):.4f}%, "
    f"pnl_percent_from_notional={(net_pnl_usd/notional*100):.4f}%, "
    f"time_in_position={time_since_open:.1f}—Å, "
    f"min_holding={min_holding_seconds:.1f}—Å, "
    f"extreme_profit_threshold=${extreme_profit_threshold:.2f} (1.5x), "
    f"decision={'CLOSE' if should_close else 'HOLD'}, "
    f"reason={close_reason if should_close else '–Ω–µ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç –ø–æ—Ä–æ–≥'}"
)
```

**–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–ª—è Profit Drawdown**

**–í—Ä–µ–º—è:** 15 –º–∏–Ω—É—Ç

---

### 2.3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Max Holding Time –¥–ª—è –ª–µ—Å—Ç–Ω–∏—á–Ω–æ–≥–æ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ü—Ä–∏ –ª–µ—Å—Ç–Ω–∏—á–Ω–æ–º –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–∏ Max Holding –¥–æ–ª–∂–µ–Ω —Å—á–∏—Ç–∞—Ç—å—Å—è –æ—Ç –ü–ï–†–í–û–ô –ø–æ–∑–∏—Ü–∏–∏, –∞ –Ω–µ –æ—Ç –∫–∞–∂–¥–æ–π –¥–æ–ª–∏–≤–∫–∏ –æ—Ç–¥–µ–ª—å–Ω–æ
- –ù—É–∂–Ω–æ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ `entry_time` –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –¥–æ–ª–∏–≤–∫–µ
- –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `extend_time_if_profitable` —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è —Å—É–º–º–∞—Ä–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**

**–§–∞–π–ª:** `src/strategies/scalping/futures/position_manager.py`

**–ú–µ—Ç–æ–¥:** –ì–¥–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è Max Holding Time (–Ω—É–∂–Ω–æ –Ω–∞–π—Ç–∏)

**–§–∞–π–ª:** `src/strategies/scalping/futures/positions/exit_analyzer.py`

**–ú–µ—Ç–æ–¥:** `_get_max_holding_minutes()` –∏ –≥–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `minutes_in_position`

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
1. ‚úÖ `entry_time` —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∏–∑ API –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—Ö–æ–¥–µ (—Å—Ç—Ä–æ–∫–∞ 314 –≤ `entry_manager.py`)
2. ‚úÖ `entry_time` –ù–ï –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –¥–æ–ª–∏–≤–∫–µ (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ `position_scaling_manager.py`)
3. ‚úÖ `extend_time_if_profitable` —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è —Å—É–º–º–∞—Ä–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏
4. ‚úÖ Max Holding —Å—á–∏—Ç–∞–µ—Ç—Å—è –æ—Ç `first_entry_time`, –∞ –Ω–µ –æ—Ç `last_addition_time`

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- Max Holding —Å—á–∏—Ç–∞–µ—Ç—Å—è –æ—Ç –≤—Ä–µ–º–µ–Ω–∏ –ü–ï–†–í–û–ì–û –≤—Ö–æ–¥–∞ ‚úÖ
- –ü—Ä–∏ –¥–æ–ª–∏–≤–∫–∞—Ö `entry_time` –ù–ï –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è ‚úÖ
- `extend_time_if_profitable` –ø—Ä–æ–¥–ª–µ–≤–∞–µ—Ç –≤—Ä–µ–º—è –¥–ª—è —Å—É–º–º–∞—Ä–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏ ‚úÖ

**–í—Ä–µ–º—è:** 15 –º–∏–Ω—É—Ç

---

### 2.4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å min_holding –¥–ª—è Adaptive PH

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –í –∫–æ–¥–µ –µ—Å—Ç—å `min_holding_minutes = 0.2` (12 —Å–µ–∫—É–Ω–¥) –¥–ª—è PH
- PH –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –µ—Å–ª–∏ –ø–æ–∑–∏—Ü–∏—è < 12 —Å–µ–∫—É–Ω–¥
- –ò–°–ö–õ–Æ–ß–ï–ù–ò–ï: –¥–ª—è —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã—Ö –ø—Ä–∏–±—ã–ª–µ–π (> 1.5x –ø–æ—Ä–æ–≥–∞) min_holding –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è
- –ù—É–∂–Ω–æ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —ç—Ç–∞ –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å Adaptive PH

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**

**–§–∞–π–ª:** `src/strategies/scalping/futures/position_manager.py`

**–ú–µ—Ç–æ–¥:** `_check_profit_harvesting()` (—Å—Ç—Ä–æ–∫–∏ 1802-1870)

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
1. ‚úÖ `min_holding_minutes = 0.2` —Å–æ—Ö—Ä–∞–Ω–µ–Ω (—Å—Ç—Ä–æ–∫–∞ 1805)
2. ‚úÖ `extreme_profit_threshold = ph_threshold_adjusted * 1.5` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ—Ä–æ–≥ (—Å—Ç—Ä–æ–∫–∞ 1850-1851)
3. ‚úÖ `ignore_min_holding = True` –µ—Å–ª–∏ `net_pnl_usd >= extreme_profit_threshold` (—Å—Ç—Ä–æ–∫–∞ 1854)
4. ‚úÖ –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å Adaptive PH (–ø–æ—Ä–æ–≥ —Ç–µ–ø–µ—Ä—å –≤—ã—à–µ, —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã–µ –ø—Ä–∏–±—ã–ª–∏ —Ä–µ–∂–µ, –Ω–æ –ª–æ–≥–∏–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞)

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- Min holding –±–ª–æ–∫–∏—Ä—É–µ—Ç PH < 12 —Å–µ–∫—É–Ω–¥ ‚úÖ
- –≠–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã–µ –ø—Ä–∏–±—ã–ª–∏ (> 1.5x —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ—Ä–æ–≥–∞) –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç min_holding ‚úÖ
- –° Adaptive PH: –µ—Å–ª–∏ –ø–æ—Ä–æ–≥ $2.25, —Ç–æ —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–∞—è –ø—Ä–∏–±—ã–ª—å = $3.38 (1.5x) ‚úÖ

**–í—Ä–µ–º—è:** 10 –º–∏–Ω—É—Ç

---

### 2.5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–ª—É—á–µ–Ω–∏–µ margin_used –∏–∑ –ø–æ–∑–∏—Ü–∏–∏

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ù—É–∂–Ω–æ –ü–†–û–í–ï–†–ò–¢–¨, —á—Ç–æ `position.get("margin")` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ü–†–ê–í–ò–õ–¨–ù–û–ï –∑–Ω–∞—á–µ–Ω–∏–µ
- –ù—É–∂–Ω–æ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ fallback –Ω–∞ `metadata.margin_used` —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ù—É–∂–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å, –µ—Å–ª–∏ margin = 0 –∏–ª–∏ None

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**

**–§–∞–π–ª:** `src/strategies/scalping/futures/position_manager.py`

**–ú–µ—Ç–æ–¥:** `_check_profit_harvesting()` –∏ –≥–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `margin_used`

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
1. ‚úÖ `position.get("margin")` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ API OKX
2. ‚úÖ `position.get("margin_used")` —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞
3. ‚úÖ `metadata.margin_used` —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ fallback
4. ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å warning, –µ—Å–ª–∏ margin = 0 –∏–ª–∏ None (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π threshold)

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- Margin –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ `position` dict –∏–∑ API ‚úÖ
- Fallback –Ω–∞ `metadata.margin_used` —Ä–∞–±–æ—Ç–∞–µ—Ç ‚úÖ
- –ï—Å–ª–∏ margin –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π threshold —Å warning ‚úÖ

**–í—Ä–µ–º—è:** 10 –º–∏–Ω—É—Ç

---

## üü° –ü–†–ò–û–†–ò–¢–ï–¢ 3: –û–ü–¶–ò–û–ù–ê–õ–¨–ù–´–ï –£–õ–£–ß–®–ï–ù–ò–Ø

### 3.1. –ò—Å–ø—Ä–∞–≤–∏—Ç—å ADX Filter (+DM/-DM –Ω–∞ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π)

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —É–ø—Ä–æ—â–µ–Ω–Ω–∞—è (–Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —É—Å–ª–æ–≤–∏–µ "–∏ –±–æ–ª—å—à–µ down_move/up_move")
- –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π ADX –£–∞–π–ª–¥–µ—Ä–∞ –±–æ–ª–µ–µ —Ç–æ—á–Ω—ã–π

**–§–∞–π–ª:** `src/strategies/modules/adx_filter.py`

**–ú–µ—Ç–æ–¥—ã:** `_calculate_plus_dm()` –∏ `_calculate_minus_dm()` (—Å—Ç—Ä–æ–∫–∏ 369-393)

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
```python
# –ë–´–õ–û (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è):
def _calculate_plus_dm(self, highs: np.ndarray) -> np.ndarray:
    up_move = highs[1:] - highs[:-1]
    plus_dm = np.zeros(len(highs))
    plus_dm[1:] = np.where(up_move > 0, up_move, 0)
    return plus_dm

# –°–¢–ê–õ–û (–∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π ADX):
def _calculate_plus_dm(self, highs: np.ndarray, lows: np.ndarray) -> np.ndarray:
    up_move = highs[1:] - highs[:-1]
    down_move = lows[:-1] - lows[1:]
    plus_dm = np.zeros(len(highs))
    plus_dm[1:] = np.where(
        (up_move > 0) & (up_move > down_move),
        up_move,
        0
    )
    return plus_dm

def _calculate_minus_dm(self, highs: np.ndarray, lows: np.ndarray) -> np.ndarray:
    up_move = highs[1:] - highs[:-1]
    down_move = lows[:-1] - lows[1:]
    minus_dm = np.zeros(len(lows))
    minus_dm[1:] = np.where(
        (down_move > 0) & (down_move > up_move),
        down_move,
        0
    )
    return minus_dm
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ù–∏–∑–∫–∏–π (—Ç–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è —Ç–æ—á–Ω–µ–µ)

**–í—Ä–µ–º—è:** 30 –º–∏–Ω—É—Ç

---

### 3.2. –î–æ–±–∞–≤–∏—Ç—å max_margin_per_symbol –ª–∏–º–∏—Ç

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ì—Ä–æ–∫ –ø—Ä–µ–¥–ª–æ–∂–∏–ª –¥–æ–±–∞–≤–∏—Ç—å –ª–∏–º–∏—Ç –º–∞—Ä–∂–∏ –Ω–∞ –æ–¥–∏–Ω —Å–∏–º–≤–æ–ª (35%)
- –°–µ–π—á–∞—Å –µ—Å—Ç—å —Ç–æ–ª—å–∫–æ `max_position_percent` –∏ `max_portfolio_margin`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–Ω—Ñ–∏–≥–µ:**

**–§–∞–π–ª:** `config/config_futures.yaml`

**–°–µ–∫—Ü–∏—è:** `scalping.risk_config`

**–î–æ–±–∞–≤–∏—Ç—å:**
```yaml
risk_config:
  max_margin_per_trade: 22.0
  max_portfolio_margin: 65.0
  max_margin_per_symbol: 35.0  # ‚úÖ –ù–û–í–û–ï: 35% –±–∞–ª–∞–Ω—Å–∞ –Ω–∞ –û–î–ò–ù —Å–∏–º–≤–æ–ª
  # –î–ª—è $1000: $350 (2-3 –¥–æ–ª–∏–≤–∫–∏ –ø–æ $150)
```

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ:**

**–§–∞–π–ª:** `src/strategies/scalping/futures/risk_manager.py`

**–ú–µ—Ç–æ–¥:** –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É `max_margin_per_symbol` –ø–µ—Ä–µ–¥ –æ—Ç–∫—Ä—ã—Ç–∏–µ–º/–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –ø–æ–∑–∏—Ü–∏–∏

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ù–∏–∑–∫–∏–π (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ, –Ω–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–ª–µ–∑–Ω–æ)

**–í—Ä–µ–º—è:** 30 –º–∏–Ω—É—Ç

---

## üìã –°–í–û–î–ù–ê–Ø –¢–ê–ë–õ–ò–¶–ê –ó–ê–î–ê–ß

| –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –ó–∞–¥–∞—á–∞ | –§–∞–π–ª | –°—Ç–∞—Ç—É—Å | –í—Ä–µ–º—è |
|-----------|--------|------|--------|-------|
| üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π | Adaptive PH (2.5%/1.5%/1.0%) | `position_manager.py` + `config_futures.yaml` | ‚è≥ TODO | 30 –º–∏–Ω |
| üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π | Adaptive Profit Drawdown (3%) | `position_manager.py` + `config_futures.yaml` | ‚è≥ TODO | 30 –º–∏–Ω |
| üü† –í–∞–∂–Ω—ã–π | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞—Å—á–µ—Ç –º–∞—Ä–∂–∏ ($49 –∏–∑ $50) | `risk_manager.py`, `position_sizer.py`, `entry_manager.py` | ‚è≥ TODO | 1 —á–∞—Å |
| üü† –í–∞–∂–Ω—ã–π | –£–ª—É—á—à–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ PH/PD | `position_manager.py` | ‚è≥ TODO | 15 –º–∏–Ω |
| üü† –í–∞–∂–Ω—ã–π | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Max Holding –¥–ª—è –¥–æ–ª–∏–≤–æ–∫ | `position_manager.py`, `exit_analyzer.py` | ‚è≥ TODO | 15 –º–∏–Ω |
| üü† –í–∞–∂–Ω—ã–π | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å min_holding –¥–ª—è PH | `position_manager.py` | ‚è≥ TODO | 10 –º–∏–Ω |
| üü† –í–∞–∂–Ω—ã–π | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å margin_used –∏–∑ –ø–æ–∑–∏—Ü–∏–∏ | `position_manager.py` | ‚è≥ TODO | 10 –º–∏–Ω |
| üü° –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π | –ò—Å–ø—Ä–∞–≤–∏—Ç—å ADX Filter | `adx_filter.py` | ‚è≥ TODO | 30 –º–∏–Ω |
| üü° –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π | –î–æ–±–∞–≤–∏—Ç—å max_margin_per_symbol | `risk_manager.py` + `config_futures.yaml` | ‚è≥ TODO | 30 –º–∏–Ω |

**–ò–¢–û–ì–û:** 3 —á–∞—Å–∞ 20 –º–∏–Ω—É—Ç (–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ + –≤–∞–∂–Ω—ã–µ) + 1 —á–∞—Å (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ)

---

## üéØ –ü–õ–ê–ù –î–ï–ô–°–¢–í–ò–ô

### –≠—Ç–∞–ø 1: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (1 —á–∞—Å)
1. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Adaptive PH (2.5%/1.5%/1.0% –ø–æ —Ä–µ–∂–∏–º–∞–º)
2. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Adaptive Profit Drawdown (3%)
3. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥ —Å –Ω–æ–≤—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
4. ‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫—É –Ω–∞ –∫–æ–º–∏—Å—Å–∏–∏ (—É–∂–µ –µ—Å—Ç—å, –Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å!)
5. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ demo

### –≠—Ç–∞–ø 2: –í–∞–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ (2 —á–∞—Å–∞ 10 –º–∏–Ω—É—Ç)
1. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞—Å—á–µ—Ç –º–∞—Ä–∂–∏ (–∫—Ä–∏—Ç–∏—á–Ω–æ!)
2. ‚úÖ –£–ª—É—á—à–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ PH/Profit Drawdown
3. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Max Holding –¥–ª—è –¥–æ–ª–∏–≤–æ–∫
4. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å min_holding –¥–ª—è PH
5. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å margin_used –∏–∑ –ø–æ–∑–∏—Ü–∏–∏
6. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ demo

### –≠—Ç–∞–ø 3: –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (1 —á–∞—Å)
1. ‚ö†Ô∏è –ò—Å–ø—Ä–∞–≤–∏—Ç—å ADX Filter (–µ—Å–ª–∏ –≤—Ä–µ–º—è –µ—Å—Ç—å)
2. ‚ö†Ô∏è –î–æ–±–∞–≤–∏—Ç—å max_margin_per_symbol (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

---

## üìä –û–ñ–ò–î–ê–ï–ú–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
- PH –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –ø—Ä–∏ $0.10 (0.013% –æ—Ç notional) ‚Üí –ø–æ—Ç–µ—Ä—è 99.3% –ø—Ä–∏–±—ã–ª–∏ ‚ùå
- Profit Drawdown –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ $0.5 (0.067% –æ—Ç notional) ‚Üí —Å–ª–∏—à–∫–æ–º —Ä–∞–Ω–æ ‚ùå
- –° –ª–µ—Å—Ç–Ω–∏—á–Ω—ã–º –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ–º –ø—Ä–æ–±–ª–µ–º—ã —É—Å–∏–ª–∏–≤–∞—é—Ç—Å—è –≤ 3 —Ä–∞–∑–∞ ‚ùå

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
- PH –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –ø—Ä–∏ 1.5% –æ—Ç –º–∞—Ä–∂–∏ (0.3% –æ—Ç notional –¥–ª—è ranging) ‚Üí –Ω–æ—Ä–º–∞–ª—å–Ω–æ ‚úÖ
- Profit Drawdown –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ 3% –æ—Ç –º–∞—Ä–∂–∏ (0.6% –æ—Ç notional) ‚Üí –Ω–æ—Ä–º–∞–ª—å–Ω–æ ‚úÖ
- –° –ª–µ—Å—Ç–Ω–∏—á–Ω—ã–º –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ–º –≤—Å–µ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ ‚úÖ
- –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –Ω–∞ –∫–æ–º–∏—Å—Å–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –∏ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è ‚úÖ
- Min holding –∏ —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã–µ –ø—Ä–∏–±—ã–ª–∏ —Ä–∞–±–æ—Ç–∞—é—Ç —Å Adaptive PH ‚úÖ

---

## ‚úÖ –ß–¢–û –£–ñ–ï –ò–°–ü–†–ê–í–õ–ï–ù–û (–Ω–µ –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å)

1. ‚úÖ **TP/SL —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ** - —É–∂–µ 2.0%/0.8% = 2.5:1 (–æ—Ç–ª–∏—á–Ω–æ!)
2. ‚úÖ **Max Holding Time** - —É–∂–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (28-40 –º–∏–Ω)
3. ‚úÖ **–õ–µ—Å—Ç–Ω–∏—á–Ω–æ–µ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ** - —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ
4. ‚úÖ **–ü—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è** - —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ
5. ‚úÖ **–ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ PH –Ω–∞ –∫–æ–º–∏—Å—Å–∏–∏** - —É–∂–µ –µ—Å—Ç—å –≤ –∫–æ–¥–µ (—Å—Ç—Ä–æ–∫–∞ 1781)
6. ‚úÖ **Min holding –¥–ª—è PH** - —É–∂–µ –µ—Å—Ç—å –≤ –∫–æ–¥–µ (—Å—Ç—Ä–æ–∫–∞ 1805)
7. ‚úÖ **–≠–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã–µ –ø—Ä–∏–±—ã–ª–∏** - —É–∂–µ –µ—Å—Ç—å –≤ –∫–æ–¥–µ (—Å—Ç—Ä–æ–∫–∞ 1850-1851)

---

## üéØ –ö–õ–Æ–ß–ï–í–´–ï –ú–û–ú–ï–ù–¢–´ –î–õ–Ø –ì–ò–ë–ö–û–ô –°–ò–°–¢–ï–ú–´

### 1. Fallback –º–µ—Ö–∞–Ω–∏–∑–º—ã:
- –ï—Å–ª–∏ `margin_percent` –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω ‚Üí fallback –Ω–∞ `fixed` threshold
- –ï—Å–ª–∏ `margin` –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω ‚Üí fallback –Ω–∞ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π threshold —Å warning
- –í—Å–µ–≥–¥–∞ –µ—Å—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç!

### 2. –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ —Ä–µ–∂–∏–º–∞–º:
- **Trending:** 2.5% –æ—Ç –º–∞—Ä–∂–∏ (–±–æ–ª—å—à–µ –º–µ—Å—Ç–∞ –¥–ª—è —Ä–æ—Å—Ç–∞ –¥–æ 3.0% TP)
- **Ranging:** 1.5% –æ—Ç –º–∞—Ä–∂–∏ (—Å—Ç–∞–Ω–¥–∞—Ä—Ç –¥–ª—è 2.0% TP)
- **Choppy:** 1.0% –æ—Ç –º–∞—Ä–∂–∏ (–±—ã—Å—Ç—Ä–µ–µ —Ñ–∏–∫—Å–∞—Ü–∏—è –¥–ª—è 1.8% TP)

### 3. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤:
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –Ω–∞ –∫–æ–º–∏—Å—Å–∏–∏ (—É–∂–µ –µ—Å—Ç—å)
- ‚úÖ Min holding (—É–∂–µ –µ—Å—Ç—å)
- ‚úÖ –≠–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã–µ –ø—Ä–∏–±—ã–ª–∏ (—É–∂–µ –µ—Å—Ç—å)
- ‚úÖ Time limit (—É–∂–µ –µ—Å—Ç—å)

### 4. –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
- –í—Å–µ —Ä–∞—Å—á–µ—Ç—ã –ª–æ–≥–∏—Ä—É—é—Ç—Å—è (–î–û –∏ –ü–û–°–õ–ï –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–æ–∫)
- –í—Å–µ —Ä–µ—à–µ–Ω–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è (CLOSE –∏–ª–∏ HOLD, –ø—Ä–∏—á–∏–Ω–∞)
- –í—Å–µ –ø–æ—Ä–æ–≥–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è (–≤ USD –∏ –≤ % –æ—Ç notional)

---

**–ö–æ–Ω–µ—Ü —Å–ø–∏—Å–∫–∞ –∑–∞–¥–∞—á**




