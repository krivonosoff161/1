# ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –õ–û–ì–ò–ö–ò –ó–ê–ö–†–´–¢–ò–Ø –ü–û –í–†–ï–ú–ï–ù–ò

## üö® –û–ë–ù–ê–†–£–ñ–ï–ù–ù–ê–Ø –ü–†–û–ë–õ–ï–ú–ê

**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–±—Å–æ–ª—é—Ç–Ω–æ –ø—Ä–∞–≤!** –ë–æ—Ç –∑–∞–∫—Ä—ã–≤–∞–ª –ø—Ä–∏–±—ã–ª—å–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –ø—Ä–æ—Å—Ç–æ –ø–æ –≤—Ä–µ–º–µ–Ω–∏, –∏–≥–Ω–æ—Ä–∏—Ä—É—è:
1. ‚úÖ –õ–æ–≥–∏–∫—É –ø—Ä–æ–¥–ª–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è –ø—Ä–∏–±—ã–ª—å–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π (`extend_time_if_profitable`)
2. ‚úÖ Trailing stop –¥–ª—è –∑–∞—â–∏—Ç—ã –ø—Ä–∏–±—ã–ª–∏
3. ‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω—É—é –ø—Ä–∏–±—ã–ª—å –¥–ª—è –ø—Ä–æ–¥–ª–µ–Ω–∏—è (`min_profit_for_extension`)

---

## üìä –ü–†–û–ë–õ–ï–ú–´ –í –ö–û–î–ï

### –ü—Ä–æ–±–ª–µ–º–∞ #1: –°—Ç—Ä–æ–≥–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤–º–µ—Å—Ç–æ –Ω–µ—Å—Ç—Ä–æ–≥–æ–≥–æ
```python
# –ë–´–õ–û (—Å—Ç—Ä–æ–∫–∞ 1157):
if profit_pct > min_profit_for_extension:  # ‚ùå 0.44% > 0.5% = false

# –î–û–õ–ñ–ù–û –ë–´–¢–¨:
if profit_pct >= min_profit_for_extension:  # ‚úÖ 0.44% >= 0.5% = false (–ø—Ä–∞–≤–∏–ª—å–Ω–æ), –Ω–æ 0.5% >= 0.5% = true
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** DOGE —Å –ø—Ä–∏–±—ã–ª—å—é 0.44% –Ω–µ –ø—Ä–æ–¥–ª–∏–ª–∞—Å—å (0.44% < 0.5%), —á—Ç–æ **–ø—Ä–∞–≤–∏–ª—å–Ω–æ**, –Ω–æ XRP —Å –ø—Ä–∏–±—ã–ª—å—é 1.37% –¥–æ–ª–∂–Ω–∞ –±—ã–ª–∞ –ø—Ä–æ–¥–ª–∏—Ç—å—Å—è, –Ω–æ –∑–∞–∫—Ä—ã–ª–∞—Å—å.

### –ü—Ä–æ–±–ª–µ–º–∞ #2: –ü—Ä–∏–±—ã–ª—å–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –∑–∞–∫—Ä—ã–≤–∞–ª–∏—Å—å –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–¥–ª–µ–Ω–∏—è
```python
# –ë–´–õ–û (—Å—Ç—Ä–æ–∫–∞ 1195-1200):
# –ï—Å–ª–∏ –Ω–µ –ø—Ä–æ–¥–ª–µ–≤–∞–µ–º –∏ –ø—Ä–∏–±—ã–ª—å > 0 - –∑–∞–∫—Ä—ã–≤–∞–µ–º
if profit_pct > 0:
    await self.close_position_callback(symbol, "max_holding_time")  # ‚ùå
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –î–∞–∂–µ –µ—Å–ª–∏ –ø—Ä–∏–±—ã–ª—å >= min_profit_for_extension, –Ω–æ –ø—Ä–æ–¥–ª–µ–Ω–∏–µ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —É–∂–µ –ø—Ä–æ–¥–ª–µ–Ω–∞), –ø–æ–∑–∏—Ü–∏—è –∑–∞–∫—Ä—ã–≤–∞–ª–∞—Å—å –ø–æ –≤—Ä–µ–º–µ–Ω–∏.

### –ü—Ä–æ–±–ª–µ–º–∞ #3: –ù–µ —É—á–∏—Ç—ã–≤–∞–ª—Å—è trailing stop –¥–ª—è –∑–∞—â–∏—Ç—ã –ø—Ä–∏–±—ã–ª–∏
–ü—Ä–∏–±—ã–ª—å–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **trailing stop** –¥–ª—è –∑–∞—â–∏—Ç—ã –ø—Ä–∏–±—ã–ª–∏, –∞ –Ω–µ –∑–∞–∫—Ä—ã–≤–∞—Ç—å—Å—è –ø—Ä–æ—Å—Ç–æ –ø–æ –≤—Ä–µ–º–µ–Ω–∏.

---

## ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### 1. –ò–∑–º–µ–Ω–µ–Ω–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –Ω–∞ –Ω–µ—Å—Ç—Ä–æ–≥–æ–µ:
```python
if profit_pct >= min_profit_for_extension:  # ‚úÖ –¢–µ–ø–µ—Ä—å 0.5% –ø—Ä–æ–¥–ª–∏—Ç—Å—è
```

### 2. –ò–∑–º–µ–Ω–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è:
- ‚úÖ **–ü—Ä–∏–±—ã–ª—å >= min_profit_for_extension:** –ù–ï –∑–∞–∫—Ä—ã–≤–∞–µ–º –ø–æ –≤—Ä–µ–º–µ–Ω–∏ (–∏—Å–ø–æ–ª—å–∑—É–µ–º trailing stop)
- ‚úÖ **–ü—Ä–∏–±—ã–ª—å < min_profit_for_extension:** –ó–∞–∫—Ä—ã–≤–∞–µ–º –ø–æ –≤—Ä–µ–º–µ–Ω–∏ (–º–∞–ª–∞—è –ø—Ä–∏–±—ã–ª—å)
- ‚úÖ **–ü—Ä–∏–±—ã–ª—å <= 0%:** –ù–ï –∑–∞–∫—Ä—ã–≤–∞–µ–º –ø–æ –≤—Ä–µ–º–µ–Ω–∏ (–∂–¥–µ–º TP/SL –∏–ª–∏ —Ä–∞–∑–≤–æ—Ä–æ—Ç–∞)

### 3. –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è `time_extended` –≤ orchestrator:
```python
if hasattr(self, "orchestrator") and self.orchestrator:
    if symbol in self.orchestrator.active_positions:
        self.orchestrator.active_positions[symbol]["time_extended"] = True
        self.orchestrator.active_positions[symbol]["max_holding_minutes"] = new_max_holding
```

---

## üìã –ù–û–í–ê–Ø –õ–û–ì–ò–ö–ê –ó–ê–ö–†–´–¢–ò–Ø

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–¥–ª–µ–Ω–∏—è (–µ—Å–ª–∏ –≤—Ä–µ–º—è –≤—ã—à–ª–æ):
```python
if time_held >= actual_max_holding:
    if extend_time_if_profitable and not time_extended and profit_pct >= min_profit_for_extension:
        # ‚úÖ –ü—Ä–æ–¥–ª–µ–≤–∞–µ–º –≤—Ä–µ–º—è (20 –º–∏–Ω ‚Üí 40 –º–∏–Ω –¥–ª—è ranging)
        return  # –ù–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–æ–ª—å—à–æ–π –ø—Ä–∏–±—ã–ª–∏ (trailing stop):
```python
if profit_pct >= min_profit_to_close:
    # ‚úÖ –ù–ï –∑–∞–∫—Ä—ã–≤–∞–µ–º –ø–æ –≤—Ä–µ–º–µ–Ω–∏, –∏—Å–ø–æ–ª—å–∑—É–µ–º trailing stop
    return
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–±—ã—Ç–æ—á–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏:
```python
if profit_pct <= 0:
    # ‚úÖ –ù–ï –∑–∞–∫—Ä—ã–≤–∞–µ–º –ø–æ –≤—Ä–µ–º–µ–Ω–∏, –∂–¥–µ–º TP/SL
    return
```

### 4. –ó–∞–∫—Ä—ã—Ç–∏–µ —Ç–æ–ª—å–∫–æ –º–∞–ª–æ–π –ø—Ä–∏–±—ã–ª–∏:
```python
if profit_pct < min_profit_for_extension:
    # ‚úÖ –ó–∞–∫—Ä—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø—Ä–∏–±—ã–ª—å –º–∞–ª–∞ (< 0.5%) –ò –≤—Ä–µ–º—è –≤—ã—à–ª–æ
    await self.close_position_callback(symbol, "max_holding_time")
else:
    # ‚úÖ –ï—Å–ª–∏ –ø—Ä–∏–±—ã–ª—å >= 0.5%, –ù–ï –∑–∞–∫—Ä—ã–≤–∞–µ–º (–∏—Å–ø–æ–ª—å–∑—É–µ–º trailing stop)
    return
```

---

## üéØ –†–ï–ó–£–õ–¨–¢–ê–¢

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- ‚ùå DOGE (0.44%): –ó–∞–∫—Ä—ã—Ç–∞ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ (0.44% < 0.5%, –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –Ω–æ –ª—É—á—à–µ –±—ã –ø—Ä–æ–¥–ª–∏–ª–∏)
- ‚ùå XRP (1.37%): –ó–∞–∫—Ä—ã—Ç–∞ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ (–¥–æ–ª–∂–Ω–∞ –±—ã–ª–∞ –ø—Ä–æ–¥–ª–∏—Ç—å—Å—è –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å trailing stop)

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- ‚úÖ **–ü—Ä–∏–±—ã–ª—å >= 0.5%:** –ü–æ–∑–∏—Ü–∏—è –ø—Ä–æ–¥–ª–µ–≤–∞–µ—Ç—Å—è (20 ‚Üí 40 –º–∏–Ω—É—Ç –¥–ª—è ranging)
- ‚úÖ **–ü—Ä–∏–±—ã–ª—å >= 0.5% –Ω–æ —É–∂–µ –ø—Ä–æ–¥–ª–µ–Ω–∞:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è trailing stop –≤–º–µ—Å—Ç–æ –∑–∞–∫—Ä—ã—Ç–∏—è
- ‚úÖ **–ü—Ä–∏–±—ã–ª—å < 0.5%:** –ó–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø–æ –≤—Ä–µ–º–µ–Ω–∏ (–º–∞–ª–∞—è –ø—Ä–∏–±—ã–ª—å)
- ‚úÖ **–ü—Ä–∏–±—ã–ª—å <= 0%:** –ù–ï –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø–æ –≤—Ä–µ–º–µ–Ω–∏ (–∂–¥–µ–º TP/SL)

---

## ‚ö†Ô∏è –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### 1. –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å —Å–Ω–∏–∂–µ–Ω–∏–µ `min_profit_for_extension`:
- –¢–µ–∫—É—â–µ–µ: 0.5%
- –í–æ–∑–º–æ–∂–Ω–æ: 0.3-0.4% (—á—Ç–æ–±—ã DOGE —Å 0.44% —Ç–æ–∂–µ –ø—Ä–æ–¥–ª–∏–ª–∞—Å—å)

### 2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å trailing stop –≤–º–µ—Å—Ç–æ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ –≤—Ä–µ–º–µ–Ω–∏:
- –ü—Ä–∏–±—ã–ª—å–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã –∑–∞—â–∏—â–∞—Ç—å—Å—è trailing stop
- –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ - —Ç–æ–ª—å–∫–æ –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –∑–∞–≤–∏—Å–∞–Ω–∏—è –º–∞–ª–æ–ø—Ä–∏–±—ã–ª—å–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π

### 3. –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–¥–ª–µ–Ω–∏—è:
- –í –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤–∏–¥–Ω–æ, –∫–æ–≥–¥–∞ –ø–æ–∑–∏—Ü–∏—è –ø—Ä–æ–¥–ª–µ–≤–∞–µ—Ç—Å—è
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ —á–∏—Ç–∞–µ—Ç—Å—è `min_profit_for_extension` –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ (0.5% –≤–º–µ—Å—Ç–æ 0.1%)

---

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ:** ‚úÖ
**–õ–æ–≥–∏–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞:** ‚úÖ
**–¢—Ä–µ–±—É–µ—Ç—Å—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** ‚ö†Ô∏è

