# üìä –ü–û–î–†–û–ë–ù–´–ô –ê–ù–ê–õ–ò–ó DataRegistry

**–î–∞—Ç–∞:** 25.11.2025  
**–¶–µ–ª—å:** –ü–æ–ª–Ω–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ DataRegistry –∏ –ø–ª–∞–Ω–∞ –µ–≥–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

---

## üéØ –ß–¢–û –¢–ê–ö–û–ï DataRegistry?

**DataRegistry** - —ç—Ç–æ **–µ–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã** –¥–ª—è –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö –≤ —Ç–æ—Ä–≥–æ–≤–æ–º –±–æ—Ç–µ.

### –ö–æ–Ω—Ü–µ–ø—Ü–∏—è "Single Source of Truth"

–í–º–µ—Å—Ç–æ —Ç–æ–≥–æ, —á—Ç–æ–±—ã –∫–∞–∂–¥—ã–π –º–æ–¥—É–ª—å —Ö—Ä–∞–Ω–∏–ª —Å–≤–æ–∏ –∫–æ–ø–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ –∑–∞–ø—Ä–∞—à–∏–≤–∞–ª –∏—Ö –æ—Ç–¥–µ–ª—å–Ω–æ:
- ‚ùå **–ë–ï–ó DataRegistry:** –ö–∞–∂–¥—ã–π –º–æ–¥—É–ª—å –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞–ø—Ä—è–º—É—é –∏–∑ API –∏–ª–∏ —Ö—Ä–∞–Ω–∏—Ç —Å–≤–æ–∏ –∫–æ–ø–∏–∏
- ‚úÖ **–° DataRegistry:** –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω—ã –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ, –ª—é–±–æ–π –º–æ–¥—É–ª—å –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

---

## üì¶ –ß–¢–û –•–†–ê–ù–ò–¢ DataRegistry?

### 1. **Market Data (–†—ã–Ω–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)**
```python
{
    "BTC-USDT": {
        "price": 45000.0,           # –¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞
        "last_price": 45000.0,      # –ü–æ—Å–ª–µ–¥–Ω—è—è —Ü–µ–Ω–∞
        "volume": 1234.56,          # –û–±—ä–µ–º
        "candles": [...],           # –°–≤–µ—á–∏ OHLCV
        "ticker": {...},            # –¢–∏–∫–µ—Ä –¥–∞–Ω–Ω—ã–µ
        "updated_at": datetime      # –í—Ä–µ–º—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
    }
}
```

**–ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:**
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤
- –†–∞—Å—á–µ—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–æ—á–∫–∏ –≤—Ö–æ–¥–∞/–≤—ã—Ö–æ–¥–∞
- –†–∞—Å—á–µ—Ç PnL

---

### 2. **Indicators (–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã)**
```python
{
    "BTC-USDT": {
        "adx": 25.5,                # ADX –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
        "ma_fast": 45100.0,         # –ë—ã—Å—Ç—Ä–∞—è MA
        "ma_slow": 44900.0,         # –ú–µ–¥–ª–µ–Ω–Ω–∞—è MA
        "rsi": 65.2,                # RSI
        "macd": 150.0,              # MACD
        "order_flow": 0.75,         # Order Flow
        "updated_at": datetime
    }
}
```

**–ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:**
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤ (ADX —Ñ–∏–ª—å—Ç—Ä, MTF —Ñ–∏–ª—å—Ç—Ä)
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤ (RSI, MACD)
- –ê–Ω–∞–ª–∏–∑ –ø–æ–∑–∏—Ü–∏–π (Order Flow, ADX)
- –†–µ—à–µ–Ω–∏—è –æ –∑–∞–∫—Ä—ã—Ç–∏–∏ (ExitAnalyzer)

---

### 3. **Regimes (–†–µ–∂–∏–º—ã —Ä—ã–Ω–∫–∞)**
```python
{
    "BTC-USDT": {
        "regime": "trending",       # trending/ranging/choppy
        "params": {
            "tp_percent": 2.0,      # TP –¥–ª—è —ç—Ç–æ–≥–æ —Ä–µ–∂–∏–º–∞
            "sl_percent": 1.0,      # SL –¥–ª—è —ç—Ç–æ–≥–æ —Ä–µ–∂–∏–º–∞
            "min_holding_minutes": 5
        },
        "updated_at": datetime
    }
}
```

**–ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:**
- –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ TP/SL (—Ä–∞–∑–Ω—ã–µ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ä–µ–∂–∏–º–æ–≤)
- –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–æ–≤
- –†–∞—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏
- –†–µ—à–µ–Ω–∏—è –æ –∑–∞–∫—Ä—ã—Ç–∏–∏ (ExitAnalyzer —É—á–∏—Ç—ã–≤–∞–µ—Ç —Ä–µ–∂–∏–º)

---

### 4. **Balance (–ë–∞–ª–∞–Ω—Å)**
```python
{
    "balance": 10000.0,             # –¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å USDT
    "profile": "medium",            # small/medium/large
    "updated_at": datetime
}
```

**–ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:**
- –†–∞—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏ (–ø—Ä–æ—Ñ–∏–ª—å –±–∞–ª–∞–Ω—Å–∞ –≤–ª–∏—è–µ—Ç –Ω–∞ —Ä–∏—Å–∫)
- –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (—Ä–∞–∑–Ω—ã–µ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ø—Ä–æ—Ñ–∏–ª–µ–π)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤ (max_open_positions –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø—Ä–æ—Ñ–∏–ª—è)

---

### 5. **Margin (–ú–∞—Ä–∂–∞)**
```python
{
    "used": 500.0,                  # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω–∞—è –º–∞—Ä–∂–∞
    "available": 9500.0,            # –î–æ—Å—Ç—É–ø–Ω–∞—è –º–∞—Ä–∂–∞
    "total": 10000.0,               # –û–±—â–∞—è –º–∞—Ä–∂–∞
    "updated_at": datetime
}
```

**–ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (–Ω–µ –ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏ –ª–∏–º–∏—Ç –º–∞—Ä–∂–∏)
- –†–∞—Å—á–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏
- –ó–∞—â–∏—Ç–∞ –æ—Ç –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏

---

## üîí –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨ –ò –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø

### Thread-Safe –æ–ø–µ—Ä–∞—Ü–∏–∏

DataRegistry –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `asyncio.Lock` –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∏–∑ —Ä–∞–∑–Ω—ã—Ö –∑–∞–¥–∞—á:

```python
async def update_market_data(self, symbol: str, data: Dict[str, Any]) -> None:
    async with self._lock:  # üîí –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞
        self._market_data[symbol].update(data)
        self._market_data[symbol]["updated_at"] = datetime.now()
```

**–ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ:**
- WebSocket –º–æ–∂–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å –¥–∞–Ω–Ω—ã–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
- Trading loop –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
- –ù–µ—Å–∫–æ–ª—å–∫–æ –º–æ–¥—É–ª–µ–π –º–æ–≥—É—Ç –æ–±—Ä–∞—â–∞—Ç—å—Å—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- **–ë–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫:** Race conditions, –ø–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö, –Ω–µ–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å

---

## ‚úÖ –ì–î–ï DataRegistry –£–ñ–ï –ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø?

### 1. **ExitAnalyzer** ‚úÖ
```python
# –ü–æ–ª—É—á–∞–µ—Ç —Ä–µ–∂–∏–º –∏ –¥–∞–Ω–Ω—ã–µ –∏–∑ DataRegistry
regime_data = await self.data_registry.get_regime(symbol)
market_data = await self.data_registry.get_market_data(symbol)
current_price = await self.data_registry.get_price(symbol)
```

### 2. **PositionMonitor** ‚úÖ
```python
# –ò—Å–ø–æ–ª—å–∑—É–µ—Ç DataRegistry –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ä—ã–Ω–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π
await self.data_registry.update_market_data(symbol, market_data)
```

### 3. **TradingControlCenter** ‚úÖ
```python
# –ú–µ—Ç–æ–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å DataRegistry
await self.data_registry.update_market_data(symbol, data)
await self.data_registry.update_regime(symbol, regime, params)
await self.data_registry.update_balance(balance, profile)
```

---

## ‚ùå –ì–î–ï DataRegistry –ù–ï –ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø (–ù–û –î–û–õ–ñ–ï–ù)?

### 1. **SignalGenerator** ‚ùå
**–¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è:**
- –ü–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞–ø—Ä—è–º—É—é –∏–∑ WebSocket –∏–ª–∏ API
- –•—Ä–∞–Ω–∏—Ç —Å–≤–æ–∏ –∫–æ–ø–∏–∏ —Å–≤–µ—á–µ–π –∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤
- –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ

**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
```python
# –í–º–µ—Å—Ç–æ:
candles = await self.client.get_candles(symbol)
adx = self.fast_adx.calculate(candles)

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
candles = await self.data_registry.get_market_data(symbol)
adx = await self.data_registry.get_indicator(symbol, "adx")
```

**–ü—Ä–æ–±–ª–µ–º—ã —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–¥—Ö–æ–¥–∞:**
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (—Å–≤–µ—á–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –∏ –≤ WebSocket, –∏ –≤ SignalGenerator)
- –ù–µ–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å (–¥–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç —Ä–∞—Å—Ö–æ–¥–∏—Ç—å—Å—è)
- –õ–∏—à–Ω–∏–µ –∑–∞–ø—Ä–æ—Å—ã –∫ API (–µ—Å–ª–∏ WebSocket —É–∂–µ –æ–±–Ω–æ–≤–∏–ª –¥–∞–Ω–Ω—ã–µ)

---

### 2. **SignalCoordinator** ‚ùå
**–¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è:**
- –ü–æ–ª—É—á–∞–µ—Ç –±–∞–ª–∞–Ω—Å –Ω–∞–ø—Ä—è–º—É—é: `balance = await self.client.get_balance()`
- –ü–æ–ª—É—á–∞–µ—Ç —Ä–µ–∂–∏–º –Ω–∞–ø—Ä—è–º—É—é: `regime = signal_generator.regime_manager.get_current_regime()`
- –ü–æ–ª—É—á–∞–µ—Ç —Ü–µ–Ω—É –Ω–∞–ø—Ä—è–º—É—é: `price = signal.get("price")`

**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
```python
# –í–º–µ—Å—Ç–æ:
balance = await self.client.get_balance()
regime = signal_generator.regime_manager.get_current_regime()

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
balance_data = await self.data_registry.get_balance()
regime_data = await self.data_registry.get_regime(symbol)
```

---

### 3. **Orchestrator** ‚ùå
**–¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è:**
- –•—Ä–∞–Ω–∏—Ç —Å–≤–æ–∏ –∫–æ–ø–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- –ü–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞–ø—Ä—è–º—É—é –∏–∑ API
- –ü–µ—Ä–µ–¥–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –º–µ–∂–¥—É –º–æ–¥—É–ª—è–º–∏ —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

**–ü—Ä–∏–º–µ—Ä:**
```python
# –¢–µ–∫—É—â–∏–π –ø–æ–¥—Ö–æ–¥:
balance = await self.client.get_balance()
total_margin_used = await self._get_used_margin()
regime = signal_generator.regime_manager.get_current_regime()

# –î–æ–ª–∂–µ–Ω –±—ã—Ç—å:
balance_data = await self.data_registry.get_balance()
margin_data = await self.data_registry.get_margin()
regime_data = await self.data_registry.get_regime(symbol)
```

---

### 4. **–§–∏–ª—å—Ç—Ä—ã (ADX, MTF, Correlation, –∏ —Ç.–¥.)** ‚ùå
**–¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è:**
- –ö–∞–∂–¥—ã–π —Ñ–∏–ª—å—Ç—Ä –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ—Ç–¥–µ–ª—å–Ω–æ
- –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ
- –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
```python
# –í–º–µ—Å—Ç–æ:
adx_value = self.adx_filter.calculate(candles)
mtf_data = await self.mtf_filter.get_data(symbol)

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
adx_value = await self.data_registry.get_indicator(symbol, "adx")
mtf_data = await self.data_registry.get_indicator(symbol, "mtf")
```

---

### 5. **RiskManager** ‚ùå
**–¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è:**
- –ü–æ–ª—É—á–∞–µ—Ç –±–∞–ª–∞–Ω—Å –Ω–∞–ø—Ä—è–º—É—é
- –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Ä–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
```python
# –í–º–µ—Å—Ç–æ:
balance = await self.client.get_balance()
balance_profile = self.config_manager.get_balance_profile(balance)

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
balance_data = await self.data_registry.get_balance()
balance_profile = balance_data.get("profile")
```

---

## üéØ –ü–†–ï–ò–ú–£–©–ï–°–¢–í–ê DataRegistry

### 1. **–ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã**
- ‚úÖ –í—Å–µ –º–æ–¥—É–ª–∏ –ø–æ–ª—É—á–∞—é—Ç –æ–¥–Ω–∏ –∏ —Ç–µ –∂–µ –¥–∞–Ω–Ω—ã–µ
- ‚úÖ –ù–µ—Ç —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–π –º–µ–∂–¥—É –º–æ–¥—É–ª—è–º–∏
- ‚úÖ –õ–µ–≥–∫–æ –æ—Ç—Å–ª–µ–¥–∏—Ç—å, –æ—Ç–∫—É–¥–∞ –≤–∑—è–ª–∏—Å—å –¥–∞–Ω–Ω—ã–µ

### 2. **–ú–µ–Ω—å—à–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API**
- ‚úÖ WebSocket –æ–±–Ω–æ–≤–ª—è–µ—Ç DataRegistry –æ–¥–∏–Ω —Ä–∞–∑
- ‚úÖ –í—Å–µ –º–æ–¥—É–ª–∏ —á–∏—Ç–∞—é—Ç –∏–∑ DataRegistry
- ‚úÖ –ù–µ—Ç –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API

### 3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è**
- ‚úÖ –î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ
- ‚úÖ –í—Å–µ –º–æ–¥—É–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞—é—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- ‚úÖ –ù–µ –Ω—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –º–µ–∂–¥—É –º–æ–¥—É–ª—è–º–∏

### 4. **–õ–µ–≥–∫–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
- ‚úÖ –ú–æ–∂–Ω–æ –ª–µ–≥–∫–æ –ø–æ–¥–º–µ–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ DataRegistry
- ‚úÖ –ù–µ –Ω—É–∂–Ω–æ –º–æ–∫–∞—Ç—å API –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–æ–¥—É–ª—è
- ‚úÖ –ú–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞

### 5. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**
- ‚úÖ DataRegistry –º–æ–∂–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ
- ‚úÖ –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏
- ‚úÖ –ú–æ–∂–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –¥–∞–Ω–Ω—ã–µ (updated_at)

---

## üîÑ –ö–ê–ö –î–ê–ù–ù–´–ï –ü–û–ü–ê–î–ê–Æ–¢ –í DataRegistry?

### –¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è (—á–∞—Å—Ç–∏—á–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è):

1. **WebSocket** ‚Üí –û–±–Ω–æ–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ ‚Üí ‚ùå **–ù–ï –æ–±–Ω–æ–≤–ª—è–µ—Ç DataRegistry** (–¥–æ–ª–∂–µ–Ω!)
2. **SignalGenerator** ‚Üí –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã ‚Üí ‚ùå **–ù–ï —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ DataRegistry** (–¥–æ–ª–∂–µ–Ω!)
3. **RegimeManager** ‚Üí –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä–µ–∂–∏–º ‚Üí ‚ùå **–ù–ï –æ–±–Ω–æ–≤–ª—è–µ—Ç DataRegistry** (–¥–æ–ª–∂–µ–Ω!)
4. **Orchestrator** ‚Üí –ü–æ–ª—É—á–∞–µ—Ç –±–∞–ª–∞–Ω—Å ‚Üí ‚ùå **–ù–ï –æ–±–Ω–æ–≤–ª—è–µ—Ç DataRegistry** (–¥–æ–ª–∂–µ–Ω!)

### –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:

1. **WebSocket** ‚Üí –û–±–Ω–æ–≤–ª—è–µ—Ç —Ä—ã–Ω–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ ‚Üí ‚úÖ **DataRegistry.update_market_data()**
2. **SignalGenerator** ‚Üí –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã ‚Üí ‚úÖ **DataRegistry.update_indicators()**
3. **RegimeManager** ‚Üí –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä–µ–∂–∏–º ‚Üí ‚úÖ **DataRegistry.update_regime()**
4. **Orchestrator** ‚Üí –ü–æ–ª—É—á–∞–µ—Ç –±–∞–ª–∞–Ω—Å ‚Üí ‚úÖ **DataRegistry.update_balance()**
5. **MarginCalculator** ‚Üí –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –º–∞—Ä–∂—É ‚Üí ‚úÖ **DataRegistry.update_margin()**

---

## üìã –ü–õ–ê–ù –ü–û–õ–ù–û–ô –ò–ù–¢–ï–ì–†–ê–¶–ò–ò DataRegistry

### –≠–¢–ê–ü 1: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ DataRegistry ‚úÖ (—á–∞—Å—Ç–∏—á–Ω–æ)

**WebSocket –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ä—ã–Ω–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
```python
# –í WebSocketCoordinator –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö:
await self.data_registry.update_market_data(symbol, {
    "price": ticker["last"],
    "volume": ticker["vol24h"],
    "ticker": ticker,
    "updated_at": datetime.now()
})
```

**SignalGenerator —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã:**
```python
# –ü–æ—Å–ª–µ —Ä–∞—Å—á–µ—Ç–∞ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞:
adx_value = self.fast_adx.calculate(candles)
await self.data_registry.update_indicator(symbol, "adx", adx_value)
```

**RegimeManager –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ä–µ–∂–∏–º—ã:**
```python
# –ü–æ—Å–ª–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞:
regime = self.determine_regime(symbol)
params = self.get_regime_params(regime)
await self.data_registry.update_regime(symbol, regime, params)
```

**Orchestrator –æ–±–Ω–æ–≤–ª—è–µ—Ç –±–∞–ª–∞–Ω—Å –∏ –º–∞—Ä–∂—É:**
```python
# –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –±–∞–ª–∞–Ω—Å–∞:
balance = await self.client.get_balance()
profile = self.config_manager.get_balance_profile(balance)
await self.data_registry.update_balance(balance, profile)

# –ü—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ –º–∞—Ä–∂–∏:
margin_used = await self._get_used_margin()
await self.data_registry.update_margin(used=margin_used)
```

---

### –≠–¢–ê–ü 2: –ß—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ DataRegistry ‚è≥

**SignalCoordinator –∏—Å–ø–æ–ª—å–∑—É–µ—Ç DataRegistry:**
```python
# –í–º–µ—Å—Ç–æ –ø—Ä—è–º—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤:
balance_data = await self.data_registry.get_balance()
regime_data = await self.data_registry.get_regime(symbol)
margin_data = await self.data_registry.get_margin()
```

**–§–∏–ª—å—Ç—Ä—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç DataRegistry:**
```python
# ADX —Ñ–∏–ª—å—Ç—Ä:
adx_value = await self.data_registry.get_indicator(symbol, "adx")

# MTF —Ñ–∏–ª—å—Ç—Ä:
mtf_data = await self.data_registry.get_indicator(symbol, "mtf")
```

**RiskManager –∏—Å–ø–æ–ª—å–∑—É–µ—Ç DataRegistry:**
```python
balance_data = await self.data_registry.get_balance()
balance_profile = balance_data.get("profile")
```

---

### –≠–¢–ê–ü 3: –£–¥–∞–ª–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö üéØ

**–£–¥–∞–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –∫–æ–ø–∏–∏ –¥–∞–Ω–Ω—ã—Ö:**
- ‚ùå –£–¥–∞–ª—è–µ–º `signal_generator.candles_cache`
- ‚ùå –£–¥–∞–ª—è–µ–º `orchestrator.total_margin_used` (–∏—Å–ø–æ–ª—å–∑—É–µ–º –∏–∑ DataRegistry)
- ‚ùå –£–¥–∞–ª—è–µ–º –ø—Ä—è–º—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ API –¥–ª—è –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–µ –µ—Å—Ç—å –≤ DataRegistry

**–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ DataRegistry:**
- ‚úÖ –í—Å–µ –º–æ–¥—É–ª–∏ —á–∏—Ç–∞—é—Ç –∏–∑ DataRegistry
- ‚úÖ –í—Å–µ –º–æ–¥—É–ª–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç DataRegistry
- ‚úÖ –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

---

## üîç –ü–†–ò–ú–ï–†–´ –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø

### –ü—Ä–∏–º–µ—Ä 1: –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–∏–º–≤–æ–ª–∞

**–î–û (–±–µ–∑ DataRegistry):**
```python
# –ù—É–∂–Ω–æ –∑–∞–ø—Ä–æ—Å–∏—Ç—å –∏–∑ —Ä–∞–∑–Ω—ã—Ö –º–µ—Å—Ç:
price = await client.get_ticker(symbol)["last"]
candles = await client.get_candles(symbol)
adx = signal_generator.fast_adx.calculate(candles)
regime = signal_generator.regime_manager.get_current_regime()
balance = await client.get_balance()

# 5 –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ —Ä–∞–∑–Ω—ã–º –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º!
```

**–ü–û–°–õ–ï (—Å DataRegistry):**
```python
# –í—Å–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞:
market_data = await data_registry.get_market_data(symbol)
indicators = await data_registry.get_indicators(symbol)
regime_data = await data_registry.get_regime(symbol)
balance_data = await data_registry.get_balance()

# –í—Å–µ –¥–∞–Ω–Ω—ã–µ —É–∂–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã, –Ω–µ –Ω—É–∂–Ω–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å!
```

---

### –ü—Ä–∏–º–µ—Ä 2: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ

**–î–û (–±–µ–∑ DataRegistry):**
```python
# –ù—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–µ—Å—Ç–∞—Ö:
signal_generator.candles_cache[symbol] = candles
orchestrator.last_prices[symbol] = price
web_socket.price_cache[symbol] = price

# –õ–µ–≥–∫–æ –∑–∞–±—ã—Ç—å –æ–±–Ω–æ–≤–∏—Ç—å –≥–¥–µ-—Ç–æ!
```

**–ü–û–°–õ–ï (—Å DataRegistry):**
```python
# –û–±–Ω–æ–≤–ª—è–µ–º –æ–¥–∏–Ω —Ä–∞–∑:
await data_registry.update_market_data(symbol, {
    "price": price,
    "candles": candles
})

# –í—Å–µ –º–æ–¥—É–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ!
```

---

## üìä –¢–ï–ö–£–©–ò–ô –°–¢–ê–¢–£–° –ò–ù–¢–ï–ì–†–ê–¶–ò–ò

### ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:
- ExitAnalyzer - –ø–æ–ª—É—á–∞–µ—Ç —Ä–µ–∂–∏–º, market data, —Ü–µ–Ω—É
- PositionMonitor - –æ–±–Ω–æ–≤–ª—è–µ—Ç market data
- TradingControlCenter - –º–µ—Ç–æ–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å DataRegistry

### ‚è≥ –ß–∞—Å—Ç–∏—á–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:
- Orchestrator - —Å–æ–∑–¥–∞–Ω DataRegistry, –Ω–æ –Ω–µ –≤—Å–µ –º–æ–¥—É–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç
- PositionManager - —Å—Å—ã–ª–∫–∞ –µ—Å—Ç—å, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∞–∫—Ç–∏–≤–Ω–æ

### ‚ùå –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:
- SignalGenerator - –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞–ø—Ä—è–º—É—é
- SignalCoordinator - –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞–ø—Ä—è–º—É—é
- –§–∏–ª—å—Ç—Ä—ã - –ø–æ–ª—É—á–∞—é—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞–ø—Ä—è–º—É—é
- RiskManager - –ø–æ–ª—É—á–∞–µ—Ç –±–∞–ª–∞–Ω—Å –Ω–∞–ø—Ä—è–º—É—é
- WebSocket - –ù–ï –æ–±–Ω–æ–≤–ª—è–µ—Ç DataRegistry –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö

---

## üéØ –ü–õ–ê–ù –î–ï–ô–°–¢–í–ò–ô

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ DataRegistry
1. WebSocket –æ–±–Ω–æ–≤–ª—è–µ—Ç market data –≤ DataRegistry
2. SignalGenerator —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –≤ DataRegistry
3. RegimeManager –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ä–µ–∂–∏–º—ã –≤ DataRegistry
4. Orchestrator –æ–±–Ω–æ–≤–ª—è–µ—Ç –±–∞–ª–∞–Ω—Å –∏ –º–∞—Ä–∂—É –≤ DataRegistry

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –ß—Ç–µ–Ω–∏–µ –∏–∑ DataRegistry
1. SignalCoordinator —á–∏—Ç–∞–µ—Ç –∏–∑ DataRegistry
2. –§–∏–ª—å—Ç—Ä—ã —á–∏—Ç–∞—é—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –∏–∑ DataRegistry
3. RiskManager —á–∏—Ç–∞–µ—Ç –±–∞–ª–∞–Ω—Å –∏–∑ DataRegistry

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: –û—á–∏—Å—Ç–∫–∞
1. –£–¥–∞–ª—è–µ–º –¥—É–±–ª–∏—Ä—É—é—â–∏–µ –∫—ç—à–∏
2. –£–¥–∞–ª—è–µ–º –ø—Ä—è–º—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ API
3. –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ DataRegistry

---

## üí° –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

**DataRegistry** - —ç—Ç–æ –∫–ª—é—á–µ–≤–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã, –∫–æ—Ç–æ—Ä—ã–π:
- ‚úÖ –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑—É–µ—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
- ‚úÖ –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å
- ‚úÖ –£–º–µ–Ω—å—à–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API
- ‚úÖ –£–ø—Ä–æ—â–∞–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –û–±–ª–µ–≥—á–∞–µ—Ç –æ—Ç–ª–∞–¥–∫—É

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:** DataRegistry —Å–æ–∑–¥–∞–Ω –∏ —á–∞—Å—Ç–∏—á–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –Ω–æ **–ø–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –µ—â–µ –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∞**.

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –ù–∞—á–∞—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ DataRegistry –∏–∑ WebSocket –∏ SignalGenerator.

---

**DataRegistry - —ç—Ç–æ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ–π –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ–π —Ç–æ—Ä–≥–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã! üöÄ**

