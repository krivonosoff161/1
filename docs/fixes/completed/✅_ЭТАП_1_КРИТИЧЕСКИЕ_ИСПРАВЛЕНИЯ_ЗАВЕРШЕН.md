# ‚úÖ –≠–¢–ê–ü 1: –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –ó–ê–í–ï–†–®–ï–ù–´

**–î–∞—Ç–∞:** 25.11.2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã

---

## ‚úÖ –í–´–ü–û–õ–ù–ï–ù–ù–´–ï –ó–ê–î–ê–ß–ò

### 1. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω `close_partial_position()` –≤ position_manager

**–§–∞–π–ª:** `src/strategies/scalping/futures/position_manager.py`

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- –ú–µ—Ç–æ–¥ `close_partial_position(symbol, fraction, reason)` –¥–ª—è —á–∞—Å—Ç–∏—á–Ω–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–π
- –†–∞—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–∞ –∑–∞–∫—Ä—ã—Ç–∏—è —Å —É—á–µ—Ç–æ–º `fraction` (0.0-1.0)
- –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ ‚Üí –º–æ–Ω–µ—Ç—ã —á–µ—Ä–µ–∑ `ctVal`
- –†–∞–∑–º–µ—â–µ–Ω–∏–µ MARKET –æ—Ä–¥–µ—Ä–∞ —Å `reduceOnly=True`
- –†–∞—Å—á–µ—Ç PnL –¥–ª—è –∑–∞–∫—Ä—ã—Ç–æ–π —á–∞—Å—Ç–∏
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–∏ (`partial_tp_done = True`)
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ PositionRegistry (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
- –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ —Å –±–∏—Ä–∂–∏
- –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞ —á–µ—Ä–µ–∑ `ctVal`
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ —Ç–æ–ª—å–∫–æ —á–∞—Å—Ç–∏ –ø–æ–∑–∏—Ü–∏–∏ (–Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –Ω–æ–≤—É—é)
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —á–∞—Å—Ç–∏—á–Ω–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è

---

### 2. ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω Partial Close –≤ trailing_sl_coordinator

**–§–∞–π–ª:** `src/strategies/scalping/futures/coordinators/trailing_sl_coordinator.py`

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- –£–±—Ä–∞–Ω TODO –Ω–∞ —Å—Ç—Ä–æ–∫–µ 672
- –í—ã–∑–æ–≤ `position_manager.close_partial_position()` –ø—Ä–∏ `action == "partial_close"`
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —á–∞—Å—Ç–∏—á–Ω–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è
- –ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –æ—Å—Ç–∞–≤—à–µ–π—Å—è –ø–æ–∑–∏—Ü–∏–∏ –ø–æ—Å–ª–µ —á–∞—Å—Ç–∏—á–Ω–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —á–∞—Å—Ç–∏—á–Ω–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:**
- ExitAnalyzer –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ—à–µ–Ω–∏–µ `partial_close` —Å `fraction`
- TrailingSLCoordinator –ø–æ–ª—É—á–∞–µ—Ç —Ä–µ—à–µ–Ω–∏–µ –∏ –≤—ã–∑—ã–≤–∞–µ—Ç `close_partial_position()`
- –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —á–∞—Å—Ç–∏—á–Ω–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏—è –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å—Å—è

---

### 3. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –ø—Ä–æ–¥–ª–µ–Ω–∏–µ TP (extend_tp)

**–§–∞–π–ª:** `src/strategies/scalping/futures/coordinators/trailing_sl_coordinator.py`

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ—à–µ–Ω–∏—è `action == "extend_tp"` –æ—Ç ExitAnalyzer
- –ü–æ–ª—É—á–µ–Ω–∏–µ `new_tp_percent` –∏–∑ —Ä–µ—à–µ–Ω–∏—è
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ TSL –¥–ª—è –ø—Ä–æ–¥–ª–µ–Ω–∏—è TP:
  - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ `original_tp_percent`
  - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ `extended_tp_percent = new_tp_percent`
  - –°—á–µ—Ç—á–∏–∫ –ø—Ä–æ–¥–ª–µ–Ω–∏–π `tp_extended_count`
- –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–¥–ª–µ–Ω–∏—è TP

**–õ–æ–≥–∏–∫–∞:**
- ExitAnalyzer –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `extend_tp` —Å `new_tp` –∏ `trend_strength`
- TrailingSLCoordinator –æ–±–Ω–æ–≤–ª—è–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã TSL
- TSL –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –Ω–æ–≤—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ (–∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è)

---

### 4. ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ adaptive_min_holding –¥–ª—è Partial TP

**–§–∞–π–ª:** `src/strategies/scalping/futures/positions/exit_analyzer.py`

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- –ù–æ–≤—ã–π –º–µ—Ç–æ–¥ `_check_adaptive_min_holding_for_partial_tp()`
- –ü–æ–ª—É—á–µ–Ω–∏–µ `entry_time` –∏–∑ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–∏
- –†–∞—Å—á–µ—Ç –≤—Ä–µ–º–µ–Ω–∏ —É–¥–µ—Ä–∂–∞–Ω–∏—è –ø–æ–∑–∏—Ü–∏–∏
- –ü–æ–ª—É—á–µ–Ω–∏–µ –±–∞–∑–æ–≤–æ–≥–æ `min_holding_minutes` –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ –ø–æ —Ä–µ–∂–∏–º—É
- –ê–¥–∞–ø—Ç–∏–≤–Ω–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ `min_holding` –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∏–±—ã–ª–∏:
  - –ü—Ä–∏–±—ã–ª—å >= 1.0% ‚Üí —Å–Ω–∏–∂–∞–µ–º –¥–æ 50% –æ—Ç –±–∞–∑–æ–≤–æ–≥–æ
  - –ü—Ä–∏–±—ã–ª—å >= 0.5% ‚Üí —Å–Ω–∏–∂–∞–µ–º –¥–æ 75% –æ—Ç –±–∞–∑–æ–≤–æ–≥–æ
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è `min_holding` –ø–µ—Ä–µ–¥ Partial TP

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤–æ –≤—Å–µ —Ä–µ–∂–∏–º—ã:**
- ‚úÖ TRENDING —Ä–µ–∂–∏–º
- ‚úÖ RANGING —Ä–µ–∂–∏–º  
- ‚úÖ CHOPPY —Ä–µ–∂–∏–º

**–õ–æ–≥–∏–∫–∞:**
1. ExitAnalyzer –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç—Ä–∏–≥–≥–µ—Ä Partial TP
2. –ï—Å–ª–∏ —Ç—Ä–∏–≥–≥–µ—Ä –¥–æ—Å—Ç–∏–≥–Ω—É—Ç, –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è `adaptive_min_holding`
3. –ï—Å–ª–∏ `min_holding` –Ω–µ –ø—Ä–æ–π–¥–µ–Ω ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è `action: "hold"`
4. –ï—Å–ª–∏ `min_holding` –ø—Ä–æ–π–¥–µ–Ω ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è `action: "partial_close"`

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞:**
```yaml
partial_tp:
  adaptive_min_holding:
    enabled: true
    profit_threshold_1: 1.0    # >= 1.0% ‚Üí —Å–Ω–∏–∂–∞–µ–º –¥–æ 50%
    profit_threshold_2: 0.5    # >= 0.5% ‚Üí —Å–Ω–∏–∂–∞–µ–º –¥–æ 75%
    reduction_factor_1: 0.5    # 50%
    reduction_factor_2: 0.75   # 75%
```

---

## üìã –†–ï–ó–£–õ–¨–¢–ê–¢

‚úÖ **Partial TP –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- –ß–∞—Å—Ç–∏—á–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–π —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å ExitAnalyzer –≤—ã–ø–æ–ª–Ω–µ–Ω–∞
- Adaptive min_holding —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è
- –í—Å–µ —Ä–µ–∂–∏–º—ã (trending, ranging, choppy) –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç Partial TP

‚úÖ **Extend TP –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- –ü—Ä–æ–¥–ª–µ–Ω–∏–µ TP —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ —á–µ—Ä–µ–∑ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ TSL
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å ExitAnalyzer –≤—ã–ø–æ–ª–Ω–µ–Ω–∞
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–¥–ª–µ–Ω–∏–π –¥–æ–±–∞–≤–ª–µ–Ω–æ

‚úÖ **–í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ TODO —É–±—Ä–∞–Ω—ã:**
- TODO –Ω–∞ —Å—Ç—Ä–æ–∫–µ 672 –≤ trailing_sl_coordinator —É–¥–∞–ª–µ–Ω
- –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã

---

## üéØ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

**–≠–¢–ê–ü 2:** –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è EntryManager –≤ signal_coordinator  
**–≠–¢–ê–ü 3:** –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è PositionMonitor –∫–∞–∫ —Ñ–æ–Ω–æ–≤–æ–π –∑–∞–¥–∞—á–∏  
**–≠–¢–ê–ü 4:** –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è SignalPipeline  
**–≠–¢–ê–ü 5:** –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è TradingControlCenter  
**–≠–¢–ê–ü 6:** –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ PositionRegistry  
**–≠–¢–ê–ü 7:** –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ DataRegistry  

---

**–í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω—ã! ‚úÖ**






