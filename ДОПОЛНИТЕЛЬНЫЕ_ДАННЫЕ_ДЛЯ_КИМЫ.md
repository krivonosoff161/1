# üìé –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –î–ê–ù–ù–´–ï –î–õ–Ø –ê–ù–ê–õ–ò–ó–ê –ö–ò–ú–ï

**–î–∞—Ç–∞:** 2025-12-07  
**–í–æ–ø—Ä–æ—Å:** –ü–æ—á–µ–º—É 2 –ø–æ–∑–∏—Ü–∏–∏ –æ—Ç—Ä–∞–±–æ—Ç–∞–ª–∏ –≤ –ø–ª—é—Å, –∞ 4 –æ—Ç–∫—Ä—ã–ª–∏—Å—å –≤ –º–∏–Ω—É—Å –∏ –≤–∏—Å—è—Ç?  
**–¶–µ–ª—å:** –ù–∞–π—Ç–∏ –æ—à–∏–±–∫—É –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏ —Ä—ã–Ω–∫–∞

---

## 1Ô∏è‚É£ –†–ï–ñ–ò–ú –†–´–ù–ö–ê VS –°–ò–ì–ù–ê–õ–´

### –§–∞–π–ª: `src/strategies/scalping/futures/adaptivity/regime_manager.py`

### 30 —Å—Ç—Ä–æ–∫ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è trending/ranging/choppy –ø–æ ADX, –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏, DI+/- (—Å—Ç—Ä–æ–∫–∏ 384-477):

```python
    def _classify_regime(
        self, indicators: Dict[str, float]
    ) -> tuple[RegimeType, float, str]:
        """
        –ö–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç —Ä–µ–∂–∏–º —Ä—ã–Ω–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤.

        Returns:
            (regime_type, confidence, reason)
        """
        vol = indicators["volatility_percent"]
        trend_dev = indicators["trend_deviation"]
        adx = indicators["adx_proxy"]
        range_width = indicators["range_width"]
        reversals = indicators["reversals"]

        # CHOPPY: –í—ã—Å–æ–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å + –º–Ω–æ–≥–æ —Ä–∞–∑–≤–æ—Ä–æ—Ç–æ–≤ + –≤—ã—Å–æ–∫–∏–π –æ–±—ä–µ–º
        volume_ratio = indicators.get("volume_ratio", 1.0)
        # ‚úÖ –í—ã—Å–æ–∫–∏–π –æ–±—ä–µ–º + —Ö–∞–æ—Å = choppy (–Ω–µ –ø—É—Ç–∞—Ç—å —Å trending!)
        has_choppy_volume = volume_ratio > 1.5  # –û—á–µ–Ω—å –≤—ã—Å–æ–∫–∏–π –æ–±—ä–µ–º + —Ö–∞–æ—Å

        if (
            vol > self.config.high_volatility_threshold
            and reversals > 10
            and has_choppy_volume
        ):
            confidence = min(
                1.0,
                (vol / 0.1) * 0.4
                + (reversals / 20) * 0.3
                + (0.3 if has_choppy_volume else 0),
            )
            reason = (
                f"High volatility ({vol:.2%}) + {reversals} reversals + "
                f"high volume ({volume_ratio:.2f}x) ‚Üí Chaotic market"
            )
            return RegimeType.CHOPPY, confidence, reason

        # TRENDING: –°–∏–ª—å–Ω—ã–π —Ç—Ä–µ–Ω–¥ + –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ + –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ–±—ä–µ–º–æ–º
        # ‚úÖ –ò–°–ü–û–õ–¨–ó–£–ï–ú –ù–ê–°–¢–û–Ø–©–ò–ô ADX –∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–µ–Ω–¥–∞ (+DI/-DI)
        trend_direction = indicators.get("trend_direction", "neutral")
        di_plus = indicators.get("di_plus", 0)
        di_minus = indicators.get("di_minus", 0)
        volume_ratio = indicators.get("volume_ratio", 1.0)

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –µ—Å—Ç—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ—Å—Ç—å (+DI > -DI –¥–ª—è bullish –∏–ª–∏ -DI > +DI –¥–ª—è bearish)
        has_direction = (trend_direction in ["bullish", "bearish"]) or (
            abs(di_plus - di_minus) > 5.0  # –†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É +DI –∏ -DI > 5
        )

        # ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ–±—ä–µ–º–æ–º (–≤—ã—Å–æ–∫–∏–π –æ–±—ä–µ–º = —Å–∏–ª—å–Ω—ã–π —Ç—Ä–µ–Ω–¥)
        has_volume_confirmation = volume_ratio > 1.2  # –û–±—ä–µ–º –≤—ã—à–µ —Å—Ä–µ–¥–Ω–µ–≥–æ –Ω–∞ 20%

        if (
            trend_dev > self.config.trend_strength_percent
            and adx > self.config.trending_adx_threshold
            and has_direction
            and has_volume_confirmation  # ‚úÖ –î–æ–±–∞–≤–∏–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫—É –æ–±—ä–µ–º–∞
        ):
            confidence = min(
                1.0,
                (trend_dev / 5.0) * 0.3
                + (adx / 50.0) * 0.3
                + (0.2 if has_direction else 0)
                + (0.2 if has_volume_confirmation else 0),
            )
            trend_info = (
                f"({trend_direction}, +DI={di_plus:.1f}, -DI={di_minus:.1f})"
                if trend_direction != "neutral"
                else ""
            )
            reason = (
                f"Strong trend (deviation {trend_dev:.2%}, ADX {adx:.1f} {trend_info}, "
                f"volume={volume_ratio:.2f}x) ‚Üí Trending market"
            )
            return RegimeType.TRENDING, confidence, reason

        # RANGING: –£–∑–∫–∏–π –¥–∏–∞–ø–∞–∑–æ–Ω + —Å–ª–∞–±—ã–π —Ç—Ä–µ–Ω–¥
        if (
            range_width < 3.0
            and trend_dev < self.config.trend_strength_percent
            and adx < self.config.ranging_adx_threshold
        ):
            confidence = min(1.0, (3.0 - range_width) / 3.0)
            reason = (
                f"Narrow range ({range_width:.2%}), weak trend (ADX {adx:.1f}) "
                f"‚Üí Ranging market"
            )
            return RegimeType.RANGING, confidence, reason

        # –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: RANGING (–±–µ–∑–æ–ø–∞—Å–Ω—ã–π —Ä–µ–∂–∏–º)
        return (
            RegimeType.RANGING,
            0.5,
            "No clear regime detected ‚Üí default to RANGING",
        )
```

### –†–∞—Å—á–µ—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ (—Å—Ç—Ä–æ–∫–∏ 296-382):

```python
    def _calculate_regime_indicators(
        self, candles: List[OHLCV], current_price: float
    ) -> Dict[str, float]:
        """–†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞."""
        closes = [c.close for c in candles]
        highs = [c.high for c in candles]
        lows = [c.low for c in candles]

        # SMA –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç—Ä–µ–Ω–¥–∞
        sma_20 = sum(closes[-20:]) / 20
        sma_50 = sum(closes[-50:]) / 50

        # –í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å (ATR —É–ø—Ä–æ—â–µ–Ω–Ω—ã–π)
        true_ranges = []
        for i in range(1, len(candles)):
            high_low = highs[i] - lows[i]
            high_close = abs(highs[i] - closes[i - 1])
            low_close = abs(lows[i] - closes[i - 1])
            true_ranges.append(max(high_low, high_close, low_close))

        atr = sum(true_ranges[-14:]) / 14 if len(true_ranges) >= 14 else 0
        volatility_percent = (atr / current_price) * 100 if current_price > 0 else 0

        # ‚úÖ –ò–°–ü–û–õ–¨–ó–£–ï–ú –ù–ê–°–¢–û–Ø–©–ò–ô ADX —á–µ—Ä–µ–∑ FastADX –≤–º–µ—Å—Ç–æ ADX Proxy
        # –û–±–Ω–æ–≤–ª—è–µ–º FastADX —Å –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏
        for candle in candles[-self.fast_adx.period :]:
            self.fast_adx.update(high=candle.high, low=candle.low, close=candle.close)

        # –ü–æ–ª—É—á–∞–µ–º –Ω–∞—Å—Ç–æ—è—â–∏–π ADX –∏ +DI/-DI
        adx_value = self.fast_adx.get_adx_value()
        di_plus = self.fast_adx.get_di_plus()
        di_minus = self.fast_adx.get_di_minus()
        trend_direction = (
            self.fast_adx.get_trend_direction()
        )  # "bullish"/"bearish"/"neutral"

        # –î–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∫–∞–∫ adx_proxy, –Ω–æ —ç—Ç–æ —Ç–µ–ø–µ—Ä—å –Ω–∞—Å—Ç–æ—è—â–∏–π ADX
        adx_proxy = adx_value

        # ‚úÖ Volume indicators –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞
        volumes = [c.volume for c in candles]
        # Volume MA (20) - —Å—Ä–µ–¥–Ω–∏–π –æ–±—ä–µ–º
        volume_ma = (
            sum(volumes[-20:]) / 20
            if len(volumes) >= 20
            else sum(volumes) / len(volumes)
            if volumes
            else 0
        )
        # Volume Ratio = —Ç–µ–∫—É—â–∏–π –æ–±—ä–µ–º / —Å—Ä–µ–¥–Ω–∏–π –æ–±—ä–µ–º
        current_volume = volumes[-1] if volumes else 0
        volume_ratio = current_volume / volume_ma if volume_ma > 0 else 1.0

        # Trend strength (–æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –æ—Ç SMA)
        trend_deviation = ((current_price - sma_50) / sma_50) * 100

        # Range detection (—Ü–µ–Ω–∞ –≤ —É–∑–∫–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ?)
        recent_high = max(highs[-20:])
        recent_low = min(lows[-20:])
        range_width = ((recent_high - recent_low) / recent_low) * 100

        # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞–∑–≤–æ—Ä–æ—Ç–æ–≤ (–¥–ª—è choppy)
        reversals = 0
        for i in range(-20, -1):
            if i > -20:
                prev_direction = closes[i - 1] > closes[i - 2]
                curr_direction = closes[i] > closes[i - 1]
                if prev_direction != curr_direction:
                    reversals += 1

        return {
            "sma_20": sma_20,
            "sma_50": sma_50,
            "current_price": current_price,
            "atr": atr,
            "volatility_percent": volatility_percent,
            "adx_proxy": adx_proxy,  # –¢–µ–ø–µ—Ä—å —ç—Ç–æ –Ω–∞—Å—Ç–æ—è—â–∏–π ADX
            "adx": adx_value,  # –î–æ–±–∞–≤–ª—è–µ–º —è–≤–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ ADX
            "di_plus": di_plus,  # +DI –¥–ª—è –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–µ–Ω–¥–∞
            "di_minus": di_minus,  # -DI –¥–ª—è –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–µ–Ω–¥–∞
            "trend_direction": trend_direction,  # "bullish"/"bearish"/"neutral"
            "trend_deviation": abs(trend_deviation),
            "range_width": range_width,
            "reversals": reversals,
            "volume_ma": volume_ma,  # –°—Ä–µ–¥–Ω–∏–π –æ–±—ä–µ–º
            "volume_ratio": volume_ratio,  # –¢–µ–∫—É—â–∏–π –æ–±—ä–µ–º / —Å—Ä–µ–¥–Ω–∏–π –æ–±—ä–µ–º
        }
```

### –ö–ª—é—á–µ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è RANGING:

- **range_width < 3.0** (—É–∑–∫–∏–π –¥–∏–∞–ø–∞–∑–æ–Ω)
- **trend_dev < trend_strength_percent** (—Å–ª–∞–±—ã–π —Ç—Ä–µ–Ω–¥)
- **adx < ranging_adx_threshold** (ADX < 15 –¥–ª—è ranging)

---

## 2Ô∏è‚É£ –ì–ï–ù–ï–†–ê–¶–ò–Ø –°–ò–ì–ù–ê–õ–û–í VS –†–ï–ñ–ò–ú

### –§–∞–π–ª: `src/strategies/scalping/futures/signal_generator.py`

### 50 —Å—Ç—Ä–æ–∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ buy/sell –ø—Ä–∏ regime=ranging (—Å—Ç—Ä–æ–∫–∏ 1871-2120):

```python
    async def _generate_rsi_signals(
        self,
        symbol: str,
        indicators: Dict,
        market_data: MarketData,
        adx_trend: Optional[str] = None,
        adx_value: float = 0.0,
        adx_threshold: float = 25.0,
    ) -> List[Dict[str, Any]]:
        """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è RSI —Å–∏–≥–Ω–∞–ª–æ–≤ —Å —Ä–µ–∂–∏–º-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–º–∏ –ø–æ—Ä–æ–≥–∞–º–∏"""
        signals = []

        try:
            rsi = indicators.get("rsi", 50)

            # ‚úÖ –ü–æ–ª—É—á–∞–µ–º —Ä–µ–∂–∏–º-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ —Å–∏–º–≤–æ–ª–∞
            regime_params = self._get_regime_indicators_params(symbol=symbol)
            rsi_oversold = regime_params.get("rsi_oversold", 30)
            rsi_overbought = regime_params.get("rsi_overbought", 70)

            # –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
            regime_manager = self.regime_managers.get(symbol) or self.regime_manager
            current_regime = (
                regime_manager.get_current_regime() if regime_manager else "N/A"
            )

            # ‚úÖ –ü–æ–ª—É—á–∞–µ–º EMA –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç—Ä–µ–Ω–¥–∞
            ema_fast = indicators.get("ema_12", 0)
            ema_slow = indicators.get("ema_26", 0)
            current_price = (
                market_data.ohlcv_data[-1].close if market_data.ohlcv_data else 0.0
            )

            # –ü–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω–Ω–æ—Å—Ç—å (–ø–æ–∫—É–ø–∫–∞) - –∏—Å–ø–æ–ª—å–∑—É–µ–º –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π –ø–æ—Ä–æ–≥
            if rsi < rsi_oversold:
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç—Ä–µ–Ω–¥ —á–µ—Ä–µ–∑ EMA - –µ—Å–ª–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç, —Å–Ω–∏–∂–∞–µ–º confidence
                is_downtrend = ema_fast < ema_slow and current_price < ema_fast

                # ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
                current_regime = "ranging"  # Fallback
                try:
                    if hasattr(self, "regime_manager") and self.regime_manager:
                        regime_obj = self.regime_manager.get_current_regime()
                        if regime_obj:
                            current_regime = (
                                regime_obj.lower()
                                if isinstance(regime_obj, str)
                                else str(regime_obj).lower()
                            )
                except Exception as e:
                    logger.debug(f"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Ä–µ–∂–∏–º –¥–ª—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏: {e}")

                # ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –í trending —Ä–µ–∂–∏–º–µ - –ø–æ–ª–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø—Ä–æ—Ç–∏–≤–æ—Ç—Ä–µ–Ω–¥–æ–≤—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤
                should_block = current_regime == "trending" and is_downtrend
                if should_block:
                    logger.debug(
                        f"üö´ RSI OVERSOLD —Å–∏–≥–Ω–∞–ª –ü–û–õ–ù–û–°–¢–¨–Æ –ó–ê–ë–õ–û–ö–ò–†–û–í–ê–ù –¥–ª—è {symbol}: "
                        f"trending —Ä–µ–∂–∏–º + EMA bearish (–∫–æ–Ω—Ñ–ª–∏–∫—Ç —Å —Ç—Ä–µ–Ω–¥–æ–º)"
                    )
                else:
                    # –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Å–∏–ª–∞: –æ—Ç 0 –¥–æ 1
                    strength = min(1.0, (rsi_oversold - rsi) / rsi_oversold)

                    # ‚úÖ –ó–ê–î–ê–ß–ê #7: –ü—Ä–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–µ —Å–Ω–∏–∂–∞–µ–º strength –∞–¥–∞–ø—Ç–∏–≤–Ω–æ –ø–æ–¥ —Ä–µ–∂–∏–º (—Ç–æ–ª—å–∫–æ –¥–ª—è ranging/choppy)
                    if is_downtrend:
                        # –ö–æ–Ω—Ñ–ª–∏–∫—Ç: RSI oversold (LONG) vs EMA bearish (DOWN)
                        # –ü–æ–ª—É—á–∞–µ–º strength_multiplier –¥–ª—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
                        conflict_multiplier = 0.5  # Fallback
                        try:
                            # –ü–æ–ª—É—á–∞–µ–º —Ä–µ–∂–∏–º
                            regime_name_rsi = "ranging"  # Fallback
                            if hasattr(self, "regime_manager") and self.regime_manager:
                                regime_obj = self.regime_manager.get_current_regime()
                                if regime_obj:
                                    regime_name_rsi = (
                                        regime_obj.lower()
                                        if isinstance(regime_obj, str)
                                        else str(regime_obj).lower()
                                    )

                            adaptive_regime = getattr(
                                self.scalping_config, "adaptive_regime", {}
                            )
                            if isinstance(adaptive_regime, dict):
                                regime_config = adaptive_regime.get(regime_name_rsi, {})
                            else:
                                regime_config = getattr(
                                    adaptive_regime, regime_name_rsi, {}
                                )

                            if isinstance(regime_config, dict):
                                strength_multipliers = regime_config.get(
                                    "strength_multipliers", {}
                                )
                                conflict_multiplier = strength_multipliers.get(
                                    "conflict", 0.5
                                )
                            else:
                                strength_multipliers = getattr(
                                    regime_config, "strength_multipliers", None
                                )
                                if strength_multipliers:
                                    conflict_multiplier = getattr(
                                        strength_multipliers, "conflict", 0.5
                                    )
                        except Exception as e:
                            logger.debug(
                                f"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å conflict_multiplier –¥–ª—è {regime_name_rsi}: {e}"
                            )

                        # ‚úÖ –ó–ê–î–ê–ß–ê #7: –°–Ω–∏–∂–∞–µ–º strength –ø—Ä–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–µ
                        strength *= conflict_multiplier

                        # ‚úÖ –ê–î–ê–ü–¢–ò–í–ù–û: –°–Ω–∏–∂–µ–Ω–Ω–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ (50% –æ—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ–π)
                        normal_conf = confidence_config_rsi.get("rsi_signal", 0.6)
                        confidence = (
                            normal_conf * 0.5
                        )  # –ö–æ–Ω—Ñ–ª–∏–∫—Ç = 50% –æ—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ–π —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏
                        has_conflict = True
                        logger.debug(
                            f"‚ö° RSI OVERSOLD —Å –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–º –¥–ª—è {symbol}: "
                            f"RSI oversold, –Ω–æ EMA/—Ü–µ–Ω–∞ –Ω–µ bullish, "
                            f"strength —Å–Ω–∏–∂–µ–Ω –Ω–∞ {conflict_multiplier:.1%} (—Å—Ç–∞–ª–æ {strength:.3f})"
                        )
                    else:
                        confidence = confidence_config_rsi.get(
                            "rsi_signal", 0.6
                        )  # ‚úÖ –ê–î–ê–ü–¢–ò–í–ù–û: –ò–∑ –∫–æ–Ω—Ñ–∏–≥–∞
                        has_conflict = False

                    # ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ü—Ä–æ–≤–µ—Ä—è–µ–º ADX —Ç—Ä–µ–Ω–¥ –ü–†–ò –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–∏–≥–Ω–∞–ª–∞
                    if adx_trend == "bearish" and adx_value >= adx_threshold:
                        # –°–∏–ª—å–Ω—ã–π –Ω–∏—Å—Ö–æ–¥—è—â–∏–π —Ç—Ä–µ–Ω–¥ - –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º BUY —Å–∏–≥–Ω–∞–ª
                        logger.debug(
                            f"üö´ RSI OVERSOLD —Å–∏–≥–Ω–∞–ª –û–¢–ú–ï–ù–ï–ù –¥–ª—è {symbol}: "
                            f"ADX –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∏—Å—Ö–æ–¥—è—â–∏–π —Ç—Ä–µ–Ω–¥ (ADX={adx_value:.1f}, -DI –¥–æ–º–∏–Ω–∏—Ä—É–µ—Ç)"
                        )
                    else:
                        signals.append(
                            {
                                "symbol": symbol,
                                "side": "buy",
                                "type": "rsi_oversold",
                                "strength": strength,
                                "price": current_price,
                                "timestamp": datetime.now(),
                                "indicator_value": rsi,
                                "confidence": confidence,
                                "has_conflict": has_conflict,  # ‚úÖ –§–ª–∞–≥ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ –¥–ª—è order_executor
                            }
                        )

            # –ü–µ—Ä–µ–∫—É–ø–ª–µ–Ω–Ω–æ—Å—Ç—å (–ø—Ä–æ–¥–∞–∂–∞) - –∏—Å–ø–æ–ª—å–∑—É–µ–º –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π –ø–æ—Ä–æ–≥
            elif rsi > rsi_overbought:
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç—Ä–µ–Ω–¥ —á–µ—Ä–µ–∑ EMA - –µ—Å–ª–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç, —Å–Ω–∏–∂–∞–µ–º confidence
                is_uptrend = ema_fast > ema_slow and current_price > ema_fast

                # ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
                current_regime = "ranging"  # Fallback
                try:
                    if hasattr(self, "regime_manager") and self.regime_manager:
                        regime_obj = self.regime_manager.get_current_regime()
                        if regime_obj:
                            current_regime = (
                                regime_obj.lower()
                                if isinstance(regime_obj, str)
                                else str(regime_obj).lower()
                            )
                except Exception as e:
                    logger.debug(f"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Ä–µ–∂–∏–º –¥–ª—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏: {e}")

                # ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –í trending —Ä–µ–∂–∏–º–µ - –ø–æ–ª–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø—Ä–æ—Ç–∏–≤–æ—Ç—Ä–µ–Ω–¥–æ–≤—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤
                should_block = current_regime == "trending" and is_uptrend
                if should_block:
                    logger.debug(
                        f"üö´ RSI OVERBOUGHT —Å–∏–≥–Ω–∞–ª –ü–û–õ–ù–û–°–¢–¨–Æ –ó–ê–ë–õ–û–ö–ò–†–û–í–ê–ù –¥–ª—è {symbol}: "
                        f"trending —Ä–µ–∂–∏–º + EMA bullish (–∫–æ–Ω—Ñ–ª–∏–∫—Ç —Å —Ç—Ä–µ–Ω–¥–æ–º)"
                    )
```

### –ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã –¥–ª—è RANGING:

1. **RSI –ø–æ—Ä–æ–≥–∏ –¥–ª—è ranging:**
   - `rsi_oversold: 30` (–ø–æ–∫—É–ø–∫–∞)
   - `rsi_overbought: 70` (–ø—Ä–æ–¥–∞–∂–∞)

2. **–ö–æ–Ω—Ñ–ª–∏–∫—Ç —Å —Ç—Ä–µ–Ω–¥–æ–º:**
   - –ü—Ä–∏ `is_downtrend` –∏ `rsi < rsi_oversold` ‚Üí `strength *= conflict_multiplier` (0.5 –¥–ª—è ranging)
   - –ü—Ä–∏ `is_uptrend` –∏ `rsi > rsi_overbought` ‚Üí –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ

3. **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –≤ trending:**
   - –í trending —Ä–µ–∂–∏–º–µ –ø—Ä–æ—Ç–∏–≤–æ—Ç—Ä–µ–Ω–¥–æ–≤—ã–µ —Å–∏–≥–Ω–∞–ª—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è
   - –í ranging/choppy - —Ç–æ–ª—å–∫–æ –æ—Å–ª–∞–±–ª—è—é—Ç—Å—è

---

## 3Ô∏è‚É£ –§–ò–õ–¨–¢–†–´, –ö–û–¢–û–†–´–ï –ë–õ–û–ö–ò–†–û–í–ê–õ–ò –°–ò–ì–ù–ê–õ–´

### –§–∞–π–ª: `logs/futures/archived/logs_2025-12-07_19-42-03/signals_2025-12-07.csv`

### –í—Å–µ —Å—Ç—Ä–æ–∫–∏, –≥–¥–µ regime=ranging, side=buy (LONG), executed=0:

**–ü—Ä–∏–º–µ—Ä—ã –±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö LONG —Å–∏–≥–Ω–∞–ª–æ–≤:**

| timestamp | symbol | side | price | strength | regime | filters_passed | executed |
|-----------|--------|------|-------|----------|--------|----------------|----------|
| 2025-12-07T14:45:13.532909 | SOL-USDT | buy | 136.80000000 | 1.0000 | ranging | ADX,MTF,Correlation,PivotPoints,VolumeProfile,Liquidity,OrderFlow,FundingRate | 0 |
| 2025-12-07T14:45:15.748999 | SOL-USDT | buy | 136.80000000 | 1.0000 | ranging | ADX,MTF,Correlation,PivotPoints,VolumeProfile,Liquidity,OrderFlow,FundingRate | 0 |
| 2025-12-07T14:45:24.835436 | ETH-USDT | buy | 3026.61000000 | 1.0000 | ranging | ADX,MTF,Correlation,PivotPoints,VolumeProfile,Liquidity,OrderFlow,FundingRate | 0 |
| 2025-12-07T14:45:35.434166 | ETH-USDT | buy | 3026.61000000 | 1.0000 | ranging | ADX,MTF,Correlation,PivotPoints,VolumeProfile,Liquidity,OrderFlow,FundingRate | 0 |

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –í—Å–µ —Ñ–∏–ª—å—Ç—Ä—ã –ø—Ä–æ–π–¥–µ–Ω—ã (`filters_passed` —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ —Ñ–∏–ª—å—Ç—Ä—ã), –Ω–æ `executed=0` - –∑–Ω–∞—á–∏—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –ü–û–°–õ–ï —Ñ–∏–ª—å—Ç—Ä–æ–≤.

### –í—Å–µ —Å—Ç—Ä–æ–∫–∏, –≥–¥–µ regime=ranging, side=sell (SHORT), executed=0:

**–ü—Ä–∏–º–µ—Ä—ã –±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö SHORT —Å–∏–≥–Ω–∞–ª–æ–≤:**

| timestamp | symbol | side | price | strength | regime | filters_passed | executed |
|-----------|--------|------|-------|----------|--------|----------------|----------|
| 2025-12-07T14:44:26.025832 | SOL-USDT | sell | 128.33000000 | 1.0000 | ranging | ADX,MTF,Correlation,PivotPoints,VolumeProfile,Liquidity,OrderFlow,FundingRate | 0 |
| 2025-12-07T14:44:42.573146 | XRP-USDT | sell | 2.00310000 | 1.0000 | ranging | ADX,MTF,Correlation,PivotPoints,VolumeProfile,Liquidity,OrderFlow,FundingRate | 0 |
| 2025-12-07T14:44:43.620238 | XRP-USDT | sell | 2.00310000 | 1.0000 | ranging | ADX,MTF,Correlation,PivotPoints,VolumeProfile,Liquidity,OrderFlow,FundingRate | 0 |
| 2025-12-07T14:44:49.598829 | XRP-USDT | sell | 2.00310000 | 1.0000 | ranging | ADX,MTF,Correlation,PivotPoints,VolumeProfile,Liquidity,OrderFlow,FundingRate | 0 |

### –ò—Å–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã (executed=1):

| timestamp | symbol | side | price | strength | regime | filters_passed | executed |
|-----------|--------|------|-------|----------|--------|----------------|----------|
| 2025-12-07T14:44:19.813011 | XRP-USDT | sell | 2.00360000 | 1.0000 | ranging | ADX,MTF,Correlation,PivotPoints,VolumeProfile,Liquidity,OrderFlow,FundingRate | 1 |
| 2025-12-07T14:44:26.026831 | DOGE-USDT | sell | 0.13543000 | 1.0000 | ranging | ADX,MTF,Correlation,PivotPoints,VolumeProfile,Liquidity,OrderFlow,FundingRate | 1 |
| 2025-12-07T14:44:56.627298 | SOL-USDT | buy | 136.80000000 | 1.0000 | ranging | ADX,MTF,Correlation,PivotPoints,VolumeProfile,Liquidity,OrderFlow,FundingRate | 1 |
| 2025-12-07T14:45:30.937510 | BTC-USDT | sell | 87858.30000000 | 1.0000 | ranging | ADX,MTF,Correlation,PivotPoints,VolumeProfile,Liquidity,OrderFlow,FundingRate | 1 |

### –í—ã–≤–æ–¥—ã:

1. **–í—Å–µ —Ñ–∏–ª—å—Ç—Ä—ã –ø—Ä–æ–π–¥–µ–Ω—ã** - –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ù–ï –≤ —Ñ–∏–ª—å—Ç—Ä–∞—Ö
2. **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ü–û–°–õ–ï —Ñ–∏–ª—å—Ç—Ä–æ–≤** - –≤–æ–∑–º–æ–∂–Ω–æ –≤:
   - Risk Manager (–ª–∏–º–∏—Ç –ø–æ–∑–∏—Ü–∏–π, –±–∞–ª–∞–Ω—Å)
   - Signal Coordinator (cooldown, –¥—É–±–ª–∏–∫–∞—Ç—ã)
   - Order Executor (—É—Å–ª–æ–≤–∏—è –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è)

---

## 4Ô∏è‚É£ FORWARD-LOOKING –í –°–ò–ì–ù–ê–õ–ê–•

### –§–∞–π–ª: `src/strategies/scalping/futures/signal_generator.py`

### –†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–∏—Å–∫–∞:

**Forward-looking –ù–ï –ù–ê–ô–î–ï–ù** –≤ `signal_generator.py`:
- –ù–µ—Ç `df.shift(-1)`
- –ù–µ—Ç `iloc[i+1]`
- –ù–µ—Ç `close[i+1]`
- –ù–µ—Ç `future_price`
- –ù–µ—Ç `next_bar`

**–í—ã–≤–æ–¥:** Forward-looking –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç - —Å–∏–≥–Ω–∞–ª—ã –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ–∫—É—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö, –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –±—É–¥—É—â–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π.

---

## 5Ô∏è‚É£ –†–ê–°–ß–Å–¢ SL/TP –ü–û –†–ï–ñ–ò–ú–£

### –§–∞–π–ª: `src/strategies/scalping/futures/positions/exit_analyzer.py`

### 30 —Å—Ç—Ä–æ–∫ —Ä–∞—Å—á—ë—Ç–∞ TP –ø–æ —Ä–µ–∂–∏–º—É (—Å—Ç—Ä–æ–∫–∏ 459-506):

```python
    def _get_tp_percent(self, symbol: str, regime: str) -> float:
        """
        –ü–æ–ª—É—á–µ–Ω–∏–µ TP% –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ –ø–æ —Å–∏–º–≤–æ–ª—É –∏ —Ä–µ–∂–∏–º—É.

        Args:
            symbol: –¢–æ—Ä–≥–æ–≤—ã–π —Å–∏–º–≤–æ–ª
            regime: –†–µ–∂–∏–º —Ä—ã–Ω–∫–∞ (trending, ranging, choppy)

        Returns:
            TP% –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
        """
        tp_percent = 2.4  # Fallback –∑–Ω–∞—á–µ–Ω–∏–µ

        if self.config_manager:
            try:
                # –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å TP –∏–∑ symbol_profiles
                symbol_profiles = getattr(self.config_manager, "symbol_profiles", {})
                if symbol in symbol_profiles:
                    symbol_config = symbol_profiles[symbol]
                    if isinstance(symbol_config, dict) and regime in symbol_config:
                        regime_config = symbol_config[regime]
                        if (
                            isinstance(regime_config, dict)
                            and "tp_percent" in regime_config
                        ):
                            return float(regime_config["tp_percent"])

                # Fallback –Ω–∞ by_regime
                by_regime = self.config_manager.to_dict(
                    getattr(self.scalping_config, "by_regime", {})
                    if self.scalping_config
                    else {}
                )
                if regime in by_regime:
                    regime_config = by_regime[regime]
                    if (
                        isinstance(regime_config, dict)
                        and "tp_percent" in regime_config
                    ):
                        return float(regime_config["tp_percent"])

                # Fallback –Ω–∞ –≥–ª–æ–±–∞–ª—å–Ω—ã–π TP
                if self.scalping_config:
                    tp_percent = getattr(self.scalping_config, "tp_percent", 2.4)
            except Exception as e:
                logger.debug(f"‚ö†Ô∏è ExitAnalyzer: –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è TP% –¥–ª—è {symbol}: {e}")

        return tp_percent
```

### 30 —Å—Ç—Ä–æ–∫ —Ä–∞—Å—á—ë—Ç–∞ SL –ø–æ —Ä–µ–∂–∏–º—É (—Ñ–∞–π–ª: `position_manager.py`, —Å—Ç—Ä–æ–∫–∏ 268-371):

```python
    def _get_adaptive_sl_percent(
        self, symbol: str, regime: Optional[str] = None
    ) -> float:
        """
        ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï: –ü–æ–ª—É—á–∞–µ—Ç –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π SL% –¥–ª—è —Å–∏–º–≤–æ–ª–∞ –∏ —Ä–µ–∂–∏–º–∞.

        –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–¢–û–ß–ù–û –∫–∞–∫ –¥–ª—è TP):
        1. Per-regime SL (–µ—Å–ª–∏ —Ä–µ–∂–∏–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω)
        2. Per-symbol SL (fallback)
        3. –ì–ª–æ–±–∞–ª—å–Ω—ã–π SL (fallback)

        Args:
            symbol: –¢–æ—Ä–≥–æ–≤—ã–π —Å–∏–º–≤–æ–ª
            regime: –†–µ–∂–∏–º —Ä—ã–Ω–∫–∞ (trending, ranging, choppy)

        Returns:
            SL% –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
        """
        # ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º sl_percent = None (–ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ–º fallback —Å—Ä–∞–∑—É!)
        sl_percent = None

        # –ü–æ–ª—É—á–∞–µ–º —Ä–µ–∂–∏–º –∏–∑ –ø–æ–∑–∏—Ü–∏–∏, –µ—Å–ª–∏ –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω
        if not regime:
            if symbol in self.active_positions:
                regime = self.active_positions[symbol].get("regime")
            elif hasattr(self, "orchestrator") and self.orchestrator:
                if (
                    hasattr(self.orchestrator, "signal_generator")
                    and self.orchestrator.signal_generator
                ):
                    if hasattr(self.orchestrator.signal_generator, "regime_managers"):
                        manager = (
                            self.orchestrator.signal_generator.regime_managers.get(
                                symbol
                            )
                        )
                        if manager:
                            regime = manager.get_current_regime()

        # –ü–æ–ª—É—á–∞–µ–º sl_percent –¥–ª—è —Å–∏–º–≤–æ–ª–∞ –∏ —Ä–µ–∂–∏–º–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å –≤ symbol_profiles)
        if symbol and self.symbol_profiles:
            symbol_profile = self.symbol_profiles.get(symbol, {})
            if symbol_profile:
                # –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ dict –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
                if not isinstance(symbol_profile, dict):
                    if hasattr(symbol_profile, "dict"):
                        symbol_dict = symbol_profile.dict()
                    elif hasattr(symbol_profile, "__dict__"):
                        symbol_dict = dict(symbol_profile.__dict__)
                    else:
                        symbol_dict = {}
                else:
                    symbol_dict = symbol_profile

                # 1. ‚úÖ –ü–†–ò–û–†–ò–¢–ï–¢ 1: Per-regime SL (–µ—Å–ª–∏ —Ä–µ–∂–∏–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω)
                if regime:
                    regime_lower = (
                        regime.lower()
                        if isinstance(regime, str)
                        else str(regime).lower()
                    )
                    regime_profile = symbol_dict.get(regime_lower, {})

                    if not isinstance(regime_profile, dict):
                        if hasattr(regime_profile, "dict"):
                            regime_profile = regime_profile.dict()
                        elif hasattr(regime_profile, "__dict__"):
                            regime_profile = dict(regime_profile.__dict__)
                        else:
                            regime_profile = {}

                    regime_sl_percent = regime_profile.get("sl_percent")
                    if regime_sl_percent is not None:
                        try:
                            sl_percent = float(regime_sl_percent)
                            logger.info(
                                f"‚úÖ Per-regime SL –¥–ª—è {symbol} ({regime}): {sl_percent}% "
                                f"(–≥–ª–æ–±–∞–ª—å–Ω—ã–π: {self.scalping_config.sl_percent}%)"
                            )
                            return sl_percent
                        except (ValueError, TypeError):
                            logger.warning(
                                f"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å regime_sl_percent –≤ float –¥–ª—è {symbol} ({regime}): {regime_sl_percent}"
                            )

                # 2. ‚úÖ –ü–†–ò–û–†–ò–¢–ï–¢ 2: Per-symbol SL (fallback, –µ—Å–ª–∏ —Ä–µ–∂–∏–º –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω)
                symbol_sl_percent = symbol_dict.get("sl_percent")
                if symbol_sl_percent is not None:
                    try:
                        sl_percent = float(symbol_sl_percent)
                        logger.info(
                            f"üìä Per-symbol SL –¥–ª—è {symbol}: {sl_percent}% "
                            f"(–≥–ª–æ–±–∞–ª—å–Ω—ã–π: {self.scalping_config.sl_percent}%)"
                        )
                        return sl_percent
                    except (ValueError, TypeError):
                        logger.warning(
                            f"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å symbol_sl_percent –≤ float –¥–ª—è {symbol}: {symbol_sl_percent}"
                        )

            # 3. ‚úÖ –ü–†–ò–û–†–ò–¢–ï–¢ 3: –ì–ª–æ–±–∞–ª—å–Ω—ã–π SL (fallback - –¢–û–õ–¨–ö–û –µ—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ)
            if sl_percent is None:
                sl_percent = self.scalping_config.sl_percent
                logger.warning(
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ TP/SL –≤ exit_analyzer.py (—Å—Ç—Ä–æ–∫–∏ 1413-1432):

```python
            # 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ TP (Take Profit) - –≤ ranging —Ä–µ–∂–∏–º–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º —Å—Ä–∞–∑—É
            tp_percent = self._get_tp_percent(symbol, "ranging")
            pnl_format = (
                f"{pnl_percent:.4f}" if abs(pnl_percent) < 0.1 else f"{pnl_percent:.2f}"
            )
            logger.info(
                f"üîç ExitAnalyzer RANGING {symbol}: TP={tp_percent:.2f}%, "
                f"PnL%={pnl_format}%, –¥–æ—Å—Ç–∏–≥–Ω—É—Ç={pnl_percent >= tp_percent}"
            )
            if pnl_percent >= tp_percent:
                logger.info(
                    f"üéØ ExitAnalyzer RANGING: TP –¥–æ—Å—Ç–∏–≥–Ω—É—Ç –¥–ª—è {symbol}: "
                    f"{pnl_percent:.2f}% >= {tp_percent:.2f}%"
                )
                return {
                    "action": "close",
                    "reason": "tp_reached",
                    "pnl_pct": pnl_percent,
                    "tp_percent": tp_percent,
                }
```

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø–æ–ª—É—á–µ–Ω–∏—è TP/SL:

1. **Per-regime SL/TP** (–µ—Å–ª–∏ —Ä–µ–∂–∏–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω) - –∏–∑ `symbol_profiles.{symbol}.{regime}.sl_percent`
2. **Per-symbol SL/TP** (fallback) - –∏–∑ `symbol_profiles.{symbol}.sl_percent`
3. **–ì–ª–æ–±–∞–ª—å–Ω—ã–π SL/TP** (fallback) - –∏–∑ `scalping_config.sl_percent` / `scalping_config.tp_percent`

---

## üîç –ê–ù–ê–õ–ò–ó –î–ê–ù–ù–´–•

### –ß—Ç–æ –Ω–∞–π–¥–µ–Ω–æ:

1. **–†–µ–∂–∏–º –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ:**
   - RANGING: `range_width < 3.0`, `adx < 15`, `trend_dev < trend_strength_percent`
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–∞—Å—Ç–æ—è—â–∏–π ADX —á–µ—Ä–µ–∑ FastADX —Å +DI/-DI

2. **–°–∏–≥–Ω–∞–ª—ã –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ:**
   - RSI oversold (buy) –ø—Ä–∏ `rsi < 30` –¥–ª—è ranging
   - RSI overbought (sell) –ø—Ä–∏ `rsi > 70` –¥–ª—è ranging
   - –ö–æ–Ω—Ñ–ª–∏–∫—Ç —Å —Ç—Ä–µ–Ω–¥–æ–º —Å–Ω–∏–∂–∞–µ—Ç strength –Ω–∞ 50% (conflict_multiplier=0.5)

3. **–§–∏–ª—å—Ç—Ä—ã –ù–ï –±–ª–æ–∫–∏—Ä—É—é—Ç:**
   - –í—Å–µ —Å–∏–≥–Ω–∞–ª—ã –ø—Ä–æ—à–ª–∏ —Ñ–∏–ª—å—Ç—Ä—ã (`filters_passed` —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ —Ñ–∏–ª—å—Ç—Ä—ã)
   - –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ü–û–°–õ–ï —Ñ–∏–ª—å—Ç—Ä–æ–≤

4. **Forward-looking –ù–ï–¢:**
   - –°–∏–≥–Ω–∞–ª—ã –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ–∫—É—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
   - –ù–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –±—É–¥—É—â–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π

5. **SL/TP —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ:**
   - –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: per-regime ‚Üí per-symbol ‚Üí –≥–ª–æ–±–∞–ª—å–Ω—ã–π
   - –î–ª—è ranging: `sl_percent: 2.0%`, `tp_percent: 2.0%` (–∏–ª–∏ per-symbol –∑–Ω–∞—á–µ–Ω–∏—è)

### –í–æ–ø—Ä–æ—Å—ã –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞:

1. **–ü–æ—á–µ–º—É –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è —Å–∏–≥–Ω–∞–ª—ã –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤?**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Risk Manager (–ª–∏–º–∏—Ç –ø–æ–∑–∏—Ü–∏–π)
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Signal Coordinator (cooldown, –¥—É–±–ª–∏–∫–∞—Ç—ã)
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Order Executor (—É—Å–ª–æ–≤–∏—è –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è)

2. **–ü–æ—á–µ–º—É –æ—Ç–∫—Ä—ã–ª–∏—Å—å –ø–æ–∑–∏—Ü–∏–∏ –ø—Ä–æ—Ç–∏–≤ —Ç—Ä–µ–Ω–¥–∞?**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –∫–∞–∫–æ–π –±—ã–ª —Ä–µ–∞–ª—å–Ω—ã–π —Ç—Ä–µ–Ω–¥ –≤ –º–æ–º–µ–Ω—Ç –æ—Ç–∫—Ä—ã—Ç–∏—è
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ –æ–ø—Ä–µ–¥–µ–ª—è–ª—Å—è —Ä–µ–∂–∏–º
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω–µ –±—ã–ª–æ –ª–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ —Å —Ç—Ä–µ–Ω–¥–æ–º (is_downtrend/is_uptrend)

3. **–ü–æ—á–µ–º—É SL –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª?**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è PnL% –æ—Ç –º–∞—Ä–∂–∏
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –¥–æ—Å—Ç–∏–≥–∞—é—Ç –ª–∏ –ø–æ–∑–∏—Ü–∏–∏ —É—Ä–æ–≤–Ω—è SL
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏–∫—É Trailing Stop Loss

---

**–°–æ–∑–¥–∞–Ω–æ:** 2025-12-07  
**–î–ª—è:** –ö–∏–º—ã  
**–¶–µ–ª—å:** –ù–∞–π—Ç–∏ –æ—à–∏–±–∫—É –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏ —Ä—ã–Ω–∫–∞, –ø–æ—á–µ–º—É 2 –ø–æ–∑–∏—Ü–∏–∏ –≤ –ø–ª—é—Å, –∞ 4 –≤ –º–∏–Ω—É—Å



