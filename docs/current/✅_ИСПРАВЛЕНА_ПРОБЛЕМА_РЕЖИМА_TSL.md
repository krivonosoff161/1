# ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ê –ü–†–û–ë–õ–ï–ú–ê –†–ï–ñ–ò–ú–ê TSL

**–î–∞—Ç–∞:** 23 –Ω–æ—è–±—Ä—è 2025, 01:50  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û**

---

## üîç –ù–ê–ô–î–ï–ù–ù–ê–Ø –ü–†–û–ë–õ–ï–ú–ê

### –ü—Ä–æ–±–ª–µ–º–∞:
–ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ø–æ–∑–∏—Ü–∏–∏ —á–µ—Ä–µ–∑ WebSocket (`_sync_positions_with_exchange`) –º–µ—Ç–æ–¥ `initialize_trailing_stop()` –≤—ã–∑—ã–≤–∞–ª—Å—è **–ë–ï–ó –ø–µ—Ä–µ–¥–∞—á–∏ —Ä–µ–∂–∏–º–∞**, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é **–≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤** –≤–º–µ—Å—Ç–æ —Ä–µ–∂–∏–º–Ω—ã—Ö:

- **–ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
  - `loss_cut_percent: 1.5%` (—Å—Ç—Ä–æ–∫–∞ 1246)
  - `min_holding_minutes: 0.5` (30 —Å–µ–∫—É–Ω–¥!) (—Å—Ç—Ä–æ–∫–∞ 1249)
  - `timeout_minutes: 5` (—Å—Ç—Ä–æ–∫–∞ 1248)

- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã RANGING (–¥–æ–ª–∂–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è):**
  - `loss_cut_percent: 4.0%` (—Å—Ç—Ä–æ–∫–∞ 1301)
  - `min_holding_minutes: 60.0` (60 –º–∏–Ω—É—Ç) (—Å—Ç—Ä–æ–∫–∞ 1309)
  - `timeout_minutes: 120` (—Å—Ç—Ä–æ–∫–∞ 1303)

### –ü—Ä–∏—á–∏–Ω–∞:
–í `orchestrator.py` —Å—Ç—Ä–æ–∫–∞ 1304 –≤—ã–∑—ã–≤–∞–ª—Å—è `initialize_trailing_stop()` –±–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `signal`, –ø–æ—ç—Ç–æ–º—É —Ä–µ–∂–∏–º –Ω–µ –ø–µ—Ä–µ–¥–∞–≤–∞–ª—Å—è, –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã.

---

## ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### 1. –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ –ø–µ—Ä–µ–¥ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π TSL
```python
# ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ü–æ–ª—É—á–∞–µ–º —Ä–µ–∂–∏–º –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ TSL
regime = None
if hasattr(self.signal_generator, "regime_managers") and symbol in getattr(self.signal_generator, "regime_managers", {}):
    manager = self.signal_generator.regime_managers.get(symbol)
    if manager:
        regime = manager.get_current_regime()
```

### 2. –°–æ–∑–¥–∞–Ω signal —Å —Ä–µ–∂–∏–º–æ–º –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –≤ initialize_trailing_stop
```python
# ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –°–æ–∑–¥–∞–µ–º signal —Å —Ä–µ–∂–∏–º–æ–º –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –≤ initialize_trailing_stop
signal_with_regime = {"regime": regime} if regime else None
```

### 3. –ü–µ—Ä–µ–¥–∞–Ω signal –≤ initialize_trailing_stop
```python
self.trailing_sl_coordinator.initialize_trailing_stop(
    symbol=symbol,
    entry_price=effective_price,
    side=trailing_side,
    current_price=mark_price,
    signal=signal_with_regime,  # ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï: –ü–µ—Ä–µ–¥–∞–µ–º —Ä–µ–∂–∏–º —á–µ—Ä–µ–∑ signal
)
```

### 4. –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∂–∏–º–∞ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
```python
logger.info(
    f"üîç TSL INIT –¥–ª—è {symbol}: regime={regime}, "
    f"loss_cut={params.get('loss_cut_percent')}, "
    f"min_holding={params.get('min_holding_minutes')} –º–∏–Ω, "
    f"timeout={params.get('timeout_minutes')} –º–∏–Ω"
)
```

---

## üéØ –†–ï–ó–£–õ–¨–¢–ê–¢

### –¢–µ–ø–µ—Ä—å:
- ‚úÖ –†–µ–∂–∏–º –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∏–∑ `regime_managers` –ø–µ—Ä–µ–¥ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π TSL
- ‚úÖ –†–µ–∂–∏–º –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ `initialize_trailing_stop()` —á–µ—Ä–µ–∑ `signal`
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —Ä–µ–∂–∏–º–∞ (RANGING: loss_cut=4.0%, min_holding=60 –º–∏–Ω)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

### –û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:
- ‚úÖ –ü–æ–∑–∏—Ü–∏–∏ –≤ RANGING —Ä–µ–∂–∏–º–µ –±—É–¥—É—Ç –¥–µ—Ä–∂–∞—Ç—å—Å—è –º–∏–Ω–∏–º—É–º **60 –º–∏–Ω—É—Ç**
- ‚úÖ `loss_cut` –±—É–¥–µ—Ç —Å—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –ø—Ä–∏ **4.0%** —É–±—ã—Ç–∫–µ (–≤–º–µ—Å—Ç–æ 1.5%)
- ‚úÖ `timeout` –±—É–¥–µ—Ç **120 –º–∏–Ω—É—Ç** (–≤–º–µ—Å—Ç–æ 5 –º–∏–Ω—É—Ç)

---

## üìã –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

1. ‚úÖ –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
2. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ TSL (–¥–æ–ª–∂–Ω—ã –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–µ–∂–∏–º –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã)
3. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø–æ–∑–∏—Ü–∏–∏ –¥–µ—Ä–∂–∞—Ç—Å—è –º–∏–Ω–∏–º—É–º 60 –º–∏–Ω—É—Ç –≤ RANGING —Ä–µ–∂–∏–º–µ
4. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `loss_cut` —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä–∏ 4.0% —É–±—ã—Ç–∫–µ

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û –ò –ì–û–¢–û–í–û –ö –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Æ**

