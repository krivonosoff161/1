# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞ —Å –±–∞–ª–∞–Ω—Å–æ–º $400

## üìä –ê–Ω–∞–ª–∏–∑ –¥–ª—è –±–∞–ª–∞–Ω—Å–∞ $400:

### 1. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è:
```
–ë–∞–ª–∞–Ω—Å: $400
–õ–æ–≥–∏–∫–∞: balance <= threshold

–ü—Ä–æ–≤–µ—Ä–∫–∞:
- $400 <= $1500? ‚úÖ –î–ê ‚Üí –ø—Ä–æ—Ñ–∏–ª—å "small"
```

### 2. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—Ä–æ—Ñ–∏–ª—è "small":
```yaml
base_position_usd: 150.0
min_position_usd: 120.0   # ‚ö†Ô∏è –ú–ò–ù–ò–ú–£–ú $120
max_position_usd: 200.0
max_open_positions: 2
max_position_percent: 30.0%
```

### 3. –†–∞—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏ –¥–ª—è $400:

#### –®–∞–≥ 1: –ë–∞–∑–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä
```
base_usd_size = $150
```

#### –®–∞–≥ 2: Multiplier —Ä–µ–∂–∏–º–∞ (–µ—Å–ª–∏ trending 1.2x)
```
base_usd_size = $150 √ó 1.2 = $180
```

#### –®–∞–≥ 3: Multiplier —Å–∏–≥–Ω–∞–ª–∞ (strength=0.8 ‚Üí 1.5x)
```
base_usd_size = $180 √ó 1.5 = $270
–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ: min($270, $200) = $200 ‚úÖ
```

#### –®–∞–≥ 4: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ leverage
```
margin_required = $200
leverage = 3x
notional = $200 √ó 3 = $600
```

#### –®–∞–≥ 5: –ó–∞—â–∏—Ç–∞ Max Margin Used (80%)
```
max_margin_allowed = $400 √ó 0.80 = $320
margin_required ($200) < $320 ‚úÖ –û–ö
```

#### –®–∞–≥ 6: ‚ö†Ô∏è –ó–∞—â–∏—Ç–∞ Max Loss per Trade (2%)
```
max_loss_usd = $400 √ó 0.02 = $8 (–º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø–æ—Ç–µ—Ä—è –Ω–∞ —Å–¥–µ–ª–∫—É)
sl_percent = 0.2 (20% —Å—Ç–æ–ø-–ª–æ—Å—Å)

–§–æ—Ä–º—É–ª–∞:
max_safe_margin = max_loss_usd / (sl_percent / 100)
max_safe_margin = $8 / (0.2 / 100)
max_safe_margin = $8 / 0.002 = $4000 ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–ê–Ø –§–û–†–ú–£–õ–ê!

–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞:
max_safe_margin = max_loss_usd / sl_percent
max_safe_margin = $8 / 0.2 = $40

margin_required ($200) > max_safe_margin ($40) ‚ùå –ü–†–û–ë–õ–ï–ú–ê!
margin_required –±—É–¥–µ—Ç —É–º–µ–Ω—å—à–µ–Ω –¥–æ $40
```

#### –®–∞–≥ 7: –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–Ω–∏–º—É–º–∞
```
margin_required = $40
min_usd_size = $120

margin_required ($40) < min_usd_size ($120) ‚ùå –ü–†–û–ë–õ–ï–ú–ê!
```

#### –®–∞–≥ 8: –§–∏–Ω–∞–ª—å–Ω–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ
```
margin_usd = max(min_usd_size, min(margin_required, max_usd_size))
margin_usd = max($120, min($40, $200))
margin_usd = max($120, $40)
margin_usd = $120 ‚úÖ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–∏–Ω–∏–º—É–º)
```

## ‚ö†Ô∏è –ù–ê–ô–î–ï–ù–ù–ê–Ø –ü–†–û–ë–õ–ï–ú–ê:

### –û—à–∏–±–∫–∞ –≤ —Ä–∞—Å—á–µ—Ç–µ `max_safe_margin`:

**–¢–µ–∫—É—â–∞—è —Ñ–æ—Ä–º—É–ª–∞ (—Å—Ç—Ä–æ–∫–∞ 856):**
```python
max_safe_margin = max_loss_usd / (sl_percent / 100)
# max_safe_margin = $8 / (0.2 / 100) = $8 / 0.002 = $4000 ‚ùå
```

**–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞:**
```python
max_safe_margin = max_loss_usd / sl_percent
# max_safe_margin = $8 / 0.2 = $40 ‚úÖ
```

**–ò–õ–ò:**
```python
max_safe_margin = max_loss_usd / (sl_percent / 100)  # –ï—Å–ª–∏ sl_percent –≤ –¥–æ–ª—è—Ö
# –ù–æ —É –Ω–∞—Å sl_percent = 0.2 (20%), –∞ –Ω–µ 0.002!
```

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª—è –¥—Ä—É–≥–∏—Ö –±–∞–ª–∞–Ω—Å–æ–≤:

### –ë–∞–ª–∞–Ω—Å $1000:
```
max_loss_usd = $20
max_safe_margin = $20 / 0.002 = $10,000 ‚ùå (—Ç–æ–∂–µ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ!)
max_safe_margin = $20 / 0.2 = $100 ‚úÖ

margin_required ($200) > $100
‚Üí margin_required = $100
margin_usd = max($120, $100) = $120 ‚úÖ
```

### –ë–∞–ª–∞–Ω—Å $2000:
```
max_loss_usd = $40
max_safe_margin = $40 / 0.2 = $200 ‚úÖ
margin_required ($200) = $200 ‚úÖ
margin_usd = $200 ‚úÖ
```

## üêõ –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê:

**–§–æ—Ä–º—É–ª–∞ —Ä–∞—Å—á–µ—Ç–∞ `max_safe_margin` –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è!**

–ù—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É 856 –≤ `orchestrator.py`.

