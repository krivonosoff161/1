# üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê: SL –ù–ï –ê–î–ê–ü–¢–ò–í–ù–´–ô + –ü–û–ó–ò–¶–ò–ò –î–û–õ–ì–û –í –ú–ò–ù–£–°–ï

**–î–∞—Ç–∞:** 23.11.2025, 23:35  
**–°—Ç–∞—Ç—É—Å:** –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞

---

## üéØ –ü–†–û–ë–õ–ï–ú–ê #1: SL –ù–ï –ê–î–ê–ü–¢–ò–í–ù–´–ô

**–¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è:**
- ‚úÖ **TP –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π** (3.5-5.0% –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–∏–º–≤–æ–ª–∞ –∏ —Ä–µ–∂–∏–º–∞)
- ‚ùå **SL = 1.2% (–≥–ª–æ–±–∞–ª—å–Ω—ã–π)** - –ù–ï –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π, –≤–µ–∑–¥–µ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π

**–ù–û!** `sl_percent` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **–¢–û–õ–¨–ö–û** –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏ –≤ `risk_manager.py`, **–ù–ï** –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–π!

---

## üéØ –ü–†–û–ë–õ–ï–ú–ê #2: –ü–û–ó–ò–¶–ò–ò –î–û–õ–ì–û –í –ú–ò–ù–£–°–ï

**–ü—Ä–∏—á–∏–Ω–∞:** –í–º–µ—Å—Ç–æ `sl_percent` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `loss_cut_percent` (–∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π):

| –†–µ–∂–∏–º | loss_cut_percent | min_holding_minutes |
|-------|------------------|---------------------|
| **–ì–ª–æ–±–∞–ª—å–Ω—ã–π** | 1.5% | 0.5 –º–∏–Ω |
| **Trending** | **2.0%** | 2.0 –º–∏–Ω |
| **Ranging** | **4.0%** ‚ö†Ô∏è | **60.0 –º–∏–Ω** ‚ö†Ô∏è |
| **Choppy** | 1.2% | 0.5 –º–∏–Ω |

**–í–û–¢ –û–ù–û!** –í **ranging** —Ä–µ–∂–∏–º–µ:
- `loss_cut_percent = 4.0%` (–≤–º–µ—Å—Ç–æ 1.2% SL!)
- `min_holding_minutes = 60.0 –º–∏–Ω` (–∑–∞—â–∏—Ç–∞ –æ—Ç –ø—Ä–µ–∂–¥–µ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è!)

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:** –£–±—ã—Ç–æ—á–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ **–ù–ï –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è –ø–æ timeout** (—Å—Ç—Ä–æ–∫–∞ 2751 –≤ `orchestrator.py`):
```python
# ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ù–ï –∑–∞–∫—Ä—ã–≤–∞–µ–º —É–±—ã—Ç–æ—á–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –ø–æ –≤—Ä–µ–º–µ–Ω–∏
# –£–±—ã—Ç–æ—á–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã –∑–∞–∫—Ä—ã–≤–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –ø–æ trailing stop –∏–ª–∏ loss cut
if profit_pct <= 0:
    return  # –ù–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º —É–±—ã—Ç–æ—á–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –ø–æ –≤—Ä–µ–º–µ–Ω–∏
```

---

## üîç –î–ï–¢–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∑–∞–∫—Ä—ã—Ç–∏–µ —É–±—ã—Ç–æ—á–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π:

1. **TSL (Trailing Stop Loss)** - –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Å—Ç–æ–ø (–µ—Å–ª–∏ –∞–∫—Ç–∏–≤–µ–Ω)
2. **loss_cut_percent** - –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏ —É–±—ã—Ç–∫–µ (–µ—Å–ª–∏ TSL –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω –∏–ª–∏ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª)
3. **timeout_loss_percent** - –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è —É–±—ã—Ç–æ—á–Ω—ã—Ö (–ù–û –æ—Ç–∫–ª—é—á–µ–Ω–æ –≤ –∫–æ–¥–µ!)
4. **min_holding_minutes** - –∑–∞—â–∏—Ç–∞ –æ—Ç –ø—Ä–µ–∂–¥–µ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è (–±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–∫—Ä—ã—Ç–∏–µ)

### –ü–æ—á–µ–º—É –ø–æ–∑–∏—Ü–∏–∏ –¥–æ–ª–≥–æ –≤ –º–∏–Ω—É—Å–µ:

**–í ranging —Ä–µ–∂–∏–º–µ:**
- –ü–æ–∑–∏—Ü–∏—è –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è
- `min_holding_minutes = 60 –º–∏–Ω` - –∑–∞—â–∏—Ç–∞ –∞–∫—Ç–∏–≤–Ω–∞
- –ï—Å–ª–∏ –ø–æ–∑–∏—Ü–∏—è —É—Ö–æ–¥–∏—Ç –≤ –º–∏–Ω—É—Å, –æ–Ω–∞ **–ù–ï –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è** –ø–æ–∫–∞:
  - –ù–µ –ø—Ä–æ—à–ª–æ 60 –º–∏–Ω—É—Ç **–ò–õ–ò**
  - PnL –Ω–µ –¥–æ—Å—Ç–∏–≥–Ω–µ—Ç -4.0% –æ—Ç –º–∞—Ä–∂–∏ (loss_cut)
- Timeout –∑–∞–∫—Ä—ã—Ç–∏–µ **–æ—Ç–∫–ª—é—á–µ–Ω–æ** –¥–ª—è —É–±—ã—Ç–æ—á–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π!

**–ü—Ä–∏–º–µ—Ä:**
- –ü–æ–∑–∏—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç–∞ –≤ ranging —Ä–µ–∂–∏–º–µ
- –£—Ö–æ–¥–∏—Ç –≤ -1.5% —á–µ—Ä–µ–∑ 5 –º–∏–Ω—É—Ç
- ‚ùå –ù–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è (min_holding = 60 –º–∏–Ω, loss_cut = -4.0%)
- –ñ–¥–µ—Ç –¥–æ 60 –º–∏–Ω—É—Ç –∏–ª–∏ –¥–æ -4.0%!

---

## ‚úÖ –†–ï–®–ï–ù–ò–ï

### –í–∞—Ä–∏–∞–Ω—Ç 1: –°–¥–µ–ª–∞—Ç—å SL –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–º (–∫–∞–∫ TP)

**–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ–Ω—Ñ–∏–≥:**
```yaml
adaptive_regime:
  regimes:
    trending:
      sl_percent: 1.5  # –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π SL –¥–ª—è trending
    ranging:
      sl_percent: 2.0  # –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π SL –¥–ª—è ranging (–≤–º–µ—Å—Ç–æ 4.0% loss_cut)
    choppy:
      sl_percent: 1.0  # –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π SL –¥–ª—è choppy
  symbol_profiles:
    "BTC-USDT":
      trending:
        sl_percent: 1.5
      ranging:
        sl_percent: 2.0
      choppy:
        sl_percent: 1.5
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `sl_percent` –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–π** (–≤–º–µ—Å—Ç–æ —Ç–æ–ª—å–∫–æ `loss_cut_percent`)

---

### –í–∞—Ä–∏–∞–Ω—Ç 2: –°–Ω–∏–∑–∏—Ç—å loss_cut –¥–ª—è ranging

**–ò–∑–º–µ–Ω–∏—Ç—å –≤ –∫–æ–Ω—Ñ–∏–≥–µ:**
```yaml
trailing_sl:
  by_regime:
    ranging:
      loss_cut_percent: 2.0  # –í–º–µ—Å—Ç–æ 4.0% (–±—ã–ª–æ —Å–ª–∏—à–∫–æ–º –≤—ã—Å–æ–∫–æ!)
      min_holding_minutes: 20.0  # –í–º–µ—Å—Ç–æ 60.0 –º–∏–Ω (–±—ã–ª–æ —Å–ª–∏—à–∫–æ–º –¥–æ–ª–≥–æ!)
```

---

### –í–∞—Ä–∏–∞–Ω—Ç 3: –í–∫–ª—é—á–∏—Ç—å timeout –¥–ª—è —É–±—ã—Ç–æ—á–Ω—ã—Ö

**–ò–∑–º–µ–Ω–∏—Ç—å –≤ –∫–æ–¥–µ** (`orchestrator.py`, —Å—Ç—Ä–æ–∫–∞ 2751):
```python
# ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –ó–∞–∫—Ä—ã–≤–∞–µ–º —É–±—ã—Ç–æ—á–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –ø–æ timeout
# –£–±—ã—Ç–æ—á–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è –ø–æ timeout_loss_percent –ø–æ—Å–ª–µ timeout_minutes
if profit_pct <= 0 and time_held >= actual_max_holding:
    timeout_loss = regime_params.get("timeout_loss_percent", 1.0)
    if profit_pct <= -timeout_loss:
        logger.warning(f"‚è∞ –ü–æ–∑–∏—Ü–∏—è {symbol} –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø–æ timeout: "
                      f"—É–±—ã—Ç–æ–∫ {profit_pct:.2%} >= {timeout_loss:.2%} –ø–æ—Å–ª–µ {time_held:.1f} –º–∏–Ω")
        await self._close_position(symbol, "timeout_loss")
        return
```

---

## üéØ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–Ø

**–ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥:**

1. **–°–¥–µ–ª–∞—Ç—å SL –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–º** (–∫–∞–∫ TP)
2. **–°–Ω–∏–∑–∏—Ç—å loss_cut –¥–ª—è ranging** (4.0% ‚Üí 2.0%)
3. **–°–Ω–∏–∑–∏—Ç—å min_holding –¥–ª—è ranging** (60 –º–∏–Ω ‚Üí 20-30 –º–∏–Ω)
4. **–í–∫–ª—é—á–∏—Ç—å timeout –¥–ª—è —É–±—ã—Ç–æ—á–Ω—ã—Ö** (–ø–æ—Å–ª–µ —Å–Ω–∏–∂–µ–Ω–∏—è min_holding)

**–ò—Ç–æ–≥–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è ranging:**
- `sl_percent: 2.0%` (–∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π)
- `loss_cut_percent: 2.0%` (–≤–º–µ—Å—Ç–æ 4.0%)
- `timeout_loss_percent: 2.0%`
- `timeout_minutes: 20 –º–∏–Ω`
- `min_holding_minutes: 20 –º–∏–Ω` (–≤–º–µ—Å—Ç–æ 60 –º–∏–Ω)

---

## üìä –û–ñ–ò–î–ê–ï–ú–´–ô –≠–§–§–ï–ö–¢

**–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (ranging):**
- –ü–æ–∑–∏—Ü–∏–∏ –≤ -1.5% –Ω–µ –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è 60 –º–∏–Ω—É—Ç
- –ü–æ–∑–∏—Ü–∏–∏ –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ -4.0% loss_cut
- –°—Ä–µ–¥–Ω–∏–π —É–±—ã—Ç–æ–∫: -2.0% –¥–æ -4.0%

**–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (ranging):**
- –ü–æ–∑–∏—Ü–∏–∏ –≤ -2.0% –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è —Å—Ä–∞–∑—É (sl_percent = 2.0%)
- –ü–æ–∑–∏—Ü–∏–∏ –≤ -2.0% –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è –ø–æ—Å–ª–µ 20 –º–∏–Ω—É—Ç (timeout)
- –°—Ä–µ–¥–Ω–∏–π —É–±—ã—Ç–æ–∫: -1.5% –¥–æ -2.0%

**–£–ª—É—á—à–µ–Ω–∏–µ:**
- –°–Ω–∏–∂–µ–Ω–∏–µ —Å—Ä–µ–¥–Ω–µ–≥–æ —É–±—ã—Ç–∫–∞ —Å -2.5% –¥–æ -1.75%
- –°–Ω–∏–∂–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –≤ –º–∏–Ω—É—Å–µ —Å 30-60 –º–∏–Ω –¥–æ 10-20 –º–∏–Ω
- –£–ª—É—á—à–µ–Ω–∏–µ Risk/Reward: 2.0% SL / 4.0% TP = 1:2 (–≤–º–µ—Å—Ç–æ 4.0% loss_cut / 4.0% TP = 1:1)

---

**–î–∞—Ç–∞:** 23.11.2025, 23:35

